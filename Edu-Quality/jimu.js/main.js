// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*
 Chen, Yi-Cyuan 2015-2017
 @license MIT
 Cropper.js v1.5.1
 https://fengyuanchen.github.io/cropperjs

 Copyright 2015-present Chen Fengyuan
 Released under the MIT license

 Date: 2019-03-10T09:55:53.729Z
 inherited ||
        // if it is inherited, we need to check to make sure there isn't an existing property */
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUrlUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){function l(u,k){var w=r.clone(u),y=m.widgetProperties;"undefined"===typeof k&&(k=!1);delete w.mode;delete w.configWabVersion;
m.visitElement(w,function(C,D){C.widgets?(delete C.isOnScreen,delete C.gid,"jimu.js/images/group_icon.png"===C.icon&&delete C.icon,delete C.openType,D.isOnScreen&&C.panel&&m.isEqual(C.panel,w.widgetOnScreen.panel)&&delete C.panel):(C.icon&&C.icon===C.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete C.icon,delete C.panel,delete C.folderUrl,delete C.amdFolder,delete C.thumbnail,delete C.configFile,delete C.gid,delete C.isOnScreen,delete C.isRemote,delete C.featureActions,y.forEach(function(G){delete C[G]}),
k?"undefined"===typeof C.openAtStart&&(C.openAtStart=!1):(C.visible&&delete C.visible,C.manifest&&C.label===C.manifest.label&&delete C.label,C.isDefaultConfig&&(delete C.config,delete C.isDefaultConfig)),delete C.manifest,C.itemId&&delete C.uri)});delete w.rawAppConfig;delete w._ssl;delete w.getConfigElementById;delete w.getConfigElementsByName;delete w.processNoUriWidgets;delete w.addElementId;delete w.getCleanConfig;delete w.visitElement;delete w.agolConfig;delete w._itemData;delete w.oldWabVersion;
delete w.titleColor;return w}var q=null;var A=F(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(u){this.urlParams=u||{};this.listenBuilderEvents();this.versionManager=new p;this.widgetManager=h.getInstance();this.configLoader=e.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&r.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(n);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&r.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(n);m.isMobileUa()||t(window,"resize",r.hitch(this,this._onWindowResize));t(window,"orientationchange",r.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){n.subscribe("builder/widgetChanged",r.hitch(this,this._onWidgetChanged));n.subscribe("builder/groupChanged",r.hitch(this,this._onGroupChanged));n.subscribe("builder/layoutDefinitionChanged",
r.hitch(this,this._onLayoutDefinitionChanged));n.subscribe("builder/onScreenGroupsChanged",r.hitch(this,this._onOnScreenGroupsChanged));n.subscribe("builder/widgetPoolChanged",r.hitch(this,this._onWidgetPoolChanged));n.subscribe("builder/openAtStartChange",r.hitch(this,this._onOpenAtStartChanged));n.subscribe("builder/onScreenOrderChanged",r.hitch(this,this._onScreenOrderChanged));n.subscribe("builder/mapContentModified",r.hitch(this,this._onMapContentModified));n.subscribe("builder/mapChanged",r.hitch(this,
this._onMapChanged));n.subscribe("builder/mapOptionsChanged",r.hitch(this,this._onMapOptionsChanged));n.subscribe("builder/mapRefreshIntervalChanged",r.hitch(this,this._onMapRefreshIntervalChanged));n.subscribe("builder/appAttributeChanged",r.hitch(this,this._onAppAttributeChanged));n.subscribe("builder/dataSourceChanged",r.hitch(this,this._onDataSourceChanged));n.subscribe("builder/setAppConfig",r.hitch(this,this._onAppConfigSet));n.subscribe("builder/themeChanged",r.hitch(this,this._onThemeChanged));
n.subscribe("builder/layoutChanged",r.hitch(this,this._onLayoutChanged));n.subscribe("builder/styleChanged",r.hitch(this,this._onStyleChanged));n.subscribe("builder/syncExtent",r.hitch(this,this._onSyncExtent));n.subscribe("builder/loadingPageChanged",r.hitch(this,this._onLoadingPageChanged));n.subscribe("builder/templateConfigChanged",r.hitch(this,this._onTemplateConfigChanged));n.subscribe("builder/appProxyForMapChanged",r.hitch(this,this._onAppProxyForMapChanged));n.subscribe("builder/appProxyForUrlChanged",
r.hitch(this,this._onAppProxyForUrlChanged));n.subscribe("builder/sharedThemeChanged",r.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode){var u=new f;u.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(r.hitch(this,function(k){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(k);console.timeEnd("Load Config");window.appInfo.isRunInMobile=m.inMobileSize();k=
this.getAppConfig();u.destroy();n.publish("appConfigLoaded",k);return k}),r.hitch(this,function(k){u.destroy();console.error(k);k&&k.message&&"string"===typeof k.message&&this._showErrorMessage(k)}))}},_showErrorMessage:function(u){if(!1===u.isSelfOrigin){x.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML(u.message||u)},document.body);u=x.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML(window.jimuNls.common.close)},document.body);x.setStyle(u,{"margin-top":"80px","padding-top":0,
background:"none",cursor:"pointer"});t(u,"click",r.hitch(this,function(){window.close()}));x.setStyle(u,"display","none");u=x.create("div",{"class":"app-error"},document.body);x.setStyle(u,{"margin-top":"90px","padding-top":0,background:"none"});u=x.create("div",{"class":"app-error-advanced-button",innerHTML:m.sanitizeHTML(window.jimuNls.advancedOptions)},u);x.setStyle(u,{margin:"0 auto 0 auto",color:"#666",padding:"8px 12px 8px 12px",background:"none",border:"1px solid #ccc",display:"inline-block",
"border-radius":"4px",cursor:"pointer"});t(u,"click",r.hitch(this,function(){x.setStyle(w,"display","block")}));u=window.location.href;var k=b.getStandardPortalUrl(window.location.origin);k=b.getArcgisOnlineUrl(k);u=u.replace(window.location.origin,k);u=window.jimuNls.proceedTo.replace("${value}","\x3ca href\x3d"+u+"\x3e"+u+"\x3c/a\x3e");var w=x.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML(u)},document.body);x.setStyle(w,{"margin-top":"140px",display:"none","padding-top":0,background:"none"})}else x.create("div",
{"class":"app-error",innerHTML:m.sanitizeHTML(u.message||u)},document.body);x.setStyle(jimuConfig.loadingId,"display","none")},getAppConfig:function(){if(window.appInfo.isRunInMobile){var u=r.clone(this._getMobileConfig(this.appConfig));u._originConfig=r.clone(this.appConfig)}else u=r.clone(this.appConfig);u.getConfigElementById=function(k){return m.getConfigElementById(this,k)};u.getConfigElementsByName=function(k){return m.getConfigElementsByName(this,k)};u.getCleanConfig=function(k){return this._originConfig?
l(this._originConfig,k):l(this,k)};u.visitElement=function(k){m.visitElement(this,k)};return u},_onOrientationChange:function(){this.appConfig&&n.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var u=m.inMobileSize();window.appInfo.isRunInMobile!==u&&(window.appInfo.isRunInMobile=u,this.appConfig&&n.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(u){return m.mixinAppConfigPosition(u,u.mobileLayout)},_updateDataSourceForWidget:function(u){this._deleteDataSourcesFromWidget(u);
this._addDataSourcesForWidget(u)},_deleteDataSourcesFromWidget:function(u){for(var k in this.appConfig.dataSource.dataSources)k.startWith("widget~"+u.id+"~")&&delete this.appConfig.dataSource.dataSources[k]},_addDataSourcesForWidget:function(u){z.forEach(u.provideDataSources,function(k){var w="widget~"+u.id+"~"+k.id;k.id=w;this.appConfig.dataSource.dataSources[w]=k},this);delete u.provideDataSources},_addIdForWidgets:function(u){var k=0,w;this.getAppConfig().visitElement(function(y){if(y.id){y.id=
y.id.replace(/\//g,"_");var C=y.id.lastIndexOf("_");-1<C&&(w=y.id.substr(C+1),k=Math.max(k,w))}});z.forEach(u,function(y){y.id||(k++,y.id=y.itemId?y.itemId+"_"+k:y.uri?y.uri.replace(/\//g,"_")+"_"+k:"_"+k)})},_onWidgetChanged:function(u){var k=m.reCreateObject(u);u=m.getConfigElementById(this.appConfig,u.id);this._updateDataSourceForWidget(k);!1!==k.inPanel||u.uri||(k.closeable=!0);for(var w in k)u[w]=k[w];delete u.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
n.publish("appConfigChanged",this.getAppConfig(),"widgetChange",k)},_onGroupChanged:function(u){var k=m.reCreateObject(u);u=m.getConfigElementById(this.appConfig,u.id);this._handleDataSourceForWidgets(u,k);for(var w in k)u[w]=k[w];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);n.publish("appConfigChanged",this.getAppConfig(),"groupChange",k)},_handleDataSourceForWidgets:function(u,k){var w=z.filter(k.widgets,function(y){return y.id?0===z.filter(u.widgets,function(C){return y.id===
C.id}).length:!0},this);this._addIdForWidgets(w);z.forEach(w,function(y){this._addDataSourcesForWidget(y)},this);w=z.filter(u.widgets,function(y){return 0===z.filter(k.widgets,function(C){return C.id===y.id}).length},this);z.forEach(w,function(y){this._deleteDataSourcesFromWidget(y)},this);z.forEach(k.widgets,function(y){z.forEach(u.widgets,function(C){y.id===C.id&&y.provideDataSources&&this._updateDataSourceForWidget(y)},this)},this)},_onWidgetPoolChanged:function(u){var k=m.reCreateObject(u);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,
k);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=k.widgets,this.appConfig.widgetPool.groups=k.groups):(u=m.getConfigElementById(this.appConfig,k.controllerId),z.forEach(u.controlledWidgets,function(w){this._removeWidgetOrGroupFromPoolById(this.appConfig,w)},this),z.forEach(u.controlledGroups,function(w){this._removeWidgetOrGroupFromPoolById(this.appConfig,w)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?k.widgets:
this.appConfig.widgetPool.widgets.concat(k.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?k.groups:this.appConfig.widgetPool.groups.concat(k.groups),u.controlledWidgets=z.map(k.widgets,function(w){return w.id}),u.controlledGroups=z.map(k.groups,function(w){return w.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(r.hitch(this,function(w){this.appConfig=w;this._addDefaultValues(this.appConfig);
n.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",k)}))},_handleDataSourceForWidgetsSection:function(u,k){var w=k.widgets;z.forEach(k.groups,function(C){w=w.concat(C.widgets)},this);var y=u.widgets;z.forEach(u.groups,function(C){y=y.concat(C.widgets)},this);this._handleDataSourceForWidgets({widgets:y},{widgets:w})},_removeWidgetOrGroupFromPoolById:function(u,k){z.some(u.widgetPool.widgets,function(w,y){if(w.id===k)return u.widgetPool.widgets.splice(y,1),!0});z.some(u.widgetPool.groups,
function(w,y){if(w.id===k)return u.widgetPool.groups.splice(y,1),!0})},_onOpenAtStartChanged:function(u){var k=m.reCreateObject(u),w=this.appConfig;u.isOnScreen?(w=w.widgetOnScreen&&w.widgetOnScreen.widgets)&&0<w.length&&z.forEach(w,r.hitch(this,function(y){y.id===u.id?y.openAtStart=!y.openAtStart:delete y.openAtStart})):((w=w.widgetPool)&&w.groups&&0<w.groups.length&&z.forEach(w.groups,r.hitch(this,function(y){y.id===u.id?y.openAtStart=!y.openAtStart:delete y.openAtStart})),w&&w.widgets&&0<w.widgets.length&&
z.forEach(w.widgets,r.hitch(this,function(y){y.id===u.id?y.openAtStart=!y.openAtStart:delete y.openAtStart})));n.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",k)},_onScreenOrderChanged:function(u){var k=m.reCreateObject(u);z.forEach(this.appConfig.widgetOnScreen.widgets,function(w){w.isController||(!1!==w.inPanel||!0!==w.closeable)&&!0!==w.inPanel&&w.uri||z.some(k,function(y){if(w.id===y.id)return w.position=y.position,!0})},this);n.publish("appConfigChanged",this.getAppConfig(),
"onScreenOrderChange",k)},_onAppAttributeChanged:function(u){u=m.reCreateObject(u);r.mixin(this.appConfig,u);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);n.publish("appConfigChanged",this.getAppConfig(),"attributeChange",u)},_onDataSourceChanged:function(u){var k=m.reCreateObject(u);this.appConfig.dataSource=k;n.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",u)},_onLoadingPageChanged:function(u){u=
m.reCreateObject(u);if("backgroundColor"in u)this.appConfig.loadingPage.backgroundColor=u.backgroundColor;else if("backgroundImage"in u){var k=this.appConfig.loadingPage.backgroundImage||{};this.appConfig.loadingPage.backgroundImage=r.mixin(k,u.backgroundImage)}else"loadingGif"in u&&(k=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=r.mixin(k,u.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);n.publish("appConfigChanged",
this.getAppConfig(),"loadingPageChange",u)},_onAppProxyForMapChanged:function(u){u=m.reCreateObject(u);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==u.mapItemId?this.appConfig.map.appProxy=u:z.forEach(u.proxyItems,r.hitch(this,function(k){if(!z.some(this.appConfig.map.appProxy.proxyItems,function(y){if(y.sourceUrl===k.sourceUrl)return y.useProxy=k.useProxy,y.proxyUrl=k.proxyUrl||"",y.proxyId=k.proxyId||"",isNaN(k.hitsPerInterval)||(y.hitsPerInterval=k.hitsPerInterval),isNaN(k.intervalSeconds)||
(y.intervalSeconds=k.intervalSeconds),!0})&&k.useProxy&&k.proxyUrl){var w=this.appConfig.map.appProxy.proxyItems||[];w.push(k);this.appConfig.map.appProxy.proxyItems=w}})):this.appConfig.map.appProxy=u;n.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",u)},_onAppProxyForUrlChanged:function(u){u=m.reCreateObject(u);this.appConfig.appProxies=u;n.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",u)},_onTemplateConfigChanged:function(u){u=m.reCreateObject(u);this.appConfig.templateConfig=
u;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);n.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",u)},_onMapContentModified:function(){n.publish("mapContentModified")},_onMapChanged:function(u){var k=m.reCreateObject(u);this.appConfig.map.mapOptions&&m.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};r.mixin(this.appConfig.map,k);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);
this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(r.hitch(this,function(w){this.appConfig=w;this._addDefaultValues(this.appConfig);n.publish("appConfigChanged",this.getAppConfig(),"mapChange",k)}))},_deleteDataSourcesFromMap:function(){z.forEach(Object.keys(this.appConfig.dataSource.dataSources),function(u){u.startWith("map")&&delete this.appConfig.dataSource.dataSources[u]},this)},_onMapOptionsChanged:function(u){u=m.reCreateObject(u);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions=
{});r.mixin(this.appConfig.map.mapOptions,u);n.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",u)},_onMapRefreshIntervalChanged:function(u){u=m.reCreateObject(u);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});r.mixin(this.appConfig.map.mapRefreshInterval,u);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;n.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",
u)},_onThemeChanged:function(u){this._getAppConfigFromTheme(u).then(r.hitch(this,function(k){var w=r.clone(this.appConfig.widgetOnScreen);this.appConfig=k;this._handleDataSourceForWidgetsSection(w,{});n.publish("appConfigChanged",this.getAppConfig(),"themeChange",u.getName())}))},_onLayoutChanged:function(u){this.appConfig=m.mixinAppConfigPosition(this.appConfig,u.layoutConfig);this.appConfig.layoutDefinition=u.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
n.publish("appConfigChanged",this.getAppConfig(),"layoutChange",u.name)},_onStyleChanged:function(u){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,u.name);u.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:u.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});n.publish("appConfigChanged",this.getAppConfig(),
"styleChange",u.name)},_onOnScreenGroupsChanged:function(u){u=m.reCreateObject(u);this.appConfig.widgetOnScreen.groups=u.groups;n.publish("appConfigChanged",this.getAppConfig(),"onScreenGroupsChange",u.groups)},_onLayoutDefinitionChanged:function(u){u=m.reCreateObject(u);m.isEqual(this.appConfig.layoutDefinition,u.layoutDefinition)||(this.appConfig.layoutDefinition=u.layoutDefinition,this.appConfig.widgetOnScreen.groups=m.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,u.groupIds),
this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),n.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",u.layoutDefinition))},_onSharedThemeChanged:function(u){var k=this.appConfig.theme.sharedTheme;u=m.reCreateObject(u);u.useHeader&&!k.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},
this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!u.useHeader&&k.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));u.useLogo&&!k.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo&&
this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!u.useLogo&&k.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});r.mixin(k,u);n.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",
u)},_onSyncExtent:function(u){n.publish("syncExtent",u)},_genStyles:function(u,k){var w=[];w.push(k);z.forEach(u,function(y){0>w.indexOf(y)&&w.push(y)});return w},_getAppConfigFromTheme:function(u){var k=new v,w=[],y=this.getAppConfig().getCleanConfig();y.mode=this.urlParams.mode;z.forEach(y.widgetPool.groups,function(G){delete G.panel},this);if(u.appConfig){var C=r.clone(u.appConfig);C.map=y.map;C.map.position=u.appConfig.map.position;this._copyPoolToThemePool(y,C);C.links=y.links;C.title=y.title;
C.subtitle=y.subtitle;C.logo=y.logo}else{var D=u.getCurrentLayout();w=u.getCurrentStyle();C=r.clone(y);D=r.clone(D.layoutConfig);C.widgetOnScreen=D.widgetOnScreen;D.widgetPool&&(z.forEach(D.widgetPool.widgets,function(G){G.isPreconfiguredInTheme=!0}),z.forEach(D.widgetPool.groups,function(G){G.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(y,D);C.widgetPool=D.widgetPool;D.map&&D.map.position&&(C.map.position=D.map.position);C.mobileLayout=D.mobileLayout;C.layoutDefinition=D.layoutDefinition;
w=this._genStyles(z.map(u.getStyles(),function(G){return G.name}),w.name);C.theme={name:u.getName(),styles:w,version:u.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(C.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},C.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(C.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},C.theme.customStyles={mainBackgroundColor:""});C.titleColor=
y.titleColor;C.logoLink=y.logoLink}this.configLoader.addNeedValues(C);this.configLoader.loadWidgetsManifest(C).then(r.hitch(this,function(G){return this.configLoader.loadAndUpgradeAllWidgetsConfig(G)})).then(r.hitch(this,function(){this._addDefaultValues(C);k.resolve(C)}));return k},_copyPoolToThemePool:function(u,k){var w=u.widgetPool;k.widgetPool||(k.widgetPool={});u=k.widgetPool;var y=z.filter(u.widgets,function(H){if(H.isPreconfiguredInTheme||!z.some(w.widgets,function(L){return L.name===H.name}))return!0}),
C=z.filter(u.groups,function(H){return H.isPreconfiguredInTheme}),D=z.filter(w.widgets,function(H){return!H.isPreconfiguredInTheme}),G=z.filter(w.groups,function(H){return!H.isPreconfiguredInTheme});D=this._getPoolWidgetsWithoutDuplicated(D,k.widgetOnScreen.widgets||[]);u.widgets=D.concat(y);u.groups=G.concat(C)},_getPoolWidgetsWithoutDuplicated:function(u,k){for(var w=r.clone(u),y=this.getAppConfig(),C=u.length-1;0<=C;C--)for(var D=k.length-1;0<=D;D--)if(k[D].uri){var G=k[D].name;G||(G=m.getWidgetNameFromUri(k[D].uri));
var H=y.getConfigElementById(u[C].id);u[C]&&u[C].name===G&&!1===H.supportMultiInstance&&(console.log("Widget",u[C].name,"is not copied to new theme because this widget exists in new theme."),w.splice(C,1))}return w},_onAppConfigSet:function(u){u=m.reCreateObject(u);window.appInfo.isRunInMobile=m.inMobileSize();this.configLoader.processProxy(u);this.configLoader.addNeedValues(u);this.configLoader.loadAndUpgradeAllWidgetsConfig(u).then(r.hitch(this,function(k){this._addDefaultValues(k);c.setPortalUrl(k.portalUrl);
window.portalUrl=k.portalUrl;this.appConfig?(m.deleteMapOptions(k.map.mapOptions),this.appConfig=k,this._deleteDataSourcesFromMap(),n.publish("appConfigChanged",this.getAppConfig(),"resetConfig",k)):(this.appConfig=k,d.getPortal(k.portalUrl).loadSelfInfo().then(r.hitch(this,function(w){this.portalSelf=w;n.publish("appConfigLoaded",this.getAppConfig())})))}))},_addDefaultValues:function(u){this._addDefaultPortalUrl(u);this._addDefaultGeometryService(u);this._addDefaultStyle(u);this._addDefaultMap(u);
this._addDefaultVisible(u);this._addDefaultDataSource(u);this._addDefaultSharedTheme(u);"undefined"===typeof u.widgetOnScreen&&(u.widgetOnScreen={});"undefined"===typeof u.widgetPool&&(u.widgetPool={});this._addDefaultPanelAndPosition(u);this._addDefaultOfWidgetGroup(u);(u.widgetPool.widgets&&0<u.widgetPool.widgets.length&&void 0===u.widgetPool.widgets[0].index||u.widgetPool.groups&&0<u.widgetPool.groups.length&&void 0===u.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(u);return u},_addDefaultDataSource:function(u){u.dataSource?
(u.dataSource.dataSources||(u.dataSource.dataSources={}),u.dataSource.settings||(u.dataSource.settings={})):u.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(u){"undefined"===typeof u.portalUrl&&(u.portalUrl="http://www.arcgis.com/");u.portalUrl&&"/"!==u.portalUrl.substr(u.portalUrl.length-1)&&(u.portalUrl+="/")},_addDefaultGeometryService:function(u){var k=u&&u.geometryService;k=k&&"string"===typeof k&&r.trim(k)?r.trim(k):this.portalSelf.helperServices.geometry.url;u.geometryService=
k;a.defaults.geometryService=new g(u.geometryService)},_addDefaultStyle:function(u){!u.theme||u.theme.styles&&0!==u.theme.styles.length||(u.theme.styles=["default"])},_addDefaultMap:function(u){u.map.id="map";"undefined"===typeof u.map["3D"]&&"undefined"===typeof u.map["2D"]&&(u.map["2D"]=!0);"undefined"===typeof u.map.position&&(u.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof u.map.portalUrl&&(u.map.portalUrl=u.portalUrl)},_addDefaultVisible:function(u){m.visitElement(u,function(k){void 0===
k.visible&&(k.visible=!0)})},_addDefaultSharedTheme:function(u){u.theme.sharedTheme?("undefined"===typeof u.theme.sharedTheme.useHeader&&(u.theme.sharedTheme.useHeader=!1),"undefined"===typeof u.theme.sharedTheme.useLogo&&(u.theme.sharedTheme.useLogo=!1)):u.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(u){this._addOnScreenDefaultPanelAndPosition(u);this._addPoolDefaultPanelAndPosition(u)},_addOnScreenDefaultPanelAndPosition:function(u){var k;if(u=u.widgetOnScreen){var w=
u.panel&&u.panel.positionRelativeTo?u.panel.positionRelativeTo:"map";"undefined"===typeof u.panel||"undefined"===typeof u.panel.uri?u.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:w}}:"undefined"===typeof u.panel.position?u.panel.position={relativeTo:w}:"undefined"===typeof u.panel.position.relativeTo&&(u.panel.position.relativeTo=w);if(u.widgets)for(w=0;w<u.widgets.length;w++)u.widgets[w].position||(u.widgets[w].position={}),u.widgets[w].position.relativeTo||(u.widgets[w].position.relativeTo=
u.widgets[w]&&u.widgets[w].positionRelativeTo?u.widgets[w].positionRelativeTo:"map"),!0!==u.widgets[w].inPanel||u.widgets[w].panel||(u.widgets[w].panel=r.clone(u.panel),u.widgets[w].panel.position=u.widgets[w].position,u.widgets[w].panel.position.relativeTo=u.widgets[w].position.relativeTo);if(u.groups)for(w=0;w<u.groups.length;w++)for(u.groups[w].panel||(u.groups[w].panel=u.panel),u.groups[w].panel&&!u.groups[w].panel.position&&(u.groups[w].panel.position={}),u.groups[w].panel.position.relativeTo||
(u.groups[w].panel.position.relativeTo=u.groups[w].panel.positionRelativeTo?u.groups[w].panel.positionRelativeTo:"map"),u.groups[w].widgets||(u.groups[w].widgets=[]),k=0;k<u.groups[w].widgets.length;k++)u.groups[w].widgets[k].panel=u.groups[w].panel}},_addPoolDefaultPanelAndPosition:function(u){var k,w=u.widgetPool;if(w){var y=w.panel&&w.panel.positionRelativeTo?w.panel.positionRelativeTo:"map";"undefined"===typeof w.panel||"undefined"===typeof w.panel.uri?w.panel={uri:"jimu/OnScreenWidgetPanel",
position:{relativeTo:y}}:"undefined"===typeof w.panel.position?w.panel.position={relativeTo:y}:"undefined"===typeof w.panel.position.relativeTo&&(w.panel.position.relativeTo=y);if(w.groups)for(y=0;y<w.groups.length;y++)for(w.groups[y].panel?w.groups[y].panel.position.relativeTo||(w.groups[y].panel.position.relativeTo=w.groups[y].panel.positionRelativeTo?w.groups[y].panel.positionRelativeTo:"map"):w.groups[y].panel=w.panel,w.groups[y].widgets||(w.groups[y].widgets=[]),k=0;k<w.groups[y].widgets.length;k++)w.groups[y].widgets[k].panel=
w.groups[y].panel;if(w.widgets)for(y=0;y<w.widgets.length;y++)!1===w.widgets[y].inPanel?(k=w.widgets[y].positionRelativeTo?w.widgets[y].positionRelativeTo:"map",w.widgets[y].position)?w.widgets[y].position.relativeTo||(w.widgets[y].position.relativeTo=k):w.widgets[y].position={relativeTo:k}:w.widgets[y].panel||(w.widgets[y].panel=u.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(u){m.visitElement(u,r.hitch(this,function(k,w){k.isOnScreen=w.isOnScreen;k.widgets?(k.gid=k.id,1===k.widgets.length?
(k.label||(k.label=k.widgets[0].label?k.widgets[0].label:window.apiNls.common.groupLabel),k.icon||(k.icon=k.widgets[0].uri?this._getDefaultIconFromUri(k.widgets[0].uri):"jimu.js/images/group_icon.png")):(k.icon=k.icon?k.icon:"jimu.js/images/group_icon.png",k.label=k.label?k.label:window.apiNls.common.groupLabel+" "+w.index)):k.gid=w.groupId}))},_getDefaultIconFromUri:function(u){u=u.split("/");u.pop();return u.join("/")+"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(u){var k=
0,w,y;if(u.widgetPool.widgets)for(w=0;w<u.widgetPool.widgets.length;w++)u.widgetPool.widgets[w].index=k,k++;if(u.widgetPool.groups)for(w=0;w<u.widgetPool.groups.length;w++)for(u.widgetPool.groups[w].index=k,k++,y=0;y<u.widgetPool.groups[w].widgets.length;y++)u.widgetPool.groups[w].widgets[y].index=y}});A.getInstance=function(u){null===q?q=new A(u):u&&(q.urlParams=u,q.configLoader&&(q.configLoader.urlParams=u));window.getAppConfig=r.hitch(q,q.getAppConfig);return q};return A})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang moment/moment esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils ./accessibleUtils ./zoomToUtils libs/caja-html-sanitizer-minified".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C,D,G,H,L,T,K,O,I,P,Q,U,Y,ca,da,ma,na){function va(B,E){var J=B.match(/url\([^)]+\)/gi),N;if(null===J||""===E)return B;for(N=0;N<J.length;N++){var S=J[N].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i);if(4<=S.length){var V=S[2];/^data:image\/.*;/.test(V)||(E.endWith("/")||(E+="/"),B=B.replace(S[1]+V+S[3],S[1]+E+V+S[3]))}}return B}function ja(B,E){var J=Array.isArray(E),N=J&&[]||{};J?(B=B||[],N=N.concat(B),E.forEach(function(S,V){"undefined"===typeof B[V]?
N[V]=S:"object"===typeof S?N[V]=ja(B[V],S):-1===B.indexOf(S)&&N.push(S)})):(B&&"object"===typeof B&&Object.keys(B).forEach(function(S){N[S]=B[S]}),Object.keys(E).forEach(function(S){N[S]="object"===typeof E[S]&&E[S]?B[S]?ja(B[S],E[S]):E[S]:E[S]}));return N}function pa(B,E){var J=B.map(function(V){return V.id});r.forEach(E,function(V){0>J.indexOf(V)&&B.push({id:V,widgets:[]})},this);var N=[];B=r.filter(B,function(V){return 0>E.indexOf(V.id)?(N.push(V),!1):!0},this);if(0===B.length)return[];var S=B[B.length-
1];r.forEach(N,function(V){S.widgets=S.widgets.concat(V.widgets)},this);return B=B.sort(function(V,aa){return E.indexOf(V.id)-E.indexOf(aa.id)})}function la(B,E,J){function N(V,aa){return F.isArray(V[aa.key])?V[aa.key][aa.index]:V[aa.key]}E=function(V){var aa=[];V.split("_").forEach(function(fa){var ea=!1;"--"===fa.slice(fa.length-2)&&(ea=!0,fa=fa.slice(0,fa.length-2));var qa=fa.search(/\[[0-9]+\]/);-1===qa&&(qa=fa.length);aa.push({key:fa.slice(0,qa),index:Number(fa.slice(qa+1,-1)),deleteFlag:ea})});
return aa}(E);for(var S=1;S<E.length-1;S++)if(B=N(B,E[S]),!B)return;if(E[E.length-1].deleteFlag)!0===J&&(F.isArray(B[E[E.length-1].key])?delete B[E[E.length-1].key][E[E.length-1].index]:delete B[E[E.length-1].key]);else if(F.isArray(B[E[E.length-1].key])){if(void 0===J)return B[E[E.length-1].key][E[E.length-1].index];B[E[E.length-1].key][E[E.length-1].index]=J}else{if(void 0===J)return B[E[E.length-1].key];B[E[E.length-1].key]=J}}function ra(B,E,J){function N(fa){fa=X.template.getSearchRange(E,fa,
"]");var ea=E.slice(fa.firstPos,fa.lastPos);return-1!==fa.firstPos?(ea=E.slice(fa.firstPos+ea.indexOf("[")+1,fa.lastPos-1),fa=E.slice(fa.lastPos+1),(ea=X.getConfigElementById(B,ea))?{object:ea,key:"section_"+fa,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var S=B,V=E=E.replace(/\//g,"_"),aa=N("groups\\[.+\\]");if("deleted"!==aa.state&&("isSection"===aa.state&&(S=aa.object,V=aa.key),aa=N("widgets\\[.+\\]"),"delete"!==aa.state))return"isSection"===aa.state&&(S=aa.object,V=aa.key),la(S,
V,J)}var X={},ya={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};F.mixin(X,da);F.mixin(X,ma);F.mixin(X,na);window.atob||(window.atob=function(B){B=g.decode(B);for(var E="",J=0,N=B.length;J<N;J++)E+=String.fromCharCode(B[J]);return E});window.btob||(window.btob=function(B){for(var E=[],J=0,N=B.length;J<N;J++)E.push(String.charCodeAt(B[J]));return g.encode(E)});var wa=[];require.on("error",function(B){r.forEach(wa,function(E){B.info[0]&&-1<B.info[0].indexOf(E.resKey)&&
E.def.reject(B);for(var J in B.info)-1<J.indexOf(E.resKey)&&E.def.reject(B)})});X.checkError=function(B,E){wa.push({resKey:B,def:E})};X.replacePlaceHolder=function(B,E){var J=c.stringify(B),N=J.match(/\$\{(\w)+\}/g);if(null===N)return B;for(B=0;B<N.length;B++){var S=N[B].match(/(\w)+/g)[0];E[S]&&(J=J.replace(N[B],E[S]))}return c.parse(J)};X.changeUnit=function(B){var E=Math.abs(B);B=Math.floor(E);var J=Math.floor(60*(E-B));E=(60*(60*(E-B)-J)).toFixed(2);return B+"\u00b0"+(10>J?"0"+J:J)+"'"+(10>E?
"0"+E:E)+'"'};X.formatTime=function(B){var E=B/1E3;B=Math.floor(E/60);E=Number(E-60*B).toFixed(1);return(10>B?"0"+B:B)+":"+(10>E?"0"+E:E)};X.parseTime=function(B){var E=/(\d{2,}):(\d{2})\.(\d{1})/;if(!E.test(B))return console.log("wrong time format."),-1;B=B.match(E);return 1E3*(60*parseInt(B[1],10)+parseInt(B[2],10)+parseInt(B[3],10)/10)};X.preloadImg=function(B,E){var J=[];J="string"===typeof B?[B]:B;r.forEach(J,function(N){(new Image).src=E?E+N:N})};X.setWABLogoDefaultAlt=function(B){if(B){B=t("img",
B);for(var E=["img_1412759111499","img_1545621838463","img_1560482577021"],J=0,N=B.length;J<N;J++){var S=B[J];-1<E.indexOf(z.getAttr(S,"id"))&&!z.getAttr(S,"alt")&&z.setAttr(S,"alt","ArcGIS Web AppBuilder.png")}}};var M=null;X.getImagesSize=function(B){var E=new h;if(!B||0!==B.indexOf("http"))return E.reject(),E;null===M&&(M=z.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var J=e(M,"load",function(){clearTimeout(N);N=null;J.remove();
var S=z.getContentBox(M);1===S.w&&1===S.h||0===S.w||0===S.h?E.reject():E.resolve([S.w,S.h])},{}),N=setTimeout(function(){clearTimeout(N);N=null;E.reject()},5E3);z.setAttr(M,"src",B);return E};X.getPositionStyle=function(B){var E={};if(!B)return E;B=F.clone(B);if(window.isRTL){if("undefined"!==typeof B.left&&"undefined"!==typeof B.right){var J=B.left;B.left=B.right;B.right=J}else"undefined"!==typeof B.left?(B.right=B.left,delete B.left):"undefined"!==typeof B.right&&(B.left=B.right,delete B.right);
"undefined"!==typeof B.paddingLeft&&"undefined"!==typeof B.paddingRight?(J=B.paddingLeft,B.paddingLeft=B.paddingRight,B.paddingRight=J):"undefined"!==typeof B.paddingLeft?(B.paddingRight=B.paddingLeft,delete B.paddingLeft):"undefined"!==typeof B.paddingRight&&(B.paddingLeft=B.paddingRight,delete B.paddingRight);"undefined"!==typeof B.marginLeft&&"undefined"!==typeof B.marginRight?(J=B.marginLeft,B.marginLeft=B.marginRight,B.marginRight=J):"undefined"!==typeof B.marginLeft?(B.marginRight=B.marginLeft,
delete B.marginLeft):"undefined"!==typeof B.marginRight&&(B.marginLeft=B.marginRight,delete B.marginRight)}J="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var N=0;N<J.length;N++){var S=J[N];"number"===typeof B[S]?E[S]=B[S]+"px":"undefined"!==typeof B[S]?E[S]=B[S]:"padding"===S.substr(0,7)||"margin"===S.substr(0,7)?E[S]=0:E[S]="auto"}E.zIndex="undefined"===typeof B.zIndex?"auto":B.zIndex;
return E};X.isEqual=function(B,E){function J(V,aa){var fa;if(null===V&&null===aa||"undefined"===typeof V&&"undefined"===typeof aa)return!0;if(null===V&&null!==aa||null===aa&&null!==V||"undefined"===typeof V&&"undefined"!==typeof aa||"undefined"===typeof aa&&"undefined"!==typeof V)return!1;if(isNaN(V)&&isNaN(aa)&&"number"===typeof V&&"number"===typeof aa||V===aa)return!0;if("function"===typeof V&&"function"===typeof aa||V instanceof Date&&aa instanceof Date||V instanceof RegExp&&aa instanceof RegExp||
V instanceof String&&aa instanceof String||V instanceof Number&&aa instanceof Number)return V.toString()===aa.toString();if(-1<N.indexOf(V)||-1<S.indexOf(aa))return!1;if(null!==aa){for(fa in aa)if(aa.hasOwnProperty(fa)!==V.hasOwnProperty(fa)||typeof aa[fa]!==typeof V[fa])return!1;for(fa in V){if(aa.hasOwnProperty(fa)!==V.hasOwnProperty(fa)||typeof aa[fa]!==typeof V[fa])return!1;switch(typeof V[fa]){case "object":case "function":N.push(V);S.push(aa);if(!J(V[fa],aa[fa]))return!1;N.pop();S.pop();break;
default:if(!(isNaN(V[fa])&&isNaN(aa[fa])&&"number"===typeof V[fa]&&"number"===typeof aa[fa]||V[fa]===aa[fa]))return!1}}}return!0}var N=[];var S=[];return J(B,E)?!0:!1};X.file={loadFileAPI:function(){var B=new h;B.resolve();return B},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return x("safari")&&6>x("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var B=null;if(document.all)try{B=
new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(E){B=null}else navigator.plugins&&0<navigator.plugins.length&&(B=navigator.plugins["Shockwave Flash"]);return!!B},containSeparator:function(B){return 0<=B.indexOf("/")?!0:0<=B.indexOf("\\")?!0:!1},getNameFromPath:function(B){var E="";E=0<=B.indexOf("/")?"/":"\\";B=B.split(E);return 0<B.length?B[B.length-1]:null},getFolderFromPath:function(B){return B.substr(0,B.length-X.file.getNameFromPath(B).length)},readFile:function(B,E,J,N){if(this.supportHTML5()){var S=
B.target.files[0];S&&(S.type.match(E)?S.size>=J?N({errCode:"exceed"}):(B=new FileReader,B.onload=function(aa){N(null,S.name,aa.target.result)},B.readAsDataURL(S)):N({errCode:"invalidType"}))}else if(this.supportFileAPI()){var V=window.FileAPI.getFiles(B);V[0].type.match(E)?V[0].size>=J?N({errCode:"exceed"}):window.FileAPI.readAsDataURL(V[0],function(aa){aa&&aa.result?N(null,V[0].name,aa.result):N({errCode:"readError"})}):N({errCode:"invalidType"})}}};X.getUriInfo=function(B){var E={};var J=B.indexOf("/");
B.substring(0,J);J=B.substring(0,B.lastIndexOf("/")+1);E.folderUrl=require(X.getRequireConfig()).toUrl(J);E.amdFolder=J;E.url=E.folderUrl;if(/^http(s)?:\/\//.test(B)||/^\/\//.test(B))E.isRemote=!0;return E};X.widgetJson=function(){var B={addManifest2WidgetJson:function(E,J){F.mixin(E,J.properties);E.name=J.name;E.label||(E.label=J.label);E.manifest=J;E.isRemote=J.isRemote;E.isRemote&&(E.itemId=J.itemId);J.featureActions&&(E.featureActions=J.featureActions);E.icon||(E.icon=J.icon);E.thumbnail||(E.thumbnail=
J.thumbnail);E.folderUrl=J.folderUrl;E.amdFolder=J.amdFolder},removeManifestFromWidgetJson:function(E){if(E.manifest){for(var J in E.manifest.properties)E[J]=void 0;E.name=void 0;E.label=void 0;E.featureActions=void 0;E.manifest=void 0}},getUriFromItem:function(E){return E.url?B.getFolderUrlFromItem(E)+"Widget":null},getFolderUrlFromItem:function(E){if(!E.url)return null;E=/manifest\.json$/.test(E.url)?E.url.substring(0,E.url.length-13):/\/$/.test(E.url)?E.url:E.url+"/";"https:"===window.location.protocol&&
(E=E.replace(/^http:\/\//,"https://"));return E}};return B}();X.getRequireConfig=function(){if(jimuConfig){var B=[];jimuConfig.widgetsPackage&&(B=B.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(B=B.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(B=B.concat(jimuConfig.configsPackage));return{packages:B}}return{}};X.getTypeByGeometryType=function(B){var E="",J="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
N=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(B)?E="point":0<=J.indexOf(B)?E="polyline":0<=N.indexOf(B)&&(E="polygon");return E};X.getSymbolTypeByGeometryType=function(B){var E=null;B=X.getTypeByGeometryType(B);"point"===B?E="marker":"polyline"===B?E="line":"polygon"===B&&(E="fill");return E};X.getServices=function(){return ya};X.getArcGISDefaultGeometryService=function(){return new L(ya.geometryService)};X.restoreToDefaultWebMapExtent=
function(B,E,J){var N=new h;if(!B||"esri.Map"!==B.declaredClass)return setTimeout(function(){N.reject("Invalid map.")},0),N;E=E&&E.itemInfo;if(!E)return setTimeout(function(){N.reject("Invalid itemInfo")},0),N;E=E.item&&E.item.extent;if(!E)return setTimeout(function(){N.reject("Invalid itemInfo.item.extent")}),N;var S=new k({wkid:4326});S=new w(E[0][0],E[0][1],E[1][0],E[1][1],S);if(4326===parseInt(B.spatialReference.wkid,10))return B.setExtent(S);if(B.spatialReference.isWebMercator())return S=H.geographicToWebMercator(S),
B.setExtent(S);E=new T;E.geometries=[S];E.outSR=B.spatialReference;S=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;S&&"esri.tasks.GeometryService"===S.declaredClass||(J&&"string"===typeof J&&F.trim(J)?(J=F.trim(J),S=new L(J)):S=X.getArcGISDefaultGeometryService());S.project(E).then(function(V){if(V=V&&V[0])return B.setExtent(V);N.reject("Invalid projected geometry.");return N},function(V){console.error(V);N.reject(V);return N});return N};X.getAncestorWindow=function(){for(var B=
window;B&&B.parent&&B!==B.parent;)B=B.parent;return B};X.getAncestorDom=function(B,E,J){if(B&&1===B.nodeType&&E&&"function"===typeof E){var N=100,S=document.body;J&&("number"===typeof J?(J=parseInt(J,10),0<J&&(N=J)):1===J.nodeType&&(S=J));for(J=0;B.parentNode&&J<N&&z.isDescendant(B.parentNode,S);){if(E(B.parentNode))return B.parentNode;B=B.parentNode;J++}}return null};X.bindClickAndDblclickEvents=function(B,E,J,N){var S=null;if(B&&1===B.nodeType&&E&&"function"===typeof E&&J&&"function"===typeof J){var V=
200;N&&"number"===typeof N&&(N=parseInt(N,10),0<N&&(V=N));var aa=0;S=e(B,"click",function(fa){aa++;1===aa?setTimeout(function(){1===aa&&(aa=0,E(fa))},V):2===aa&&(aa=0,J(fa))})}return S};X.isScrollToBottom=function(B){var E=z.getContentBox(B);return 1>B.scrollHeight-(B.scrollTop+E.h)};X.getAllItemTypes=function(){var B=[];B=B.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return B=B.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};X.getItemQueryStringByTypes=function(B){var E="",J=X.getAllItemTypes();if(B&&0<B.length&&0<B.length){var N="";r.forEach(B,function(S,V){N+=' type:"'+S+'" ';V!==B.length-1&&(N+=" OR ")});E=" ( "+N+" ) ";J=B.concat(J);J=r.filter(J,function(S){return r.every(B,
function(V){return 0>V.toLowerCase().indexOf(S.toLowerCase())})});r.forEach(J,function(S){E+=' -type:"'+S+'" '})}return E};X.getItemQueryStringByTypeKeywords=function(B){var E="";B&&0<B.length&&(E=' typekeywords:"'+B.join(",")+'" ');return E};X.isNotEmptyString=function(B,E){var J=B&&"string"===typeof B;return J?E?J&&F.trim(B):!0:!1};X.isNotEmptyStringArray=function(B,E){for(var J=0;J<B.length;J++){var N=B[J];if(!X.isNotEmptyString(N.value?N.value:N,E))return!1}return!0};X.isValidNumber=function(B){return"number"===
typeof B&&!isNaN(B)};X.isValidNumberArray=function(B){for(var E=0;E<B.length;E++){var J=B[E];J=J.value||0===J.value?J.value:J;if(!X.isValidNumber(J))return!1}return!0};X.isValidDate=function(B){if(B)try{var E=X.getDateByDateTimeStr(B);return!isNaN(E.getTime())}catch(J){return console.error(J),!1}else return!1};X.isObject=function(B){return B&&"object"===typeof B};X.createWebMap=function(B,E,J,N){B=ca.getStandardPortalUrl(B);B=ca.getBaseItemUrl(B);A.arcgisUrl=B;return A.createMap(E,J,N)};X.getRandomString=
function(){var B=Math.random().toString();return B=B.slice(2,B.length)};X._getDomainsByServerName=function(B){var E=B.split("."),J=E.length;return r.map(E,F.hitch(this,function(N,S){N=E.slice(S,J);var V="",aa=N.length-1;r.forEach(N,F.hitch(this,function(fa,ea){V+=fa;ea!==aa&&(V+=".")}));return V}))};X.removeCookie=function(B,E){var J=this._getDomainsByServerName(window.location.hostname);r.forEach(J,F.hitch(this,function(N){f(B,null,{expires:-1,path:E});f(B,null,{expires:-1,path:E,domain:N});f(B,
null,{expires:-1,path:E,domain:"."+N})}))};X.isLocaleChanged=function(B,E){return!B.startWith(E)};X.hashToObject=function(B){B=B.replace("#","");B=v.queryToObject(B);for(var E in B)if(B.hasOwnProperty(E))try{B[E]=c.parse(B[E])}catch(J){}return B};X.reCreateObject=function(B){function E(N){var S=[];N.forEach(function(V){Array.isArray(V)?S.push(E(V)):"object"===typeof V?S.push(J(V)):S.push(V)});return S}function J(N){var S={},V;for(V in N)N.hasOwnProperty(V)&&(null===N[V]?S[V]=null:Array.isArray(N[V])?
S[V]=E(N[V]):S[V]="object"===typeof N[V]?J(N[V]):N[V]);return S}return Array.isArray(B)?E(B):J(B)};X.setVerticalCenter=function(B){setTimeout(function(){var E=t(".jimu-vcenter-text",B),J,N;r.forEach(E,function(S){J=z.getContentBox(S).h;z.setStyle(S,{lineHeight:J+"px"})},this);E=t(".jimu-vcenter",B);r.forEach(E,function(S){J=z.getContentBox(S).h;N=z.getContentBox(t(S).parent()[0]).h;z.setStyle(S,{marginTop:(N-J)/2+"px"})},this)},10)};X.merge=ja;X.loadStyleLink=function(B,E,J){var N=new h,S=require(X.getRequireConfig()).toUrl(E);
if(require.cache["url:"+S]){var V=require.cache["url:"+S];var aa=S.split("/").pop();S=S.substr(0,S.length-aa.length);V=va(V,S);B=J?z.create("style",{id:B,type:"text/css"},z.byId(J),"before"):z.create("style",{id:B,type:"text/css"},document.getElementsByTagName("head")[0]);B.styleSheet&&!B.sheet?B.styleSheet.cssText=V:B.appendChild(z.toDom(V));N.resolve("load");return N}V=J?z.create("link",{id:B,rel:"stylesheet",type:"text/css",href:S+"?wab_dv\x3d"+window.deployVersion},z.byId(J),"before"):z.create("link",
{id:B,rel:"stylesheet",type:"text/css",href:S+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);e(V,"load",function(){N.resolve("load")});var fa=setInterval(function(){var ea;if(r.some(document.styleSheets,function(qa){if(qa.href&&qa.href.substr(qa.href.indexOf(E),qa.href.length)===E)return ea=qa,!0}))try{!N.isFulfilled()&&(ea.cssRules&&ea.cssRules.length||ea.rules&&ea.rules.length)&&N.resolve("load"),clearInterval(fa)}catch(qa){}},50);return N};X.changeLocation=function(B){window.history.pushState&&
window.history.pushState({path:B},"",encodeURI(B))};X.urlToObject=function(B){var E=null;-1===B.indexOf("#")?(E=I.urlToObject(B),E.hash=null):(B=B.split("#"),E=I.urlToObject(B[0]),E.hash=B[1]?-1<B[1].indexOf("\x3d")?v.queryToObject(B[1]):B[1]:null);return E};X.manifest=function(){function B(E){E.panels.forEach(function(J){J.uri="panels/"+J.name+"/Panel.js"});E.styles.forEach(function(J){J.uri="styles/"+J.name+"/style.css"});E.layouts.forEach(function(J){J.uri="layouts/"+J.name+"/config.json";J.icon=
"layouts/"+J.name+"/icon.png";J.RTLIcon="layouts/"+J.name+"/icon_rtl.png"})}return{addManifestProperies:function(E){E.icon||(E.icon=E.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);E.thumbnail||(E.thumbnail=E.folderUrl+"images/thumbnail.png");"theme"===E.category?B(E):("undefined"!==typeof E["2D"]&&(E.support2D=E["2D"]),"undefined"!==typeof E["3D"]&&(E.support3D=E["3D"]),"undefined"===typeof E["2D"]&&"undefined"===typeof E["3D"]&&(E.support2D=!0),delete E["2D"],delete E["3D"],"undefined"===
typeof E.properties&&(E.properties={}),da.processWidgetProperties(E))},processManifestLabel:function(E,J){var N=J.split("-")[0];E.label=E.i18nLabels&&(E.i18nLabels[J]||E.i18nLabels[N]||E.i18nLabels.defaultLabel)||E.label||E.name;E.layouts&&r.forEach(E.layouts,function(S){var V="i18nLabels_layout_"+S.name;S.label=E[V]&&(E[V][J]||E[V].defaultLabel)||S.label||S.name});E.styles&&r.forEach(E.styles,function(S){var V="i18nLabels_style_"+S.name;S.label=E[V]&&(E[V][J]||E[V].defaultLabel)||S.label||S.name})},
addI18NLabel:function(E){var J=new h;if(E.i18nLabels)return J.resolve(E),J;E.i18nLabels={};if(E.properties&&!1===E.properties.hasLocale)return J.resolve(E),J;var N=E.isRemote?E.amdFolder+"nls/strings.js":E.amdFolder+"nls/strings";require(X.getRequireConfig(),["dojo/i18n!"+N],function(S){var V={};V[dojoConfig.locale]=S;da.addI18NLabelToManifest(E,null,V);J.resolve(E)});return J}}}();X.isNumberField=function(B){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(B)};X.getTime=function(B){var E=B.getTimezoneOffset();E=0>E?"+"+Math.abs(E)/60:"-"+E/60;return B.getTime()+36E5*E};X.getUniqueValues=function(B,E,J,N,S){return function(){var V=new h,aa={};N?(aa.layerDefinition=N,S&&(aa.fieldPopupInfo=S),V.resolve(aa)):V=P({url:B,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(fa){aa.layerDefinition=fa;return aa},function(fa){console.log("Error: ",fa.message)});return V}().then(function(V){return X._getUniqueValues(B,
E,J,V.layerDefinition).then(function(aa){return X._getValues(V.layerDefinition,V.fieldPopupInfo,E,aa)})})};X._getValues=function(B,E,J,N){var S=[];S=X.getFieldInfoByFieldName(B.fields,J);var V=null,aa=X.isNumberField(S.type),fa="esriFieldTypeDate"===S.type?!0:!1;if(S){if(aa)N=r.map(N,function(ea){ea=parseFloat(ea);isNaN(ea)&&(ea=null);return ea});else if(fa)return S=r.map(N,F.hitch(this,function(ea){var qa=ea,ka=ea;X.isValidDate(ea)&&(qa=X.getDateTimeStrByFieldInfo(ea,E),ka=X.localizeDateByFieldInfo(ea,
E));return{value:qa,label:ka}}));B=X.getCodedValueListForCodedValueOrSubTypes(B,J);if(null!==B)for(V={},J=0;J<B.length;J++)V[B[J].value]=B[J].label}return S=r.map(N,function(ea){var qa=null;qa=null===ea||void 0===ea?"\x3cNull\x3e":V&&V.hasOwnProperty(ea)?V[ea]:aa?E?X.localizeNumberByFieldInfo(ea,E):X.localizeNumber(ea):fa?X.localizeDateByFieldInfo(new Date(ea),E):ea;return{value:ea,label:qa}})};X._getUniqueValues=function(B,E,J,N){var S=new h;B=B.replace(/\/*$/g,"");J||(J="1\x3d1");S=/\/ImageServer$/gi.test(B);
var V=-1<B.indexOf("MapServer/dynamicLayer");S||V?S=X._getUniqueValuesByQueryTask(B,E,J):(S=X.getFieldInfoByFieldName(N.fields,E),S=0<X.getCodedValuesOrTypesCount(S,N)?X._getUniqueValuesByQueryTask(B,E,J):X._getUniqueValuesByGenerateRenderer(B,E,J));return S};X.getCodedValuesOrTypesCount=function(B,E){return B?E.typeIdField&&E.typeIdField.toUpperCase()===B.name.toUpperCase()&&E.types?E.types.length:(B=X._getAllCodedValue(E,B))?B.length:0:0};X._getUniqueValuesByQueryTask=function(B,E,J){var N=new Q;
N.where=J;N.returnDistinctValues=!0;N.returnGeometry=!1;N.outFields=[E];return(new U(B)).execute(N).then(function(S){var V=[];S.features&&0<S.features.length&&r.forEach(S.features,function(aa){aa&&aa.attributes&&V.push(aa.attributes[E])});return V})};X._getUniqueValuesByGenerateRenderer=function(B,E,J){var N=new h,S=B.split("?");B=1<S.length?S[0].replace(/\/*$/g,"")+"/generateRenderer?"+S[1]:B.replace(/\/*$/g,"")+"/generateRenderer";E=c.stringify({type:"uniqueValueDef",uniqueValueFields:[E]});P({url:B,
content:{classificationDef:E,f:"json",where:J},handleAs:"json",callbackParamName:"callback"}).then(F.hitch(this,function(V){var aa=[];(V=V&&V.uniqueValueInfos)&&0<V.length&&(aa=r.map(V,F.hitch(this,function(fa){return fa.value})));N.resolve(aa)}),F.hitch(this,function(V){N.reject(V)}));return N};X.isCodedValuesSupportFilter=function(B,E){B=B.currentVersion?B:B.toJson().layerDefinition;var J=parseFloat(B.currentVersion);return E<=parseFloat(B.maxRecordCount)&&10.1<J};X.combineRadioCheckBoxWithLabel=
function(B,E){var J=!1;if(B&&1===B.nodeType&&"input"===B.tagName.toLowerCase()){var N=B.getAttribute("type")||"";N=N.toLowerCase();if("radio"===N||"checkbox"===N)J=!0}N=!1;E&&1===E.nodeType&&"label"===E.tagName.toLowerCase()&&(N=!0);J&&N&&(J=B.getAttribute("id"),J||(J="input_"+X.getRandomString(),B.setAttribute("id",J)),E.setAttribute("for",J),z.setStyle(E,"cursor","pointer"))};X.groupRadios=function(B,E){var J=[],N="radiogroup_"+X.getRandomString();r.forEach(B,function(S){S.name=N;E&&(S=e(S,"change",
E),J.push(S))});return J};X.convertExtentToPolygon=function(B){var E=B.xmin,J=B.xmax,N=B.ymin,S=B.ymax;return new G({rings:[[[E,S],[J,S],[J,N],[E,N],[E,S]]],spatialReference:B.toJson()})};X.combineGeometries=function(B){function E(ka){var R={points:[],spatialReference:ka[0].spatialReference.toJson()};r.forEach(ka,function(Z){"point"===Z.type?R.points=R.points.concat([[Z.x,Z.y]]):"multipoint"===Z.type&&(R.points=R.points.concat(Z.points))});return new C(R)}function J(ka){var R={paths:[],spatialReference:ka[0].spatialReference.toJson()};
r.forEach(ka,function(Z){R.paths=R.paths.concat(Z.paths)});return new D(R)}function N(ka){var R={rings:[],spatialReference:ka[0].spatialReference.toJson()};r.forEach(ka,function(Z){"polygon"===Z.type?R.rings=R.rings.concat(Z.rings):"extent"===Z.type&&(Z=X.convertExtentToPolygon(Z),R.rings=R.rings.concat(Z.rings))});return new G(R)}var S=null;if(B&&0<B.length)if(1===B.length)S=B[0];else{for(var V=null,aa=null,fa=null,ea=null,qa=0;qa<B.length;qa++){V=B[qa];switch(V.type){case "point":case "multipoint":ea=
"point";break;case "polyline":ea="polyline";break;case "polygon":case "extent":ea="polygon";break;default:return null}if(0===qa)fa=ea;else if(fa!==ea)return null;if(qa!==B.length-1&&(aa=B[qa+1],!V.spatialReference.equals(aa.spatialReference)))return null}"point"===ea?S=E(B):"polyline"===ea?S=J(B):"polygon"===ea&&(S=N(B))}return S};X.combineGeometriesByGraphics=function(B){var E=null;B&&0<B.length&&(B=r.map(B,function(J){return J.geometry}),E=X.combineGeometries(B));return E};X.isFeaturelayerUrlSupportQuery=
function(B,E){var J=!1,N=/\/featureserver\//gi.test(B);B=/\/mapserver\//gi.test(B);E=(E||"").toLowerCase();N?J=0<=E.indexOf("query"):B&&(J=0<=E.indexOf("data"));return J};X.isImageServiceSupportQuery=function(B){return 0<=(B||"").toLowerCase().indexOf("catalog")};X.isStringEndWith=function(B,E){return B.lastIndexOf(E)+E.length===B.length};X._localizeNumber=function(B,E){var J=(B.toString().split(".")[1]||"").length,N="";N=E&&isFinite(E.places)&&E.places;N=0<N||0<J?"#,###,###,##0.0"+Array.prototype.join.call({length:0<
N?N+1:J},"0"):"#,###,###,##0";J={locale:E&&E.locale||n.locale,pattern:N};F.mixin(J,E||{});try{return b.format(B,J)}catch(S){return console.error(S),B.toLocaleString()}};X.localizeNumber=function(B,E){if(!X.isNumberOrNumberString(B))return B;B=Number(B);var J=!1;0>B&&(J=!0,B=Math.abs(B));B=X._localizeNumber(B,E);J&&(B=window.isRTL?B+"-":"-"+B);return B};X.isLocalizedNumber=function(B){B=b.parse(B,{locale:n.locale});return isNaN(B)?!1:!isNaN(parseFloat(B))};X.parseNumberToUSENFormat=function(B){var E=
b.parse(B,{locale:n.locale});return isNaN(E)?parseFloat(l.isDefined(B)&&B.replace?B.replace(",","."):B):E};X.parseNumber=function(B,E){var J={locale:n.locale};F.mixin(J,E||{});try{return b.parse(B,J)}catch(N){return console.error(N),B}};X.localizeDate=function(B,E){var J={locale:n.locale,fullYear:!0};F.mixin(J,E||{});"ar"===n.locale&&"long"!==J.formatLength&&"full"!==J.formatLength&&(J.formatLength="long");try{return d.format(B,J)}catch(N){return console.error(N),"date"===J.selector?B.toLocaleDateString():
"time"===J.selector?B.toLocaleTimeString():B.toLocaleString()}};X.localizeNumberByFieldInfo=function(B,E){var J=null;J=F.exists("format.places",E)&&E.format.places;J=X.localizeNumber(B,{places:J});return F.exists("format.digitSeparator",E)&&!E.format.digitSeparator?J.toString().replace(new RegExp("\\"+a.group,"g"),""):J};X.localizeDateByFieldInfo=function(B,E){var J=null;try{var N={date:B instanceof Date?B.getTime():B},S=F.exists("format.dateFormat",E)?E.format.dateFormat:"longMonthDayYear";J=l.substitute(N,
"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+u.prototype._dateFormats[S]}})}catch(V){console.error(V),J=B}return J};X.getDatePatternsByFormat=function(B){return u.prototype._dateFormatsJson[B]};X.localizeDateTimeByFieldInfo=function(B,E,J,N){var S={h:"h",m:"h:mm",s:"h:mm:ss"},V={h:"H",m:"H:mm",s:"H:mm:ss"},aa=function(Z,W,ba){Z=X.getDatePatternsByFormat(Z).datePattern;var ha=S[W];ha=ba||"h"===W?S[W]+" a":V[W];return"(datePattern: '"+Z+"', timePattern: '"+ha+"', selector: 'date and time')"},
fa,ea,qa=null;try{var ka={date:B instanceof Date?B.getTime():B};if(F.exists("format.dateFormat",E)){var R=E.format.dateFormat;J?ea=0<R.indexOf("Time")?aa(R,N,0>R.indexOf("24")):aa(R,N):fa=R.split("ShortTime")[0].split("LongTime")[0]}else J?ea=aa("longMonthDayYear",N):fa="longMonthDayYear";ea=ea?ea:u.prototype._dateFormats[fa];qa=l.substitute(ka,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+ea}})}catch(Z){console.error(Z),qa=B}return qa};X.getDateTimeStr=function(B,E){E=E?"YYYY-MM-DD HH:mm:ss":
"YYYY-MM-DD";return q(B).format(E)};X.getDateByDateTimeStr=function(B){return q(B).toDate()};X.getDateByDateTimeStrAndFormat=function(B,E){B=X.getDateByDateTimeStr(B);F.exists("format.dateFormat",E)&&(E=E.format.dateFormat,0<=E.indexOf("ShortTime")?B.setSeconds(0):0>E.indexOf("Time")&&(B.setHours(0),B.setMinutes(0),B.setSeconds(0)));return B};X.getDateTimeStrByFieldInfo=function(B,E){var J="YYYY-MM-DD";F.exists("format.dateFormat",E)&&(E=E.format.dateFormat,0<=E.indexOf("LongTime")?J+=" HH:mm:ss":
0<=E.indexOf("ShortTime")&&(J+=" HH:mm"));return q(B).format(J)};X.fieldFormatter={getFormattedUrl:function(B){if(B&&"string"===typeof B){var E=B.indexOf("http:");-1===E&&(E=B.indexOf("https:"));if(-1<E&&-1===B.indexOf("href\x3d")){var J=B.indexOf(" ",E);-1===J&&(J=B.length);var N=-1<B.indexOf("\r\n",E)?B.indexOf("\r\n",E):-1<B.indexOf("\n",E)?B.indexOf("\n",E):J;J=N<J?N:J;N=B.substring(E,J);B=B.substring(0,E)+'\x3cA href\x3d"'+N+'" target\x3d"_blank"\x3e'+N+"\x3c/A\x3e"+B.substring(J,B.length)}}return null===
B?"":B},getFormattedNumber:function(B,E){if("number"===typeof B){var J=(B.toString().split(".")[1]||"").length;B=X.localizeNumberByFieldInfo(B,{format:{places:E&&"number"===typeof E.places?parseInt(E.places,10):J,digitSeparator:E&&E.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(B||"")+"\x3c/span\x3e"}return B},getFormattedDate:function(B,E){if("number"===typeof B||B instanceof Date)B=X.localizeDateByFieldInfo(B,{format:E});return B||""},getCodedValue:function(B,E){if(B&&B.codedValues){for(var J=
0,N=B.codedValues.length;J<N;J++){var S=B.codedValues[J];if(l.isDefined(E)&&F.exists("code",S)&&E.toString()===S.code.toString())return S.name}return E}return E||null},getTypeName:function(B,E){for(var J=E.length,N=0;N<J;N++)if(B===E[N].id)return E[N].name;return B}};X.addRelativePathInCss=va;X.url={isAbsolute:function(B){return B?B.startWith("http")||B.startWith("/"):!1},removeQueryParamFromUrl:function(B,E){B=I.urlToObject(B);B.query&&delete B.query[E];E=B.path;for(var J in B.query)E=E===B.path?
E+"?"+J+"\x3d"+B.query[J]:E+"\x26"+J+"\x3d"+B.query[J];return E},addQueryParamToUrl:function(B,E,J){B=I.urlToObject(B);B.query||(B.query={});B.query[E]=J;E=B.path;for(var N in B.query)E=E===B.path?E+"?"+N+"\x3d"+B.query[N]:E+"\x26"+N+"\x3d"+B.query[N];return E},compareUrl:function(B,E){B=this.getUrlPath(B);E=this.getUrlPath(E);B=ca.removeProtocol(B.toString().toLowerCase()).replace(/\/+/g,"/");E=ca.removeProtocol(E.toString().toLowerCase()).replace(/\/+/g,"/");return B===E},getUrlPath:function(B){return I.urlToObject(B).path}};
X.processUrlInWidgetConfig=function(B,E){if(B)return B.startWith("data:")||B.startWith("http")||B.startWith("/")?B:B.startWith("${appPath}")?B.replace("${appPath}",window.appInfo.appPath):E+B};X.processUrlInAppConfig=function(B){if(B)return B.startWith("data:")||B.startWith("http")||B.startWith("/")?B:window.appInfo.appPath+B};X.getLocationUrlWithoutHashAndQueryParams=function(){var B=window.location,E=B.protocol+"//"+B.host+B.pathname;B=I.urlToObject(B.href);B.query&&B.query.apiurl&&(E=X.url.addQueryParamToUrl(E,
"apiurl",B.query.apiurl));return E};X.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};X.invertColor=function(B){B=B.substring(1);3===B.length&&(B=B.slice(0,1)+B.slice(0,1)+B.slice(1,1)+B.slice(1,1)+B.slice(2,1)+B.slice(2,1));B=parseInt(B,16);return 7829367<B?"#000000":"#ffffff"};X.isLightColor=function(B){B=B.substring(1);3===B.length&&(B=B.slice(0,1)+B.slice(0,1)+B.slice(1,1)+B.slice(1,1)+B.slice(2,1)+B.slice(2,1));B=parseInt(B,16);return 7829367<B?!0:!1};X.mixinAppConfigPosition=
function(B,E){var J=F.clone(B);if(!E)return J;E=F.clone(E);var N=J.widgetOnScreen,S=E.widgetOnScreen;S&&S.widgets&&("[object Object]"===Object.prototype.toString.call(S.widgets)?r.forEach(N.widgets,function(V,aa){aa=V.uri?V.uri:"ph_"+aa;S.widgets[aa]&&S.widgets[aa].position&&(S.widgets[aa].position.relativeTo||(S.widgets[aa].position.relativeTo="map"),V.position=S.widgets[aa].position)},this):r.forEach(S.widgets,function(V,aa){V.position&&!V.position.relativeTo&&(V.position.relativeTo="map");N.widgets[aa]&&
V.position&&(N.widgets[aa].position=V.position)}));S&&S.groups&&("[object Object]"===Object.prototype.toString.call(S.groups)?r.forEach(N.groups,function(V,aa){aa=V.label?V.label:"g_"+aa;S.groups[aa]&&S.groups[aa].panel&&S.groups[aa].panel.position&&(S.groups[aa].panel.position.relativeTo||(S.groups[aa].panel.position.relativeTo="map"),V.panel.position=S.groups[aa].panel.position)},this):(B=B.layoutDefinition?B.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===
B?r.forEach(S.groups,function(V,aa){V.panel&&V.panel.position&&!V.panel.position.relativeTo&&(V.panel.position.relativeTo="map");N.groups[aa]&&V.panel&&V.panel.position&&(N.groups[aa].panel.position=V.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===B&&(N.groups=pa(N.groups,S.groups.map(function(V){return V.id})))));E.map&&E.map.position&&(J.map?J.map.position=E.map.position:J.map={position:E.map.position});E.widgetPool&&E.widgetPool.panel&&(E.widgetPool.panel.position&&!E.widgetPool.panel.position.relativeTo&&
(E.widgetPool.panel.position.relativeTo="map"),J.widgetPool.panel.position=E.widgetPool.panel.position);E.mobileLayout&&(J.mobileLayout=E.mobileLayout);return J};X.handleGridLayoutOnScreenGroupChange=pa;X.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(B,E,J){var N=-1;E=B.search(new RegExp(E));0<=E&&(B=B.slice(E,B.length),B=B.indexOf(J),N=E+B+J.length);return{firstPos:E,lastPos:N}},setConfigValue:function(B,E,J){la(B,E,J)},getConfigValue:function(B,
E){return la(B,E)},setConfigValueWithId:function(B,E,J){ra(B,E,J)},getConfigValueWithId:function(B,E){return ra(B,E)},getKeyInfo:function(B){var E=this.getWidgetIdByKey(B);if(null!==E)return{type:"widget",id:E};B=this.getGroupIdByKey(B);return null!==B?{type:"group",id:B}:{type:"unknow",id:null}},getWidgetIdByKey:function(B){var E=X.template.getSearchRange(B,X.template.widgetIdentification,"]");if(-1===E.firstPos)B=null;else{var J=B.slice(E.firstPos,E.lastPos);B=B.slice(E.firstPos+J.indexOf("[")+
1,E.lastPos-1)}return B},getGroupIdByKey:function(B){var E=X.template.getSearchRange(B,X.template.groupIdentification,"]");if(-1===E.firstPos)B=null;else{var J=B.slice(E.firstPos,E.lastPos);B=B.slice(E.firstPos+J.indexOf("[")+1,E.lastPos-1)}return B},getConfigedWidgetsByTemplateConfig:function(B){var E=[],J=X.template.widgetIdentification+"_config",N;r.forEach(B.configurationSettings,function(S){r.forEach(S.fields,function(V){V.fieldName&&(N=X.template.getSearchRange(V.fieldName,J,"]"),0<=N.firstPos&&
(V=X.template.getWidgetIdByKey(V.fieldName),-1===E.indexOf(V)&&E.push(V)))},this)},this);return E},mergeTemplateAppConfigToAppConfig:function(B,E,J){function N(fa){var ea=[];r.forEach(fa,function(qa){qa&&ea.push(qa)},this);return ea}var S=B.widgetOnScreen,V=B.portalUrl;E.values.webmap&&(B.map.itemId=E.values.webmap);J&&(B.map.mapOptions&&X.deleteMapOptions(B.map.mapOptions),B.map.portalUrl=V,E.values.app_title||(E.values.app_title=J.title),E.values.app_subtitle||(E.values.app_subtitle=J.snippet));
for(var aa in E.values)"webmap"!==aa&&X.template.setConfigValueWithId(B,aa,E.values[aa]);B.widgetPool.widgets=N(B.widgetPool.widgets);S.widgets=N(S.widgets);if(B.widgetPool.groups)for(E=0;E<B.widgetPool.groups.length;E++)B.widgetPool.groups[E].widgets=N(B.widgetPool.groups[E].widgets);if(S.groups)for(E=0;E<S.groups.length;E++)S.groups[E].widgets=N(S.groups[E].widgets);return B}};X.deleteMapOptions=function(B){B&&(delete B.extent,delete B.lods,delete B.center,delete B.scale,delete B.zoom,delete B.maxScale,
delete B.maxZoom,delete B.minScale,delete B.minZoom)};X.sanitizeHTML=function(B){return B?html_sanitize(B,function(E){return E},function(E){return E}):B};X.stripHTML=function(B){return B?-1<B.indexOf("\x3c")&&-1<B.indexOf("\x3e")?B.replace(/<(?:.|\s)*?>/g,""):B:B};X.encodeHTML=function(B){return String(B).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};X.removeSuffixSlashes=function(B){return B.replace(/\/*$/g,"")};X.getBestDisplayAttributes=
function(B,E){var J={},N=null,S;for(S in B)N=X.getBestDisplayValue(S,B,E),J[S]=N;return J};X.getBestDisplayValue=function(B,E,J){var N="",S=null;F.isArrayLike(J)?S=X.getFieldInfoByFieldName(J,B):"object"===typeof J&&J.name===B&&(S=J);S&&(N=E[B],"esriFieldTypeDate"===S.type?N&&(B=new Date(parseInt(N,10)),N=X._tryLocaleDate(B)):"number"===typeof N&&(S.domain&&"codedValue"===S.domain.type?r.some(S.domain.codedValues,function(V){if(V.code===N)return N=V.name,!0}):N=X._tryLocaleNumber(N)));if(null===N||
void 0===N)N="";return N};X._getCodedValues=function(B){var E=null;(B=B.domain)&&"codedValue"===B.type&&B.codedValues&&0<B.codedValues.length&&(E=B.codedValues,E=r.map(E,F.hitch(this,function(J){return{value:J.code,label:J.name}})));return E};X._getSubTypes=function(B){var E=null;B.subtypeField&&B.subtypes&&0<B.subtypes.length&&(E=r.map(B.subtypes,F.hitch(this,function(J){return{value:J.id,label:J.name}})));return E};X._getRenderTypes=function(B){var E=null;B.typeIdField&&B.types&&0<B.types.length&&
(E=r.map(B.types,F.hitch(this,function(J){return{value:J.id,label:J.name}})));return E};X._getCodedValueOrSubtypes=function(B,E,J){var N=X.getFieldInfoByFieldName(B.fields,E);return void 0!==J&&null!==J?X._getCodedValueBySubTypeId(B,E,J,N):X._getAllCodedValue(B,N)};X._getDisplayValueForCodedValueOrSubtype=function(B,E,J,N){var S={isCodedValueOrSubtype:!1,displayValue:J+""};(B=X._getCodedValueOrSubtypes(B,E,N))&&0<B.length&&r.some(B,F.hitch(this,function(V){return V.value===J?(S={isCodedValueOrSubtype:!0,
displayValue:V.label},!0):!1}));return S};X._deleteSubtypePropertiesTemp=function(B){delete B.subtypeField;delete B.subtypes};X.getDisplayValueForCodedValueOrSubtype=function(B,E,J){X._deleteSubtypePropertiesTemp(B);var N=J[E],S,V=B.typeIdField;J.hasOwnProperty(V)&&(S=J[V]);(V=B.subtypeField)&&B.subtypes&&0<B.subtypes.length&&J.hasOwnProperty(V)&&(S=J[V]);N=X._getDisplayValueForCodedValueOrSubtype(B,E,N,S);B.typeIdField===E&&(N.displayValue=X._updateCodedValueListFromRender(B,[{value:J[E],label:N.displayValue}])[0].label);
return N};X._getDisplayValueFromCodedValues=function(B,E){var J={isCodedValueOrSubtype:!1,displayValue:B+""};E&&0<E.length&&r.some(E,F.hitch(this,function(N){return N.value===B?(J={isCodedValueOrSubtype:!0,displayValue:N.label},!0):!1}));J.value=B;return J};X.getDisplayValueForCodedValueOrSubtypeBatch=function(B,E,J){X._deleteSubtypePropertiesTemp(B);var N={},S=B.typeIdField,V=B.subtypeField,aa=X.getFieldInfoByFieldName(B.fields,E);V&&B.subtypes&&0<B.subtypes.length?(N.subType=X._getSubTypes(B),S=
V,N.all=X._getAllCodedValueNew(B,aa)):(N.all=X._getAllCodedValue(B,aa),N.subType=X._getRenderTypes(B));if(N.subType&&0<N.subType.length){V=N.subType;for(var fa in V){var ea=V[fa].value,qa=X._getCodedValueBySubTypeId(B,E,ea,aa);N[ea]=B.typeIdField===E?X._updateCodedValueListFromRender(B,qa):qa}}B.typeIdField===E&&(N.subType=X._updateCodedValueListFromRender(B,N.subType),N.all=X._updateCodedValueListFromRender(B,N.all));ea=[];fa=[];for(var ka in J)ea=J[ka],V=ea[E],S===E?ea=N.subType:ea.hasOwnProperty(S)?
(ea=ea[S],ea=N[ea],ea||(ea=X._getCodedValues(aa),B.typeIdField===E&&(ea=X._updateCodedValueListFromRender(B,ea)))):ea=N.all,V=X._getDisplayValueFromCodedValues(V,ea),fa.push(V);return fa};X._getUniquCodedValue=function(B,E,J){B[E]?J!==B[E]&&(B[E]=B[E]+", "+J):B[E]=J;return B};X._getAllCodedValue=function(B,E){var J=E.name,N={},S=null,V=!0;if(B.typeIdField&&B.types&&0<B.types.length)r.map(B.types,F.hitch(this,function(qa){qa.domains&&qa.domains[J]&&(qa=qa.domains[J],"inherited"===qa.type?V&&(V=!1,
qa=X._getCodedValues(E),r.map(qa,F.hitch(this,function(ka){N=X._getUniquCodedValue(N,ka.value,ka.label)}))):qa.codedValues&&0<qa.codedValues.length&&r.map(qa.codedValues,F.hitch(this,function(ka){N=X._getUniquCodedValue(N,ka.code,ka.name)})))})),S||(S=X._getCodedValues(E));else return this._getCodedValues(E);B=[];var aa=X.isNumberField(E.type),fa;for(fa in N){var ea=aa?parseFloat(fa):fa;B.push({value:ea,label:N[fa]})}0<B.length&&(S=B);return S};X._getAllCodedValueNew=function(B,E){var J=E.name,N=
{},S=null,V=!0;if(B.subtypeField&&B.subtypes&&0<B.subtypes.length)r.map(B.subtypes,F.hitch(this,function(qa){qa.domains&&qa.domains[J]&&(qa=qa.domains[J],"inherited"===qa.type?V&&(V=!1,qa=X._getCodedValues(E),r.map(qa,F.hitch(this,function(ka){N=X._getUniquCodedValue(N,ka.value,ka.label)}))):qa.codedValues&&0<qa.codedValues.length&&r.map(qa.codedValues,F.hitch(this,function(ka){N=X._getUniquCodedValue(N,ka.code,ka.name)})))})),S||(S=X._getCodedValues(E));else return this._getCodedValues(E);B=[];var aa=
X.isNumberField(E.type),fa;for(fa in N){var ea=aa?parseFloat(fa):fa;B.push({value:ea,label:N[fa]})}0<B.length&&(S=B);return S};X._getCodedValueBySubTypeId=function(B,E,J,N){var S="typeIdField",V="types";B.subtypeField&&B.subtypes&&0<B.subtypes.length&&(S="subtypeField",V="subtypes");var aa=null;N=N?N:X.getFieldInfoByFieldName(B.fields,E);B[S]&&B[V]&&0<B[V].length?(r.map(B[V],F.hitch(this,function(fa){if(fa.id===J){if(E===B[S])return aa=[{value:fa.id,label:fa.name}],!0;fa.domains&&fa.domains[E]?(fa=
fa.domains[E],"inherited"===fa.type?aa=X._getCodedValues(N):fa.codedValues&&0<fa.codedValues.length&&(aa=r.map(fa.codedValues,F.hitch(this,function(ea){return{value:ea.code,label:ea.name}})))):fa.domains&&(aa=X._getCodedValues(N))}})),aa||(aa=X._getCodedValues(N))):aa=X._getCodedValues(N);return aa};X.getCodedValueListForCodedValueOrSubTypes=function(B,E,J){X._deleteSubtypePropertiesTemp(B);var N=null;N=X.getFieldInfoByFieldName(B.fields,E);if(J){var S=J[B.typeIdField];var V=J[B.subtypeField]}if(B.subtypeField&&
B.subtypes&&0<B.subtypes.length)return E===B.subtypeField?(N=X._getSubTypes(B),void 0!==V&&(J=X._getDisplayValueFromCodedValues(V,N),N=[{value:J.value,label:J.displayValue}])):N=void 0===V?X._getAllCodedValueNew(B,N):X._getCodedValueBySubTypeId(B,E,V,N),E===B.typeIdField&&(N=X._updateCodedValueListFromRender(B,N)),N;B.subtypeField="";B.subtypes=[];B.typeIdField&&B.typeIdField.toUpperCase()===E.toUpperCase()?(N=X._getRenderTypes(B),J&&void 0!==S&&null!==S&&(J=X._getDisplayValueFromCodedValues(S,N),
N=[{value:J.value,label:J.displayValue}])):N=J&&void 0!==S&&null!==S?X._getCodedValueBySubTypeId(B,E,S,N):X._getAllCodedValue(B,N);E===B.typeIdField&&(N=X._updateCodedValueListFromRender(B,N));return N};X._verifyIfFieldIsSubtypeField=function(B,E){var J={isSubtypeField:!1,subtypeField:""};if(B.subtypeField)return J={isSubtypeField:B.subtypeField===E.name,subtypeField:B.subtypeField};["esriFieldTypeSmallInteger","esriFieldTypeInteger"].indexOf(E.type)&&B.typeIdField===E.name&&B.types&&0<B.types.length&&
(void 0===B.types[0].domains[E.name]?J={isSubtypeField:!0,subtypeField:E.name}:J.isSubtypeField=!1);return!1};X._getRendererFromLayerDef=function(B){var E=null;B.drawingInfo&&B.drawingInfo.renderer&&"uniqueValue"===B.drawingInfo.renderer.type&&(E=B.drawingInfo.renderer);return E};X._getRenderValueLabelsForUnique=function(B){var E=null,J=null,N=X._getRendererFromLayerDef(B);N?(E={},J=N.uniqueValueInfos):B.renderer&&(N=B.toJson().layerDefinition,N=X._getRendererFromLayerDef(N),B=B.renderer.toJson(),
"uniqueValue"===B.type&&N&&N.field1===B.field1?(E={},J=B.uniqueValueInfos):N&&(E={},J=N.uniqueValueInfos));if(J)for(B=0;B<J.length;B++)N=J[B],E[N.value]=N.label;return E};X._updateCodedValueListFromRender=function(B,E){if((B=X._getRenderValueLabelsForUnique(B))&&E)for(var J=0;J<E.length;J++){var N=E[J];B[N.value]&&(N.label=B[N.value])}return E};X.getDefaultPortalFieldInfo=function(B){var E=B.name;E={fieldName:E,label:B.alias||E,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(B.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":E.format=
{places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":E.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":E.format={dateFormat:"longMonthDayYear"}}return E};X.getDefaultPopupInfo=function(B,E,J){var N=null;B&&B.fields&&(N={title:E,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},r.forEach(B.fields,function(S){var V=!1;J?r.some(J,F.hitch(this,function(aa){return aa&&S.name.toLowerCase()===aa.toLowerCase()}))&&(V=!0):V=!0;V&&(V=this.getDefaultPortalFieldInfo(S),
V.visible=!0,V.isEditable=S.editable,N.fieldInfos.push(V))},this));return N};X._tryLocaleNumber=function(B){var E=X.localizeNumber(B);if(null===E||void 0===E)E=B;return E};X._tryLocaleDate=function(B){var E=X.localizeDate(B);E||(E=B.toLocaleDateString());return E};X.getFieldInfoByFieldName=function(B,E){var J=null;B&&0<B.length&&r.some(B,F.hitch(this,function(N){return N.name===E?(J=N,!0):!1}));return J};X.getDateFieldFormatByFieldName=function(B,E){if(B&&0<B.length)for(var J=0;J<B.length;J++){var N=
B[J];if(N.fieldName===E){if(N.format&&N.format.dateFormat)return N.format.dateFormat;break}}return""};X.completePopupFieldFromLayerField=function(B,E){if(!E)return B;for(var J in B){var N=B[J].name,S=!1,V;for(V in E)if(E[V].fieldName===N){S=!0;break}S||(N=X.getPopupFieldFromLayerField(B[J]),E.push(N))}return E};X.getPopupFieldFromLayerField=function(B){return{fieldName:B.name,isEditable:B.editable,label:B.alias,visible:B.visible?B.visible:!1,stringFieldOption:"esriFieldTypeString"===B.type?"textbox":
null,tooltips:"",domain:B.domain?B.domain:null}};X.containsNonLatinCharacter=function(B){for(var E=0;E<B.length;E++)if(255<B.charCodeAt(E))return!0;return!1};X.has=function(B){var E=x(B);if(E)return E;if("ie"===B.toLowerCase()){B=0;var J=/MSIE (\d+\.\d+);/.test(navigator.userAgent),N=!!navigator.userAgent.match(/Trident\/7.0/),S=navigator.userAgent.indexOf("rv:11.0");J&&(B=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(B=10);N&&-1!==S&&(B=11);return 11===B&&11||E}if("edge"===B.toLowerCase())return navigator.userAgent.split("Edge/")[1]||
E};X.detectUserAgent=function(){return window.userAgent};X.isMobileUa=function(){return window.isMobileUa};X.inMobileSize=function(){var B=z.getMarginBox(document.body);if(B.w<=window.jimuConfig.breakPoints[0]||B.h<=window.jimuConfig.breakPoints[0])return z.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;z.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};X.getObjectIdField=function(B){if(B.objectIdField)return B.objectIdField;B=B.fields;for(var E=0;E<B.length;E++){var J=B[E];
if("esriFieldTypeOID"===J.type)return J.name}return null};X.isNeedHttpsButNot=function(){var B=navigator.geolocation,E=window.hasOwnProperty("isSecureContext");return(E&&window.isSecureContext||!E&&"https:"===window.location.protocol)&&B?!1:!0};X.toFeatureSet=function(B){var E=new K;"[object Object]"===Object.prototype.toString.call(B)&&(B=[B]);E.features=B;if(0<B.length){var J;r.some(B,function(S){if(S.geometry)return J=S,!0});if(J){B=J.getLayer();var N={};B&&(E.displayFieldName=B.displayField,r.forEach(B.fields,
F.hitch(this,function(S){var V=S.name;N[V]=S.alias||V})),E.fieldAliases=N);E.geometryType=J.geometry.type;E.spatialReference=J.geometry.spatialReference}}return E};X.showValidationErrorTipForFormDijit=function(B){try{!B.validate()&&B.domNode&&B.focusNode&&(B.focusNode.focus(),setTimeout(F.hitch(this,function(){B.focusNode.blur()}),100))}catch(E){console.error(E)}};X.getFeatureLayerDefinition=function(B){var E=null,J=B.graphics;B.graphics=[];var N=B.toJson();B.graphics=J;N&&(E=N.layerDefinition);return E};
X.simulateClickEvent=function(B){if(x("safari")){var E=document.createEvent("MouseEvents");E.initEvent("click",!0,!0);B.dispatchEvent(E)}else B.click()};X.getFeatureSetByLayerAndFeatures=function(B,E){var J=new K;J.fields=F.clone(B.fields);J.features=E;J.geometryType=B.geometryType;J.fieldAliases={};r.forEach(J.fields,F.hitch(this,function(N){var S=N.name;J.fieldAliases[S]=N.alias||S}));return J};X.featureAction=function(){return{zoomTo:function(B,E,J){J||(J={});if(B&&E&&0<E.length){var N=r.every(E,
function(S){return S&&S.spatialReference&&S.type});if(r.every(E,function(S){return S&&S.geometry&&S.geometry.spatialReference&&S.geometry.type})||N)N&&(E=r.map(E,function(S){return{geometry:S}})),X.zoomToFeatureSet(B,{features:E},J.extentFactor)}},flash:function(B,E){function J(ea,qa){r.forEach(S,function(ka,R){ka.setSymbol(qa?ea:V[R]||aa)})}function N(ea){return function(){setTimeout(function(){J(fa,!0);S[0]&&E&&E.redraw();setTimeout(function(){J(null,!1);S[0]&&E&&E.redraw();ea()},200)},200)}}if(r.every(B||
[],function(ea){return ea&&ea.geometry})){var S=B;B=S[0];var V=r.map(S,function(ea){return ea.symbol}),aa=B.symbol||F.getObject("renderer.symbol",!1,E),fa=null;E&&"esriGeometryPoint"===E.geometryType?fa=new O(require.toUrl("jimu")+"/images/flash.gif",20,20):(fa=F.clone(aa))&&(fa.outline?fa.outline.setColor("#ffc500"):fa.setColor("#ffc500"));B&&aa&&fa&&E&&("esriGeometryPoint"===E.geometryType?(J(fa,!0),E.redraw(),setTimeout(function(){J(null,!1);E.redraw()},2E3)):N(N(N(function(){})))())}},panTo:function(B,
E){r.every(E||[],function(J){return J&&J.geometry})&&(0<E.length?E=Y.graphicsExtent(E).getCenter():(E=E[0].geometry,E="polyline"===E.type||"polygon"===E.type?E.getExtent().getCenter():"extent"===E.type?E.getCenter():"multipoint"===E.type?1<E.points.length?E.getExtent().getCenter():E.getPoint(0):E),B.centerAt(E))},showPopup:function(B,E){r.every(E||[],function(J){return J&&J.geometry})&&(B=B.infoWindow,B.setFeatures(E),E=E[0],"point"===E.geometry.type?B.show(E.geometry,{closetFirst:!0}):B.show(E.geometry.getExtent().getCenter(),
{closetFirst:!0}))}}}();X.isInConfigOrPreviewWindow=function(){var B=!1;try{B=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(E){B=!1}return!!B};X.getAppHref=function(){var B="";return B=X.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};X.getAppIdFromUrl=function(){var B=!0,E=X.getAppHref();if(-1!==E.indexOf("id\x3d")||-1!==E.indexOf("appid\x3d")||-1!==E.indexOf("apps"))B=!1;if(!0===B)return E;B=this.urlToObject(window.location.href);
if(B.query&&(B.query.id||B.query.appid))return B.query.id||B.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(B=window.appInfo.appPath.split("/"),B.length&&2<B.length)return B[B.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};X.getEditorContentHeight=function(B,E,J){var N=new h;this._content=B;this._dom=E;this._domParam=J;var S=setTimeout(F.hitch(this,function(){clearTimeout(S);S=null;var V=0,aa=this._domParam.contentWidth;try{var fa=
document.createElement("div");fa.setAttribute("id","fakeContent");z.setStyle(fa,"background-size","contain");fa.innerHTML=this._content;this._dom.appendChild(fa);if(fa){var ea=t("img",fa);ea&&ea.length&&ea.style({maxWidth:aa-20+"px"});z.setStyle(fa,"position","absolute");z.setStyle(fa,"width",aa+"px");z.setStyle(fa,"left","-99999px");z.setStyle(fa,"top","-99999px");z.setStyle(fa,"visibility","hidden");var qa=z.getContentBox(fa);qa.h&&(V=qa.h,V+=this._domParam.contentMarginTop+this._domParam.footerHeight+
8)}}catch(ka){console.error("can't getEditorContentHeight"+ka),V=200}N.resolve(V)}),1500);return N};X.getBase64Data=function(B){var E=new h;if(B&&B.startWith("data:image"))E.resolve(B);else try{P({url:B,handleAs:"arraybuffer"}).then(function(J){var N=new FileReader;N.onloadend=function(){E.resolve(N.result)};N.onerror=function(){E.resolve(null)};N.readAsDataURL(new Blob([J],{type:"image/png"}))},function(){E.resolve(null)})}catch(J){console.warn(J),E.resolve(null)}return E};X.getEditorTextColor=function(B,
E){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:X.getColorRecordName(B),forceAttr:E}}};X.getEditorBackgroundColor=function(B){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:X.getColorRecordName(B)}}};X.getColorRecordName=function(B){return"wab_cr_"+(B||"")};X.b64toBlob=function(B,E,J){E=E||"";J=J||512;B=window.atob(B.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var N=[],S=0;S<B.length;S+=J){for(var V=B.slice(S,S+J),aa=Array(V.length),
fa=0;fa<V.length;fa++)aa[fa]=V.charCodeAt(fa);V=new Uint8Array(aa);N.push(V)}return new Blob(N,{type:E})};X.subtractionArray=function(B,E){for(var J=B.length-1;0<=J;J--)for(var N=B[J],S=E.length-1;0<=S;S--)if(N===E[S]){B.splice(J,1);E.splice(S,1);break}return B};X.resourcesUrlToBlob=function(B){return P({url:B,handleAs:"blob"})};X.processItemResourceOfAppConfig=function(B,E){function J(ea){var qa=ea.obj,ka=ea.key,R={obj:qa,key:ka};"number"===typeof ea.i?(R.i=ea.i,R.value=qa[ka][ea.i]):R.value=qa[ka];
return R}function N(ea){for(var qa in ea)if("object"===typeof ea[qa])if(Array.isArray(ea[qa]))for(var ka=ea,R=qa,Z=0;Z<ka[R].length;Z++)"string"===typeof ka[R][Z]?S(ka,R,Z):"object"===typeof ka[R][Z]&&N(ka[R][Z]);else N(ea[qa]);else"string"===typeof ea[qa]&&S(ea,qa)}function S(ea,qa,ka){"number"===typeof ka?E.test(ea[qa][ka])&&(fa=E.func(J({obj:ea,key:qa,i:ka})),"function"===typeof fa.then?aa.push(fa):V.push(fa)):E.test(ea[qa])&&(fa=E.func(J({obj:ea,key:qa})),"function"===typeof fa.then?aa.push(fa):
V.push(fa))}var V=[],aa=[],fa;N(B);return 0<aa.length?p(aa).then(function(ea){0<V.length&&(ea=ea.concat(V));return{appConfig:B,result:ea}}):{appConfig:B,result:V}};X.isEsriDomain=function(B){return/^https?:\/\/(?:[\w\-_]+\.)+(?:esri|arcgis)\.com/.test(B)};X.uniqueArray=function(B){for(var E=[],J=0;J<B.length;J++)-1===E.indexOf(B[J])&&E.push(B[J]);return E};X.isNotEmptyObject=function(B,E){return E?X.isObject(B)&&0<Object.keys(B).length&&Array.isArray(B):X.isObject(B)&&0<Object.keys(B).length};X.getMinOfArray=
function(B){return Number(Math.min.apply(Math,B))};X.getDataSchemaFromLayerDefinition=function(B){var E=B.fields.filter(function(J){return"esriFieldTypeOID"===J.type});E=0<E.length?E[0]:null;return{geometryType:B.geometryType,fields:B.fields,displayField:B.displayField,objectIdField:E,typeIdField:B.typeIdField}};X.isValidPointGeometry=function(B){return B&&"point"===B.type&&X.isTrueOrZero(B.x)&&X.isTrueOrZero(B.y)};X.isVaildPointGeometry=X.isValidPointGeometry;X.isNumberOrNumberString=function(B){return/^-?[1-9]\d*$/.test(B)||
/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(B)};X.convertNumberToPercentage=function(B,E,J){if(!X.isNumberOrNumberString(B))return B;"undefined"===typeof J&&(J=!0);"undefined"===typeof E&&(E=2);E={format:{places:E,digitSeparator:J}};J=n.locale;J="ar"===J||"tr"===J;B=Number(B);var N=!1;0>B&&(N=!0,B=Math.abs(B));B=X.localizeNumberByFieldInfo(100*B,E);B=J?"%"+B:B+"%";N&&(B=window.isRTL?B+"-":"-"+B);return B};X.getClientFeaturesFromMap=function(B,E,J,N){var S=[],V=!1;if(E){J?0<E.getSelectedFeatures().length?
(S=E.getSelectedFeatures(),V=!0):S=E.graphics:S=E.graphics;N&&(S=X.filterFeaturesByExtent(B.extent,S));if(S&&0<S.length){var aa=X.getObjectIdField(E);aa&&(B=S[0])&&B.attributes&&B.attributes.hasOwnProperty(aa)&&S.sort(function(fa,ea){fa.attributes||(fa.attributes={});ea.attributes||(ea.attributes={});fa=fa.attributes[aa];ea=ea.attributes[aa];return fa<ea?-1:fa>ea?1:0})}S.isSelectedFeatures=V;return S}};X.filterFeaturesByExtent=function(B,E){var J=B.normalize();return E=r.filter(E,F.hitch(this,function(N){try{if(N.geometry){var S=
"point"===N.geometry.type||"multipoint"===N.geometry;return r.some(J,F.hitch(this,function(V){return S?V.contains(N.geometry):y.intersects(V,N.geometry)}))}}catch(V){console.error(V)}return!1}))};X.upperCaseString=function(B){return B&&"string"===typeof B?B.toUpperCase():B};X.lowerCaseString=function(B){return B&&"string"===typeof B?B.toLowerCase():B};X.getSubstituteString=function(B,E){return l.substitute({value:B},E)};X.getUUID=function(){function B(){return(65536*(1+Math.random())|0).toString(16).substring(1)}
return B()+B()+"_"+B()+"_"+B()+"_"+B()+"_"+B()+B()+B()};X.getStyleColorInTheme=function(B){var E=new h;if(window&&window.isBuilder){var J="./stemapp/themes/";var N=window.appConfig}else J="./themes/",N=window.getAppConfig();if(N&&N.theme.customStyles&&N.theme.customStyles.mainBackgroundColor)return E.resolve(N.theme.customStyles.mainBackgroundColor),E.promise;var S=N.theme.name,V=N.theme.styles[0];B&&(V=B);P({url:J+S+"/manifest.json",handleAs:"json"}).then(F.hitch(this,function(aa){if(aa&&aa.styles){aa=
aa.styles;for(var fa=0;fa<aa.length;fa++){var ea=aa[fa];ea.name===V&&E.resolve(ea.styleColor)}}}),F.hitch(this,function(aa){console.error(aa);E.reject(null)}));return E.promise};X.themesHeaderLogoA11y=function(B,E,J){B.logoLink?(z.setAttr(J.link,"href",B.logoLink),z.setAttr(J.link,"tabIndex",E),z.setAttr(J.link,"target","_blank"),z.setAttr(J.logo,"alt",B.logoLink),z.setStyle(J.icon,"cursor","pointer")):(z.setAttr(J.link,"href","javascript:void(0)"),z.setAttr(J.link,"tabIndex",-1),z.setAttr(J.link,
"target",""),z.removeAttr(J.logo,"alt"),z.setAttr(J.logo,"role","presentation"),z.setStyle(J.icon,"cursor","default"));B.logoAlt&&z.setAttr(J.logo,"alt",B.logoAlt)};return X})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(F,r,z){var x=F.NodeList;r.extend(x,{_buildArrayFromCallback:function(n){for(var v=[],t=0;t<this.length;t++){var m=n.call(this[t],this[t],v);m&&(v=v.concat(m))}return v},_getUniqueAsNodeList:function(n){for(var v=[],t=0,m;m=n[t];t++)1==
m.nodeType&&-1==z.indexOf(v,m)&&v.push(m);return this._wrap(v,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(n,v){n=this._getUniqueAsNodeList(n);n=v?F._filterResult(n,v):n;return n._stash(this)},_getRelatedUniqueNodes:function(n,v){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(v),n)},children:function(n){return this._getRelatedUniqueNodes(n,function(v,t){return r._toArray(v.childNodes)})},closest:function(n,v){return this._getRelatedUniqueNodes(null,function(t,
m){do if(F._filterResult([t],n,v).length)return t;while(t!=v&&(t=t.parentNode)&&1==t.nodeType);return null})},parent:function(n){return this._getRelatedUniqueNodes(n,function(v,t){return v.parentNode})},parents:function(n){return this._getRelatedUniqueNodes(n,function(v,t){for(t=[];v.parentNode;)v=v.parentNode,t.push(v);return t})},siblings:function(n){return this._getRelatedUniqueNodes(n,function(v,t){t=[];for(var m=v.parentNode&&v.parentNode.childNodes,h=0;h<m.length;h++)m[h]!=v&&t.push(m[h]);return t})},
next:function(n){return this._getRelatedUniqueNodes(n,function(v,t){for(v=v.nextSibling;v&&1!=v.nodeType;)v=v.nextSibling;return v})},nextAll:function(n){return this._getRelatedUniqueNodes(n,function(v,t){for(t=[];v=v.nextSibling;)1==v.nodeType&&t.push(v);return t})},prev:function(n){return this._getRelatedUniqueNodes(n,function(v,t){for(v=v.previousSibling;v&&1!=v.nodeType;)v=v.previousSibling;return v})},prevAll:function(n){return this._getRelatedUniqueNodes(n,function(v,t){for(t=[];v=v.previousSibling;)1==
v.nodeType&&t.push(v);return t})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(n,v){return 0!=v%2})},odd:function(){return this.filter(function(n,v){return 0==v%2})}});return x})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(F){F=F.getObject("dojox.encoding.base64",!0);F.encode=function(r){var z=
[],x=r.length,n=x%3;x-=n;for(var v=0;v<x;){var t=r[v++]<<16|r[v++]<<8|r[v++];z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>18&63));z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>12&63));z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>6&63));z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t&63))}switch(n){case 2:t=r[v++]<<16|r[v++]<<8;z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>
18&63));z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>12&63));z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>6&63));z.push("\x3d");break;case 1:t=r[v++]<<16,z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>18&63)),z.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>12&63)),z.push("\x3d"),z.push("\x3d")}return z.join("")};F.decode=function(r){r=r.split("");
for(var z=[],x=r.length;"\x3d"==r[--x];);for(var n=0;n<x;){var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(r[n++])<<18;n<=x&&(v|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(r[n++])<<12);n<=x&&(v|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(r[n++])<<6);n<=x&&(v|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(r[n++]));z.push(v>>>16&255);z.push(v>>>8&255);z.push(v&255)}for(;0==z[z.length-
1];)z.pop();return z};return F})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(F,r,z,x,n,v,t,m){F=F(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var h=z.map(this.geometries,function(e){return e.toJson()}),p={};p.outSR=this.outSR.wkid||x.toJson(this.outSR.toJson());
p.inSR=this.geometries[0].spatialReference.wkid||x.toJson(this.geometries[0].spatialReference.toJson());p.geometries=x.toJson({geometryType:m.getJsonType(this.geometries[0]),geometries:h});this.transformation&&(p.transformation=this.transformation.wkid||x.toJson(this.transformation));t.isDefined(this.transformForward)&&(p.transformForward=this.transformForward);return p}});n("extend-esri")&&r.setObject("tasks.ProjectParameters",F,v);return F})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang",
"jimu/shared/basePortalUrlUtils"],function(F,r){var z=F.clone(r);z.declaredClass="jimu.portalUrlUtils";z.getPortalUrlFromLocation=function(){return z.getPortalServerFromLocation()+z.getDeployContextFromLocation()};z.getPortalSignInUrlFromLocation=function(){var x=z.getPortalUrlFromLocation();return z.setHttpsProtocol(x+"home/signin.html")};z.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};z.getDeployContextFromLocation=function(){var x=window.location.href.split("?")[0],
n=x.indexOf("/home/");0>n&&(n=x.indexOf("/apps/"));x=x.substring(x.indexOf(window.location.host)+window.location.host.length+1,n);"/"!==x&&(x="/"+x+"/");return x};z.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+z.getDeployContextFromLocation()+"sharing/rest/"};return z})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var F={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=
function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(r){return this.substr(0,r.length)===r});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(r){return this.substr(this.length-r.length,r.length)===r});F.getServerByUrl=function(r){r=(r||"").trim();r=r.replace(/^(http(s?):?)\/\//gi,"");0===r.indexOf("//")&&(r=r.slice(2));return r.split("/")[0]};F.getServerWithProtocol=function(r){var z=
"";if(r=(r||"").trim()){var x=F.getServerByUrl(r);if(!x)return z;var n=F.getProtocol(r);n?z=n+"://"+x:0===r.indexOf("//")&&(z="//"+x)}return z};F.isSameServer=function(r,z){r=F.getServerByUrl(r)||"";z=F.getServerByUrl(z)||"";return r.toLowerCase()===z.toLowerCase()};F.getDomain=function(r){var z="";if(r=F.getServerByUrl(r))r=r.replace(/:\d+$/,""),r=r.match(/[^.]\w+\.\w+$/),null!==r&&(z=r[0],/^\d+\.\d+$/.test(z)&&(z=""));return z};F.isSameDomain=function(r,z){r=F.getDomain(r);z=F.getDomain(z);return""!==
r&&r===z};F.isOrgOnline=function(r){return 0<=F.getServerByUrl(r).toLowerCase().indexOf(".maps.arcgis.com")};F.isOnline=function(r){return 0<=F.getServerByUrl(r).toLowerCase().indexOf(".arcgis.com")};F.isArcGIScom=function(r){r=F.getServerByUrl(r).toLowerCase();return"www.arcgis.com"===r||"arcgis.com"===r};F.getStandardPortalUrl=function(r){var z=F.getServerByUrl(r);if(""===z)return"";F.isOnline(z)?(F.isArcGIScom(z)&&(z="www.arcgis.com"),r=F.addProtocol(r),r=F.getProtocol(r)+"://"+z):(r=(r||"").trim().replace(/sharing(.*)/gi,
"").replace(/\/*$/g,""),r=F.addProtocol(r),r.replace(new RegExp("http(s?)://"+z,"g"),"")||(r+="/arcgis"));return r};F.isSamePortalUrl=function(r,z){var x=/^http(s?):\/\//gi,n=/^\/\//gi;r=F.getStandardPortalUrl(r).toLowerCase().replace(x,"").replace(n,"");z=F.getStandardPortalUrl(z).toLowerCase().replace(x,"").replace(n,"");return r===z};F.addProtocol=function(r){if(-1>=r.toLowerCase().indexOf("http://")&&-1>=r.toLowerCase().indexOf("https://")){var z="";"undefined"!==typeof window&&window.location?
(z=window.location.protocol,r=r.startWith("//")?z+r:r.startWith("/")?z+"//"+window.location.host+r:z+"//"+r):(z="http:",r=r.startWith("//")?z+r:z+"//"+r)}return r};F.getProtocol=function(r){var z="";r=r.toLowerCase();0===r.indexOf("https://")?z="https":0===r.indexOf("http://")&&(z="http");return z};F.updateUrlProtocolByOtherUrl=function(r,z){z=z.toLowerCase();0===z.indexOf("https://")?r=F.setHttpsProtocol(r):0===z.indexOf("http://")&&(r=F.setHttpProtocol(r));return r};F.removeProtocol=function(r){return r.replace(/^http(s?):\/\//i,
"//")};F.setHttpProtocol=function(r){r=F.addProtocol(r);return r.replace(/^https:\/\//,"http://")};F.setHttpsProtocol=function(r){r=F.addProtocol(r);return r.replace(/^http:\/\//,"https://")};F.setProtocol=function(r,z){return 0<=z.indexOf("https")?F.setHttpsProtocol(r):0<=z.indexOf("http")?F.setHttpProtocol(r):r};F.getSharingUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/rest");return z};F.getOAuth2Url=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/rest/oauth2");
return z};F.getAppIdUrl=function(r,z){var x="";(r=F.getStandardPortalUrl(r))&&(x=r+"/sharing/rest/oauth2/apps/"+z);return x};F.getSignInUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/signin.html");return z};F.getBaseSearchUrl=function(r){var z="";r=F.getStandardPortalUrl(r);(r=r.replace(/\/*$/g,""))&&(z=r+"/sharing/rest/search");return z};F.getBaseItemUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/rest/content/items");return z};F.getItemUrl=function(r,
z){var x="";(r=F.getBaseItemUrl(r))&&z&&(x=r+"/"+z);return x};F.getItemDataUrl=function(r,z){var x="";(r=F.getItemUrl(r,z))&&(x=r+"/data");return x};F.getItemGroupsUrl=function(r,z){var x="";(r=F.getItemUrl(r,z))&&(x=r+"/groups");return x};F.getGenerateTokenUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/generateToken");return z};F.getItemDetailsPageUrl=function(r,z){var x="";r&&z&&(r=F.getStandardPortalUrl(r),x=r+"/home/item.html?id\x3d"+z);return x};F.getUserProfilePageUrl=
function(r,z){var x="";r&&z&&(r=F.getStandardPortalUrl(r),x=r+"/home/user.html?user\x3d"+z);return x};F.getBaseGroupUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/rest/community/groups");return z};F.getPortalSelfInfoUrl=function(r){var z="";(r=F.getStandardPortalUrl(r||""))&&(z=r+"/sharing/rest/portals/self");return z};F.getPortalHelpMapUrl=function(r){var z="";(r=F.getStandardPortalUrl(r||""))&&(z=r+"/sharing/rest/portals/helpmap");return z};F.getCommunitySelfUrl=function(r){var z=
"";(r=F.getStandardPortalUrl(r||""))&&(z=r+"/sharing/rest/community/self");return z};F.getBaseUserUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/rest/community/users");return z};F.getUserUrl=function(r,z){var x="",n=F.getBaseUserUrl(r);r&&z&&(x=n+"/"+z);return x};F.getUserTagsUrl=function(r,z){var x="",n=F.getUserUrl(r,z);r&&z&&(x=n+"/tags");return x};F.getUserThumbnailUrl=function(r,z,x){var n="";(r=F.getUserUrl(r,z))&&x&&(n=r+"/info/"+x);return n};F.getContentUrl=function(r){var z=
"";r&&(r=F.getStandardPortalUrl(r),z=r+"/sharing/rest/content");return z};F.getUserContentUrl=function(r,z,x){var n="";n="";r&&z&&(n=F.getContentUrl(r),n=x?n+"/users/"+z+"/"+x:n+"/users/"+z);return n};F.getUserContentItemUrl=function(r,z,x){var n="";n="";r&&z&&x&&(n=F.getUserContentUrl(r,z),n=n+"/items/"+x);return n};F.getItemResourceUrl=function(r,z,x){var n="";n="";r&&z&&(n=F.getContentUrl(r),n=x?n+"/items/"+z+"/resources/"+x:n+"/items/"+z+"/resources");return n};F.getAddItemUrl=function(r,z,x){var n=
"";n="";r&&z&&(n=F.getUserContentUrl(r,z,x),n+="/addItem");return n};F.getDeleteItemUrl=function(r,z,x){var n="";(r=F.getUserItemsUrl(r,z))&&(n=r+"/"+x+"/delete");return n};F.getUserItemsUrl=function(r,z,x){var n="";n="";r&&z&&(n=F.getUserContentUrl(r,z,x),n+="/items");return n};F.getUpdateItemUrl=function(r,z,x,n){var v="";v="";r&&z&&(v=F.getUserItemsUrl(r,z,n),v=v+"/"+x+"/update");return v};F.shareItemUrl=function(r,z,x,n){var v="";v="";r&&z&&(v=F.getUserItemsUrl(r,z,n),v=v+"/"+x+"/share");return v};
F.getHomeIndexUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/index.html");return z};F.getHomeMapViewerUrl=function(r,z){var x="";if(r=F.getStandardPortalUrl(r))x=r+"/home/webmap/viewer.html",x=z?x+("?webmap\x3d"+z):x+"?useExisting\x3d1";return x};F.getHomeSceneViewerUrl=function(r,z){var x="";if(r=F.getStandardPortalUrl(r))x=r+"/home/webscene/viewer.html",z&&(x+="?webscene\x3d"+z);return x};F.getHomeGalleryUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/gallery.html");
return z};F.getHomeGroupsUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/groups.html");return z};F.getHomeMyContentUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/content.html");return z};F.getHomeMyOrganizationUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/organization.html");return z};F.getHomeUserUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/home/user.html");return z};F.getPortalHelpUrl=function(r,z){var x="";(r=F.getStandardPortalUrl(r))&&
(x=r+"/portalhelp/"+(z||"en")+"/portal/");return x};F.getPortalAdminHelpUrl=function(r,z){var x="";(r=F.getStandardPortalUrl(r))&&(x=r+"/portalhelp/"+(z||"en")+"/admin/help/");return x};F.getPortalProxyUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/proxy");return z};F.getOAuth2SignOutUrl=function(r){var z="";(r=F.getStandardPortalUrl(r))&&(z=r+"/sharing/rest/oauth2/signout");return z};F.getNewPrintUrl=function(r){var z="";if(r=F.getStandardPortalUrl(r))r=F.setHttpProtocol(r),
z=r+"/sharing/tools/newPrint";return z};F.getSwitchAccoutnsUrl=function(r,z,x){var n="";if(r=F.getStandardPortalUrl(r))n=r+"/home/pages/Account/manage_accounts.html#client_id\x3d"+z,x&&(n+="\x26redirect_uri\x3d"+x);n&&(n=F.setHttpsProtocol(n));return n};F.getArcgisOnlineUrl=function(r){return r.endsWith("mapsdevext.arcgis.com")||r.endsWith("mapsdevext.arcgis.com/")?"https://devext.arcgis.com":r.endsWith("mapsqa.arcgis.com")||r.endsWith("mapsqa.arcgis.com/")?"https://qaext.arcgis.com":"https://www.arcgis.com"};
return F})},"jimu/shared/utils":function(){define([],function(){function F(x,n){function v(t,m){var h,p,e="widgetOnScreen"===t;if(x[t]){if(x[t].groups)for(h=0;h<x[t].groups.length;h++){var c=x[t].groups[h];m(c,{index:h,isWidget:!1,groupId:c.id,isThemeWidget:!1,isOnScreen:e});if(x[t].groups[h].widgets)for(p=0;p<x[t].groups[h].widgets.length;p++){var f=x[t].groups[h].widgets[p];m(f,{index:p,isWidget:!0,groupId:c.id,isThemeWidget:f.uri&&-1<f.uri.indexOf("themes/"+x.theme.name),isOnScreen:e})}}if(x[t].widgets)for(h=
0;h<x[t].widgets.length;h++)f=x[t].widgets[h],m(x[t].widgets[h],{index:h,isWidget:!0,groupId:t,isThemeWidget:f.uri&&-1<f.uri.indexOf("themes/"+x.theme.name),isOnScreen:e})}}v("widgetOnScreen",n);v("widgetPool",n)}var r={},z="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");r.visitElement=F;r.getConfigElementById=function(x,
n){var v;if("map"===n)return x.map;F(x,function(t){if(t.id===n)return v=t,!0});return v};r.getConfigElementByLabel=function(x,n){var v;if("map"===n)return x.map;F(x,function(t){if(t.label||t.name===n)return v=t,!0});return v};r.getConfigElementsByName=function(x,n){var v=[];if("map"===n)return[x.map];F(x,function(t){t.name===n&&v.push(t)});return v};r.getWidgetNameFromUri=function(x){x=x.split("/");x.pop();return x.pop()};r.getAmdFolderFromUri=function(x){x=x.split("/");x.pop();return x.join("/")+
"/"};r.widgetProperties=z;r.processWidgetProperties=function(x){"undefined"===typeof x.properties.isController&&(x.properties.isController=!1);"undefined"===typeof x.properties.isThemeWidget&&(x.properties.isThemeWidget=!1);"undefined"===typeof x.properties.hasVersionManager&&(x.properties.hasVersionManager=!1);"undefined"===typeof x.properties.mirrorIconForRTL&&(x.properties.mirrorIconForRTL=!1);z.forEach(function(n){"undefined"===typeof x.properties[n]&&(x.properties[n]=!0)})};r.getControllerWidgets=
function(x){var n=[];x.visitElement(function(v){v.isController&&n.push(v)});return n};r.addI18NLabelToManifest=function(x,n,v){function t(p,e){e[m]&&(x.i18nLabels[p]=e[m]);"theme"===x.category&&(x.layouts&&x.layouts.forEach(function(c){x["i18nLabels_layout_"+c.name]||(x["i18nLabels_layout_"+c.name]={});x["i18nLabels_layout_"+c.name][p]=e["_layout_"+c.name]}),x.styles&&x.styles.forEach(function(c){x["i18nLabels_style_"+c.name]||(x["i18nLabels_style_"+c.name]={});x["i18nLabels_style_"+c.name][p]=e["_style_"+
c.name]}));"widget"===x.category&&x.featureActions&&x.featureActions.forEach(function(c){x["i18nLabels_featureAction_"+c.name]||(x["i18nLabels_featureAction_"+c.name]={});x["i18nLabels_featureAction_"+c.name][p]=e["_featureAction_"+c.name]})}x.i18nLabels={};var m="widget"===x.category?"_widgetLabel":"_themeLabel";n&&n.root&&n.root[m]&&(x.i18nLabels.defaultLabel=n.root[m],"theme"===x.category&&(x.layouts&&x.layouts.forEach(function(p){x["i18nLabels_layout_"+p.name]={};x["i18nLabels_layout_"+p.name].defaultLabel=
n.root["_layout_"+p.name]}),x.styles&&x.styles.forEach(function(p){x["i18nLabels_style_"+p.name]={};x["i18nLabels_style_"+p.name].defaultLabel=n.root["_style_"+p.name]})),"widget"===x.category&&x.featureActions&&x.featureActions.forEach(function(p){x["i18nLabels_featureAction_"+p.name]={};x["i18nLabels_featureAction_"+p.name].defaultLabel=n.root["_featureAction_"+p.name]}));for(var h in v)t(h,v[h])};r.isHostedService=function(x){if(!x)return!1;var n=-1!==x.indexOf(".arcgis.com/");x=-1!==x.indexOf("//services")||
-1!==x.indexOf("//tiles")||-1!==x.indexOf("//features");return n&&x};return r})},"jimu/accessibleUtils":function(){define("dojo/_base/lang dojo/_base/html dojo/query esri/lang dojo/keys dojo/on".split(" "),function(F,r,z,x,n,v){var t={firstFocusNodeClass:"firstFocusNode",lastFocusNodeClass:"lastFocusNode",lastFocusNodeClassInDOM:"lastFocusNodeInDOM",isInNavMode:function(){return r.hasClass(document.body,"jimu-nav-mode")?!0:!1},initTabIndexAndOrder:function(m){var h=t.getFirstFocusNode(m.domNode,m.inPanel),
p=t.getLastFocusNode(m.domNode);h&&!p&&(p=h);m.isController&&(h=p=null);t.initFirstFocusNode(m.domNode,h);t.initLastFocusNode(m.domNode,p);t.addLabelToWidgetDOM(m)},addLabelToWidgetDOM:function(m){if(0<=["ZoomSlider","AttributeTable","Search","ExtentNavigate","OverviewMap"].indexOf(m.name)){var h=x.substitute({widgetLabel:m.name},window.jimuNls.widgetToolTip);r.setAttr(m.domNode,"aria-label",h)}},isOnScreenNotCloseableOffPanel:function(m){return m.isOnScreen&&!m.inPanel&&!0!==m.closeable},preventMapNavigation:function(m){0<=
[n.NUMPAD_PLUS,61,187,n.NUMPAD_MINUS,173,189,n.UP_ARROW,n.NUMPAD_8,n.RIGHT_ARROW,n.NUMPAD_6,n.DOWN_ARROW,n.NUMPAD_2,n.LEFT_ARROW,n.NUMPAD_4,n.PAGE_UP,n.NUMPAD_9,n.PAGE_DOWN,n.NUMPAD_3,n.END,n.NUMPAD_1,n.HOME,n.NUMPAD_7].indexOf(m.keyCode)&&m.stopPropagation()},_addAttrsOnWidgetDom:function(m){var h=0<=["MyLocation","HomeButton","FullScreen"].indexOf(m.name)?"button":"";m.inPanel||r.setAttr(m.domNode,"role",h)},initWidgetCancelEvent:function(m){this._addAttrsOnWidgetDom(m);v(m.domNode,"keydown",F.hitch(this,
function(h){t.preventMapNavigation(h);var p=h.target;m.inPanel||0>[n.ENTER,n.ESCAPE].indexOf(h.keyCode)||(t.isOnScreenNotCloseableOffPanel(m)?h.keyCode===n.ENTER&&r.hasClass(p,m.baseClass)?(h.preventDefault(),t.focusFirstFocusNode(m.domNode)):h.keyCode===n.ESCAPE&&(r.hasClass(p,m.baseClass)?"Splash"!==m.name&&(p=m.domNode.parentNode,"map"===r.getAttr(p,"id")?(h.preventDefault(),p.focus()):(h="jimu-layout-manager"===r.getAttr(p,"id")?m.domNode:m.domNode.parentNode,t.trapToNextFocusContainer(h))):(h.stopPropagation(),
m.domNode.focus())):h.keyCode!==n.ESCAPE||r.hasClass(p,m.baseClass)||(m.domNode.focus(),m.onClose(),h.preventDefault(),h.stopPropagation()))}))},initFirstFocusNode:function(m,h){var p=t.getFirstFocusNode(m);p&&(r.removeClass(p,t.firstFocusNodeClass),p.firstNodeEvent&&p.firstNodeEvent.remove(),p===m&&(r.setAttr(p,"tabindex",null),r.setAttr(p,"role","")));h&&(h===m&&(r.setAttr(h,"tabindex",0),r.setAttr(h,"role","document")),r.addClass(h,t.firstFocusNodeClass),h.firstNodeEvent=v(h,"keydown",F.hitch(this,
function(e){r.hasClass(e.target,t.firstFocusNodeClass)&&e.keyCode===n.TAB&&(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode?(window.currentMsgPopup.focusedNodeBeforeOpen=e.target,e.preventDefault(),window.currentMsgPopup.firstFocusNode.focus()):!t.tryToFocusSplashWidget(e,m)&&e.shiftKey&&(e.preventDefault(),e=t.getLastFocusNode(m),t.isDomFocusable(e)?e.focus():(e=t.getFocusNodesInDom(e),1<=e.length&&e[e.length-1].focus())))})))},tryToFocusSplashWidget:function(m,h){var p=z(".jimu-widget-splash",
z("#jimu-layout-manager")[0])[0];return p&&"none"!==r.getStyle(p,"display")&&p!==h?(m.stopPropagation(),m.preventDefault(),z("."+t.firstFocusNodeClass,p)[0].focus(),!0):!1},initLastFocusNode:function(m,h){var p=t.getLastFocusNode(m);p&&(r.removeClass(p,t.lastFocusNodeClass),p.lastNodeEvent&&p.lastNodeEvent.remove(),p===m&&r.setAttr(p,"tabindex",null));h&&(h===m&&r.setAttr(h,"tabindex",0),r.addClass(h,t.lastFocusNodeClass),h.lastNodeEvent=v(h,"keydown",F.hitch(this,function(e){if(!e.shiftKey&&e.keyCode===
n.TAB)if(m===h||r.hasClass(e.target,t.lastFocusNodeClass)&&t.isDomFocusable(e.target))e.preventDefault(),this.focusFirstFocusNode(m);else{var c=this.getFocusNodesInDom(h);if(0===c.length||t._isLastFromInnerNodes(c,e.target))e.preventDefault(),this.focusFirstFocusNode(m)}})))},_isLastFromInnerNodes:function(m,h){var p=!1;if(h===m[m.length-1])p=!0;else for(var e=0;e<m.length;e++)if(h===m[e]&&r.hasClass(m[e],t.lastFocusNodeClassInDOM)){p=!0;break}return p},focusFirstFocusNode:function(m){var h=z("."+
t.firstFocusNodeClass,m)[0];(h?h:m).focus()},getFirstFocusNode:function(m,h){var p=r.hasClass(m,t.firstFocusNodeClass)?m:z("."+t.firstFocusNodeClass,m)[0];!p&&h&&(p=m,null===r.getAttr(p,"tabindex")&&r.setAttr(p,"tabindex","0"));return p},getLastFocusNode:function(m){return r.hasClass(m,t.lastFocusNodeClass)?m:z("."+t.lastFocusNodeClass,m)[0]},getFirstSkipLink:function(){return z("#skipContainer a")[0]},focusOnFirstSkipLink:function(){t.getFirstSkipLink().focus()},traversalDom:function(m,h){h=h?h:
[];for(var p=m.childNodes,e=0;e<p.length;e++)m=p[e],1===m.nodeType&&(h.push(m),t.traversalDom(m,h));return h},getFocusNodesInDom:function(m){m=t.traversalDom(m);for(var h=[],p=0;p<m.length;p++){var e=m[p];t.isDomFocusable(e)&&h.push(e)}return h},isDomFocusable:function(m){var h=["A","INPUT","BUTTON","SELECT","TEXTAREA"],p="hidden"!==r.getAttr(m,"type")&&"none"!==r.getStyle(m,"display"),e=!0!==r.getAttr(m,"disabled"),c=parseInt(r.getAttr(m,"tabindex"),10);return p&&e&&(0<=h.indexOf(m.tagName)&&-1!==
c||0>h.indexOf(m.tagName)&&0<=c)?!0:!1},getFrameNodesByAsc:function(){for(var m=z("#jimu-layout-manager")[0].children,h=[],p=0;p<m.length;p++){var e=m[p];0<parseInt(r.getAttr(e,"tabindex"),10)&&"none"!==r.getStyle(e,"display")&&h.push(e)}h.sort(function(c,f){c=parseInt(r.getAttr(c,"tabindex"),10);f=parseInt(r.getAttr(f,"tabindex"),10);return c<f?-1:c===f?0:1});return h},trapToNextFocusContainer:function(m){var h=t.getFrameNodesByAsc(),p=null;if("skipContainer"===r.getAttr(m,"id"))return(p=h[0])&&
p.focus(),p;h.unshift(t.getFirstSkipLink());m=parseInt(r.getAttr(m,"tabindex"),10);for(var e=0;e<h.length;e++)if(parseInt(r.getAttr(h[e],"tabindex"),10)===m){p=e===h.length-1?h[0]:h[e+1];break}p&&p.focus();return p},isAutoFocusFirstNodeWidget:function(m){var h=!0;t.isOnScreenNotCloseableOffPanel(m)?h=!1:m.openAtStart?m.openAtStartAysn?h=m.openAtStartAysn=!1:m._isFirstOpenAtStart||(m._isFirstOpenAtStart=!0,h=!1):m.isOnScreen&&"widgetOnScreen"!==m.gid?h=!1:m.inGroupPanel&&(h=!1);return h},_getTooltipLabel:function(m,
h){var p=r.getAttr(m,"aria-label");m=r.getAttr(m,"title");return p||m||h},addTooltipByDomNode:function(m,h,p){m.defaultPosition=["below-centered","above-centered","after-centered","before-centered"];var e;v(h,"focus",F.hitch(this,function(c){t.isInNavMode()&&(e&&r.setAttr(e,"role","presentation"),m.show(t._getTooltipLabel(h,p)+"\x26nbsp;\x26nbsp;",c.target),e||(e=z(".dijitTooltipContainer",document.body)[0],r.setAttr(e,"role","presentation")))}));v(h,"blur",F.hitch(this,function(c){m&&m.hide(c.target)}))}};
return t})},"jimu/zoomToUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred esri/config esri/graphic esri/graphicsUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/geometry/webMercatorUtils esri/tasks/ProjectParameters".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){var c={zoomToFeatureSet:function(f,b,d){var a=b.features&&0<b.features.length&&b.features[0].getLayer&&b.features[0].getLayer();a=a?a.id:null;b=c.graphicsExtent(b.features,d);return c.zoomToExtent(f,
b,a)},zoomToExtent:function(f,b,d){if(!f||!c.isValidExtent(b)){var a=new z;a.reject();return a}d?(a=new z,require(["jimu/LayerStructure"],function(g){(g=g.getInstance().getNodeById(d))?g.zoomTo(b).then(function(){a.resolve()},function(){a.reject()}):c.projectToMapSpatialReference(f,b).then(function(l){b.isSinglePoint&&(l=c.convertSinglePointExtent(f,l));f.setExtent(l,!0);a.resolve()},function(){a.reject()})})):a=c.projectToMapSpatialReference(f,b).then(function(g){b.isSinglePoint&&(g=c.convertSinglePointExtent(f,
g));return f.setExtent(g,!0)});return a},isValidExtent:function(f){return f&&c.isTrueOrZero(f.xmin)&&c.isTrueOrZero(f.ymin)&&c.isTrueOrZero(f.xmax)&&c.isTrueOrZero(f.ymax)}};c.isVaildExtent=c.isValidExtent;c.isTrueOrZero=function(f){return 0===f?!0:!!f};c.convertSinglePointExtent=function(f,b){var d=f.getScale();if(d=c.getMedianScale(f,d,0))b=c.adjustHeightToAspectRatio(f,b),b=c.getExtentForScale(b,f.width,d);return b};c.graphicsExtent=function(f,b){var d=null;try{if(f&&1===f.length&&f[0].geometry&&
"esri.geometry.Multipoint"===f[0].geometry.declaredClass&&1===f[0].geometry.points.length){var a=f[0].geometry.points[0],g=new m(a[0],a[1],f[0].geometry.spatialReference);f=[new n(g)]}if(f&&1===f.length&&f[0].geometry&&"esri.geometry.Point"===f[0].geometry.declaredClass){var l=f[0].geometry;d=new t(l.x-1E-4,l.y-1E-4,l.x+1E-4,l.y+1E-4,l.spatialReference);d.isSinglePoint=!0}else f&&0<f.length&&(d=v.graphicsExtent(f))&&"number"===typeof b&&0<b&&(d=d.expand(b))}catch(q){console.error(q)}return d};c.projectToMapSpatialReference=
function(f,b){return c.projectToSpatialReference(b,f.spatialReference)};c.projectToSpatialReference=function(f,b){var d=new z,a=f;if(b&&f)if(b.equals(f.spatialReference))d.resolve(a);else if(b.isWebMercator()&&f.spatialReference.equals(new h(4326)))a=p.geographicToWebMercator(f),a.isSinglePoint=f.isSinglePoint,d.resolve(a);else if(b.equals(new h(4326))&&f.spatialReference.isWebMercator())a=p.webMercatorToGeographic(f),a.isSinglePoint=f.isSinglePoint,d.resolve(a);else{var g=x&&x.defaults&&x.defaults.geometryService;
if(g&&"esri.tasks.GeometryService"===g.declaredClass){var l=new e;l.geometries=[f];l.outSR=b;g.project(l).then(function(q){(a=q&&0<q.length&&q[0])?(a.isSinglePoint=f.isSinglePoint,d.resolve(a)):d.reject()},function(){})}else d.reject()}else d.reject();return d};c.getMapLods=function(f){var b=null;f._params&&f._params.lods&&(b=r.map(f._params.lods,F.hitch(this,function(d){return d.toJson()})));return b};c.getMedianScale=function(f,b,d){return c.getTargetScale(f,2,b,d)};c.getTargetScale=function(f,
b,d,a){f=c.getMapLods(f);var g=1;if(f){var l=[],q=[];r.forEach(f,function(A){0<d&&A.scale>d||(A.scale<a?q.push(A.scale):l.push(A.scale))});l.reverse();1<=l.length?(g=q.length?q.length/f.length:1,b=Math.floor((l.length-1)/(b/g)),b=l[b]):b=null}else b=0===d?null:(d-a)/b;return b};c.getScaleForNextTileLevel=function(f,b,d){if(f=c.getMapLods(f)){if(d){for(d=0;d<f.length;d++)if(f[d].scale<b)return f[d].scale-1;return f[f.length-1].scale-1}for(d=f.length-1;0<=d;d--)if(f[d].scale>b)return f[d].scale+1;return f[0].scale+
1}return d?b-1:b+1};c.adjustExtentToAspectRatio=function(f,b){f=f.width/f.height;var d=b.getWidth()/b.getHeight();d>f?(f=b.getWidth()/f/2,F.mixin(b,{ymin:b.getCenter().y-f,ymax:b.getCenter().y+f})):d<f&&(f=b.getHeight()*f/2,F.mixin(b,{xmin:b.getCenter().x-f,xmax:b.getCenter().x+f}));return b};c.adjustHeightToAspectRatio=function(f,b){f=b.getWidth()*(f.height/f.width)/5;F.mixin(b,{ymin:b.getCenter().y-f,ymax:b.getCenter().y+f});return b};c.getExtentForScale=function(f,b,d){var a=20015077/180,g=esri.config.defaults,
l=esri.WKIDUnitConversion,q=f.spatialReference;if(q){var A=q.wkid;var u=q.wkt}q=null;A?q=l.values[l[A]]:u&&-1!==u.search(/^PROJCS/i)&&(l=/UNIT\[([^\]]+)\]\]$/i.exec(u))&&l[1]&&(q=parseFloat(l[1].split(",")[1]));return f.expand(d*b/(39.37*(q||a)*g.screenDPI)/f.getWidth())};c.getScaleForExtent=function(f,b){var d=20015077/180,a=esri.config.defaults,g=esri.WKIDUnitConversion,l=f.spatialReference;if(l){var q=l.wkid;var A=l.wkt}l=null;q?l=g.values[g[q]]:A&&-1!==A.search(/^PROJCS/i)&&(g=/UNIT\[([^\]]+)\]\]$/i.exec(A))&&
g[1]&&(l=parseFloat(g[1].split(",")[1]));return f.getWidth()/b*(l||d)*39.37*a.screenDPI};return c})},"libs/caja-html-sanitizer-minified":function(){(function(){var F=function(){function x(a){return(a=(""+a).match(f))?new h(p(a[1]),p(a[2]),p(a[3]),p(a[4]),p(a[5]),p(a[6]),p(a[7])):null}function n(a,g){return"string"==typeof a?encodeURI(a).replace(g,v):null}function v(a){a=a.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(a>>4&15)+"0123456789ABCDEF".charAt(a&15)}function t(a){if(null===a)return null;
a=a.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/");for(var g=e,l;(l=a.replace(g,"$1"))!=a;a=l);return a}function m(a,g){a=a.R();var l=g.K();l?a.fa(g.j):l=g.V();l?a.ca(g.m):l=g.W();l?a.da(g.k):l=g.Y();var q=g.g,A=t(q);if(l)a.ba(g.T()),A=A&&A.replace(c,"");else if(l=!!q){if(47!==A.charCodeAt(0)){A=t(a.g||"").replace(c,"");var u=A.lastIndexOf("/")+1;A=t((u?A.substring(0,u):"")+t(q)).replace(c,"")}}else A=A&&A.replace(c,""),A!==q&&a.G(A);l?a.G(A):l=g.Z();l?a.M(g.l):l=g.X();l&&a.ea(g.n);return a}
function h(a,g,l,q,A,u,k){this.j=a;this.m=g;this.k=l;this.h=q;this.g=A;this.l=u;this.n=k}function p(a){return"string"==typeof a&&0<a.length?a:null}var e=RegExp(/(\/|^)(?:[^./][^/]*|\.{2,}(?:[^./][^/]*)|\.{3,}[^/]*)\/\.\.(?:\/|$)/),c=/^(?:\.\.\/)*(?:\.\.$)?/;h.prototype.toString=function(){var a=[];null!==this.j&&a.push(this.j,":");null!==this.k&&(a.push("//"),null!==this.m&&a.push(this.m,"@"),a.push(this.k),null!==this.h&&a.push(":",this.h.toString()));null!==this.g&&a.push(this.g);null!==this.l&&
a.push("?",this.l);null!==this.n&&a.push("#",this.n);return a.join("")};h.prototype.R=function(){return new h(this.j,this.m,this.k,this.h,this.g,this.l,this.n)};h.prototype.U=function(){return this.j&&decodeURIComponent(this.j).toLowerCase()};h.prototype.fa=function(a){this.j=a?a:null};h.prototype.K=function(){return null!==this.j};h.prototype.ca=function(a){this.m=a?a:null};h.prototype.V=function(){return null!==this.m};h.prototype.da=function(a){this.k=a?a:null;this.G(this.g)};h.prototype.W=function(){return null!==
this.k};h.prototype.T=function(){return this.h&&decodeURIComponent(this.h)};h.prototype.ba=function(a){if(a){a=Number(a);if(a!==(a&65535))throw Error("Bad port number "+a);this.h=""+a}else this.h=null};h.prototype.Y=function(){return null!==this.h};h.prototype.S=function(){return this.g&&decodeURIComponent(this.g)};h.prototype.G=function(a){a?(a=""+a,this.g=!this.k||/^\//.test(a)?a:"/"+a):this.g=null};h.prototype.M=function(a){this.l=a?a:null};h.prototype.Z=function(){return null!==this.l};h.prototype.aa=
function(a){if("object"===typeof a&&!(a instanceof Array)&&(a instanceof Object||"[object Array]"!==Object.prototype.toString.call(a))){var g=[],l=-1;for(u in a){var q=a[u];"string"===typeof q&&(g[++l]=u,g[++l]=q)}a=g}g=[];l="";for(var A=0;A<a.length;){var u=a[A++];q=a[A++];g.push(l,encodeURIComponent(u.toString()));l="\x26";q&&g.push("\x3d",encodeURIComponent(q.toString()))}this.l=g.join("")};h.prototype.ea=function(a){this.n=a?a:null};h.prototype.X=function(){return null!==this.n};var f=/^(?:([^:/?#]+):)?(?:\/\/(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,
b=/[#\/\?@]/g,d=/[#\?]/g;h.parse=x;h.create=function(a,g,l,q,A,u,k){a=new h(n(a,b),n(g,b),"string"==typeof l?encodeURIComponent(l):null,0<q?q.toString():null,n(A,d),null,"string"==typeof k?encodeURIComponent(k):null);u&&("string"===typeof u?a.M(u.replace(/[^?&=0-9A-Za-z_\-~.%]/g,v)):a.aa(u));return a};h.$=m;h.ja=t;h.ua={oa:function(a){return/\.html$/.test(x(a).S())?"text/html":"application/javascript"},$:function(a,g){return a?m(x(a),x(g)).toString():""+g}};return h}();"undefined"!==typeof window&&
(window.URI=F);var r={e:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13}};r.atype=r.e;r.w={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,
"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,
"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,
"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,
"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,
"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,
"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,
"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,
"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,
"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,
"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};r.ATTRIBS=r.w;r.c={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};
r.eflags=r.c;r.f={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,
ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};r.ELEMENTS=r.f;r.O={a:"HTMLAnchorElement",
abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",
code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",
frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",
legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",
q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",
thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};r.ELEMENT_DOM_INTERFACES=r.O;r.N={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};r.ueffects=r.N;r.J={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,
"q::cite":0,"video::poster":1,"video::src":1};r.URIEFFECTS=r.J;r.L={UNSANDBOXED:2,SANDBOXED:1,DATA:0};r.ltypes=r.L;r.I={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};r.LOADERTYPES=r.I;"undefined"!==typeof window&&(window.html4=r);var z=function(x){function n(ja,pa){pa=w.hasOwnProperty(pa)?w[pa]:(ja=pa.match(y))?String.fromCharCode(parseInt(ja[1],
10)):(ja=pa.match(C))?String.fromCharCode(parseInt(ja[1],16)):G&&D.test(pa)?(G.innerHTML="\x26"+pa+";",ja=G.textContent,w[pa]=ja):"\x26"+pa+";";return pa}function v(ja){return ja.replace(L,n)}function t(ja){return(""+ja).replace(K,"\x26amp;").replace(I,"\x26lt;").replace(P,"\x26gt;").replace(Q,"\x26#34;")}function m(ja){return ja.replace(O,"\x26amp;$1").replace(I,"\x26lt;").replace(P,"\x26gt;")}function h(ja){var pa={z:ja.z||ja.cdata,A:ja.A||ja.comment,B:ja.B||ja.endDoc,r:ja.r||ja.endTag,d:ja.d||
ja.pcdata,F:ja.F||ja.rcdata,H:ja.H||ja.startDoc,v:ja.v||ja.startTag};return function(la,ra){var X=/(<\/|\x3c!--|<[!?]|[&<>])/g;la+="";if(Y)la=la.split(X);else{for(var ya=[],wa=0,M;null!==(M=X.exec(la));)ya.push(la.substring(wa,M.index)),ya.push(M[0]),wa=M.index+M[0].length;ya.push(la.substring(wa));la=ya}e(pa,la,0,{o:!1,C:!1},ra)}}function p(ja,pa,la,ra,X){return function(){e(ja,pa,la,ra,X)}}function e(ja,pa,la,ra,X){try{ja.H&&0==la&&ja.H(X);for(var ya,wa,M,B=pa.length;la<B;){var E=pa[la++],J=pa[la];
switch(E){case "\x26":T.test(J)?(ja.d&&ja.d("\x26"+J,X,da,p(ja,pa,la,ra,X)),la++):ja.d&&ja.d("\x26amp;",X,da,p(ja,pa,la,ra,X));break;case "\x3c/":if(ya=/^([-\w:]+)[^'"]*/.exec(J))if(ya[0].length===J.length&&"\x3e"===pa[la+1])la+=2,M=ya[1].toLowerCase(),ja.r&&ja.r(M,X,da,p(ja,pa,la,ra,X));else{var N=pa,S=la,V=ja,aa=X,fa=da,ea=ra,qa=f(N,S);qa?(V.r&&V.r(qa.name,aa,fa,p(V,N,S,ea,aa)),la=qa.next):la=N.length}else ja.d&&ja.d("\x26lt;/",X,da,p(ja,pa,la,ra,X));break;case "\x3c":if(ya=/^([-\w:]+)\s*\/?/.exec(J))if(ya[0].length===
J.length&&"\x3e"===pa[la+1]){la+=2;M=ya[1].toLowerCase();ja.v&&ja.v(M,[],X,da,p(ja,pa,la,ra,X));var ka=x.f[M];ka&ca&&(la=c(pa,{name:M,next:la,c:ka},ja,X,da,ra))}else{N=pa;S=ja;V=X;aa=da;fa=ra;var R=f(N,la);R?(S.v&&S.v(R.name,R.P,V,aa,p(S,N,R.next,fa,V)),la=R.c&ca?c(N,R,S,V,aa,fa):R.next):la=N.length}else ja.d&&ja.d("\x26lt;",X,da,p(ja,pa,la,ra,X));break;case "\x3c!--":if(!ra.C){for(wa=la+1;wa<B&&("\x3e"!==pa[wa]||!/--$/.test(pa[wa-1]));wa++);if(wa<B){if(ja.A){var Z=pa.slice(la,wa).join("");ja.A(Z.substr(0,
Z.length-2),X,da,p(ja,pa,wa+1,ra,X))}la=wa+1}else ra.C=!0}ra.C&&ja.d&&ja.d("\x26lt;!--",X,da,p(ja,pa,la,ra,X));break;case "\x3c!":if(/^\w/.test(J)){if(!ra.o){for(wa=la+1;wa<B&&"\x3e"!==pa[wa];wa++);wa<B?la=wa+1:ra.o=!0}ra.o&&ja.d&&ja.d("\x26lt;!",X,da,p(ja,pa,la,ra,X))}else ja.d&&ja.d("\x26lt;!",X,da,p(ja,pa,la,ra,X));break;case "\x3c?":if(!ra.o){for(wa=la+1;wa<B&&"\x3e"!==pa[wa];wa++);wa<B?la=wa+1:ra.o=!0}ra.o&&ja.d&&ja.d("\x26lt;?",X,da,p(ja,pa,la,ra,X));break;case "\x3e":ja.d&&ja.d("\x26gt;",X,
da,p(ja,pa,la,ra,X));break;case "":break;default:ja.d&&ja.d(E,X,da,p(ja,pa,la,ra,X))}}ja.B&&ja.B(X)}catch(W){if(W!==da)throw W;}}function c(ja,pa,la,ra,X,ya){var wa=ja.length;ma.hasOwnProperty(pa.name)||(ma[pa.name]=RegExp("^"+pa.name+"(?:[\\s\\/]|$)","i"));for(var M=ma[pa.name],B=pa.next,E=pa.next+1;E<wa&&("\x3c/"!==ja[E-1]||!M.test(ja[E]));E++);E<wa&&--E;wa=ja.slice(B,E).join("");if(pa.c&x.c.CDATA)la.z&&la.z(wa,ra,X,p(la,ja,E,ya,ra));else if(pa.c&x.c.RCDATA)la.F&&la.F(m(wa),ra,X,p(la,ja,E,ya,ra));
else throw Error("bug");return E}function f(ja,pa){var la=/^([-\w:]+)/.exec(ja[pa]),ra={};ra.name=la[1].toLowerCase();ra.c=x.f[ra.name];var X=ja[pa].substr(la[0].length);pa+=1;for(var ya=ja.length;pa<ya&&"\x3e"!==ja[pa];pa++)X+=ja[pa];if(!(ya<=pa)){for(var wa=[];""!==X;)if(la=U.exec(X))if(la[4]&&!la[5]||la[6]&&!la[7]){la=la[4]||la[6];var M=!1;for(X=[X,ja[pa++]];pa<ya;pa++){if(M){if("\x3e"===ja[pa])break}else 0<=ja[pa].indexOf(la)&&(M=!0);X.push(ja[pa])}if(ya<=pa)break;X=X.join("")}else{M=la[1].toLowerCase();
if(la[2]){var B=la[3];var E=B.charCodeAt(0);if(34===E||39===E)B=B.substr(1,B.length-2);B=v(B.replace(H,""))}else B="";wa.push(M,B);X=X.substr(la[0].length)}else X=X.replace(/^[\s\S][^a-z\s]*/,"");ra.P=wa;ra.next=pa+1;return ra}}function b(ja){function pa(X,ya){ra||ya.push(X)}var la,ra;return h({startDoc:function(){la=[];ra=!1},startTag:function(X,ya,wa){if(!ra&&x.f.hasOwnProperty(X)){var M=x.f[X];if(!(M&x.c.FOLDABLE)){var B=ja(X,ya);if(B){if("object"!==typeof B)throw Error("tagPolicy did not return object (old API?)");
if("attribs"in B)ya=B.attribs;else throw Error("tagPolicy gave no attribs");var E;"tagName"in B?(E=B.tagName,B=x.f[E]):(E=X,B=M);if(M&x.c.OPTIONAL_ENDTAG){var J=la[la.length-1];J&&J.D===X&&(J.t!==E||X!==E)&&wa.push("\x3c/",J.t,"\x3e")}M&x.c.EMPTY||la.push({D:X,t:E});wa.push("\x3c",E);X=0;for(J=ya.length;X<J;X+=2){var N=ya[X],S=ya[X+1];null!==S&&void 0!==S&&wa.push(" ",N,'\x3d"',t(S),'"')}wa.push("\x3e");M&x.c.EMPTY&&!(B&x.c.EMPTY)&&wa.push("\x3c/",E,"\x3e")}else ra=!(M&x.c.EMPTY)}}},endTag:function(X,
ya){if(ra)ra=!1;else if(x.f.hasOwnProperty(X)){var wa=x.f[X];if(!(wa&(x.c.EMPTY|x.c.FOLDABLE))){if(wa&x.c.OPTIONAL_ENDTAG)for(wa=la.length;0<=--wa;){var M=la[wa].D;if(M===X)break;if(!(x.f[M]&x.c.OPTIONAL_ENDTAG))return}else for(wa=la.length;0<=--wa&&la[wa].D!==X;);if(!(0>wa)){for(M=la.length;--M>wa;){var B=la[M].t;x.f[B]&x.c.OPTIONAL_ENDTAG||ya.push("\x3c/",B,"\x3e")}wa<la.length&&(X=la[wa].t);la.length=wa;ya.push("\x3c/",X,"\x3e")}}}},pcdata:pa,rcdata:pa,cdata:pa,endDoc:function(X){for(;la.length;la.length--)X.push("\x3c/",
la[la.length-1].t,"\x3e")}})}function d(ja,pa,la,ra,X){if(!X)return null;try{var ya=F.parse(""+ja);if(ya&&(!ya.K()||na.test(ya.U()))){var wa=X(ya,pa,la,ra);return wa?wa.toString():null}}catch(M){}return null}function a(ja,pa,la,ra,X){la||ja(pa+" removed",{Q:"removed",tagName:pa});if(ra!==X){var ya="changed";ra&&!X?ya="removed":!ra&&X&&(ya="added");ja(pa+"."+la+" "+ya,{Q:ya,tagName:pa,ia:la,oldValue:ra,newValue:X})}}function g(ja,pa,la){pa=pa+"::"+la;if(ja.hasOwnProperty(pa))return ja[pa];pa="*::"+
la;if(ja.hasOwnProperty(pa))return ja[pa]}function l(ja,pa,la,ra,X){for(var ya=0;ya<pa.length;ya+=2){var wa=pa[ya],M=pa[ya+1],B=M,E=null,J;if((J=ja+"::"+wa,x.w.hasOwnProperty(J))||(J="*::"+wa,x.w.hasOwnProperty(J)))E=x.w[J];if(null!==E)switch(E){case x.e.NONE:break;case x.e.SCRIPT:M=null;X&&a(X,ja,wa,B,M);break;case x.e.STYLE:if("undefined"===typeof u){M=null;X&&a(X,ja,wa,B,M);break}var N=[];u(M,{declaration:function(S,V){var aa=S.toLowerCase();k(aa,V,la?function(fa){return d(fa,x.N.ga,x.L.ha,{TYPE:"CSS",
CSS_PROP:aa},la)}:null);V.length&&N.push(aa+": "+V.join(" "))}});M=0<N.length?N.join(" ; "):null;X&&a(X,ja,wa,B,M);break;case x.e.ID:case x.e.IDREF:case x.e.IDREFS:case x.e.GLOBAL_NAME:case x.e.LOCAL_NAME:case x.e.CLASSES:M=ra?ra(M):M;X&&a(X,ja,wa,B,M);break;case x.e.URI:M=d(M,g(x.J,ja,wa),g(x.I,ja,wa),{TYPE:"MARKUP",XML_ATTR:wa,XML_TAG:ja},la);X&&a(X,ja,wa,B,M);break;case x.e.URI_FRAGMENT:M&&"#"===M.charAt(0)?(M=M.substring(1),M=ra?ra(M):M,null!==M&&void 0!==M&&(M="#"+M)):M=null;X&&a(X,ja,wa,B,M);
break;default:M=null,X&&a(X,ja,wa,B,M)}else M=null,X&&a(X,ja,wa,B,M);pa[ya+1]=M}return pa}function q(ja,pa,la){return function(ra,X){if(x.f[ra]&x.c.UNSAFE)la&&a(la,ra,void 0,void 0,void 0);else return{attribs:l(ra,X,ja,pa,la)}}}function A(ja,pa){var la=[];b(pa)(ja,la);return la.join("")}var u,k;"undefined"!==typeof window&&(u=window.parseCssDeclarations,k=window.sanitizeCssProperty);var w={lt:"\x3c",LT:"\x3c",gt:"\x3e",GT:"\x3e",amp:"\x26",AMP:"\x26",quot:'"',apos:"'",nbsp:"\u00a0"},y=/^#(\d+)$/,
C=/^#x([0-9A-Fa-f]+)$/,D=/^[A-Za-z][A-za-z0-9]+$/,G="undefined"!==typeof window&&window.document?window.document.createElement("textarea"):null,H=/\0/g,L=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,T=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,K=/&/g,O=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,I=/[<]/g,P=/>/g,Q=/"/g,U=/^\s*([-.:\w]+)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i,Y=3==="a,b".split(/(,)/).length,ca=x.c.CDATA|x.c.RCDATA,da={},ma={},na=/^(?:https?|mailto)$/i,va={};
va.ka=va.escapeAttrib=t;va.la=va.makeHtmlSanitizer=b;va.ma=va.makeSaxParser=h;va.na=va.makeTagPolicy=q;va.pa=va.normalizeRCData=m;va.qa=va.sanitize=function(ja,pa,la,ra){return A(ja,q(pa,la,ra))};va.ra=va.sanitizeAttribs=l;va.sa=va.sanitizeWithPolicy=A;va.ta=va.unescapeEntities=v;return va}(r);r=z.sanitize;"undefined"!==typeof window&&(window.html=z,window.html_sanitize=r);"function"===typeof define&&define.amd&&define([],function(){return z})})()},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dijit/Tooltip dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q){var A=null,u=F(t,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(v.subscribe("app/mapLoaded",r.hitch(this,this._onMapLoaded)),v.subscribe("app/mapChanged",r.hitch(this,this._onMapChanged))):(v.subscribe("mapLoaded",r.hitch(this,this._onMapLoaded)),v.subscribe("mapChanged",r.hitch(this,this._onMapChanged)));window.isBuilder?(v.subscribe("app/sceneViewLoaded",r.hitch(this,this._onSceneViewLoaded)),
v.subscribe("app/sceneViewChanged",r.hitch(this,this._onSceneViewChanged))):(v.subscribe("sceneViewLoaded",r.hitch(this,this._onSceneViewLoaded)),v.subscribe("sceneViewChanged",r.hitch(this,this._onSceneViewChanged)));window.isBuilder?(v.subscribe("app/appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)),v.subscribe("app/appConfigChanged",r.hitch(this,this._onAppConfigChanged))):(v.subscribe("appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)),v.subscribe("appConfigChanged",r.hitch(this,this._onAppConfigChanged)));
v.subscribe("userSignIn",r.hitch(this,this._onUserSignIn));v.subscribe("userSignOut",r.hitch(this,this._onUserSignOut));v.subscribe("builder/actionTriggered",r.hitch(this,this._onActionTriggered));v.subscribe("/dnd/move/start",r.hitch(this,this._onMoveStart))},loadWidget:function(k){var w=new n,y;k=r.clone(k);(y=this.getWidgetById(k.id))?w.resolve(y):b([this.loadWidgetClass(k),this.loadWidgetManifest(k)]).then(r.hitch(this,function(C){var D=C[0],G=C[1];this.loadWidgetResources(G).then(r.hitch(this,
function(H){try{var L=this.createWidget(G,D,H);x.setAttr(L.domNode,"data-widget-name",G.name);console.log("widget ["+G.uri+"] created.")}catch(T){console.log("create ["+G.uri+"] error:"+T.stack),new l({message:window.jimuNls.widgetManager.createWidgetError+": "+G.uri}),d.byId(G.id)&&d.byId(G.id).destroy(),w.reject(T)}setTimeout(r.hitch(this,function(){w.resolve(L);this.emit("widget-created",L);v.publish("widgetCreated",L)}),50)}),function(H){w.reject(H)})}),function(C){w.reject(C)});return w},loadWidgetClass:function(k){var w=
new n;if(k.isRemote){var y=k.uri+".js";setTimeout(function(){w.reject("Not allow.")},10);return w}y=k.uri;require(a.getRequireConfig(),[y],r.hitch(this,function(C){w.resolve(C)}));a.checkError(k.uri,w);return w},loadWidgetResources:function(k){var w=new n,y=[];var C=r.clone(k);k=this.tryLoadWidgetConfig(C);var D=this._tryLoadResource(C,"i18n");var G=this._tryLoadResource(C,"style");C=this._tryLoadResource(C,"template");y.push(k);y.push(D);y.push(C);y.push(G);b(y).then(r.hitch(this,function(H){var L=
{};L.config=H[0];L.i18n=H[1];L.template=H[2];L.style=H[3];w.resolve(L)}),function(H){w.reject(H)});return w},loadWidgetManifest:function(k){var w=new n,y=a.getUriInfo(k.uri);if(y.isRemote)return y=y.folderUrl+"manifest.json?f\x3djson",setTimeout(function(){w.reject("Not allow.")},10),w;y=y.folderUrl+"manifest.json";if(k.manifest)return w.resolve(k),w;f(y,{handleAs:"json",headers:{"X-Requested-With":null}}).then(r.hitch(this,function(C){if(C.error&&C.error.code)return w.reject(C.error);C.category=
"widget";r.mixin(C,a.getUriInfo(k.uri));a.manifest.addI18NLabel(C).then(r.hitch(this,function(){this._processManifest(C);a.widgetJson.addManifest2WidgetJson(k,C);w.resolve(k)}))}),function(C){w.reject(C)});return w},getWidgetMarginBox:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return{};if(k._marginBox)return k._marginBox;var w={left:-9999,top:-9999,relativeTo:k.position.relativeTo};k._isTestSizeFlag=!0;k.setPosition(w);this.openWidget(k);k._marginBox=k.getMarginBox();this.closeWidget(k);
"undefined"!==typeof k._isTestSizeFlag&&delete k._isTestSizeFlag;return k._marginBox},_processManifest:function(k){a.manifest.addManifestProperies(k);a.manifest.processManifestLabel(k,window.dojoConfig.locale)},createWidget:function(k,w,y){if(this.getWidgetById(k.id))return this.getWidgetById(k.id);y.config&&y.i18n&&(y.config=a.replacePlaceHolder(y.config,y.i18n));k.rawConfig=k.config;k.config=y.config||{};this.appConfig._appData&&this._mergeAgolConfig(k);k.nls=y.i18n||{};y.template&&(k.templateString=
y.template);k["class"]="jimu-widget";k.label||(k.label=k.name);this.map&&(k.map=this.map);k.appConfig=this.appConfig;y={};for(var C in k)k.hasOwnProperty(C)&&(y[C]=k[C]);y.widgetManager=this;k=new w(y);k.clazz=w;p.after(k,"startup",r.hitch(this,this._postWidgetStartup,k));p.before(k,"destroy",r.hitch(this,this._onDestroyWidget,k));k.domNode.addEventListener(this._getActiveEventName(),r.hitch(this,this._onClickWidget,k),{capture:!0});this.loaded.push(k);return k},getAllWidgets:function(){return this.loaded},
destroyAllWidgets:function(){var k=z.map(this.loaded,function(w){return w.id});z.forEach(k,function(w){this.destroyWidget(w)},this);this.loaded=[]},loadWidgetSettingPage:function(k){var w=new n;k=r.clone(k);k.id+="_setting";b([this.loadWidgetSettingClass(k)]).then(r.hitch(this,function(y){var C=y[0];this.loadWidgetSettingPageResources(k).then(r.hitch(this,function(D){var G={nls:D.i18n,appConfig:this.appConfig,"class":"jimu-widget-setting"};null!==D.template&&(G.templateString=D.template);"HTML3D"===
window.appInfo.appType?G.sceneView=this.sceneView:G.map=this.map;for(var H in k)k.hasOwnProperty(H)&&(G[H]=k[H]);try{var L=new C(G);x.setAttr(L.domNode,"data-widget-name-setting",G.name);p.before(L,"destroy",r.hitch(this,this._onDestroyWidgetSetting,L));w.resolve(L)}catch(T){new l({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+k.uri}),d.byId(G.id)&&d.byId(G.id).destroy(),w.reject(T)}}),function(D){console.log(D)})}),function(y){w.reject(y)});return w},loadWidgetSettingClass:function(k){var w=
new n;var y=k.isRemote?k.folderUrl+"setting/Setting.js":k.amdFolder+"setting/Setting";require(a.getRequireConfig(),[y],r.hitch(this,function(C){w.resolve(C)}));a.checkError(k.folderUrl+"setting/Setting.js",w);return w},loadWidgetSettingPageResources:function(k){var w=new n,y=[];k=r.clone(k);var C=this._tryLoadResource(k,"settingI18n");var D=this._tryLoadResource(k,"settingTemplate");k=this._tryLoadResource(k,"settingStyle");y.push(C);y.push(D);y.push(k);b(y).then(r.hitch(this,function(G){var H={};
H.i18n=G[0]||{};H.template=G[1];H.style=G[2];w.resolve(H)}),function(G){console.log(G)});return w},getWidgetById:function(k){var w;z.some(this.loaded,function(y){if(y.id===k)return w=y,!0},this);return w},getWidgetByLabel:function(k){var w;z.some(this.loaded,function(y){if(y.label===k)return w=y,!0},this);return w},getWidgetsByName:function(k){var w=[];z.some(this.loaded,function(y){y.name===k&&w.push(y)},this);return w},changeWindowStateTo:function(k,w){"normal"===w?this.normalizeWidget(k):"minimized"===
w?this.minimizeWidget(k):"maximized"===w?this.maximizeWidget(k):console.log("error state: "+w)},closeWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;if("closed"!==k.state){this.activeWidget&&this.activeWidget.id===k.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);x.setStyle(k.domNode,"display","none");k.setState("closed");try{k.onClose()}catch(w){console.log(console.error("fail to close widget "+k.name+". "+w.stack))}}this.appConfig.mode||this._removeDataSourceUsage(k)},
openWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;if(!k.started)try{k.started=!0,k.startup()}catch(w){console.error("fail to startup widget "+k.name+". "+w.stack)}if("closed"===k.state){x.setStyle(k.domNode,"display","");k.setState("opened");try{k.onOpen()}catch(w){console.error("fail to open widget "+k.name+". "+w.stack)}!k._isTestSizeFlag&&a.isAutoFocusFirstNodeWidget(k)&&a.focusFirstFocusNode(k.domNode);this.appConfig.mode||this._addDataSourceUsage(k)}},activateWidget:function(k){if("string"===
typeof k&&(k=this.getWidgetById(k),!k))return;"opened"===k.state&&this._activeWidget(k)},maximizeWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;"closed"===k.state&&this.openWidget(k);k.setWindowState("maximized");try{k.onMaximize()}catch(w){console.log(console.error("fail to maximize widget "+k.name+". "+w.stack))}},minimizeWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;"closed"===k.state&&this.openWidget(k);k.setWindowState("minimized");
try{k.onMinimize()}catch(w){console.log(console.error("fail to minimize widget "+k.name+". "+w.stack))}},normalizeWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;"closed"===k.state&&this.openWidget(k);k.setWindowState("normal");try{k.onNormalize()}catch(w){console.log(console.error("fail to normalize widget "+k.name+". "+w.stack))}},destroyWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;this._removeWidget(k);try{k.destroy()}catch(w){console.log(console.error("fail to destroy widget "+
k.name+". "+w.stack))}},tryLoadWidgetConfig:function(k){return this._tryLoadWidgetConfig(k).then(r.hitch(this,function(w){return this._upgradeWidgetConfig(k,w).then(function(y){return k.config=y})}))},triggerWidgetOpen:function(k){function w(G){var H=p.after(G,"onOpen",function(){H.remove();y.resolve(G)})}var y=new n,C=this.getWidgetById(k);if(C){if("closed"!==C.state)return y.resolve(C),y;w(C)}else var D=v.subscribe("widgetCreated",r.hitch(this,function(G){G.id===k&&(D.remove(),y.resolve(G))}));
v.publish("openWidget",k);return y},_tryLoadWidgetConfig:function(k){var w=new n;if(k.config&&r.isObject(k.config))return w.resolve(k.config),w;if(k.config){if(require.cache["url:"+k.config])return w.resolve(e.parse(require.cache["url:"+k.config])),w;w=a.processUrlInAppConfig(k.config);w=w.split("/");w[w.length-1]=encodeURIComponent(w[w.length-1]);w=w.join("/");return f(w,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(k,"config").then(function(y){k.isDefaultConfig=
!0;return y})},_upgradeWidgetConfig:function(k,w){var y=new n,C=k.manifest.version,D=k.version,G;if(C===D)return y.resolve(w),y;if(!1===k.hasVersionManager)return k.version=C,y.resolve(w),y;require(a.getRequireConfig(),[k.amdFolder+(k.isRemote?"VersionManager.js":"VersionManager")],r.hitch(this,function(H){H=new H;var L=H.getVersionIndex(D),T=H.getVersionIndex(C);if(L>T)y.reject("Bad widget version number, "+k.name+","+D);else try{G=H.upgrade(w,D,C),k.version=C,y.resolve(G)}catch(K){console.log("Read widget ["+
k.name+"] old config error,"+K.stack),y.resolve(w)}}));return y},loadWidgetStyle:function(k){var w=this._getStyleIdFromWidgetJson(k,!1),y=new n;return x.byId(w)?(y.resolve("load"),y):a.loadStyleLink(w,k.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(k){var w=this._getStyleIdFromWidgetJson(k,!0),y=new n;return x.byId(w)?(y.resolve("load"),y):a.loadStyleLink(w,k.settingStyleFile)},loadWidgetConfig:function(k){k=require(a.getRequireConfig()).toUrl(k.configFile);
if(require.cache["url:"+k]){var w=new n;w.resolve(e.parse(require.cache["url:"+k]));return w}return f(k,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(k){var w=new n;require(a.getRequireConfig(),["dojo/i18n!"+k.i18nFile],function(y){w.resolve(y)});return w},loadWidgetSettingI18n:function(k){var w=new n;require(a.getRequireConfig(),["dojo/i18n!"+k.settingI18nFile],function(y){w.resolve(y)});return w},loadWidgetTemplate:function(k){var w=new n;require(a.getRequireConfig(),
["dojo/text!"+k.templateFile],function(y){w.resolve(y)});a.checkError(k.templateFile,w);return w},loadWidgetSettingTemplate:function(k){var w=new n;require(a.getRequireConfig(),["dojo/text!"+k.settingTemplateFile],function(y){w.resolve(y)});a.checkError(k.settingTemplateFile,w);return w},removeWidgetStyle:function(k){this._removeStyle(this._getStyleIdFromWidgetJson(k,!1))},removeWidgetSettingStyle:function(k){this._removeStyle(this._getStyleIdFromWidgetJson(k,!0))},_removeStyle:function(k){if(x.byId(k)){var w=
x.attr(k,"data-import-styles");if(w)for(var y=0;y<parseInt(w,10);y++)x.destroy(k+"_import_"+y);x.destroy(k)}},_getStyleIdFromWidgetJson:function(k,w){return this._replaceId("widget/style/"+(k.itemId?k.itemId:k.uri)+(w?"/setting":""))},getControllerWidgets:function(){return z.filter(this.loaded,function(k){return k.isController})},getOffPanelWidgets:function(){return z.filter(this.loaded,function(k){return!k.inPanel})},getOnScreenOffPanelWidgets:function(){return z.filter(this.loaded,function(k){return k.isOnScreen&&
!k.inPanel})},closeOtherWidgetsInTheSameGroup:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;for(var w=0;w<this.loaded.length;w++)this.loaded[w].gid===k.gid&&this.loaded[w].id!==k.id&&this.closeWidget(this.loaded[w])},closeAllWidgetsInGroup:function(k){for(var w=0;w<this.loaded.length;w++)this.loaded[w].gid===k&&this.closeWidget(this.loaded[w])},_addDataSourceUsage:function(k){z.forEach(this._getUsedDataSourceIdFromWidget(k),function(w){q.getInstance().addDataSourceUsage(w,
k.id)})},_removeDataSourceUsage:function(k){z.forEach(this._getUsedDataSourceIdFromWidget(k),function(w){q.getInstance().removeDataSourceUsage(w,k.id)})},_getUsedDataSourceIdFromWidget:function(k){if((k=this.appConfig.getConfigElementById(k.id))&&k.config){var w=e.stringify(k.config);return z.filter(Object.keys(this.appConfig.dataSource.dataSources),function(y){return-1<w.indexOf(y)},this)}},_mergeAgolConfig:function(k){var w=this.appConfig._appData.values,y="widgets["+k.id+"]",C;for(C in w){var D=
C.replace(/\//g,"_").indexOf(y+"_config");0<=D&&a.template.setConfigValue(k,C.replace(/\//g,"_").substr(D,C.length).replace(y,"widget"),w[C])}},_onUserSignIn:function(k){z.forEach(this.loaded,function(w){w.onSignIn(k)},this)},_onUserSignOut:function(){z.forEach(this.loaded,function(k){k.onSignOut()},this)},_activeWidget:function(k){if(this.activeWidget){if(this.activeWidget.id===k.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&x.setStyle(this.activeWidget.domNode,"zIndex",
101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&x.setStyle(k.domNode,"zIndex","zIndex"in k.position?k.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=k;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&x.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),v.publish("widgetActived",k))},_onClickWidget:function(k,
w){var y=c(".jimu-widget",k.domNode);if(0<y.length)for(var C=0;C<y.length;C++)if(w.target===y[C]||x.isDescendant(w.target,y[C]))return;this._activeWidget(k)},_onMoveStart:function(k){z.forEach(this.loaded,function(w){w.domNode===k.node&&this._activeWidget(w)},this)},_onAppConfigLoaded:function(k){this.appConfig=k=r.clone(k);g.setPortalUrl(k.portalUrl)},_onMapLoaded:function(k){this.map=k},_onMapChanged:function(k){this.map=k},_onSceneViewLoaded:function(k){this.sceneView=k},_onSceneViewChanged:function(k){this.sceneView=
k},_onAppConfigChanged:function(k,w,y,C){var D=r.clone(k);this.appConfig=D;z.forEach(this.loaded,function(G){G&&(G.onAppConfigChanged(D,w,y,C),"widgetChange"===w&&this._onConfigChanged(y.id,y.config,C))},this)},_onConfigChanged:function(k,w){if(k=this.getWidgetById(k))k.onConfigChanged(w),r.mixin(k.config,w)},_onActionTriggered:function(k){if("map"!==k.elementId&&"app"!==k.elementId){var w=this.getWidgetById(k.elementId);if(w)w.onAction(k.action,k.data);else this.missedActions.push({id:k.elementId,
action:{name:k.action,data:k.data}});z.forEach(this.getControllerWidgets(),function(y){if(y.widgetIsControlled(k.elementId))y.onAction(k.action,{widgetId:k.elementId,data:k.data})},this)}},_resetFirstFocusNode:function(k){if(window.isMoveFocusWhenInit){var w=this.getWidgetsByName("Splash")[0];if(w&&"none"!==x.getStyle(w.domNode,"display"))window.isMoveFocusWhenInit=!1,k&&"Splash"===k.name||w.domNode.focus();else if(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode)window.isMoveFocusWhenInit=
!1,window.currentMsgPopup.focusedNodeBeforeOpen=a.getFirstSkipLink(),window.currentMsgPopup.firstFocusNode.focus();else if(window.isMoveFocusWhenInit)window.isMoveFocusWhenInit=!1,a.isInNavMode()&&a.focusOnFirstSkipLink();else return!1;return!0}},_postWidgetStartup:function(k){k.started=!0;a.setVerticalCenter(k.domNode);p.after(k,"resize",r.hitch(this,a.setVerticalCenter,k.domNode));a.initTabIndexAndOrder(k);a.initWidgetCancelEvent(k);var w=k.position||k.panel&&k.panel.position;w&&"browser"===w.relativeTo&&
m(k.domNode,"focus",r.hitch(this,function(){this._resetFirstFocusNode()}));this.openWidget(k);if(w=g.getPortalCredential(this.appConfig.portalUrl))k.onSignIn(w);else k.onSignOut();this._triggerMissedAction(k);k.inPanel||a.addTooltipByDomNode(h,k.domNode,k.label)},_triggerMissedAction:function(k){this.missedActions.forEach(function(w){if(w.id===k.id)k.onAction(w.action.name,w.action.data)})},_remove:function(k){return z.some(this.loaded,function(w,y){if(w.id===k)return this.loaded.splice(y,1),!0},
this)},_tryLoadResource:function(k,w){var y=new n,C=function(){if("config"===w)var G=this.loadWidgetConfig(k);else if("style"===w)G=this.loadWidgetStyle(k);else if("i18n"===w)G=this.loadWidgetI18n(k);else if("template"===w)G=this.loadWidgetTemplate(k);else if("settingTemplate"===w)G=this.loadWidgetSettingTemplate(k);else if("settingStyle"===w)G=this.loadWidgetSettingStyle(k);else if("settingI18n"===w)G=this.loadWidgetSettingI18n(k);else return y;G.then(function(H){y.resolve(H)},function(H){console.error("Load widget resource error. resource:",
w);console.error(H);new l({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+k.uri});y.reject(H)})};if("config"===w){var D=k.amdFolder+"config.json";k.configFile=D;D="hasConfig"}else if("style"===w)D=k.amdFolder+"css/style.css",k.styleFile=D,D="hasStyle";else if("i18n"===w)D=k.amdFolder+"nls/strings.js",k.i18nFile=k.isRemote?D:k.amdFolder+"nls/strings",D="hasLocale";else if("template"===w)D=k.amdFolder+"Widget.html",k.templateFile=D,D="hasUIFile";else if("settingTemplate"===w)D=k.amdFolder+
"setting/Setting.html",k.settingTemplateFile=D,D="hasSettingUIFile";else if("settingI18n"===w)D=k.amdFolder+"setting/nls/strings.js",k.settingI18nFile=k.isRemote?D:k.amdFolder+"setting/nls/strings",D="hasSettingLocale";else if("settingStyle"===w)D=k.amdFolder+"setting/css/style.css",k.settingStyleFile=D,D="hasSettingStyle";else return y;k[D]?C.apply(this):y.resolve(null);return y},_replaceId:function(k){return k.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(k){"closed"!==k.state&&
this.closeWidget(k);this._removeWidget(k);this.emit("widget-destroyed",k.id);v.publish("widgetDestroyed",k.id);console.log("destroy widget ["+k.uri+"].")},_onDestroyWidgetSetting:function(k){this.removeWidgetSettingStyle(k)},_removeWidget:function(k){if("string"===typeof k&&(k=this.getWidgetById(k),!k))return;this.activeWidget&&this.activeWidget.id===k.id&&(this.activeWidget=null);this._remove(k.id);0===this.getWidgetsByName(k.name).length&&this.removeWidgetStyle(k)},_getActiveEventName:function(){var k=
"PointerEvent"in window?"pointer":"MSPointerEvent"in window?"MSPointer":!1,w=k&&"MS"===k.slice(0,2);return k?k+(w?"Down":"down"):"mousedown"}});u.getInstance=function(k){null===A&&(A=new u(k),window._widgetManager=A);return A};return u})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/sniff esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils esri/layers/vectorTiles/kernel".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l){"function"!==typeof n.getAll&&(n.getAll=function(q){var A=[];(q=n(q))&&A.push(q);return A});b={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return g.isInConfigOrPreviewWindow()},isStringStartWith:function(q,A){return q.substr(0,A.length)===A},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(q){(q=a.getStandardPortalUrl(q))&&
(q+="/");this.portalUrl=q},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(q){var A=new x,u=a.getStandardPortalUrl(q);q=u+"/sharing";var k=a.setHttpsProtocol(u+"/sharing/generateToken?f\x3djson"),w=a.setHttpsProtocol(q);m.get(k,{jsonp:"callback"}).then(F.hitch(this,function(y){y.token?(this.webTierPortalUrls.push(u),this.removeWabAuthCookie(),h.id.getCredential(w).then(F.hitch(this,function(C){function D(H){var L=H.creationTime||(new Date).getTime(),T=H.expires;0<L&&0<T&&T>
L&&setTimeout(function(){m.get(k,{jsonp:"callback"}).then(function(K){K.token&&(H.token=K.token,H.expires=K.expires,H.creationTime=(new Date).getTime(),H.refreshServerTokens(),D(H))},function(K){console.error(K)})},.8*(T-L))}C.token||(C.token=y.token);C.expires||(C.expires=y.expires);var G=this.findServerFromCorsEnabledServers(C.server);-1<G&&p.defaults.io.corsEnabledServers.splice(G,1);this._pushCorsEnabledServerInfo({host:a.getServerByUrl(u),withCredentials:!0});A.resolve(!0);D(C)}),F.hitch(this,
function(){A.resolve(!0)}))):A.resolve(!1)}),F.hitch(this,function(y){console.error(y);A.reject(y)}));return A},addAuthorizedCrossOriginDomains:function(q){if(q&&0<q.length)for(var A=0;A<q.length;A++)this.addWithCredentialDomain(q[A])},addWithCredentialDomain:function(q){if(q&&"string"===typeof q){var A=p.defaults.io.corsEnabledServers,u=a.getServerByUrl(q);(q=a.getServerWithProtocol(q))||(q="http://"+u);q=this.findServerFromCorsEnabledServers(q);-1<q&&A.splice(q,1);this._pushCorsEnabledServerInfo({host:u,
withCredentials:!0})}},findServerFromCorsEnabledServers:function(q){var A=p.defaults.io.corsEnabledServers,u,k=-1;f("esri-cors")&&A&&A.length&&r.some(A,function(w,y){w=!w||"object"!==typeof w||w instanceof RegExp?w:w.host;return!(w instanceof RegExp)&&w&&(u=0!==w.trim().toLowerCase().indexOf("http"),c.hasSameOrigin(q,u?"http://"+w:w)||u&&c.hasSameOrigin(q,"https://"+w))?(k=y,!0):!1});return k},_pushCorsEnabledServerInfo:function(q){if(q){var A=p.defaults.io.corsEnabledServers,u="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof q&&"string"===typeof q.host){for(var k in q.host)q[k]="function"===typeof q.host[k]?function(){return q.host[k].apply(q.host,arguments)}:q.host[k];q.length=q.host.length;r.forEach(u,function(w){"function"===typeof q.host[w]&&(q[w]=function(){return q.host[w].apply(q.host,arguments)})})}A.push(q)}},tryRegisterCredential:function(q){return this.isValidCredential(q)?r.some(h.id.credentials,F.hitch(this,function(A){return q.token===A.token}))?!1:(h.id.credentials.push(q),!0):!1},
registerToken:function(q){var A=a.getSharingUrl(this.portalUrl);h.id.findCredential(A)&&r.some(h.id.credentials,F.hitch(this,function(u,k){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,u))return h.id.credentials.splice(k,1),!0}));return this._getTokenInfo(q).then(function(u){u&&h.id.registerToken(u)})},_getTokenInfo:function(q){var A=a.getPortalSelfInfoUrl(this.portalUrl);return m.get(A+("?f\x3djson\x26token\x3d"+q),{jsonp:"callback"}).then(F.hitch(this,function(u){return u.user?{server:a.getSharingUrl(this.portalUrl),
ssl:u.allSSL,token:q,userId:u.user.username}:null}),function(u){console.error(u);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(q){return q&&"string"===typeof q&&F.trim(q)},signInPortal:function(q){var A=new x;if(this._isInvalidPortalUrl(q)){q=a.getStandardPortalUrl(q);var u=a.getSharingUrl(q),k=this.getPortalCredential(q);k?setTimeout(F.hitch(this,function(){A.resolve(k)}),0):A=h.id.getCredential(u)}else setTimeout(F.hitch(this,function(){A.reject("Invalid portalurl.")}),
0);return A},_loadPortalSelfInfo:function(q){q=a.getPortalSelfInfoUrl(q);return e({url:q,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(q,A){if(!q||"string"!==typeof q||!A||"string"!==typeof A)return null;var u=h.id.findOAuthInfo(q);u||(u=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",u=new d({appId:A,expiration:20159,portalUrl:q,authNamespace:"/",popup:!0,popupCallbackUrl:u}),h.id.registerOAuthInfos([u]));
u.appId=A;return u},signOutAll:function(){var q=a.getStandardPortalUrl(this.portalUrl),A=!!h.id.findCredential(q+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();h.id.destroyCredentials();h.id._oAuthHash=null;A&&this._publishCurrentPortalUserSignOut(q)},userHaveSignInPortal:function(q){return!!this.getPortalCredential(F.trim(q||""))},isValidCredential:function(q){var A=!1;if(q){A=q.token;var u=q.server,k=q.scope;A=A&&"string"===typeof A&&
F.trim(A);u=u&&"string"===typeof u&&F.trim(u);k="portal"===k||"server"===k;var w=!0;q.expires&&(q=parseInt(q.expires,10),w=(new Date).getTime(),w=q>w);A=A&&u&&k&&w}return A},isValidPortalCredentialOfPortalUrl:function(q,A){var u=!1;this.isValidCredential(A)&&(u="portal"===A.scope,q=a.isSameServer(q,A.server),u=u&&q);return u},getPortalCredential:function(q){var A=null;q=F.trim(q||"");if(!q)return null;q=a.getStandardPortalUrl(q);(A=this._filterPortalCredential(q,h.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();
return A},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var q=this.portalUrl;if(q&&(q=a.getStandardPortalUrl(q),a.isOrgOnline(q)&&!this._filterPortalCredential(q,h.id.credentials))){var A=this._filterPortalCredential("http://www.arcgis.com",h.id.credentials);A&&h.id.registerToken({token:A.token,scope:"portal",userId:A.userId,server:q+"/sharing/rest",expires:A.expires})}},saveAndRegisterCookieToCredential:function(q){q=F.clone(q);q.referer=window.location.host;q.scope="portal";q.isAdmin=
!!q.isAdmin;this.saveWabCookie(q);var A=q.server+"/sharing/rest";q.server=A;h.id.registerToken(q);return h.id.findCredential(A,q.userId)},registerAuth2Hash:function(q){q=F.clone(q);var A=1E3*parseInt(q.expires_in,10);A=(new Date).getTime()+A;var u=a.getStandardPortalUrl(q.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:u,token:q.access_token,expires:A,userId:q.username,scope:"portal",isAdmin:!!q.isAdmin})},saveWabCookie:function(q){this.removeCookie("wab_auth");
n("wab_auth",v.stringify(q),{expires:new Date(q.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(q,A){var u=null;q=a.getStandardPortalUrl(q);A&&0<A.length&&(A=r.filter(A,F.hitch(this,function(k){return this.isValidPortalCredentialOfPortalUrl(q,
k)})),0<A.length&&(u=A[A.length-1]));return u},_removePortalCredential:function(q){var A=F.trim(q||"");if(A){A=a.getStandardPortalUrl(A);for(q=r.filter(h.id.credentials,F.hitch(this,function(u){return this.isValidPortalCredentialOfPortalUrl(A,u)}));0<q.length;)q[0].destroy(),q.splice(0,1);h.id.credentials=r.filter(h.id.credentials,F.hitch(this,function(u){return!this.isValidPortalCredentialOfPortalUrl(A,u)}))}},getUserIdByToken:function(q,A){var u=new x;if(q&&"string"===typeof q&&A&&"string"===typeof A){var k=
a.getStandardPortalUrl(A);A=r.filter(h.id.credentials,F.hitch(this,function(y){var C=y.token===q&&y.userId;y=a.isSameServer(k,y.server);return C&&y}));if(0<A.length){var w=A[0];setTimeout(F.hitch(this,function(){u.resolve(w.userId)}),0);return u}A=a.getCommunitySelfUrl(k);e({url:A,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(F.hitch(this,function(y){u.resolve(y&&y.username||"")}),F.hitch(this,function(y){console.error(y);u.reject("fail to get userId by token")}))}else setTimeout(F.hitch(this,
function(){u.reject("invalid parameters")}),0);return u},xtGetCredentialFromCookie:function(q){var A=n("wab_auth"),u=null;if(A)try{u=v.parse(A)}catch(k){console.error(k)}if(!u||"object"!==typeof u||!a.isSameServer(q,u.server)||window.location.host!==u.referer)return null;u.expires=parseInt(u.expires,10);A=(new Date).getTime();if(!(u.expires>A))return this.removeCookie("wab_auth"),null;q+="/sharing/rest";u.server=q;(A=h.id.findCredential(q))||h.id.registerToken(u);return A=h.id.findCredential(q)},
removeCookie:function(q){var A=this.getCookiePath();g.removeCookie(q,A)},_getDomainsByServerName:function(q){var A=q.split("."),u=A.length;return r.map(A,F.hitch(this,function(k,w){k=A.slice(w,u);var y="",C=k.length-1;r.forEach(k,F.hitch(this,function(D,G){y+=D;G!==C&&(y+=".")}));return y}))},_publishCurrentPortalUserSignIn:function(q){if(this.isValidCredential(q))try{t.publish("userSignIn",q)}catch(A){console.error(A)}},_publishAnyUserSignIn:function(q){if(this.isValidCredential(q))try{t.publish("anyUserSignIn",
q)}catch(A){console.error(A)}},_publishCurrentPortalUserSignOut:function(q){try{t.publish("userSignOut",q)}catch(A){console.error(A)}},_signInSuccess:function(q){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,q)&&this._publishCurrentPortalUserSignIn(q),this._publishAnyUserSignIn(q)}catch(A){console.error(A)}},_bindEvents:function(){z.after(h.id,"signIn",F.hitch(this,function(q,A){console.log(A[1]);z.after(q,"callback",F.hitch(this,function(u,k){this._signInSuccess(k[0],!1)}));return q}))},
isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var q=window.parent;if(q){var A=q.esri&&q.esri.id;A._wab="builder";if(A){h.id=A;var u=window.esriConfig.defaults.io;q=q.esriConfig.defaults.io;u.corsEnabledServers=q.corsEnabledServers;u.webTierAuthServers=q.webTierAuthServers;u._processedCorsServers=q._processedCorsServers;u.corsStatus=q.corsStatus;Object.defineProperty(l,"id",{get:function(){return A},enumerable:!0,configurable:!0})}}}this._bindEvents();
this._started=!0}}};b.startup();return b})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(F,r,z,x){return function(){function n(){}Object.defineProperty(n,"id",{get:function(){return z.id?x:null},enumerable:!0,configurable:!0});n.workerMessages={};return n}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require","exports","esri/IdentityManager"],function(F,r,z){Object.defineProperty(r,"__esModule",
{value:!0});r.findCredential=function(x){return z.findCredential(x)}})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(F,r,z,x,n,v){return F(v,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,customZIndex:null,postMixInProperties:function(){this.content=this.message;window.currentMsgPopup=this},_createTitleNode:function(){this.titleLabel&&
(this.titleNode=z.create("div",{"class":"title"},this.domNode),this.titleLabeNode=z.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=z.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",role:"button",tabindex:0},this.titleNode),this.own(n(this.closeBtnNode,"click",r.hitch(this,this.close))),this.own(n(this.closeBtnNode,"keydown",r.hitch(this,function(t){t.keyCode===x.ENTER&&(this.close(),this.focusLastActiveNode())}))))},
_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:x.ENTER,onClick:r.hitch(this,this.close)})},_increaseZIndex:function(){z.setStyle(this.domNode,"zIndex",501);z.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/Evented dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/keys dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){var d=0;return F([f,z],{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",classNames:[],titleLabel:"",content:null,container:null,customZIndex:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,isResize:!0,horizontalWidthRate:0,maxHeight:800,maxWidth:1024,enableMoveable:!0,hasTitle:!0,contentHasNoMargin:!1,hasOverlay:!0,moveToCenter:!0,customPosition:null,hiddenAfterInit:!1,useFocusLogic:!0,constructor:function(){this.buttons=
[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},focusLastActiveNode:function(){this.focusedNodeBeforeOpen&&this.useFocusLogic&&this.focusedNodeBeforeOpen.focus()},postCreate:function(){this.focusedNodeBeforeOpen=document.activeElement;this._preProcessing();this.inherited(arguments);this._initDomNode();this._addStylesByHeightType();this._calcAndSetPosition();n.place(this.domNode,this.container);setTimeout(r.hitch(this,function(){this._calcAndSetPosition(!0,
!1);this.initFocusNodes()}),50);this.isResize&&this.own(t(window,"resize",r.hitch(this,function(){this._calcAndSetPosition(!0,!0)})));this.hasOverlay&&(this.overlayNode=n.create("div",{"class":"jimu-overlay"},this.container));this.customZIndex||0===this.customZIndex?(n.setStyle(this.domNode,"zIndex",this.customZIndex+1),this.overlayNode&&n.setStyle(this.overlayNode,"zIndex",this.customZIndex)):this._increaseZIndex();this.hiddenAfterInit&&this.hide();v.animateProperty({node:this.domNode,properties:{opacity:1},
duration:200}).play();n.setAttr(this.domNode,"aria-label",window.jimuNls.common.popup);this.own(t(this.domNode,"keydown",r.hitch(this,function(a){a.keyCode===m.ESCAPE&&(this.closeBtnNode?this.closeBtnNode.focus():(this.close(),this.focusLastActiveNode()));b.preventMapNavigation(a)})))},initFocusNodes:function(){if(this.useFocusLogic){if("string"===typeof this.content){var a="uniqMsgId_"+b.getUUID();n.setAttr(this.contentContainerNode,"id",a);n.setAttr(this.domNode,"tabindex","0");n.setAttr(this.domNode,
"aria-labelledby",a)}this.firstFocusNode=this._getFirstFocusNode();this.lastFocusNode=this._getLastFocusNode();this.firstFocusNode&&(this.own(t(this.firstFocusNode,"keydown",r.hitch(this,function(g){g.shiftKey&&g.keyCode===m.TAB&&(g.preventDefault(),this.firstFocusNode.focus())}))),this.firstFocusNode.focus());this.lastFocusNode&&this.own(t(this.lastFocusNode,"keydown",r.hitch(this,function(g){g.shiftKey||g.keyCode!==m.TAB||(g.preventDefault(),this.firstFocusNode.focus())})))}},_getFirstFocusNode:function(){var a=
this.closeBtnNode;"string"===typeof this.content&&(a=this.domNode);if(!a){var g=[];this.content.domNode?g=b.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(g=b.getFocusNodesInDom(this.content));0<g.length?a=g[0]:this.buttons.length&&(a=this._getFirstBtn())}return a},_getLastFocusNode:function(){var a=this._getLastBtn();if(!a)if(this.content&&"string"!==typeof this.content){var g;this.content.domNode?g=b.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(g=b.getFocusNodesInDom(this.content));
a=0<g.length?g[g.length-1]:this.closeBtnNode}else a=this.closeBtnNode;return a},_getFirstBtn:function(){for(var a=null,g=e(".jimu-btn",this.buttonContainer),l=0;l<=g.length-1;l++)if("none"!==n.getStyle(g[l],"display")){a=g[l];break}return a},_getLastBtn:function(){for(var a=null,g=e(".jimu-btn",this.buttonContainer),l=g.length-1;0<=l;l--)if("none"!==n.getStyle(g[l],"display")){a=g[l];break}return a},_preProcessing:function(){"number"!==typeof this.width&&(this.width=this.maxWidth);"number"===typeof this.height&&
(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=n.create("div",{"class":"title"},this.domNode);this.titleLabeNode=n.create("span",{"class":"title-label jimu-float-leading",innerHTML:b.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=n.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",tabindex:0,"aria-label":window.jimuNls.common.close,role:"button"},this.titleNode);
var a=null;a="ontouchstart"in document?p.press:"click";this.own(t(this.closeBtnNode,a,r.hitch(this,this.close)));this.own(t(this.closeBtnNode,"keydown",r.hitch(this,function(g){g.keyCode!==m.ENTER&&g.keyCode!==m.SPACE||this.close()})))},_initDomNode:function(){for(var a=0;a<=this.classNames.length-1;a++)n.addClass(this.domNode,this.classNames[a]);this.hasTitle&&this._createTitleNode();this.contentContainerNode=n.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?
this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&n.place(this.content,this.contentContainerNode));this.buttonContainer=n.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&n.setStyle(this.buttonContainer,"display","none");for(a=0;a<=this.buttons.length-1;a++)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=
this.enabledButtons.length;if(0!==a){var g=n.getContentBox(this.buttonContainer),l=n.getMarginExtents(this.enabledButtons[0]),q=n.getPadBorderExtents(this.enabledButtons[0]),A=0;q=8===h("ie")?q.l+q.r:0;A=(g.w-(l.l+l.r+q)*a)/a;0<A&&(x.forEach(this.enabledButtons,r.hitch(this,function(u){n.setStyle(u,"maxWidth",A+"px")})),x.forEach(this.disabledButtons,r.hitch(this,function(u){n.setStyle(u,"maxWidth",A+"px")})))}},_moveableNode:function(a,g){this.moveable&&(this.moveable.destroy(),this.moveable=null);
var l=n.getMarginBox(this.container);l.l=l.l-a+g;l.w+=2*(a-g);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:l,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(t(this.moveable,"Moving",r.hitch(this,this.onMoving)));this.own(t(this.moveable,"MoveStop",r.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===e("#header").length?{t:0,l:0,w:0,h:0}:n.getMarginBox("header")},_getFooterBox:function(){return 0===e(".footer",this.container).length?{t:0,l:0,w:0,
h:0}:n.getMarginBox(e(".footer",this.container)[0])},_calcAndSetPosition:function(a,g){var l=n.getMarginBox(this.domNode);if("string"!==typeof this.container||n.byId(this.container)){var q=n.getContentBox(this.container),A=this._getHeaderBox(),u=this._getFooterBox();u=q.h-A.h-u.h-40;var k=0,w=0;this.customPosition&&this.customPosition.height?(this.height=this.customPosition.height,w="number"===typeof this.height?this.height+"px":this.height):(this.height=this._fixedHeight?this.height>u?u:this.height:
this.autoHeight?(l.h>u?u:l.h)||u-200:u>this.maxHeight?this.maxHeight:u,w=this.height+"px");this.customPosition&&this.customPosition.width?(this.width=this.customPosition.width,k="number"===typeof this.width?this.width+"px":this.width):("number"===typeof this.horizontalWidthRate&&0<this.horizontalWidthRate?(k=n.getMarginBox(window.document.body).w*this.horizontalWidthRate,this.width=k=k>this.maxWidth?k:this.maxWidth):this.width=this.width||this.maxWidth,k=this.width+"px");var y=l=0;this.customPosition?
(l="number"===typeof this.customPosition.left?this.customPosition.left+"px":this.customPosition.left,y="number"===typeof this.customPosition.top?this.customPosition.top+"px":this.customPosition.top):this.moveToCenter&&(y=(u-this.height)/2+A.h+20,y=y<A.h?A.h:y,l=(q.w-this.width)/2+"px",y+="px");n.setStyle(this.domNode,{width:k,height:this.autoHeight?"auto":w,left:l,top:y});this.enableMoveable&&this._moveableNode(this.width,100);!this.moveToCenter&&a&&"block"===n.getStyle(this.domNode,"display")&&this.emit("popupHasInitedSuccessfully",
g)}},setDomNodeStyls:function(a){n.setStyle(this.domNode,a)},setCustomPosition:function(a,g,l,q){this.width=l||this.width||this.maxWidth;this.height=q||this.height||this.maxHeight;l="number"===typeof this.width?this.width+"px":this.width;q="number"===typeof this.height?this.height+"px":this.height;n.setStyle(this.domNode,{left:"number"===typeof a?a+"px":a,top:"number"===typeof g?g+"px":g,width:l,height:this.autoHeight?"auto":q})},_addStylesByHeightType:function(){this.autoHeight?(n.addClass(this.contentContainerNode,
"content-static"),0===this.buttons.length&&n.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(n.addClass(this.contentContainerNode,"content-absolute"),this.hasTitle||n.addClass(this.contentContainerNode,"no-popup-title-content-absolute"),n.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&n.setStyle(this.contentContainerNode,{bottom:"15px"}));this.contentHasNoMargin&&n.addClass(this.contentContainerNode,"content-fill-Popup")},_increaseZIndex:function(){n.setStyle(this.domNode,
"zIndex",d+200+1);this.overlayNode&&n.setStyle(this.overlayNode,"zIndex",d+200);d++},setTitleLabel:function(a){this.titleNode.innerHTML=b.stripHTML(a)},onMoving:function(a){n.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){n.setStyle(a.node,"opacity",1)},show:function(){this.overlayNode&&n.setStyle(this.overlayNode,"display","block");n.setStyle(this.domNode,"display","block")},hide:function(){this.overlayNode&&n.setStyle(this.overlayNode,"display","none");n.setStyle(this.domNode,"display","none")},
close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,g=r.clone(this.domNode);n.setStyle(this.domNode,"display","none");this.overlayNode&&n.destroy(this.overlayNode);this.destroy();this.moveable&&this.moveable.destroy();n.place(g,a);v.animateProperty({node:g,properties:{opacity:0},duration:200,onEnd:function(){n.destroy(g)}}).play();this.focusLastActiveNode();window.currentMsgPopup=null}},addButton:function(a){this._createButton(a)},_createButton:function(a){var g=
" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(g+=a.classNames.join(" "));var l=n.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+g,innerHTML:a.label,tabindex:0,role:"button",title:a.title||a.label},this.buttonContainer);this.enabledButtons.push(l);g=n.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+g,title:a.title||a.label,innerHTML:a.label,tabindex:0,role:"button",
"aria-disabled":"true",style:{display:"none"}},this.buttonContainer);this.disabledButtons.push(g);this.own(t(l,"click",r.hitch(this,function(q){if(a.onClick)a.onClick(q);else this.close()})));this.own(t(l,"keydown",r.hitch(this,function(q){if(q.keyCode===m.ENTER||q.keyCode===m.SPACE)if(a.onClick)a.onClick(q);else this.close()})))},setButtonProps:function(a,g){"number"===typeof a&&isFinite(a)||(g=a,a=0);if(g&&0!==this.enabledButtons.length)for(var l in g)"title"===l?(n.setAttr(this.enabledButtons[a],
"title",g[l]),n.setAttr(this.disabledButtons[a],"title",g[l])):"label"===l&&(n.setProp(this.enabledButtons[a],"innerHTML",g[l]),n.setProp(this.disabledButtons[a],"innerHTML",g[l]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(n.setStyle(this.enabledButtons[a],"display","inline-block"),n.setStyle(this.disabledButtons[a],"display","none")):(x.forEach(this.enabledButtons[a],r.hitch(this,function(g){n.setStyle(g,"display","inline-block")})),x.forEach(this.disabledButtons[a],
r.hitch(this,function(g){n.setStyle(g,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(n.setStyle(this.disabledButtons[a],"display","inline-block"),n.setStyle(this.enabledButtons[a],"display","none")):(x.forEach(this.disabledButtons,r.hitch(this,function(g){n.setStyle(g,"display","inline-block")})),x.forEach(this.enabledButtons,r.hitch(this,function(g){n.setStyle(g,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(n.setStyle(this.disabledButtons[a],"display","none"),n.setStyle(this.enabledButtons[a],"display","none")):(x.forEach(this.disabledButtons,r.hitch(this,function(g){n.setStyle(g,"display","none")})),x.forEach(this.enabledButtons,r.hitch(this,function(g){n.setStyle(g,"display","none")})))},resize:function(a){a&&(this.width=a.w,this.height=a.h);this._calcAndSetPosition();this.content&&this.content.domNode&&this.content.resize&&
this.content.resize()}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(F,r,z,x,n,v){x=F("dojo.dnd.move.constrainedMoveable",v,{constraints:function(){},within:!1,constructor:function(t,m){m||(m={});this.constraints=m.constraints;this.within=m.within},onFirstMove:function(t){var m=this.constraintBox=this.constraints.call(this,t);m.r=m.l+m.w;m.b=m.t+m.h;this.within&&(t=r.getMarginSize(t.node),m.r-=t.w,m.b-=t.h)},
onMove:function(t,m){var h=this.constraintBox,p=t.node.style;this.onMoving(t,m);m.l=m.l<h.l?h.l:h.r<m.l?h.r:m.l;m.t=m.t<h.t?h.t:h.b<m.t?h.b:m.t;p.left=m.l+"px";p.top=m.t+"px";this.onMoved(t,m)}});n=F("dojo.dnd.move.boxConstrainedMoveable",x,{box:{},constructor:function(t,m){var h=m&&m.box;this.constraints=function(){return h}}});F=F("dojo.dnd.move.parentConstrainedMoveable",x,{area:"content",constructor:function(t,m){var h=m&&m.area;this.constraints=function(){var p=this.node.parentNode,e=z.getComputedStyle(p),
c=r.getMarginBox(p,e);if("margin"==h)return c;var f=r.getMarginExtents(p,e);c.l+=f.l;c.t+=f.t;c.w-=f.w;c.h-=f.h;if("border"==h)return c;f=r.getBorderExtents(p,e);c.l+=f.l;c.t+=f.t;c.w-=f.w;c.h-=f.h;if("padding"==h)return c;f=r.getPadExtents(p,e);c.l+=f.l;c.t+=f.t;c.w-=f.w;c.h-=f.h;return c}}});return{constrainedMoveable:x,boxConstrainedMoveable:n,parentConstrainedMoveable:F}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils jimu/filterUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){var a=null,g=F(n,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};this.filterUtils=new e;window.isBuilder?(x.subscribe("app/mapLoaded",r.hitch(this,this._onMapLoaded)),x.subscribe("app/mapChanged",r.hitch(this,this._onMapChanged))):(x.subscribe("mapLoaded",r.hitch(this,this._onMapLoaded)),x.subscribe("mapChanged",r.hitch(this,this._onMapChanged)));window.isBuilder?
(x.subscribe("app/appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)),x.subscribe("app/appConfigChanged",r.hitch(this,this._onAppConfigChanged))):(x.subscribe("appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)),x.subscribe("appConfigChanged",r.hitch(this,this._onAppConfigChanged)));x.subscribe("updateDataSourceData",r.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&x.subscribe("app/dataSourceDataUpdated",r.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(l){return this._dataStore[l]},
getDataSourceConfig:function(l){return this.appConfig.dataSource.dataSources[l]},parseDataSourceId:function(l){var q=l.split("~"),A={};if(2>q.length)return console.error("Bad data source id:",l),A;switch(q[0]){case "map":return q=l.lastIndexOf("~"),A={from:"map",layerId:l.substring(4,q)};case "widget":return A={from:"widget",widgetId:q[1]};case "external":return A={from:"external"};default:console.error("Bad data source id:",l)}},addDataSourceUsage:function(l,q){this._dataSourceUsage[l]?(0>this._dataSourceUsage[l].indexOf(q)&&
this._dataSourceUsage[l].push(q),1===this._dataSourceUsage[l].length&&this._startOneDataSource(this.appConfig.dataSource.dataSources[l])):(this._dataSourceUsage[l]=[q],this._startOneDataSource(this.appConfig.dataSource.dataSources[l]))},removeDataSourceUsage:function(l,q){this._dataSourceUsage[l]&&0<=this._dataSourceUsage[l].indexOf(q)&&(this._dataSourceUsage[l]=z.filter(this._dataSourceUsage[l],function(A){return A!==q}))},_onUpdataDataSourceData:function(l,q){this.appConfig.dataSource.dataSources[l]?
"widget"!==this.parseDataSourceId(l).from?console.error("Please update data source from widget only.",l):this._updateDataSourceData(l,q):console.error("Not found data source id:",l)},_updateDataSourceData:function(l,q){this._dataStore[l]=q;x.publish("dataSourceDataUpdated",l,q);this.emit("update",l,q)},_onDataSourceDataUpdatedInApp:function(l,q){this._updateDataSourceData(l,q)},_onMapLoaded:function(l){this.map=l;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},
_onMapChanged:function(l){this.map=l;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapChanged")},_onAppConfigLoaded:function(l){this.appConfig=r.clone(l)},_onAppConfigChanged:function(l,q){l=r.clone(l);window.isBuilder||("dataSourceChange"===q?this._handleDataSourceConfigChange(this.appConfig,l,q):"mapChange"===q&&this._cleanForConfigChangedDataSource(this.appConfig,l));this.appConfig=l},_handleDataSourceConfigChange:function(l,q,A){l&&(this._removeListeners(),
this._removeTimers(),this._cleanForConfigChangedDataSource(l,q));z.forEach(Object.keys(q.dataSource.dataSources),function(u){q.dataSource.dataSources[u].idObj=this.parseDataSourceId(u)},this);this._listenDataSourceChange(q.dataSource.dataSources);this._startRefreshTimer(q.dataSource,A);this._initStaticDataSource(q.dataSource)},_cleanForConfigChangedDataSource:function(l,q){var A=l.dataSource.dataSources,u=q.dataSource.dataSources;z.forEach(Object.keys(A),function(k){if(!u[k]||u[k]&&!t.isEqual(u[k],
A[k]))delete this._jimuQueryObject[k],this._updateDataSourceData(k,{features:[]}),delete this._dataStore[k]},this)},_isGlobalRefresh:function(l){return l.unifiedRefreshInterval&&0<l.unifiedRefreshInterval},_startOneDataSource:function(l){var q=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:l.refreshInterval;if("map"===l.idObj.from)this._listenMapDataSourceChange(l);else if("external"===l.idObj.from&&l.filterByExtent){var A={};A.handle=
this.map.on("extent-change",r.hitch(this,this._onLayerDataChange,l));A.dsId=l.id;this._listeners.push(A)}if("map"===l.idObj.from||"external"===l.idObj.from)this._refeshDataSource(l),l.isDynamic&&(A={},A.handle=setInterval(r.hitch(this,this._refeshDataSource,l),6E4*q),A.dsId=l.id,this._refreshTimers.push(A))},_stopAndCleanOneDataSource:function(l){this._listeners=z.filter(this._listeners,function(q){return q.dsId===l.id?(q.handle.remove(),!1):!0},this);this._refreshTimers=z.filter(this._refreshTimers,
function(q){return q.dsId===l.id?(clearInterval(q.handle),!1):!0},this);this._updateDataSourceData(l.id,{features:[]})},_listenDataSourceChange:function(l){z.forEach(Object.keys(l),function(q){q=l[q];if("map"===q.idObj.from)this._listenMapDataSourceChange(q);else if("external"===q.idObj.from&&q.filterByExtent){var A={};A.handle=this.map.on("extent-change",r.hitch(this,this._onLayerDataChange,q));A.dsId=q.id;this._listeners.push(A)}},this)},_listenMapDataSourceChange:function(l){this._getLayerObject(l.idObj.layerId).then(r.hitch(this,
function(q){if(q){var A={};A.handle=q.on("edits-complete",r.hitch(this,this._onLayerDataChange,l));A.dsId=l.id;this._listeners.push(A);A={};A.handle=this._getLayerInfo(l.idObj.layerId).on("filterChanged",r.hitch(this,this._onLayerDataChange,l));A.dsId=l.id;this._listeners.push(A);l.filterByExtent&&(A={},A.handle=this.map.on("extent-change",r.hitch(this,this._onLayerDataChange,l)),A.dsId=l.id,this._listeners.push(A))}else console.error("Can not find layer that data source depends on.",l.id)}))},_onLayerDataChange:function(l){this._doQueryForDataSource(l)},
_doQueryForDataSource:function(l){("config"===this.appConfig.mode||this._dataSourceUsage[l.id]&&0!==this._dataSourceUsage[l.id].length)&&this.doQuery(l).then(r.hitch(this,function(q){this._updateDataSourceData(l.id,{features:q.features})}))},_getLayerObject:function(l){return(l=m.getInstanceSync().getLayerOrTableInfoById(l))?l.getLayerObject():v(null)},_getLayerInfo:function(l){return m.getInstanceSync().getLayerOrTableInfoById(l)},_startRefreshTimer:function(l,q){var A=l.dataSources,u=l.settings;
z.forEach(Object.keys(A),function(k){k=A[k];if("widget"!==k.idObj.from&&k.isDynamic&&k.url){var w=this._isGlobalRefresh(u)?u.unifiedRefreshInterval:k.refreshInterval;"dataSourceChange"===q?("external"===k.idObj.from||"map"===k.idObj.from)&&this._refeshDataSource(k):"external"===k.idObj.from&&this._refeshDataSource(k);k={handle:setInterval(r.hitch(this,this._refeshDataSource,k),6E4*w),dsId:l.id};this._refreshTimers.push(k)}},this)},_initStaticDataSource:function(l){z.forEach(Object.keys(l.dataSources),
function(q){q=l.dataSources[q];"widget"!==q.idObj.from&&!q.isDynamic&&q.url&&this._doQueryForDataSource(q)},this)},_refeshDataSource:function(l){this._doQueryForDataSource(l)},_getDataSourceFilter:function(l){if("map"===l.idObj.from){var q=m.getInstanceSync().getLayerOrTableInfoById(l.idObj.layerId),A;q&&(A=q.getFilter());q=l.filter?this._getFilterExpr(l.filter,l.url):"1\x3d1";var u=A?"("+A+") and ("+q+")":q;return v(u)}return"external"===l.idObj.from?l.portalUrl&&l.itemId?this._getFilterFromItem(l.portalUrl,
l.itemId,l.url).then(r.hitch(this,function(k){var w=l.filter?this._getFilterExpr(l.filter,l.url):"1\x3d1";return u=k?"("+k+") and ("+w+")":w})):v(l.filter?this._getFilterExpr(l.filter,l.url):"1\x3d1"):v(l.filter?this._getFilterExpr(l.filter,l.url):"1\x3d1")},_getFilterExpr:function(l,q){return this.filterUtils.hasVirtualDate(l)?(this.filterUtils.isHosted=t.isHostedService(q),this.filterUtils.getExprByFilterObj(l)):l.expr},_getFilterFromItem:function(l,q,A){var u=p.getItemUrl(l,q);if(this._itemsFilter[u])return v(this._itemsFilter[u]);
var k=h.getPortal(l);return k.getItemById(q).then(r.hitch(this,function(w){return"Feature Service"!==w.type?this._itemsFilter[u]=null:k.getItemData(q).then(r.hitch(this,function(y){var C=A.split("/"),D=C.pop();D||(D=C.pop());if(!y.layers)return this._itemsFilter[u]=null;y=y.layers.filter(function(G){return G.id+""===D})[0];return y&&y.layerDefinition?this._itemsFilter[u]=y.layerDefinition.definitionExpression:this._itemsFilter[u]=null}))}))},doQuery:function(l){l.idObj||(l.idObj=this.parseDataSourceId(l.id));
this.emit("begin-update",l.id);return this._getQueryObjectFromDataSource(l).then(r.hitch(this,function(q){if("Features"===l.type){if("serviceLimitation"===l.resultRecordType){var A=q;var u=new f(l.url);return u.execute(A)}var k=this._jimuQueryObject[l.id];!k||k.url===l.url&&t.isEqual(k.query.toJson(),q.toJson())||(delete this._jimuQueryObject[l.id],k=null);k||(k={},k.url=l.url,k.query=q,"all"!==l.resultRecordType&&(k.pageSize=l.resultRecordCount),k=new d(k),this._jimuQueryObject[l.id]=k);return"all"===
l.resultRecordType?k.getAllFeatures():k.queryByPage(1)}u=new f(l.url);A=new c;return this._getDataSourceFilter(l).then(r.hitch(this,function(w){A.where=w;l.filterByExtent&&(A.geometry=this.map.extent);l.dataSchema.groupByFields&&0<l.dataSchema.groupByFields.length&&(A.groupByFieldsForStatistics=l.dataSchema.groupByFields);l.dataSchema.orderByFields&&0<l.dataSchema.orderByFields.length&&(A.orderByFields=l.dataSchema.orderByFields);A.outStatistics=l.dataSchema.statistics.map(function(y){var C=y.onStatisticField+
"_"+y.statisticType;"count"===y.statisticType&&(C="STAT_COUNT");C=t.upperCaseString(C);var D=new b;D.statisticType=y.statisticType;D.onStatisticField=y.onStatisticField;D.outStatisticFieldName=C;return D});return u.execute(A)}))}))},_getQueryObjectFromDataSource:function(l){return this._getDataSourceFilter(l).then(r.hitch(this,function(q){var A=new c;A.where=q;l.filterByExtent&&(A.geometry=this.map.extent);A.outFields=l.dataSchema.fields.map(function(u){return u.name});l.dataSchema.orderByFields&&
0<l.dataSchema.orderByFields.length&&(A.orderByFields=l.dataSchema.orderByFields);A.returnGeometry=!0;A.outSpatialReference=this.map.spatialReference;return v(A)}))},_removeListeners:function(){this._listeners.forEach(r.hitch(this,function(l){l.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(r.hitch(this,function(l){clearInterval(l.handle)}));this._refreshTimers=[]}});g.getInstance=function(){null===a&&(a=new g,window._datasourceManager=a);return a};return g})},
"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory libs/crc".split(" "),function(F,r,z,x,n,v,t,m,h,p){var e=F([t],{declaredClass:"jimu.LayerInfos",map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayerInfos:null,_finalBasemapLayerInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,_layerInfoFactory:null,
_previousLayerOrder:null,constructor:function(b,d){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=d.baseMap.baseMapLayers;this._operLayers=d.operationalLayers;this._tables=d.tables;this._layerInfoFactory=new h(b,this);this.map=b;this._previousLayerOrder=[].concat(this.map.layerIds,this.map.graphicsLayerIds);this._initLayerInfos();this._initBasemapLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();
this._clearAddedFlag(this._finalLayerInfos);this._clearAddedFlag(this._finalBasemapLayerInfos);this._initFinalLayerInfos();this._initFinalBasemapLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var b=[];r.forEach(this.getLayerInfoArray(),function(d){for(var a=0;a<this._operLayers.length;a++)if(d.id===this._operLayers[a].id){b.push(d);break}a===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(d.id)&&b.push(d)},this);return b},getTableInfoArrayOfWebmap:function(){var b=
[];r.forEach(this.getTableInfoArray(),function(d){for(var a=0;a<this._tables.length;a++)if(d.id===this._tables[a].id){b.push(d);break}},this);return b},getLayerInfoArray:function(){return r.filter(this._finalLayerInfos,function(b){z.getObject("_wabProperties.isTemporaryLayer",!1,b.layerObject)&&(b._flag._isTemporaryLayerInfo=!0);return!b._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},getBasemapLayerInfoArray:function(){return this._finalBasemapLayerInfos},addFeatureCollection:function(b,
d){var a=this._getUniqueTopLayerInfoId(d),g={layers:[]};r.forEach(b,function(q,A){q.id=a+"_"+A;g.layers.push({id:q.id,layerObject:q})},this);this.map.addLayers(b);try{var l=this._layerInfoFactory.create({featureCollection:g,title:d||a,id:a},this.map);l.init()}catch(q){console.warn(q.message),l=null}l&&(l._extraOfWebmapLayerInfo=!0,this._layerInfos.push(l),this.update(),this._onLayersUpdated(l,l.getRootLayerInfo()))},addTable:function(b){b=this._addTables([b],this._tableInfos);return b[0]?b[0]:null},
removeTable:function(b){var d=-1;r.forEach(this._tableInfos,function(g,l){b.id===g.id&&(d=l)});if(0<=d){var a=this._tableInfos[d];this._tableInfos.splice(d,1);a.destroy();this._onTableChange([b],e.REMOVED)}},_addTables:function(b,d){var a=[],g=[];r.forEach(b,function(l){try{l.layerObject={url:l.url,featureCollectionData:l.featureCollectionData,empty:!0};l.id=this._getUniqueTableId(l.id);l.selfType="table";var q=this._layerInfoFactory.create(l);q.init()}catch(A){console.warn(A.message),q=null}q&&(a.push(q),
d.push(q),g.push(q.getLayerObject()))},this);m(g).then(z.hitch(this,function(l){var q=[];r.forEach(l,function(A,u){u=a[u];A?q.push(u):(this.removeTable(u),u.destroy())},this);this._onTableChange(q,e.ADDED)}));return a},_getUniqueTableId:function(b){var d=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(b,d)},_getUniqueTopLayerInfoId:function(b){return this._getUniqueLayerOrTableId(b,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(b,d){var a=1,g;b||(b="table");
for(g=b;;){for(var l=0;l<d.length&&d[l].id!==g;l++);if(l===d.length)return g;g=b+"_"+a.toString();a++}},_traversal:function(b,d){for(var a=0;a<d.length;a++)if(d[a].traversal(b))return!0;return!1},traversal:function(b){var d=this.getLayerInfoArray();return this._traversal(b,d)},traversalLayerInfosOfWebmap:function(b){var d=this.getLayerInfoArrayOfWebmap();return this._traversal(b,d)},traversalAll:function(b){var d=this.getLayerInfoArray(),a=this.getBasemapLayerInfoArray(),g=this.getTableInfoArray();
d=d.concat(a.concat(g));return this._traversal(b,d)},_traversalAllWithSpecialLayerInfo:function(b){return this._traversal(b,this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(b){return this._findLayerInfoById(b)},getTableInfoById:function(b){var d=null;r.some(this.getTableInfoArray(),function(a){if(a.id===b)return d=a,!0});return d},getLayerOrTableInfoById:function(b){var d=null;this.traversalAll(function(a){if(a.id===b)return d=a,!0});return d},getLayerInfoByTopLayerId:function(b){return this._findTopLayerInfoById(b)},
moveUpLayer:function(b,d){var a=null;d=d?d:1;b=this._getTopLayerInfoIndexById(b.id);0<=b-d&&(a=this._finalLayerInfos[b-d].obtainLayerIndexesInMap().length,this._finalLayerInfos[b].moveRightOfIndex(this._finalLayerInfos[b-d].obtainLayerIndexesInMap()[a-1].index),a=this._finalLayerInfos[b-d]);return a},_reorderLayerInfosArray:function(b,d,a){"moveup"===a?(a=this._finalLayerInfos[b],this._finalLayerInfos.splice(b,1),this._finalLayerInfos.splice(b-d,0,a)):(a=this._finalLayerInfos[b],this._finalLayerInfos.splice(b+
d+1,0,a),this._finalLayerInfos.splice(b,1));this._markFirstOrLastNode();return a},moveDownLayer:function(b,d){var a=null;d=d?d:1;b=this._getTopLayerInfoIndexById(b.id);b+d<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[b].moveLeftOfIndex(this._finalLayerInfos[b+d].obtainLayerIndexesInMap()[0].index),a=this._finalLayerInfos[b+d]);return a},getBasemapLayers:function(){var b=[];r.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(d){d=this.map.getLayer(d);"basemap"!==d._basemapGalleryLayerType&&
"reference"!==d._basemapGalleryLayerType||b.push(d)},this);return b.reverse()},getMapNotesLayerInfoArray:function(){return r.filter(this.getLayerInfoArray(),function(b){return b.isMapNotesLayerInfo()},this)},restoreState:function(b){var d=b&&b.layerOptions?b.layerOptions:null;r.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(d)},this)},_getEncodedLayerIdsOfCurrentMap:function(){this._encodedLayerIds||(this._encodedLayerIds={encodedToLayerIds:{},layerIdsToEncoded:{}},this.traversal(z.hitch(this,
function(b){var d=this._encodeLayerId(b.id);this._encodedLayerIds.encodedToLayerIds[d]=b.id;this._encodedLayerIds.layerIdsToEncoded[b.id]=d})));return this._encodedLayerIds},_getShowOrHideLayerIdsBySimpleState:function(b){var d=[],a=[],g={showLayerIds:null,hideLayerIds:null},l=this._getEncodedLayerIdsOfCurrentMap().encodedToLayerIds;b&&b.showLayersEncoded&&l?(r.forEach(b.showLayersEncoded,function(q){(q=l[q])&&d.push(q)}),g.showLayerIds=d):b&&b.showLayers?g.showLayerIds=b.showLayers:b&&b.hideLayersEncoded&&
l?(r.forEach(b.hideLayersEncoded,function(q){(q=l[q])&&a.push(q)}),g.hideLayerIds=a):b&&b.hideLayers&&(g.hideLayerIds=b.hideLayers);return g},_getSibilingLayerInfos:function(b){return b.isRootLayer()?this._finalLayerInfos:b.parentLayerInfo.getSubLayers()},_revertSibilingLayersOnState:function(b,d,a){b=this._getSibilingLayerInfos(b);r.some(b,z.hitch(this,function(g){g=g.id;d.layerOptions[g]||(d.layerOptions[g]={visible:a})}))},setSimplificationState:function(b){var d={layerOptions:{}},a=this._getShowOrHideLayerIdsBySimpleState(b);
this.traversal(z.hitch(this,function(g){var l=null;if(a.showLayerIds){var q=a.showLayerIds;var A=!0}else q=a.hideLayerIds,A=!1;r.some(q,function(u){if(g.id===u)return l=g.id,!0;if(g.title.trim&&u.trim&&g.title.trim()===u.trim())return l=g.id,!1});A?null!==l?(d.layerOptions[g.id]={visible:!0},this._revertSibilingLayersOnState(g,d,!1)):0===q.length&&(d.layerOptions[g.id]={visible:!1}):null!==l?(d.layerOptions[g.id]={visible:!1},this._revertSibilingLayersOnState(g,d,!0)):0===q.length&&(d.layerOptions[g.id]=
{visible:!0})}));this.restoreState(d)},getSimplificationState:function(){var b={showLayers:[],showLayersEncoded:[],hideLayers:[],hideLayersEncoded:[]};this.traversal(z.hitch(this,function(d){d.isVisible()?(b.showLayers.push(d.id),b.showLayersEncoded.push(this._encodeLayerId(d.id))):(b.hideLayers.push(d.id),b.hideLayersEncoded.push(this._encodeLayerId(d.id)))}));return b},_encodeLayerId:function(b){var d=p.crc24;b=d(b);b=parseInt(b,16);return b=b.toString(36)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},
getObjectId:function(){return this._objectId},_initLayerInfos:function(){this._layerInfos=[];this._initSpecifiedLayerInfos(this._operLayers,this._layerInfos)},_initBasemapLayerInfos:function(){this._basemapLayerInfos=[];this._initSpecifiedLayerInfos(this._basemapLayers,this._basemapLayerInfos)},_initSpecifiedLayerInfos:function(b,d){var a;r.forEach(b,function(g){try{a=this._layerInfoFactory.create(g),a.init()}catch(l){console.warn(l.message),a=null,0<=l.message.indexOf("declaredClass")&&this._unreachableLayersTitleOfWebmap.push(g.title)}a&&
d.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];r.forEach(this._finalLayerInfos||this._layerInfos,function(b,d){if(b._needToRenew()){try{var a=this._layerInfoFactory.create(b.originOperLayer);a.init()}catch(l){console.warn(l.message),a=null}a&&(b.destroy(),this._finalLayerInfos[d]=a)}else if(b.originOperLayer.featureCollection){var g=[];r.forEach(b.getSubLayers(),function(l){g.push(l.id)});r.forEach(g,function(l){this.map.getLayer(l)||b.removeSubLayerById(l)},
this);1===b.getSubLayers().length&&(d=b.getSubLayers()[0],this.map.getLayer(d.id).title=b.title,b.removeSubLayerById(d.id),this._removedLayerInfoIdsFromFeatureCollection.push(d.id),b.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=r.filter(this._finalLayerInfos,function(b){return!b._flag._invalid}))},_initFinalLayerInfos:function(){var b,d=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-
1;0<=b;b--){var a=this.map.graphicsLayerIds[b];this._isBasemap(a)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(a,d),a,!0)}for(b=this.map.layerIds.length-1;0<=b;b--)a=this.map.layerIds[b],this._isBasemap(a)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(a,d),a,!1);this._refineFinalLayerInfos()},_initTablesInfos:function(){this._tableInfos=[];var b=this._tables&&this._tables.reverse();b&&this._addTables(b,this._tableInfos)},_initFinalBasemapLayerInfos:function(){var b=
this._finalBasemapLayerInfos||this._basemapLayerInfos;this._finalBasemapLayerInfos=[];r.forEach(this.getBasemapLayers(),function(d){var a;r.some(b,function(g){if(g.id===d.id)return a=g,!0},this);this._addToFinalBasemapLayerInfos(a,d.id,!1)},this)},_isBasemap:function(b){for(var d=!1,a=this.getBasemapLayers(),g=0;g<a.length;g++)a[g].id===b&&(d=!0);return d},_addToFinalBasemapLayerInfos:function(b,d,a){this._addToSpecifiedLayerInfos(b,d,a,this._finalBasemapLayerInfos)},_addToFinalLayerInfos:function(b,
d,a){this._addToSpecifiedLayerInfos(b,d,a,this._finalLayerInfos)},_addToSpecifiedLayerInfos:function(b,d,a,g){if(b)b._addedFlag||b.isGraphicLayer()!==a||(g.push(b),b._addedFlag=!0);else{b=this.map.getLayer(d);if("esri.layers.GraphicsLayer"!==b.declaredClass&&"esri.layers.LabelLayer"!==b.declaredClass){try{var l={layerObject:b,title:this._getLayerTitle(b),id:b.id||" "};z.mixin(l,z.getObject("_wabProperties.originOperLayer",!1,b));var q=this._layerInfoFactory.create(l,this.map);q.init()}catch(A){console.warn(A.message),
q=null}q&&(z.getObject("_wabProperties.isTemporaryLayer",!1,b)&&(q._flag._isTemporaryLayerInfo=!0),g.push(q))}("esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.declaredClass)&&q&&q._getServiceDefinition().then(z.hitch(this,function(A){var u=[];r.forEach(A.tables,function(k){k.url=q.getUrl()+"/"+k.id;k.id=q.id+"_"+k.id;k.title=this._getLayerTitle(k);u.push(k)},this);this._addTables(u,this._tableInfos)}))}},_getLayerTitle:function(b){if(b.title)return b.title;
if(z.getObject("_wabProperties.originalLayerName",!1,b))return b.name||b.id;var d=b.label||b.name||"";if(b.url&&!z.getObject("_wabProperties.itemLayerInfo",!1,b)){var a=b.url.indexOf("/FeatureServer");-1===a&&(a=b.url.indexOf("/MapServer"));-1===a&&(a=b.url.indexOf("/service"));-1<a&&(a=b.url.substring(0,a),a=a.substring(a.lastIndexOf("/")+1,a.length),d=d?a+" - "+d:a)}return d||b.id},_findLayerInfoByIdAndReturnTopLayer:function(b,d){var a,g=null;d||(d=this._finalLayerInfos);for(a=0;a<d.length;a++)if(g=
d[a].findLayerInfoById(b)){g=d[a];break}return g},_findLayerInfoById:function(b,d){var a,g=null;d||(d=this._finalLayerInfos);for(a=0;a<d.length&&!(g=d[a].findLayerInfoById(b));a++);return g},_findTopLayerInfoById:function(b){var d,a=null,g=[].concat(this._finalLayerInfos||[],this._tableInfos||[]);for(d=0;d<g.length;d++)if(g[d].id===b){a=g[d];break}return a},_getTopLayerInfoIndexById:function(b){var d,a=-1;for(d=0;d<this._finalLayerInfos.length;d++)if(this._finalLayerInfos[d].id===b){a=d;break}return a},
_clearAddedFlag:function(b){r.forEach(b,function(d){d._addedFlag=!1})},_markFirstOrLastNode:function(){var b;if(this._finalLayerInfos.length){for(b=0;b<this._finalLayerInfos.length;b++)this._finalLayerInfos[b].isFirst=!1,this._finalLayerInfos[b].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(b=0;b<this._finalLayerInfos.length;b++)if(!this._finalLayerInfos[b].isGraphicLayer()){b&&(this._finalLayerInfos[b-1].isLast=!0);this._finalLayerInfos[b].isFirst=
!0;break}}},_onReceiveBasemapGalleryeData:function(b,d,a){"BasemapGallery"===b&&(this._basemapLayers.length=0,r.forEach(a,z.hitch(this,function(g){this._basemapLayers.push({layerObject:g,id:g.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(b){var d;for(d=this._basemapLayers.length=0;d<b.layers.length;d++)this._basemapLayers.push({layerObject:b.layer[d],id:b.layers[d].id})},_destroyLayerInfos:function(){r.forEach(this._finalLayerInfos,z.hitch(this,function(b){b.destroy()}))},
_bindEvents:function(){var b=n(this.map,"layer-add-result",z.hitch(this,this._onLayersChange,e.ADDED));var d=n(this.map,"layer-remove",z.hitch(this,this._onLayersChange,e.REMOVED));var a=n(this.map,"layer-reorder",z.hitch(this,this._onLayerReorder));var g=v.subscribe("layerInfos/layerInfo/isShowInMapChanged",z.hitch(this,this._onShowInMapChanged));var l=v.subscribe("layerInfos/layerInfo/visibleChanged",z.hitch(this,this._onVisibleChanged));var q=v.subscribe("layerInfos/layerInfo/filterChanged",z.hitch(this,
this._onFilterChanged));var A=v.subscribe("layerInfos/layerInfo/rendererChanged",z.hitch(this,this._onRendererChanged));var u=v.subscribe("layerInfos/layerInfo/opacityChanged",z.hitch(this,this._onOpacityChanged));var k=v.subscribe("layerInfos/layerInfo/scaleRangeChanged",z.hitch(this,this._onScaleRangeChanged));var w=v.subscribe("layerInfos/layerInfo/timeExtentChanged",z.hitch(this,this._onTimeExtentChanged));var y=n(this.map,"before-unload",z.hitch(this,function(){b.remove();d.remove();a.remove();
g.remove();l.remove();q.remove();A.remove();y.remove();u.remove();k.remove();w.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(b){console.warn(b)}},_emitEventForEveryLayerInfo:function(b,d,a){try{r.forEach(d,function(g){g.emitEvent(b,a)},this)}catch(g){console.warn(g)}},_onLayersChange:function(b,d){var a=null;if(!d.error&&"esri.layers.GraphicsLayer"!==d.layer.declaredClass&&"esri.layers.LabelLayer"!==d.layer.declaredClass){if(b===e.ADDED){this.update();
a=b=this._findLayerInfoById(d.layer.id,d.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos);var g=e.ADDED;b&&!b.isRootLayer()&&(a=b.getRootLayerInfo(),g=e.SUBLAYER_ADDED)}else a=b=this._findLayerInfoById(d.layer.id,d.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),g=e.REMOVED,b&&!b.isRootLayer()&&(a=b.getRootLayerInfo(),g=e.SUBLAYER_REMOVED),b&&b.destroy(),this.update();a&&(d.layer._basemapGalleryLayerType?(this._emitEvent("basemapLayersChanged"),
this._emitEvent("basemapLayerInfosChanged",a,g,b)):this._emitEvent("layerInfosChanged",a,g,b))}},_onTableChange:function(b,d){this._emitEvent("tableInfosChanged",b,d,b)},_onLayersUpdated:function(b,d){b.isTable?this._emitEvent("tableInfosChanged",[b],e.UPDATED,[d]):this._emitEvent("layerInfosChanged",b,e.UPDATED,d)},_onShowInMapChanged:function(b){this._emitEvent("layerInfosIsShowInMapChanged",b);this._emitEventForEveryLayerInfo("isShowInMapChanged",b)},_onVisibleChanged:function(b){this._emitEvent("layerInfosIsVisibleChanged",
b);this._emitEventForEveryLayerInfo("isVisibleChanged",b)},_onFilterChanged:function(b,d){this._emitEvent("layerInfosFilterChanged",b,d);this._emitEventForEveryLayerInfo("filterChanged",b,d)},_onLayerReorder:function(){var b=[].concat(this.map.layerIds,this.map.graphicsLayerIds),d=r.some(b,z.hitch(this,function(a,g){return a===this._previousLayerOrder[g]?!1:!0}));b.length===this._previousLayerOrder.length&&d&&(this.update(),this._emitEvent("layerInfosReorder",null,e.REORDERED));this._previousLayerOrder=
b},_onRendererChanged:function(b){this._emitEvent("layerInfosRendererChanged",b);this._emitEventForEveryLayerInfo("rendererChanged",b)},_onOpacityChanged:function(b){this._emitEvent("layerInfosOpacityChanged",b);this._emitEventForEveryLayerInfo("opacityChanged",b)},_onScaleRangeChanged:function(b){this._emitEvent("layerInfosScaleRangeChanged",b);this._emitEventForEveryLayerInfo("scaleRangeChanged",b)},_onTimeExtentChanged:function(b){this._emitEvent("layerInfosTimeExtentChanged",b);this._emitEventForEveryLayerInfo("timeExtentChanged",
b)}});e.getLayerInfoArrayByType=function(b,d){var a=new x,g=[],l=[];e.getInstance(b,b.iteminfo).then(function(q){q.traversal(function(A){var u=A.getLayerType();u.layerInfo=A;g.push(u)});m(g).then(function(A){r.forEach(A,function(u,k){d===u&&l.push(g[k].layerInfo)});a.resolve(l)})});return a};var c=null,f=null;e.getInstance=function(b,d){var a=new x;a.resolve(e.getInstanceSyncForInit(b,d));return a};e.getInstanceSyncForInit=function(b,d){c&&c!==b&&(c=null,f=null);f||(f=new e(b,d.itemData),c=b);return f};
e.getInstanceSync=function(){return f};e.setInstance=function(b,d){c=b;f=d};e.createInstance=function(b){var d=null;return d=new e(b,b.itemInfo.itemData)};z.mixin(e,{ADDED:"added",REMOVED:"removed",SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return e})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultDynamicShipFeatureLayer jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){return F(null,{constructor:function(a,g){this.map=a;this.layerInfos=g},create:function(a){var g=null;if(a.featureCollection)g=new r(a,this.map,this,this.layerInfos);else if("esri.layers.KMLLayer"===a.layerObject.declaredClass)g=new x(a,this.map,this,this.layerInfos);else if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass)g=new n(a,this.map,this,this.layerInfos);else if("esri.layers.WMSLayer"!==a.layerObject.declaredClass||a.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
a.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.layerObject.declaredClass)g=new z(a,this.map,this,this.layerInfos);else if("esri.layers.ArcGISImageServiceLayer"===a.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===a.layerObject.declaredClass)g=new f(a,this.map,this,this.layerInfos);else if("esri.layers.StreamLayer"===a.layerObject.declaredClass)g=new b(a,this.map,this,this.layerInfos);else switch("Table"===a.layerObject.type&&(a.selfType="table"),
a.selfType){case "mapservice_dynamic_ship_featurelayer":g=new h(a,this.map,this,this.layerInfos);break;case "mapservice_dynamic_group":case "mapservice_dynamic":g=new m(a,this.map,this,this.layerInfos);break;case "mapservice_tiled_group":case "mapservice_tiled":g=new p(a,this.map,this,this.layerInfos);break;case "wms":g=new e(a,this.map,this,this.layerInfos);break;case "kml":g=new d(a,this.map,this,this.layerInfos);break;case "table":g=new c(a,this.map,this,this.layerInfos);break;default:g=new v(a,
this.map,this,this.layerInfos)}else g=new t(a,this.map,this,this.layerInfos);return g}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/promise/all esri/lang jimu/utils ./LayerInfo".split(" "),function(F,r,z,x,n,v,t){return F(t,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},_getExtent:function(){var m=null,h=[];r.forEach(this.getSubLayers(),function(p){h.push(p._getExtent())},
this);return x(h).then(z.hitch(this,function(p){r.forEach(p,function(e){v.isValidExtent(e)&&(m=m?m.union(e):e)},this);return m}))},_resetLayerObjectVisiblity:function(m){var h=m?m[this.id]:null;if(h){var p={},e;for(e in m)m.hasOwnProperty(e)&&"function"!==typeof m[e]&&(p[e]=m[e].visible);this._setSubLayerVisibleByCheckedInfo(p);this._setTopLayerVisible(h.visible)}},_setSubLayerVisibleByCheckedInfo:function(m){r.forEach(this.newSubLayers,function(h){n.isDefined(m[h.id])&&h.layerObject.setVisibility(m[h.id])},
this)},_initVisible:function(){var m=!1,h;for(h=0;h<this.newSubLayers.length;h++)m=m||this.newSubLayers[h].layerObject.visible;m&&(this._visible=!0)},_setTopLayerVisible:function(m){this._visible=m?!0:!1;r.forEach(this.newSubLayers,function(h){h.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var m=[];r.forEach(this.originOperLayer.featureCollection.layers,function(h){this._getLayerIndexesInMapByLayerId(h.layerObject.id)&&(z.setObject("_wabProperties.originOperLayer.showLegend",
this.originOperLayer.featureCollection.showLegend,h.layerObject),h=this._layerInfoFactory.create({layerObject:h.layerObject,title:h.layerObject.label||h.layerObject.title||h.layerObject.name||h.layerObject.id||" ",id:h.id||"-",subId:h.id||"-",collection:{layerInfo:this},selfType:"collection",showLegend:!0,parentLayerInfo:this}),m.push(h),h.init())},this);m.reverse();return m},_obtainLayerIndexesInMap:function(){var m=[],h,p;for(p=this.newSubLayers.length-1;0<=p;p--)(h=this._getLayerIndexesInMapByLayerId(this.newSubLayers[p].layerObject.id))&&
m.push(h);return m},moveLeftOfIndex:function(m){var h;for(h=0;h<this.newSubLayers.length;h++)this.map.reorderLayer(this.newSubLayers[h].layerObject,m)},moveRightOfIndex:function(m){var h;for(h=this.newSubLayers.length-1;0<=h;h--)this.map.reorderLayer(this.newSubLayers[h].layerObject,m)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getOpacity:function(){var m,h=0;for(m=0;m<this.newSubLayers.length;m++)if(this.newSubLayers[m].layerObject.opacity)h=
this.newSubLayers[m].layerObject.opacity>h?this.newSubLayers[m].layerObject.opacity:h;else return 1;return h},setOpacity:function(m){r.forEach(this.newSubLayers,function(h){h.layerObject.setOpacity&&h.layerObject.setOpacity(m)})},getScaleRange:function(){var m=this.getSubLayers();return m[0]?m[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented dojo/request/script jimu/portalUrlUtils jimu/portalUtils jimu/LayerNode jimu/utils jimu/privilegeUtils ./RequestBuffer esri/kernel esri/tasks/query esri/request".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q){var A=F([h],{declaredClass:"jimu.LayerInfo",originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(u,k,w,y){this.originOperLayer=u;this.layerObject=u.layerObject;this.map=k;this.title=
this.originOperLayer.title||this.originOperLayer.id||"";this.id=this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=u.parentLayerInfo?u.parentLayerInfo:null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=w;this._layerInfos=y;this._flag={};this._objectId=Math.random();this._adaptor=new f(this)},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();
this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=new a(z.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var u=this._obtainLayerIndexesInMap();return u.length?u[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},
getObjectId:function(){return this._objectId},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(u){this.layerObject.setOpacity&&this.layerObject.setOpacity(u)},moveLeftOfIndex:function(u){this.map.reorderLayer(this.layerObject,u)},moveRightOfIndex:function(u){this.map.reorderLayer(this.layerObject,u)},traversal:function(u){if(u(this))return!0;for(var k=this.getSubLayers(),w=0;w<k.length;w++)if(k[w].traversal(u))return!0},findLayerInfoById:function(u){var k=
null,w=0;if(this.id&&this.id===u)return this;for(w=0;w<this.newSubLayers.length&&!(k=this.newSubLayers[w].findLayerInfoById(u));w++);return k},setTopLayerVisible:function(u){this._setTopLayerVisible(u)},_setTopLayerVisible:function(u){},_setSubLayerVisible:function(u,k){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(u){this.isRootLayer()&&this._resetLayerObjectVisiblity(u)},_initVisible:function(){},isVisible:function(){return this._visible?
!0:!1},show:function(){this._setTopLayerVisible(!0)},hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var u=[],k;(k=this._getLayerIndexesInMapByLayerId(this.id))&&u.push(k);return u},_getLayerIndexesInMapByLayerId:function(u){var k;for(k=0;k<this.map.graphicsLayerIds.length;k++)if(this.map.graphicsLayerIds[k]===u)return{isGraphicLayer:!0,index:k};for(k=0;k<this.map.layerIds.length;k++)if(this.map.layerIds[k]===u)return{isGraphicLayer:!1,index:k};return null},_isShowInMapChanged:function(){var u=
!1,k=this.isShowInMap();!1===k&&this.map.infoWindow.hide();this._oldIsShowInMap!==k&&(this._oldIsShowInMap=k,u=!0);return u},_isShowInMapChanged2:function(){var u=[];this.traversal(function(k){k._isShowInMapChanged()&&u.push(k)});t.publish("layerInfos/layerInfo/isShowInMapChanged",u)},_visibleChanged:function(){t.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var u={};this.isRootLayer()&&this.traversal(function(k){k.isRootLayer()||(u[k.subId]=k)});this._subLayerInfoIndex=
u},_getLayerInfosObj:function(){return this._layerInfos},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return v.create("div",{"class":"legends-div"})},drawLegends:function(u,k){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},_needToRenew:function(){return!1},_getServiceDefinition:function(){var u=
new x;u.resolve(null);return u},_serviceDefinitionRequest:function(u){return this._normalRequest(u,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},_normalRequest:function(u,k,w){return q({url:u,content:k,handleAs:w,callbackParamName:"callback"})},getLayerObject:function(){var u=new x;this.layerObject?u.resolve(this.layerObject):u.resolve(null);return u},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},getSubLayers:function(){return this.newSubLayers},
isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var u=0,k=this;k.parentLayerInfo;)u++,k=k.parentLayerInfo;return u},getRootLayerInfo:function(){for(var u=this;u.parentLayerInfo;)u=u.parentLayerInfo;return u},isShowInMap:function(){for(var u=!0,k=this;k;)u=u&&k.isVisible(),k=k.parentLayerInfo;return u},getLayerType:function(){var u=[null],k=new x;this.layerObject.declaredClass&&(u=this.layerObject.declaredClass.split("."));
k.resolve(u[u.length-1]);return k},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var u=this.getInfoTemplate(),k=null;u&&(k=u.info);return k},loadPopupInfo:function(){var u=new x;this.loadInfoTemplate().then(z.hitch(this,function(k){var w=null;k&&(w=k.info);u.resolve(w)}));return u},loadInfoTemplate:function(){var u=new x;u.resolve(null);return u},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?
this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var u=this,k=!0;u;)k=k&&u._getShowLegendOfWebmap(),u=u.parentLayerInfo;return k},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(u){},getSupportTableInfo:function(){var u=new x,k={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},w=this.getLayerType(),y=this.getLayerObject();n({type:w,layerObject:y}).then(z.hitch(this,
function(C){var D=C.type;C=C.layerObject;k.layerType=D;0<=this._getLayerTypesOfSupportTable().indexOf(D)&&(k.isSupportedLayer=!0);if(!C)k.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())k.isSupportQuery=!1;else if(!C.url||C.capabilities&&C.capabilities.indexOf&&0<=C.capabilities.indexOf("Query"))k.isSupportQuery=!0;u.resolve(k)}),function(){u.resolve(k)});return u},getRelatedTableInfoArray:function(u){u=new x;u.resolve([]);return u},getRelatedRecords:function(u,
k){u=new x;u.resolve([]);return u},removeSubLayerById:function(u){var k=[];r.forEach(this.newSubLayers,function(w){w.id!==u?k.push(w):w.destroy()});this.newSubLayers=k},releaseResource:function(){r.forEach(this._eventHandles,function(u){u.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){r.forEach(this.newSubLayers,function(u){u.destroy()});this.releaseResource();this.inherited(arguments)},update:function(){r.forEach(this.newSubLayers,function(u){u.destroy()});
this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getMSShipFeatures:function(){var u=new x;u.resolve(null);return u},_getExtent:function(){var u=new x;u.resolve(this.layerObject.fullExtent||this.layerObject.initialExtent);return u},getExtent:function(){var u=new x;this._getExtent().then(z.hitch(this,function(k){b.projectToMapSpatialReference(this.map,
k).then(z.hitch(this,function(w){u.resolve(w)}),z.hitch(this,function(){u.resolve(null)}))}),z.hitch(this,function(){u.resolve(null)}));return u},_requerySelectdFeatures:function(){var u=new x;this.getLayerObject().then(z.hitch(this,function(k){var w=[];if(k&&k.isEditable&&!k.isEditable()){var y=k.objectIdField;w=k.getSelectedFeatures();var C=k.on("update-end",z.hitch(this,function(){var D=new l,G=[];r.forEach(w,function(H){G.push(H.attributes[y])},this);D.objectIds=G;D.maxAllowableOffset=0;k.queryFeatures(D,
z.hitch(this,function(H){r.forEach(H.features,function(L){r.some(w,function(T){return T.attributes[y]===L.attributes[y]?(T.setGeometry(L.geometry),!0):!1})},this);u.resolve()}),z.hitch(this,function(){u.resolve()}));C&&C.remove&&C.remove()}))}}));return u},zoomTo:function(u){this._requerySelectdFeatures();return u?b.projectToMapSpatialReference(this.map,u).then(z.hitch(this,function(k){return this._zoomTo(k)})):this.getExtent().then(z.hitch(this,function(k){return this._zoomTo(k)}))},_zoomTo:function(u){if(b.isValidExtent(u)){u=
z.clone(u);var k=this.getLayerScaleRange(),w=k.minScale;k=k.maxScale;if(u.isSinglePoint){if(w=b.getTargetScale(this.map,3,w,k))u=b.adjustHeightToAspectRatio(this.map,u),u=b.getExtentForScale(u,this.map.width,w),this.map.setExtent(u)}else{u=b.adjustExtentToAspectRatio(this.map,u);var y=b.getScaleForExtent(u,this.map.width);0<w&&y>w?(w=b.getScaleForNextTileLevel(this.map,w,!0),u=b.adjustHeightToAspectRatio(this.map,u),u=b.getExtentForScale(u,this.map.width,w),this.map.setExtent(u)):y<k?(k=b.getScaleForNextTileLevel(this.map,
k,!1),u=b.adjustHeightToAspectRatio(this.map,u),u=b.getExtentForScale(u,this.map.width,k),this.map.setExtent(u)):this.map.setExtent(u,!0)}}},mergeScale:function(u,k,w,y){var C=0,D=0;0===u&&0<w?C=w:0<u&&0===w?C=u:0<u&&0<w&&(C=Math.min(u,w));D=Math.max(k,y);return{minScale:C,maxScale:D}},unionScale:function(u,k,w,y){var C=0,D=0;C=0===u||0===w?0:Math.max(u,w);D=Math.min(k,y);return{minScale:C,maxScale:D}},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?
{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(u,k){this.layerObject&&this.layerObject.setScaleRange&&this.layerObject.setScaleRange(u,k)},getLayerScaleRange:function(){var u,k=this.getScaleRange();this.traversal(z.hitch(this,function(w){w.id!==this.id&&(w=w.getScaleRange(),u=u?this.unionScale(u.minScale,u.maxScale,w.minScale,w.maxScale):w)}));return u?this.mergeScale(k.minScale,k.maxScale,u.minScale,u.maxScale):k},isCurrentScaleInTheScaleRange:function(){var u=
this.getScaleRange(),k=this.map.getScale();return 0===u.minScale&&0===u.maxScale?!0:(0===u.minScale||u.minScale>=k)&&(0===u.maxScale||k>=u.maxScale)?!0:!1},isInScale:function(){for(var u=!0,k=this;k&&(u=k.isCurrentScaleInTheScaleRange(),k=k.parentLayerInfo,u););return u},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},enablePopupNested:function(){this.isLeaf()?this.enablePopup():this.traversal(z.hitch(this,function(u){u.isLeaf()&&u.enablePopup()}))},isSupportPopup:function(){var u=
new x;u.resolve(!1);return u},disablePopupNested:function(){this.isLeaf()?this.disablePopup():this.traversal(z.hitch(this,function(u){u.isLeaf()&&u.disablePopup()}))},isPopupNestedEnabled:function(){var u=!1;this.isLeaf()?u=this.isPopupEnabled():this.traversal(z.hitch(this,function(k){return k.isLeaf()&&k.isPopupEnabled()?u=!0:!1}));return u},isSupportPopupNested:function(){var u=new x,k=[];this.traversal(function(w){w.isLeaf()&&k.push(w.isSupportPopup())});n(k).then(function(w){r.some(w,function(y){if(y)return u.resolve(!0),
!0;u.resolve(!1);return!1})});return u},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},isPublicService:function(){var u=new x,k=this.getUrl();(k=k&&k+"?f\x3djson")?("https"===e.getProtocol(window.location.href)&&(k=e.setHttpsProtocol(k)),p.get(k,{jsonp:"callback"}).then(z.hitch(this,function(w){w&&w.error?u.resolve(!1):u.resolve(!0)}),z.hitch(this,function(){u.resolve(!1)}))):u.resolve(!0);return u},_checkUserLicense:function(u){var k=
"";!window.isXT&&window.queryObject&&(window.queryObject.id&&!/^(stemapp|stemapp3d)$/gi.test(window.queryObject.id)?k=window.queryObject.id:window.queryObject.appid&&(k=window.queryObject.appid));return window.isXT||!k?(u=new x,u.resolve(!0),u):d.checkEssentialAppsLicense(k,u,!1).then(z.hitch(this,function(w){return!(w&&w.viewOnly)}),z.hitch(this,function(){return!1}))},isEditable:function(){var u=!1,k=!0,w=!0,y=getAppConfig().portalUrl,C=c.getPortal(y);y=this.isPublicService();var D=new x,G=new x;
C.getUser().then(z.hitch(this,function(H){G.resolve(H)}),z.hitch(this,function(){G.resolve(null)}));C=this._checkUserLicense(C);n({user:G,isPublicService:y,license:C}).then(z.hitch(this,function(H){var L=H.user&&H.user.privileges,T=H.isPublicService;H=H.license;L&&-1===r.indexOf(L,"features:user:edit")&&g.id&&!T&&(k=!1);T||H||(w=!1);u=this.layerObject&&this.layerObject.isEditable?this.layerObject.isEditable()&&k&&w?!0:!1:!1;D.resolve(u)}),z.hitch(this,function(){D.resolve(!1)}));return D},_getBasicItemInfo:function(){var u=
null,k=this.getRootLayerInfo(),w=window.appConfig||window.getAppConfig(),y=z.getObject("_wabProperties.itemLayerInfo",!1,k.layerObject);k.originOperLayer.itemId?(u={},u.itemId=k.originOperLayer.itemId,u.portalUrl=e.getStandardPortalUrl(w.map.portalUrl||w.portalUrl)):y&&y.portalUrl&&y.itemId&&(u={},u.itemId=y.itemId,u.portalUrl=e.getStandardPortalUrl(y.portalUrl));return u},getItemInfo:function(){var u=new x,k=this.getRootLayerInfo();k.isItemLayer()?(k._itemInfo||(k._itemInfo=new A.ItemInfo(this,k)),
k._itemInfo.onLoad().then(z.hitch(this,function(){u.resolve(k._itemInfo)}),z.hitch(this,function(){u.resolve(null)}))):u.resolve(null);return u},isHostedService:function(){var u=new x;this._getServiceDefinition().then(z.hitch(this,function(k){u.resolve(k&&k.serviceItemId?!0:!1)}));return u},isHostedLayer:function(){if(this.isItemLayer())var u=this.isHostedService();else u=new x,u.resolve(!1);return u},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},
destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},isBasemap:function(){return this.getRootLayerInfo().layerObject._basemapGalleryLayerType?!0:!1},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,arguments)}catch(u){console.error(u)}},_bindEvent:function(){if(this.layerObject&&!this.layerObject.empty){var u=this.layerObject.on("visibility-change",z.hitch(this,
this._onVisibilityChanged));this._eventHandles.push(u);u=m.after(this.layerObject,"setDefinitionExpression",z.hitch(this,this._onFilterChanged));this._eventHandles.push(u);u=m.after(this.layerObject,"setRenderer",z.hitch(this,this._onRendererChanged));this._eventHandles.push(u);this.isRootLayer()&&(u=this.layerObject.on("opacity-change",z.hitch(this,this._onOpacityChanged)),this._eventHandles.push(u));u=this.layerObject.on("scale-range-change",z.hitch(this,this._onScaleRangeChanged));this._eventHandles.push(u);
this.isRootLayer()&&(u=this.map.on("time-extent-change",z.hitch(this,function(){this.layerObject&&this.layerObject.useMapTime&&this._onTimeExtentChanged()})),this._eventHandles.push(u));this.isRootLayer()&&(u=m.after(this.layerObject,"setTimeDefinition",z.hitch(this,function(){this.layerObject&&this.layerObject.timeInfo&&this.layerObject.mode===esri.layers.FeatureLayer.MODE_SNAPSHOT&&this._onTimeExtentChanged()})),this._eventHandles.push(u))}},_onVisibilityChanged:function(){this._initVisible();this._visibleChanged();
this._isShowInMapChanged2()},_onFilterChanged:function(){var u=this._oldFilter?this._oldFilter:null,k=this.layerObject.getDefinitionExpression();k=k?k:null;u!==k&&(t.publish("layerInfos/layerInfo/filterChanged",[this],z.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=k,z.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))},_onRendererChanged:function(){t.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){t.publish("layerInfos/layerInfo/opacityChanged",
[this])},_onScaleRangeChanged:function(){t.publish("layerInfos/layerInfo/scaleRangeChanged",[this])},_onTimeExtentChanged:function(){var u=[],k=[];this.traversal(function(w){var y=w.getServiceDefinition().then(function(C){C&&C.timeInfo&&u.push(w)});k.push(y)});n(k).then(z.hitch(this,function(){t.publish("layerInfos/layerInfo/timeExtentChanged",u)}))}});A.ItemInfo=F(null,{_currentLayerInfo:null,_rootLayerInfo:null,_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,
constructor:function(u,k){this._currentLayerInfo=u;this._rootLayerInfo=k;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=new x;var u=this._rootLayerInfo.isItemLayer();if(u){this._portalUrl=u.portalUrl;this._itemId=u.itemId;var k=c.getPortal(this._portalUrl);u=k.getItemById(this._itemId);k=k.getItemData(this._itemId);var w=this._currentLayerInfo._getServiceDefinition();n({item:u,itemData:k,serviceDefinition:w}).then(z.hitch(this,function(y){this._item=y.item;this._itemData=y.itemData;
this._serviceDefinition=y.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),z.hitch(this,function(y){y&&y.message&&console.log(y.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},getItemId:function(){return this._itemId},getItem:function(){return this._item},getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&
this._serviceDefinition.serviceItemId?!0:!1}});return A})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){var d=F([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(A){this.portalUrl=
c.getStandardPortalUrl(A);this.selfUrl=c.getPortalSelfInfoUrl(A)},loadSelfInfo:function(){var A=this.selfUrl;this.isValidCredential()&&(A=-1<A.indexOf("?")?A+("\x26token\x3d"+this.credential.token):A+("?token\x3d"+this.credential.token));return b.getInstance().getServiceDefinition(A).then(r.hitch(this,function(u){var k=u.user;delete u.user;r.mixin(this,u);u.user=k;return u}))},_checkCredential:function(){var A=f.isValidCredential(this.credential);A||this.clearCredentialAndUser();return A},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=f.getPortalCredential(this.portalUrl))},signIn:function(){var A=new n;this.updateCredential();this.isValidCredential()?setTimeout(r.hitch(this,function(){A.resolve(this.credential)}),0):A=f.signInPortal(this.portalUrl);return A},haveSignIn:function(){return f.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getSigninSettingsOfSelfInfo:function(){this.updateCredential();
var A=new n,u=this.selfUrl+"/signinSettings";this.isValidCredential()?A=h({url:u,handleAs:"json",content:{f:"json",token:this.credential.token},callbackParamName:"callback"}):A.resolve({});return A},getUser:function(){this.updateCredential();var A=new n;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(r.hitch(this,function(){this.user.updateCredential();A.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(r.hitch(this,
function(u){this.user=u;A.resolve(this.user)}),r.hitch(this,function(u){console.error(u);A.reject(u)})):f.getUserIdByToken(this.credential.token,this.portalUrl).then(r.hitch(this,function(u){this.credential.userId=u;this._getUser(this.credential.userId).then(r.hitch(this,function(k){this.user=k;A.resolve(this.user)}),r.hitch(this,function(k){console.error(k);A.reject(k)}))}),r.hitch(this,function(u){console.error(u);A.reject(u)})):setTimeout(r.hitch(this,function(){A.reject("credential is null.")}),
0);return A},queryItems:function(A){this.updateCredential();var u=new n,k=c.getBaseSearchUrl(this.portalUrl),w={f:"json"};A&&(w=r.mixin(w,A));this.isValidCredential()&&(w.token=this.credential.token);w.sortField||w.sortOrder||(w.sortField="title",w.sortOrder="asc");h({url:k,handleAs:"json",content:w,callbackParamName:"callback"}).then(r.hitch(this,function(y){y.results=z.map(y.results,r.hitch(this,function(C){C.portalUrl=this.portalUrl;C.credential=this.credential;C.portal=this;return new l(C)}));
u.resolve(y)}),r.hitch(this,function(y){console.error(y);u.reject(y)}));return u},getItemData:function(A){this.updateCredential();A={url:c.getItemDataUrl(this.portalUrl,A),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return h(A)},_getItemById:function(A,u){A={url:c.getItemUrl(this.portalUrl,A),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};u&&(A.content.token=u);return h(A).then(r.hitch(this,function(k){k.portalUrl=this.portalUrl;k.credential=this.credential;
k.portal=this;return new l(k)}))},getItemById:function(A,u){this.updateCredential();return this._getItemById(A).then(r.hitch(this,function(k){return u&&k.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===k.owner?this._getItemById(A,this.credential.token):k}))},getAppById:function(A){var u=new n;this.updateCredential();this.isValidCredential()?(A=c.getAppIdUrl(this.portalUrl,A),u=h({url:A,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(r.hitch(this,
function(){u.reject("token is null.")}),0);return u},queryGroups:function(A){this.updateCredential();var u=new n,k=c.getBaseGroupUrl(this.portalUrl),w={f:"json"};A&&(w=r.mixin(w,A));this.isValidCredential()&&(w.token=this.credential.token);h({url:k,handleAs:"json",content:w,callbackParamName:"callback"}).then(r.hitch(this,function(y){y.results=z.map(y.results,r.hitch(this,function(C){C.portalUrl=this.portalUrl;C.credential=this.credential;C.portal=this;return new g(C)}));u.resolve(y)}),r.hitch(this,
function(y){console.error(y);u.reject(y)}));return u},registerApp:function(A,u,k){var w=new n;this.updateCredential();if(this.isValidCredential()){var y=this.credential&&this.credential.token,C=c.getOAuth2Url(this.portalUrl);w=h({url:C+"/registerApp",content:{itemId:A,appType:u,redirect_uris:t.stringify(k),token:y,f:"json"},handleAs:"json"},{usePost:!0})}else setTimeout(r.hitch(this,function(){w.reject("token is null.")}),0);return w},createAndRegisterApp:function(A){var u=new n;this.updateCredential();
this.isValidCredential()?this.getUser().then(r.hitch(this,function(k){k.addItem({title:"ArcGIS Web AppBuilder",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(r.hitch(this,function(w){w.success?this.registerApp(w.id,"browser",A).then(r.hitch(this,function(y){u.resolve(y)}),r.hitch(this,function(y){console.error(y);u.reject(y)})):u.reject("create app failed")}),r.hitch(this,function(w){console.error(w);u.reject(w)}))}),r.hitch(this,function(k){console.error(k);
u.reject(k)})):setTimeout(r.hitch(this,function(){u.reject("token is null.")}),0);return u},_getUser:function(A){this.updateCredential();var u=new n;A={url:c.getUserUrl(this.portalUrl,A),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(A.content.token=this.credential&&this.credential.token);h(A).then(r.hitch(this,function(k){k.portalUrl=this.portalUrl;k.credential=this.credential;k.portal=this;this.user=new a(k);u.resolve(this.user)}),r.hitch(this,function(k){console.error(k);
u.reject(k)}));return u},getHelpMap:function(){this.updateCredential();var A={url:c.getPortalHelpMapUrl(this.portalUrl),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return h(A)}}),a=F([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(A){A&&r.mixin(this,A)},_checkCredential:function(){var A=f.isValidCredential(this.credential);A||(this.credential=null);return A},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var A=new p({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&A.setPrivileges(this.privileges);return A.canCreateItem()},canCreateNotebooks:function(){var A=new p({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&A.setPrivileges(this.privileges);return A.canCreateNotebooks()},getGroups:function(){var A=[];
this.groups&&(A=z.map(this.groups,r.hitch(this,function(u){u.portalUrl=this.portalUrl;u.credential=this.credential;u.portal=this.portal;return new g(u)})));return A},getItemsByKeywords:function(A,u){return this.portal.queryItems({start:u||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+A+'"'})},getContent:function(){this.updateCredential();var A={url:c.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&
(A.content.token=this.credential.token);return h(A)},getTags:function(){this.updateCredential();var A={url:c.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(A.content.token=this.credential.token);return h(A)},addItem:function(A,u){this.updateCredential();var k=new n;if(this.isValidCredential()){var w={f:"json",token:this.credential.token};A&&(w=r.mixin(w,A));h({url:c.getAddItemUrl(this.portalUrl,this.username,
u),handleAs:"json",callbackParamName:"callback",content:w},{usePost:!0}).then(r.hitch(this,function(y){k.resolve(y)}),r.hitch(this,function(y){console.error(y);k.reject(y)}))}else setTimeout(r.hitch(this,function(){k.reject("token is null.")}),0);return k},deleteItem:function(A){this.updateCredential();var u=new n;this.isValidCredential()?(A=c.getDeleteItemUrl(this.portalUrl,this.username,A),u=h({url:A,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(r.hitch(this,
function(){u.reject("token is null.")}),0);return u},getItemById:function(A,u){this.updateCredential();var k=new n;A={url:c.getUserItemsUrl(this.portalUrl,this.username,u)+"/"+A,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};h(A).then(r.hitch(this,function(w){w.portalUrl=this.portalUrl;w.credential=this.credential;w.portal=this;w=new l(w);k.resolve(w)}),r.hitch(this,function(w){console.error(w);k.reject(w)}));return k},shareItem:function(A,u,k){this.updateCredential();var w=new n;
this.isValidCredential()?(u={url:c.shareItemUrl(this.portalUrl,this.username,u,k),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},A&&(u.content=r.mixin(u.content,A)),h(u,{usePost:!0}).then(r.hitch(this,function(y){w.resolve(y)}),r.hitch(this,function(y){console.error(y);w.reject(y)}))):setTimeout(r.hitch(this,function(){w.reject("token is null.")}),0);return w},updateItem:function(A,u){this.updateCredential();var k=new n;this.isValidCredential()?this.portal.getItemById(A).then(r.hitch(this,
function(w){var y={f:"json",token:this.credential.token};u&&(y=r.mixin(y,u));h({url:c.getUpdateItemUrl(this.portalUrl,w.owner,A,w.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:y},{usePost:!0}).then(r.hitch(this,function(C){k.resolve(C)}),r.hitch(this,function(C){console.error(C);k.reject(C)}))}),r.hitch(this,function(w){console.error(w);k.reject(w)})):setTimeout(r.hitch(this,function(){k.reject("token is null.")}),0);return k},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(A,u){var k=new n;this.updateCredential();u=c.getUserItemsUrl(this.portalUrl,this.username,u);return k=h({url:u+"/"+A+"/registeredAppInfo",content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(A,
u){var k=new n;this.updateCredential();u=c.getUserItemsUrl(this.portalUrl,this.username,u);return k=m(u+"/"+A+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),g=F([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(A){A&&r.mixin(this,A)},_checkCredential:function(){var A=f.isValidCredential(this.credential);A||(this.credential=null);return A},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(A){A.q="group:"+this.id+" AND "+A.q;return this.portal.queryItems(A)}}),l=F([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(A){A&&r.mixin(this,A);this.itemUrl=c.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&
(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=c.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=c.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var A=f.isValidCredential(this.credential);A||(this.credential=null);return A},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var A={url:c.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(A.content.token=this.credential.token);return h(A)}}),q={portals:[],webMapQueryStr:" "+
e.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+e.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(A){for(var u=0;u<this.portals.length;u++){var k=this.portals[u];if(c.isSamePortalUrl(A,k.portalUrl))return k.updateCredential(),k}return null},getPortal:function(A){if(!A||"string"!==typeof A||!r.trim(A))return null;A=c.getStandardPortalUrl(A);var u=this._findPortal(A);u||(u=new d(A),u.credential=f.getPortalCredential(u.portalUrl),u.updateCredential(),this.portals.push(u));
return u},getPortalSelfInfo:function(A){return this.getPortal(A).loadSelfInfo()},getBasemapGalleryGroup:function(A){return this._getPortalSelfGroup(A,"basemapGalleryGroupQuery")},getTemplatesGroup:function(A){return this._getPortalSelfGroup(A,"templatesGroupQuery")},getUnits:function(A){var u="english",k="",w=new n;this.getPortal(A).getUser().then(r.hitch(this,function(y){y&&y.units?u=y.units:(k=x.locale,u=k.startWith("en")?"english":"metric");w.resolve(u)}),r.hitch(this,function(y){console.warn(y);
this.getPortalSelfInfo(A).then(r.hitch(this,function(C){var D=null;C&&C.units?D=C.units:(k=C&&C.culture||x.locale,D=k.startWith("en")?"english":"metric");w.resolve(D)}),r.hitch(this,function(C){console.warn(C);k=x.locale;u=k.startWith("en")?"english":"metric";w.resolve(u)}))}));return w.promise},_getPortalSelfGroup:function(A,u){var k=new n,w=this.getPortal(A);w||setTimeout(r.hitch(this,function(){k.reject()}),0);this.getPortalSelfInfo(A).then(r.hitch(this,function(y){w.queryGroups({f:"json",q:y[u]}).then(r.hitch(this,
function(C){0<C.results.length?(C=C.results[0],C.portalUrl=w.portalUrl,C.credential=w.credential,C.portal=w,C=new g(C),k.resolve(C)):k.reject("Can't find portal self group.")}),r.hitch(this,function(C){console.error(C);k.reject(C)}))}),r.hitch(this,function(y){console.error(y);k.reject(y)}));return k},getWebMapsFromBasemapGalleryGroup:function(A){var u=new n;this.getBasemapGalleryGroup(A).then(r.hitch(this,function(k){k?k.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(r.hitch(this,
function(w){u.resolve(w)}),r.hitch(this,function(w){console.error(w);u.reject(w)})):u.reject()}),r.hitch(this,function(k){console.error(k);u.reject(k)}));return u},getDefaultWebScene:function(A){var u=c.getStandardPortalUrl(A);return this._searchWABDefaultWebScene(u).then(r.hitch(this,function(k){return k?k:this._createWABDefaultWebScene(u).then(r.hitch(this,function(w){return this.getPortal(u).getUser().then(r.hitch(this,function(y){var C=!1;y&&y.privileges&&0<y.privileges.length&&(C=z.some(y.privileges,
function(D){return 0<=D.indexOf("shareToPublic")}));return C?y.shareItem({everyone:!0},w).then(r.hitch(this,function(){return w}),r.hitch(this,function(){return w})):w}),r.hitch(this,function(y){console.error(y);return w}))}))}))},_searchWABDefaultWebScene:function(A){var u=new n;A=c.getStandardPortalUrl(A);A=this.getPortal(A);A.queryItems({q:'typekeywords:"WABDefaultWebScene" orgid:'+A.user.orgId+" access:public "+this.webSceneQueryStr}).then(r.hitch(this,function(k){k&&k.results&&0<k.results.length?
u.resolve(k.results[0].id):u.resolve(null)}),r.hitch(this,function(k){console.error("_searchWABDefaultWebScene error:",k);u.reject(k)}));return u},_createWABDefaultWebScene:function(A){var u=new n;A=c.getStandardPortalUrl(A);this.getPortal(A).getUser().then(r.hitch(this,function(k){var w={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:t.stringify({operationalLayers:[],baseMap:{baseMapLayers:[{id:"VectorTile_2846",title:"Dark Gray Base",layerType:"VectorTileLayer",
styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json"},{id:"VectorTile_1645",title:"Dark Gray Reference",layerType:"VectorTileLayer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",isReference:!0}],id:"f9d4828215fa4a48935b2d7ffb19c168",title:"Dark Gray Canvas",elevationLayers:[{id:"globalElevation",listMode:"hide",title:"Terrain3D",url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
layerType:"ArcGISTiledElevationServiceLayer"}]},ground:{layers:[{id:"globalElevation",listMode:"hide",title:"Terrain3D",url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}],transparency:0,navigationConstraint:{type:"stayAbove"}},heightModelInfo:{heightModel:"gravity_related_height",heightUnit:"meter"},version:"1.22",initialState:{environment:{lighting:{datetime:1584297035E3,displayUTCOffset:-7},atmosphereEnabled:!0,
starsEnabled:!0},viewpoint:{camera:{position:{spatialReference:{latestWkid:3857,wkid:102100},x:-1.086995865773034E7,y:4489824.988560619,z:2.1453906561298884E7},heading:0,tilt:.11455639826428493}}},spatialReference:{latestWkid:3857,wkid:102100},viewingMode:"global",authoringApp:"WebAppBuilder",authoringAppVersion:"2.19"}),snippet:""};k.addItem(w,"").then(r.hitch(this,function(y){y.success?u.resolve(y.id):(console.error("Can't create default web scene:",y),u.reject())}))}),r.hitch(this,function(k){console.error("Can't create default web scene");
u.reject(k)}));return u},getDefaultWebMap:function(A){var u=new n;this.getPortalSelfInfo(A).then(r.hitch(this,function(k){var w=k.defaultBasemap&&k.defaultBasemap.id;w?u.resolve(w):this._getDefaultWebMapByBasemapGallery(A,k).then(r.hitch(this,function(y){y?u.resolve(y):this._getMostNumViewsWebMap(A).then(r.hitch(this,function(C){C?u.resolve(C):u.reject()}),r.hitch(this,function(C){console.error(C);u.reject(C)}))}),r.hitch(this,function(y){console.error(y);u.reject(y)}))}),r.hitch(this,function(k){console.error(k);
u.reject(k)}));return u},_getDefaultWebMapByBasemapGallery:function(A,u){var k=new n,w=this.getPortal(A),y=u.defaultBasemap&&u.defaultBasemap.title;w.queryGroups({f:"json",q:u.basemapGalleryGroupQuery}).then(r.hitch(this,function(C){C=C.results;0<C.length?w.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+C[0].id+" AND title:"+y}).then(r.hitch(this,function(D){D=D.results;D=z.filter(D,r.hitch(this,function(G){return G.type&&"web map"===G.type.toLowerCase()}));0<D.length?k.resolve(D[0].id):
(console.log("Can't find web map under basemapGalleryGroupQuery."),w.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+y}).then(r.hitch(this,function(G){G=G.results;G=z.filter(G,r.hitch(this,function(L){return L.type&&"web map"===L.type.toLowerCase()}));if(0<G.length){var H=G[0];w.getItemData(H.id).then(r.hitch(this,function(L){L&&(L.operationalLayers||L.baseMap||L.version)?k.resolve(H.id):k.resolve(null)}),r.hitch(this,function(){k.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),
k.resolve(null)}),r.hitch(this,function(G){console.error(G);k.reject(G)})))}),r.hitch(this,function(D){console.error(D);k.reject(D)})):(console.log("Can't find group by basemapGalleryGroupQuery."),k.resolve(null))}),r.hitch(this,function(C){console.error(C);k.reject(C)}));return k},_getMostNumViewsWebMap:function(A){var u=new n;this.getPortal(A).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(r.hitch(this,
function(k){k=k.results;k=z.filter(k,r.hitch(this,function(w){return w.type&&"web map"===w.type.toLowerCase()}));0<k.length?u.resolve(k[0].id):u.reject("Can't find most-num-views web map.")}),r.hitch(this,function(k){console.error(k);u.reject(k)}));return u},comparePortalVersion:function(A,u){var k=A.split(".");A=parseInt(k[0],10);k=1<k.length?parseInt(k[1],10):0;var w=u.split(".");u=parseInt(w[0],10);w=1<w.length?parseInt(w[1],10):0;return A>u?1:A<u?-1:k>w?1:k<w?-1:0},getItemResources:function(A,
u,k){k||(k=100);A=c.getStandardPortalUrl(A);A=c.getItemResourceUrl(A,u);return h({url:A,content:{f:"json",num:k}}).then(function(w){if(w&&w.resources)return w.resources})},addResource:function(A,u,k,w,y){A=c.getStandardPortalUrl(A);var C=this.getPortal(A),D=new FormData;D.append("file",k,w);D.append("fileName",w);D.append("f","json");var G="";y?(D.append("resourcesPrefix",y),G=y+"/"+w):G=w;return C.getItemById(u,!0).then(function(H){H=c.getUserContentItemUrl(A,H.owner,u);return h({url:H+"/addResources",
form:D}).then(function(L){var T="";L&&L.success&&(T=c.getItemResourceUrl(A,"${itemId}",G));return T},function(L){console.error(L.message||L);return L})})},removeResources:function(A,u,k,w){var y={resource:w?w+"/"+k:k,f:"json"};A=c.getStandardPortalUrl(A);return this.getPortal(A).getItemById(u,!0).then(function(C){C=c.getUserContentItemUrl(A,C.owner,u);return h({url:C+"/removeResources",content:y},{usePost:!0}).then(function(D){return D},function(D){console.error(D.message||D);return D})})}};v.subscribe("userSignOut",
function(A){(A=q._findPortal(A))&&A.clearCredentialAndUser()});return q})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(F,r,z,x,n){return F(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(v){v=v||{};this.id=v.id;this.baseRole=v.role;this.name=v.name;this.description=v.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,
disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,
fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1},publisher:{createNotebooks:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(v){n.isDefined(v)&&v instanceof Array&&z.forEach(v,r.hitch(this,function(t){this._readPrivilege(t)}))},_readPrivilege:function(v){this._applyEffectToAction(!0,v)},_applyEffectToAction:function(v,t){switch(t){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=
v;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=v;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=v;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=v;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=v;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=v;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=
v;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=v;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=v;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=v;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=v;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=v;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=
v;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=v;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=v;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=v;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=v;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=v;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=
v;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=v;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=v;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=v;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=v;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=v;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=
v;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=v;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=v;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=v;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=v;break;case "features:user:edit":this.privilegeObj.features.user.edit=v;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=v;break;
case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=v;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=v;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=v;break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=v;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=v;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=
v;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=v;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=v;break;case "premium:publisher:createNotebooks":this.privilegeObj.premium.publisher.createNotebooks=v;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=v;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=v;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=
v}},_applyToAll:function(v){this.privilegeObj.portal.admin.inviteUsers=v;this.privilegeObj.portal.admin.disableUsers=v;this.privilegeObj.portal.admin.viewUsers=v;this.privilegeObj.portal.admin.updateUsers=v;this.privilegeObj.portal.admin.deleteUsers=v;this.privilegeObj.portal.admin.changeUserRoles=v;this.privilegeObj.portal.admin.viewGroups=v;this.privilegeObj.portal.admin.updateGroups=v;this.privilegeObj.portal.admin.deleteGroups=v;this.privilegeObj.portal.admin.reassignGroups=v;this.privilegeObj.portal.admin.assignToGroups=
v;this.privilegeObj.portal.admin.manageEnterpriseGroups=v;this.privilegeObj.portal.admin.viewItems=v;this.privilegeObj.portal.admin.updateItems=v;this.privilegeObj.portal.admin.deleteItems=v;this.privilegeObj.portal.admin.reassignItems=v;this.privilegeObj.portal.admin.manageLicenses=v;this.privilegeObj.portal.publisher.publishFeatures=v;this.privilegeObj.portal.publisher.publishTiles=v;this.privilegeObj.portal.publisher.publishScenes=v;this.privilegeObj.portal.user.createGroup=v;this.privilegeObj.portal.user.joinGroup=
v;this.privilegeObj.portal.user.joinNonOrgGroup=v;this.privilegeObj.portal.user.createItem=v;this.privilegeObj.portal.user.shareToGroup=v;this.privilegeObj.portal.user.shareToOrg=v;this.privilegeObj.portal.user.shareToPublic=v;this.privilegeObj.portal.user.shareGroupToOrg=v;this.privilegeObj.portal.user.shareGroupToPublic=v;this.privilegeObj.features.user.edit=v;this.privilegeObj.opendata.user.openDataAdmin=v;this.privilegeObj.opendata.user.designateGroup=v;this.privilegeObj.premium.user.geocode=
v;this.privilegeObj.premium.user.networkanalysis=v;this.privilegeObj.premium.user.spatialanalysis=v;this.privilegeObj.premium.user.geoenrichment=v;this.privilegeObj.premium.user.demographics=v;this.privilegeObj.premium.user.elevation=v;this.privilegeObj.premium.publisher.createNotebooks=v;this.privilegeObj.marketplace.admin.purchase=v;this.privilegeObj.marketplace.admin.manage=v;this.privilegeObj.marketplace.admin.startTrial=v},_buildPrivilegesArray:function(){var v=[];!0===this.privilegeObj.portal.admin.inviteUsers&&
v.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&v.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&v.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&v.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&v.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&v.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&
v.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&v.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&v.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&v.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&v.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&v.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&
v.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&v.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&v.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&v.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&v.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&v.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&
v.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&v.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&v.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&v.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&v.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&v.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&
v.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&v.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&v.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&v.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&v.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&v.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&
v.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&v.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&v.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&v.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&v.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&v.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&
v.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&v.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&v.push("premium:user:elevation");!0===this.privilegeObj.premium.publisher.createNotebooks&&v.push("premium:publisher:createNotebooks");!0===this.privilegeObj.marketplace.admin.purchase&&v.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&v.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&
v.push("marketplace:admin:startTrial");return v},isUser:function(){return n.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return n.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return n.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||n.isDefined(this.baseRole)&&("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||
n.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||n.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&n.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},
canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},
canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&
this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},
canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},
canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},
canCreateNotebooks:function(){return this.privilegeObj&&this.privilegeObj.premium.publisher.createNotebooks},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(v){this.privileges=v;this._initPrivilegesObject();n.isDefined(v)&&
this._readPrivileges(v)},stringify:function(){return x.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return x.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return x.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return x.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},
null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(F,r){var z=null,x=F(null,{cache:{},getServiceDefinition:function(n,v){v||(v="json");var t=this.cache[n];0>=this._getDefStatus(t)&&(t=r({url:n,handleAs:v,content:{f:v},callbackParamName:"callback"}),this.cache[n]=t);return t},_getDefStatus:function(n){return n?n.isFulfilled()?n.isResolved()?2:-1:1:0}});x.getInstance=function(){z||(z=new x,window._serviceDefinitionManager=z);return z};return x})},
"jimu/LayerNode":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/Evented"],function(F,r,z,x,n){var v=F([n],{declaredClass:"jimu.LayerNode",_layerInfo:null,map:null,title:null,id:null,subId:null,layerObject:null,constructor:function(t){this._layerInfo=t;this.map=t.map;this.title=t.title;this.id=t.id;this.subId=t.subId},isLeaf:function(){return this._layerInfo.isLeaf()},isRoot:function(){return this._layerInfo.isRootLayer()},toggle:function(){this._layerInfo.setTopLayerVisible(!this.isToggledOn())},
isToggledOn:function(){return this._layerInfo.isVisible()},show:function(){this._layerInfo.show()},hide:function(){this._layerInfo.hide()},isVisible:function(){return this._layerInfo.isShowInMap()},traversal:function(t){return this._layerInfo.traversal(function(m){return t(m._adaptor)})},getNodeById:function(t){var m=null;if(t=this._layerInfo.findLayerInfoById(t))m=t._adaptor;return m},getExtent:function(){return this._layerInfo.getExtent()},getOpacity:function(){return this._layerInfo.getOpacity()},
setOpacity:function(t){this._layerInfo.setOpacity(t)},getServiceDefinition:function(){return this._layerInfo.getServiceDefinition()},getLayerObject:function(){return this._layerInfo.getLayerObject()},getRootNode:function(){return this._layerInfo.getRootLayerInfo()._adaptor},getParentNode:function(){var t=this._layerInfo.parentLayerInfo;return t?t._adaptor:null},getSubNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfo.getSubLayers())},getNodeLevel:function(){return this._layerInfo.getLayerLevel()},
getLayerType:function(){return this._layerInfo.getLayerType()},getPopupInfoFromWebmap:function(){return this._layerInfo.getPopupInfo()},getPopupInfo:function(){return this._layerInfo.getPopupInfoFromLayerObject()},loadPopupInfo:function(){return this._layerInfo.loadPopupInfo()},getInfoTemplate:function(){return this._layerInfo.getInfoTemplate()},loadInfoTemplate:function(){return this._layerInfo.loadInfoTemplate()},getFilterFromWebmap:function(){return this._layerInfo.getFilterOfWebmap()},getFilter:function(){return this._layerInfo.getFilter()},
setFilter:function(t){this._layerInfo.setFilter(t)},isShowLegend:function(){return this.isShowLegendFromWebmap()},isShowLegendFromWebmap:function(){return this._layerInfo.getShowLegendOfWebmap()},isToggledOnLegendFromWebMap:function(){return this._layerInfo._getShowLegendOfWebmap()},getUrl:function(){return this._layerInfo.getUrl()},getRelatedNodes:function(){var t=new x;this._layerInfo.getRelatedTableInfoArray().then(z.hitch(this,function(m){t.resolve(this._getNodesArrayFromInfosArray(m))}));return t},
isVisibleAtMapScale:function(){return this._layerInfo.isInScale()},enablePopup:function(){return this._layerInfo.enablePopup()},disablePopup:function(){return this._layerInfo.disablePopup()},isPopupEnabled:function(){return this._layerInfo.isPopupEnabled()},isItemLayer:function(){return this._layerInfo.isItemLayer()},getItemInfo:function(){return this._layerInfo.getItemInfo()},isHostedService:function(){return this._layerInfo.isHostedService()},isHostedLayer:function(){return this._layerInfo.isHostedLayer()},
canShowLabel:function(){return this._layerInfo.canShowLabel()},isLabelVisble:function(){return this._layerInfo.isShowLabels()},showLabel:function(){this._layerInfo.showLabels()},hideLabel:function(){this._layerInfo.hideLabels()},isTable:function(){return!!this._layerInfo.isTable},isTiled:function(){return!!this._layerInfo.isTiled},isBasemap:function(){return this._layerInfo.isBasemap()},isEditable:function(t){return this._layerInfo.isEditable(t)},zoomTo:function(t){return this._layerInfo.zoomTo(t)},
emitEvent:function(t){try{var m=null;switch(t){case "isVisibleChanged":m=v.EVENT_TOOGLE_CHANGE;break;case "isShowInMapChanged":m=v.EVENT_VISIBILITY_CHANGE;break;case "filterChanged":m=v.EVENT_FILTER_CHANGE;break;case "rendererChanged":m=v.EVENT_RENDERER_CHANGE;break;case "opacityChanged":m=v.EVENT_OPACITY_CHANGE;break;case "timeExtentChanged":m=v.EVENT_TIME_EXTENT_CHANGE}m&&this.emit(m)}catch(h){console.error(h)}},destroy:function(){this.inherited(arguments)},_getNodesArrayFromInfosArray:function(t){var m=
[];r.forEach(t,function(h){m.push(h._adaptor)},this);return m}});z.mixin(v,{EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return v})},"jimu/privilegeUtils":function(){define("dojo/Deferred esri/arcgis/OAuthInfo esri/IdentityManager esri/request jimu/tokenUtils jimu/portalUrlUtils".split(" "),function(F,r,
z,x,n,v){return{checkEssentialAppsLicense:function(t,m,h){var p=v.getStandardPortalUrl(m.portalUrl),e=v.getSharingUrl(p);p=new r({appId:"arcgisWebApps",portalUrl:p});z.registerOAuthInfos([p]);var c=new F;(h?z.checkAppAccess(e,"arcgisWebApps"):m.getItemById(t).then(function(f){return"public"===f.access?{isPublicApp:!0}:z.checkAppAccess(e,"arcgisWebApps")})).then(function(f){m.getSigninSettingsOfSelfInfo().then(function(b){b&&b.blockedApps&&b.blockedApps.indexOf&&-1<b.blockedApps.indexOf("webappbuilder")?
c.reject({message:"wab is blocked by org admin",isBlockedByOrg:!0}):c.resolve(f)},function(b){c.reject({message:b&&b.message,isBlockedByOrg:!1})})},function(f){c.reject({message:f&&f.message,isBlockedByOrg:!1})});return c},checkIsSelfOrigin:function(t,m,h){var p=!0,e=v.getPortalUrlFromLocation();e=v.getStandardPortalUrl(e);t=v.getItemUrl(e,t);var c=window.location.host;e=n.userHaveSignInPortal(e);c=0<=["www.arcgis.com","devext.arcgis.com","qaext.arcgis.com"].indexOf(c);var f=window.location!==window.parent.location;
if(m.isPortal||h||c||e||f)m=new F,m.resolve(p);else return x({url:t,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(function(b){b.contentOrigin&&"self"!==b.contentOrigin&&(p=!1);return p});return m}}})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(F,r,z){var x=F(null,{_realRequest:null,_buffer:null,constructor:function(n){this._buffer={};this._realRequest=n?n:function(){return new z}},getRequest:function(n){this._buffer[n]||
(this._buffer[n]=new x.RequestProxy(this._realRequest,n));return this._buffer[n]},request:function(n){var v=Array.prototype.slice.apply(arguments);v.splice(0,1);var t=this.getRequest(n);return t.request.apply(t,v)},setResponse:function(n,v){this.getRequest(n).setResponse(v)},isResolved:function(n){return this.getRequest(n).isResolved()}});x.RequestProxy=F(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(n,v){this._realRequest=n;this._key=v},request:function(){this._deferred||
(this._deferred=new z,this._realRequest.apply(null,arguments).then(r.hitch(this,function(n){this._deferred.resolve(n)}),r.hitch(this,function(n){n&&console.warn(n.message||n);n=this._deferred;this._deferred=null;n.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new z);return this._deferred},setResponse:function(n,v){this._deferred||(this._deferred=new z);null===n||void 0===n?(this._deferred.resolve(null),v&&(this._deferred=null)):this._deferred.resolve(n)},
isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return x})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/layers/FeatureLayer esri/lang".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){return F(m,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,constructor:function(){},
init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._initAfterRootLayerInfo();this._needToRefresh().then(z.hitch(this,function(c){c&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_initAfterRootLayerInfo:function(){this.traversal(function(c){!c.isRootLayer()&&c._initAfterRootLayerInfo&&c._initAfterRootLayerInfo()})},_needToRefresh:function(){var c=new x;this.layerObject.dynamicLayerInfos&&
this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(z.hitch(this,function(f){(f=(f=f.getItemData())&&f.thematicGroup)?(this.originOperLayer.thematicGroup=f,c.resolve(!0)):c.resolve(!1)})):c.resolve(!1);return c},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var c=r.filter(this.originOperLayer.layers,function(f){return e.isDefined(f.id)&&
e.isDefined(f.name)&&e.isDefined(f.minScale)&&e.isDefined(f.maxScale)&&e.isDefined(f.parentLayerId)&&e.isDefined(f.defaultVisibility)});this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?r.filter(this.layerObject.dynamicLayerInfos,function(f){return-1<this.originOperLayer.thematicGroup.layerIds.indexOf(f.id)?!0:!1},this):this.layerObject.dynamicLayerInfos:0<
c.length?c:this.layerObject.layerInfos},_cloneInfoTemplates:function(c){var f={},b;for(b in c)if(c.hasOwnProperty(b)&&"function"!==typeof c[b]){var d=c[b];d.infoTemplate&&d.infoTemplate.toJson&&(f[b]={infoTemplate:new d.infoTemplate.constructor(d.infoTemplate.toJson()),layerUrl:d.layerUrl,resourceInfo:d.resourceInfo})}return f},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:this._cloneInfoTemplates(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=
this._cloneInfoTemplates(this.layerObject.infoTemplates);v.after(this.layerObject,"setInfoTemplates",z.hitch(this,function(){this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.traversal(function(c){c._afterSetInfoTemplates&&c._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new x}},_initSubLayerVisible:function(c){this._subLayerVisible=
{};for(var f=0;f<this._jsapiLayerInfos.length;f++)this._subLayerVisible[this._jsapiLayerInfos[f].id]=!1;c?r.forEach(c,function(b){this._subLayerVisible[b]=!0},this):this.originOperLayer.visibleLayers?r.forEach(this.originOperLayer.visibleLayers,function(b){this._subLayerVisible[b]=!0},this):r.forEach(this._jsapiLayerInfos,function(b){b.defaultVisibility&&(this._subLayerVisible[b.id]=!0)},this)},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(c){this.originOperLayer.layerObject.setVisibility(c);
this._visible=c},_setSubLayerVisible:function(c){var f=[-1,-1,-1],b=[],d=r.filter(this.originOperLayer.layerObject.visibleLayers,function(q){return-1!==q});r.forEach(d,function(q){if(!this._isGroupLayerBySubId(q)){var A=this._subLayerInfoIndex[q];A&&A._isAllSubLayerVisibleOnPath()&&b.push(q)}},this);d=b;for(var a in c)if(c.hasOwnProperty(a)&&"function"!==typeof c[a]){var g=Number(a);if(c[a]){var l=r.indexOf(d,g);0>l&&d.push(g)}else l=r.indexOf(d,g),0<=l&&d.splice(l,1)}f=f.concat(d);this.originOperLayer.layerObject.setVisibleLayers(f)},
_resetLayerObjectVisiblity:function(c){var f=c?c[this.id]:null,b=!1;if(c&&(f&&this.layerObject.setVisibility(f.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){f={};for(var d in c)c.hasOwnProperty(d)&&"function"!==typeof c[d]&&(b=!0,f[d]=c[d].visible);b&&this._setSubLayerVisibleByCheckedInfo(f)}},_setSubLayerVisibleByCheckedInfo:function(c){var f=[];r.forEach(this._jsapiLayerInfos,function(d){var a=this.id+"_"+d.id;e.isDefined(c[a])?c[a]&&f.push(d.id):this._subLayerVisible[d.id]&&
f.push(d.id)},this);this._initSubLayerVisible(f);this.traversal(function(d){d._initVisible()});var b={};this.traversal(function(d){0!==d.getSubLayers().length||d.isRootLayer()||(b[d.originOperLayer.mapService.subId]=d._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(b)},_subLayerVisibleChanged:function(){var c=[];this.traversal(function(f){c.push(f)});t.publish("layerInfos/layerInfo/visibleChanged",c)},obtainNewSubLayers:function(){var c=[],f=this.originOperLayer.layerObject,b=null;b="esri.layers.ArcGISDynamicMapServiceLayer"===
f.declaredClass?"dynamic":"tiled";r.forEach(this._jsapiLayerInfos,function(a){this._addNewSubLayer(c,f.url+"/"+a.id,f.id+"_"+a.id,a,a.subLayerIds&&0<a.subLayerIds.length?b+"_group":b)},this);var d=[];r.forEach(this._jsapiLayerInfos,function(a,g){a=a.parentLayerId;if(-1!==a){for(var l=null,q=0;q<c.length;q++)if(c[q].mapService.subId===a){l=c[q];break}(a=l)&&a.subLayers.push(c[g])}},this);r.forEach(this._jsapiLayerInfos,function(a,g){-1===a.parentLayerId&&(a=this._layerInfoFactory.create(c[g]),d.push(a),
a.init())},this);return d},_addNewSubLayer:function(c,f,b,d,a){var g=d.source&&d.source.mapLayerId;if(void 0===g||null===g)g=d.id;var l=this.getMSShipFeatureLayer(f,d.id);c.push({layerObject:{url:f,empty:!0},title:d.name||d.id||" ",id:b||"-",subId:d.id,subLayers:[],mapService:{layerInfo:this,subId:d.id,mapServiceSubId:g},selfType:l?"mapservice_"+a+"_ship_featurelayer":"mapservice_"+a,msShipFLayerId:l&&l.id,parentLayerInfo:this})},_handleErrorSubLayer:function(c,f,b,d,a,g){c[f]={layerObject:null,title:g.name||
g.id||" ",id:b||" ",subLayers:[],mapService:{layerInfo:this,subId:d}}},getMSShipFeatureLayer:function(c,f){var b=null,d=c.indexOf("/MapServer");if(-1<d){var a=this.map.graphicsLayerIds.map(z.hitch(this,function(l){return this.map.getLayer(l)})),g=c.substring(0,d+1);a.some(z.hitch(this,function(l){var q=l.url;return q&&-1<q.indexOf(g+"FeatureServer/"+f)&&l&&!l.empty&&l.mode===p.MODE_SELECTION&&!z.getObject("_wabProperties.isMSOwnedFeatureLayer",!1,l)?(b=l,!0):!1}))}return b},getLegendInfo:function(c){var f=
new x;this._legendInfo?f.resolve(this._legendInfo):this._legendRequest(c).then(z.hitch(this,function(b){this._legendInfo=b.layers;f.resolve(this._legendInfo)}),function(){f.reject()});return f},_legendRequest:function(c){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(c)},_legendRequestServer:function(){var c=this.layerObject.url+"/legend",f={f:"json"};this.layerObject._params.dynamicLayers&&(f.dynamicLayers=n.stringify(this._createDynamicLayers(this.layerObject)),
"[{}]"===f.dynamicLayers&&(f.dynamicLayers="[]"));return h({url:c,content:f,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(c){return h({url:c+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(c){var f=[],b;r.forEach(c.dynamicLayerInfos||c.layerInfos,function(d){b={id:d.id};b.source=d.source&&d.source.toJson();var a;c.layerDefinitions&&c.layerDefinitions[d.id]&&(a=c.layerDefinitions[d.id]);
a&&(b.definitionExpression=a);var g;c.layerDrawingOptions&&c.layerDrawingOptions[d.id]&&(g=c.layerDrawingOptions[d.id]);g&&(b.drawingInfo=g.toJson());b.minScale=d.minScale||0;b.maxScale=d.maxScale||0;f.push(b)});return f},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_getSubserviceDefinition:function(c){return 10.11<=this.layerObject.version?this._getAllLayerAndTable(c):this._getLayerAndTable(c)},_getAllLayerAndTable:function(c){var f=
this.layerObject.url+"/layers",b=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");b.isResolved()||b.request(f).then(z.hitch(this,function(d){d||(d={layers:[]});this.traversal(z.hitch(this,function(a){if(!a.isRootLayer()){var g=a.originOperLayer.mapService.mapServiceSubId;a=this._serviceDefinitionBuffer.getRequest(g);var l=null;r.some(d.layers,function(q){if(q.id===g)return l=q,!0},this);a.setResponse(l)}}))}));return this._serviceDefinitionBuffer.getRequest(c).fakeRequest()},
_getLayerAndTable:function(c){var f=this.layerObject.url+"/"+c;return this._serviceDefinitionBuffer.getRequest(c).request(f)},_getSublayerSettingOfWebmap:function(c){var f=r.filter(this.originOperLayer.layers,function(b){return b.id===c});return 1===f.length?f[0]:null},_getSublayerShowLegendOfWebmap:function(c){return(c=this._getSublayerSettingOfWebmap(c))?void 0!==c.showLegend?c.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(c){return null===this._getJsapiLayerInfoById(c)?!1:!0},_getJsapiLayerInfoById:function(c){for(var f=
null,b=0;b<this._jsapiLayerInfos.length;b++)if(this._jsapiLayerInfos[b].id===c){f=this._jsapiLayerInfos[b];break}return f},_isGroupLayerBySubId:function(c){return(c=this._getJsapiLayerInfoById(c))&&c.subLayerIds&&0<c.subLayerIds.length?!0:!1},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty){var c=this.layerObject.on("visible-layers-change",z.hitch(this,this._onVisibleLayersChanged));this._eventHandles.push(c);c=v.after(this.layerObject,"setLayerDefinitions",
z.hitch(this,this._onFilterChanged));this._eventHandles.push(c)}},_onVisibleLayersChanged:function(c){var f=c.visibleLayers;if(-1===f[0]&&-1===f[1]&&-1===f[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{c=[];var b=[-1,-1,-1];f=this._converVisibleLayers(f);c=f.visibleLayersForUpdateSubLayerVisible;b=b.concat(f.visibleLayersForSetVisibleLayers);this._initSubLayerVisible(c);this.traversal(function(d){d._initVisible()});this.layerObject.setVisibleLayers(b)}},_converVisibleLayers:function(c){var f=
{visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};r.forEach(c,function(b){var d=this.findLayerInfoById(this.id+"_"+b);if(this._isGroupLayerBySubId(b))d.traversal(function(a){c.push(a.originOperLayer.mapService.subId)});else for(;d&&d.originOperLayer.mapService;)c.push(d.originOperLayer.mapService.subId),d=d.parentLayerInfo},this);r.forEach(c,function(b){0<=b&&0>f.visibleLayersForUpdateSubLayerVisible.indexOf(b)&&f.visibleLayersForUpdateSubLayerVisible.push(b)},this);r.forEach(f.visibleLayersForUpdateSubLayerVisible,
function(b){this._isGroupLayerBySubId(b)||f.visibleLayersForSetVisibleLayers.push(b)},this);return f},_onFilterChanged:function(){for(var c,f=[],b=this.layerObject.layerDefinitions,d=b.length>this._oldFilter.length?b.length:this._oldFilter.length,a=0;a<d;a++)(b[a]?b[a]:null)!==(this._oldFilter[a]?this._oldFilter[a]:null)&&(c=this.findLayerInfoById(this.id+"_"+a))&&c.isLeaf()&&f.push(c);0<f.length&&(t.publish("layerInfos/layerInfo/filterChanged",f,z.getObject("_wabProperties.objectPassWithFilterChangeEvent",
!0,this.layerObject)),this._oldFilter=b,z.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){return F(t,{constructor:function(){},_getExtentAsync:function(){var c=this.layerObject.getLayers(),f=null,b=null;
if(0<c.length&&"esri.layers.KMLLayer"===c[0].declaredClass){var d=[];this.traversal(z.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&d.push(a)}));r.forEach(d,function(a){b=a._getExtentAsync();f=f?f.union(b):b},this)}else r.forEach(c,function(a){b=h.graphicsExtent(a.graphics);f=f?f.union(b):b},this);return f},_getExtent:function(){var c=new p;c.resolve(this._getExtentAsync());return c},_resetLayerObjectVisiblity:function(c){var f=c?c[this.id]:null;if(f){var b=
{},d;for(d in c)c.hasOwnProperty(d)&&"function"!==typeof c[d]&&(b[d]=c[d].visible);this._setSubLayerVisibleByCheckedInfo(b);this._setTopLayerVisible(f.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){this.traversal(z.hitch(this,function(f){e.isDefined(c[f.id])&&f._setTopLayerVisible(c[f.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(c){c?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var c=
[];r.forEach(this._getOperLayerByParentFolderId(-1,this),function(f){f=this._layerInfoFactory.create(f);c.push(f);f.init()},this);return c},_getOperLayerByParentFolderId:function(c,f){var b=[],d=this.layerObject.getLayers()||[],a=r.filter(this.layerObject.folders||[],function(l){return l.parentFolderId===c?!0:!1}),g=[];g=0===a.length?r.filter(d,function(l){return this._flag.kmzSubLayersWereHandled?!1:!0},this):a;r.forEach(g,function(l){if("esri.layers.KMLFolder"===l.declaredClass)var q={layerObject:l,
title:l.label||l.title||l.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(l),subId:l.id,kml:{layerInfo:this,currentFolder:l},selfType:"kml",parentLayerInfo:f};else"esri.layers.KMLLayer"===l.declaredClass?(q=z.getObject("linkInfo.name",!1,l),q={layerObject:l,title:l.label||l.title||q||l.name||l.id||" ",id:l.id||"-",subId:l.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",parentLayerInfo:f},z.setObject("_wabProperties.kmllayerWasHandled",!0,l),this._flag.kmzSubLayersWereHandled=
!0):(z.setObject("_wabProperties.kmllayerWasHandled",!0,l),z.setObject("_wabProperties.isTemporaryLayer",!0,l));q&&b.push(q)},this);return b},_getAllSubLayerObject:function(){var c=[];this.traversal(z.hitch(this,function(f){f.layerObject&&f.layerObject.getLayers&&(c=c.concat(f.layerObject.getLayers()))}));return c},_getSubLayerInfoIdForSubFolder:function(c){return this.id+"_folder_"+c.id},_needToRenew:function(){return r.some(this._getAllSubLayerObject(),function(c){if(!z.getObject("_wabProperties.kmllayerWasHandled",
!1,c))return!0},this)},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty){var c=n.after(this.layerObject,"setFolderVisibility",z.hitch(this,this._onSubFolderVisibleChanged),!0);this._eventHandles.push(c)}},_onSubFolderVisibleChanged:function(c){c=this._getSubLayerInfoIdForSubFolder(c);(c=this.findLayerInfoById(c))&&v.publish("layerInfos/layerInfo/visibleChanged",[c])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/RelationshipQuery esri/tasks/QueryTask".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y){return F(v,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(C){console.warn(C.message)}},_updateLayerObjectName:function(){if(this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!z.getObject("_wabProperties.originalLayerName",!1,this.layerObject)){z.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject);
this.layerObject.name=this.title;if(void 0===this.layerObject.arcgisProps||null===this.layerObject.arcgisProps)this.layerObject.arcgisProps={};z.setObject("arcgisProps.title",this.title,this.layerObject)}},_initToShowLabels:function(){var C=z.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);C&&!this.layerObject.empty&&f.getPortal(C.portalUrl).getItemData(C.itemId).then(z.hitch(this,function(D){var G;D&&D.layers&&(r.some(D.layers,function(H){return H.id===this.layerObject.layerId?(G=H,
!0):!1},this),G&&G.showLabels&&((D=z.getObject("layerDefinition.drawingInfo.labelingInfo",!1,G))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(D=r.map(D,function(H){return new g(H)},this),this.layerObject.setLabelingInfo(D)),this.showLabels()))}),z.hitch(this,function(D){D&&D.message&&console.log(D.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():
null},_getLayerOptionsForCreateLayerObject:function(){var C={};C.id=this.id;var D=[],G=this.getInfoTemplate();G&&G.info&&G.info.fieldInfos?r.forEach(G.info.fieldInfos,function(H){H.visible&&D.push(H.fieldName)},this):D=["*"];C.outFields=D;return C},_getExtent:function(){var C=new x;var D=this.layerObject.graphics&&0<this.layerObject.graphics.length?b.graphicsExtent(this.layerObject.graphics):this.layerObject.fullExtent||this.layerObject.initialExtent;this.layerObject.url?this.getServiceDefinition().then(z.hitch(this,
function(G){var H=new y(this.layerObject.url),L=new k,T=this.getFilter();L.where=T?T:"1\x3d1";L.outSpatialReference=this.map.spatialReference;L.returnGeometry=!0;G&&G.advancedQueryCapabilities&&G.advancedQueryCapabilities.supportsReturningQueryExtent?H.executeForExtent(L,z.hitch(this,function(K){var O=K.extent;1===K.count&&"esriGeometryPoint"===this.layerObject.geometryType&&(K=new u(K.extent.xmin,K.extent.ymin,K.extent.spatialReference),O=b.graphicsExtent([new A(K)]));C.resolve(O)}),z.hitch(this,
function(){C.resolve(D);console.log("executeForExtent failed.")})):this.getSupportTableInfo().then(z.hitch(this,function(K){K.isSupportQuery?H.execute(L).then(z.hitch(this,function(O){O=b.graphicsExtent(O.features);C.resolve(O)}),z.hitch(this,function(){C.resolve(D);console.log("query execute failed.")})):C.resolve(D)}))})):C.resolve(D);return C},_resetLayerObjectVisiblity:function(C){C=C?C[this.id]:null;!this.originOperLayer.collection&&C&&(this.layerObject.setVisibility(C.visible),this._visible=
this.layerObject.visible)},_initVisible:function(){var C=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){C=this.originOperLayer.collection.layerInfo;var D=this.layerObject.visible;if(C._oldIsShowInMap!==C.isShowInMap())return;this._visible=D?!0:!1;C._onVisibilityChanged()}else this._visible=C=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(C){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?
C?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):C?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(C?this.layerObject.show():this.layerObject.hide(),this._visible=C)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(C){for(var D={},G=this;G.parentLayerInfo;)D[G.id]=C,G=G.parentLayerInfo;
return D},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var C=this.getRootLayerInfo();if(C._setSubLayerVisibleByCheckedInfo){var D=this._prepareCheckedInfoForShowOrHide(!0);C._setSubLayerVisibleByCheckedInfo(D);C.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var C=e.after(this.layerObject,"setInfoTemplate",
z.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}));this._eventHandles.push(C)},_getServiceDefinition:function(){var C;(C=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?C=this._serviceDefinitionBuffer.getRequest(this.subId).request(C):(C=new x,C.resolve(null));return C},createLegendsNode:function(){var C=
m.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);m.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},C);return C},drawLegends:function(C){this._initLegendsNodeByLegendDijit(C)},_initLegendsNodeByLegendDijit:function(C){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){m.empty(C);p.remove(C,
"jimu-legends-div-flag");var D=new q({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:q.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},m.create("div",{},C));D.startup();C._legendDijit=D}},_initLegendsNode:function(C){var D=[],G=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(m.empty(C),G.renderer&&(G.renderer.infos?D=z.clone(G.renderer.infos):D.push({label:G.renderer.label,symbol:G.renderer.symbol}),
G.renderer&&G.renderer.defaultSymbol&&0<D.length&&D.push({label:G.renderer.defaultLabel||"others",symbol:G.renderer.defaultSymbol}),r.forEach(D,function(H){H.legendDiv=m.create("div",{"class":"legend-div"},C);H.symbolDiv=m.create("div",{"class":"legend-symbol jimu-float-leading"},H.legendDiv);H.labelDiv=m.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.sanitizeHTML(H.label)||" "},H.legendDiv);if("textsymbol"===H.symbol.type)h.set(H.symbolDiv,"innerHTML",b.sanitizeHTML(H.symbol.text));
else{var L=t.createSurface(H.symbolDiv,50,50);H=d.getShapeDescriptors(H.symbol);L.createShape(H.defaultShape).setFill(H.fill).setStroke(H.stroke).setTransform(t.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var C=[];r.forEach(this.originOperLayer.subLayers,function(D){D.parentLayerInfo=this;D=this._layerInfoFactory.create(D);C.push(D);D.init()},this);return C},_isAllSubLayerVisibleOnPath:function(){for(var C=!0,D=this;!D.isRootLayer();)C=C&&D.isVisible(),D=D.parentLayerInfo;return C},
_getCustomPopupInfo:function(C,D){var G=null;C&&C.fields&&(G={title:C.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},r.forEach(C.fields,function(H){var L=!1;D?r.some(D,z.hitch(this,function(T){return T&&H.name.toLowerCase()===T.toLowerCase()}))&&(L=!0):L=!0;L&&(L=b.getDefaultPortalFieldInfo(H),L.visible=!0,L.isEditable=H.editable,G.fieldInfos.push(L))},this));return G},_getDefaultPopupInfo:function(C){if(C=this._getCustomPopupInfo(C))C.fieldInfos=r.filter(C.fieldInfos,z.hitch(this,
function(D){return(D=D.fieldName&&D.fieldName.toLowerCase())&&0>D.indexOf("object")&&0>D.indexOf("globalid")&&0>D.indexOf("shape")&&0>D.indexOf("perimeter")?!0:!1}));return C},_getDefaultPopupTemplate:function(C){var D=null;(C=this.getPopupInfo()||this._getDefaultPopupInfo(C))&&(D=new l(C));return D},enablePopup:function(){return this.loadInfoTemplate().then(z.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,
!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},isSupportPopup:function(){var C=new x;this.loadInfoTemplate().then(z.hitch(this,function(D){D?C.resolve(!0):C.resolve(!1)}));return C},loadInfoTemplate:function(){var C=new x;this.controlPopupInfo.infoTemplate?C.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(z.hitch(this,
function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);C.resolve(this.controlPopupInfo.infoTemplate)}),z.hitch(this,function(){C.resolve(null)}));return C},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(C,D){var G=[];if(!C||!C.url||!C.relationships)return G;var H=C.url.lastIndexOf("/"),L=C.url.slice(0,H);r.forEach(C.relationships,function(T){D&&T.role&&"esriRelCardinalityManyToMany"!==T.cardinality&&D!==T.role||
G.push(L+"/"+T.relatedTableId.toString())},this);return G},getRelatedTableInfoArray:function(C){var D=[],G=new x;this.getLayerObject().then(z.hitch(this,function(H){var L=this._getRelatedUrls(H,C);0!==L.length&&this._getLayerInfosObj().traversalAll(z.hitch(this,function(T){if(0===L.length)return!0;r.forEach(L,function(K,O){z.getObject("layerObject.url",!1,T)&&K&&c.removeProtocol(K.toString().toLowerCase()).replace(/\/+/g,"/")===c.removeProtocol(T.layerObject.url.toString().toLowerCase()).replace(/\/+/g,
"/")&&(D.push(T),L[O]="")},this);return!1}));G.resolve(D)}),z.hitch(this,function(){G.resolve(D)}));return G},_getOrderByFields:function(C){var D=null;if(void 0===C||null===C)return D;var G=this.getPopupInfo();G&&G.relatedRecordsInfo&&G.relatedRecordsInfo.orderByFields&&r.some(G.relatedRecordsInfo.orderByFields,function(H){var L=H.field.split("/");if(L[1]===C.toString())return D=[L[2]+" "+H.order],!0},this);return D},getOriRelationshipByDestLayer:function(C,D,G){var H=null;C=r.filter(C.relationships,
function(L){if(L.relatedTableId===D.layerId)return!0},this);return H=C[G]?C[G]:C[0]},getRelatedRecords:function(C,D,G){var H=new x,L=new w,T=this.getLayerObject(),K=D.getLayerObject();n({originalLayerObject:T,relatedLayerObject:K}).then(z.hitch(this,function(O){O.originalLayerObject&&O.relatedLayerObject||H.resolve([]);O=this.getOriRelationshipByDestLayer(this.layerObject,O.relatedLayerObject,G);L.outFields=["*"];L.relationshipId=O&&O.id;var I=C.attributes[this.layerObject.objectIdField];L.objectIds=
[I];L.definitionExpression=D.getFilter();L.orderByFields=this._getOrderByFields(O&&O.id);this.layerObject.queryRelatedFeatures(L,z.hitch(this,function(P){(P=P[I]&&P[I].features)?H.resolve(P):H.resolve([])}),z.hitch(this,function(){H.resolve([])}))}));return H},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(C,D){this.layerObject&&!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&
(D=z.mixin({},D),z.setObject("_wabProperties.objectPassWithFilterChangeEvent",D,this.layerObject),this.layerObject.setDefinitionExpression(C))},_isAlreadyInLabelLayerOfMap:function(C){var D=!1;C&&(D=r.some(C.getFeatureLayers(),function(G){return this.id===G.id},this));return D},_addToLabelLayerOfMap:function(){var C=this.getLabelLayerOfMap();C&&!this._isAlreadyInLabelLayerOfMap(C)&&(C.addFeatureLayer(this.layerObject),this.map.removeLayer(C),this.map.addLayer(C))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},
_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){if(this.map._labels)var C=this.map._labels;else C=this.map.getLayer("labels"),C||(C=new a({id:"labels"}),this.map.addLayer(C));return C},obtainLabelControl:function(){var C=this.id+"_labelLayer",D=this.map.getLayer(C);if(!D&&this._isSupportLabelControl()){var G=
this.getLabelLayerOfMap();G&&this._isAlreadyInLabelLayerOfMap(G)&&(D=new a({id:C}),D.addFeatureLayer(this.layerObject),this.map.addLayer(D),this._removeFromLabelLayerOfMap())}return D?D:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var C=this.map.getLayer(this.id+"_labelLayer");C&&this.map.removeLayer(C)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),
this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var C=this.map.getLayer(this.id+"_labelLayer"),D=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(C||D&&this._isAlreadyInLabelLayerOfMap(D))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},
hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},"esri/layers/LabelLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/i18n!dojo/cldr/nls/number dojo/number dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../ArcadeExpression ../core/timerUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ../renderers/SimpleRenderer ../arcadeProfiles/labelingProfile ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./GraphicsLayer ./LabelClass".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C){function D(G){return"sizeInfo"===G.type}F=F(y,{declaredClass:"esri.layers.LabelLayer",constructor:function(G){this._refreshLabels=r.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];G&&(G.id&&(this.id=G.id),G.mode&&(this._engineType="DYNAMIC"===G.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(G){this._mapEventHandlers.push(G.on("extent-change",
r.hitch(this,"_handleLevelChange")));var H=this.inherited(arguments);this.refresh();return H},_unsetMap:function(){var G;for(G=0;G<this._mapEventHandlers.length;G++)x.disconnect(this._mapEventHandlers[G]);this.refresh();b.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(G){this._engineType=G&&"DYNAMIC"===G.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(G,H,L,T){if(!this.getFeatureLayer(G.layerId)){var K=[];K.push(G.on("update-end",
r.hitch(this,"refresh")));K.push(G.on("suspend",r.hitch(this,"refresh")));K.push(G.on("resume",r.hitch(this,"refresh")));K.push(G.on("edits-complete",r.hitch(this,"refresh")));K.push(G.on("labeling-info-change",r.hitch(this,"refresh")));K.push(G.on("time-extent-change",r.hitch(this,"refresh")));K.push(G.on("show-labels-change",r.hitch(this,"refresh")));K.push(G.on("feature-reduction-change",r.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:G,LabelExpressionInfo:L,LabelingOptions:T,
LabelRenderer:H,EventHandlers:K});this.featureLayers.push(G);this.refresh()}},getFeatureLayer:function(G){var H;for(H=0;H<this.featureLayers.length;H++){var L=this.featureLayers[H];if(void 0!==L&&L.id==G)return L}return null},removeFeatureLayer:function(G){G=this.getFeatureLayer(G);if(void 0!==G){var H=z.indexOf(this.featureLayers,G);if(-1<H){this.featureLayers.splice(H,1);for(G=0;G<this._featureLayerInfos[H].EventHandlers.length;G++)x.disconnect(this._featureLayerInfos[H].EventHandlers[G]);this._featureLayerInfos.splice(H,
1);this.refresh()}}},removeAllFeatureLayers:function(){var G;for(G=0;G<this.featureLayers.length;G++){for(var H=0;H<this._featureLayerInfos[G].EventHandlers.length;H++)x.disconnect(this._featureLayerInfos[G].EventHandlers[H]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(G){var H;for(H=0;H<this.featureLayers.length;H++){var L=this.featureLayers[H];if(void 0!==L&&L.id==G)return this._featureLayerInfos[H]}return null},
refresh:function(){null==this._refreshHandle&&(this._refreshHandle=b.setTimeout(this._refreshLabels,b.priority.LOW))},_handleLevelChange:function(G){G.levelChange&&this.clear();this.refresh()},_refreshLabels:function(G){this._refreshHandle=null;var H=[],L,T="DYNAMIC"===this._engineType?new k:new w;if(this._map){T.setMap(this._map,this);this._preparedLabels=[];for(G=0;G<this.featureLayers.length;G++){var K=this.featureLayers[G];if(K.visible&&K.showLabels&&K.visibleAtMapScale&&!K._suspended){var O=
this._featureLayerInfos[G];var I=this._convertOptions(null);if(O.LabelRenderer){if(H=K.labelingInfo)if(L=H[0]){var P=this._getLabelExpression(L);I=this._convertOptions(L)}var Q=O.LabelRenderer;O.LabelExpressionInfo&&(P=O.LabelExpressionInfo);O.LabelingOptions&&(I=this._convertOptions(null),void 0!==O.LabelingOptions.pointPriorities&&(H=O.LabelingOptions.pointPriorities,I.pointPriorities="above-center"==H||"AboveCenter"==H||"esriServerPointLabelPlacementAboveCenter"==H?"AboveCenter":"above-left"==
H||"AboveLeft"==H||"esriServerPointLabelPlacementAboveLeft"==H?"AboveLeft":"above-right"==H||"AboveRight"==H||"esriServerPointLabelPlacementAboveRight"==H?"AboveRight":"below-center"==H||"BelowCenter"==H||"esriServerPointLabelPlacementBelowCenter"==H?"BelowCenter":"below-left"==H||"BelowLeft"==H||"esriServerPointLabelPlacementBelowLeft"==H?"BelowLeft":"below-right"==H||"BelowRight"==H||"esriServerPointLabelPlacementBelowRight"==H?"BelowRight":"center-center"==H||"CenterCenter"==H||"esriServerPointLabelPlacementCenterCenter"==
H?"CenterCenter":"center-left"==H||"CenterLeft"==H||"esriServerPointLabelPlacementCenterLeft"==H?"CenterLeft":"center-right"==H||"CenterRight"==H||"esriServerPointLabelPlacementCenterRight"==H?"CenterRight":"AboveRight"),void 0!==O.LabelingOptions.lineLabelPlacement&&(I.lineLabelPlacement=O.LabelingOptions.lineLabelPlacement),void 0!==O.LabelingOptions.lineLabelPosition&&(I.lineLabelPosition=O.LabelingOptions.lineLabelPosition),void 0!==O.LabelingOptions.labelRotation&&(I.labelRotation=O.LabelingOptions.labelRotation),
void 0!==O.LabelingOptions.howManyLabels&&(I.howManyLabels=O.LabelingOptions.howManyLabels));Q instanceof C&&(P=this._getLabelExpression(Q),Q=new A(Q.symbol),I=this._convertOptions(Q));this._addLabels(K,Q,P,I)}else if(H=K.labelingInfo)for(O=H.length-1;0<=O;O--)if(L=H[O])Q=new C(L instanceof C?L.toJson():L),P=this._getLabelExpression(L),I=this._convertOptions(L),this._addLabels(K,Q,P,I)}}P=T._process(this._preparedLabels);this.clear();this.drawLabels(this._map,P)}},drawLabels:function(G,H){this._scale=
(G.extent.xmax-G.extent.xmin)/G.width;var L;for(L=0;L<H.length;L++){var T=H[L],K=T.x,O=T.y,I=T.text,P=T.angle,Q=T.layer.labelSymbol;"polyline"==T.layer.geometry.type&&T.layer.options.labelRotation&&Q.setAngle(180/Math.PI*P);Q.setText(I);Q instanceof d&&(I=Q.getHeight(),K-=.25*I*this._scale*Math.sin(P),O-=.33*I*this._scale);P=new e(new l(K,O,G.extent.spatialReference));P.setParentGraphic(T.layer.graphic);P.setSymbol(Q);this.add(P)}},_addLabels:function(G,H,L,T){var K;if(this._isWithinScaleRange(H.minScale,
H.maxScale)&&L&&""!==L){var O=this._map,I=!G.url&&!O.spatialReference.equals(G.spatialReference);for(K=0;K<G.graphics.length;K++){var P=G.graphics[K];if(!1!==P.visible&&!P._suspended){var Q=P.geometry;if(I){if(!q.canProject(Q,O))continue;Q=q.project(Q,O)}if(Q&&this._isWhere(H.where,P.attributes)&&this._isWithinScreenArea(Q)){var U=this._buildLabelText(L,P,G.fields,T);this._addLabel(U,H,G.renderer,P,T,Q,O)}}}}},_isWithinScreenArea:function(G){G="point"===G.type?new g(G.x,G.y,G.x,G.y,G.spatialReference):
G.getExtent();if(void 0===G)return!1;G=this._intersects(this._map,G);return null===G||0===G.length?!1:!0},_isWithinScaleRange:function(G,H){var L=this._map.getScale();return 0<G&&L>=G||0<H&&L<H?!1:!0},_isWhere:function(G,H){try{if(!G)return!0;if(G){var L=G.split(" ");if(3===L.length)return this._sqlEquation(H[this._removeQuotes(L[0])],L[1],this._removeQuotes(L[2]));if(7===L.length){var T=this._sqlEquation(H[this._removeQuotes(L[0])],L[1],this._removeQuotes(L[2])),K=L[3],O=this._sqlEquation(H[this._removeQuotes(L[4])],
L[5],this._removeQuotes(L[6]));switch(K){case "AND":return T&&O;case "OR":return T||O}}}return!1}catch(I){console.log("Error.: can't parse \x3d "+G)}},_sqlEquation:function(G,H,L){switch(H){case "\x3d":return G==L?!0:!1;case "\x3c\x3e":return G!=L?!0:!1;case "\x3e":return G>L?!0:!1;case "\x3e\x3d":return G>=L?!0:!1;case "\x3c":return G<L?!0:!1;case "\x3c\x3d":return G<=L?!0:!1}return!1},_removeQuotes:function(G){var H=G.indexOf('"'),L=G.lastIndexOf('"');if(-1!=H&&-1!=L)return G.substr(1,G.length-
2);H=G.indexOf("'");L=G.lastIndexOf("'");return-1!=H&&-1!=L?G.substr(1,G.length-2):G},_getSizeInfo:function(G){return G?G.sizeInfo||z.filter(G.visualVariables,D)[0]:null},_addLabel:function(G,H,L,T,K,O,I){var P;if(G&&""!==r.trim(G)&&H){G=G.replace(/[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g," ");var Q=H.getSymbol(T);Q instanceof d?(Q=new d(Q.toJson()),Q.setVerticalAlignment("baseline"),Q.setHorizontalAlignment("center")):Q=Q instanceof a?new a(Q.toJson()):new d;Q.setText(G);
H.symbol=Q;if(P=this._getProportionalSize(H.sizeInfo,T.attributes))Q instanceof d?Q.setSize(P):Q instanceof a&&(Q.setWidth(P),Q.setHeight(P));var U=P=0;if(L){var Y=L.getSymbol(T);var ca=this._getSizeInfo(L);if((L=ca?L.getSize(T,{sizeInfo:ca,resolution:I.getResolutionInMeters()}):T.size)&&null!==L)P=U=L;else if(Y)if("simplemarkersymbol"==Y.type)U=P=Y.size;else if("picturemarkersymbol"==Y.type)P=Y.width,U=Y.height;else if("simplelinesymbol"==Y.type||"cartographiclinesymbol"==Y.type)P=Y.width}L={};L.graphic=
T;L.options=K;L.geometry=O;L.labelRenderer=H;L.labelSymbol=Q;L.labelWidth=Q.getWidth()/2;L.labelHeight=Q.getHeight()/2;L.symbolWidth=m.normalizedLength(P)/2;L.symbolHeight=m.normalizedLength(U)/2;L.text=G;L.angle=Q.angle;this._preparedLabels.push(L)}},_buildLabelText:function(G,H,L,T){if(T.hasExpression)return G=u.getEvalOptions({expression:T.arcadeExpr,feature:H,layer:H.getLayer(),spatialReference:this._map.spatialReference}),H=H.evaluateExpression(T.arcadeExpr,G),p.isDefined(H)?""+H:"";var K=H.attributes;
return G.replace(/{[^}]*}/g,function(O){var I,P=O;for(I=0;I<L.length;I++)if("{"+L[I].name+"}"==O){P=K[L[I].name];var Q=L[I].domain;if(Q&&r.isObject(Q)){if("codedValue"==Q.type&&T.useCodedValues)for(I=P,O=0;O<Q.codedValues.length;O++)if(Q.codedValues[O].code==I){P=Q.codedValues[O].name;break}break}Q=L[I].type;if(T.fieldInfos){var U=T.fieldInfos;for(I=0;I<U.length;I++)if("{"+U[I].fieldName+"}"==O){O=U[I].format;"esriFieldTypeDate"==Q?P=p.substitute({myKey:P},"${myKey}",{format:{myKey:r.mixin({formatType:"DateFormat"},
c.prototype._dateFormatsJson[O&&O.dateFormat||"shortDate"])}}):"esriFieldTypeInteger"!=Q&&"esriFieldTypeSingle"!=Q&&"esriFieldTypeSmallInteger"!=Q&&"esriFieldTypeLong"!=Q&&"esriFieldTypeDouble"!=Q||!O||(P=v.format(P,{places:O.places}),O.digitSeparator||n.group&&(P=P.replace(new RegExp("\\"+n.group,"g"),"")));break}}break}else P="";return null==P?"":P})},_getLabelExpression:function(G){var H="";G.labelExpressionInfo?H=G.labelExpressionInfo.value||G.labelExpressionInfo.expression:this._validSyntax(G.labelExpression)&&
(H=this._convertLabelExpression(G.labelExpression));return H},_validSyntax:function(G){return/^(\s*\[[^\]]+\]\s*)+$/i.test(G)},_convertLabelExpression:function(G){return G.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(G,H){if(!G)return null;H=p.substitute(H,"${"+G.field+"}",{first:!0});return!(G.minSize&&G.maxSize&&G.minDataValue&&G.maxDataValue&&H)||0>=G.maxDataValue-G.minDataValue?null:(G.maxSize-G.minSize)/(G.maxDataValue-G.minDataValue)*(H-G.minDataValue)+G.minSize},_convertOptions:function(G){var H=
!0,L="shortDate",T=null,K=null,O="",I=!0;if(G&&(G.format&&(L=G.format.dateFormat,T={places:G.format.places,digitSeparator:G.format.digitSeparator}),K=G.fieldInfos,O=G.labelPlacement,null!=G.useCodedValues&&(H=G.useCodedValues),G=G.labelExpressionInfo)){var P=G.expression;if(P&&!G.value){var Q=!0;var U=new f({expression:P,returnType:"string",profile:u})}}if("always-horizontal"==O||"esriServerPolygonPlacementAlwaysHorizontal"==O)I=!1;return{useCodedValues:H,dateFormat:L,numberFormat:T,fieldInfos:K,
pointPriorities:"above-center"==O||"esriServerPointLabelPlacementAboveCenter"==O?"AboveCenter":"above-left"==O||"esriServerPointLabelPlacementAboveLeft"==O?"AboveLeft":"above-right"==O||"esriServerPointLabelPlacementAboveRight"==O?"AboveRight":"below-center"==O||"esriServerPointLabelPlacementBelowCenter"==O?"BelowCenter":"below-left"==O||"esriServerPointLabelPlacementBelowLeft"==O?"BelowLeft":"below-right"==O||"esriServerPointLabelPlacementBelowRight"==O?"BelowRight":"center-center"==O||"esriServerPointLabelPlacementCenterCenter"==
O?"CenterCenter":"center-left"==O||"esriServerPointLabelPlacementCenterLeft"==O?"CenterLeft":"center-right"==O||"esriServerPointLabelPlacementCenterRight"==O?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==O||"below-start"==O||"center-start"==O?"PlaceAtStart":"above-end"==O||"below-end"==O||"center-end"==O?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==O||"esriServerLinePlacementAboveAfter"==O||"above-along"==O||"esriServerLinePlacementAboveAlong"==O||"above-before"==O||
"esriServerLinePlacementAboveBefore"==O||"above-start"==O||"esriServerLinePlacementAboveStart"==O||"above-end"==O||"esriServerLinePlacementAboveEnd"==O?"Above":"below-after"==O||"esriServerLinePlacementBelowAfter"==O||"below-along"==O||"esriServerLinePlacementBelowAlong"==O||"below-before"==O||"esriServerLinePlacementBelowBefore"==O||"below-start"==O||"esriServerLinePlacementBelowStart"==O||"below-end"==O||"esriServerLinePlacementBelowEnd"==O?"Below":"center-after"==O||"esriServerLinePlacementCenterAfter"==
O||"center-along"==O||"esriServerLinePlacementCenterAlong"==O||"center-before"==O||"esriServerLinePlacementCenterBefore"==O||"center-start"==O||"esriServerLinePlacementCenterStart"==O||"center-end"==O||"esriServerLinePlacementCenterEnd"==O?"OnLine":"Above",labelRotation:I,howManyLabels:"OneLabel",hasExpression:Q,arcadeExpr:U}}});t("extend-esri")&&r.setObject("layers.LabelLayer",F,h);return F})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),
function(F,r,z,x,n,v){F=F(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(t,m){this._labelLayer=m;this._xmin=t.extent.xmin;this._xmax=t.extent.xmax;this._ymin=t.extent.ymin;this._ymax=t.extent.ymax;this._scale=(this._xmax-this._xmin)/t.width},_process:function(t){this._preparedLabels=
t;this._placedLabels=[];var m;for(t=this._preparedLabels.length-1;0<=t;t--){var h=this._preparedLabels[t],p=Math.min(h.labelWidth,h.labelHeight),e=h.labelWidth+0*p;p=h.labelHeight+0*p;var c=(m=h.options)&&void 0!==m.lineLabelPlacement?m.lineLabelPlacement:"PlaceAtCenter",f=m&&void 0!==m.lineLabelPosition?m.lineLabelPosition:"Above",b=m&&void 0!==m.pointPriorities?m.pointPriorities:"AboveRight",d=[2,2,1,3,0,2,3,3,2];"AboveLeft"==b?d=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==b?d=[2,1,2,2,0,2,3,3,3]:"AboveRight"==
b?d=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==b?d=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==b?d=[0,0,0,0,1,0,0,0,0]:"CenterRight"==b?d=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==b?d=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==b?d=[3,3,3,2,0,2,2,1,2]:"BelowRight"==b&&(d=[3,3,2,3,0,2,2,2,1]);var a=m&&void 0!==m.labelRotation?m.labelRotation:!0;b=Math.PI/180*h.angle;m=m&&void 0!==m.howManyLabels?m.howManyLabels:"OneLabel";if("point"==h.geometry.type)this._generatePointPositions(h,h.geometry.x,h.geometry.y,h.text,b,e,p,h.symbolWidth,
h.symbolHeight,d);else if("multipoint"==h.geometry.type)for(c=h.geometry,f=0;f<c.points.length;f++)this._generatePointPositions(h,c.points[f][0],c.points[f][1],h.text,b,e,p,h.symbolWidth,h.symbolHeight,d);else"polyline"==h.geometry.type?this._generateLinePositions(h,h.geometry,h.text,e,p,2*h.symbolHeight+p,c,f,a):"polygon"==h.geometry.type&&this._generatePolygonPositions(h,m,h.geometry,h.text,b,e,p)}return this._placedLabels},_generatePointPositions:function(t,m,h,p,e,c,f,b,d,a){b=(b+c)*this._scale;
d=(d+f)*this._scale;var g,l;for(g=1;3>=g;g++)for(l=1;9>=l;l++)if(a[l-1]==g)switch(l){case 1:if(this._findPlace(t,p,m-b,h+d,e,c,f))return;break;case 2:if(this._findPlace(t,p,m,h+d,e,c,f))return;break;case 3:if(this._findPlace(t,p,m+b,h+d,e,c,f))return;break;case 4:if(this._findPlace(t,p,m-b,h,e,c,f))return;break;case 5:if(this._findPlace(t,p,m,h,e,c,f))return;break;case 6:if(this._findPlace(t,p,m+b,h,e,c,f))return;break;case 7:if(this._findPlace(t,p,m-b,h-d,e,c,f))return;break;case 8:if(this._findPlace(t,
p,m,h-d,e,c,f))return;break;case 9:if(this._findPlace(t,p,m+b,h-d,e,c,f))return}},_generateLinePositions:function(t,m,h,p,e,c,f,b,d){var a=p*this._scale*p*this._scale,g,l;for(g=0;g<m.paths.length;g++){var q=m.paths[g],A=q.length,u=Math.floor((A-1)/2),k=0!==(A-1)%2?1:-1;"PlaceAtStart"==f&&(u=0,k=1);"PlaceAtEnd"==f&&(u=A-2,k=-1);for(;0<=u&&u<A-1;){for(l=u;l<A;l++){var w=q[u][0],y=q[u][1],C=q[l][0]-w,D=q[l][1]-y;if(C*C+D*D>a){for(var G=Math.atan2(D,C);G>Math.PI/2;)G-=Math.PI;for(;G<-(Math.PI/2);)G+=
Math.PI;var H=Math.sin(G),L=Math.cos(G),T=0,K=0;"Above"==b&&(T=c*H*this._scale,K=c*L*this._scale);"Below"==b&&(T=-c*H*this._scale,K=-c*L*this._scale);if(1==l-u){if(this._clipLine(w,y,q[l][0],q[l][1])){w=this._x1-this._x0;var O=this._y1-this._y0;if(w*w+O*O>a&&(l=Math.atan2(O,w),C=p/2+2*e,y=C*this._scale*Math.cos(l),C=C*this._scale*Math.sin(l),"PlaceAtStart"==f?(w=this._x0+y,O=this._y0+C):"PlaceAtEnd"==f?(w=this._x1-y,O=this._y1-C):(w=this._x0+w/2,O=this._y0+O/2),this._findPlace(t,h,w-T,O+K,d?-l:0,
p,e)))return}}else{var I=0;for(O=u;O<=l;O++)I=Math.max(I,Math.abs((q[O][1]-y)*L-(q[O][0]-w)*H));if(I<e&&this._findPlace(t,h,w+C/2-T,y+D/2+K,d?-G:0,p,e))return}break}}u+=k}}},_generatePolygonPositions:function(t,m,h,p,e,c,f){if("ManyLabels"==m)for(m=0;m<h.rings.length;m++){var b=h.rings[m];v.prototype.isClockwise(b)&&(b=this._findCentroid(b,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(t,p,b[0],b[1],e,c,f))}else{b=this._findCentroidForFeature(h,this._xmin,this._ymin,this._xmax,this._ymax);
var d=b[1],a=0;for(m=0;10>m;m++){a+=f/4;b=this._findCentroidForFeature(h,this._xmin,d+(a-f/4),this._xmax,d+(a+f/4));if(this._findPlace(t,p,b[0],b[1],e,c,f))break;b=this._findCentroidForFeature(h,this._xmin,d-(a+f/4),this._xmax,d-(a-f/4));if(this._findPlace(t,p,b[0],b[1],e,c,f))break}}},_findCentroid:function(t,m,h,p,e){var c=t.length,f=[0,0],b=0,d=t[0][0],a=t[0][1];d>p&&(d=p);d<m&&(d=m);a>e&&(a=e);a<h&&(a=h);for(var g=1;g<c-1;g++){var l=t[g][0],q=t[g][1],A=t[g+1][0],u=t[g+1][1];l>p&&(l=p);l<m&&(l=
m);q>e&&(q=e);q<h&&(q=h);A>p&&(A=p);A<m&&(A=m);u>e&&(u=e);u<h&&(u=h);var k=(l-d)*(u-a)-(A-d)*(q-a);f[0]+=k*(d+l+A);f[1]+=k*(a+q+u);b+=k}f[0]/=3*b;f[1]/=3*b;if(isNaN(f[0])||isNaN(f[1]))return f;h=[];this._fillBuffer(t,h,f);f[0]=this._sortBuffer(h,f[0],m,p);return f},_findCentroidForFeature:function(t,m,h,p,e){for(var c,f=0,b=[0,0],d=0;d<t.rings.length;d++){var a=t.rings[d],g=a.length,l=a[0][0],q=a[0][1];l>p&&(l=p);l<m&&(l=m);q>e&&(q=e);q<h&&(q=h);for(c=1;c<g-1;c++){var A=a[c][0],u=a[c][1],k=a[c+1][0],
w=a[c+1][1];A>p&&(A=p);A<m&&(A=m);u>e&&(u=e);u<h&&(u=h);k>p&&(k=p);k<m&&(k=m);w>e&&(w=e);w<h&&(w=h);var y=(A-l)*(w-q)-(k-l)*(u-q);b[0]+=y*(l+A+k);b[1]+=y*(q+u+w);f+=y}}b[0]/=3*f;b[1]/=3*f;if(isNaN(b[0])||isNaN(b[1]))return b;h=[];for(c=0;c<t.rings.length;c++)this._fillBuffer(t.rings[c],h,b);b[0]=this._sortBuffer(h,b[0],m,p);return b},_fillBuffer:function(t,m,h){for(var p=t.length-1,e=t[0][1]>=t[p][1]?1:-1,c=0;c<=p;c++){var f=c,b=c+1;c==p&&(b=0);var d=t[f][0];f=t[f][1];var a=t[b][0];b=t[b][1];var g=
b>=f?1:-1;if(f<=h[1]&&h[1]<=b||b<=h[1]&&h[1]<=f)h[1]!=f&&h[1]!=b?(m.push((h[1]-f)*(a-d)/(b-f)+d),e=g):h[1]==f&&h[1]!=b?(e!=g&&m.push(d),e=g):h[1]!=f&&h[1]==b?(m.push(a),e=g):h[1]==f&&h[1]==b&&(1==e&&m.push(d),m.push(a),e=g)}},_sortBuffer:function(t,m,h,p){var e=t.length;t.sort();if(0<e){for(var c=0,f=m=0;f<e-1;f+=2){var b=Math.abs(t[f+1]-t[f]);!(t[f]<=h&&t[f+1]<=h||t[f]>=p&&t[f+1]>=p)&&b>c&&(c=b,m=f)}e=t[m];t=t[m+1];e>p&&(e=p);e<h&&(e=h);t>p&&(t=p);t<h&&(t=h);m=(e+t)/2}return m},_findPlace:function(t,
m,h,p,e,c,f){if(isNaN(h)||isNaN(p))return!1;for(var b=0;b<this._placedLabels.length;b++){var d=this._placedLabels[b].angle,a=this._placedLabels[b].width*this._scale,g=this._placedLabels[b].height*this._scale,l=this._placedLabels[b].x-h,q=this._placedLabels[b].y-p;if(0===e&&0===d){if(this._findPlace2(-c*this._scale,-f*this._scale,c*this._scale,f*this._scale,l-a,q-g,l+a,q+g))return!1}else{var A=new n(-c*this._scale,-f*this._scale,c*this._scale,f*this._scale,null),u=0,k=1;0!==e&&(u=Math.sin(e),k=Math.cos(e));
var w=l*k-q*u;l=l*u+q*k;d-=e;u=Math.sin(d);k=Math.cos(d);var y=-a*k- -g*u;q=-a*u+-g*k;d=+a*k- -g*u;var C=+a*u+-g*k;a=w+y;g=l-q;u=w+d;k=l-C;y=w-y;q=l+q;w-=d;l+=C;d=new v;d.addRing([[a,g],[u,k],[y,q],[w,l],[a,g]]);if(A.intersects(d))return!1}}for(;e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;b={};b.layer=t;b.text=m;b.angle=e;b.x=h;b.y=p;b.width=c;b.height=f;this._placedLabels.push(b);return!0},_findPlace2:function(t,m,h,p,e,c,f,b){return(t>=e&&t<=f||h>=e&&h<=f||t<=e&&h>=f)&&(m>=c&&m<=b||
p>=c&&p<=b||m<=c&&p>=b)?!0:!1},_clipLine:function(t,m,h,p){for(var e=this._code(t,m),c=this._code(h,p);0!==e||0!==c;){if(0!==(e&c))return!1;var f=h-t,b=p-m;0!==e?(t<this._xmin?(m+=b*(this._xmin-t)/f,t=this._xmin):t>this._xmax?(m+=b*(this._xmax-t)/f,t=this._xmax):m<this._ymin?(t+=f*(this._ymin-m)/b,m=this._ymin):m>this._ymax&&(t+=f*(this._ymax-m)/b,m=this._ymax),e=this._code(t,m)):(h<this._xmin?(p+=b*(this._xmin-h)/f,h=this._xmin):h>this._xmax?(p+=b*(this._xmax-h)/f,h=this._xmax):p<this._ymin?(h+=
f*(this._ymin-p)/b,p=this._ymin):p>this._ymax&&(h+=f*(this._ymax-p)/b,p=this._ymax),c=this._code(h,p))}this._x0=t;this._y0=m;this._x1=h;this._y1=p;return!0},_code:function(t,m){var h=0;t<this._xmin&&(h+=8);t>this._xmax&&(h+=4);m<this._ymin&&(h+=2);m>this._ymax&&(h+=1);return h}});z("extend-esri")&&r.setObject("layers.labelLayerUtils.DynamicLabelClass",F,x);return F})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),
function(F,r,z,x,n,v,t){return F(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(m,h){this._labelLayer=h;this._map=m;this._xmin=m.extent.xmin;this._xmax=m.extent.xmax;this._ymin=m.extent.ymin;this._ymax=m.extent.ymax;this._scale=
(this._xmax-this._xmin)/m.width},_process:function(m){var h;this._preparedLabels=m;this._placedLabels=[];for(m=this._preparedLabels.length-1;0<=m;m--){var p=this._preparedLabels[m];var e=p.labelWidth;var c=p.labelHeight;var f=(h=p.options)&&h.lineLabelPlacement?h.lineLabelPlacement:"PlaceAtCenter";var b=h&&h.lineLabelPosition?h.lineLabelPosition:"Above";var d=h&&h.labelRotation?h.labelRotation:!0;var a=Math.PI/180*p.angle;var g=h&&h.howManyLabels?h.howManyLabels:"OneLabel";var l=[];if("point"===p.geometry.type)this._generatePointPositions(p.geometry.x,
p.geometry.y,p.text,a,e,c,p.symbolWidth,p.symbolHeight,h,l);else if("multipoint"===p.geometry.type)for(d=0;d<p.geometry.points.length;d++)this._generatePointPositions(p.geometry.points[d][0],p.geometry.points[d][1],p.text,a,e,c,p.symbolWidth,p.symbolHeight,h,l);else if("polyline"===p.geometry.type)if("PlaceAtStart"===f)this._generateLinePositionsPlaceAtStart(p.geometry,!0,p.text,e,c,2*p.symbolHeight+c,f,b,d,l);else if("PlaceAtEnd"===f)this._generateLinePositionsPlaceAtEnd(p.geometry,!0,p.text,e,c,
2*p.symbolHeight+c,f,b,d,l);else{h=[];var q=p.geometry.getExtent(),A=this._map.extent;if(q.getWidth()<e*this._scale/this._OVERRUN&&q.getHeight()<e*this._scale/this._OVERRUN)continue;else.5*q.getWidth()<A.getWidth()&&.5*q.getHeight()<A.getHeight()?this._generateLinePositionsPlaceAtCenter(p.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,p.text,e,c,2*p.symbolHeight+c,f,b,d,h):this._generateLinePositionsPlaceAtCenter(p.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,
p.text,e,c,2*p.symbolHeight+c,f,b,d,h);this._postSorting(A,h,l)}else if("polygon"===p.geometry.type){f=[];for(d=0;d<p.geometry.rings.length;d++)b=p.geometry.rings[d],1<p.geometry.rings.length&&!t.prototype.isClockwise(b)||(h=this._calcRingExtent(b),h.xmax-h.xmin<4*e*this._scale/this._OVERRUN&&h.ymax-h.ymin<4*c*this._scale/this._OVERRUN||f.push(b));f.sort(function(u,k){return k.length-u.length});for(d=0;d<f.length;d++)this._generatePolygonPositionsForManyLabels(f[d],p.geometry.spatialReference,p.text,
a,e,c,l)}for(d=0;d<l.length&&(f=l[d].x,b=l[d].y,void 0!==l[d].angle&&(a=l[d].angle),h=this._findPlace(p,p.text,f,b,a,e,c),"OneLabel"!==g||!h||!this._labelLayer._isWithinScreenArea(new v(f,b,p.geometry.spatialReference)));d++);}return this._placedLabels},_generatePointPositions:function(m,h,p,e,c,f,b,d,a,g){p=a&&a.pointPriorities?a.pointPriorities:"AboveRight";c=(b+c)*this._scale;f=(d+f)*this._scale;switch(p.toLowerCase()){case "aboveleft":m-=c;h+=f;break;case "abovecenter":h+=f;break;case "aboveright":m+=
c;h+=f;break;case "centerleft":m-=c;break;case "centercenter":break;case "centerright":m+=c;break;case "belowleft":m-=c;h-=f;break;case "belowcenter":h-=f;break;case "belowright":m+=c;h-=f;break;default:return}g.push({x:m,y:h})},_generateLinePositionsPlaceAtStart:function(m,h,p,e,c,f,b,d,a,g){b=e*this._scale;var l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,q,A;for(q=0;q<m.paths.length;q++){var u=m.paths[q],k=b,w=0;for(A=0;A<u.length-1;A++){var y=u[A][0];var C=u[A][1];
var D=u[A+1][0];var G=u[A+1][1];var H=D-y;var L=G-C;H=Math.sqrt(H*H+L*L);w+H>k?(w=this._generatePositionsOnLine(m.spatialReference,h,k,l,w,y,C,D,G,p,e,c,f,d,a,g),k=l):w+=H}}},_generateLinePositionsPlaceAtEnd:function(m,h,p,e,c,f,b,d,a,g){b=e*this._scale;var l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,q,A;for(q=0;q<m.paths.length;q++){var u=m.paths[q],k=b,w=0;for(A=u.length-2;0<=A;A--){var y=u[A+1][0];var C=u[A+1][1];var D=u[A][0];var G=u[A][1];var H=D-y;var L=G-
C;H=Math.sqrt(H*H+L*L);w+H>k?(w=this._generatePositionsOnLine(m.spatialReference,h,k,l,w,y,C,D,G,p,e,c,f,d,a,g),k=l):w+=H}}},_generateLinePositionsPlaceAtCenter:function(m,h,p,e,c,f,b,d,a,g,l){var q;for(d=0;d<m.paths.length;d++){var A=m.paths[d];if(!(2>A.length)){if(2==A.length){var u=A[0];var k=A[1];var w=u[0];u=u[1];A=k[0];var y=k[1];var C=(A-w)*(A-w)+(y-u)*(y-u);var D=Math.atan2(y-u,A-w);y=Math.cos(D);D=Math.sin(D);A=[];var G=w;for(var H=u;(G-w)*(G-w)+(H-u)*(H-u)<C;)A.push([G,H]),G+=p/2*y,H+=p/
2*D;A.push(k)}var L=0;for(k=0;k<A.length-1;k++)w=A[k][0],u=A[k][1],C=A[k+1][0],y=A[k+1][1],D=C-w,G=y-u,L+=Math.sqrt(D*D+G*G);for(k=H=0;k<A.length-1;k++){w=A[k][0];u=A[k][1];C=A[k+1][0];y=A[k+1][1];D=C-w;G=y-u;D=Math.sqrt(D*D+G*G);if(H+D>L/2)break;H+=D}k==A.length-1&&k--;w=A[k][0];u=A[k][1];C=A[k+1][0];y=A[k+1][1];D=C-w;G=y-u;H=L/2-H;D=Math.atan2(G,D);G=w+H*Math.cos(D);D=u+H*Math.sin(D);w=this._angleAndShifts(w,u,C,y,b,a,g);l.push({x:G+w.shiftX,y:D+w.shiftY,angle:w.angle});L=G;var T=D;H=0;for(q=k;q<
A.length-1;q++)q==k?(w=L,u=T):(w=A[q][0],u=A[q][1]),C=A[q+1][0],y=A[q+1][1],D=C-w,G=y-u,D=Math.sqrt(D*D+G*G),H=H+D>p?this._generatePositionsOnLine(m.spatialReference,h,p,p,H,w,u,C,y,e,c,f,b,a,g,l):H+D;H=0;for(q=k;0<=q;q--)q==k?(w=L,u=T):(w=A[q+1][0],u=A[q+1][1]),C=A[q][0],y=A[q][1],D=C-w,G=y-u,D=Math.sqrt(D*D+G*G),H=H+D>p?this._generatePositionsOnLine(m.spatialReference,h,p,p,H,w,u,C,y,e,c,f,b,a,g,l):H+D}}},_generatePositionsOnLine:function(m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w){g=Math.atan2(a-b,d-f);l=
f;q=b;var y=l,C=q;do if(c=p-c,l+=c*Math.cos(g),q+=c*Math.sin(g),this._belongs(l,q,f,b,d,a))c=this._angleAndShifts(f,b,d,a,A,u,k),p=l+c.shiftX,C=q+c.shiftY,h?this._labelLayer._isWithinScreenArea(new n(p,C,p,C,m))&&w.push({x:p,y:C,angle:c.angle}):w.push({x:p,y:C,angle:c.angle}),y=l,C=q,c=0,p=e;else return m=d-y,a-=C,Math.sqrt(m*m+a*a);while(1)},_postSorting:function(m,h,p){if(m&&0<h.length){var e=.5*(m.xmin+m.xmax);m=.5*(m.ymin+m.ymax);for(var c=h[0].x,f=h[0].y,b=Math.sqrt((c-e)*(c-e)+(f-m)*(f-m)),
d=h[0].angle,a=0;a<h.length;a++){var g=h[a].x,l=h[a].y,q=Math.sqrt((g-e)*(g-e)+(l-m)*(l-m));q<b&&(c=g,f=l,b=q,d=h[a].angle)}p.push({x:c,y:f,angle:d})}},_belongs:function(m,h,p,e,c,f){if(c==p&&f==e)return!1;if(c>p){if(m>c||m<p)return!1}else if(m<c||m>p)return!1;if(f>e){if(h>f||h<e)return!1}else if(h<f||h>e)return!1;return!0},_angleAndShifts:function(m,h,p,e,c,f,b){for(m=Math.atan2(e-h,p-m);m>Math.PI/2;)m-=Math.PI;for(;m<-(Math.PI/2);)m+=Math.PI;e=Math.sin(m);var d=Math.cos(m);p=h=0;"Above"==f&&(h=
c*e*this._scale,p=c*d*this._scale);"Below"==f&&(h=-c*e*this._scale,p=-c*d*this._scale);c=[];c.angle=b?-m:0;c.shiftX=-h;c.shiftY=p;return c},_generatePolygonPositionsForManyLabels:function(m,h,p,e,c,f,b){c=this._findCentroidForRing(m);e=c[0];var d=c[1],a=this._calcRingExtent(m);c=a.xmin;f=a.ymin;var g=a.xmax;a=a.ymax;var l=(a-f)/(this._map.height*this._scale);if(!(10<(g-c)/(this._map.width*this._scale)&&10<l)){var q=!0;if(g-c>this._map.width*this._scale||a-f>this._map.height*this._scale)q=!1;l=this._map.width*
this._scale*(q?.1875:.5);q=this._map.height*this._scale*(q?.1875:.5);var A=!0,u=!0,k=0;do{d+=(k%2?-1:1)*k*q;if(this._scanRingByX(p,h,m,e,d,c,g,l,b))break;d<f&&(A=!1);d>a&&(u=!1);k++}while(A||u)}},_scanRingByX:function(m,h,p,e,c,f,b,d,a){var g=!0,l=!0,q=0,A=1E3;do{e+=(q%2?-1:1)*q*d;var u=this._movePointInsideRing(p,e,c),k=this._labelLayer._isWithinScreenArea(new n(u,c,u,c,h)),w=this._isPointWithinRing(m,p,u,c);if(k&&w)return a.push({x:u,y:c}),!0;e<f&&(g=!1);e>b&&(l=!1);q++;A--;if(0>=A)return!0}while(g||
l);return!1},_movePointInsideRing:function(m,h,p){for(var e=[],c=m.length-1,f=m[0][1]>=m[c][1]?1:-1,b=0;b<=c;b++){var d=b,a=b+1;b==c&&(a=0);var g=m[d][0];d=m[d][1];var l=m[a][0];a=m[a][1];var q=a>=d?1:-1;if(d<=p&&p<=a||a<=p&&p<=d)p!=d&&p!=a?(e.push((p-d)*(l-g)/(a-d)+g),f=q):p==d&&p!=a?(f!=q&&e.push(g),f=q):p!=d&&p==a?(e.push(l),f=q):p==d&&p==a&&(1==f&&e.push(g),e.push(l),f=q)}e.sort(function(A,u){return A-u});m=e.length;if(0<m){for(b=p=h=0;b<m-1;b+=2)c=Math.abs(e[b+1]-e[b]),c>h&&(h=c,p=b);h=(e[p]+
e[p+1])/2}return h},_calcRingExtent:function(m){var h;var p=new n;for(h=0;h<m.length-1;h++){var e=m[h][0],c=m[h][1];if(void 0===p.xmin||e<p.xmin)p.xmin=e;if(void 0===p.ymin||c<p.ymin)p.ymin=c;if(void 0===p.xmax||e>p.xmax)p.xmax=e;if(void 0===p.ymax||c>p.ymax)p.ymax=c}return p},_isPointWithinPolygon:function(m,h,p,e){var c;for(c=0;c<h.rings.length;c++)if(this._isPointWithinRing(m,h.rings[c],p,e))return!0;return!1},_isPointWithinRing:function(m,h,p,e){var c=[],f=h.length;for(m=0;m<f-1;m++){var b=h[m][0];
var d=h[m][1];var a=h[m+1][0];var g=h[m+1][1];if(b!=a||d!=g){if(d==g)if(e==d)c.push(b);else continue;b==a?(d<g&&e>=d&&e<g&&c.push(b),d>g&&e<=d&&e>g&&c.push(b)):(d=(a-b)/(g-d)*(e-d)+b,b<a&&d>=b&&d<a&&c.push(d),b>a&&d<=b&&d>a&&c.push(d))}}c.sort(function(l,q){return l-q});for(m=0;m<c.length-1;m++)if(b=c[m],a=c[m+1],p>=b&&p<a)if(m%2)break;else return!0;return!1},_findCentroidForRing:function(m){for(var h=m.length,p=[0,0],e=0,c=m[0][0],f=m[0][1],b=1;b<h-1;b++){var d=m[b][0],a=m[b][1],g=m[b+1][0],l=m[b+
1][1],q=(d-c)*(l-f)-(g-c)*(a-f);p[0]+=q*(c+d+g);p[1]+=q*(f+a+l);e+=q}p[0]/=3*e;p[1]/=3*e;return p},_findCentroidForFeature:function(m){for(var h=0,p=[0,0],e=0;e<m.rings.length;e++)for(var c=m.rings[e],f=c.length,b=c[0][0],d=c[0][1],a=1;a<f-1;a++){var g=c[a][0],l=c[a][1],q=c[a+1][0],A=c[a+1][1],u=(g-b)*(A-d)-(q-b)*(l-d);p[0]+=u*(b+g+q);p[1]+=u*(d+l+A);h+=u}p[0]/=3*h;p[1]/=3*h;return p},_findPlace:function(m,h,p,e,c,f,b){if(isNaN(p)||isNaN(e))return!1;for(var d=0;d<this._placedLabels.length;d++){var a=
this._placedLabels[d].angle,g=this._placedLabels[d].width*this._scale,l=this._placedLabels[d].height*this._scale,q=this._placedLabels[d].x-p,A=this._placedLabels[d].y-e;if(0===c&&0===a){if(this._findPlace2(-f*this._scale,-b*this._scale,f*this._scale,b*this._scale,q-g,A-l,q+g,A+l))return!1}else{var u=new n(-f*this._scale,-b*this._scale,f*this._scale,b*this._scale,null),k=0,w=1;0!==c&&(k=Math.sin(c),w=Math.cos(c));var y=q*w-A*k;q=q*k+A*w;a-=c;k=Math.sin(a);w=Math.cos(a);var C=-g*w- -l*k;A=-g*k+-l*w;
a=+g*w- -l*k;var D=+g*k+-l*w;g=y+C;l=q-A;k=y+a;w=q-D;C=y-C;A=q+A;y-=a;q+=D;a=new t;a.addRing([[g,l],[k,w],[C,A],[y,q],[g,l]]);if(u.intersects(a))return!1}}for(;c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;d={};d.layer=m;d.text=h;d.angle=c;d.x=p;d.y=e;d.width=f;d.height=b;this._placedLabels.push(d);return!0},_findPlace2:function(m,h,p,e,c,f,b,d){return(m>=c&&m<=b||p>=c&&p<=b||m<=c&&p>=b)&&(h>=f&&h<=d||e>=f&&e<=d||h<=f&&e>=d)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C,D,G,H,L,T,K,O,I,P,Q,U,Y,ca,da,ma,na,va,ja,pa){var la=G.getClassValuesForRelationship(),ra={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},X={HH:315,HL:45,LL:135,LH:225},ya=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,wa=r([ja,l],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new t([64,
64,64]),defaultText:"Aa",sizeRampLightColor:new t([255,255,255]),sizeRampDarkColor:new t([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(M,B){z.mixin(this,pa.widgets.legend);this._i18n=pa.widgets.legend;M=M||{};M.map?B?(this.map=M.map,this.layerInfos=M.layerInfos,this._respectCurrentMapScale=!1===M.respectCurrentMapScale?
!1:!0,this._respectVisibility=!1===M.respectVisibility?!1:!0,this._preserveCacheOnDestroy=M.preserveCacheOnDestroy?!0:!1,this.arrangement=M.arrangement===wa.ALIGN_RIGHT?wa.ALIGN_RIGHT:wa.ALIGN_LEFT,this.arrangement===wa.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===M.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=m(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var M=["ar","he"],B;for(B=0;B<M.length;B+=1){var E=M[B];F.locale&&-1!==F.locale.indexOf(E)&&(-1!==F.locale.indexOf("-")?-1!==F.locale.indexOf(E+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0)}this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._initialize();9>h("ie")&&(this._repaintItems=z.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||x.forEach(this.layers,function(M){delete M.legendResponse})},refresh:function(M){if(this.domNode){M?(this.layerInfos=M,this.layers=
[],x.forEach(this.layerInfos,function(B){this._isSupportedLayerType(B.layer)&&(B.title&&(B.layer._titleForLegend=B.title),B.layer._hideDefaultSymbol=!1===B.defaultSymbol?!0:!1,B.hideLayers?(this.hideLayersInLegend[B.layer.id]=B.hideLayers,this._addSubLayersToHide(B)):this.hideLayersInLegend[B.layer.id]=[],B.hoverLabel&&(B.layer._hoverLabel=B.hoverLabel),B.hoverLabels&&(B.layer._hoverLabels=B.hoverLabels),this.layers.push(B.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(M=
this.domNode.children.length-1;0<=M;M--)d.destroy(this.domNode.children[M]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],x.forEach(this.layerInfos,function(E){this._isSupportedLayerType(E.layer)&&(E.title&&(E.layer._titleForLegend=E.title),E.layer._hideDefaultSymbol=!1===E.defaultSymbol?!0:!1,E.hideLayers?(this.hideLayersInLegend[E.layer.id]=E.hideLayers,this._addSubLayersToHide(E)):
this.hideLayersInLegend[E.layer.id]=[],E.hoverLabel&&(E.layer._hoverLabel=E.hoverLabel),E.hoverLabels&&(E.layer._hoverLabels=E.hoverLabels),this.layers.push(E.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var M=[],B=[];x.forEach(this.map.layerIds,function(E){E=this.map.getLayer(E);this._isSupportedLayerType(E)&&(E.arcgisProps&&E.arcgisProps.title&&(E._titleForLegend=E.arcgisProps.title),this.layers.push(E));if("esri.layers.KMLLayer"==E.declaredClass){var J=
E.getLayers();x.forEach(J,function(N){M.push(N.id)},this)}"esri.layers.GeoRSSLayer"==E.declaredClass&&(J=E.getFeatureLayers(),x.forEach(J,function(N){B.push(N.id)},this))},this);x.forEach(this.map.graphicsLayerIds,function(E){var J=this.map.getLayer(E);-1==x.indexOf(M,E)&&-1==x.indexOf(B,E)&&this._isSupportedLayerType(J)&&this._isLayerDrawingEnabled(J)&&(J.arcgisProps&&J.arcgisProps.title&&(J._titleForLegend=J.arcgisProps.title),this.layers.push(J))},this)}this._createLegend()},_isLayerDrawingEnabled:function(M){return M&&
(M._params&&M._params.drawMode||M.isFeatureReductionActive&&M.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var M=this._mapConnects;this._respectCurrentMapScale&&M.push(n.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(M.push(n.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),M.push(n.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers")),M.push(n.connect(this.map,"onLayersReordered",
this,"_updateAllMapLayers")));x.forEach(this.layers,function(B){var E=[n.connect(B,"onFeatureReductionRendererChange",this,"_refreshLayers"),n.connect(B,"onFeatureReductionChange",this,"_refreshLayers"),n.connect(B,"onVisibilityChange",this,"_refreshLayers"),n.connect(B,"onOpacityChange",this,"_refreshLayers"),n.connect(B,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===B.declaredClass&&B.supportsDynamicLayers&&E.push(n.connect(B,"_onDynamicLayersChange",z.hitch(this,
"_updateDynamicLayers",B)));if("esri.layers.ArcGISImageServiceLayer"===B.declaredClass||"esri.layers.RasterXLayer"===B.declaredClass)E.push(n.connect(B,"onRenderingChange",z.partial(this._updateImageServiceLayers,this,B))),E.push(n.connect(B,"onRendererChange",z.partial(this._updateImageServiceLayers,this,B)));("esri.layers.ArcGISImageServiceVectorLayer"===B.declaredClass||B.setWebGLEnabled)&&E.push(n.connect(B,"onRendererChange",z.hitch(this,"_refreshLayers")));this._layerConnects[B.id]=E},this)}},
_deactivate:function(){x.forEach(this._mapConnects,function(M){n.disconnect(M)});x.forEach(this.layers,function(M){var B=this._layerConnects;B&&x.forEach(B[M.id],function(E){n.disconnect(E)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(M){delete M.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(M,B){delete B.legendResponse;M._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];x.forEach(this.map.layerIds,
function(M){M=this.map.getLayer(M);this._isSupportedLayerType(M)&&this.layers.push(M)},this);x.forEach(this.map.graphicsLayerIds,function(M){M=this.map.getLayer(M);this._isSupportedLayerType(M)&&this._isLayerDrawingEnabled(M)&&this.layers.push(M)},this);this.refresh()},_createLegend:function(){var M=!1,B=!1;a.set(this.domNode,"position","relative");d.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var E=[];x.forEach(this.layers,function(N){if("esri.layers.KMLLayer"==
N.declaredClass||"esri.layers.GeoRSSLayer"==N.declaredClass)if(N.loaded){if("esri.layers.KMLLayer"==N.declaredClass)var S=N.getLayers();else"esri.layers.GeoRSSLayer"==N.declaredClass&&(S=N.getFeatureLayers(),this.hideLayersInLegend[N.id]&&(S=x.filter(S,function(aa){return-1==x.indexOf(this.hideLayersInLegend[N.id],aa.id)},this)));x.forEach(S,function(aa){"esri.layers.FeatureLayer"==aa.declaredClass&&N._titleForLegend&&(aa._titleForLegend=N._titleForLegend+" - ","esriGeometryPoint"==aa.geometryType?
aa._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==aa.geometryType?aa._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==aa.geometryType&&(aa._titleForLegend+=this.NLS_areas),E.push(aa))},this)}else n.connect(N,"onLoad",z.hitch(this,function(){this.refresh(this.layerInfos)}));else if("esri.layers.WMSLayer"===N.declaredClass)if(!N.loaded)n.connect(N,"onLoad",z.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&N.visible)&&
0<N.layerInfos.length&&x.some(N.layerInfos,function(aa){return aa.legendURL})){var V=!1;x.forEach(N.layerInfos,function(aa){if(aa.legendURL&&-1<x.indexOf(N.visibleLayers,aa.name)){V||(d.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(N._titleForLegend||N.name||N.id)+"\x3c/span\x3e"},this.domNode),V=!0);var fa;aa=aa.legendURL;if(N.customParameters||N.customLayerParameters){var ea=z.clone(N.customParameters||{});z.mixin(ea,N.customLayerParameters||{});for(fa in ea)aa+=(-1===
aa.indexOf("?")?"?":"\x26")+fa+"\x3d"+ea[fa]}d.create("div",{innerHTML:"\x3cimg src\x3d'"+aa+"'/\x3e"},this.domNode);M=!0}},this)}}else"esri.layers.WFSLayer"!==N.declaredClass||N.renderer?E.push(N):(S=d.create("div",{id:this.id+"_"+N.id,"class":"esriLegendService"}),d.create("span",{innerHTML:this._getServiceTitle(N),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},S))))),d.place(S,this.id,"first"),S=d.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},S),S=d.create("tbody",{},S),"esriGeometryComplex"===N.geometryType?(this._buildRow_Renderer(N,N._pointSymbol,null,this.NLS_points,null,S),this._buildRow_Renderer(N,N._lineSymbol,null,this.NLS_lines,null,S),this._buildRow_Renderer(N,N._polygonSymbol,null,this.NLS_areas,null,S)):"esriGeometryPoint"===N.geometryType?this._buildRow_Renderer(N,N._pointSymbol,null,"",null,S):"esriGeometryPolyline"===N.geometryType?this._buildRow_Renderer(N,
N._lineSymbol,null,"",null,S):"esriGeometryPolygon"===N.geometryType&&this._buildRow_Renderer(N,N._polygonSymbol,null,"",null,S),B=!0)},this);var J=[];x.forEach(E,function(N){if(!N.loaded)var S=n.connect(N,"onLoad",this,function(aa){n.disconnect(S);S=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&N.visible)&&(N.layerInfos||N.renderer||"esri.layers.ArcGISImageServiceLayer"==N.declaredClass||"esri.layers.RasterXLayer"==N.declaredClass)){var V=d.create("div",{id:this.id+
"_"+N.id,style:{display:"none"},"class":"esriLegendService"});d.create("span",{innerHTML:this._getServiceTitle(N),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},V)))));d.place(V,this.id,"first");N.legendResponse||N.renderer&&"esri.renderer.StretchRenderer"!==N.renderer.declaredClass||N.renderer&&"esri.renderer.StretchRenderer"===N.renderer.declaredClass&&1===N.bandCount?this._createLegendForLayer(N):this.isHostedTileService(N)?
this._getLayerInfos(N).then(z.hitch(this,function(aa){this._createLegendForLayer(aa)}),z.hitch(this,function(aa){J.push(this._legendRequest(aa))})):"esri.layers.RasterXLayer"===N.declaredClass&&-1<N.capabilities.toLowerCase().indexOf("tilesonly")?this._createLegendForTileOnlyService(N):J.push(this._legendRequest(N))}},this);0!==J.length||M||B?(new c(J)).addCallback(z.hitch(this,function(N){M||B?b.byId(this.id+"_msg").innerHTML="":b.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):
(b.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForTileOnlyService:function(M){function B(ea,qa){var ka=["red","green","blue"],R=[[255,0,0],[0,255,0],[0,0,255]];(qa&&qa.length>=S?E(qa):E()).forEach(function(Z,W){var ba=new Y(Y.STYLE_SQUARE,20,new ca(ca.STYLE_SOLID,new t([0,0,0]),1),new t(R[W]));ea._buildRow_Renderer(M,ba,null,ka[W]+": "+Z,null,N)},ea)}function E(ea){var qa=(M.bandIds&&M.bandIds.length?M.bandIds:[0,1,2]).map(function(ka){return ea&&ea[ka]&&ea[ka].BandName||
"Band_"+(ka+1)});3>qa.length?qa.push(qa[1]):3<qa.length&&qa.splice(3);return qa}var J=d.create("div",{id:this.id+"_"+M.id+"_clientLegend","class":"esriLegendServiceLabel"},b.byId(this.id+"_"+M.id));d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},J))));J=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},J);var N=d.create("tbody",{},J),S=M.bandCount;if(1<S)M.getKeyProperties().then(z.hitch(this,
function(ea){B(this,ea.BandProperties)}),z.hitch(this,function(ea){B(this)})),a.set(b.byId(this.id+"_"+M.id),"display","block"),a.set(b.byId(this.id+"_msg"),"display","none");else{J={colorRamp:{type:"algorithmic",fromColor:[0,0,0],toColor:[255,255,255]}};var V=M.renderer;if(V&&V.statistics&&V.statistics.length){var aa=null!=V.statistics[0].min?V.statistics[0].min:V.statistics[0][0];var fa=null!=V.statistics[0].max?V.statistics[0].max:V.statistics[0][1]}else aa=M.serviceInfo.minValues.length?M.serviceInfo.minValues[0]:
0,fa=M.serviceInfo.maxValues.length?M.serviceInfo.maxValues[0]:255;this._createStretchLegend(N,V||J,aa,fa)}},_createLegendForLayer:function(M){if(M.legendResponse||M.renderer||this.isHostedTileService(M)){var B=!1;if(M.legendResponse||this.isHostedTileService(M)){var E=M.dynamicLayerInfos||M.layerInfos;if(E&&E.length)x.forEach(E,function(J,N){this.hideLayersInLegend[M.id]&&-1!==x.indexOf(this.hideLayersInLegend[M.id],J.id)||(J=this._buildLegendItems(M,J,N),B=B||J)},this);else if("esri.layers.ArcGISImageServiceLayer"==
M.declaredClass||"esri.layers.RasterXLayer"==M.declaredClass)B=this._buildLegendItems(M,{id:0,name:null,title:M.name,subLayerIds:null,parentLayerId:-1},0)}else M.renderer&&(E=M.url?M.url.substring(M.url.lastIndexOf("/")+1,M.url.length):"fc_"+M.id,B=this._buildLegendItems(M,{id:E,name:null,subLayerIds:null,parentLayerId:-1},0));B&&(a.set(b.byId(this.id+"_"+M.id),"display","block"),a.set(b.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(M){if(M.loaded)return 10.01<=M.version?this._legendRequestServer(M):
this._legendRequestTools(M);n.connect(M,"onLoad",z.hitch(this,"_legendRequest"))},_legendRequestServer:function(M){var B=M.url,E=B.indexOf("?");B=-1<E?B.substring(0,E)+"/legend"+B.substring(E):B+"/legend";(E=M._getToken())&&(B+="?token\x3d"+E);var J=z.hitch(this,"_processLegendResponse"),N={f:"json"};M._params.dynamicLayers&&(N.dynamicLayers=f.stringify(this._createDynamicLayers(M)),"[{}]"===N.dynamicLayers&&(N.dynamicLayers="[]"));M._params.bandIds&&(N.bandIds=M._params.bandIds);M._params.renderingRule?
N.renderingRule=M._params.renderingRule:M.rasterFunctionInfos&&0<M.rasterFunctionInfos.length&&x.forEach(M.rasterFunctionInfos,function(S){S&&S.name&&"none"===S.name.toLowerCase()&&(N.renderingRule=f.stringify({rasterFunction:S.name}))});(E=M._params.mosaicRule&&JSON.parse(M._params.mosaicRule))&&E.multidimensionalDefinition&&E.multidimensionalDefinition.length&&(N.variable=E.multidimensionalDefinition[0].variableName);return y({url:B,content:N,callbackParamName:"callback",load:function(S,V){J(M,
S,V)},error:w.defaults.io.errorHandler})},_legendRequestTools:function(M){var B=M.url.toLowerCase().indexOf("/rest/");B=M.url.substring(0,B)+M.url.substring(B+5,M.url.length);B=this._legendUrl+"?soapUrl\x3d"+window.escape(B);if(!h("ie")||8<h("ie"))B+="\x26returnbytes\x3dtrue";var E=z.hitch(this,"_processLegendResponse");return y({url:B,content:{f:"json"},callbackParamName:"callback",load:function(J,N){E(M,J,N)},error:w.defaults.io.errorHandler})},_processLegendResponse:function(M,B){B&&B.layers?(M.legendResponse=
B,b.byId(this.id+"_"+M.id)&&d.empty(b.byId(this.id+"_"+M.id)),d.create("span",{innerHTML:this._getServiceTitle(M),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},b.byId(this.id+"_"+M.id)))))),this._createLegendForLayer(M)):console.log("Legend could not get generated for "+M.url+": "+v.toJson(B))},_buildLegendItems:function(M,B,E){var J=!1,N=b.byId(this.id+"_"+M.id),S=B.parentLayerId;if(B.subLayerIds)M=d.create("div",
{id:this.id+"_"+M.id+"_"+B.id+"_group",style:{display:"none"},"class":-1==S?0<E?"esriLegendGroupLayer":"":this._legendAlign},-1==S?N:b.byId(this.id+"_"+M.id+"_"+S+"_group")),d.create("td",{innerHTML:u.encode(B.name),align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},M))));else{if(this._respectVisibility&&M.visibleLayers)if(E=M.dynamicLayerInfos||M.layerInfos)if(M._params&&M._params.layers){if(-1===x.indexOf(M.visibleLayers,B.id))return J}else{if(E=
this._getReallyVisibleLayers(E,M.visibleLayers),-1===x.indexOf(E,B.id))return J}else if(-1===x.indexOf(M.visibleLayers,B.id))return J;N=d.create("div",{id:this.id+"_"+M.id+"_"+B.id,style:{display:"none"},"class":-1<S?this._legendAlign:""},-1==S?N:b.byId(this.id+"_"+M.id+"_"+S+"_group"));d.create("td",{innerHTML:u.encode(B.name)||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},N))));E=M.dynamicLayerInfos||M.layerInfos;S=!1;E&&
E.length&&(S=x.some(E,function(V){return!!V.drawingInfo}));if(M.legendResponse)J=J||this._buildLegendItems_Tools(M,B,N);else if(M.renderer||S)J=J||this._buildLegendItems_Renderer(M,B,N)}return J},_getReallyVisibleLayers:function(M,B){if(!M||!B||!B.length)return[];var E=[],J=[],N;for(N=0;N<M.length;N++)if(M[N].subLayerIds){if(-1===x.indexOf(B,M[N].id)||-1<x.indexOf(J,M[N].id))J=J.concat(M[N].subLayerIds)}else-1<x.indexOf(B,M[N].id)&&-1===x.indexOf(J,M[N].id)&&E.push(M[N].id);return E},_buildLegendItems_Tools:function(M,
B,E){var J=B.parentLayerId,N=this.map.getScale(),S=!1,V=function(W,ba){var ha,ia;for(ha=0;ha<W.length;ha++)if(ba.dynamicLayerInfos)for(ia=0;ia<ba.dynamicLayerInfos[ia].length;ia++){if(ba.dynamicLayerInfos[ia].mapLayerId==W[ha].layerId)return W[ha]}else if(ba.id==W[ha].layerId)return W[ha];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(M,B,N)){var aa=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===M.declaredClass||"esri.layers.ArcGISMapServiceLayer"===
M.declaredClass)){var fa=this._getEffectiveScale(M,B);if(fa.minScale&&fa.minScale<N||fa.maxScale&&fa.maxScale>N)aa=!1}if(aa){N=V(M.legendResponse.layers,B);var ea=N.legendType,qa=N.layerType,ka=N.legend;if(ka){"esri.layers.ArcGISImageServiceLayer"===M.declaredClass&&"esri.layers.RasterXLayer"===M.declaredClass||this._sanitizeLegendResponse(M,N,B);E=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);var R=d.create("tbody",{},E);(M._hoverLabel||M._hoverLabels)&&
this._createHoverAction(E,M,B);var Z=[];x.forEach(ka,function(W){if(!(10.1<=M.version&&!W.values&&1<ka.length)||!M._hideDefaultSymbol&&"\x3call other values\x3e"!==W.label&&(W.label||"esri.layers.ArcGISImageServiceLayer"===M.declaredClass&&10.3<=M.version||"Raster Layer"===qa)){var ba=W.label;if(W.url&&0===W.url.indexOf("http")||W.imageData&&0<W.imageData.length)S=!0,ba&&-1!==x.indexOf(Z,ba)||(Z.push(ba),this._buildRow_Tools(W,R,M,B.id,ea))}},this)}}}S&&(a.set(b.byId(this.id+"_"+M.id+"_"+B.id),"display",
"block"),-1<J&&(a.set(b.byId(this.id+"_"+M.id+"_"+J+"_group"),"display","block"),this._findParentGroup(M.id,M,J)));return S},_getLayerInfos:function(M){var B=new e,E=M.dynamicLayerInfos||M.layerInfos;if(E&&E.length)if(x.some(E,function(S){return!!S.drawingInfo}))B.resolve(M);else{var J=M.url,N=J.indexOf("?");J=-1==N?J+"/layers":J.substring(0,N)+"/layers"+J.substring(N,J.length);y({url:J,content:{f:"json"},callbackParamName:"callback",load:function(S,V){S.layers?(x.forEach(E,function(aa){var fa=x.filter(S.layers,
function(ea){return aa.source?ea.id===aa.source.mapLayerId:ea.id===aa.id});fa&&fa[0]&&fa[0].drawingInfo&&(aa.drawingInfo=fa[0].drawingInfo,aa.fields=fa[0].fields)}),B.resolve(M)):B.reject(M)},error:function(S){B.reject(M)}})}return B},_sanitizeLegendResponse:function(M,B,E){var J=B.legend;if(10.1<=M.version&&1<J.length&&!B._sanitized){M=z.getObject("layerDefinition.drawingInfo.renderer",!1,E);var N,S;M||(M=z.getObject("drawingInfo.renderer",!1,E));x.some(J,function(V){if(V.values)return!0})&&x.some(J,
function(V,aa){V.values||(S=aa,N=V);return!!N});M?"uniqueValue"===M.type?N&&(J.splice(S,1),J.push(N)):"classBreaks"===M.type&&(N&&J.splice(S,1),J.reverse(),N&&J.push(N)):N&&(J.splice(S,1),J.push(N));B._sanitized=!0}},_buildRow_Tools:function(M,B,E,J,N){var S=d.create("tr",{},B);if(this.alignRight){B=d.create("td",{align:this._isRightToLeft?"left":"right"},S);var V=d.create("td",{align:this._isRightToLeft?"left":"right",width:35},S)}else V=d.create("td",{width:35,align:"center"},S),B=d.create("td",
{},S);S=M.url;(!h("ie")||9<=h("ie")||9>h("ie")&&("esri.layers.ArcGISImageServiceLayer"===E.declaredClass||"esri.layers.RasterXLayer"===E.declaredClass))&&M.imageData&&0<M.imageData.length?S="data:image/png;base64,"+M.imageData:0!==M.url.indexOf("http")&&(S=E.url+"/"+J+"/images/"+M.url,(J=E._getToken())&&(S+="?token\x3d"+J));J=d.create("img",{src:S,border:0,style:"opacity:"+E.opacity},V);M=d.create("td",{innerHTML:u.encode(M.label),align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",
{width:"95%",dir:"ltr"},B))));N&&"Stretched"===N&&10.3<=E.version&&("esri.layers.ArcGISImageServiceLayer"===E.declaredClass||"esri.layers.RasterXLayer"===E.declaredClass)&&(M.style.verticalAlign="top",M.style.lineHeight="1",J.style.marginBottom="-1px",J.style.display="block",B.style.verticalAlign="top");9>h("ie")&&(J.style.filter="alpha(opacity\x3d"+100*E.opacity+")")},_getVariable:function(M,B,E){if(M)var J=(M=M.getVisualVariablesForType(B,E))&&M[0];return J},_getVariables:function(M,B,E){M=[this._getVariable(M,
"colorInfo",!1),this._getVariable(M,"opacityInfo",!1),this._getVariable(M,"sizeInfo",!1)];return B?x.filter(M,function(J){return!(!J||J.field!==B||J.normalizationField!=E)}):M},_getFieldAlias:function(M,B,E){var J=B.infoTemplate||(B.infoTemplates&&E&&B.infoTemplates[E.id]?B.infoTemplates[E.id].infoTemplate:null);J=J&&J.getFieldInfo&&J.getFieldInfo(M);M=z.isFunction(M)?null:this.getField(B,M,E);B=J||M;E="";B&&(E=J&&J.label||M&&M.alias||B.name||B.fieldName);return E},_getDomainName:function(M,B,E,J){if(M&&
!z.isFunction(M))var N=(E=(M=this.getField(E,M,J))&&E.getDomain?E.getDomain(M.name):null)&&E.codedValues?E.getName(B):null;return N},_getRampTitle:function(M,B,E){var J=M.field,N=M.normalizationField,S=!1,V=!1,aa=!1;J=z.isFunction(J)?null:J;N=z.isFunction(N)?null:N;if(M.legendOptions&&M.legendOptions.title)var fa=M.legendOptions.title;else if(M.valueExpressionTitle)fa=M.valueExpressionTitle;else{if(B.renderer&&B.renderer.authoringInfo&&B.renderer.authoringInfo.visualVariables){var ea=B.renderer.authoringInfo.visualVariables;
for(M=0;M<ea.length;M++){var qa=ea[M];if("colorInfo"===qa.type&&"ratio"===qa.style){S=!0;break}else if("colorInfo"===qa.type&&"percent"===qa.style){V=!0;break}else if("colorInfo"===qa.type&&"percentTotal"===qa.style){aa=!0;break}}}(S=aa&&"showRatioPercentTotal"||V&&"showRatioPercent"||S&&"showRatio"||N&&"showNormField"||J&&"showField"||null)&&(fa=C.substitute({field:J&&this._getFieldAlias(J,B,E),normField:N&&this._getFieldAlias(N,B,E)},"showField"===S?"${field}":this._i18n[S]))}return fa},_getRendererTitle:function(M,
B,E){if(M){if("esri.renderer.ClassBreaksRenderer"===M.declaredClass){var J=M.attributeField;var N=M.normalizationField;var S="percent-of-total"===M.normalizationType}J=z.isFunction(J)?null:J;N=z.isFunction(N)?null:N;if(M.legendOptions&&M.legendOptions.title)var V=M.legendOptions.title;else M.valueExpressionTitle?V=M.valueExpressionTitle:(M=N&&"showNormField"||(S?"showNormPct":null)||J&&"showField"||null)&&(V=C.substitute({field:J&&this._getFieldAlias(J,B,E),normField:N&&this._getFieldAlias(N,B,E)},
"showField"===M?"${field}":this._i18n[M]))}return V},_buildLegendItems_Renderer:function(M,B,E){function J(){a.set(b.byId(Na.id+"_"+M.id+"_"+B.id),"display","block");-1<N&&(a.set(b.byId(Na.id+"_"+M.id+"_"+N+"_group"),"display","block"),this._findParentGroup(M.id,N))}var N=B.parentLayerId,S=this.map,V=S.getScale(),aa=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(M,B,V)){var fa,ea,qa;var ka="esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass?M.renderer.renderer:B&&B.drawingInfo?
va.fromJson(z.clone(B.drawingInfo.renderer)):M.isFeatureReductionActive&&M.isFeatureReductionActive()?M.getFeatureReductionRenderer():M.renderer;if("esri.renderer.ScaleDependentRenderer"===ka.declaredClass&&(ka=(S="zoom"===ka.rangeType?ka.getRendererInfoByZoom(S.getZoom()):ka.getRendererInfoByScale(V))&&S.renderer,!ka))return!1;S=ka&&ka.authoringInfo&&"relationship"===ka.authoringInfo.type;if("esri.renderer.StretchRenderer"!==ka.declaredClass&&"esri.renderer.ShadedReliefRenderer"!==ka.declaredClass){var R=
this._getVariables(ka),Z=x.filter(R,function(Fa){return!!Fa}).length,W=R[0],ba=R[1];R=R[2];if(W){var ha=this._getMedianColor(ka,W);W.field&&(fa=z.isFunction(W.field)?null:this.getField(M,W.field,B));var ia=!(W.legendOptions&&!1===W.legendOptions.showLegend)}if(ba){ba.field&&(qa=z.isFunction(ba.field)?null:this.getField(M,ba.field,B));var ta=!(ba.legendOptions&&!1===ba.legendOptions.showLegend)}if(R){R.field&&(ea=z.isFunction(R.field)?null:this.getField(M,R.field,B));var oa=!(R.legendOptions&&!1===
R.legendOptions.showLegend)}}if("esri.renderer.HeatmapRenderer"===ka.declaredClass){var xa=aa=!0;this._showHeatRamp(M,B,ka,E)}else if("esri.renderer.DotDensityRenderer"===ka.declaredClass)xa=aa=!0,this._showDotDensityLegend(M,B,ka,E);else if("esri.renderer.TemporalRenderer"===ka.declaredClass){xa=aa=!0;V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);var sa=d.create("tbody",{},V);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(V,M,B);ka.latestObservationRenderer&&
"esri.renderer.SimpleRenderer"===ka.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(M,ka.latestObservationRenderer.symbol,ha,u.encode(ka.latestObservationRenderer.label)||this.NLS_currentObservations,null,sa);ka.observationRenderer&&"esri.renderer.SimpleRenderer"===ka.observationRenderer.declaredClass&&this._buildRow_Renderer(M,ka.observationRenderer.symbol,ha,u.encode(ka.observationRenderer.label)||this.NLS_previousObservations,null,sa)}else if("esri.renderer.UniqueValueRenderer"===
ka.declaredClass){if(ka.infos&&0<ka.infos.length){xa=aa=!0;if(ka.legendOptions&&ka.legendOptions.title||ka.valueExpressionTitle)V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),sa=d.create("tbody",{},V),Z=ka.legendOptions&&ka.legendOptions.title?ka.legendOptions.title:ka.valueExpressionTitle,this._buildRow_Renderer(M,null,ha,u.encode(Z),null,sa);V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);sa=d.create("tbody",{},
V);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(V,M,B);ka.attributeField&&R&&this._addSubHeader(sa,this._getFieldAlias(ka.attributeField,M,B));if(S){var ua=ka.authoringInfo;var za=ua.focus;Z=ua.numClasses;var Ba=ua.field1.field;V=ua.field2.field;if(Z&&Ba&&V){var Ea=ua.field1.normalizationField;ua=ua.field2.normalizationField;var Ca=Ea&&this._i18n.showNormField||Ba&&"${field}",Ha=ua&&this._i18n.showNormField||V&&"${field}";Ba=C.substitute({field:this._getFieldAlias(Ba,M,B),normField:Ea&&
this._getFieldAlias(Ea,M,B)},Ca);V=C.substitute({field:this._getFieldAlias(V,M,B),normField:ua&&this._getFieldAlias(ua,M,B)},Ha);Ea={shapeDescriptor:ra,rotation:this._getRotationAngleForFocus(za)||0};this._buildRow_Renderer(M,null,null,u.encode(Ba),null,sa,null,Ea);Ea.rotation+=90;this._buildRow_Renderer(M,null,null,u.encode(V),null,sa,null,Ea);this._drawRelationshipLegend(E,{numClasses:Z,focus:za,uvInfos:ka.infos})}}else{var Ka=[];x.forEach(ka.infos,function(Fa){var Ia=null;this._isLayerEditable(M)&&
M.types&&(Ia=this._getTemplateFromTypes(M.types,Fa.value));var Oa=Fa.label;null==Oa&&(Oa=this._getDomainName(ka.attributeField,Fa.value,M,B)||Fa.value);-1===x.indexOf(Ka,Oa)&&(Ka.push(Oa),this._buildRow_Renderer(M,Fa.symbol,ha,u.encode(Oa),Ia,sa))},this)}}za=!S&&this._displayDefaultSymbol(M,ka,E)}else if("esri.renderer.ClassBreaksRenderer"===ka.declaredClass){if(ka.infos&&0<ka.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass){xa=aa=!0;var Ga=this._isUnclassedRenderer(ka);
if(!W&&1===ka.infos.length)var Ma=(Ma=ka.infos[0])&&Ma.symbol;Ga||(V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),sa=d.create("tbody",{},V),Z=this._getRendererTitle(ka,M,B),this._buildRow_Renderer(M,null,ha,u.encode(Z),null,sa));V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);sa=d.create("tbody",{},V);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(V,M,B);Ga&&R&&oa||(S=ka.infos.slice(0).reverse(),x.forEach(S,
function(Fa){var Ia=Fa.label;null!=Ia||Ga||(Ia=Fa.minValue+" - "+Fa.maxValue);this._buildRow_Renderer(M,Fa.symbol,ha,u.encode(Ia),null,sa)},this));"esri.layers.ArcGISImageServiceVectorLayer"!==M.declaredClass||M.renderer.style!==P.STYLE_SCALAR&&M.renderer.style!==P.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(M,ka.defaultSymbol,null,"",null,sa),M._hideDefaultSymbol=!0)}Ga||(za=this._displayDefaultSymbol(M,ka,E))}else if("esri.renderer.StretchRenderer"===ka.declaredClass){xa=aa=!0;V=d.create("table",
{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},E);sa=d.create("tbody",{},V);var Na=this,Da,Aa,Ja=function(){ka.statistics.length?(Da=ka.statistics[0][1],Aa=ka.statistics[0][0]):(Aa=Pa?Pa.minValues[0]:M.minValues[0],Da=Pa?Pa.maxValues[0]:M.maxValues[0]);Na._createStretchLegend(sa,ka,Aa,Da)};if(M.renderingRule)M.getRenderingRuleServiceInfo(M.renderingRule).then(function(Fa){var Ia=Fa&&Fa.minValues&&0<Fa.minValues.length&&Fa.maxValues&&0<Fa.maxValues.length;Fa&&1<Fa.bandCount||!Ia?
Na._legendRequest(M).then(function(Oa){Na._processLegendResponse(M,Oa)}):Ja()});else{var Pa=M.serviceInfo;if("esri.layers.RasterXLayer"===M.declaredClass&&(Pa=M.raster.serviceInfo,M.hasMultidimensions&&!ka.statistics.length))return E=M.mosaicRule&&M.mosaicRule.multidimensionalDefinition,M.getStatistics(E&&E.length?E[0].variableName:M._defaultMultidimensionalDefinition[0].variableName).then(z.hitch(this,function(Fa){this._createStretchLegend(sa,ka,Fa[0][0],Fa[0][1]);J()})),aa;Ja()}}else"esri.renderer.ShadedReliefRenderer"===
ka.declaredClass?(xa=aa=!0,V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},E),sa=d.create("tbody",{},V),this._createStretchLegend(sa,ka,0,255)):"esri.renderer.SimpleRenderer"===ka.declaredClass?(xa=aa=!0,V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),sa=d.create("tbody",{},V),(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(V,M,B),Ma=null,this._isLayerEditable(M)&&M.templates&&0<M.templates.length&&(Ma=M.templates[0]),
S=1<Z?null:fa&&ia||qa&&ta||ea&&oa,this._buildRow_Renderer(M,ka.symbol,ha,u.encode(S?this._getRampTitle(1<Z?null:W||ba||R,M,B):ka.label),Ma,sa),Ma=W?null:ka.symbol,S&&(fa=qa=ea=null)):"esri.renderer.ColormapRenderer"===ka.declaredClass&&(ka.colormapInfos&&ka.colormapInfos.length&&(xa=aa=!0),V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),sa=d.create("tbody",{},V),ka.colormapInfos.forEach(function(Fa){var Ia=new da(da.STYLE_SOLID,null,new t(Fa.color));this._buildRow_Renderer(M,
Ia,null,Fa.label,null,sa)},this),M._hideDefaultSymbol=!0);xa&&(W&&ia&&(W.field||W.valueExpression)&&this._showGradientRamp(M,B,ka,null,E,W,fa,null,R&&oa?!0:!1),R&&oa&&(R.field||R.valueExpression&&!ya.test(R.valueExpression))&&(xa=W&&ia||"esri.renderer.UniqueValueRenderer"===ka.declaredClass?!1:!0,this._showSizeLegend(M,B,ka,R,ha,E,ea,null,xa)),ba&&ta&&(ba.field||ba.valueExpression)&&this._showGradientRamp(M,B,ka,Ma&&!Ma.url&&Ma.color?Ma.color:this.transparencyRampColor,E,ba,qa,null,!1));za||Ga&&!ia&&
!oa&&!ta||(za=this._displayDefaultSymbol(M,ka,E));aa=aa||za}Na=this;aa&&J();return aa},_createStretchLegend:function(M,B,E,J){var N=d.create("tr",{},M);var S=d.create("td",{rowspan:2,"class":"esriStretchLegend"},N);B=d.toDom(this._addColorRamp(B.colorRamp));d.place(B,S);d.create("td",{},N).innerHTML=this._i18n.high+": "+Math.round(J*Math.pow(10,3))/Math.pow(10,3);M=d.create("tr",{},M);d.create("td",{},M).innerHTML=this._i18n.low+": "+Math.round(E*Math.pow(10,3))/Math.pow(10,3)},_addColorRamp:function(M){M||
(M={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var B=this._generateColorRampDivs(M);M.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+B+"\x3c/div\x3e";return M.label},_generateColorRampDivs:function(M){if(M){var B="";if("multipart"===M.type){var E=100/M.colorRamps.length;var J=M.colorRamps;Object.keys(J).reverse().forEach(function(N){B+=this._generateSingleGradientDiv(J[N].fromColor,J[N].toColor,E)},this)}else B=this._generateSingleGradientDiv(M.fromColor,M.toColor,
100);return B}},_generateSingleGradientDiv:function(M,B,E){if(M&&B){var J="";M=M.toRgb?M.toRgb():M;B=B.toRgb?B.toRgb():B;var N="(0deg, rgb("+M.slice(0,3).join()+"), rgb("+B.slice(0,3).join()+"));";x.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],function(S){J+="background: "+S+N});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+E+"%;"+J+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(M){return"function"===typeof M.isEditable&&
M.isEditable()},_isUnclassedRenderer:function(M,B){if("esri.renderer.ClassBreaksRenderer"===M.declaredClass&&M.infos&&1===M.infos.length){var E=M.attributeField;var J=M.normalizationField;E=B?E===B:!!this._getVariables(M,E,J).length}return E},_displayDefaultSymbol:function(M,B,E){if(!M._hideDefaultSymbol&&B.defaultSymbol){var J=!0;E=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);E=d.create("tbody",{},E);this._buildRow_Renderer(M,B.defaultSymbol,null,u.encode(B.defaultLabel)||
"others",null,E)}return J},_showGradientRamp:function(M,B,E,J,N,S,V,aa,fa){fa=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(fa?"":" esriLegendSubFragment")},N);N=d.create("tbody",{},fa);(M._hoverLabel||M._hoverLabels||aa)&&this._createHoverAction(fa,M,B,aa);(V||S.valueExpression||S.legendOptions&&S.legendOptions.title)&&this._addSubHeader(N,this._getRampTitle(S,M,B));V=S.field;var ea;V&&(ea=z.isFunction(V)?null:this.getField(M,V,B));if(S=(B=this._getRampStops(E,
S,J,ea&&"esriFieldTypeDate"===ea.type))?B.length:0)S=10<S,this._drawGradientRamp(N,B,!S,M,this._getRampBorderColor(E),!!J,S)},_getMedianColor:function(M,B){if(B.colors){var E=B.minDataValue;var J=B.maxDataValue}else B.stops&&(E=B.stops[0].value,J=B.stops[B.stops.length-1].value);return M.getColor(E+(J-E)/2,{colorInfo:B})},_getRampStops:function(M,B,E,J){var N,S,V=!1;if(B.colors||B.opacityValues){var aa=B.maxDataValue-B.minDataValue;var fa=x.map([0,.25,.5,.75,1],function(R){N=B.minDataValue+R*aa;return Number(N.toFixed(6))});
this._checkPrecision(0,4,fa)}else B.stops&&(fa=x.map(B.stops,function(R){return R.value}),(V=x.some(B.stops,function(R){return!!R.label}))&&(S=x.map(B.stops,function(R){return R.label})));var ea=fa[0],qa,ka;aa=fa[fa.length-1]-ea;return x.map(fa,function(R,Z){E?(qa=new t(E.toRgba()),ka=M.getOpacity(R,{opacityInfo:B}),null!=ka&&(qa.a=ka)):qa=M.getColor(R,{colorInfo:B});var W="";if(V)W=S[Z];else{W=J?G.formatDate(R,G.timelineDateFormatOptions):D.format(R);var ba="";0===Z?ba=this._specialChars.lt+" ":
Z===fa.length-1&&(ba=this._specialChars.gt+" ");W=ba+W}return{value:R,color:qa,offset:1-(R-ea)/aa,label:W}},this).reverse()},_checkPrecision:function(M,B,E){var J=M+(B-M)/2,N=E[M],S=E[J],V=E[B],aa=Math.floor(N),fa=Math.floor(S),ea=Math.floor(V);aa===N&&ea===V&&fa!==S&&aa!==fa&&ea!==fa&&(E[J]=fa);M+1!==J&&this._checkPrecision(M,J,E);J+1!==B&&this._checkPrecision(J,B,E)},_getRampBorderColor:function(M){if("esri.renderer.SimpleRenderer"===M.declaredClass)var B=M.symbol;else if("esri.renderer.UniqueValueRenderer"===
M.declaredClass||"esri.renderer.ClassBreaksRenderer"===M.declaredClass)B=M.infos[0].symbol;return(M=B&&-1===B.type.indexOf("linesymbol")?B.getStroke():null)&&M.color},_drawGradientRamp:function(M,B,E,J,N,S,V){var aa=d.create("tr",{},M),fa=B.length-1,ea;var qa=0;if(this.alignRight){M=d.create("td",{align:this._isRightToLeft?"left":"right"},aa);var ka=d.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},aa)}else ka=d.create("td",{width:this.gradientWidth,align:"center"},
aa),M=d.create("td",{},aa);aa=N&&0<N.a&&!(240<=N.r&&240<=N.g&&240<=N.b);var R=d.create("div",{"class":aa?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},ka);ka=d.create("div",{"class":"esriLegendColorRamp"+(S?" esriLegendTransparencyRamp":"")},R);S=a.get(ka,"width");aa&&(N=9>h("ie")?N.toHex():"rgba("+N.toRgba().join(",")+")",a.set(ka,"border",this.colorRampBorder+" "+N));E?(N=this.gradientHeight*fa,a.set(ka,"height",N+"px")):N=a.get(ka,"height");a.set(R,
"height",N+"px");aa=q.createSurface(ka,S,N);9>h("ie")&&(qa=aa.getEventSource(),a.set(qa,"position","relative"),a.set(qa.parentNode,"position","relative"),qa=1);try{E&&x.forEach(B,function(ba,ha){ba.offset=ha/fa});var Z=aa.createRect({x:-qa,y:-qa,width:S+qa,height:N+qa});Z.setFill({type:"linear",x1:0,y1:0,x2:0,y2:N,colors:B}).setStroke(null);aa.createRect({width:S,height:N}).setFill(new t([255,255,255,1-J.opacity])).setStroke(null);this._surfaceItems.push(aa)}catch(ba){aa.clear(),aa.destroy()}x.forEach(B,
function(ba,ha){ba.label&&(ea="top:"+100*ba.offset+"%;",ba="",0===ha&&(ba+=" esriLegendColorRampTickFirst"),ha===B.length-1&&(ba+=" esriLegendColorRampTickLast"),d.create("div",{"class":"esriLegendColorRampTick"+ba,innerHTML:"\x26nbsp;",style:ea},R))});var W=d.create("div",{"class":"esriLegendColorRampLabels",style:{height:N+this.gradientHeight+"px"}},M);E?x.forEach(B,function(ba){d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:u.encode(ba.label)||"\x26nbsp;"},W)}):(d.create("div",{"class":"esriLegendColorRampLabel",
innerHTML:V?u.encode(B[0].label)||"\x26nbsp;":this._i18n.high},W),d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:V?u.encode(B[B.length-1].label)||"\x26nbsp;":this._i18n.low,style:"top: "+(N+this.gradientHeight-2*this.gradientHeight)+"px;"},W))},_showHeatRamp:function(M,B,E,J,N){var S=E.field;var V=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},J);J=d.create("tbody",{},V);(M._hoverLabel||M._hoverLabels||N)&&this._createHoverAction(V,M,B,N);(S=S&&
this.getField(M,S,B))&&this._addSubHeader(J,this._getFieldAlias(S.name,M,B));B=this._getHeatmapStops(E);B.length&&this._drawGradientRamp(J,B,!1,M)},_getHeatmapStops:function(M){var B=M.colorStops;M=M.colors;if(B&&B[0]){var E=B.length-1;if(M=B[0]&&null!=B[0].ratio)(M=B[E])&&1!==M.ratio&&(B=B.slice(0),B.push({ratio:1,color:M.color}),E++);else{var J=B[0].value;var N=B[E].value-J;B=x.map(B,function(V){return{color:V.color,ratio:(V.value-J)/N}})}}else if(M&&M[0]){E=M.length-1;var S=1/(M.length-1);B=x.map(M,
function(V,aa){return{color:V,ratio:aa*S}})}B=x.map(B,function(V,aa){var fa="";0===aa?fa="Low":aa===E&&(fa="High");return{color:V.color,label:fa,offset:1-V.ratio}});return B.reverse()},_showDotDensityLegend:function(M,B,E,J){var N=E.legendOptions,S,V=this.dotDensitySwatchSize,aa=Math.round(V/2);if(N){var fa=N.backgroundColor;var ea=N.outline;var qa=N.valueUnit;var ka=N.dotCoverage}ka=(ka||this.dotCoverage)/100;var R=Math.round(V*V/Math.pow(E.dotSize,2)*ka);J=d.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},J);var Z=d.create("tbody",{},J);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(J,M,B);this._addSubHeader(Z,C.substitute({value:E.dotValue,unit:qa||""},this.NLS_dotValue));x.forEach(E.fields,function(W){W=z.mixin({},W);W.numPoints=R;S=new U(E._generateImageSrc(V,V,[W],{x:0,y:0},{x:V,y:V},fa),ea||E.outline,V,V);W=this.getField(M,W.name,B)||W;this._buildRow_Renderer(M,S,null,u.encode(this._getFieldAlias(W.name,M,B)),null,Z,{type:"path",path:"M "+-aa+","+
-aa+" L "+aa+","+-aa+" L "+aa+","+aa+" L "+-aa+","+aa+" L "+-aa+","+-aa+" E"})},this)},_showSizeLegend:function(M,B,E,J,N,S,V,aa,fa){var ea=J.legendOptions;ea=ea&&ea.customValues;N=this._getSizeSymbol(E,N);if((!J.valueUnit||"unknown"===J.valueUnit)&&N&&(ea||null!=J.minSize&&null!=J.maxSize&&null!=J.minDataValue&&null!=J.maxDataValue||J.stops&&!(1>=J.stops.length))){fa=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(fa?"":" esriLegendSubFragment")},S);S=d.create("tbody",
{},fa);(M._hoverLabel||M._hoverLabels||aa)&&this._createHoverAction(fa,M,B,aa);(V||J.valueExpression||J.legendOptions&&J.legendOptions.title)&&this._addSubHeader(S,this._getRampTitle(J,M,B));V=(fa=(aa=J.field)&&!z.isFunction(aa))&&"cluster_count"===aa.toLowerCase();B=(B=fa?M.isFeatureReductionActive&&M.isFeatureReductionActive()?M.getFeatureReductionField(aa):this.getField(M,aa,B):null)&&"esriFieldTypeDate"===B.type;ea=ea||this._getDataValues(E,N,J,B,V);var qa=ea.length-1;for(aa=qa;0<=aa;aa--){fa=
ea[aa];N=na.fromJson(N.toJson());this._applySize(N,E,J,fa);fa=B?G.formatDate(fa,G.timelineDateFormatOptions):D.format(fa);var ka="";aa===qa?ka=this._specialChars.gt+" ":0===aa&&(ka=V&&1===ea[aa]?"":this._specialChars.lt+" ");ka="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+u.encode(ka+fa)+"\x3c/span\x3e";this._buildRow_Renderer(M,N,null,ka,null,S)}}},_getSizeSymbol:function(M,B){if("esri.renderer.SimpleRenderer"===M.declaredClass)var E=M.symbol;else if("esri.renderer.VectorFieldRenderer"===M.declaredClass)E=
M.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===M.declaredClass||"esri.renderer.ClassBreaksRenderer"===M.declaredClass){E=M.infos[0].symbol;var J=1<M.infos.length}if(E=E&&-1!==E.type.indexOf("fillsymbol")?null:E)if(E=na.fromJson(E.toJson()),B||J)-1!==E.type.indexOf("linesymbol")?E.setColor(new t(this.sizeRampDarkColor)):(E.setColor(new t(this.sizeRampLightColor)),E.setOutline&&(M=new ca,M.setColor(new t(this.sizeRampDarkColor)),M.setWidth(1.5),E.setOutline(M)));return E},_getDataValues:function(M,
B,E,J,N){if(N){var S;x.some([5,3,2],function(V){V=this._getDataValuesByCount(M,B,E,J,V);this._hasFractionalValues(V)||(S=V);return!!S},this);return S}return this._getDataValuesByCount(M,B,E,J,5)},_getDataValuesByCount:function(M,B,E,J,N,S){N=null==N?5:N;S=null==S?20:S;var V=M.getSizeRangeAtScale(E,this.map.getScale());N=this._interpolateSizeRange(V,N);var aa=this._getDataRange(E),fa=x.map(N,function(qa){return this._getDataValueFromSize(qa,aa,V)},this);if(!J){var ea;fa=D.round(fa);for(J=1;J<fa.length-
1;J++)if(ea=this._roundDataValue(M,B,E,fa[J],fa[J-1],S))fa[J]=ea[0],N[J]=ea[1]}return fa},_hasFractionalValues:function(M){return x.some(M,function(B){return B!==Math.floor(B)})},_getDataRange:function(M){var B=M.stops;return B?{min:B[0].value,max:B[B.length-1].value}:{min:M.minDataValue,max:M.maxDataValue}},_interpolateSizeRange:function(M,B){var E=M.minSize;M=(M.maxSize-E)/(B-1);var J,N=[];for(J=0;J<B;J++)N.push(E+M*J);return N},_getDataValueFromSize:function(M,B,E){var J=E.minSize;E=E.maxSize;
var N=B.min;B=B.max;return M<=J?N:M>=E?B:(M-J)/(E-J)*(B-N)+N},_roundDataValue:function(M,B,E,J,N,S){var V=this._getSize(B,M,E,J);N=this._getSize(B,M,E,N);var aa=D.getDigits(J),fa=aa.integer;aa=aa.fractional;var ea;if(0<J&&1>J){var qa=Math.pow(10,aa);J*=qa;fa=D.getDigits(J).integer}for(--fa;0<=fa;fa--){var ka=Math.pow(10,fa);aa=Math.floor(J/ka)*ka;ka*=Math.ceil(J/ka);null!=qa&&(aa/=qa,ka/=qa);var R=(aa+ka)/2;R=D.round([aa,R,ka],{indexes:[1]})[1];var Z=this._getSize(B,M,E,aa);var W=this._getSize(B,
M,E,ka);var ba=this._getSize(B,M,E,R);var ha=D.getPctChange(V,Z,N,null);var ia=D.getPctChange(V,W,N,null);var ta=D.getPctChange(V,ba,N,null);var oa=ha.prev<=S;var xa=ia.prev<=S;oa&&xa&&(ha.prev<=ia.prev?(oa=!0,xa=!1):(xa=!0,oa=!1));oa?ea=[aa,Z]:xa?ea=[ka,W]:ta.prev<=S&&(ea=[R,ba]);if(ea)break}return ea},_applySize:function(M,B,E,J){var N=M.type;B=this._getSize(M,B,E,J);switch(N){case "simplemarkersymbol":M.setSize(B);break;case "picturemarkersymbol":N=M.width;E=M.height;M.setHeight(B);M.setWidth(N/
E*B);break;case "simplelinesymbol":case "cartographiclinesymbol":M.setWidth(B);break;case "textsymbol":M.font&&M.font.setSize(B)}},_getSize:function(M,B,E,J){return B.getSize(J,{sizeInfo:E,scale:this.map.getScale(),shape:-1!==M.type.indexOf("markersymbol")?M.style:null})},_buildRow_Renderer:function(M,B,E,J,N,S,V,aa){var fa=!!aa,ea=d.create("tr",{},S);if(this.alignRight){if(S=d.create("td",{align:this._isRightToLeft?"left":"right"},ea),B||fa)var qa=d.create("td",{align:this._isRightToLeft?"left":
"right",width:35},ea)}else{if(B||fa)qa=d.create("td",{width:35,align:"center"},ea);S=d.create("td",{},ea)}var ka=ea=30;if(B)if("simplemarkersymbol"==B.type)ea=Math.min(Math.max(ea,B.size+12),125),ka=Math.min(Math.max(ka,B.size+12),125);else if("picturemarkersymbol"==B.type)ea=Math.min(Math.max(ea,B.width),125),ka=Math.min(B.height||ka,125);else if("textsymbol"==B.type){if(!B.text){var R=B.text;var Z=!0;B.setText(this.defaultText)}ea=Math.min(Math.max(ea,B.getWidth()+12),125);ka=Math.min(Math.max(ka,
B.getHeight()+12),125);Z&&B.setText(R)}if(B||fa)var W=d.create("div",{style:"width:"+ea+"px;height:"+ka+"px;"},qa);C.isDefined(J)&&"number"===typeof J&&(J=""+J);d.create("td",{innerHTML:J||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},S))));if(B||fa)M=this._drawSymbol(W,B,E,ea,ka,N,M,V,aa),this._surfaceItems.push(M)},_addSubHeader:function(M,B){M=d.create("tr",{},M);M=d.create("td",{align:this._align,colspan:2},M);d.create("td",{innerHTML:u.encode(B)||"",
align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},M))))},_drawSymbol:function(M,B,E,J,N,S,V,aa,fa){var ea=B&&na.fromJson(B.toJson()),qa=V.opacity;B=!!fa;if(ea)if(E&&ea.setColor(new t(E.toRgba())),"simplelinesymbol"===ea.type||"cartographiclinesymbol"===ea.type||"textsymbol"===ea.type){if(!ea.color)return;E=ea.color.toRgba();E[3]*=qa;ea.color.setColor(E)}else"simplemarkersymbol"===ea.type||"simplefillsymbol"===ea.type?(ea.color&&(E=ea.color.toRgba(),E[3]*=qa,ea.color.setColor(E)),
ea.outline&&ea.outline.color&&(E=ea.outline.color.toRgba(),E[3]*=qa,ea.outline.color.setColor(E))):"picturemarkersymbol"===ea.type&&(M.style.opacity=qa,M.style.filter="alpha(opacity\x3d("+100*qa+"))");M=q.createSurface(M,J,N);9>h("ie")&&(E=M.getEventSource(),a.set(E,"position","relative"),a.set(E.parentNode,"position","relative"));S=B?fa.shapeDescriptor:this._getDrawingToolShape(ea,S)||na.getShapeDescriptors(ea);qa=(E=S.defaultShape)&&"text"===E.type;try{qa&&!E.text&&(E.text=this.defaultText);var ka=
M.createShape(aa||E).setFill(S.fill).setStroke(S.stroke);qa&&ka.setFont(S.font)}catch(W){M.clear();M.destroy();return}var R=ka.getBoundingBox();aa=R.width;S=R.height;qa=-(R.x+aa/2);var Z=-(R.y+S/2);E=M.getDimensions();qa={dx:qa+E.width/2,dy:Z+E.height/2};if(ea&&"simplemarkersymbol"===ea.type&&"path"===ea.style)J=V._getScaleMatrix(R,ea.size),ka.applyTransform(A.scaleAt(J.xx,J.yy,{x:E.width/2,y:E.height/2}));else if(aa>J||S>N)V=aa/J>S/N,J=((V?J:N)-5)/(V?aa:S),z.mixin(qa,{xx:J,yy:J});ka.applyTransform(qa);
B&&ka.applyTransform(A.rotategAt(fa.rotation,aa/2,S/2));return M},_getDrawingToolShape:function(M,B){switch(B?B.drawingTool||null:null){case "esriFeatureEditToolArrow":B={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":B={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":B={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":B=
{type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":B={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:B,fill:M.getFill(),stroke:M.getStroke()}},_drawRelationshipLegend:function(M,B){var E=B.focus,J=B.numClasses,N=la[J],S=!!E,V=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),aa={};B.uvInfos.forEach(function(ka){aa[ka.value]={label:ka.label,fill:this._getSymbolColor(ka.symbol)}},this);B=[];for(var fa=0;fa<J;fa++){for(var ea=[],qa=0;qa<J;qa++)ea.push(aa[N[fa][qa]].fill);
B.push(ea)}N=this._getRelationshipCornerLabels(E,aa);M=this._drawRampLayout(M,N,V,S);M=q.createSurface(M,V,V);S||(M.rawNode.style.margin="-15px -15px -18px -15px");B=ma.create2DColorRamp({surface:M,colors:B,numClasses:J,size:75});J=(V-75)/2;V=(V-75)/2;B.applyTransform(A.translate(J,V));S&&B.applyTransform(A.rotategAt(this._getRotationAngleForFocus(E),37.5,37.5));B=M.createGroup();N={width:1,color:"#555555"};fa=M.defNode;this._createArrowMarker(fa,"start");this._createArrowMarker(fa,"end");fa=B.createLine({x1:-10,
y1:60,x2:-10,y2:15}).setStroke(N);N=B.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(N);this._setLineArrow(fa.rawNode,"left",E);this._setLineArrow(N.rawNode,"right",E);B.applyTransform(A.translate(J,V));S&&B.applyTransform(A.rotategAt(-45,37.5,37.5));this._surfaceItems.push(M)},_drawRampLayout:function(M,B,E,J){var N=d.create("div",{style:{padding:"10px"}},M);M=E+"px";E+="px";J?(J=d.create("div",{style:{display:"flex"}},N),d.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",
maxWidth:M,textAlign:"right"},innerHTML:B.left},J),N=d.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},J),d.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:M},innerHTML:B.right},J),J=d.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:M},innerHTML:B.top},N),J=d.create("div",{style:{height:E,width:E}},N),N=d.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:M},
innerHTML:B.bottom},N)):(N=d.create("div",{style:{display:"table",color:"#555555"}},N),J=d.create("div",{style:{display:"table-row"}},N),E=d.create("div",{style:{display:"table-row"}},N),N=d.create("div",{style:{display:"table-row"}},N),d.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:M,textAlign:"right",verticalAlign:"bottom"},innerHTML:B.left},J),d.create("div",{style:{display:"table-cell"}},J),d.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",
maxWidth:M,textAlign:"left",verticalAlign:"bottom"},innerHTML:B.top},J),d.create("div",{style:{display:"table-cell"}},E),J=d.create("div",{style:{display:"table-cell"}},E),d.create("div",{style:{display:"table-cell"}},E),d.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:M,textAlign:"right",verticalAlign:"top"},innerHTML:B.bottom},N),d.create("div",{style:{display:"table-cell"}},N),d.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",
maxWidth:M,textAlign:"left",verticalAlign:"top"},innerHTML:B.right},N));return J},_getSymbolColor:function(M){if(M)return"simplelinesymbol"===M.type||"simplemarkersymbol"===M.type&&(M.style===Y.STYLE_X||M.style===Y.STYLE_CROSS)?(M=M.getStroke())&&M.color:M.getFill()},_getRotationAngleForFocus:function(M){var B=X[M];M&&null==B&&(B=X.HH);return B},_setLineArrow:function(M,B,E){var J=this.id+"_arrowStart",N=this.id+"_arrowEnd";B="left"===B;switch(E){case "HL":M.setAttribute(B?"marker-start":"marker-end",
"url(#"+(B?N:J)+")");break;case "LL":M.setAttribute("marker-start","url(#"+N+")");break;case "LH":M.setAttribute(B?"marker-end":"marker-start","url(#"+(B?J:N)+")");break;default:M.setAttribute("marker-end","url(#"+J+")")}},_createArrowMarker:function(M,B){var E="start"===B,J=this.id+(E?"_arrowStart":"_arrowEnd");B=E?"0,0 5,5 0,10":"5,0 0,5 5,10";var N=E?5:0;E=document.createElementNS("http://www.w3.org/2000/svg","marker");E.setAttribute("id",J);E.setAttribute("markerWidth","10");E.setAttribute("markerHeight",
"10");E.setAttribute("refX",N);E.setAttribute("refY","5");E.setAttribute("markerUnits","strokeWidth");E.setAttribute("orient","auto");J=document.createElementNS("http://www.w3.org/2000/svg","polyline");J.setAttribute("points",B);J.setAttribute("fill","none");J.setAttribute("stroke","#555555");J.setAttribute("stroke-width","1");E.appendChild(J);M.appendChild(E)},_getRelationshipCornerLabels:function(M,B){var E=B.HH.label,J=B.LL.label,N=B.HL.label;B=B.LH.label;switch(M){case "HH":return{top:E,bottom:J,
left:N,right:B};case "HL":return{top:N,bottom:B,left:J,right:E};case "LL":return{top:J,bottom:E,left:B,right:N};case "LH":return{top:B,bottom:N,left:E,right:J};default:return{top:E,bottom:J,left:N,right:B}}},_repaintItems:function(){x.forEach(this._surfaceItems,function(M){this._repaint(M)},this)},_repaint:function(M){if(M){M.getStroke&&M.setStroke&&M.setStroke(M.getStroke());try{M.getFill&&M.setFill&&M.setFill(M.getFill())}catch(B){}M.children&&z.isArray(M.children)&&x.forEach(M.children,this._repaint,
this)}},_createHoverAction:function(M,B,E,J){if(J=B._hoverLabel||B._hoverLabels&&B._hoverLabels[E.id]||J)J=u.encode(J),B.mouseMoveHandler=B.mouseMoveHandler||{},B.mouseMoveHandler[E.id]=n.connect(M,"onmousemove",z.hitch(this,function(N,S){this.mouseX=S.clientX;this.mouseY=S.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,a.set(b.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(z.hitch(this,function(V,aa,fa){if(V==this.mouseX&&aa==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,b.byId(this.id+"_hoverLabel")){var ea=b.byId(this.id+"_hoverLabel");ea.innerHTML="\x3cspan\x3e"+fa+"\x3c/span\x3e";a.set(ea,"top",aa+"px");a.set(ea,"left",V+15+"px");a.set(ea,"display","")}else d.create("div",{innerHTML:"\x3cspan\x3e"+fa+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:aa+"px",left:V+15+"px"}},document.body)},S.clientX,S.clientY,N),500)},J)),B.mouseOutHandler=B.mouseOutHandler||{},B.mouseOutHandler[E.id]=n.connect(M,"onmouseout",z.hitch(this,function(N){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,a.set(b.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var M;x.forEach(this.layers,function(B){if(B.mouseMoveHandler)for(M in B.mouseMoveHandler)n.disconnect(B.mouseMoveHandler[M]);if(B.mouseOutHandler)for(M in B.mouseOutHandler)n.disconnect(B.mouseOutHandler[M])})},_createDynamicLayers:function(M){var B=[],E;x.forEach(M.dynamicLayerInfos||M.layerInfos,function(J){E={id:J.id};E.source=J.source&&J.source.toJson();
var N;M.layerDefinitions&&M.layerDefinitions[J.id]&&(N=M.layerDefinitions[J.id]);N&&(E.definitionExpression=N);var S;M.layerDrawingOptions&&M.layerDrawingOptions[J.id]&&(S=M.layerDrawingOptions[J.id]);S&&(E.drawingInfo=S.toJson());E.minScale=J.minScale||0;E.maxScale=J.maxScale||0;B.push(E)});return B},_getTemplateFromTypes:function(M,B){var E;for(E=0;E<M.length;E++)if(M[E].id==B&&M[E].templates&&0<M[E].templates.length)return M[E].templates[0];return null},_findParentGroup:function(M,B,E){var J,N=
B.dynamicLayerInfos||B.layerInfos;for(J=0;J<N.length;J++)if(E==N[J].id){-1<N[J].parentLayerId&&(a.set(b.byId(this.id+"_"+M+"_"+N[J].parentLayerId+"_group"),"display","block"),this._findParentGroup(M,B,N[J].parentLayerId));break}},_addSubLayersToHide:function(M){function B(E,J){var N=M.layer.dynamicLayerInfos||M.layer.layerInfos,S,V;for(S=0;S<N.length;S++)if(N[S].id===E&&N[S].subLayerIds)for(V=0;V<N[S].subLayerIds.length;V++){var aa=N[S].subLayerIds[V];-1===x.indexOf(J,aa)&&(J.push(aa),B(aa,J))}}M.layer.layerInfos&&
x.forEach(this.hideLayersInLegend[M.layer.id],function(E){B(E,this.hideLayersInLegend[M.layer.id])},this)},_isLayerInScale:function(M,B,E){var J,N=!0;if(M.legendResponse&&M.legendResponse.layers)for(J=0;J<M.legendResponse.layers.length;J++){var S=M.legendResponse.layers[J];if(B.id==S.layerId){if(!M.minScale&&0!==M.minScale||!M.maxScale&&0!==M.maxScale){if(0==S.minScale&&M.tileInfo)var V=M.tileInfo.lods[0].scale;if(0==S.maxScale&&M.tileInfo)var aa=M.tileInfo.lods[M.tileInfo.lods.length-1].scale}else V=
Math.min(M.minScale,S.minScale)||M.minScale||S.minScale,aa=Math.max(M.maxScale,S.maxScale);if(0<V&&V<E||aa>E)N=!1;break}}else if(M.minScale||M.maxScale)if(M.minScale&&M.minScale<E||M.maxScale&&M.maxScale>E)N=!1;return N},_getServiceTitle:function(M){var B=M._titleForLegend;B||(B=M.url,M.url?-1<M.url.indexOf("/MapServer")?(B=M.url.substring(0,M.url.indexOf("/MapServer")),B=B.substring(B.lastIndexOf("/")+1,B.length)):-1<M.url.indexOf("/ImageServer")?(B=M.url.substring(0,M.url.indexOf("/ImageServer")),
B=B.substring(B.lastIndexOf("/")+1,B.length)):-1<M.url.indexOf("/FeatureServer")&&(B=M.url.substring(0,M.url.indexOf("/FeatureServer")),B=B.substring(B.lastIndexOf("/")+1,B.length)):B="",M.name&&(B=0<B.length?B+(" - "+M.name):M.name));"esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass&&M.vectorFieldPixelFilter&&(M=M.vectorFieldPixelFilter.outputUnit?this["NLS_"+M.vectorFieldPixelFilter.outputUnit]:this["NLS_"+M.vectorFieldPixelFilter.inputUnit],C.isDefined(M)&&(B+=" ("+M+")"));return u.encode(B)},
_getEffectiveScale:function(M,B){var E=B.minScale,J=B.maxScale;if(C.isDefined(B.parentLayerId)){M=M.layerInfos;B=B.parentLayerId;var N;for(N=M.length-1;0<=N;N--)if(M[N].id==B)if(0==E&&0<M[N].minScale?E=M[N].minScale:0<E&&0==M[N].minScale||0<E&&0<M[N].minScale&&(E=Math.min(E,M[N].minScale)),J=Math.max(J||0,M[N].maxScale||0),-1<M[N].parentLayerId)B=M[N].parentLayerId;else break}return{minScale:E,maxScale:J}},_isSupportedLayerType:function(M){return!(!M||!("esri.layers.ArcGISDynamicMapServiceLayer"===
M.declaredClass||"esri.layers.ArcGISImageServiceLayer"===M.declaredClass&&10.2<=M.version||"esri.layers.RasterXLayer"===M.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===M.declaredClass||"esri.layers.FeatureLayer"===M.declaredClass||"esri.layers.StreamLayer"===M.declaredClass||"esri.layers.KMLLayer"===M.declaredClass||"esri.layers.GeoRSSLayer"===M.declaredClass||"esri.layers.WMSLayer"===M.declaredClass||"esri.layers.WFSLayer"===
M.declaredClass||"esri.layers.CSVLayer"===M.declaredClass))},isHostedTileService:function(M){var B=/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==M.declaredClass||!B.test(M.url))},getField:function(M,B,E){if(M.getField)return M.getField(B);if(E&&E.fields){var J;x.forEach(E.fields,function(N){N.name===B&&(J=N)});return J}return null}});z.mixin(wa,{ALIGN_LEFT:0,ALIGN_RIGHT:1});h("extend-esri")&&z.setObject("dijit.Legend",wa,k);return wa})},"dojo/debounce":function(){define([],
function(){return function(F,r){var z;return function(){z&&clearTimeout(z);var x=this,n=arguments;z=setTimeout(function(){F.apply(x,n)},r)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(F,r,z,x){var n=function(t,m){return t-m},v={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(t){var m=String(t),h=m.match(v._reNumber);t={integer:0,fractional:0};h&&h[1]?(t.integer=h[1].split("").length,t.fractional=h[3]?h[3].split("").length:
0):-1<m.toLowerCase().indexOf("e")&&(h=m.split("e"),m=h[0],h=h[1],m&&h&&(m=Number(m),h=Number(h),(t=0<h)||(h=Math.abs(h)),m=v.getDigits(m),t?(m.integer+=h,m.fractional=h>m.fractional?0:m.fractional-h):(m.fractional+=h,m.integer=h>m.integer?1:m.integer-h),t=m));return t},getFixedNumbers:function(t,m){var h=Number(t.toFixed(m));h<t?t=h+1/Math.pow(10,m):(t=h,h-=1/Math.pow(10,m));h=Number(h.toFixed(m));t=Number(t.toFixed(m));return[h,t]},getPctChange:function(t,m,h,p){var e={prev:null,next:null};if(null!=
h){var c=t-h;e.prev=Math.floor(Math.abs(100*(m-h-c)/c))}null!=p&&(c=p-t,e.next=Math.floor(Math.abs(100*(p-m-c)/c)));return e},round:function(t,m){t=t.slice(0);var h,p,e=m&&null!=m.tolerance?m.tolerance:2,c=m&&m.indexes,f=m&&null!=m.strictBounds?m.strictBounds:!1;if(c)c.sort(n);else for(c=[],h=0;h<t.length;h++)c.push(h);for(h=0;h<c.length;h++){var b=c[h];m=t[b];var d=0===b?null:t[b-1];var a=b===t.length-1?null:t[b+1];var g=v.getDigits(m);if(g=g.fractional){var l=0;for(p=!1;l<=g&&!p;){var q=v.getFixedNumbers(m,
l);q=f&&0===h?q[1]:q[0];p=v.hasMinimalChange(m,q,d,a,e);l++}p&&(t[b]=q)}}return t},hasMinimalChange:function(t,m,h,p,e){t=v.getPctChange(t,m,h,p);m=null==t.prev||t.prev<=e;h=null==t.next||t.next<=e;return m&&h||t.prev+t.next<=2*e},_reAllZeros:new RegExp("\\"+z.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,format:function(t,m){m=m||{places:20,round:-1};(t=r.format(t,m))&&(t=t.replace(v._reSomeZeros,"$1").replace(v._reAllZeros,""));return t}};F("extend-esri")&&(x.numberUtils=v);return v})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),
function(F,r,z,x,n,v,t,m){function h(g){return g&&r.map(g,function(l){return new t(l)})}function p(g,l,q){var A="";0===l?A=c.lt+" ":l===q&&(A=c.gt+" ");return A+g}var e={},c={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},f={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},b={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},d={formatLength:"short",fullYear:!0},a={formatLength:"short"};F.mixin(e,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(g,l){var q=[];null==g||g instanceof Date||
(g=new Date(g));l=l||{};l=F.mixin({},l);var A=l.selector?l.selector.toLowerCase():null,u=!A||-1<A.indexOf("time");A=!A||-1<A.indexOf("date");u&&(l.timeOptions=l.timeOptions||a,l.timeOptions&&(l.timeOptions=F.mixin({},l.timeOptions),l.timeOptions.selector=l.timeOptions.selector||"time",q.push(l.timeOptions)));A&&(l.dateOptions=l.dateOptions||d,l.dateOptions&&(l.dateOptions=F.mixin({},l.dateOptions),l.dateOptions.selector=l.dateOptions.selector||"date",q.push(l.dateOptions)));q&&q.length?(q=r.map(q,
function(k){return x.format(g,k)}),l=1==q.length?q[0]:m["dateTimeFormat-medium"].replace(/'/g,"").replace(/\{(\d+)\}/g,function(k,w){return q[w]})):l=x.format(g);return l},createColorStops:function(g){var l=g.values,q=g.colors,A=g.labelIndexes,u=g.isDate,k=g.dateFormatOptions;g=[];return g=r.map(l,function(w,y){var C=null;if(!A||-1<r.indexOf(A,y)){var D;(D=u?e.formatDate(w,k):v.format(w))&&(C=p(D,y,l.length-1))}return{value:w,color:q[y],label:C}})},updateColorStops:function(g){var l=g.stops,q=g.changes,
A=g.isDate,u=g.dateFormatOptions,k=[],w=r.map(l,function(C){return C.value});r.forEach(q,function(C){k.push(C.index);w[C.index]=C.value});var y=v.round(w,{indexes:k});r.forEach(l,function(C,D){C.value=w[D];if(null!=C.label){var G,H=null;(G=A?e.formatDate(y[D],u):v.format(y[D]))&&(H=p(G,D,l.length-1));C.label=H}})},createClassBreakLabel:function(g){var l=g.minValue,q=g.maxValue,A=g.isFirstBreak?"":c.gt+" ";g="percent-of-total"===g.normalizationType?c.pct:"";l=null==l?"":v.format(l);q=null==q?"":v.format(q);
return A+l+g+" \u2013 "+q+g},setLabelsForClassBreaks:function(g){var l=g.classBreaks,q=g.classificationMethod,A=g.normalizationType,u=[];l&&l.length&&("standard-deviation"===q?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):g.round?(u.push(l[0].minValue),r.forEach(l,function(k){u.push(k.maxValue)}),u=v.round(u),r.forEach(l,function(k,w){k.label=e.createClassBreakLabel({minValue:0===w?u[0]:u[w],maxValue:u[w+1],isFirstBreak:0===
w,normalizationType:A})})):r.forEach(l,function(k,w){k.label=e.createClassBreakLabel({minValue:k.minValue,maxValue:k.maxValue,isFirstBreak:0===w,normalizationType:A})}))},updateClassBreak:function(g){var l=g.classBreaks,q=g.normalizationType,A=g.change,u=A.index;A=A.value;var k=-1,w=-1,y=l.length;"standard-deviation"===g.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===u?k=u:u===y?w=u-1:(w=u-1,k=u),-1<k&&
k<y&&(g=l[k],g.minValue=A,g.label=e.createClassBreakLabel({minValue:g.minValue,maxValue:g.maxValue,isFirstBreak:0===k,normalizationType:q})),-1<w&&w<y&&(g=l[w],g.maxValue=A,g.label=e.createClassBreakLabel({minValue:g.minValue,maxValue:g.maxValue,isFirstBreak:0===w,normalizationType:q})))},calculateDateFormatInterval:function(g){var l,q,A=g.length,u=Infinity;g=r.map(g,function(L){return new Date(L)});for(l=0;l<A-1;l++){var k=g[l];var w=[];var y=Infinity;var C="";for(q=l+1;q<A;q++){var D=g[q];D=k.getFullYear()!==
D.getFullYear()&&"year"||k.getMonth()!==D.getMonth()&&"month"||k.getDate()!==D.getDate()&&"day"||k.getHours()!==D.getHours()&&"hour"||k.getMinutes()!==D.getMinutes()&&"minute"||k.getSeconds()!==D.getSeconds()&&"second"||"millisecond";var G=f[D];G<y&&(y=G,C=D);w.push(D)}if(y<u){u=y;var H=C}}return H},createUniqueValueLabel:function(g){var l=g.value,q=g.fieldInfo,A=g.domain;g=g.dateFormatInterval;var u=String(l);(A=A&&A.codedValues?A.getName(l):null)?u=A:"number"===typeof l&&(u=q&&"esriFieldTypeDate"===
q.type?e.formatDate(l,g&&b[g]):v.format(l));return u},cloneColorInfo:function(g){if(g){var l=F.mixin({},g);l.colors=h(l.colors);l.stops=l.stops&&r.map(l.stops,function(q){q=F.mixin({},q);q.color&&(q.color=new t(q.color));return q});l.legendOptions&&(l.legendOptions=F.mixin({},l.legendOptions))}return l},cloneOpacityInfo:function(g){if(g){var l=F.mixin({},g);if(g=l.opacityValues)l.opacityValues=g.slice(0);if(g=l.stops)l.stops=r.map(g,function(q){return F.mixin({},q)});if(g=l.legendOptions)l.legendOptions=
F.mixin({},g)}return l},cloneSizeInfo:function(g){if(g){var l=F.mixin({},g);l.stops&&(l.stops=r.map(l.stops,function(q){return F.mixin({},q)}));(g=l.minSize)&&"object"===typeof g&&(l.minSize=e.cloneSizeInfo(g));(g=l.maxSize)&&"object"===typeof g&&(l.maxSize=e.cloneSizeInfo(g));if(g=l.legendOptions)if(l.legendOptions=F.mixin({},g),g=g.customValues)l.legendOptions.customValues=g.slice(0)}return l},getClassCodesForRelationship:function(){return F.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2","H"]})},
getClassValuesForRelationship:function(){return F.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});z("extend-esri")&&F.setObject("renderer.utils",e,n);return e})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define("dojo/_base/declare dojo/_base/array dojo/Deferred esri/lang jimu/utils ./LayerInfo".split(" "),function(F,r,z,x,n,v){return F(v,
{constructor:function(){},_getExtent:function(){var t=new z,m=this.layerObject.items,h=this.layerObject.fullExtent||this.layerObject.initialExtent;0===m.length?t.resolve(h):t.resolve(n.graphicsExtent(m));return t},_resetLayerObjectVisiblity:function(t){var m=t?t[this.id]:null;if(m){var h={},p;for(p in t)t.hasOwnProperty(p)&&"function"!==typeof t[p]&&(h[p]=t[p].visible);this._setSubLayerVisibleByCheckedInfo(h);this._setTopLayerVisible(m.visible)}},_setSubLayerVisibleByCheckedInfo:function(t){r.forEach(this.newSubLayers,
function(m){x.isDefined(t[m.id])&&m.layerObject.setVisibility(t[m.id])},this)},_initVisible:function(){var t=!1,m;for(m=0;m<this.newSubLayers.length;m++)t=t||this.newSubLayers[m].layerObject.visible;t&&(this._visible=!0)},_setTopLayerVisible:function(t){this._visible=t?!0:!1;r.forEach(this.newSubLayers,function(m){m.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var t=[],m=this.layerObject.getFeatureLayers();r.forEach(m,function(h){h=this._layerInfoFactory.create({layerObject:h,
title:h.label||h.title||h.name||h.id||" ",id:h.id||" ",subId:h.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});t.push(h);h.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(m);return t},_markInvalidSubLayerInfoThatAsRootLayer:function(t){var m;r.forEach(t,function(h){if(m=this._getLayerInfosObj()._findTopLayerInfoById(h.id))m._flag._invalid=!0},this)},_needToRenew:function(){var t=this.layerObject.getFeatureLayers();return(t?t.length:0)===this.newSubLayers.length?
!1:!0},_obtainLayerIndexesInMap:function(){var t=[],m,h;for(h=0;h<this.newSubLayers.length;h++)(m=this._getLayerIndexesInMapByLayerId(this.newSubLayers[h].layerObject.id))&&t.push(m);return t},moveLeftOfIndex:function(t){var m;for(m=this.newSubLayers.length-1;0<=m;m--)this.map.reorderLayer(this.newSubLayers[m].layerObject,t)},moveRightOfIndex:function(t){var m;for(m=0;m<this.newSubLayers.length;m++)this.map.reorderLayer(this.newSubLayers[m].layerObject,t)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e){return F(m,{constructor:function(c,f){},_getExtent:function(){var c=new n;c.resolve(this.layerObject.extent||this.layerObject.fullExtent);return c},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(c){this._visible=c;this.layerObject.setVisibility(c)},_setSubLayerVisible:function(c){var f=[];f=z.clone(this.originOperLayer.layerObject.visibleLayers);for(var b in c)if(c.hasOwnProperty(b)&&"function"!==typeof c[b]){var d=c[b],
a=b.toString();var g=r.indexOf(f,a);d?0>g&&f.push(a):0<=g&&f.splice(g,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(f)},_resetLayerObjectVisiblity:function(c){var f=c?c[this.id]:null,b=!1;if(c){f&&this.layerObject.setVisibility(f.visible);f={};for(var d in c)c.hasOwnProperty(d)&&"function"!==typeof c[d]&&(b=!0,f[d]=c[d].visible);b&&this._setSubLayerVisibleByCheckedInfo(f)}},_setSubLayerVisibleByCheckedInfo:function(c){var f={};this.traversal(function(b){b.isRootLayer()||
e.isDefined(c[b.id])&&b._setVisible(c[b.id])});this.traversal(function(b){0===b.getSubLayers().length&&(f[b.subId]=b._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(f)},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_serviceDefinitionRequest:function(c){return this._normalRequest(c,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var c=[];r.forEach(this.layerObject.layerInfos,function(f,
b){f=this._getOperLayerFromWMSLayerInfo(f,this);f=this._layerInfoFactory.create(f);c.push(f);f.init()},this);c.reverse();return c},_getOperLayerFromWMSLayerInfo:function(c,f){return{layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:this.id+"_"+(c.name||c.title+"-"+Math.random()),subId:c.name||"-",wms:{layerInfo:this,subId:c.name||"-",wmsLayerInfo:c},selfType:"wms",parentLayerInfo:f}},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&t.after(this.layerObject,
"setVisibleLayers",z.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var c=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(f){f.isRootLayer()||f._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(f){f.isRootLayer()||c.push(f)});this._setVisibleLayersBySelfFlag=!1;x.publish("layerInfos/layerInfo/visibleChanged",c);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/Deferred dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(F,r,z,x,n,v,t){return F(t,{constructor:function(m,h){this.layerObject=m.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var m=!1;this.traversal(function(h){if(0<=r.indexOf(h.layerObject.visibleLayers,h.subId))return m=!0});this._visible=m},_setVisible:function(m){this._visible=m?!0:!1},_setTopLayerVisible:function(m){var h=this.originOperLayer.wms;this._visible=m?!0:!1;var p={};this.traversal(function(e){0===e.getSubLayers().length&&(p[e.subId]=e._isAllSubLayerVisibleOnPath())});
h.layerInfo._setSubLayerVisible(p)},_getServiceDefinition:function(){var m=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(m)},_serviceDefinitionRequest:function(m){return this._normalRequest(m,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var m=[],h=this.originOperLayer.wms;r.forEach(h.wmsLayerInfo.subLayers,function(p){p=h.layerInfo._getOperLayerFromWMSLayerInfo(p,this);p=this._layerInfoFactory.create(p);m.push(p);p.init()},this);
return m},drawLegends:function(m){this._initLegendsNode(m)},_initLegendsNode:function(m){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var h=n.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});v(h,"load",function(){n.empty(m);var p=n.create("div",{"class":"legend-div"},m);z.place(h,p)})}else n.empty(m)},getOpacity:function(){},setOpacity:function(m){},enablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=!0},disablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=
!1},isPopupEnabled:function(){return this.originOperLayer.wms.wmsLayerInfo.showPopup},isSupportPopup:function(){var m=new x;this.originOperLayer.wms.wmsLayerInfo.queryable?m.resolve(!0):m.resolve(!1);return m},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(F,r){return F(r,
{constructor:function(z,x){},_initVisible:function(){var z=!1,x=this.originOperLayer.mapService;x&&x.layerInfo._subLayerVisible[x.subId]&&(z=!0);this._visible=z},_setTopLayerVisible:function(z){var x=this.originOperLayer.mapService;if(x){x.layerInfo._subLayerVisible[x.subId]=z?!0:!1;this._visible=z;var n={};this.traversal(function(v){0===v.getSubLayers().length&&(n[v.originOperLayer.mapService.subId]=v._isAllSubLayerVisibleOnPath())});x.layerInfo._setSubLayerVisible(n)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/topic dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory ../utils".split(" "),
function(F,r,z,x,n,v,t,m,h){return F(t,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new m(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(p){var e=new x;this.originOperLayer.mapService.layerInfo.getLegendInfo(p).then(z.hitch(this,function(c){e.resolve(c)}));return e},drawLegends:function(p,e){this._loadLegends(e).then(z.hitch(this,function(c){this._initLegendsNode(c,p)}))},_initLegendsNode:function(p,e){var c=this.originOperLayer.mapService;
if(p){v.empty(e);for(var f=null,b=0;b<p.length;b++)if(p[b].layerId===c.subId){f=p[b];break}if(f){var d=v.create("table",{"class":"legend-table",style:"font-size: 12px"},e);r.forEach(f.legend,function(a){if("\x3call other values\x3e"!==a.label){var g=v.create("tr",{"class":"legend-tr",style:"border: 1px solid"},d),l=v.create("td",{"class":"legend-symbol-td",style:""},g),q=null;q=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;v.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:q},l);v.create("td",{"class":"legend-label-td",innerHTML:h.sanitizeHTML(a.label)||" ",style:"padding-left: 5px"},g)}},this)}}},_initControlPopup:function(){var p=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:p.infoTemplates&&p.infoTemplates[e]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var p=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
p.infoTemplates&&delete p.infoTemplates[e]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(p){var e=new x;(p?this._layerObjectFacory.getLayerObjectWithUrl(p):this._layerObjectFacory.getLayerObject()).then(z.hitch(this,
function(c){this.layerObject.empty&&c&&(this.layerObject=c);e.resolve(c)}));return e},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var p;return this.isItemLayer()?this.getItemInfo().then(z.hitch(this,function(e){e&&e.getItemData()&&e.getItemData().layers&&r.some(e.getItemData().layers,function(c){if(c.id===this.subId)return p=c.layerUrl,!0},this);return p?this._getLayerObject(p):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var p=
null,e=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(e)for(var c=0;c<e.length;c++)if(e[c].id===this.originOperLayer.mapService.subId){p=e[c].popupInfo;break}return p},getFilterOfWebmap:function(){var p=null,e=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(e)for(var c=0;c<e.length;c++)if(e[c].id===this.originOperLayer.mapService.subId){p=e[c].layerDefinition?e[c].layerDefinition.definitionExpression:null;break}return p},getFilter:function(){var p=this.originOperLayer.mapService;
return p.layerInfo.layerObject&&p.layerInfo.layerObject.layerDefinitions?p.layerInfo.layerObject.layerDefinitions[p.subId]:null},setFilter:function(p,e){var c=this.originOperLayer.mapService;if(c.layerInfo.layerObject&&c.layerInfo.layerObject.setLayerDefinitions){var f=c.layerInfo.layerObject.layerDefinitions?r.map(c.layerInfo.layerObject.layerDefinitions,function(b){return b}):[];e=z.mixin({},e);z.setObject("_wabProperties.objectPassWithFilterChangeEvent",e,c.layerInfo.layerObject);f[c.subId]=p;
c.layerInfo.layerObject.setLayerDefinitions(f)}},getLayerType:function(){var p=new x;0<this.getSubLayers().length?p.resolve("GroupLayer"):this._getServiceDefinition().then(z.hitch(this,function(e){e?p.resolve(e.type.replace(/ /g,"")):p.resolve(null)}),function(){p.resolve(null)});return p},getSupportTableInfo:function(){var p=new x,e={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(z.hitch(this,function(c){e.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&
(e.isSupportedLayer=!0);this._getServiceDefinition().then(z.hitch(this,function(f){f&&f.capabilities&&0<=f.capabilities.indexOf("Data")&&(e.isSupportQuery=!0);p.resolve(e)}),function(){p.resolve(e)})}),function(){p.resolve(e)});return p},enablePopup:function(){var p=this.originOperLayer.mapService.layerInfo,e=p.layerObject,c=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(z.hitch(this,function(){return p.controlPopupInfo.infoTemplates&&p.controlPopupInfo.infoTemplates[c]?
(this.controlPopupInfo.enablePopup=!0,e.infoTemplates||(e.infoTemplates={}),e.infoTemplates[c]=p.controlPopupInfo.infoTemplates[c],!0):!1}))},disablePopup:function(){var p=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;p.infoTemplates&&delete p.infoTemplates[e]},loadInfoTemplate:function(){var p=new x,e=this.originOperLayer.mapService.layerInfo,c=this.originOperLayer.mapService.subId;e.controlPopupInfo.infoTemplates&&
e.controlPopupInfo.infoTemplates[c]&&e.controlPopupInfo.infoTemplates[c].infoTemplate?p.resolve(e.controlPopupInfo.infoTemplates[c].infoTemplate):(e.controlPopupInfo.infoTemplates||(e.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(z.hitch(this,function(f){f=this._getDefaultPopupTemplate(f);e.controlPopupInfo.infoTemplates[c]={infoTemplate:f,layerUrl:null};p.resolve(f)}),z.hitch(this,function(){p.resolve(null)})));return p},getInfoTemplate:function(){var p=this.originOperLayer.mapService.layerInfo,
e=this.originOperLayer.mapService.subId;return p.controlPopupInfo.infoTemplates&&p.controlPopupInfo.infoTemplates[e]&&p.controlPopupInfo.infoTemplates[e].infoTemplate?p.controlPopupInfo.infoTemplates[e].infoTemplate:null},getScaleRange:function(){var p=this.originOperLayer.mapService;return(p=p.layerInfo._getJsapiLayerInfoById(p.subId))&&0<=p.minScale&&0<=p.maxScale?{minScale:p.minScale,maxScale:p.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(p,e){var c=this.originOperLayer.mapService,
f=c.layerInfo._getJsapiLayerInfoById(c.subId);c.layerInfo.layerObject&&c.layerInfo.layerObject.supportsDynamicLayers&&c.layerInfo.layerObject.setDynamicLayerInfos&&f&&(f.minScale!==p||f.maxScale!==e)&&(f.minScale=p,f.maxScale=e,c.layerInfo.layerObject.setDynamicLayerInfos(c.layerInfo._jsapiLayerInfos),n.publish("layerInfos/layerInfo/scaleRangeChanged",[this]))},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return F(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(e){this._layerInfo=e;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new n(r.hitch(this,this._getLayerObject))},getLayerObject:function(){var e=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(e)},getLayerObjectWithUrl:function(e){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(e)},
_getLayerObject:function(e){var c,f=new x;this._layerInfo.getLayerType().then(r.hitch(this,function(b){var d=r.mixin(this._getLayerOptionsForCreateLayerObject(),this._layerInfo.originOperLayer.options||{})||{};switch(b){case "FeatureLayer":c=new v(e,d);break;case "RasterLayer":c=new t(e);break;case "StreamLayer":c=new m(e);break;case "ArcGISImageServiceLayer":c=new h(e);break;case "ArcGISImageServiceVectorLayer":c=new p(e);break;case "Table":if(this._layerInfo.layerObject&&!this._layerInfo.layerObject.empty)return this._setLayerObjectProperties(this._layerInfo.layerObject),
f.resolve(this._layerInfo.layerObject),f;if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)c=new v(e,d);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(c=new v(this._layerInfo.layerObject.featureCollectionData,d),this._setLayerObjectProperties(c),f.resolve(c)):f.resolve(null),f;break;case "GroupLayer":return f=this._getGroupLayerObject();default:return f.resolve(null),f}var a=c.on("load",r.hitch(this,function(){this._setLayerObjectProperties(c);
f.resolve(c);a.remove&&a.remove()})),g=c.on("error",r.hitch(this,function(l){f.reject(l);g.remove&&g.remove()}))}),r.hitch(this,function(){f.reject()}));return f},_getGroupLayerObject:function(){var e=new x;this._layerInfo._getServiceDefinition().then(r.hitch(this,function(c){if(null===c)e.reject();else{var f=this._layerInfo.getUrl();c.url=f;c.id=this._layerInfo.id;e.resolve(c)}}));return e},_getLayerOptionsForCreateLayerObject:function(){var e={},c=[],f=this._layerInfo.getInfoTemplate();f&&f.info&&
f.info.fieldInfos?z.forEach(f.info.fieldInfos,function(b){b.visible&&c.push(b.fieldName)},this):c=["*"];e.outFields=c;return e},_setLayerObjectProperties:function(e){e.name&&!r.getObject("_wabProperties.originalLayerName",!1,e)&&(r.setObject("_wabProperties.originalLayerName",e.name,e),e.name=this._layerInfo.title);e.id=this._layerInfo.id;this._layerInfo.loadInfoTemplate().then(r.hitch(this,function(c){e.infoTemplate=c}))}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../kernel ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a){F=F([c,f],{declaredClass:"esri.layers.RasterLayer",constructor:function(g,l){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var g;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){var l=[];for(g=0;g<this.minValues.length;g++)l.push([this.minValues[g],this.maxValues[g],this.meanValues[g],this.stdvValues[g]]);this.bandCount!==l.length&&(l=null)}g=0;var q=!1;"U8"===this.pixelType?(g=5,q=l?!1:!0):l?(g=5,q=!1):(g=6,q=!0);this.renderingRule&&(g=5,q=!0);this.pixelFilter=(new b({stretchType:g,min:0,max:255,dra:q,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:l,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}});n("extend-esri")&&r.setObject("layers.RasterLayer",F,h);return F})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){var d=p.defaults.map.zoomDuration;return F([b],
{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(a,g){this.drawMode=g&&void 0!==g.drawMode?g.drawMode:!0;this.drawType=g&&g.drawType?g.drawType:"2d";this.pixelData=null;this._initialize(a,g)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>n("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));
else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;t.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))}this._displayTimer=
this._displayTimer||setTimeout(r.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new f((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,
g){this.pixelFilter=a;g||this.redraw()},_toggleTime:function(){},_setMap:function(a,g){this.inherited(arguments);this._dragOrigin={x:0,y:0};var l=this._div=v.create("div",null,g),q={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(q[h._css.names.transform]=h._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;t.set(l,q);this._canvas=v.create("canvas",{id:"canvas",width:a.width+
"px",height:a.height+"px",style:"position: absolute;"},l);e.isDefined(this.opacity)&&t.set(l,"opacity",this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(z.connect(a,"onPan",this,this._panHandler));this._connects.push(z.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?
this._connects.push(z.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(z.connect(a,"onZoom",this,this._onZoomHandler)),this._connects.push(z.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(z.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(z.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(z.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(z.connect(this,"onOpacityChange",
this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var A=z.connect(a,"onLoad",this,function(){z.disconnect(A);A=null;this.evaluateSuspension()});return l},_unsetMap:function(a,g){x.forEach(this._connects,z.disconnect,this);var l=this._div;l&&(g.removeChild(l),v.destroy(l));this.updating&&a._jobs&&a._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=
this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,t.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),t.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){a=this.pixelData.pixelBlock;var g=this._context,l=g.createImageData(a.width,a.height);l.data.set(a.getAsRGBA());var q=this.pixelData.extent,
A=this._map.extent,u=this.getCurrentResolution(),k=0,w=0;Math.abs(q.xmin-A.xmin)>u.x&&(k=Math.round((q.xmin-A.xmin)/u.x));Math.abs(A.ymax-q.ymax)>u.y&&(w=Math.round((A.ymax-q.ymax)/u.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,t.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),t.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top))):(t.set(this._div,{left:"0px",top:"0px",
width:this._map.width+"px",height:this._map.height+"px"}),t.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};g.putImageData(l,k,w,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(a,g){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+g.x,this._top=this._map.__visibleDelta.y+g.y,t.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))):
t.set(this._div,{left:this._startRect.left+g.x+"px",top:this._startRect.top+g.y+"px"})},_panEndHandler:function(a,g){g&&(this._startRect.left+=g.x,this._startRect.top+=g.y)},_onScaleHandler:function(a,g){var l={},q=h._css.names;t.set(this._canvas,q.transition,g?"none":q.transformName+" "+d+"ms ease");this._matrix=a;a=this._multiply?m.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=m.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});l[q.transform]=h._css.matrix(a);t.set(this._canvas,
l)},_onZoomHandler:function(a,g,l){var q=this._startRect;a=q.width*g;g*=q.height;var A=q.left-(a-q.width)*(l.x-q.left)/q.width;l=q.top-(g-q.height)*(l.y-q.top)/q.height;t.set(this._canvas,{left:A+"px",top:l+"px",width:a+"px",height:g+"px"});this._endRect={left:A,top:l,width:a,height:g}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,g,l){t.set(this._div,{width:g+"px",height:l+"px"});t.set(this._canvas,{width:g+"px",height:l+"px"});this._startRect.width=
this._canvas.width=g;this._startRect.height=this._canvas.height=l},_extentChangeHandler:function(a,g,l,q){this.suspended||g&&0===g.x&&0===g.y&&!l||("css-transforms"===this._map.navigationMode&&(g&&(this._dragOrigin.x+=g.x,this._dragOrigin.y+=g.y),l||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,t.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))),l&&(t.set(this._canvas,h._css.names.transition,"none"),this._multiply=this._multiply?m.multiply(this._matrix,
this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(a){a?c.show(this._div):c.hide(this._div)},_opacityChangeHandler:function(a){t.set(this._div,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C,D,G,H,L,T,K,O){F=F(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(I,P){this.useMapTime=P&&P.hasOwnProperty("useMapTime")?!!P.useMapTime:!0},_initialize:function(I,P){this._url=a.urlToObject(I);this.raster=new y(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=P&&P.infoTemplate;this.format=(I=P&&P.imageServiceParameters)&&I.format;this.compressionTolerance=I&&I.compressionTolerance?
I.compressionTolerance:.01;this.interpolation=I?I.interpolation:null;this.compressionQuality=I?I.compressionQuality:null;this.bandIds=I?I.bandIds:null;this.mosaicRule=I?I.mosaicRule:null;this.renderingRule=I?I.renderingRule:null;this.renderer=I?I.renderer:null;this.useMapDimensionValue=P&&P.hasOwnProperty("useMapDimensionValue")?!!P.useMapDimensionValue:!0;this.hasImageFilter=P&&P.hasImageFilter;this.activeMapDimensions=P&&P.activeMapDimensions;this._params=r.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},I?I.toJson():{});this.pixelFilter=P&&P.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=r.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=r.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=r.hitch(this,this._initLayer);this._queryVisibleRastersHandler=r.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=P&&P.loadCallback;I&&I.renderer&&(I.renderer.outputUnit||I.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new D,this.vectorFieldPixelFilter.setUnits(I.renderer.inputUnit,I.renderer.outputUnit));(P=P&&P.resourceInfo)?this._initLayer(P):b({url:this._url.path,content:r.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(I,P){if(null!==I&&void 0!==I){this._findCredential();(this.credential&&this.credential.ssl||I&&I._ssl)&&this._useSSL();P=this.minScale;var Q=this.maxScale;r.mixin(this,I);this.minScale=P;this.maxScale=Q;this.initialExtent=this.fullExtent=this.extent=new g(I.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=
parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var U=this.minValues,Y=this.maxValues,ca=this.meanValues,da=this.stdvValues,ma=this.bands=[];P=0;for(Q=this.bandCount;P<Q;P++)ma[P]={min:U[P],max:Y[P],mean:ca[P],stddev:da[P]};this.timeInfo=(P=this.timeInfo)&&P.timeExtent?new H(P):null;Q=this.fields=[];if(U=I.fields)for(P=0;P<U.length;P++)Q.push(new L(U[P]));this._updateInfoTemplateFields(this.fields);this.version=I.currentVersion;this.version||(this.version="fields"in I||"objectIdField"in
I||"timeInfo"in I?10:9.3);f.isDefined(I.minScale)&&!this._hasMin&&"Raster"!==I.cacheType&&this.setMinScale(I.minScale);f.isDefined(I.maxScale)&&!this._hasMax&&"Raster"!==I.cacheType&&this.setMaxScale(I.maxScale);P={};I.defaultMosaicMethod?(P.method=I.defaultMosaicMethod,P.operation=I.mosaicOperator,P.sortField=I.sortField,P.sortValue=I.sortValue):P.method=u.METHOD_NONE;this.defaultMosaicRule=new u(P);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===
this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(r.hitch(this,function(na){na&&(na.features&&na.fields&&(this.rasterAttributeTable=r.clone(na)),na.features&&0<na.features.length&&(this._rasterAttributeTableFeatures=
r.clone(na.features)),na.fields&&0<na.fields.length&&(this._rasterAttributeTableFields=r.clone(na.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==this.declaredClass||this.setBandIds([0,0,0],!0);10.3<=this.version&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length&&this.getRasterFunctionInfos().then(r.hitch(this,function(na){if(na&&na.length){this.rasterFunctionInfos=na;var va=[],ja;x.forEach(na,function(pa){if(pa){var la=pa.functionType;ja=ja||1===la||2===la;va.push(pa.name)}},this);this._hasItemLevelRFT=ja;this._rasterFunctionNames=va;ja&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(I=this._loadCallback)delete this._loadCallback,I(this)}},_updateInfoTemplateFields:function(I){if(I&&
!(1>I.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var P,Q;var U=this.infoTemplate.info.fieldInfos;for(P=0;P<I.length;P++){var Y=I[P];for(Q=0;Q<U.length;Q++)if(U[Q].fieldName.toLowerCase()===Y.name.toLowerCase()&&U[Q].fieldName!==Y.name){U[Q].fieldName=Y.name;break}}}},getKeyProperties:function(I){var P=this._url.path+"/keyProperties",Q=new z(d._dfdCanceller),U={f:"json"};I&&I.renderingRule&&(U.renderingRule=
n.toJson(I.renderingRule.toJson()));10<this.version?(Q._pendingDfd=b({url:P,content:U,handleAs:"json",callbackParamName:"callback"}),Q._pendingDfd.then(function(Y){Q.callback(Y)},function(Y){Q.errback(Y)})):(I=Error("Layer does not have key properties"),I.log=!!v.isDebug,Q.errback(I));return Q},getRasterAttributeTable:function(I){var P=this._url.path+"/rasterAttributeTable",Q=new z(d._dfdCanceller),U={f:"json"},Y=this.hasRasterAttributeTable;I&&I.renderingRule&&(U.renderingRule=n.toJson(I.renderingRule.toJson()),
Y=!0);!this.loaded||10<this.version&&Y?(Q._pendingDfd=b({url:P,content:U,handleAs:"json",callbackParamName:"callback"}),Q._pendingDfd.then(function(ca){Q.callback(ca)},function(ca){Q.errback(ca)})):(I=Error("Layer does not support raster attribute table"),I.log=!!v.isDebug,Q.errback(I));return Q},getRenderingRuleAttributeTable:function(I){var P=new z(d._dfdCanceller);if(!I||!I.renderingRule)return P.errback(Error("Rendering rule is not specified")),P;I=I.renderingRule;var Q=this._getRenderingRuleId(I);
this._renderingRuleAttributeTable&&Q&&this._renderingRuleAttributeTable.hasOwnProperty(Q)?P.resolve(this._renderingRuleAttributeTable[Q]):P=this.getRasterAttributeTable({renderingRule:I}).then(r.hitch(this,function(U){if(U&&U.features&&U.features.length&&U.fields&&U.fields.length){var Y={features:r.clone(U.features),fields:r.clone(U.fields)};Q&&(this._renderingRuleAttributeTable[Q]=Y)}return Y}));return P},_initVectorPixelFilter:function(){var I;this._hasItemLevelRFT&&this.renderingRule&&(I=this._getItemLevelRenderingRule(this.renderingRule));
if(I=I||this.renderingRule)return this.getRenderingRuleServiceInfo(I).then(r.hitch(this,function(P){!P||!this._isVectorData(P)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||f.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new D,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===P.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(r.hitch(this,this._setFlowRepresentation)),
this._applyVectorResamplingType(P.serviceDataType))}))},_applyVectorResamplingType:function(I){if(I){var P=this.renderingRule;P&&"Resample"===P.functionName&&((P.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===I?7:10,this.setRenderingRule(new k(P.toJson())))}},_getRasterAttributeTableFeatures:function(){var I=new z;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return I.resolve(this._rasterAttributeTableFeatures),I;if(10<this.version&&
this.hasRasterAttributeTable)return I=this.getRasterAttributeTable(),I.then(r.hitch(this,function(P){P&&P.features&&0<P.features.length&&(this._rasterAttributeTableFeatures=r.clone(P.features))})),I;I.resolve(this._rasterAttributeTableFeatures);return I},_getRenderingRuleAttributeTableFeatures:function(I){I=I&&I.renderingRule;return I?this.getRenderingRuleAttributeTable({renderingRule:I}).then(function(P){return P&&P.features}):(I=new z,I.errback(Error("Rendering rule is not specified")),I)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&
this.getRenderingRuleServiceInfo(this.renderingRule).then(r.hitch(this,function(I){I.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(r.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));I.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(r.hitch(this,function(){this.renderer&&
"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(I){var P=I?I.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;I=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var Q={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:I},U={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:I},Y={name:this._rasterFieldPrefix+
"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},ca=this.fields?r.clone(this.fields):[];I=ca.length;ca[I]=U;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(I++,ca[I]=Y);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)I++,
ca[I]=Q;!f.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(Q={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},U={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},I++,ca[I]=Q,I++,ca[I]=U);I=this._rasterAttributeTableFields;(Q=this.renderingRule&&this._getRenderingRuleId(this.renderingRule))&&
this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(Q)&&(I=this._renderingRuleAttributeTable[Q].fields);I&&0<I.length&&(I=x.filter(I,function(ma){return"esriFieldTypeOID"!==ma.type&&"value"!==ma.name.toLowerCase()}),I=x.map(I,function(ma){var na=r.clone(ma);na.name=P+ma.name;return na}),ca=ca.concat(I));var da=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&x.forEach(this.rasterFunctionInfos,function(ma){ma&&ma.name&&
"none"!==ma.name.toLowerCase()&&(ma={name:da+ma.name.replace(/ /gi,"_"),alias:ma.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},ca.push(ma))});return ca},_applyTimeToMultidimensionalCRF:function(I,P){var Q=this._isTimeSupportedOnCRF();if(Q&&(!I||!I.multidimensionalDefinition))return I;var U=this.timeInfo&&this.timeInfo.startTimeField;if((P=P||this._params.time)&&U&&this._isMultidimensionalCRF()){I=r.clone(I||this.defaultMosaicRule)||new u;I.multidimensionalDefinition=I.multidimensionalDefinition||
[];var Y=I.multidimensionalDefinition.filter(function(da){return da.dimensionName===U}),ca=P.split(",").map(function(da){return parseInt(da,10)});2===ca.length&&ca[0]===ca[1]&&(ca.length=1);0<Y.length?Q?I.multidimensionalDefinition.forEach(function(da){da.dimensionName===U&&(da.dimensionName=null,da.isSlice=null,da.values=null)}):I.multidimensionalDefinition.forEach(function(da){da.dimensionName===U&&(da.isSlice=1===ca.length,da.values=1===ca.length?ca:[ca])}):Q||(I.multidimensionalDefinition.some(function(da){return null!=
da.variableName&&null==da.dimensionName})?I.multidimensionalDefinition.forEach(function(da){null!=da.variableName&&null==da.dimensionName&&(da.dimensionName=U,da.isSlice=1===ca.length,da.values=1===ca.length?ca:[ca])}):I.multidimensionalDefinition.push(new w({variableName:"",dimensionName:U,isSlice:1===ca.length,values:1===ca.length?ca:[ca]})));this._cleanupMultidimensionalDefinition(I)}return I},_prepareGetImageParameters:function(I,P,Q,U){U=f.isDefined(U)?U:this._params;if(this.renderer||this._hasItemLevelRFT&&
this.renderingRule){var Y=this.getExportImageRenderingRule();U.renderingRule=Y?n.toJson(Y.toJson()):null}Y=this.getExportImageMosaicRule(U);U.mosaicRule=Y?n.toJson(Y.toJson()):null;Y=I.spatialReference.wkid||n.toJson(I.spatialReference.toJson(!1));delete U._ts;r.mixin(U,{bbox:I.xmin+","+I.ymin+","+I.xmax+","+I.ymax,imageSR:Y,bboxSR:Y,size:P+","+Q},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete U.compressionTolerance;U.format&&"LERC"===U.format.toUpperCase()&&(U.compressionTolerance=
this.compressionTolerance);U.token=this._getToken()},getImageUrl:function(I,P,Q,U,Y){Y=f.isDefined(Y)?Y:this._params;this._prepareGetImageParameters(I,P,Q,Y);I=r.clone(Y);this._cleanupRequestParams(I);P=this._url.path+"/exportImage?";Q=a.addProxy(P+h.objectToQuery(r.mixin(I,{f:"image"})));var ca=I.token;Q.length>c.defaults.io.postLength||this.useMapImage?this._jsonRequest=b({url:P,content:r.mixin(I,{f:"json"}),callbackParamName:"callback",load:function(da,ma){da=da.href;ca&&(da+=-1===da.indexOf("?")?
"?token\x3d"+ca:"\x26token\x3d"+ca);U(a.addProxy(da))},error:this._errorHandler}):U(Q)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(I,P){this.interpolation=this._params.interpolation=I;P||this.refresh(!0)},setCompressionQuality:function(I,P){this.compressionQuality=this._params.compressionQuality=I;P||this.refresh(!0)},setCompressionTolerance:function(I,P){this.compressionTolerance=I;P||this.refresh(!0)},setBandIds:function(I,
P){var Q=!1;this.bandIds!==I&&(Q=!0);this.bandIds=I;this._params.bandIds=I.join(",");if(Q&&!P)this.onRenderingChange();P||this.refresh(!0)},setDefaultBandIds:function(I){this.bandIds=this._params.bandIds=null;I||this.refresh(!0)},setDisableClientCaching:function(I){this.disableClientCaching=I},setMosaicRule:function(I,P){var Q=!1;this.mosaicRule!==I&&(Q=!0);this.mosaicRule=I;this._params.mosaicRule=n.toJson(I.toJson());if(Q&&!P)this.onMosaicRuleChange();P||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>
this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return b({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(I){return I&&I.rasterFunctionInfos}})},setRenderingRule:function(I,P){var Q=!1;this.renderingRule!==I&&(Q=!0);this.renderingRule=I;this._params.renderingRule=I?n.toJson(I.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:I}):
"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(Q)this.onRenderingChange();this._setDefaultFilter();P||this.refresh(!0)},setImageFormat:function(I,P){this.format=this._params.format=I;this._setDefaultFilter();P||this.refresh(!0)},setInfoTemplate:function(I){this.infoTemplate=I;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(I,P){var Q=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?
Q=this.defaultMosaicRule.toJson():Q.method=u.METHOD_NONE);Q.where=I;I=new u(Q);this.setMosaicRule(I,P);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(I){this.pixelFilter=I;this._isDefaultPixelFilter=!1},getPixelData:function(I){return I?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):
this.pixelData},getExportImageRenderingRule:function(){var I;this._hasItemLevelRFT&&this.renderingRule&&(I=this._getServiceLevelRenderingRule(this.renderingRule));I=I||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(I=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),I)},getExportImageMosaicRule:function(){var I=this.mosaicRule,P;this._hasItemLevelRFT&&this.renderingRule&&(P=this._getItemLevelRenderingRule(this.renderingRule));P&&
(I=I||this.defaultMosaicRule||new u,I.itemRenderingRule=P);return I=this._applyTimeToMultidimensionalCRF(I)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(I){var P=new z(d._dfdCanceller);if(I&&this._cachedVariableHistogram[I])return P.resolve(this._cachedVariableHistogram[I]),P;if(this.hasHistograms){var Q={f:"json"};I&&(Q.variable=I);P._pendingDfd=b({url:this._url.path+"/histograms",content:Q,handleAs:"json",callbackParamName:"callback"});
P._pendingDfd.then(r.hitch(this,function(U){I&&(this._cachedVariableHistogram[I]=U);P.callback(U)}),function(U){P.errback(U)})}else Q=Error("Layer does not have histograms."),Q.log=!!v.isDebug,P.errback(Q);return P},computeHistograms:function(I){var P=new z(d._dfdCanceller);if(10.1<=this.currentVersion){I=I||{};var Q=I.geometry||this.fullExtent,U=(I.geometry||this.fullExtent).toJson();Q="extent"===Q.type?"esriGeometryEnvelope":"esriGeometryPolygon";var Y=I.renderingRule||this.renderingRule||this.defaultRenderingRule;
Y=Y?Y.toJson():null;var ca=I.mosaicRule||this.mosaicRule||this.defaultMosaicRule;ca=ca?ca.toJson():null;I=I.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};P._pendingDfd=b({url:this._url.path+"/computeHistograms",content:r.mixin({f:"json",geometry:JSON.stringify(U),geometryType:Q,renderingRule:JSON.stringify(Y),mosaicRule:JSON.stringify(ca),pixelSize:JSON.stringify(I),callbackParamName:"callback"}),handleAs:"json"});P._pendingDfd.then(function(da){P.callback(da)},function(da){P.errback(da)})}else U=
Error("Layer doesn't support computeHistograms."),U.log=!!v.isDebug,P.errback(U);return P},getRenderingRuleServiceInfo:function(I,P){function Q(ca){return ca.name&&ca.arguments&&ca.function&&ca.hasOwnProperty("functionType")}var U=new d._fixDfd(new z(d._dfdCanceller));if(!I)return U.errback(Error("Rendering rule is not specified")),U;if(!Q(I)){var Y=this._getRenderingRuleId(I);if(Y&&this._rasterFunctionTemplateInfos[Y])return U.resolve(this._rasterFunctionTemplateInfos[Y]),U}return b({url:this._url.path,
content:r.mixin(r.mixin({f:"json",renderingRule:JSON.stringify(I.toJson())},this._url.query)),callbackParamName:"callback",load:r.hitch(this,function(ca){var da={};x.forEach(this._rasterFunctionServiceInfoProps,function(ma){da[ma]=ca[ma]});Q(I)||(this._rasterFunctionTemplateInfos[Y]=da);return da}),error:P||this._errorHandler})},queryVisibleRasters:function(I,P,Q,U){var Y=this._map,ca=d._fixDfd(new z(d._dfdCanceller));this._visibleRasters=[];var da,ma,na=!0,va=!0,ja=null,pa=this.infoTemplate?this.infoTemplate.info:
null,la=pa?r.clone(this.infoTemplate.info.fieldInfos):null;P=P||{};if(pa&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var ra=[];x.forEach(this.infoTemplate.info.mediaInfos,function(E){ra=ra.concat(E&&E.value&&E.value.fields||[])});ra.length&&x.forEach(la,function(E){E&&-1<ra.indexOf(E.fieldName)&&(E.visible=!0)})}if(la&&0<la.length)for(na=!1,da=0;da<la.length;da++)if((ma=la[da])&&ma.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&
(ma.visible||pa.title&&-1<pa.title.toLowerCase().indexOf(ma.fieldName.toLowerCase()))){na=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(ja=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);la&&0<la.length&&(va=!1,x.some(la,function(E){if(E&&E.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&E.visible)return va=!0},this));var X=(ma=this._removeVisualizationStretchFunction(this.renderingRule))&&
ma.functionName,ya=[];if(10.4<=this.version){var wa=!1;if(this.rasterFunctionInfos&&la){var M=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;x.forEach(this.rasterFunctionInfos,function(E){var J=M+E.name.replace(/ /gi,"_");x.some(la,function(N){return N.visible&&N.fieldName===J})&&(wa=wa||X&&X===E.name,ya.push(new k({rasterFunction:E.name})))})}ma&&!wa&&ya.push(ma)}da=new O;da.geometry=I.geometry;da.returnGeometry=this._map.spatialReference.equals(this.spatialReference);da.returnCatalogItems=
na;da.timeExtent=this.timeInfo?I.timeExtent:null;da.returnPixelValues=va;da.maxItemCount=ja||I.maxItemCount;this._params.time&&this.mosaicRule?(I=r.clone(this.mosaicRule),I=this._filterOutTimeDimension(I),da.mosaicRule=I):da.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&da.timeExtent&&(da.mosaicRule=this._applyTimeToMultidimensionalCRF(da.mosaicRule,da.timeExtent.toJson().join(",")),this._isTimeSupportedOnCRF()||delete da.timeExtent);da.renderingRule=10.4>this.version&&ma||null;
da.renderingRules=ya||null;10.8>this.version&&(da.returnPixelValues=void 0,da.maxItemCount=void 0);Y&&(Y=new l((Y.extent.xmax-Y.extent.xmin)/Y.width,(Y.extent.ymax-Y.extent.ymin)/Y.height,Y.extent.spatialReference),da.pixelSize=Y);P.requestParams=da;var B=this;Y=new K(this.url);(ca._pendingDfd=Y.execute(da)).addCallbacks(function(E){B._queryVisibleRastersHandler(E,P,Q,U,ca)},function(E){B._resolve([E],null,U,ca,!0)});return ca},_queryVisibleRastersHandler:function(I,P,Q,U,Y){function ca(){var ea=
this.getCustomRasterFields(P),qa=this._getDomainFields(ea),ka=P?P.returnDomainValues:!1,R=P&&P.rasterAttributeTableFieldPrefix,Z,W,ba,ha,ia,ta,oa,xa,sa,ua;ea=(ea=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[ea];this.renderingRule&&(this._useRenderingRuleAttributeTable||ea)?(ea=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),this.hasRasterAttributeTable||(ua=da)):ea=this._getRasterAttributeTableFeatures();ea.then(r.hitch(this,function(za){for(Z=
0;Z<E.length;Z++){aa=E[Z];aa.setInfoTemplate(this.infoTemplate);aa._layer=this;if(da){sa=da.replace(/ /gi,"").split(",");W=da;ba=sa;J&&J.length>=Z&&(W=J[Z].replace(/ /gi,", "),ba=J[Z].split(" "));aa.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=ba;aa.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=sa;ma&&(aa.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=ma.replace(/ /gi,"").split(","));if(this.pixelFilter){var Ba=new C({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});
x.forEach(ba,function(Ca){Ba.addData({pixels:[Ca],statistics:{minValue:Ca,maxValue:Ca,noDataValue:null}})});this.pixelFilter({pixelBlock:Ba,extent:new g(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)aa.attributes[this._rasterFieldPrefix+"Magnitude"]=Ba.pixels[0][0],aa.attributes[this._rasterFieldPrefix+"Direction"]=Ba.pixels[1][0]}x.forEach(la,function(Ca){aa.attributes[Ca.name]=Ca.value});
var Ea=0<this.fields.length?ua||W:ua||ma;if(za&&0<za.length&&(ha=x.filter(za,function(Ca){if(Ca&&Ca.attributes)return Ca.attributes.hasOwnProperty("Value")?Ca.attributes.Value==Ea:Ca.attributes.VALUE==Ea}),0<ha.length&&(ia=r.clone(ha[0]),R&&ia))){xa={};for(ta in ia.attributes)ia.attributes.hasOwnProperty(ta)&&(oa=R+ta,xa[oa]=ia.attributes[ta]);ia.attributes=xa;aa.attributes=r.mixin(aa.attributes,ia.attributes)}}ka&&qa&&0<qa.length&&x.forEach(qa,function(Ca){if(Ca){var Ha=aa.attributes[Ca.name];f.isDefined(Ha)&&
(Ha=this._getDomainValue(Ca.domain,Ha),f.isDefined(Ha)&&(aa.attributes[Ca.name]=Ha))}},this);fa.push(aa);this._visibleRasters.push(aa)}this._resolve([fa,null,!0],null,Q,Y)}))}var da=I.value,ma=I.value,na=0,va=0,ja=this,pa=this.objectIdField,la=[];U=P.requestParams.renderingRules;var ra=I.processedValues,X=this.renderingRule&&n.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(U&&ra&&U.length===ra.length){var ya=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;
x.forEach(U,function(ea,qa){if(ea.functionName){var ka={name:ya+ea.functionName.replace(/ /gi,"_"),value:ra[qa].replace(/ /gi,"").split(",")};la.push(ka);X&&X===n.toJson(ea.toJson())&&(da=ra[qa])}})}U=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(I.catalogItems){var wa=0,M=I.catalogItems.features.length;var B=0;var E=Array(M);var J=Array(M);
var N=Array(M);if(I.properties&&I.properties.Values){M=I.properties.Values.length;for(na=0;na<M;na++)-1<I.properties.Values[na].toLowerCase().indexOf("nodata")&&B++;var S=M-B;for(na=0;na<M;na++){B=!0;if(-1<I.properties.Values[na].toLowerCase().indexOf("nodata")){var V=S++;U||(B=!1,E.length--,J.length--,N.length--)}else V=wa++;B&&(E[V]=I.catalogItems.features[na],J[V]=I.properties.Values[na],N[V]=E[V].attributes[pa])}}else{for(na=0;na<M;na++)E[na]=I.catalogItems.features[na],N[na]=E[na].attributes[pa];
J=null}}this._visibleRasters=[];(I=-1<da.toLowerCase().indexOf("nodata"))&&!U&&(E=[],J=[],N=[]);if(da&&!E&&!I){pa="ObjectId";E=[];var aa=new T(new g(this.fullExtent),null,{ObjectId:0});E.push(aa)}var fa=[];E?!this._map.spatialReference.equals(this.spatialReference)&&N&&0<N.length?b({url:this._url.path+"/query",content:{f:"json",objectIds:N.join(","),returnGeometry:!0,outSR:n.toJson(ja._map.spatialReference.toJson()),outFields:pa},handleAs:"json",callbackParamName:"callback",load:function(ea){if(0===
ea.features.length)ja._resolve([fa,null,null],null,Q,Y);else{for(na=0;na<ea.features.length;na++)for(va=0;va<E.length;va++)E[va].attributes[pa]==ea.features[na].attributes[pa]&&(E[va].geometry=new q(ea.features[na].geometry),E[va].geometry.setSpatialReference(ja._map.spatialReference));ca.call(ja)}},error:function(ea){ja._resolve([fa,null,null],null,Q,Y)}}):ca.call(this):this._resolve([fa,null,null],null,Q,Y)},getVisibleRasters:function(){var I=this._visibleRasters,P=[],Q;for(Q in I)I.hasOwnProperty(Q)&&
P.push(I[Q]);return P},_getDomainFields:function(I){if(I){var P=[];x.forEach(I,function(Q){if(Q.domain){var U={};U.name=Q.name;U.domain=Q.domain;P.push(U)}});return P}},_getDomainValue:function(I,P){if(I&&I.codedValues){var Q;x.some(I.codedValues,function(U){return U.code===P?(Q=U.name,!0):!1});return Q}},_requestData:function(I,P,Q){this._rasterReadPromise&&this._rasterReadPromise.cancel();I=r.clone(I);var U=I._normalize(!0);this._prepareGetImageParameters(U,P,Q);P=r.clone(this._params);this._cleanupRequestParams(P);
P.extent=I;P.format=P.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===P.format.toLowerCase()&&!P.lercVersion&&10.5<=this.version&&(P.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete P.time;Q=null;this._useBrowserDecoding()&&(Q=new G({ctx:this._context}));P={imageServiceParameters:P,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:Q?r.hitch(Q,"decode"):null};this._rasterReadPromise=this.raster.read(P,this._requestDataHandler,
this._requestDataErrorHandler)},_requestDataHandler:function(I){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=I,this.hasDataChanged=!0,this._setPixelData(I))},_setPixelData:function(I){I=this._clonePixelData(I);this.pixelFilter&&this.pixelFilter(I);this.pixelData=I;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(I){if(null===I||void 0===I)return I;var P={};I.extent&&
(P.extent=r.clone(I.extent));I=I.pixelBlock;if(null===I||void 0===I)return P;P.pixelBlock=I.clone();return P},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(I,P,Q){I=I.getImageData(0,0,P,Q).data;var U=P*Q,Y=0,ca=0,da=new Uint8Array(U),ma=new Uint8Array(U),na=new Uint8Array(U),va=new Uint8Array(U),ja=Infinity,pa=Infinity,la=Infinity,ra=-Infinity,X=-Infinity,ya=-Infinity;for(Y=0;Y<U;Y++){var wa=I[ca++];var M=I[ca++];var B=I[ca++];ja=ja<wa?ja:wa;ra=ra>wa?ra:wa;pa=pa<M?pa:M;X=X>M?X:
M;la=la<B?la:B;ya=ya>B?ya:B;da[Y]=wa;ma[Y]=M;na[Y]=B;va[Y]=I[ca++]&1}return new C({width:P,height:Q,pixels:[da,ma,na],pixelType:"U8",mask:va,statistics:[{minValue:ja,maxValue:ra},{minValue:pa,maxValue:X},{minValue:la,maxValue:ya}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var I=this._url.path+"/multiDimensionalInfo",
P=new z(d._dfdCanceller);if(this._multidimensionalInfo)return P.resolve(this._multidimensionalInfo),P;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(P._pendingDfd=b({url:I,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),P._pendingDfd.then(r.hitch(this,function(Q){this._multidimensionalInfo=Q.multidimensionalInfo;P.callback(Q.multidimensionalInfo)}),function(Q){P.errback(Q)})):(I=Error("Layer does not support multidimensional info"),I.log=!!v.isDebug,P.errback(I));return P},
getStatistics:function(I){var P=new z(d._dfdCanceller);if(I&&this._cachedVariableStats[I])P.resolve(this._cachedVariableStats[I]);else{var Q={f:"json"};I&&(Q.variable=I);P._pendingDfd=b({url:this._url.path+"/statistics",content:Q,handleAs:"json",callbackParamName:"callback"});P._pendingDfd.then(r.hitch(this,function(U){U=U.statistics||U.statitsics;var Y=[];U&&null!=U[0].min?U.forEach(function(ca){Y.push([ca.min,ca.max,ca.mean,ca.standardDeviation])}):Y=U;I&&(this._cachedVariableStats.variableName=
Y);P.callback(Y)}),function(U){P.errback(U)})}return P},getDefaultMultidimensionalDefinition:function(){var I=new z(d._dfdCanceller);if(this._defaultMultidimensionalDefinition)return I.resolve(r.clone(this._defaultMultidimensionalDefinition)),I;I._pendingDfd=this.getMultidimensionalInfo();I._pendingDfd.then(r.hitch(this,function(P){P=this._getDefaultMultidimensionalDefinition(P);I.callback(P)}),function(P){I.errback(P)});return I},_getDefaultMultidimensionalDefinition:function(I,P,Q){var U,Y=[],ca=
"",da=I.variables[0].dimensions;Q&&(ca=I.variables[0].name);for(U in da)da.hasOwnProperty(U)&&(P||"StdTime"!==da[U].name)&&(I=da[U],Y.push(new w({variableName:ca,dimensionName:I.name,isSlice:!I.hasRanges,values:[this._getDefaultDimensionValue(I)]})));this._defaultMultidimensionalDefinition=Y;return r.clone(Y)},_getDefaultDimensionValue:function(I){if(I&&I.values&&I.values.length){var P=Infinity,Q;if(I.hasRanges)return I.values[0];if(I.name&&"stdz"===I.name.toLowerCase()){for(Q=0;Q<I.values.length;Q++){var U=
I.values[Q];var Y=Math.abs(U-0);if(Y<P){P=Y;var ca=U}if(0===Y)break}return ca}return I.extent[0]}},_setDefaultMultidimensionalDefinition:function(I){var P,Q={};this.getDefaultMultidimensionalDefinition().then(r.hitch(this,function(U){P=U;0<P.length&&(this.mosaicRule?(Q=r.clone(this.mosaicRule),Q.multidimensionalDefinition=P):this.defaultMosaicRule?(Q=r.clone(this.defaultMosaicRule),Q.multidimensionalDefinition=P):Q=new u({multidimensionalDefinition:P}),this.setMosaicRule(Q,I))}))},_setDefaultRenderingRule:function(I){var P=
{},Q=this.renderingRule;if(!Q&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())P.rasterFunction=this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!Q||"Resample"!==Q.functionName)){var U="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;P.rasterFunction="Resample";
P.rasterFunctionArguments={ResamplingType:U,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};Q&&(P.rasterFunctionArguments.Raster=Q.toJson())}P.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new k(P),this.setRenderingRule(this.defaultRenderingRule,I))},_cleanupRequestParams:function(I){if(!I)return I;if(I.time&&I.mosaicRule){var P=new u(n.fromJson(I.mosaicRule));P=this._filterOutTimeDimension(P);I.mosaicRule=n.toJson(P.toJson())}P="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");
for(var Q in P)I.hasOwnProperty(P[Q])&&delete I[P[Q]];return I},_filterOutTimeDimension:function(I){if(this._isMultidimensionalCRF())return I;if(I&&I.multidimensionalDefinition&&0<I.multidimensionalDefinition.length){var P=x.filter(I.multidimensionalDefinition,function(Q){return"StdTime"!==Q.dimensionName});I.multidimensionalDefinition=P}return I},_removeVisualizationStretchFunction:function(I){var P=I&&I.functionName;if(!P||"stretch"!==P.toLowerCase())return I;var Q=I.functionArguments.Raster;return Q&&
Q.functionName&&x.some(this.rasterFunctionInfos,function(U){return Q.functionName===U.name})?Q:I},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(I){I&&I.multidimensionalDefinition&&(I.multidimensionalDefinition=I.multidimensionalDefinition.filter(function(P){return!(!P.variableName&&
!P.dimensionName)}),0===I.multidimensionalDefinition.length&&(I.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(I){I=(I=I||this)&&I.serviceDataType;return"esriImageServiceDataTypeVector-UV"===I||"esriImageServiceDataTypeVector-MagDir"===I},_isRenderingRuleAProcessingTemplate:function(I){var P=
I&&I.functionName;return!P||I.functionArguments?!1:x.some(P&&(this.rasterFunctionInfos||[]),function(Q){return Q&&Q.name&&Q.name.toLowerCase()===P.toLowerCase()})},_getRenderingRuleId:function(I){var P=I&&I.functionName;if(P){if(this._isRenderingRuleAProcessingTemplate(I))return P;var Q=this._customRenderingRuleId[P];if(Q){if(Q!==I){for(var U in this._customRenderingRuleId)if(this._customRenderingRuleId[U]===I)return U;for(Q=0;this._customRenderingRuleId[Y];)Q+=1;var Y;this._customRenderingRuleId[P+
Q]=I}}else this._customRenderingRuleId[P]=I;return P}},_createPixelData:function(I){I=new C({width:2,height:2,pixels:I,pixelType:this.pixelType,statistics:I});var P=this.fullExtent.getCenter();P=new g(P.x,P.y,P.x+this.pixelSizeX,P.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:I,extent:P}},_convertRendererToRenderingRule:function(I){var P=I&&I.declaredClass;if(!P||"esri.renderer.UniqueValueRenderer"!==P&&"esri.renderer.ClassBreaksRenderer"!==P&&"esri.renderer.StretchRenderer"!==P&&"esri.renderer.ShadedReliefRenderer"!==
P&&"esri.renderer.ColormapRenderer"!==P)return null;var Q=null;"esri.renderer.StretchRenderer"===P?Q=I.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===P?Q=this._convertClassifyRenderer(I):"esri.renderer.UniqueValueRenderer"===P?Q=this._convertUniqueValueRenderer(I):"esri.renderer.ShadedReliefRenderer"===P?Q=this._convertShadedReliefRenderer(I):"esri.renderer.ColormapRenderer"===P&&(Q=this._convertColormapRenderer(I));return Q},_getValueField:function(I){if(I&&
I.length){var P,Q;x.some(I,function(U){if((Q=U.name)&&"value"===Q.toLowerCase())return P=Q,!0});return P}},_convertColormapRenderer:function(I){var P=new k;P.functionName="Colormap";P.functionArguments={};I=I.colormapInfos.map(function(Q){return[Q.value].concat(Q.color)});P.functionArguments.Colormap=I;return P},_convertShadedReliefRenderer:function(I){var P=new k;P.functionName="Hillshade";var Q="traditional"===I.hillshadeType?0:1,U="none"===I.scalingType?1:3,Y={HillshadeType:Q,SlopeType:U,ZFactor:I.zFactor};
0===Q&&(Y.Azimuth=I.azimuth,Y.Altitude=I.altitude);3===U&&(Y.PSPower=I.pixelSizePower,Y.PSZFactor=I.pixelSizeFactor);P.functionArguments=Y;P.variableName="Raster";I.colorRamp&&(P.functionName="ShadedRelief",Y.Colormap=A.convertColorRampToColormap(I.colorRamp,256));return P},_convertClassifyRenderer:function(I){var P=[],Q=[],U=[],Y=[],ca;var da=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var ma=this.hasRasterAttributeTable;if(da){ma=this._rasterFunctionTemplateInfos[da]?this._rasterFunctionTemplateInfos[da].hasRasterAttributeTable:
this.hasRasterAttributeTable;var na=this._renderingRuleAttributeTable[da];var va=this._rasterFunctionTemplateInfos[da]}var ja=na&&na.features?na.features:this._rasterAttributeTableFeatures;var pa=this._getValueField(na&&na.fields?na.fields:this._rasterAttributeTableFields);ma&&ja?(x.forEach(I.infos,function(la,ra){var X,ya=la.symbol.color;ya.a&&x.forEach(ja,function(wa){X=wa.attributes[I.attributeField];(X>=la.minValue&&X<la.maxValue||ra===I.infos.length-1&&X>=la.minValue)&&Y.push([wa.attributes[pa],
ya.r,ya.g,ya.b])},this)},this),da=va&&va.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(Y,da),da=new k,da.functionName="Colormap",da.functionArguments={},da.functionArguments.Colormap=Y,da.variableName="Raster"):(x.forEach(I.infos,function(la,ra){ca=la.symbol&&la.symbol.color;ca.a?(0===ra?P.push.call(P,la.minValue,la.maxValue+1E-4):P.push.call(P,la.minValue+1E-4,la.maxValue+1E-4),Q.push(ra),Y.push([ra,ca.r,ca.g,ca.b])):U.push(la.minValue,la.maxValue)}),da=va&&va.pixelType||this.pixelType,
this._adjustColormapToPixelTypeRange(Y,da),da=new k,da.functionName="Remap",da.functionArguments={InputRanges:P,OutputValues:Q,NoDataRanges:U},da.variableName="Raster",na=new k,na.functionName="Colormap",na.functionArguments={Colormap:Y,Raster:da},da=na);return da},_convertUniqueValueRenderer:function(I){var P=[],Q=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(Q){var U=this._renderingRuleAttributeTable[Q];var Y=this._rasterFunctionTemplateInfos[Q]}var ca=U&&U.features?U.features:
this._rasterAttributeTableFeatures;var da=(Q=U&&U.fields?U.fields:this._rasterAttributeTableFields)&&Q.length?this._getValueField(Q):"Value";x.forEach(I.infos,function(ma){var na=ma.symbol.color;na.a&&(I.attributeField!==da&&ca?x.forEach(ca,function(va){va.attributes[I.attributeField]==ma.value&&P.push([va.attributes[da],na.r,na.g,na.b])},this):P.push([ma.value,na.r,na.g,na.b]))},this);this._adjustColormapToPixelTypeRange(P,Y&&Y.pixelType||this.pixelType);Y=new k;Y.functionName="Colormap";Y.functionArguments=
{};Y.functionArguments.Colormap=P;Y.variableName="Raster";return Y},_adjustColormapToPixelTypeRange:function(I,P){(P=this._pixelTypeRanges[P])&&I.push([Math.floor(P[0]-1),0,0,0],[Math.ceil(P[1]+1),0,0,0]);return I},_combineRenderingRule:function(I,P){if(!I||!P)return I||P;var Q=function(U){var Y=U.Raster;return Y=Y&&"esri.layers.RasterFunction"===Y.declaredClass?Q(Y.functionArguments):U};I=r.clone(I);"none"!==P.functionName.toLocaleLowerCase()&&(Q(I.functionArguments).Raster=P);return I},_isItemLevelRasterFunction:function(I){var P=
I&&I.functionName;if(!P||!this._hasItemLevelRFT)return!1;var Q=!1;x.some(this.rasterFunctionInfos,function(U){if(U&&U.name===P){if(1===U.functionType||2===U.functionType)Q=!0;return!0}});return Q},_getServiceLevelRenderingRule:function(I){if(!this._hasItemLevelRFT||!I)return I;I=new k(I.toJson());var P=I.functionArguments;for(var Q;;)if((Q=P&&P.Raster)&&Q.functionArguments&&Q.functionArguments.Raster)P=Q,P=P.functionArguments;else{this._isItemLevelRasterFunction(Q)&&delete P.Raster;break}return I},
_getItemLevelRenderingRule:function(I){if(!this._hasItemLevelRFT||!I)return null;if(this._isItemLevelRasterFunction(I))return I;I=new k(I.toJson());for(I=I.functionArguments;;)if((I=I&&I.Raster)&&I.functionArguments&&I.functionArguments.Raster)I=I.functionArguments;else{if(this._isItemLevelRasterFunction(I))return I;break}},_resolve:function(I,P,Q,U,Y){P&&this[P].apply(this,I);Q&&Q.apply(null,I);U&&d._resDfd(U,I,Y)},_toggleTime:function(){var I=this._map;this.timeInfo&&this.useMapTime&&I&&!this.suspended?
(this._timeConnect||(this._timeConnect=t.connect(I,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(I.timeExtent)):(t.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(I,P){this.useMapTime=I;this._toggleTime();!P&&this._map&&this.refresh(!0)},_setTime:function(I){this._params&&(this._params.time=I?I.toJson().join(","):null)},_onTimeExtentChangeHandler:function(I){this.suspended||(this._setTime(I),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},
getColormap:function(I){var P=this._url.path+"/colormap",Q=new z(d._dfdCanceller),U={f:"json"};I&&I.renderingRule&&(U.renderingRule=n.toJson(I.renderingRule.toJson()));this.hasColormap?(Q._pendingDfd=b({url:P,content:U,handleAs:"json",callbackParamName:"callback"}),Q._pendingDfd.then(function(Y){Q.callback(Y)},function(Y){Q.errback(Y)})):(I=Error("Layer does not support colormap"),I.log=!!v.isDebug,Q.errback(I));return Q},getRenderingRuleColormap:function(I){var P=new z(d._dfdCanceller);if(!I||!I.renderingRule)return P.errback(Error("Rendering rule is not specified")),
P;I=I.renderingRule;var Q=this._getRenderingRuleId(I);this._renderingRuleColormap&&Q&&this._renderingRuleColormap.hasOwnProperty(Q)?P.resolve(this._renderingRuleColormap[Q]):P=this.getColormap({renderingRule:I}).then(r.hitch(this,function(U){U=U&&U.colormap;Q&&(this._renderingRuleColormap[Q]=U);return U}));return P}});m("extend-esri")&&r.setObject("layers.ImageServiceLayerMixin",F,e);return F})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),
function(F,r,z,x,n,v,t){var m=F(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(h){r.isObject(h)&&(r.mixin(this,h),h.mosaicMethod&&(this.method=h.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),h.mosaicOperation&&(this.operation=
h.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),h.fids&&(this.objectIds=h.fids),h.viewpoint&&(this.viewpoint=new v(h.viewpoint)),h.itemRenderingRule&&(this.itemRenderingRule=new t(h.itemRenderingRule)),this.multidimensionalDefinition=h.multidimensionalDefinition||[])},toJson:function(){var h=null,p=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(p){h=[];for(var e=0;e<p;e++)h.push("esri.layers.DimensionalDefinition"===
this.multidimensionalDefinition[e].declaredClass?this.multidimensionalDefinition[e].toJson():this.multidimensionalDefinition[e])}h={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:r.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:r.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:h,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():
null};return n.filter(h,function(c){if(null!==c)return!0})},_getMethodEnum:function(h){if(h){var p=m.METHOD_NONE;switch(h.toLowerCase()){case "byattribute":p=m.METHOD_ATTRIBUTE;break;case "center":p=m.METHOD_CENTER;break;case "lockraster":p=m.METHOD_LOCKRASTER;break;case "nadir":p=m.METHOD_NADIR;break;case "northwest":p=m.METHOD_NORTHWEST;break;case "seamline":p=m.METHOD_SEAMLINE;break;case "viewpoint":p=m.METHOD_VIEWPOINT}return p}},_getOperatorEnum:function(h){if(h)switch(h.toLowerCase()){case "first":return m.OPERATION_FIRST;
case "last":return m.OPERATION_LAST;case "max":return m.OPERATION_MAX;case "min":return m.OPERATION_MIN;case "blend":return m.OPERATION_BLEND;case "mean":return m.OPERATION_MEAN;case "sum":return m.OPERATION_SUM}}});r.mixin(m,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});z("extend-esri")&&r.setObject("layers.MosaicRule",m,x);return m})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(F,r,z,x,n){F=F(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,
constructor:function(v){r.isObject(v)&&r.mixin(this,v)},toJson:function(){var v={variableName:this.variableName,dimensionName:this.dimensionName,values:r.clone(this.values),isSlice:this.isSlice};return n.filter(v,function(t){return null!==t})}});z("extend-esri")&&r.setObject("layers.DimensionalDefinition",F,x);return F})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){var l,q,A,u,k,w;r=r(p,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(H){this.imageServiceUrl=H;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(H,L,T){var K=this,O=new x(b._dfdCanceller);if(10>m("ie"))throw"This browser is not supported.";
if(!H.imageServiceParameters)throw"Insufficient parameters to read data";var I=z.clone(H.imageServiceParameters),P=H.pixelType;n.some(this.validPixelTypes,function(ma){return ma===P})||(I.pixelType="F32");n.some(this.validFormats,function(ma){return ma.toLowerCase()===I.format.toLowerCase()})||(I.format="lerc");var Q=H.decodeFunc,U;this._prepareGetImageParameters(I);var Y=I.width,ca=I.height,da=I.extent;delete I.width;delete I.height;delete I.extent;O._pendingDfd=e({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:z.mixin(I,{f:"image"}),load:function(ma){K.decode(ma,{width:Y,height:ca,planes:null,pixelType:P,noDataValue:I.noData,format:I.format,decodeFunc:Q}).then(function(na){U={pixelBlock:na,extent:da};K._resolve([U,I],"onRasterReadComplete",L,O)},function(na){K._resolve([na],null,T,O,!0)})},error:function(ma){K._resolve([ma],null,T,O,!0)}});return O.promise},decode:function(H,L){if(void 0===L||null===L)throw"missing decode options";var T;L.format&&(T=L.format.toUpperCase());
"BSQ"!==T&&"BIP"!==T&&(T=this._getFormat(H));var K=L.decodeFunc;if(void 0===K||null===K)K=this._getFormatDecoderDfd(T);return K(H,L)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(H){if(H.size&&H.bbox){var L=H.size.split(",");H.width=parseFloat(L[0]);H.height=parseFloat(L[1]);H.extent||(L=H.bbox.split(","),H.extent=new c(parseFloat(L[0]),parseFloat(L[1]),parseFloat(L[2]),parseFloat(L[3]),new f(H.bboxSR)))}else{if(!H.width||Math.floor(H.width)!==H.width||!H.height||Math.floor(H.height)!==
H.height)throw"Incorrect Image Dimensions";if(!H.extent||"esri.geometry.Extent"!==H.extent.declaredClass)throw"Incorrect extent";L=H.extent;var T=L.spatialReference.wkid||t.toJson(L.spatialReference.toJson());delete H._ts;z.mixin(H,{bbox:L.xmin+","+L.ymin+","+L.xmax+","+L.ymax,imageSR:T,bboxSR:T,size:H.width+","+H.height},H.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(H,L,T){var K=H.ymax-H.ymin,O=H.xmax-H.xmin;T>=L?H.ymax=H.ymin+O*L/T:H.xmax=H.xmin+K*T/L;return H},
_resolve:function(H,L,T,K,O){L&&this[L].apply(this,H);T&&T.apply(null,H);K&&b._resDfd(K,H,O)},_getFormatDecoderDfd:function(H){var L=null;switch(H){case "LERC":L=this._decodeLerc;break;case "LERC2":L=this._decodeLerc2;break;case "JPEG":L=this._decodeJpeg;break;case "PNG":L=this._decodePng;break;case "BSQ":L=this._decodeBsq;break;case "BIP":L=this._decodeBip;break;case "TIFF":L=this._decodeTiff;break;default:L=function(T,K){throw"The raster format is not supported";}}L=z.hitch(this,L);return function(T,
K){var O=new x;try{if("LERC"===H||!0===k){var I=L(T,K);O.resolve(I)}else w.then(function(){I=L(T,K);O.resolve(I)})}catch(P){O.reject(P)}return O}},_getFormat:function(H){H=new Uint8Array(H,0,10);var L="";if(255===H[0]&&216===H[1])L="JPEG";else if(137===H[0]&&80===H[1]&&78===H[2]&&71===H[3])L="PNG";else if(67===H[0]&&110===H[1]&&116===H[2]&&90===H[3]&&73===H[4]&&109===H[5]&&97===H[6]&&103===H[7]&&101===H[8]&&32===H[9])L="LERC";else if(76===H[0]&&101===H[1]&&114===H[2]&&99===H[3]&&50===H[4]&&32===H[5])L=
"LERC2";else if(-1<String.fromCharCode.apply(null,H).toLowerCase().indexOf("error"))L="ERROR";else if(73===H[0]&&73===H[1]&&42===H[2]&&0===H[3]||77===H[0]&&77===H[1]&&0===H[2]&&42===H[3])L="TIFF";return L},_validateDecodeParams:function(H){if(!H.height||Math.floor(H.height)!==H.height)throw"Height not provided.";if(!H.width||Math.floor(H.width)!==H.width)throw"Width not provided.";},_decodeJpeg:function(H,L){if(!l)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(L);H=(new l).decode(H);
if(!G(H,L))throw"The decoded image dimensions are incorrect.";L=[];var T;for(T=0;T<H.pixels.length;T++){var K=H.pixels[T];L.push(this._calculateBandStatistics(K))}return new d({width:H.width,height:H.height,pixels:H.pixels,pixelType:"U8",mask:H.mask,statistics:L})},_decodePng:function(H,L){if(!q)throw"The png decoder module is not loaded.";this._validateDecodeParams(L);H=new Uint8Array(H);var T=new q(H);H=new Uint8Array(L.width*L.height*4);T.copyToImageData(H,T.decodePixels());var K=T=0;K=new Uint8Array(L.width*
L.height);for(T=0;T<L.width*L.height;T++)K[T]=H[4*T+3];var O=new d({width:L.width,height:L.height,pixels:[],pixelType:"U8",mask:K,statistics:[]});for(T=0;3>T;T++){var I=new Uint8Array(L.width*L.height);for(K=0;K<L.width*L.height;K++)I[K]=H[4*K+T];O.addData({pixels:I,statistics:this._calculateBandStatistics(I)})}return O},_decodeBsq:function(H,L){if(!A)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(L);C=L.noDataValue;L.pixelType=D(L.pixelType);H=A.decodeBSQ(H,{bandCount:L.planes,
width:L.width,height:L.height,pixelType:y,noDataValue:C});var T=[],K,O=null;for(K=0;K<H.pixels.length;K++)O=H.pixels[K],T.push(this._calculateBandStatistics(O));return new d({width:L.width,height:L.height,pixels:H.pixels,pixelType:L.pixelType,mask:H.maskData,statistics:T})},_decodeBip:function(H,L){this._validateDecodeParams(L);C=L.noDataValue;L.pixelType=D(L.pixelType);H=A.decodeBIP(H,{bandCount:L.planes,width:L.width,height:L.height,pixelType:y,noDataValue:C});var T=[],K,O=null;for(K=0;K<H.pixels.length;K++)O=
H.pixels[K],T.push(this._calculateBandStatistics(O));return new d({width:L.width,height:L.height,pixels:H.pixels,pixelType:L.pixelType,mask:H.maskData,statistics:T})},_decodeTiff:function(H,L){this._validateDecodeParams(L);C=L.noDataValue;L.pixelType=D(L.pixelType);H=u.decode(H);L=[];var T,K=null;for(T=0;T<H.pixels.length;T++)K=H.pixels[T],L.push(this._calculateBandStatistics(K,H.maskData));return new d({width:H.width,height:H.height,pixels:H.pixels,pixelType:H.pixelType,mask:H.maskData,statistics:L})},
_decodeLerc:function(H,L){this._validateDecodeParams(L);C=L.noDataValue;L.pixelType=D(L.pixelType);for(var T=0,K,O=0,I,P=H.byteLength-10;O<P;){var Q=a.decode(H,{inputOffset:O,encodedMaskData:K,returnMask:0===T?!0:!1,returnEncodedMask:0===T?!0:!1,returnFileInfo:!0,pixelType:y,noDataValue:C});O=Q.fileInfo.eofOffset;0===T&&(K=Q.encodedMaskData,I=new d({width:L.width,height:L.height,pixels:[],pixelType:L.pixelType,mask:Q.maskData,statistics:[]}));T++;if(!G(Q,L))throw"The decoded image dimensions are incorrect";
I.addData({pixels:Q.pixelData,statistics:{minValue:Q.minValue,maxValue:Q.maxValue,noDataValue:Q.noDataValue}})}return I},_decodeLerc2:function(H,L){this._validateDecodeParams(L);C=L.noDataValue;L.pixelType=D(L.pixelType);for(var T=0,K,O,I=0,P,Q=H.byteLength-10,U=[];I<Q;){O=g.decode(H,{inputOffset:I,maskData:K,returnFileInfo:!0});I=O.fileInfo.eofOffset;0===T&&(K=O.maskData,P=new d({width:L.width,height:L.height,pixels:[],pixelType:O.fileInfo.pixelType,mask:O.maskData,statistics:[]}));O.fileInfo.mask&&
0<O.fileInfo.mask.numBytes&&U.push(O.maskData);T++;if(!G(O,L))throw"The decoded image dimensions are incorrect";if(1<O.dimCount&&O.pixelData&&O.pixelData.length===O.width*O.height*O.dimCount){O.pixelData=O.pixelData.slice(-O.width*O.height);var Y=O.dimStats&&O.dimStats.minValues&&O.dimStats.minValues[O.dimCount-1],ca=O.dimStats&&O.dimStats.maxValues&&O.dimStats.maxValues[O.dimCount-1];null!=Y&&null!=ca&&(O.minValue=Y,O.maxValue=ca)}P.addData({pixels:O.pixelData,statistics:{minValue:O.minValue,maxValue:O.maxValue,
noDataValue:O.noDataValue}})}if(1<U.length){O=P.width*P.height;P.bandMasks=U;K=new Uint8Array(O);K.set(U[0]);for(L=1;L<U.length;L++)for(H=U[L],T=0;T<O;T++)K[T]&=H[T];P.maskData=K}return P},_calculateBandStatistics:function(H,L){var T=Infinity,K=-Infinity,O=H.length,I,P=0;if(L)for(I=0;I<O;I++)L[I]&&(P=H[I],T=P<T?P:T,K=P>K?P:K);else for(I=0;I<O;I++)P=H[I],T=P<T?P:T,K=P>K?P:K;return{minValue:T,maxValue:K}},_loadRasterFormatModules:function(){k||(w||(w=new x),10>m("ie")?w.isRejected()||w.reject("unsupported browser version"):
F(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(H,L,T,K){l=H;q=L;A=T;u=K;k=!0;w.isResolved()||w.resolve(!0)}))}});var y=null,C=null,D=function(H){if("U1"===H||"U2"===H||"U4"===H||"U8"===H)return C=Math.pow(2,8)-1,y=Uint8Array,"U8";"U16"===H?(C=C||Math.pow(2,16)-1,y=Uint16Array):"U32"===H?(C=C||Math.pow(2,32)-1,y=Uint32Array):"S8"===H?(C=C||0-Math.pow(2,7),y=Int8Array):"S16"===H?(C=C||0-Math.pow(2,15),y=Int16Array):
"S32"===H?(C=C||0-Math.pow(2,31),y=Int32Array):y=Float32Array;return H},G=function(H,L){return H.height!==L.height||H.width!==L.width?!1:!0};m("extend-esri")&&z.setObject("layers.Raster",r,h);return r})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(F,r,z,x){F=F([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(n){if(n){if(!n.width||
Math.floor(n.width)!==n.width)throw"PixelBlock: incorrect width";if(!n.height||Math.floor(n.height)!==n.height)throw"PixelBlock: incorrect height";if(!n.pixels)throw"PixelBlock: pixel data not present";this.width=n.width;this.height=n.height;this.pixels=n.pixels;this.pixelType=n.pixelType||null;this.statistics=n.statistics;this.mask=n.mask||null;this.maskIsAlpha=n.maskIsAlpha||!1;n=n.validPixelCount;null==n&&(n=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=
n}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(n){if(!n.pixels||!n.statistics)throw"Pixel data or statistics are not present";if(n.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(n.statistics);this.pixels.push(n.pixels)},getAsRGBA:function(){var n=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(n);
break;default:this._fillFrom8Bit(n)}return new Uint8ClampedArray(n)},getAsRGBAFloat:function(){var n=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(n);return n},clone:function(n){n=n||this;var v=new this.constructor;v.width=n.width;v.height=n.height;v.pixelType=n.pixelType;v.maskIsAlpha=n.maskIsAlpha;n.mask&&(v.mask=new Uint8Array(n.mask));var t,m;if(n.pixels){v.pixels=[];var h=(m=n.pixels.length)&&n.pixels[0].slice;for(t=0;t<m;t++)v.pixels[t]=h?n.pixels[t].slice(0,n.pixels[t].length):
new n.pixels[t].constructor(n.pixels[t])}if(n.statistics)for(v.statistics=[],m=n.statistics.length,t=0;t<m;t++)v.statistics[t]=r.clone(n.statistics[t]);n=n.validPixelCount;null==n&&(n=v.mask?this._getValidPixelCount(v.mask):v.width*v.height);return v},clamp:function(n){if("F64"!==n&&"F32"!==n){switch(n){case "U8":var v=[0,255];break;case "U16":v=[0,65535];break;case "U32":v=[0,4294967295];break;case "S8":v=[-128,127];break;case "S16":v=[-32768,32767];break;case "S32":v=[-2147483648,2147483647];break;
default:v=[-3.4*1E39,3.4*1E39]}var t=v[0];v=v[1];var m=this.pixels,h=this.width*this.height,p=m.length,e,c,f=[];for(e=0;e<p;e++){var b=this._createEmptyBand(n,h);var d=m[e];for(c=0;c<h;c++){var a=d[c];b[c]=a>v?v:a<t?t:a}f.push(b)}this.pixels=f;this.pixelType=n}},calculateStatistics:function(){var n,v=[],t=this.mask;for(n=0;n<this.pixels.length;n++){var m=this.pixels[n];v.push(this._calculateBandStatistics(m,t))}this.statistics=v},_getValidPixelCount:function(n){var v,t=0;for(v=0;v<n.length;v++)n[v]&&
t++;return t},_createEmptyBand:function(n,v){switch(n){case "U8":n=new Uint8Array(v);break;case "U16":n=new Uint16Array(v);break;case "U32":n=new Uint32Array(v);break;case "S8":n=new Int8Array(v);break;case "S16":n=new Int16Array(v);break;case "S32":n=new Int32Array(v);break;case "U32":n=new Uint32Array(v);break;case "F32":n=new Float32Array(v);break;case "F64":n=new Float64Array(v);break;default:n=new Float32Array(v)}return n},_fillFrom8Bit:function(n){var v=this.pixels,t=this.mask;if(!n||!v||!v.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var m,h;var p=m=h=v[0];3<=v.length&&(m=v[1],h=v[2]);v=new Uint32Array(n);var e=this.width*this.height;if(p.length!==e)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(t&&t.length===e)if(this.maskIsAlpha)for(n=0;n<e;n++)t[n]&&(v[n]=t[n]<<24|h[n]<<16|m[n]<<8|p[n]);else for(n=0;n<e;n++)t[n]&&(v[n]=-16777216|h[n]<<16|m[n]<<8|p[n]);else for(n=0;n<e;n++)v[n]=-16777216|h[n]<<16|m[n]<<8|p[n]},_fillFromNon8Bit:function(n){var v=this.pixels,t=this.mask,m=this.statistics;if(!n||
!v||!v.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var h=1,p=0;h=1;m&&0<m.length?(p=m.map(function(b){return b.minValue}).reduce(function(b,d){return Math.min(b,d)}),h=m.map(function(b){return b.maxValue-b.minValue}).reduce(function(b,d){return Math.max(b,d)}),h=255/h):(h=255,"S8"===this.pixelType?(p=-128,h=127):"U16"===this.pixelType?h=65535:"S16"===this.pixelType?(p=-32768,h=32767):"U32"===this.pixelType?h=4294967295:"S32"===this.pixelType?(p=-2147483648,
h=2147483647):"F32"===this.pixelType?(p=-3.4*1E39,h=3.4*1E39):"F64"===this.pixelType&&(p=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-p));n=new Uint32Array(n);m=this.width*this.height;var e=v[0];if(e.length!==m)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=v.length){var c=v[1];var f=v[2];if(t&&t.length===m)for(v=0;v<m;v++)t[v]&&(n[v]=-16777216|(f[v]-p)*h<<16|(c[v]-p)*h<<8|(e[v]-p)*h);else for(v=0;v<m;v++)n[v]=-16777216|(f[v]-p)*h<<16|(c[v]-p)*h<<8|(e[v]-p)*
h}else if(t&&t.length===m)for(v=0;v<m;v++)c=(e[v]-p)*h,t[v]&&(n[v]=-16777216|c<<16|c<<8|c);else for(v=0;v<m;v++)c=(e[v]-p)*h,n[v]=-16777216|c<<16|c<<8|c},_fillFrom32Bit:function(n){var v=this.pixels,t=this.mask;if(!n||!v||!v.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var m,h;var p=m=h=v[0];3<=v.length&&(m=v[1],h=v[2]);var e=this.width*this.height;if(p.length!==e)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var c=0;if(t&&
t.length===e)for(v=0;v<e;v++)n[c++]=p[v],n[c++]=m[v],n[c++]=h[v],n[c++]=t[v]&1;else for(v=0;v<e;v++)n[c++]=p[v],n[c++]=m[v],n[c++]=h[v],n[c++]=1},_calculateBandStatistics:function(n,v){var t=Infinity,m=-Infinity,h=n.length,p,e=0;if(v)for(p=0;p<h;p++)v[p]&&(e=n[p],t=e<t?e:t,m=e>m?e:m);else for(p=0;p<h;p++)e=n[p],t=e<t?e:t,m=e>m?e:m;return{minValue:t,maxValue:m}}});z("extend-esri")&&r.setObject("layers.PixelBlock",F,x);return F})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var F=
{defaultNoDataValue:-3.4027999387901484E38,decode:function(z,x){x=x||{};var n=x.inputOffset||0,v=x.encodedMaskData||null===x.encodedMaskData,t={},m=new Uint8Array(z,n,10);t.fileIdentifierString=String.fromCharCode.apply(null,m);if("CntZImage"!=t.fileIdentifierString.trim())throw"Unexpected file identifier string: "+t.fileIdentifierString;n+=10;m=new DataView(z,n,24);t.fileVersion=m.getInt32(0,!0);t.imageType=m.getInt32(4,!0);t.height=m.getUint32(8,!0);t.width=m.getUint32(12,!0);t.maxZError=m.getFloat64(16,
!0);n+=24;if(!v)if(m=new DataView(z,n,16),t.mask={},t.mask.numBlocksY=m.getUint32(0,!0),t.mask.numBlocksX=m.getUint32(4,!0),t.mask.numBytes=m.getUint32(8,!0),t.mask.maxValue=m.getFloat32(12,!0),n+=16,0<t.mask.numBytes){v=new Uint8Array(Math.ceil(t.width*t.height/8));m=new DataView(z,n,t.mask.numBytes);var h=m.getInt16(0,!0),p=2,e=0;do{if(0<h)for(;h--;)v[e++]=m.getUint8(p++);else{var c=m.getUint8(p++);for(h=-h;h--;)v[e++]=c}h=m.getInt16(p,!0);p+=2}while(p<t.mask.numBytes);if(-32768!==h||e<v.length)throw"Unexpected end of mask RLE encoding";
t.mask.bitset=v;n+=t.mask.numBytes}else 0===(t.mask.numBytes|t.mask.numBlocksY|t.mask.maxValue)&&(v=new Uint8Array(Math.ceil(t.width*t.height/8)),t.mask.bitset=v);m=new DataView(z,n,16);t.pixels={};t.pixels.numBlocksY=m.getUint32(0,!0);t.pixels.numBlocksX=m.getUint32(4,!0);t.pixels.numBytes=m.getUint32(8,!0);t.pixels.maxValue=m.getFloat32(12,!0);n+=16;v=t.pixels.numBlocksX;m=t.pixels.numBlocksY;v+=0<t.width%v?1:0;h=m+(0<t.height%m?1:0);t.pixels.blocks=Array(v*h);for(e=p=0;e<h;e++)for(c=0;c<v;c++){var f=
0;m=new DataView(z,n,Math.min(10,z.byteLength-n));var b={};t.pixels.blocks[p++]=b;var d=m.getUint8(0);f++;b.encoding=d&63;if(3<b.encoding)throw"Invalid block encoding ("+b.encoding+")";if(2===b.encoding)n++;else{if(0!==d&&2!==d){d>>=6;b.offsetType=d;if(2===d)b.offset=m.getInt8(1),f++;else if(1===d)b.offset=m.getInt16(1,!0),f+=2;else if(0===d)b.offset=m.getFloat32(1,!0),f+=4;else throw"Invalid block offset type";if(1===b.encoding)if(d=m.getUint8(f),f++,b.bitsPerPixel=d&63,d>>=6,b.numValidPixelsType=
d,2===d)b.numValidPixels=m.getUint8(f),f++;else if(1===d)b.numValidPixels=m.getUint16(f,!0),f+=2;else if(0===d)b.numValidPixels=m.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";}n+=f;if(3!=b.encoding)if(0===b.encoding){d=(t.pixels.numBytes-1)/4;if(d!==Math.floor(d))throw"uncompressed block has invalid length";m=new ArrayBuffer(4*d);f=new Uint8Array(m);f.set(new Uint8Array(z,n,4*d));m=new Float32Array(m);b.rawData=m;n+=4*d}else 1===b.encoding&&(d=Math.ceil(b.numValidPixels*b.bitsPerPixel/
8),m=new ArrayBuffer(4*Math.ceil(d/4)),f=new Uint8Array(m),f.set(new Uint8Array(z,n,d)),b.stuffedData=new Uint32Array(m),n+=d)}}t.eofOffset=n;z=null!=x.noDataValue?x.noDataValue:F.defaultNoDataValue;v=x.encodedMaskData;d=x.returnMask;h=0;p=t.pixels.numBlocksX;e=t.pixels.numBlocksY;c=Math.floor(t.width/p);b=Math.floor(t.height/e);f=2*t.maxZError;n=Number.MAX_VALUE;v=v||(t.mask?t.mask.bitset:null);var a;m=new (x.pixelType||Float32Array)(t.width*t.height);d&&v&&(a=new Uint8Array(t.width*t.height));d=
new Float32Array(c*b);for(var g,l,q=0;q<=e;q++){var A=q!==e?b:t.height%e;if(0!==A)for(var u=0;u<=p;u++){var k=u!==p?c:t.width%p;if(0!==k){var w=q*t.width*b+u*c,y=t.width-k,C=t.pixels.blocks[h],D;if(2>C.encoding){if(0===C.encoding)var G=C.rawData;else{var H=D=G=void 0;g=C.stuffedData;l=C.bitsPerPixel;var L=C.numValidPixels,T=C.offset,K=f,O=d,I=t.pixels.maxValue,P=(1<<l)-1,Q=0,U=0,Y=Math.ceil((I-T)/K);g[g.length-1]<<=8*(4*g.length-Math.ceil(l*L/8));for(H=0;H<L;H++)0===U&&(G=g[Q++],U=32),U>=l?(D=G>>>
U-l&P,U-=l):(U=l-U,D=(G&P)<<U&P,G=g[Q++],U=32-U,D+=G>>>U),O[H]=D<Y?T+D*K:I;G=d}D=0}else var ca=2===C.encoding?0:C.offset;if(v)for(l=0;l<A;l++){if(w&7){var da=v[w>>3];da<<=w&7}for(g=0;g<k;g++)w&7||(da=v[w>>3]),da&128?(a&&(a[w]=1),H=2>C.encoding?G[D++]:ca,n=n>H?H:n,m[w++]=H):(a&&(a[w]=0),m[w++]=z),da<<=1;w+=y}else if(2>C.encoding)for(l=0;l<A;l++){for(g=0;g<k;g++)H=G[D++],n=n>H?H:n,m[w++]=H;w+=y}else for(n=n>ca?ca:n,l=0;l<A;l++){for(g=0;g<k;g++)m[w++]=ca;w+=y}if(1===C.encoding&&D!==C.numValidPixels)throw"Block and Mask do not match";
h++}}}ca=a;a={width:t.width,height:t.height,pixelData:m,minValue:n,maxValue:t.pixels.maxValue,noDataValue:z};ca&&(a.maskData=ca);x.returnEncodedMask&&t.mask&&(a.encodedMaskData=t.mask.bitset?t.mask.bitset:null);if(x.returnFileInfo&&(a.fileInfo=r(t),x.computeUsedBitDepths)){x=a.fileInfo;ca=t.pixels.numBlocksX*t.pixels.numBlocksY;da={};for(G=0;G<ca;G++)D=t.pixels.blocks[G],0===D.encoding?da.float32=!0:1===D.encoding?da[D.bitsPerPixel]=!0:da[0]=!0;t=Object.keys(da);x.bitDepths=t}return a}},r=function(z){return{fileIdentifierString:z.fileIdentifierString,
fileVersion:z.fileVersion,imageType:z.imageType,height:z.height,width:z.width,maxZError:z.maxZError,eofOffset:z.eofOffset,mask:z.mask?{numBlocksX:z.mask.numBlocksX,numBlocksY:z.mask.numBlocksY,numBytes:z.mask.numBytes,maxValue:z.mask.maxValue}:null,pixels:{numBlocksX:z.pixels.numBlocksX,numBlocksY:z.pixels.numBlocksY,numBytes:z.pixels.numBytes,maxValue:z.pixels.maxValue,noDataValue:this.noDataValue}}};return F})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var F={unstuff:function(x,
n,v,t,m,h,p,e){var c=(1<<v)-1,f=0,b,d=0;x[x.length-1]<<=8*(4*x.length-Math.ceil(v*t/8));if(m)for(b=0;b<t;b++){if(0===d){var a=x[f++];d=32}if(d>=v){var g=a>>>d-v&c;d-=v}else d=v-d,g=(a&c)<<d&c,a=x[f++],d=32-d,g+=a>>>d;n[b]=m[g]}else for(m=Math.ceil((e-h)/p),b=0;b<t;b++)0===d&&(a=x[f++],d=32),d>=v?(g=a>>>d-v&c,d-=v):(d=v-d,g=(a&c)<<d&c,a=x[f++],d=32-d,g+=a>>>d),n[b]=g<m?h+g*p:e},unstuffLUT:function(x,n,v,t,m,h){var p=(1<<n)-1,e=0,c=0,f=0,b=f=0,d=[];x[x.length-1]<<=8*(4*x.length-Math.ceil(n*v/8));var a=
Math.ceil((h-t)/m);for(c=0;c<v;c++){if(0===f){var g=x[e++];f=32}f>=n?(b=g>>>f-n&p,f-=n):(f=n-f,b=(g&p)<<f&p,g=x[e++],f=32-f,b+=g>>>f);d[c]=b<a?t+b*m:h}d.unshift(t);return d},unstuff2:function(x,n,v,t,m,h,p,e){var c=(1<<v)-1,f=0,b,d=0,a=0;if(m)for(b=0;b<t;b++){if(0===d){var g=x[f++];d=32;a=0}if(d>=v){var l=g>>>a&c;d-=v;a+=v}else{var q=v-d;l=g>>>a&c;g=x[f++];d=32-q;l|=(g&(1<<q)-1)<<v-q;a=q}n[b]=m[l]}else for(m=Math.ceil((e-h)/p),b=0;b<t;b++)0===d&&(g=x[f++],d=32,a=0),d>=v?(l=g>>>a&c,d-=v,a+=v):(q=v-
d,l=g>>>a&c,g=x[f++],d=32-q,l|=(g&(1<<q)-1)<<v-q,a=q),n[b]=l<m?h+l*p:e;return n},unstuffLUT2:function(x,n,v,t,m,h){var p=(1<<n)-1,e=0,c=0,f=0,b=0,d=0,a=0,g=[],l=Math.ceil((h-t)/m);for(c=0;c<v;c++){if(0===b){var q=x[e++];b=32;a=0}b>=n?(d=q>>>a&p,b-=n,a+=n):(f=n-b,d=q>>>a&p,q=x[e++],b=32-f,d|=(q&(1<<f)-1)<<n-f,a=f);g[c]=d<l?t+d*m:h}g.unshift(t);return g},originalUnstuff:function(x,n,v,t){var m=(1<<v)-1,h=0,p,e=0;x[x.length-1]<<=8*(4*x.length-Math.ceil(v*t/8));for(p=0;p<t;p++){if(0===e){var c=x[h++];
e=32}if(e>=v){var f=c>>>e-v&m;e-=v}else e=v-e,f=(c&m)<<e&m,c=x[h++],e=32-e,f+=c>>>e;n[p]=f}return n},originalUnstuff2:function(x,n,v,t){var m=(1<<v)-1,h=0,p,e=0,c=0;for(p=0;p<t;p++){if(0===e){var f=x[h++];e=32;c=0}if(e>=v){var b=f>>>c&m;e-=v;c+=v}else{var d=v-e;b=f>>>c&m;f=x[h++];e=32-d;b|=(f&(1<<d)-1)<<v-d;c=d}n[p]=b}return n}},r={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(x){for(var n=65535,v=65535,t=x.length,m=Math.floor(t/2),h=0;m;){var p=359<=m?359:m;m-=p;do n+=x[h++]<<8,v+=n+=
x[h++];while(--p);n=(n&65535)+(n>>>16);v=(v&65535)+(v>>>16)}t&1&&(v+=n+=x[h]<<8);return((v&65535)+(v>>>16)<<16|(n&65535)+(n>>>16))>>>0},readHeaderInfo:function(x,n){var v=n.ptr,t=new Uint8Array(x,v,6),m={};m.fileIdentifierString=String.fromCharCode.apply(null,t);if(0!==m.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+m.fileIdentifierString;v+=6;t=new DataView(x,v,8);var h=t.getInt32(0,!0);m.fileVersion=h;v+=4;3<=h&&(m.checksum=t.getUint32(4,
!0),v+=4);t=new DataView(x,v,12);m.height=t.getUint32(0,!0);m.width=t.getUint32(4,!0);v+=8;4<=h?(m.numDims=t.getUint32(8,!0),v+=4):m.numDims=1;t=new DataView(x,v,40);m.numValidPixel=t.getUint32(0,!0);m.microBlockSize=t.getInt32(4,!0);m.blobSize=t.getInt32(8,!0);m.imageType=t.getInt32(12,!0);m.maxZError=t.getFloat64(16,!0);m.zMin=t.getFloat64(24,!0);m.zMax=t.getFloat64(32,!0);v+=40;n.headerInfo=m;n.ptr=v;if(3<=h&&(x=this.computeChecksumFletcher32(new Uint8Array(x,v-(4<=h?52:48),m.blobSize-14)),x!==
m.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(x,n){var v=n.headerInfo,t=this.getDataTypeArray(v.imageType),m=v.numDims*this.getDataTypeSize(v.imageType),h=this.readSubArray(x,n.ptr,t,m);x=this.readSubArray(x,n.ptr+m,t,m);n.ptr+=2*m;m=!0;for(n=0;n<v.numDims;n++)if(h[n]!==x[n]){m=!1;break}v.minValues=h;v.maxValues=x;return m},readSubArray:function(x,n,v,t){if(v===Uint8Array)x=new Uint8Array(x,n,t);else{var m=new ArrayBuffer(t);(new Uint8Array(m)).set(new Uint8Array(x,n,t));
x=new v(m)}return x},readMask:function(x,n){var v=n.ptr,t=n.headerInfo,m=t.width*t.height,h=t.numValidPixel,p=new DataView(x,v,4);t={};t.numBytes=p.getUint32(0,!0);v+=4;if((0===h||m===h)&&0!==t.numBytes)throw"invalid mask";if(0===h)h=new Uint8Array(Math.ceil(m/8)),t.bitset=h,p=new Uint8Array(m),n.pixels.resultMask=p,v+=t.numBytes;else if(0<t.numBytes){h=new Uint8Array(Math.ceil(m/8));p=new DataView(x,v,t.numBytes);x=p.getInt16(0,!0);var e=2,c=0,f=0;do{if(0<x)for(;x--;)h[c++]=p.getUint8(e++);else for(f=
p.getUint8(e++),x=-x;x--;)h[c++]=f;x=p.getInt16(e,!0);e+=2}while(e<t.numBytes);if(-32768!==x||c<h.length)throw"Unexpected end of mask RLE encoding";p=new Uint8Array(m);for(e=e=x=0;e<m;e++)e&7?(x=h[e>>3],x<<=e&7):x=h[e>>3],x&128&&(p[e]=1);n.pixels.resultMask=p;t.bitset=h;v+=t.numBytes}n.ptr=v;n.mask=t;return!0},readDataOneSweep:function(x,n,v){var t=n.ptr,m=n.headerInfo,h=m.numDims,p=m.width*m.height;m=m.numValidPixel*r.getDataTypeSize(m.imageType)*h;var e=n.pixels.resultMask;if(v===Uint8Array)x=new Uint8Array(x,
t,m);else{var c=new ArrayBuffer(m);(new Uint8Array(c)).set(new Uint8Array(x,t,m));x=new v(c)}if(x.length===p*h)n.pixels.resultPixels=x;else{n.pixels.resultPixels=new v(p*h);var f=c=v=0,b=0;if(1<h)for(f=0;f<h;f++)for(b=f*p,c=0;c<p;c++)e[c]&&(n.pixels.resultPixels[b+c]=x[v++]);else for(c=0;c<p;c++)e[c]&&(n.pixels.resultPixels[c]=x[v++])}n.ptr=t+m;return!0},readHuffmanTree:function(x,n){var v=this.HUFFMAN_LUT_BITS_MAX,t=new DataView(x,n.ptr,16);n.ptr+=16;if(2>t.getInt32(0,!0))throw"unsupported Huffman version";
var m=t.getInt32(4,!0),h=t.getInt32(8,!0);t=t.getInt32(12,!0);if(h>=t)return!1;var p=new Uint32Array(t-h);r.decodeBits(x,n,p);var e=[],c;for(c=h;c<t;c++){var f=c-(c<m?0:m);e[f]={first:p[c-h],second:null}}c=x.byteLength-n.ptr;p=new ArrayBuffer(4*Math.ceil(c/4));(new Uint8Array(p)).set(new Uint8Array(x,n.ptr,c));x=new Uint32Array(p);n=0;p=0;var b=x[0];for(c=h;c<t;c++){f=c-(c<m?0:m);var d=e[f].first;0<d&&(e[f].second=b<<n>>>32-d,32-n>=d?(n+=d,32===n&&(n=0,p++,b=x[p])):(n+=d-32,p++,b=x[p],e[f].second|=
b>>>32-n))}var a=b=0,g=new z;for(c=0;c<e.length;c++)void 0!==e[c]&&(b=Math.max(b,e[c].first));a=b>=v?v:b;v=[];var l;for(c=h;c<t;c++)if(f=c-(c<m?0:m),d=e[f].first,0<d)if(h=[d,f],d<=a){f=e[f].second<<a-d;var q=1<<a-d;for(d=0;d<q;d++)v[f|d]=h}else for(f=e[f].second,q=g,--d;0<=d;d--)(l=f>>>d&1)?(q.right||(q.right=new z),q=q.right):(q.left||(q.left=new z),q=q.left),0!==d||q.val||(q.val=h[1]);return{decodeLut:v,numBitsLUTQick:a,numBitsLUT:b,tree:g,stuffedData:x,srcPtr:p,bitPos:n}},readHuffman:function(x,
n,v){var t=n.headerInfo,m=t.numDims,h=n.headerInfo.height,p=n.headerInfo.width,e=p*h,c=this.readHuffmanTree(x,n);x=c.decodeLut;var f=c.tree,b=c.stuffedData,d=c.srcPtr,a=c.bitPos,g=c.numBitsLUTQick;c=c.numBitsLUT;var l=0===n.headerInfo.imageType?128:0,q=n.pixels.resultMask,A,u,k,w,y,C,D=0;0<a&&(d++,a=0);var G=b[d],H=1===n.encodeMode,L=new v(e*m),T=L,K;for(K=0;K<t.numDims;K++){1<m&&(T=new v(L.buffer,e*K,e),D=0);if(n.headerInfo.numValidPixel===p*h)for(k=y=0;k<h;k++)for(w=0;w<p;w++,y++){var O=0;var I=
A=G<<a>>>32-g;32-a<g&&(I=A|=b[d+1]>>>64-a-g);if(x[I])O=x[I][1],a+=x[I][0];else for(I=A=G<<a>>>32-c,32-a<c&&(I=A|=b[d+1]>>>64-a-c),I=f,C=0;C<c;C++)if(I=(u=A>>>c-C-1&1)?I.right:I.left,!I.left&&!I.right){O=I.val;a=a+C+1;break}32<=a&&(a-=32,d++,G=b[d]);O-=l;H?(O=0<w?O+D:0<k?O+T[y-p]:O+D,O&=255,D=T[y]=O):T[y]=O}else for(k=y=0;k<h;k++)for(w=0;w<p;w++,y++)if(q[y]){O=0;I=A=G<<a>>>32-g;32-a<g&&(I=A|=b[d+1]>>>64-a-g);if(x[I])O=x[I][1],a+=x[I][0];else for(I=A=G<<a>>>32-c,32-a<c&&(I=A|=b[d+1]>>>64-a-c),I=f,C=
0;C<c;C++)if(I=(u=A>>>c-C-1&1)?I.right:I.left,!I.left&&!I.right){O=I.val;a=a+C+1;break}32<=a&&(a-=32,d++,G=b[d]);O-=l;H?(O=0<w&&q[y-1]?O+D:0<k&&q[y-p]?O+T[y-p]:O+D,O&=255,D=T[y]=O):T[y]=O}n.ptr=n.ptr+4*(d+1)+(0<a?4:0)}n.pixels.resultPixels=L},decodeBits:function(x,n,v,t,m){var h=n.headerInfo,p=h.fileVersion,e=0,c=new DataView(x,n.ptr,5<=x.byteLength-n.ptr?5:x.byteLength-n.ptr),f=c.getUint8(0);e++;var b=f>>6,d=0===b?4:3-b,a=0<(f&32)?!0:!1;b=f&31;f=0;if(1===d)f=c.getUint8(e),e++;else if(2===d)f=c.getUint16(e,
!0),e+=2;else if(4===d)f=c.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";d=2*h.maxZError;m=1<h.numDims?h.maxValues[m]:h.zMax;if(a){n.counter.lut++;a=c.getUint8(e);e++;h=Math.ceil((a-1)*b/8);var g=Math.ceil(h/4);g=new ArrayBuffer(4*g);var l=new Uint8Array(g);n.ptr+=e;l.set(new Uint8Array(x,n.ptr,h));e=new Uint32Array(g);n.ptr+=h;for(c=0;a-1>>>c;)c++;h=Math.ceil(f*c/8);g=Math.ceil(h/4);g=new ArrayBuffer(4*g);l=new Uint8Array(g);l.set(new Uint8Array(x,n.ptr,h));x=new Uint32Array(g);
n.ptr+=h;n=3<=p?F.unstuffLUT2(e,b,a-1,t,d,m):F.unstuffLUT(e,b,a-1,t,d,m);3<=p?F.unstuff2(x,v,c,f,n):F.unstuff(x,v,c,f,n)}else n.counter.bitstuffer++,c=b,n.ptr+=e,0<c&&(h=Math.ceil(f*c/8),g=Math.ceil(h/4),g=new ArrayBuffer(4*g),l=new Uint8Array(g),l.set(new Uint8Array(x,n.ptr,h)),x=new Uint32Array(g),n.ptr+=h,3<=p?null==t?F.originalUnstuff2(x,v,c,f):F.unstuff2(x,v,c,f,!1,t,d,m):null==t?F.originalUnstuff(x,v,c,f):F.unstuff(x,v,c,f,!1,t,d,m))},readTiles:function(x,n,v){var t=n.headerInfo,m=t.width,h=
t.height,p=t.microBlockSize,e=t.imageType,c=r.getDataTypeSize(e),f=Math.ceil(m/p),b=Math.ceil(h/p);n.pixels.numBlocksY=b;n.pixels.numBlocksX=f;var d=n.pixels.ptr=0,a=0,g=0,l=0,q=0,A=0,u=0,k=0,w=0,y=0,C=0,D=0,G=0;u=G=u=0;var H=new v(p*p),L=h%p||p,T=m%p||p,K=t.numDims,O,I=n.pixels.resultMask,P=n.pixels.resultPixels,Q=5<=t.fileVersion?14:15,U=t.zMax;for(g=0;g<b;g++)for(q=g!==b-1?p:L,l=0;l<f;l++)for(A=l!==f-1?p:T,C=g*m*p+l*p,D=m-A,O=0;O<K;O++){1<K?(G=P,C=g*m*p+l*p,P=new v(n.pixels.resultPixels.buffer,
m*h*O*c,m*h),U=t.maxValues[O]):G=null;u=x.byteLength-n.ptr;d=new DataView(x,n.ptr,Math.min(10,u));a={};u=0;k=d.getUint8(0);u++;var Y=5<=t.fileVersion?k&4:0;w=k>>6&255;y=k>>2&Q;if(y!==(l*p>>3&Q))throw"integrity issue";if(Y&&0===O)throw"integrity issue";k&=3;if(3<k)throw n.ptr+=u,"Invalid block encoding ("+k+")";if(2===k){if(Y)if(I)for(d=0;d<q;d++)for(a=0;a<A;a++)I[C]&&(P[C]=G[C]),C++;else for(d=0;d<q;d++)for(a=0;a<A;a++)P[C]=G[C],C++;n.counter.constant++;n.ptr+=u}else if(0===k){if(Y)throw"integrity issue";
n.counter.uncompressed++;n.ptr+=u;G=q*A*c;u=x.byteLength-n.ptr;G=G<u?G:u;u=new ArrayBuffer(0===G%c?G:G+c-G%c);Y=new Uint8Array(u);Y.set(new Uint8Array(x,n.ptr,G));u=new v(u);G=0;if(I)for(d=0;d<q;d++){for(a=0;a<A;a++)I[C]&&(P[C]=u[G++]),C++;C+=D}else for(d=0;d<q;d++){for(a=0;a<A;a++)P[C++]=u[G++];C+=D}n.ptr+=G*c}else if(w=r.getDataTypeUsed(Y&&6>e?4:e,w),y=r.getOnePixel(a,u,w,d),u+=r.getDataTypeSize(w),3===k)if(n.ptr+=u,n.counter.constantoffset++,I)for(d=0;d<q;d++){for(a=0;a<A;a++)I[C]&&(P[C]=Y?Math.min(U,
G[C]+y):y),C++;C+=D}else for(d=0;d<q;d++){for(a=0;a<A;a++)P[C]=Y?Math.min(U,G[C]+y):y,C++;C+=D}else if(n.ptr+=u,r.decodeBits(x,n,H,y,O),u=0,Y)if(I)for(d=0;d<q;d++){for(a=0;a<A;a++)I[C]&&(P[C]=H[u++]+G[C]),C++;C+=D}else for(d=0;d<q;d++){for(a=0;a<A;a++)P[C]=H[u++]+G[C],C++;C+=D}else if(I)for(d=0;d<q;d++){for(a=0;a<A;a++)I[C]&&(P[C]=H[u++]),C++;C+=D}else for(d=0;d<q;d++){for(a=0;a<A;a++)P[C++]=H[u++];C+=D}}},formatFileInfo:function(x){return{fileIdentifierString:x.headerInfo.fileIdentifierString,fileVersion:x.headerInfo.fileVersion,
imageType:x.headerInfo.imageType,height:x.headerInfo.height,width:x.headerInfo.width,numValidPixel:x.headerInfo.numValidPixel,microBlockSize:x.headerInfo.microBlockSize,blobSize:x.headerInfo.blobSize,maxZError:x.headerInfo.maxZError,pixelType:r.getPixelType(x.headerInfo.imageType),eofOffset:x.eofOffset,mask:x.mask?{numBytes:x.mask.numBytes}:null,pixels:{numBlocksX:x.pixels.numBlocksX,numBlocksY:x.pixels.numBlocksY,maxValue:x.headerInfo.zMax,minValue:x.headerInfo.zMin,noDataValue:x.noDataValue}}},
constructConstantSurface:function(x){var n=x.headerInfo.zMax,v=x.headerInfo.numDims,t=x.headerInfo.height*x.headerInfo.width,m=0,h=0,p=0,e=x.pixels.resultMask,c=x.pixels.resultPixels;if(e)if(1<v)for(m=0;m<v;m++)for(p=m*t,n=x.headerInfo.maxValues[m],h=0;h<t;h++)e[h]&&(c[p+h]=n);else for(h=0;h<t;h++)e[h]&&(c[h]=n);else if(1<v)for(m=0;m<v;m++)for(p=m*t,n=x.headerInfo.maxValues[m],h=0;h<t;h++)c[p+h]=n;else for(h=0;h<t;h++)c[h]=n},getDataTypeArray:function(x){switch(x){case 0:x=Int8Array;break;case 1:x=
Uint8Array;break;case 2:x=Int16Array;break;case 3:x=Uint16Array;break;case 4:x=Int32Array;break;case 5:x=Uint32Array;break;case 6:x=Float32Array;break;case 7:x=Float64Array;break;default:x=Float32Array}return x},getPixelType:function(x){switch(x){case 0:x="S8";break;case 1:x="U8";break;case 2:x="S16";break;case 3:x="U16";break;case 4:x="S32";break;case 5:x="U32";break;case 6:x="F32";break;case 7:x="F64";break;default:x="F32"}return x},isValidPixelValue:function(x,n){if(null==n)return!1;switch(x){case 0:x=
-128<=n&&127>=n;break;case 1:x=0<=n&&255>=n;break;case 2:x=-32768<=n&&32767>=n;break;case 3:x=0<=n&&65536>=n;break;case 4:x=-2147483648<=n&&2147483647>=n;break;case 5:x=0<=n&&4294967296>=n;break;case 6:x=-3.4027999387901484E38<=n&&3.4027999387901484E38>=n;break;case 7:x=4.9E-324<=n&&1.7976931348623157E308>=n;break;default:x=!1}return x},getDataTypeSize:function(x){var n=0;switch(x){case 0:case 1:n=1;break;case 2:case 3:n=2;break;case 4:case 5:case 6:n=4;break;case 7:n=8;break;default:n=x}return n},
getDataTypeUsed:function(x,n){var v=x;switch(x){case 2:case 4:v=x-n;break;case 3:case 5:v=x-2*n;break;case 6:v=0===n?x:1===n?2:1;break;case 7:v=0===n?x:x-2*n+1;break;default:v=x}return v},getOnePixel:function(x,n,v,t){x=0;switch(v){case 0:x=t.getInt8(n);break;case 1:x=t.getUint8(n);break;case 2:x=t.getInt16(n,!0);break;case 3:x=t.getUint16(n,!0);break;case 4:x=t.getInt32(n,!0);break;case 5:x=t.getUInt32(n,!0);break;case 6:x=t.getFloat32(n,!0);break;case 7:x=t.getFloat64(n,!0);break;default:throw"the decoder does not understand this pixel type";
}return x}},z=function(x,n,v){this.val=x;this.left=n;this.right=v};return{decode:function(x,n){n=n||{};var v=n.noDataValue,t=0,m={};m.ptr=n.inputOffset||0;m.pixels={};if(r.readHeaderInfo(x,m)){t=m.headerInfo;var h=t.fileVersion,p=r.getDataTypeArray(t.imageType);if(5<h)throw"unsupported lerc version 2."+h;r.readMask(x,m);t.numValidPixel===t.width*t.height||m.pixels.resultMask||(m.pixels.resultMask=n.maskData);var e=t.width*t.height;m.pixels.resultPixels=new p(e*t.numDims);m.counter={onesweep:0,uncompressed:0,
lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==t.numValidPixel)if(t.zMax===t.zMin)r.constructConstantSurface(m);else if(4<=h&&r.checkMinMaxRanges(x,m))r.constructConstantSurface(m);else{var c=new DataView(x,m.ptr,2),f=c.getUint8(0);m.ptr++;if(f)r.readDataOneSweep(x,m,p);else if(1<h&&1>=t.imageType&&1E-5>Math.abs(t.maxZError-.5)){c=c.getUint8(1);m.ptr++;m.encodeMode=c;if(2<c||4>h&&1<c)throw"Invalid Huffman flag "+c;c?r.readHuffman(x,m,p):r.readTiles(x,m,p)}else r.readTiles(x,m,p)}m.eofOffset=
m.ptr;n.inputOffset?(x=m.headerInfo.blobSize+n.inputOffset-m.ptr,1<=Math.abs(x)&&(m.eofOffset=n.inputOffset+m.headerInfo.blobSize)):(x=m.headerInfo.blobSize-m.ptr,1<=Math.abs(x)&&(m.eofOffset=m.headerInfo.blobSize));x={width:t.width,height:t.height,pixelData:m.pixels.resultPixels,minValue:t.zMin,maxValue:t.zMax,validPixelCount:t.numValidPixel,dimCount:t.numDims,dimStats:{minValues:t.minValues,maxValues:t.maxValues},maskData:m.pixels.resultMask};if(m.pixels.resultMask&&r.isValidPixelValue(t.imageType,
v)){h=m.pixels.resultMask;for(t=0;t<e;t++)h[t]||(x.pixelData[t]=v);x.noDataValue=v}m.noDataValue=v;n.returnFileInfo&&(x.fileInfo=r.formatFileInfo(m));return x}},getBandCount:function(x){for(var n=0,v=0,t={ptr:0,pixels:{}};v<x.byteLength-58;)r.readHeaderInfo(x,t),v+=t.headerInfo.blobSize,n++,t.ptr=v;return n}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(F,r,z,x,n,v){F=
F(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(t){r.mixin(this,t);this.isDataUV=t&&t.isDataUV?t.isDataUV:!1;this.computeMagnitudeAndDirection=r.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(t,m){this.inputUnit=t;this.outputUnit=m;this.unitConversionFactor=1;this._updateUnitConvFactor()},
_updateUnitConvFactor:function(){var t=v.indexOf(this.speedUnits,this.inputUnit),m=v.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=t&&0<=m){var h=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=h[t]/h[m]}},computeMagnitudeAndDirection:function(t){if(!n.isDefined(t))throw"Could not compute magnitude and direction. No pixel data is available.";var m=t.pixelBlock;if(!n.isDefined(m)||2!==m.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var h=t.extent,p=(h.xmax-h.xmin)/m.width,e=(h.ymax-h.ymin)/m.height,c=h.xmin+p/2;h=h.ymax-e/2;m.statistics[0].minValue=0;m.statistics[0].maxValue=0;var f=180/Math.PI,b=[],d=0,a=0,g=0,l=!n.isDefined(m.mask),q,A,u,k;var w=u=Infinity;var y=k=-Infinity;for(d=0;d<m.height;d++)for(a=0;a<m.width;a++,g++)if(b.push([c+p*a,h-e*d]),l||m.mask[g]){var C=q=m.pixels[0][g]*this.unitConversionFactor;var D=A=m.pixels[1][g];this.isDataUV&&(C=Math.sqrt(q*q+A*A),D=90-f*Math.atan2(A,q),m.pixels[0][g]=C*this.unitConversionFactor,
m.pixels[1][g]=D);C>y&&(y=C);C<w&&(w=C);D>k&&(k=D);D<u&&(u=D)}m.statistics[0].maxValue=y;m.statistics[0].minValue=w;m.statistics[1].maxValue=k;m.statistics[1].minValue=u;t.locations=b;return t}});z("extend-esri")&&r.setObject("layers.pixelFilters.VectorFieldPixelFilter",F,x);return F})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(F,r,z,x){var n;return r(null,{constructor:function(v){this.ctx=v.ctx;this._loadRasterFormatModule()},
decode:function(v,t){if(!t.width||!t.height)throw"Native decoding requires the image format, width and height";var m=new z,h,p=new Uint8Array(v);v=this._getFormat(v);if("error"===v)throw"invalid format";"jpeg"===v&&(h=this._getMask(p,t));var e="",c;for(c=0;c<p.length;c+=65535){var f=p.subarray(c,c+65535>p.length-1?p.length-1:c+65535);e+=String.fromCharCode.apply(null,f)}p="data:image/"+v+";base64,"+window.btoa(e);var b=new Image,d;b.src=p;var a=this;b.onload=function(){a.ctx.clearRect(0,0,t.width,
t.height);a.ctx.drawImage(b,0,0);var g=a.ctx.getImageData(0,0,b.width,b.height);d=g.data;if(h)for(c=0;c<h.length;c++)d[4*c+3]=h[c]?255:0;a.ctx.putImageData(g,0,0);m.resolve(null)};b.onerror=function(){m.reject("cannot load image")};return m},_getFormat:function(v){v=new Uint8Array(v,0,10);var t="error";255===v[0]&&216===v[1]?t="jpeg":137===v[0]&&80===v[1]&&78===v[2]&&71===v[3]&&(t="png");return t},_getMask:function(v,t){try{if(!n)throw"The zlib decoder module is not loaded.";var m=0,h=0,p=Math.round(v.length/
2);1===p%2&&(p+=1);var e=v.length-2;for(m=p;m<e&&(255!==v[m]||217!==v[m+1]);m++);p=m+=2;if(p<v.length-1){var c=(new n(v.subarray(p))).getBytes();var f=new Uint8Array(t.width*t.height);for(m=v=0;m<c.length;m++)for(h=7;0<=h;h--)f[v++]=c[m]>>h&1}}catch(b){}return f},_loadRasterFormatModule:function(){10>x("ie")||F(["./Zlib"],function(v){n=v})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(F,r,z,x,n,v,t,m){F=F(t,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(h){this._url.path+="/identify";this._handler=r.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(h,p,e,c,f){try{var b=new m(h);this._successHandler([b],"onComplete",e,f)}catch(d){this._errorHandler(d,c,f)}},execute:function(h,p,e,c){var f=c.assembly;h=this._encode(r.mixin({},this._url.query,{f:"json"},h.toJson(f&&f[0])));var b=this._handler,
d=this._errorHandler;return n({url:this._url.path,content:h,callbackParamName:"callback",load:function(a,g){b(a,g,p,e,c.dfd)},error:function(a){d(a,e,c.dfd)}})},onComplete:function(){}});v._createWrappers(F);z("extend-esri")&&r.setObject("tasks.ImageServiceIdentifyTask",F,x);return F})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(F,r,z,x,n,v){F=F(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",
constructor:function(t){t.catalogItems&&(this.catalogItems=new v(t.catalogItems));t.location&&(this.location=n.fromJson(t.location));this.catalogItemVisibilities=t.catalogItemVisibilities;this.name=t.name;this.objectId=t.objectId;this.value=t.value;this.processedValues=t.processedValues;this.properties=t.properties}});z("extend-esri")&&r.setObject("tasks.ImageServiceIdentifyResult",F,x);return F})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(F,r,z,x,n,v,t,m){F=F(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(h){var p=h&&h.geometry||this.geometry;h={geometry:p,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?z.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?z.toJson(this.renderingRule.toJson()):null};p&&(h.geometryType=m.getJsonType(p));p=this.timeExtent;h.time=p?p.toJson().join(","):null;t.isDefined(this.pixelSizeX)&&t.isDefined(this.pixelSizeY)?h.pixelSize=z.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(h.pixelSize=this.pixelSize?z.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(h.renderingRules=z.toJson(x.map(this.renderingRules,function(e){return e.toJson()})));
t.isDefined(this.returnPixelValues)&&(h.returnPixelValues=this.returnPixelValues);t.isDefined(this.maxItemCount)&&(h.maxItemCount=this.maxItemCount);return h}});n("extend-esri")&&r.setObject("tasks.ImageServiceIdentifyParameters",F,v);return F})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(F,r,z){var x;return F(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(n){this.stretchType=n.stretchType||n.StretchType||this.stretchType;this.min=n.min||n.Min||this.min;this.max=n.max||n.Max||this.max;this.numberOfStandardDeviations=n.numberOfStandardDeviations||n.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=n.statistics||n.Statistics||this.statistics;this.dra=n.dra||n.DRA||n.dRA||this.dra;this.minPercent=n.minPercent||n.MinPercent||
this.minPercent;this.maxPercent=n.maxPercent||n.MaxPercent||this.maxPercent;this.useGamma=n.useGamma||n.UseGamma||this.useGamma;this.gamma=n.gamma||n.Gamma||this.gamma;this.computeGamma=n.computeGamma||n.ComputeGamma||this.computeGamma;this.raster=n.raster||n.Raster||this.raster;this.outputPixelType=n.outputPixelType||n.OutputPixelType||this.outputPixelType;this.raster=n.raster||n.Raster||this.raster;x=this},filter:function(n){if(void 0!==n&&null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var v=
n.pixelBlock,t=v.pixels,m=v.width*v.height,h=t.length,p;(p=6===x.stretchType||3===x.stretchType&&x.dra)&&x._calculateStatisticsHistograms(n);if(x.dra)if(p)x._statistics=v.statistics,x._histograms=v.histograms;else{var e=v.statistics;x._statistics=[];for(p=0;p<h;p++)x._statistics[p]=[e[p].minValue,e[p].maxValue,0,0]}else x._statistics=x.statistics,x._histograms=x.histograms;x.computeGamma&&(x.gamma=x._computeGammaValues(v.pixelType),x.useGamma=!0);x._createLUT(n);if(void 0===x.LUT||null===x.LUT)return x._filterNoLUT(n);
e=x.LUT;var c=x.LUTOffset;for(p=0;p<h;p++){var f=e[p];for(v=0;v<m;v++){var b=t[p][v];t[p][v]=f[b-c]}}n.pixelBlock.pixelType="U8";return n}},_calculateStatisticsHistograms:function(n){n=n.pixelBlock;var v=n.pixelType,t=n.pixels,m=n.mask,h=t.length,p,e,c=function(k){this.min=-.5;this.max=255.5;this.size=256;r.mixin(this,k);this.counts=this.counts||new Uint32Array(this.size)},f=[],b,d;for(p=0;p<h;p++){var a=new c;var g=a.counts;var l=t[p];if("U8"===v)if(m)for(e=0;e<n.width*n.height;e++)m[e]&&g[l[e]]++;
else for(e=0;e<n.width*n.height;e++)g[l[e]]++;else{var q=n.statistics[p].minValue;var A=n.statistics[p].maxValue;a.min=q;a.max=A;A=(A-q)/256;var u=new Uint32Array(257);if(m)for(e=0;e<n.width*n.height;e++)m[e]&&u[Math.floor((l[e]-q)/A)]++;else for(e=0;e<n.width*n.height;e++)u[Math.floor((l[e]-q)/A)]++;for(e=0;255>e;e++)g[e]=u[e];g[255]=u[255]+u[256]}f.push(a);l=[];q=n.statistics[p].minValue;A=n.statistics[p].maxValue;for(e=d=b=u=0;e<a.size;e++)u+=g[e],b+=e*g[e];b/=u;for(e=0;e<a.size;e++)d+=g[e]*Math.pow(e-
b,2);g=Math.sqrt(d/(u-1));e=(b+.5)*(a.max-a.min)/a.size+a.min;a=g*(a.max-a.min)/a.size;l.push(q);l.push(A);l.push(e);l.push(a);n.statistics[p]=l}n.histograms=f},_getCutOffPoints:function(n){n=n.pixelBlock.pixels.length;var v=[],t=[],m,h,p;switch(x.stretchType){case 5:for(h=0;h<n;h++)v[h]=x._statistics[h][0],t[h]=x._statistics[h][1];break;case 3:for(h=0;h<n;h++)v[h]=x._statistics[h][2]-x.numberOfStandardDeviations*x._statistics[h][3],t[h]=x._statistics[h][2]+x.numberOfStandardDeviations*x._statistics[h][3],
v[h]<x._statistics[h][0]&&(v[h]=x._statistics[h][0]),t[h]>x._statistics[h][1]&&(t[h]=x._statistics[h][1]);break;case 6:for(h=0;h<n;h++){var e=x._histograms[h];var c=new Uint32Array(e.size);var f=e.counts;for(p=m=0;p<e.size;p++)m+=f[p],c[p]=m;f=x.minPercent*m/100;for(p=1;p<e.size;p++)if(c[p]>f){v[h]=e.min+(e.max-e.min)/e.size*(p-.5);break}f=(1-x.maxPercent/100)*m;for(p=e.size-2;0<=p;p--)if(c[p]<f){t[h]=e.min+(e.max-e.min)/e.size*(p+.5);break}}break;default:for(h=0;h<n;h++)v[h]=0,t[h]=255}return{minCutOff:v,
maxCutOff:t}},_createLUT:function(n){var v=n.pixelBlock,t=v.pixelType;if("U8"===t||"U16"===t||"S8"===t||"S16"===t){if(x._LUTSignature&&(t=x._computeLutSignature(),t.length===x._LUTSignature.length&&!t.some(function(w,y){return w!==x._LUTSignature[y]})))return;t=v.pixels.length;var m=[],h=[],p=[],e,c=x.max,f=x.min,b=x.gamma,d=c-f,a=x._getCutOffPoints(n);n=a.minCutOff;a=a.maxCutOff;var g=0,l=256;"S8"===v.pixelType?g=-127:"S16"===v.pixelType&&(g=-32767);if("U16"===v.pixelType||"S16"===v.pixelType)l=
65536;for(v=0;v<t;v++)m[v]=a[v]-n[v];if(x.useGamma&&null!==b&&b.length===t)for(v=0;v<t;v++)p[v]=1<b[v]?2<b[v]?6.5+Math.pow(b[v]-2,2.5):6.5+100*Math.pow(2-b[v],4):1;if(x.useGamma)for(v=0;v<t;v++){var q=[];for(e=0;e<l;e++){var A=e+g;var u=(A-n[v])/m[v];var k=1;1<b[v]&&(k-=Math.pow(1/d,u*p[v]));A<a[v]&&A>n[v]?q[e]=Math.floor(k*d*Math.pow(u,1/b[v]))+f:A>a[v]?q[e]=c:A<n[v]&&(q[e]=f)}h[v]=q}else for(v=0;v<t;v++){q=[];for(e=0;e<l;e++)A=e+g,q[e]=A<n[v]?f:A>a[v]?c:Math.floor((A-n[v])/m[v]*d)+f;h[v]=q}x.LUT=
h;x.LUTOffset=g;x._LUTSignature=x._computeLutSignature()}},_computeLutSignature:function(){var n=[],v,t;n.push(x.stretchType);n.push(x.min);n.push(x.max);n.push(x.numberOfStandardDeviations);if(x._statistics)for(v=0;v<x._statistics.length;v++)for(t=0;t<x._statistics[v].length;t++)n.push(x._statistics[v][t]);n.push(x.dra?1:0);n.push(x.minPercent);n.push(x.maxPercent);if(x.gamma)for(v=0;v<x._statistics.length;v++)n.push(x.gamma[v]);n.push(x.useGamma?1:0);return n},_filterNoLUT:function(n){if(null!==
n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var v=n.pixelBlock,t=v.pixels,m=v.mask;v=v.width*v.height;var h=t.length,p=[],e=[],c,f=x.max,b=x.min,d=x.gamma,a=f-b;var g=x._getCutOffPoints(n);var l=g.minCutOff,q=g.maxCutOff;for(g=0;g<h;g++)p[g]=q[g]-l[g];if(x.useGamma&&null!==d&&d.length===h)for(g=0;g<h;g++)e[g]=1<d[g]?2<d[g]?6.5+Math.pow(d[g]-2,2.5):6.5+100*Math.pow(2-d[g],4):1;if(x.useGamma)if(void 0!==m&&null!==m)for(c=0;c<v;c++){if(m[c])for(g=0;g<h;g++){var A=t[g][c];var u=(A-l[g])/p[g];
var k=1;1<d[g]&&(k-=Math.pow(1/a,u*e[g]));A<q[g]&&A>l[g]?t[g][c]=Math.floor(k*a*Math.pow(u,1/d[g]))+b:A>q[g]?t[g][c]=f:A<l[g]&&(t[g][c]=b)}}else for(c=0;c<v;c++)for(g=0;g<h;g++)A=t[g][c],u=(A-l[g])/p[g],k=1,1<d[g]&&(k-=Math.pow(1/a,u*e[g])),A<q[g]&&A>l[g]?t[g][c]=Math.floor(k*a*Math.pow(u,1/d[g]))+b:A>q[g]?t[g][c]=f:A<l[g]&&(t[g][c]=b);else if(void 0!==m&&null!==m)for(c=0;c<v;c++){if(m[c])for(g=0;g<h;g++)A=t[g][c],A<q[g]&&A>l[g]?t[g][c]=Math.floor((A-l[g])/p[g]*a)+b:A>q[g]?t[g][c]=f:A<l[g]&&(t[g][c]=
b)}else for(c=0;c<v;c++)for(g=0;g<h;g++)A=t[g][c],A<q[g]&&A>l[g]?t[g][c]=Math.floor((A-l[g])/p[g]*a)+b:A>q[g]?t[g][c]=f:A<l[g]&&(t[g][c]=b);n.pixelBlock.pixelType="U8";return n}},_computeGammaValues:function(n){var v=this._statistics.length,t,m=[];for(t=0;t<v;t++){var h=this._statistics[t][2];"U8"!==n&&(h=255*(h-this._statistics[t][0])/(this._statistics[t][1]-this._statistics[t][0]));m.push(this._computeGammaValue(h))}return m},_computeGammaValue:function(n){if(0!==n&&!(255<n||0>n)){var v=0;0<n&&
150!=n&&255>n&&(v=150>=n?45*Math.cos(.01047*n):17*Math.sin(.021*n));v=Math.log((n+v)/255);if(0!==v&&(n=Math.log(n/255)/v,!isNaN(n)))return Math.min(9.9,Math.max(.01,n))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k){F=F([b],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(w,y){y=y||{};y.mode&&y.mode!==b.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=b.MODE_STREAM,this._mode=new d(this));this.purgeOptions=new k(this,y.purgeOptions||{});this.purgeInterval=y.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=n.hitch(this,this._attemptReconnect);this._purge=n.hitch(this,this._purge);this._processServiceJson=n.hitch(this,this._processServiceJson);if(n.isObject(w)&&w.layerDefinition)this._initFeatureLayer(w,y);else{var C=this;c({url:w,content:n.mixin({f:"json"}),callbackParamName:"callback"}).then(function(D){C._processServiceJson(D,y)},function(D){C._errorHandler(D)})}},_processServiceJson:function(w,
y){var C=this;w.relatedFeatures&&w.relatedFeatures.featuresUrl&&w.relatedFeatures.joinField?(this._relatedUrl=w.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=w.relatedFeatures.joinField,c({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(D){D=D.fields||[];var G=z.map(w.fields,function(H){return H.name.toLowerCase()});z.forEach(D,function(H){-1===z.indexOf(G,H.name.toLowerCase())&&w.fields.push(H)});y.resourceInfo=w;C._initFeatureLayer(C._url,y)},
function(D){C.onError({error:D})})):(y.resourceInfo=w,this._initFeatureLayer(this._url,y))},_initLayer:function(w,y){this.inherited(arguments);if(w){var C;if(w.layerDefinition)this.purgeOptions=new k(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||w.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var D=this._getWebsocketConnectionInfo(w),G=D.urls;G&&G.length?(this._socketUrls=G,this.socketUrl=G[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=D.token,G.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=G.length)):(this.socketUrl=void 0,D="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(D+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(D)))}if(this._params.filter)try{this._filter=
C=this._makeFilter(this._params.filter)}catch(H){this.onError(Error("Error trying to create filter object: "+H+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){C=C||{};C.geometry=this._params.geometryDefinition;C.outFields=this._outFields;C.where=this._defnExpr;try{this._filter=C=this._makeFilter(C)}catch(H){this.onError(Error("Error trying to create filter object: "+H+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=w.keepLatestArchive?w.keepLatestArchive.featuresUrl:null;w.relatedFeatures&&w.relatedFeatures.featuresUrl&&w.relatedFeatures.joinField&&(this._relatedUrl=w.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=w.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(w){var y=this.inherited(arguments),C=this._getRenderer();this.timeInfo&&(this._trackIdField||C&&(C.latestObservationRenderer||C.trackRenderer))&&(this._trackManager=new a(this),this._trackManager.initialize(w));this.socketUrl&&!this._connected&&this._map&&this.connect();return y},_unsetMap:function(w,
y){z.forEach(this._connects,r.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(w){}this.inherited(arguments);this._trackManager&&this._trackManager.createTracklineContainer()},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(w){this.setFilter({where:w})},getDefinitionExpression:function(){if(this._filter)var w=this._filter.where;return w},destroy:function(){this.disconnect();this.inherited(arguments)},
onResume:function(w){this.inherited(arguments)},setGeometryDefinition:function(w){this.setFilter({geometry:w})},getGeometryDefinition:function(){if(this._filter)var w=this._filter.geometry;return w},connect:function(w){var y=new v,C={},D=this._filter,G,H,L=this.socketUrl,T;try{this._connected||this._connecting?y.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&
(C.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(C.outSR=this._map.spatialReference.wkid);if(D)for(H in D)null!==D[H]&&(G="geometry"===H?JSON.stringify(D[H]):D[H],C[H]=G);L+="?"+m.objectToQuery(C);T=this._createConnection(L,w);y.resolve(T)}.bind(this)).otherwise(function(K){y.reject(K)}))}catch(K){w&&(w(K,!1),y.reject(K)),this.onConnectionError({error:K})}return y.promise},disconnect:function(w){var y=
this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",C=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:C,message:y});w&&w(null,!0)},setFilter:function(w){if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==
w.outFields){var y=Error("Outfields property cannot be changed after layer is created");this.onFilterChange({filter:this.getFilter(),error:y});return!1}var C=this._makeFilter(w)}catch(D){return y=Error(D),this.onFilterChange({filter:this.getFilter(),error:y}),!1}if(this.socket)w={filter:C},this.socket.send(JSON.stringify(w));else h.once(this,"connect",function(D){this.setFilter(C)});return!0},getFilter:function(){var w=this._filter,y={},C=["geometry","outFields","where"];w&&z.forEach(C,function(D){var G=
w[D];G&&("geometry"===D?G=g.fromJson(G):"outFields"===D&&(G=G.split(",")),y[D]=G)});return y},setMaximumTrackPoints:function(w){if(!w&&0!==w)return!1;this.maximumTrackPoints=w;this._mode.propertyChangeHandler(3)},getUniqueValues:function(w){var y={},C=[];var D=this._getField(w,!0);if(!D)return C;w=D.name;z.forEach(this.graphics||[],function(G){G=(G.attributes||{})[w];void 0===G||y[G]||(y[G]=1,C.push(G))});C.sort(function(G,H){return G<H?-1:G>H?1:0});return C},getLatestObservations:function(){var w=
[];return w=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(w){var y=this.purgeInterval;this.purgeInterval=w;this._togglePurgeT();w&&this._togglePurgeT(!0);if(y!==w)this.onPurgeIntervalChange();return this},_togglePurgeT:function(w){if(w&&this.purgeInterval){var y=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){y.updating||y.suspended||(y._mode._flushDrawBuffer(),y._togglePurgeT(!0))},
6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._purgeT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(w,y){var C=this,D=new WebSocket(w);D.onopen=function(){C.socket=D;C._connected=!0;C._connecting=!1;C._reconnecting=!1;C._reconnectAttempts=0;C._bind();C.onConnect();y&&y(null,!0)};D.onclose=
function(G){var H=!0,L=C._connected,T=null;if(C._connected||C._reconnecting){if(G.code){var K="Connection failed: ";if(1001===G.code)K+=G.reason||"Service is going away.",H=!1;else if(4400===G.code)K+=G.reason||"Invalid url parameters. Check filter properties.",H=!1;else if(4404===G.code)K+="Service not found",H=!1;else if(4401===G.code||4403===G.code)K+="Not authorized",H=!1}H&&(C._reconnectAttempts+=1,C._reconnectAttempts>C.maxReconnectAttempts&&(K="Maximum reconnect attempts exceeded",H=!1,L=!0));
C._connected=!1;L&&(K&&(T=Error(K)),C.onDisconnect({error:T,willReconnect:H}));H?C._attemptReconnect():C.socket=null}else C.socket||(T=Error("Could not make connection to service"),C.onConnectionError({error:T})),C.socket=null,C._connected=!1};D.onerror=function(G){console.log("Socket error")};return D},_getKeepLatestFeatures:function(){var w=new v;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._keepLatestUrl).then(function(){w.resolve()}.bind(this)).otherwise(function(y){w.reject(y)}).always(function(){this._keepLatestQueried=
!0}.bind(this)):w.resolve();return w.promise},_getRelatedFeatures:function(){var w=new v;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._relatedUrl).then(function(){w.resolve()}.bind(this)).otherwise(function(y){w.reject(y)}).always(function(){this._relatedQueried=!0}.bind(this)):w.resolve();return w.promise},_purge:function(){var w,y=[];if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(w=0;w<this.graphics.length-
this.purgeOptions.displayCount;w++){var C=this.graphics[w];y.push(C)}0<y.length&&(this._mode._removeFeatures(y),this._trackManager&&this._trackManager.removeFeatures(y))},_bind:function(){var w=this;this.socket.onmessage=function(y){w._onMessage(JSON.parse(y.data))}},_onMessage:function(w){var y=this;this.onMessage(w);var C={create:function(D){y._create(D)},update:function(D){y._update(D)},"delete":function(D){y._delete(D)}};if(w.type)C[w.type](w.feature);else w.hasOwnProperty("filter")?y._handleFilterMessage(w):
this._create(w)},_create:function(w){function y(G){if(!C._featureHasOID(G,D)){if(!G.geometry)return!1;G.attributes=G.attributes||{};G.attributes[D]=C._nextId++}G=G.declaredClass?G:new f(G);C._mode.drawFeature(G)}var C=this,D=C.objectIdField;w.length?w.forEach(function(G){G&&y(G)}):w&&y(w)},_delete:function(w){var y=this,C=w[y.objectIdField]||w.attributes[y.objectIdField],D=!1;this.graphics.forEach(function(G){G.attributes[y.objectIdField]==C&&(D=G)});D&&this.remove(D)},_update:function(w){var y=this,
C=!1;this.graphics.forEach(function(D){D.attributes[y.objectIdField]==w.attributes[y.objectIdField]&&(C=D)});C&&(w.attributes&&C.setAttributes(w.attributes),w.geometry&&C.setGeometry(g.fromJson(w.geometry)))},_makeFilter:function(w){var y=null;w=w||{};if(void 0!==w.geometry)if(y=y||{},null===w.geometry)y.geometry=null;else{var C="string"===typeof w.geometry?g.fromJson(JSON.parse(w.geometry)):w.geometry.declaredClass?w.geometry:g.fromJson(w.geometry);if(!C||"point"===C.type)throw"Query object contains invalid geometry";
"extent"!==C.type&&(C=C.getExtent());if(!C||0===C.getHeight()&&0===C.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";y.spatialRel="esriSpatialRelIntersects";y.geometryType="esriGeometryEnvelope";y.geometry=C.toJson()}void 0!==w.where&&(y=y||{},y.where=w.where);if(void 0!==w.outFields&&(y=y||{},w="string"===typeof w.outFields?"*"===w.outFields?null:w.outFields.replace(/,\s+/g,",").split(","):null===w.outFields?null:w.outFields,w=this._makeOutFields(w))){if(w.errors&&
0<w.errors.length)throw"Invalid filter outFields. "+w.errors.join(",");y.outFields=w.fields?w.fields.join(","):null}return y},_makeOutFields:function(w){var y=this,C=[],D=[],G={fields:null};if(!w||0===w.length)return G;z.forEach(w,function(H){if("*"===H)return G;var L=y._getField(H,!0);L?C.push(L.name):D.push("Field named "+H+" not found in schema.")});w=y._getOutFields();z.forEach(w,function(H){y._getField(H)&&-1===z.indexOf(C,H)&&C.push(H)});G.fields=C;G.errors=D;return G},_handleFilterMessage:function(w){w.error?
(w=Error(w.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:w})):(w=w.filter,w.geometry&&"string"===typeof w.geometry&&(w.geometry=JSON.parse(w.geometry)),this._filter=w,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(w){var y={urls:[]},C,D=[],G=[],H;w.streamUrls&&z.forEach(w.streamUrls,function(K){"ws"===K.transport&&(C=K.urls,y.token=K.token)});if(!C)return y;z.forEach(C,function(K){0===K.lastIndexOf("wss",0)?G.push(K):D.push(K)});w="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?G:0===D.length?G:D;if(1<w.length)for(H=0;H<w.length-1;H++){var L=H+Math.floor(Math.random()*(w.length-H));var T=w[L];w[L]=w[H];w[H]=T}y.urls=w;return y},_attemptReconnect:function(){var w=this;this._reconnectTimeoutId=null;w._connected=!1;if(!w._socketUrls)return!1;if(!w._collection&&!w._reconnecting&&w.socket&&w.credential)return w._reconnecting=!0,w._getServiceConnectionMetadata(w._attemptReconnect),!1;w._reconnecting=!0;w.socket=null;if(w._reconnectAttempts>
w.maxReconnectAttempts)return w._reconnecting=!1;w.socketUrl=w._socketUrls[w._reconnectAttempts>w._socketUrls.length-1?w._reconnectAttempts%w._socketUrls.length:w._reconnectAttempts];w.socketUrl+="/"+w.socketDirection;var y=w._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){w.onAttemptReconnect({count:w._reconnectAttempts,url:w.socketUrl});w.connect()},1E3*w._reconnectAttempts+y)},_getServiceConnectionMetadata:function(w){var y=this,C=y._url.path;w="function"===typeof w?
w:null;c({url:C,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(D){D=y._getWebsocketConnectionInfo(D);y._websocketToken=D.token;w&&w()},function(D){y.onError(Error(D))})},_setDefaultRenderer:function(){var w=this.geometryType,y=new x([5,112,176,.8]),C=new x([255,255,255]);C=new q(q.STYLE_SOLID,C,1);if("esriGeometryPoint"===w||"esriGeometryMultipoint"===w)var D=new A(A.STYLE_CIRCLE,10,C,y);else if("esriGeometryPolyline"===w)D=new q(q.STYLE_SOLID,y,2);else if("esriGeometryPolygon"===
w||"esriGeometryEnvelope"===w)y=new x([5,112,176,.2]),C=new x([5,112,176,.8]),C=new q(q.STYLE_SOLID,C,1),D=new l(l.STYLE_SOLID,C,y);D&&this.setRenderer(new u(D))},_makeObjectIdField:function(){var w=1,y,C=[];if(!this.objectIdField){var D=this.fields.length;for(y=0;y<D;y++)C.push(this.fields[y].name.toLowerCase());for(;-1!==z.indexOf(C,"objectid_"+w);)w+=1;this.objectIdField="objectid_"+w;this.fields.push({name:"objectid_"+w,type:"esriFieldTypeOID",alias:"objectid_"+w,nullable:!1})}},_featureHasOID:function(w,
y){return w.attributes&&(w.attributes[y]||0===w.attributes[y])},_randomIntFromInterval:function(w,y){return Math.floor(Math.random()*(y-w+1)+w)}});t("extend-esri")&&n.setObject("layers.StreamLayer",F,e);return F})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Point ../geometry/Polyline ./TrackManager".split(" "),function(F,r,z,x,n,v,t,m,h){F=F([h],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(p){this.inherited(arguments);
var e=p.getMap().spatialReference;this.isWebMercator=e.isWebMercator();this.canWrap=e._isWrappable();this.wrapThreshold=this.isWebMercator?2.0037508342788905E7:180},initialize:function(p){this.inherited(arguments)},addFeatures:function(p,e){function c(A,u){var k,w;a[A]||(a[A]=[]);A=a[A];if(0<q){u.length>q&&u.splice(0,u.length-q);var y=u.length+A.length;y>q&&(k=A.splice(0,y-q))}y=u.length;for(w=0;w<y;w+=1)A.push(u[w]);return{deletes:k,adds:u}}var f={},b={},d;if(e)return this.inherited(arguments),f;
var a=this.trackMap;var g=this.layer;var l=g._trackIdField;var q=g.maximumTrackPoints||0;z.forEach(p,function(A){var u=A.attributes[l];A.visible&&(b[u]||(b[u]=[]),b[u].push(A))});for(d in b)b.hasOwnProperty(d)&&(g=c(d,b[d]),f[d]=g);return f},removeFeatures:function(p){var e=[],c=this.layer.objectIdField,f=this.layer._trackIdField;p&&(z.forEach(p,function(b){var d;var a=b.attributes[f];var g=b.attributes[c];if(d=this.trackMap[a])for(b=0;b<d.length;b+=1){var l=d[b];if(l.attributes[c]===g){this.trackMap[a].splice(b,
1);-1===z.indexOf(a)&&e.push(a);break}}},this),0<p.length&&this.refreshTracks(e))},drawTracks:function(p){function e(l){var q=d[l],A=q&&1<q.length,u=c.trackLineMap[l];u&&!A&&(f.remove(u),delete c.trackLineMap[l],u=null);if(!A)return!1;A=[];for(var k=[],w,y=q.length,C=0;C<y;C++)if(w=q[C].geometry){w=w.normalize();var D=w.x,G=0,H=!1;L&&c.canWrap&&(G=D-L.x,Math.abs(G)>c.wrapThreshold&&(H=!0));H?(k.push([c.getWrappedX(D),w.y]),A.push(k.slice(0)),k=[[D,w.y]]):k.push([D,w.y]);var L=new t(D,w.y,a)}1<k.length&&
A.push(k);q={};q[g]=l;if(A.length)if(u){for(var T=u.geometry;T.paths.length;)T.removePath(T.paths.length-1);A.forEach(function(K){T.addPath(K)});u.setGeometry(T)}else u=new v(new m({paths:A,spatialReference:a}),null,q),f.add(u),c.trackLineMap[l]=u}var c=this,f=this.container,b;if(f){var d=this.trackMap;var a=this.map.spatialReference;var g=this.layer._trackIdField;if(p)z.forEach(p,function(l){e(l)});else for(b in d)d.hasOwnProperty(b)&&e(b)}},refreshTracks:function(p){function e(d){var a;d=c[d]||
[];var g=d.length;for(a=0;a<g;a++)f._repaint(d[a],null,!0)}var c=this.trackMap,f=this.layer,b;this.drawTracks(p);if(p)z.forEach(p,function(d){e(d)});else for(b in c)c.hasOwnProperty(b)&&e(b)},getLatestObservations:function(){var p,e=this.trackMap,c=[];for(p in e)if(e.hasOwnProperty(p)){var f=e[p];c.push(f[f.length-1])}return c},destroy:function(){this.inherited(arguments);this.trackLineMap=null},getWrappedX:function(p){var e=this.isWebMercator,c=e?2.0037508342788905E7:180;e=e?-2.0037508342788905E7:
-180;return(0<p?e:c)-((0<p?c:e)-p)}});x("extend-esri")&&r.setObject("layers._StreamTrackManager",F,n);return F})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(F,r,z,x,n){F=F([z],{declaredClass:"esri.layers.PurgeOptions",constructor:function(v,t){this.parent=v;for(var m in t)this[m]=t[m]},_displayCountSetter:function(v){this.displayCount=v;this.parent.refresh()}});x("extend-esri")&&r.setObject("layers.PurgeOptions",
F,n);return F})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(F,r,z,x,n,v,t){F=F([v,t],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(m,h){this._initialize(m,h);this.useMapImage=h&&h.useMapImage||!1},refresh:function(m){if(m)this.inherited(arguments);else{var h=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);
this.disableClientCaching=h}},setRenderer:function(m,h){this.renderer=m;this.onRendererChange();h||this.refresh(!0)},exportMapImage:function(m,h){var p=n.defaults.map;m=r.mixin({size:p.width+","+p.height},this._params,m?m.toJson(this.normalization):{},{f:"json"});delete m._ts;this._exportMapImage(this._url.path+"/exportImage",m,h)}});z("extend-esri")&&r.setObject("layers.ArcGISImageServiceLayer",F,x);return F})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){F=F([m,h],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(d,a){this.symbolTileSize=a&&a.symbolTileSize?a.symbolTileSize:50;this._maxMag=this._minMag=null;var g=r.clone(this._params);delete g.imageServiceParameters;delete g.pixelFilter;delete g.rendererStyle;delete g.symbolTileSize;this._initialize(d,a);this.renderer||this.setVectorRendererStyle(a&&a.rendererStyle?a.rendererStyle:p.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";r.mixin(this._params,g)},getField:function(d){return this._getField(d,!0)},setVectorRendererStyle:function(d){this.rendererStyle=d;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(d){if(10>n("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(this._map){this.setImageFormat("LERC",!0);d=this.fullExtent&&this.fullExtent.xmin;var a=this.fullExtent&&this.fullExtent.ymax,g=r.clone(this._map.extent),l=1/this.symbolTileSize*this._map.width;l=l?Math.ceil(l):50;var q=1/this.symbolTileSize*this._map.height;q=q?Math.ceil(q):Math.ceil((g.ymax-g.ymin)/(g.xmax-g.xmin)*l);var A=(g.xmax-g.xmin)/l,u=(g.ymax-g.ymin)/q;
g.xmin=d+Math.floor((g.xmin-d)/A)*A;g.xmax=d+Math.ceil((g.xmax-d)/A)*A;g.ymin=a+Math.floor((g.ymin-a)/u)*u;g.ymax=a+Math.ceil((g.ymax-a)/u)*u;this._requestData(g,l,q)}},_drawPixelData:function(){this.clear();if(this.pixelData){var d=this.pixelData.pixelBlock,a=this.pixelData.extent,g=this.pixelData.locations,l=t.isDefined(d.mask)&&0<d.mask.length;if(d&&a&&g){if(this.useDefaultRenderer&&this.renderer&&(!t.isDefined(this._minMag)||!t.isDefined(this._maxMag))){var q=this._getServiceMinMaxStats();q?(this._minMag=
q.min,this._maxMag=q.max):(this._minMag=d.statistics[0].minValue,this._maxMag=d.statistics[0].maxValue);q={type:"sizeInfo",minSize:b.px2pt(.2*this.symbolTileSize),maxSize:b.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag};var A=[];A.push(q);A.push({type:"colorInfo"});this.renderer.setVisualVariables(A)}var u=A=q=0,k=a.spatialReference?a.spatialReference._getInfo():null;for(q=0;q<d.height;q++)for(A=0;A<d.width;A++,u++){var w=g[u];if((!l||d.mask[u])&&w&&2===w.length){w=
new e(w[0],w[1],a.spatialReference);k&&(w.x=c.prototype._normalizeX(w.x,k).x);var y={Magnitude:d.pixels[0][u],Direction:d.pixels[1][u],Location:x.toJson(w.toJson())};w=new f(w,null,y);this.add(w)}}}}},_getServiceMinMaxStats:function(){if(!t.isDefined(this.minValues)||!t.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var d=this.minValues[0],a=this.maxValues[0],g=this.minValues[1],l=this.maxValues[1];if(this.pixelFilter&&d&&a&&g&&l){var q=[];q.push([d,a]);q.push([g,
l]);g=this._createPixelData(q);this.pixelFilter(g);g&&g.pixelBlock&&g.pixelBlock.pixels&&0<g.pixelBlock.pixels.length&&(d=g.pixelBlock.pixels[0][0],a=g.pixelBlock.pixels[0][1])}return d&&a?{min:d,max:a}:null},_updateVectorFieldRenderer:function(){var d={type:"sizeInfo",minSize:b.px2pt(.2*this.symbolTileSize),maxSize:b.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},a=[];a.push(d);d=new p({style:this.rendererStyle,visualVariables:a,flowRepresentation:this._vectorFlowRepresentation});
this.setRenderer(d)},_getField:function(d,a){if(t.isDefined(d))return a&&(d=d.toLowerCase()),"magnitude"!==d&&"direction"!==d?null:{name:d,alias:d,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(d){"CancelError"!==d.name&&(this.clear(),this.onError(d))},_setFlowRepresentation:function(d){this.renderer&&this.renderer.flowRepresentation?this._vectorFlowRepresentation=this.renderer.flowRepresentation:d&&this.renderer&&t.isDefined(d.FlowDirection)&&d.FlowDirection&&
(this._vectorFlowRepresentation="oceanographic"===d.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});n("extend-esri")&&r.setObject("layers.ArcGISImageServiceVectorLayer",F,v);return F})},"jimu/LayerInfos/LayerInfoForDefaultDynamicShipFeatureLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred esri/layers/FeatureLayer esri/tasks/query ./LayerInfoForDefaultDynamic".split(" "),
function(F,r,z,x,n,v){return F(v,{_msShipFeatureLayerId:null,_msOwnedFeatureLayerDef:null,_msOwnedLayerInfo:null,constructor:function(t,m){this._msShipFeatureLayerId=t.msShipFLayerId},_initAfterRootLayerInfo:function(){var t=this.map.getLayer(this._msShipFeatureLayerId);t&&this._initPopupInfo(t)},_initPopupInfo:function(t){var m=this.originOperLayer.mapService.layerInfo,h=this.originOperLayer.mapService.subId;t&&(t.infoTemplate?(m.controlPopupInfo.infoTemplates[h]={infoTemplate:t.infoTemplate,layerUrl:this.getUrl()},
this.enablePopup()):(m.controlPopupInfo.infoTemplates[h]={infoTemplate:null,layerUrl:this.getUrl()},this.disablePopup()))},_initMSOwnedFeatureLayer:function(){var t=this.map.getLayer(this.id),m=this.map.getLayer(this._msShipFeatureLayerId);if(m&&!t){this._msOwnedFeatureLayerDef=new z;t=new x(m.url,r.mixin({},m));t.id=this.id;t.visible=this.isShowInMap();r.setObject("_wabProperties.isMSOwnedFeatureLayer",!0,t);this.map.addLayer(t);this._initMsOwnedLayerInfo(t);var h=t.on("load",r.hitch(this,function(){this.layerObject=
t;this._msOwnedFeatureLayerDef.resolve(t);h.remove&&h.remove()}))}},_initMsOwnedLayerInfo:function(t){this._msOwnedLayerInfo=this._layerInfoFactory.create({layerObject:t,title:this.title+"_owned_",id:t.id},this.map)},_msShipIsValid:function(){var t=this.map.getLayer(this._msShipFeatureLayerId),m=this.map.getLayer(this.id);return t&&m},getMSShipFeatures:function(t){var m=new z,h=this.map.getLayer(this._msShipFeatureLayerId);if(t&&h){var p=new n;p.objectIds=t.map(r.hitch(this,function(e){return e.attributes[h.objectIdField]}));
h.queryFeatures(p,r.hitch(this,function(e){m.resolve(e.features)}),r.hitch(this,function(){m.resolve(null)}))}else m.resolve(null);return m}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(F,r){return F(r,{constructor:function(z,x){this.isTiled=!0},_initVisible:function(){},_setTopLayerVisible:function(z){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(z){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},
"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),function(F,r,z,x,n,v,t,m){return F(v,{_layerObjectFacory:null,constructor:function(){this.newSubLayers=[];this.isTable=!0;this._layerObjectFacory=new t(this)},init:function(){},_getLayerObject:function(){var h=new x;this._layerObjectFacory.getLayerObject().then(r.hitch(this,function(p){this.layerObject.empty&&
p&&(this.layerObject=p,this._bindEventAfterLayerObjectLoaded());h.resolve(p)}));return h},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var h=this.getPopupInfo();h||!this.layerObject||this.layerObject.empty||(h=this._getDefaultPopupInfo(this.layerObject));return h},loadPopupInfo:function(){var h=new x,p=this.getPopupInfo();p?h.resolve(p):this.getLayerObject().then(r.hitch(this,function(){p=this._getDefaultPopupInfo(this.layerObject);h.resolve(p)}));
return h},getLayerType:function(){var h=new x;h.resolve("Table");return h},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return z.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new m(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var h=
n.after(this.layerObject,"setDefinitionExpression",r.hitch(this,this._onFilterChanged));this._eventHandles.push(h)},getFilter:function(){if(this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression){var h=this.layerObject.getDefinitionExpression();void 0===h&&(h=this.getFilterOfWebmap())}else h=this.getFilterOfWebmap();return h}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault ../utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return F(h,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(e){10.2<=this.layerObject.version?this._legendRequestServer().then(x.hitch(this,
function(c){r.empty(e);z.forEach(c.layers,function(f){z.forEach(f.legend,function(b){if("\x3call other values\x3e"!==b.label){var d=r.create("div",{"class":"legend-div"},e),a=r.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},d),g=null;g=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;r.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:g},a);r.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:p.sanitizeHTML(b.label)||" "},d)}},this)},this)}),x.hitch(this,function(){r.empty(e)})):r.empty(e)},_legendRequestServer:function(){var e=this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.bandIds&&(c.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(c.renderingRule=this.layerObject._params.renderingRule);return m({url:e,content:c,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var e=
new n,c={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},f=this.getLayerType(),b=this.getLayerObject();v({type:f,layerObject:b}).then(x.hitch(this,function(d){var a=d.type;d=d.layerObject;c.layerType=a;0<=this._getLayerTypesOfSupportTable().indexOf(a)&&(c.isSupportedLayer=!0);d.capabilities&&0<=d.capabilities.indexOf("Catalog")?c.isSupportQuery=!0:c.isSupportedLayer=!1;e.resolve(c)}),function(){e.resolve(c)});return e},_getServiceDefinition:function(){var e=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(e)},
_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty){var e=t.after(this.layerObject,"setRenderingRule",x.hitch(this,this._onRendererChanged));this._eventHandles.push(e)}}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(F,r,z,x,n){return F(n,{getSupportTableInfo:function(){var v=new z,t={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,
otherReasonCanNotSupport:!0},m=this.getLayerType(),h=this.getLayerObject();x({type:m,layerObject:h}).then(r.hitch(this,function(p){var e=p.type;p=p.layerObject;t.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(t.isSupportedLayer=!0);(e=p.getLatestObservations())&&0<e.length&&(t.otherReasonCanNotSupport=!1);v.resolve(t)}),function(){v.resolve(t)});return v}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct",
"./LayerInfoForDefault"],function(F,r,z,x){return F(x,{constructor:function(n,v){this.layerObject=n.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var n=this.originOperLayer.kml,v=n.layerInfo.originOperLayer.visibleFolders;n.layerInfo.isRootLayer()&&v?-1<v.indexOf(this.subId)?this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(n){var v=this.originOperLayer.kml.currentFolder;this._visible=n;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(v,
n)},obtainNewSubLayers:function(){var n=[],v=this.originOperLayer.kml;v.currentFolder&&r.forEach(v.layerInfo._getOperLayerByParentFolderId(v.currentFolder.id,this),function(t){t=this._layerInfoFactory.create(t);n.push(t);t.init()},this);return n},getOpacity:function(){},setOpacity:function(n){},drawLegends:function(n){z.empty(n)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"libs/crc":function(){(function(){var F=
"object"===typeof window?window:{};!F.JS_CRC_NO_NODE_JS&&"object"===typeof process&&process.versions&&process.versions.node&&(F=global);var r=!F.JS_CRC_NO_COMMON_JS&&"object"===typeof module&&module.exports,z="function"===typeof define&&define.amd,x=!F.JS_CRC_NO_ARRAY_BUFFER&&"undefined"!==typeof ArrayBuffer,n="0123456789abcdef".split(""),v=[{name:"crc32",polynom:3988292384,initValue:-1,bytes:4},{name:"crc16",polynom:40961,initValue:0,bytes:2},{name:"crc24",polynom:720895,initValue:1,bytes:3}],t,
m,h;for(t=0;t<v.length;++t){var p=v[t];p.method=function(f){return function(b){var d=b,a="string"!==typeof d;a&&x&&d instanceof ArrayBuffer&&(d=new Uint8Array(d));b=f.initValue;var g,l=d.length,q=f.table;if(a)for(g=0;g<l;++g)b=q[(b^d[g])&255]^b>>>8;else for(g=0;g<l;++g)a=d.charCodeAt(g),128>a?b=q[(b^a)&255]^b>>>8:(2048>a?b=q[(b^(192|a>>6))&255]^b>>>8:(55296>a||57344<=a?b=q[(b^(224|a>>12))&255]^b>>>8:(a=65536+((a&1023)<<10|d.charCodeAt(++g)&1023),b=q[(b^(240|a>>18))&255]^b>>>8,b=q[(b^(128|a>>12&63))&
255]^b>>>8),b=q[(b^(128|a>>6&63))&255]^b>>>8),b=q[(b^(128|a&63))&255]^b>>>8);b^=f.initValue;d="";3<f.bytes?d+=n[b>>28&15]+n[b>>24&15]+n[b>>20&15]+n[b>>16&15]:2<f.bytes&&(d+=n[b>>20&15]+n[b>>16&15]);return d+=n[b>>12&15]+n[b>>8&15]+n[b>>4&15]+n[b&15]}}(p);p.table=[];for(m=0;256>m;++m){var e=m;for(h=0;8>h;++h)e=e&1?p.polynom^e>>>1:e>>>1;p.table[m]=e>>>0}}var c={};for(t=0;t<v.length;++t)p=v[t],c[p.name]=p.method;if(r)module.exports=c;else{for(t=0;t<v.length;++t)p=v[t],F[p.name]=p.method;z&&define(function(){return c})}})()},
"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale dojo/number esri/lang dojo/data/ItemFileWriteStore jimu/utils moment/moment".split(" "),function(F,r,z,x,n,v,t,m,h){var p=F([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:864E5,HourInMS:36E5,MinuteInMS:6E4,
SecInMS:1E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(e){return 0===this.indexOf(e)};String.prototype.endsWith=function(e){return this.substring(this.length-e.length)===e};String.prototype.count=function(e){return this.split(e).length-1};String.prototype.trim||(String.prototype.trim=r.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes);
this.filterBuilderNls=window.jimuNls.filterBuilder},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsAnyOf:"stringOperatorIsAnyOf",stringOperatorIsNoneOf:"stringOperatorIsNoneOf",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",
numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsAnyOf:"numberOperatorIsAnyOf",numberOperatorIsNoneOf:"numberOperatorIsNoneOf",numberOperatorIsBlank:"numberOperatorIsBlank",
numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",
dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorIsIn:"dateOperatorIsIn",dateOperatorIsNotIn:"dateOperatorIsNotIn",dateOperatorMinutes:"dateOperatorMinutes",dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(e,c){this.isHosted=m.isHostedService(e);c=c||[];this.setFieldsStoreByFieldInfos(c)},
isPartsObjHasError:function(e){var c=!1;e&&(c=e.parts&&0<=e.parts.length?z.every(e.parts,r.hitch(this,function(f){return f.parts?0<f.parts.length?z.every(f.parts,r.hitch(this,function(b){return!b.error})):!1:!f.error})):!1);return!c},isAskForValues:function(e){return p.isAskForValues(e)},hasVirtualDate:function(e){return p.hasVirtualDate(e)},setFieldsStoreByFieldInfos:function(e){e=z.filter(e,r.hitch(this,function(c){return 0<=this._supportFieldTypes.indexOf(c.type)}));e=z.map(e,function(c,f){switch(c.type){case "esriFieldTypeString":var b=
"string";break;case "esriFieldTypeDate":b="date";break;default:b="number"}return{id:f,label:c.name,shortType:b,alias:c.alias,editable:c.editable,name:c.name,nullable:c.nullable,type:c.type}},this);this.fieldsStore=new t({data:{identifier:"id",label:"label",items:e}});return e.length},_validatePartsObj:function(e){return e&&"object"===typeof e},_isObject:function(e){return e&&"object"===typeof e},_isString:function(e){return e&&"string"===typeof e},containsNonLatinCharacter:function(e){for(var c=0;c<
e.length;c++)if(255<e.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(e){if(!z.every(e.parts,function(l){return!!l}))return null;if(!this.isPartsObjReadyToBuild(e))return e.expr="",e.displaySQL="",e.expr;this._handleVirtualDate(e);var c="",f="",b;if(0===e.parts.length)f=c="1\x3d1";else if(1===e.parts.length){var d=e.parts[0];d.valueObj&&r.isArray(d.valueObj.value)&&"multiple"!==d.valueObj.type?(b=this._checkIfValObjArrayAndChecked(d.valueObj.value))?(c=this.builtFilterString(d),f=d.displaySQL):
f=c="1\x3d1":(c=this.builtFilterString(d),f=d.displaySQL)}else for(var a="",g=0;g<e.parts.length;g++){d=e.parts[g];d.valueObj&&r.isArray(d.valueObj.value)&&"multiple"!==d.valueObj.type?(b=this._checkIfValObjArrayAndChecked(d.valueObj.value))?(b=this.builtFilterString(d),d=d.displaySQL):d=b="1\x3d1":(b=this.builtFilterString(d),d=d.displaySQL);if(!v.isDefined(b))return null;c+=a+"("+b+")";f+=a+"("+d+")";a=a||" "+e.logicalOperator+" "}e.expr=c;e.displaySQL=f;return c},_checkIfValObjArrayAndChecked:function(e){var c=
!1,f;for(f in e)if(e[f].isChecked){c=!0;break}return c},_handleVirtualDate:function(e){this.hasVirtualDate(e)&&z.forEach(e.parts,r.hitch(this,function(c){c.parts?z.forEach(c.parts,r.hitch(this,function(f){this._updateRealDateByVirtualDate(f)})):this._updateRealDateByVirtualDate(c)}))},_updateRealDateByVirtualDate:function(e){var c=[this.OPERATORS.dateOperatorIsOn,this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,this.OPERATORS.dateOperatorIsOnOrBefore,
this.OPERATORS.dateOperatorIsOnOrAfter];e.valueObj.virtualDate?e.operator===this.OPERATORS.dateOperatorIsIn||e.operator===this.OPERATORS.dateOperatorIsNotIn?(c=p.getRealDateByVirtualDate(e.valueObj.virtualDate),e.value1=c[0],e.value2=c[1],e.valueObj.value1=m.getDateTimeStr(c[0]),e.valueObj.value2=m.getDateTimeStr(c[1])):-1<c.indexOf(e.operator)&&(c=p.getRealDateByVirtualDate(e.valueObj.virtualDate),e.value=c,e.valueObj.value=m.getDateTimeStr(c)):(e.valueObj.virtualDate1&&(c=p.getRealDateByVirtualDate(e.valueObj.virtualDate1),
e.value1=c,e.valueObj.value1=m.getDateTimeStr(c)),e.valueObj.virtualDate2&&(c=p.getRealDateByVirtualDate(e.valueObj.virtualDate2),e.value2=c,e.valueObj.value2=m.getDateTimeStr(c)))},isPartsObjReadyToBuild:function(e){return z.every(e.parts,r.hitch(this,function(c){return c.parts?z.every(c.parts,r.hitch(this,function(f){return this._isPartReadyToBuild(f)})):this._isPartReadyToBuild(c)}))},_isPartReadyToBuild:function(e){var c=e.fieldObj.shortType,f=e.operator,b=e.valueObj;e=b.type||"value";var d=b.value,
a=b.value1;b=b.value2;if("value"===e){if("string"===c)return f===this.OPERATORS.stringOperatorIsBlank||f===this.OPERATORS.stringOperatorIsNotBlank?!0:m.isNotEmptyString(d);if("number"===c)return f===this.OPERATORS.numberOperatorIsBlank||f===this.OPERATORS.numberOperatorIsNotBlank?!0:f===this.OPERATORS.numberOperatorIsBetween||f===this.OPERATORS.numberOperatorIsNotBetween?m.isValidNumber(a)&&m.isValidNumber(b):m.isValidNumber(d);if("date"===c)return f===this.OPERATORS.dateOperatorIsBlank||f===this.OPERATORS.dateOperatorIsNotBlank?
!0:f===this.OPERATORS.dateOperatorIsBetween||f===this.OPERATORS.dateOperatorIsNotBetween||f===this.OPERATORS.dateOperatorIsIn||f===this.OPERATORS.dateOperatorIsNotIn?m.isNotEmptyString(a)&&m.isNotEmptyString(b):f===this.OPERATORS.dateOperatorInTheLast||f===this.OPERATORS.dateOperatorNotInTheLast?void 0!==d&&null!==d:m.isNotEmptyString(d)}else{if("field"===e)return m.isNotEmptyString(d);if("unique"===e){if("string"===c)return m.isNotEmptyString(d);if("number"===c)return m.isValidNumber(d);if("date"===
c)return m.isValidDate(d)}else if("multiple"===e){if("string"===c)return m.isNotEmptyStringArray(d);if("number"===c)return m.isValidNumberArray(d)}else if("values"!==e&&("uniquePredefined"===e||"multiplePredefined"===e)){if("string"===c)return m.isNotEmptyStringArray(d);if("number"===c)return m.isValidNumberArray(d)}}return!1},builtFilterString:function(e){var c="",f="";if(e.parts)for(var b="",d=0;d<e.parts.length;d++){var a=e.parts[d],g=this.builtSingleFilterString(a);a.expr=g.whereClause;if(!v.isDefined(g.whereClause))return null;
c+=b+g.whereClause;f+=b+a.displaySQL;b=" "+e.logicalOperator+" "}else e&&e.valueObj&&"multiple"===e.valueObj.type&&0===e.valueObj.value.length?c=f="1\x3d1":(c=this.builtSingleFilterString(e).whereClause,f=e.displaySQL);e.expr=c;e.displaySQL=f;return c},_preBuiltSingleFilterString:function(e){if("string"===e.fieldObj.shortType&&"\x3cNull\x3e"===e.valueObj.value){if(e.operator===this.OPERATORS.stringOperatorIs)return{whereClause:e.fieldObj.name+" IS NULL"};if(e.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:e.fieldObj.name+
" IS NOT NULL"}}if("number"===e.fieldObj.shortType&&"\x3cNull\x3e"===e.valueObj.value){if(e.operator===this.OPERATORS.numberOperatorIs)return{whereClause:e.fieldObj.name+" IS NULL"};if(e.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:e.fieldObj.name+" IS NOT NULL"}}return null},_handlePrefixStringsForIn:function(e,c){for(var f=[],b=0;b<e.length;b++){var d=e[b];d=d.replace(/'/g,"''");var a=this.isHosted&&this.containsNonLatinCharacter(d)?"N":"";d=c||this.isHosted?d:d.toUpperCase();
d=""+a+"'"+d+"'";f.push(d)}return f.join(",")},builtSingleFilterString:function(e){this.isHosted&&(e.caseSensitive=!1);if(v.isDefined(e.valueObj.isValid)&&!e.valueObj.isValid)return{whereClause:null};var c=this._preBuiltSingleFilterString(e);if(c)return c;c=e.valueObj.value;var f=e.valueObj.value1,b=e.valueObj.value2,d="",a="",g=[];if("string"===e.fieldObj.shortType){f="";c&&"field"!==e.valueObj.type&&this.isHosted&&!r.isArray(c)&&this.containsNonLatinCharacter(c)&&(f="N");!c||"multiplePredefined"!==
e.valueObj.type&&"uniquePredefined"!==e.valueObj.type||(g=[],z.forEach(c,r.hitch(this,function(A){A.isChecked&&g.push(A.value)})),e.operator===this.OPERATORS.stringOperatorIs||e.operator===this.OPERATORS.stringOperatorIsNot?(c=g[0],this.isHosted&&this.containsNonLatinCharacter(c)&&(f="N")):c=g);var l=[];switch(e.operator){case this.OPERATORS.stringOperatorIs:d="field"===e.valueObj.type?e.fieldObj.name+" \x3d "+c:e.caseSensitive||this.isHosted?e.fieldObj.name+" \x3d "+f+"'"+c.replace(/'/g,"''")+"'":
"UPPER("+e.fieldObj.name+") \x3d "+f+"'"+c.replace(/'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorIsNot:d="field"===e.valueObj.type?e.fieldObj.name+" \x3c\x3e "+c:e.caseSensitive||this.isHosted?e.fieldObj.name+" \x3c\x3e "+f+"'"+c.replace(/'/g,"''")+"'":"UPPER("+e.fieldObj.name+") \x3c\x3e "+f+"'"+c.replace(/'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorStartsWith:l=[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(z.forEach(c,
r.hitch(this,function(A){var u=this.isHosted&&this.containsNonLatinCharacter(A)?"N":"";e.caseSensitive||this.isHosted?l.push(e.fieldObj.name+" LIKE "+u+"'"+A.replace(/'/g,"''")+"%'"):l.push("UPPER("+e.fieldObj.name+") LIKE "+u+"'"+A.replace(/'/g,"''").toUpperCase()+"%'")})),d="(("+l.join(") OR (")+"))"):d=e.caseSensitive||this.isHosted?e.fieldObj.name+" LIKE "+f+"'"+c.replace(/'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") LIKE "+f+"'"+c.replace(/'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorEndsWith:l=
[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(z.forEach(c,r.hitch(this,function(A){var u=this.isHosted&&this.containsNonLatinCharacter(A)?"N":"";e.caseSensitive||this.isHosted?l.push(e.fieldObj.name+" LIKE "+u+"'%"+A.replace(/'/g,"''")+"'"):l.push("UPPER("+e.fieldObj.name+") LIKE "+u+"'%"+A.replace(/'/g,"''").toUpperCase()+"'")})),d="(("+l.join(") OR (")+"))"):d=e.caseSensitive||this.isHosted?e.fieldObj.name+" LIKE "+f+"'%"+c.replace(/'/g,"''")+"'":"UPPER("+e.fieldObj.name+
") LIKE "+f+"'%"+c.replace(/'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorContains:l=[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(z.forEach(c,r.hitch(this,function(A){var u=this.isHosted&&this.containsNonLatinCharacter(A)?"N":"";e.caseSensitive||this.isHosted?l.push(e.fieldObj.name+" LIKE "+u+"'%"+A.replace(/'/g,"''")+"%'"):l.push("UPPER("+e.fieldObj.name+") LIKE "+u+"'%"+A.replace(/'/g,"''").toUpperCase()+"%'")})),d="(("+l.join(") OR (")+
"))"):d=e.caseSensitive||this.isHosted?e.fieldObj.name+" LIKE "+f+"'%"+c.replace(/'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") LIKE "+f+"'%"+c.replace(/'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorDoesNotContain:l=[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(z.forEach(c,r.hitch(this,function(A){var u=this.isHosted&&this.containsNonLatinCharacter(A)?"N":"";e.caseSensitive||this.isHosted?l.push(e.fieldObj.name+" NOT LIKE "+u+"'%"+A.replace(/'/g,
"''")+"%'"):l.push("UPPER("+e.fieldObj.name+") NOT LIKE "+u+"'%"+A.replace(/'/g,"''").toUpperCase()+"%'")})),d="(("+l.join(") AND (")+"))"):d=e.caseSensitive||this.isHosted?e.fieldObj.name+" NOT LIKE "+f+"'%"+c.replace(/'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") NOT LIKE "+f+"'%"+c.replace(/'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorIsAnyOf:c=this._handlePrefixStringsForIn(c,e.caseSensitive);d=e.caseSensitive||this.isHosted?e.fieldObj.name+" IN ("+c+")":"UPPER("+e.fieldObj.name+
") IN ("+c+")";break;case this.OPERATORS.stringOperatorIsNoneOf:c=this._handlePrefixStringsForIn(c,e.caseSensitive);d=e.caseSensitive||this.isHosted?e.fieldObj.name+" NOT IN ("+c+")":"UPPER("+e.fieldObj.name+") NOT IN ("+c+")";break;case this.OPERATORS.stringOperatorIsBlank:d=e.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:d=e.fieldObj.name+" IS NOT NULL"}}else if("number"===e.fieldObj.shortType)switch(!c||"uniquePredefined"!==e.valueObj.type&&"multiplePredefined"!==
e.valueObj.type?c&&"multiple"===e.valueObj.type&&(c=c.join(",")):(g=[],z.forEach(c,r.hitch(this,function(A){A.isChecked&&g.push(A.value)})),c=g.join(",")),e.operator){case this.OPERATORS.numberOperatorIs:d=e.fieldObj.name+" \x3d "+c;break;case this.OPERATORS.numberOperatorIsNot:d=e.fieldObj.name+" \x3c\x3e "+c;break;case this.OPERATORS.numberOperatorIsAtLeast:d=e.fieldObj.name+" \x3e\x3d "+c;break;case this.OPERATORS.numberOperatorIsLessThan:d=e.fieldObj.name+" \x3c "+c;break;case this.OPERATORS.numberOperatorIsAtMost:d=
e.fieldObj.name+" \x3c\x3d "+c;break;case this.OPERATORS.numberOperatorIsGreaterThan:d=e.fieldObj.name+" \x3e "+c;break;case this.OPERATORS.numberOperatorIsAnyOf:d=e.fieldObj.name+" IN ("+c+")";break;case this.OPERATORS.numberOperatorIsNoneOf:d=e.fieldObj.name+" NOT IN ("+c+")";break;case this.OPERATORS.numberOperatorIsBetween:d=e.fieldObj.name+" BETWEEN "+f+" AND "+b;break;case this.OPERATORS.numberOperatorIsNotBetween:d=e.fieldObj.name+" NOT BETWEEN "+f+" AND "+b;break;case this.OPERATORS.numberOperatorIsBlank:d=
e.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:d=e.fieldObj.name+" IS NOT NULL"}else{"field"!==e.valueObj.type&&(c&&(c=m.getDateByDateTimeStr(c)),f&&(f=m.getDateByDateTimeStr(f)),b&&(b=m.getDateByDateTimeStr(b)));a=e.valueObj.enableTime;var q=e.valueObj.timeAccuracy;switch(e.operator){case this.OPERATORS.dateOperatorIsOn:"field"===e.valueObj.type?d=e.fieldObj.name+" \x3d "+c:(d="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(c,e.fieldObj.dateFormat):this._getEndDateByTime(c,
a,q),d="("+e.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+d+"') AND ("+e.fieldObj.name+" \x3c\x3e "+(this.isHosted?"":"timestamp ")+"'"+d+"')");break;case this.OPERATORS.dateOperatorIsNotOn:"field"===e.valueObj.type?d=e.fieldObj.name+" \x3c\x3e "+c:(d="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(c,e.fieldObj.dateFormat):this._getEndDateByTime(c,a,q),d="("+e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(c)+"') OR ("+e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+d+"')");break;case this.OPERATORS.dateOperatorIsBefore:d="field"===e.valueObj.type?e.fieldObj.name+" \x3c "+c:e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"'";break;case this.OPERATORS.dateOperatorIsAfter:"field"===e.valueObj.type?d=e.fieldObj.name+" \x3e "+c:(d="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(c,e.fieldObj.dateFormat):this._getEndDateByTime(c,
a,q),d=e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+d+"'");break;case this.OPERATORS.dateOperatorIsOnOrBefore:"field"===e.valueObj.type?d=e.fieldObj.name+" \x3c\x3d "+c:(d="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(c,e.fieldObj.dateFormat):this._getEndDateByTime(c,a,q),d=e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+d+"'");break;case this.OPERATORS.dateOperatorIsOnOrAfter:d="field"===e.valueObj.type?e.fieldObj.name+" \x3e\x3d "+c:e.fieldObj.name+
" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"'";break;case this.OPERATORS.dateOperatorInTheLast:d=e.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(e.valueObj.value,e.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorNotInTheLast:d=e.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(e.valueObj.value,e.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsIn:d=
this._getEndDateByTime(b,e.valueObj.enableTime2,e.valueObj.timeAccuracy2);d="("+e.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+d+"') AND ("+e.fieldObj.name+" \x3c\x3e "+(this.isHosted?"":"timestamp ")+"'"+d+"')";break;case this.OPERATORS.dateOperatorIsNotBetween:case this.OPERATORS.dateOperatorIsNotIn:d=this._getEndDateByTime(b,e.valueObj.enableTime2,e.valueObj.timeAccuracy2);d="("+e.fieldObj.name+" \x3c "+(this.isHosted?
"":"timestamp ")+"'"+this.formatDate(f)+"') OR ("+e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+d+"')";break;case this.OPERATORS.dateOperatorIsBlank:d=e.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:d=e.fieldObj.name+" IS NOT NULL"}}"date"===e.fieldObj.shortType?(c=r.clone(e.valueObj),c.dateFormat=e.fieldObj.dateFormat,a=this.getDisplaySQL(e.fieldObj.name,c,e.operator)):a=d;e.displaySQL=a;return{whereClause:d}},_getEndDateByTime:function(e,c,f){e=c?"s"===
f?this.addSec(e):"m"===f?this.addMinute(e):this.addHour(e):this.addDay(e);return this.formatDate(e)},_getEndDateByTimeForUnique:function(e,c){e=c&&0<=c.indexOf("ShortTime")?this.addMinute(e):c&&0<=c.indexOf("LongTime")?this.addSec(e):this.addDay(e);return this.formatDate(e)},_getDisplayDates:function(e){var c={value:e.virtualDate,value1:e.virtualDate1,value2:e.virtualDate2},f=""===e.dateFormat?{}:{format:{dateFormat:e.dateFormat}};c.value=""===e.virtualDate||void 0===e.virtualDate?"field"===e.type?
e.value:"unique"===e.type?m.localizeDateByFieldInfo(m.getDateByDateTimeStr(e.value),f):m.localizeDateTimeByFieldInfo(m.getDateByDateTimeStr(e.value),f,e.enableTime,e.timeAccuracy):this.filterBuilderNls[e.virtualDate];c.value1=""===e.virtualDate1?m.localizeDateTimeByFieldInfo(m.getDateByDateTimeStr(e.value1),f,e.enableTime1,e.timeAccuracy1):this.filterBuilderNls[e.virtualDate1];c.value2=""===e.virtualDate2?m.localizeDateTimeByFieldInfo(m.getDateByDateTimeStr(e.value2),f,e.enableTime2,e.timeAccuracy2):
this.filterBuilderNls[e.virtualDate2];return c},getDisplaySQL:function(e,c,f){var b="";0<f.indexOf("InTheLast")?b=this.filterBuilderNls[f]+" "+c.value+" "+this._getDateRangeEnum(c.value,c.range):(c=this._getDisplayDates(c,f),b=0<f.indexOf("Between")?this.filterBuilderNls[f]+" "+c.value1+" "+this.filterBuilderNls.and+" "+c.value2:0<f.indexOf("Blank")?this.filterBuilderNls[f]:this.filterBuilderNls[f]+" "+c.value);return e+" "+b},_getDateRangeEnum:function(e,c){c={dateOperatorYears:"year",dateOperatorDays:"day",
dateOperatorMonths:"month",dateOperatorWeeks:"week",dateOperatorHours:"hour",dateOperatorMinutes:"minute"}[c];return window.jimuNls.timeUnit[1<e?c+"s":c].toLowerCase()},_convertRangeToDays:function(e,c){var f=e;c===this.OPERATORS.dateOperatorYears?f=365*e:c===this.OPERATORS.dateOperatorMonths?f=30*e:c===this.OPERATORS.dateOperatorWeeks?f=7*e:c===this.OPERATORS.dateOperatorHours?f=e/24:c===this.OPERATORS.dateOperatorMinutes&&(f=e/1440);return f=Math.round(1E6*f)/1E6},formatDate:function(e){e=new Date(e);
return""+e.getUTCFullYear()+"-"+n.format(e.getUTCMonth()+1,{pattern:"00"})+"-"+n.format(e.getUTCDate(),{pattern:"00"})+" "+n.format(e.getUTCHours(),{pattern:"00"})+":"+n.format(e.getUTCMinutes(),{pattern:"00"})+":"+n.format(e.getUTCSeconds(),{pattern:"00"})},addDay:function(e){return new Date(e.getTime()+this.dayInMS)},addHour:function(e){return new Date(e.getTime()+this.HourInMS)},addMinute:function(e){return new Date(e.getTime()+this.MinuteInMS)},addSec:function(e){return new Date(e.getTime()+this.SecInMS)},
getFilterObjByExpr:function(e){if(e&&this.fieldsStore){var c=this.replaceStrings(e);e=c.defExpr;var f=this.findParts(e,"AND");1===f.parts.length&&(f=this.findParts(e,"OR"),1===f.parts.length&&(f.logicalOperator="AND"));z.forEach(f.parts,function(b){b.expr=b.expr.trim();if(b.expr.startsWith("(")&&-1<b.expr.search(/\)$/)){var d=b.expr.substring(1,b.expr.length-1),a=d.indexOf("("),g=d.indexOf(")");if(-1===a&&-1===g||a<g)b.expr=d}d=this.findParts(b.expr,"AND");1===d.parts.length&&(d=this.findParts(b.expr,
"OR"));1<d.parts.length&&(b.parts=d.parts,b.logicalOperator=d.logicalOperator)},this);this.parseExpr(f);this.reReplaceStrings(c,f,r.hitch(this,function(){f&&f.parts&&z.forEach(f.parts,r.hitch(this,function(b){b&&(b.parts?z.forEach(b.parts,r.hitch(this,function(d){this._handleParsedValuesForSinglePart(d);this._addDefalutValueTypeForSinglePart(d)})):(this._handleParsedValuesForSinglePart(b),this._addDefalutValueTypeForSinglePart(b)))}))}));this.isPartsObjHasError(f)&&(f=null);return f}},_handleParsedValuesForSinglePart:function(e){e&&
e.fieldObj&&"number"===e.fieldObj.shortType&&e.valueObj&&(e.valueObj.hasOwnProperty("value")&&(e.valueObj.value=parseFloat(e.valueObj.value)),e.valueObj.hasOwnProperty("value1")&&(e.valueObj.value1=parseFloat(e.valueObj.value1)),e.valueObj.hasOwnProperty("value2")&&(e.valueObj.value2=parseFloat(e.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(e){e&&e.valueObj&&!e.valueObj.type&&(e.valueObj.type="value")},replaceStrings:function(e){for(var c=e,f=function(q,A,u){var k=-1;k=q.indexOf("'",
u+1);return k===u+1?(k=q.indexOf("'",k+1),f(q,A,k)):u},b=[],d=e.indexOf("'");-1<d;){var a=d;d=e.indexOf("'",d+1);var g=0;d=f(e,a,d);"%"===e[a+1]&&a++;"%"===e[d-1]&&(--d,g++);var l=e.substring(a+1,d);"N"===e[a-1]&&(e=e.substring(0,a-1)+e.substring(a),--a,--d);this.isDateString(l)||-1!==l.indexOf("{")?d=e.indexOf("'",d+1+g):(b.push(l),e=e.substring(0,a+1)+"#"+(b.length-1)+"#"+e.substring(d),d=e.indexOf("'",e.lastIndexOf("#")+2+g))}return{origDefExpr:c,defExpr:e,savedStrings:b}},reReplaceStrings:function(e,
c,f){var b=e.savedStrings;if(!b.length)f&&"function"===typeof f&&f();else if(b.length){var d=function(g,l){if(void 0===g.valueObj||null===g.valueObj||void 0===g.valueObj.value||null===g.valueObj.value||"string"!==g.fieldObj.shortType)return!1;var q=g.valueObj.value.indexOf("#"),A=g.valueObj.value.lastIndexOf("#");return v.isDefined(g.valueObj.value)&&-1<q?(g.valueObj.value=l[parseInt(g.valueObj.value.substring(q+1,A),10)].replace(/''/g,"'"),this.builtSingleFilterString(g),!0):!1};d=r.hitch(this,d);
var a=!1;z.forEach(c.parts,function(g){if(g.parts){var l=!1;z.forEach(g.parts,function(q){l=d(q,b)||l});l&&(a=l,g.expr=this.builtFilterString(g))}else(a=d(g,b)||a)&&this.builtFilterString(g)},this);f&&"function"===typeof f&&f();a&&(c.expr=null,this.getExprByFilterObj(c))}},isDateString:function(e){return 19===e.length&&"-"===e.charAt(4)&&"-"===e.charAt(7)&&" "===e.charAt(10)&&":"===e.charAt(13)&&":"===e.charAt(16)?!0:!1},findParts:function(e,c){for(var f=e.toLowerCase(),b=" "+c.toLowerCase()+" ",
d=[],a=0,g=f.indexOf(b);0<g;){var l=e.substring(a,g),q=l.toLowerCase(),A=l.count("("),u=l.count(")"),k=l.count("'");A!==u||1===k%2?g=f.indexOf(b,g+1):-1<q.indexOf(" between ")&&-1===q.indexOf(" and ")?g=f.indexOf(b,g+1):(d.push({expr:l}),a=g+b.length,g=f.indexOf(b,a))}d.push({expr:e.substring(a)});for(f=d.length-1;0<=f;f--)!this.hasOperator(d[f].expr)&&0<f&&(d[f-1].expr+=" "+c+" "+d[f].expr,d.splice(f,1));return{expr:e,parts:d,logicalOperator:c}},hasOperator:function(e){e=e.toLowerCase();return-1<
e.indexOf("{")&&-1<e.indexOf("}")||-1<e.indexOf(" \x3d ")||-1<e.indexOf(" \x3c ")||-1<e.indexOf(" \x3e ")||-1<e.indexOf(" \x3c\x3e ")||-1<e.indexOf(" \x3c\x3d ")||-1<e.indexOf(" \x3e\x3d ")||-1<e.indexOf(" like ")||-1<e.indexOf(" between ")||-1<e.indexOf(" date")||-1<e.indexOf(" is null")||-1<e.indexOf(" is not null")?!0:!1},parseExpr:function(e){z.forEach(e.parts,function(c){c.parts?this.parseExpr(c):this.parseSingleExpr(c)},this)},_preParseSingleExpr:function(e){var c=null;try{if(c=r.clone(e),c.expr=
c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var f=e="",b=c.expr.match(/^UPPER\((.*)\)\s+/i);if(b&&2<=b.length)e=b[1];else return null;var d=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(d&&2<=d.length)f="'"+d[1]+"'";else return null;c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,e+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,f);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(a){return console.log(a),null}c&&
this.isHosted&&(c.caseSensitive=!1);return c},_removeOperator:function(e,c,f){c=c.substring(f).trim();"date"===e&&!this.isHosted&&c.toLowerCase().startsWith("timestamp ")&&(c=c.substring(10).trim());return c},parseSingleExpr:function(e){var c=this._preParseSingleExpr(e);c&&(e=r.mixin(e,c));c=e.expr.trim();var f=c.indexOf(" "),b=c.substring(0,f);e.fieldObj={name:b};e.valueObj={};this.getFieldItemByName({name:b},function(d){e.fieldObj.shortType=d.shortType[0];e.fieldObj.label=d.label[0]},function(){e.error=
{msg:"unknown field name ("+b+")",code:1}});c=c.substring(f+1).trim();f=c.toLowerCase();f.startsWith("\x3d ")?(c=this._removeOperator(e.fieldObj.shortType,c,2),this.storeValue(c,e),e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):f.startsWith("\x3c ")?(c=this._removeOperator(e.fieldObj.shortType,c,2),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsBefore:
"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsLessThan:e.error={msg:"operator ("+f+") not supported for string",code:3}):f.startsWith("\x3e ")?(c=this._removeOperator(e.fieldObj.shortType,c,2),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsAfter:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsGreaterThan:e.error={msg:"operator ("+f+") not supported for string",code:3}):f.startsWith("\x3c\x3e ")?(c=this._removeOperator(e.fieldObj.shortType,
c,3),this.storeValue(c,e),e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):f.startsWith("\x3c\x3d ")?(c=this._removeOperator(e.fieldObj.shortType,c,3),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsAtMost:e.error={msg:"operator ("+f+") not supported for string",
code:3}):f.startsWith("\x3e\x3d ")?(c=this._removeOperator(e.fieldObj.shortType,c,3),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsOnOrAfter:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsAtLeast:e.error={msg:"operator ("+f+") not supported for string",code:3}):f.startsWith("like ")?(c=c.substring(5).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-
2),e),e.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,c.length-1),e),e.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?(this.storeValue(c.substring(1,c.length-2),e),e.operator=this.OPERATORS.stringOperatorStartsWith):e.error={msg:"value ("+f+") not supported for LIKE",code:3}):f.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&
c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),e),e.operator=this.OPERATORS.stringOperatorDoesNotContain):e.error={msg:"value ("+f+") not supported for NOT LIKE",code:3}):f.startsWith("between ")?this._updatePartForBetween(c,!0,e):f.startsWith("not between ")?this._updatePartForBetween(c,!1,e):"is null"===f?(e.valueObj.value=null,e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):
"is not null"===f?(e.valueObj.value=null,e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):e.error={msg:"unknown operator ("+f+")",code:2};if(v.isDefined(e.valueObj.value)&&"string"===typeof e.valueObj.value&&e.valueObj.value.startsWith("{")&&e.valueObj.value.endsWith("}")||v.isDefined(e.valueObj.value1)&&"string"===typeof e.valueObj.value1&&e.valueObj.value1.startsWith("{")&&
e.valueObj.value1.endsWith("}"))e.isInteractive=!0},getFieldItemByName:function(e,c,f){this.fieldsStore.fetch({query:e,onComplete:r.hitch(this,function(b){b&&b.length?c(b[0]):f()})})},subtractDay:function(e){return new Date(e.getTime()-this.dayInMS)},_updatePartForBetween:function(e,c,f){e=this._removeOperator(f.fieldObj.shortType,e,(c?"between ":"not between ").length);var b=e.toLowerCase().indexOf(" and ");if(-1<b){var d=e.substring(0,b).trim();if(d.startsWith("CURRENT_TIMESTAMP "))if(d=d.substring(18).trim(),
d.startsWith("-")){f.operator=c?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;try{var a=parseFloat(d.substring(1).trim());if(1<=a){var g=this.OPERATORS.dateOperatorDays;var l=a/365;1E-4>Math.abs(l-Math.round(l))?(a=Math.round(l),g=this.OPERATORS.dateOperatorYears):(l=a/30,1E-4>Math.abs(l-Math.round(l))?(a=Math.round(l),g=this.OPERATORS.dateOperatorMonths):(l=a/7,1E-4>Math.abs(l-Math.round(l))&&(a=Math.round(l),g=this.OPERATORS.dateOperatorWeeks)))}else g=this.OPERATORS.dateOperatorMinutes,
a*=24,1E-4>Math.abs(a-Math.round(a))?g=this.OPERATORS.dateOperatorHours:a*=60;f.valueObj.value=a;f.valueObj.range=g}catch(q){f.error={msg:"missing count for '"+(c?"":"not ")+"in the last'",code:3}}}else f.error={msg:"'"+(c?"":"not ")+"in the next' not supported",code:3};else if(e=this._removeOperator(f.fieldObj.shortType,e.substring(b),5),this.storeValue1(d,f),this.storeValue2(e,f),"date"===f.fieldObj.shortType){if(f.operator=c?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,
"object"===typeof f.valueObj.value1&&"object"===typeof f.valueObj.value2)try{1E3>Math.abs(this.subtractDay(f.valueObj.value2).getTime()-f.valueObj.value1.getTime())&&(f.valueObj.value=f.valueObj.value1,delete f.valueObj.value1,delete f.valueObj.value2,f.operator=c?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(q){}}else"number"===f.fieldObj.shortType||"oid"===f.fieldObj.shortType?f.operator=c?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:
f.error={msg:f.fieldObj.shortType+" field not supported for "+(c?"":"NOT ")+"BETWEEN",code:3}}else f.error={msg:"missing AND operator for "+(c?"":"NOT ")+"BETWEEN",code:3}},storeValue:function(e,c){if(e.startsWith("{")&&e.endsWith("}"))c.valueObj.value=e;else if(e.startsWith("'{")&&e.endsWith("}'"))c.valueObj.value=e.substring(1,e.length-1);else if("date"===c.fieldObj.shortType)if(e.startsWith("'")&&e.endsWith("'")){var f=e.substring(1,e.length-1);c.valueObj.value=this.parseDate(f)}else c.valueObj.value=
e,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(e.startsWith("#")||e.startsWith("%#"))&&(e.endsWith("#")||e.endsWith("#%"))?c.valueObj.value=e:e.startsWith("'")&&e.endsWith("'")?c.valueObj.value=e.substring(1,e.length-1).replace(/''/g,"'"):(c.valueObj.value=e,c.valueObj.type="field",this.getFieldItemByName({name:e},function(b){c.valueObj.label=b.label[0]},function(){c.error={msg:"unknown field name ("+e+")",code:1}})):(c.valueObj.value=e,isNaN(e)&&(c.valueObj.type="field",this.getFieldItemByName({name:e},
function(b){c.valueObj.label=b.label[0]},function(){c.error={msg:"unknown field name ("+e+")",code:1}})))},storeValue1:function(e,c){e.startsWith("{")&&e.endsWith("}")?c.valueObj.value1=e:e.startsWith("'{")&&e.endsWith("}'")?c.valueObj.value1=e.substring(1,e.length-1):"date"===c.fieldObj.shortType?e.startsWith("'")&&e.endsWith("'")?(e=e.substring(1,e.length-1),c.valueObj.value1=this.parseDate(e)):(c.valueObj.value1=e,c.valueObj.type="field"):(c.valueObj.value1=e,isNaN(e)&&(c.valueObj.type="field"))},
storeValue2:function(e,c){e.startsWith("{")&&e.endsWith("}")?c.valueObj.value2=e:e.startsWith("'{")&&e.endsWith("}'")?c.valueObj.value2=e.substring(1,e.length-1):"date"===c.fieldObj.shortType?e.startsWith("'")&&e.endsWith("'")?(e=e.substring(1,e.length-1),c.valueObj.value2=this.parseDate(e)):(c.valueObj.value2=e,c.valueObj.type="field"):(c.valueObj.value2=e,isNaN(e)&&(c.valueObj.type="field"))},parseDate:function(e){var c=x.parse(e,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=x.parse(e.replace(" ",
", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=x.parse(e.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}});p.VIRTUAL_DATE_CUSTOM="custom";p.VIRTUAL_DATE_TODAY="today";p.VIRTUAL_DATE_YESTERDAY="yesterday";p.VIRTUAL_DATE_TOMORROW="tomorrow";p.VIRTUAL_DATE_THIS_WEEK="thisWeek";p.VIRTUAL_DATE_THIS_MONTH="thisMonth";p.VIRTUAL_DATE_THIS_QUARTER="thisQuarter";p.VIRTUAL_DATE_THIS_YEAR="thisYear";p.isAskForValues=function(e){var c=!1;return c=z.some(e.parts,
function(f){return f.parts?z.some(f.parts,function(b){return!!b.interactiveObj}):!!f.interactiveObj})};p.hasVirtualDate=function(e){var c=!1;return c=z.some(e.parts,function(f){return f.parts?z.some(f.parts,function(b){return!!b.valueObj.virtualDate||!!b.valueObj.virtualDate1||!!b.valueObj.virtualDate2}):!!f.valueObj.virtualDate||!!f.valueObj.virtualDate1||!!f.valueObj.virtualDate2})};p.getRealDateByVirtualDate=function(e){var c=null,f=new Date,b=f.getTime();switch(e){case p.VIRTUAL_DATE_TODAY:c=
f;break;case p.VIRTUAL_DATE_YESTERDAY:c=new Date(b-864E5);break;case p.VIRTUAL_DATE_TOMORROW:c=new Date(b+864E5);break;case p.VIRTUAL_DATE_THIS_WEEK:c=[h().startOf("week").toDate(),h().endOf("week").toDate()];break;case p.VIRTUAL_DATE_THIS_MONTH:c=[h().startOf("month").toDate(),h().endOf("month").toDate()];break;case p.VIRTUAL_DATE_THIS_QUARTER:c=[h().startOf("quarter").toDate(),h().endOf("quarter").toDate()];break;case p.VIRTUAL_DATE_THIS_YEAR:c=[h().startOf("year").toDate(),h().endOf("year").toDate()]}return c};
return p})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(F,r,z,x,n,v,t){return r("dojo.data.ItemFileWriteStore",v,{constructor:function(m){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(h){return t.toISOString(h,
{zulu:!0})});m&&!1===m.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(m){if(!m)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(m,h){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof m&&"undefined"!=typeof m)throw Error("newItem() was passed something other than an object");var p=
null,e=this._getIdentifierAttribute();if(e===Number)p=this._arrayOfAllItems.length;else{p=m[e];if("undefined"===typeof p)throw Error("newItem() was not passed an identity for the new item");if(F.isArray(p))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[p]);this._assert("undefined"===typeof this._pending._newItems[p]);this._assert("undefined"===typeof this._pending._deletedItems[p]);var c={};c[this._storeRefPropName]=
this;c[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[p]=c,c[e]=[p]);this._arrayOfAllItems.push(c);e=null;if(h&&h.parent&&h.attribute){e={item:h.parent,attribute:h.attribute,oldValue:void 0};var f=this.getValues(h.parent,h.attribute);if(f&&0<f.length){var b=f.slice(0,f.length);e.oldValue=1===f.length?f[0]:f.slice(0,f.length);b.push(c);this._setValueOrValues(h.parent,h.attribute,b,!1);e.newValue=this.getValues(h.parent,h.attribute)}else this._setValueOrValues(h.parent,
h.attribute,c,!1),e.newValue=c}else c[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(c);this._pending._newItems[p]=c;for(var d in m){if(d===this._storeRefPropName||d===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");h=m[d];F.isArray(h)||(h=[h]);c[d]=h;if(this.referenceIntegrity)for(p=0;p<h.length;p++)f=h[p],this.isItem(f)&&this._addReferenceToMap(f,c,d)}this.onNew(c,e);return c},_removeArrayElement:function(m,h){h=z.indexOf(m,h);return-1!=h?(m.splice(h,
1),!0):!1},deleteItem:function(m){this._assert(!this._saveInProgress);this._assertIsItem(m);var h=m[this._itemNumPropName],p=this.getIdentity(m);if(this.referenceIntegrity){var e=this.getAttributes(m);m[this._reverseRefMap]&&(m["backup_"+this._reverseRefMap]=F.clone(m[this._reverseRefMap]));z.forEach(e,function(g){z.forEach(this.getValues(m,g),function(l){this.isItem(l)&&(m["backupRefs_"+this._reverseRefMap]||(m["backupRefs_"+this._reverseRefMap]=[]),m["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(l),
attr:g}),this._removeReferenceFromMap(l,m,g))},this)},this);if(e=m[this._reverseRefMap])for(var c in e){var f=null;if(f=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c])for(var b in e[c]){var d=this.getValues(f,b)||[],a=z.filter(d,function(g){return!(this.isItem(g)&&this.getIdentity(g)==p)},this);this._removeReferenceFromMap(m,f,b);a.length<d.length&&this._setValueOrValues(f,b,a,!0)}}}this._arrayOfAllItems[h]=null;m[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[p];
this._pending._deletedItems[p]=m;m[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,m);this.onDelete(m);return!0},setValue:function(m,h,p){return this._setValueOrValues(m,h,p,!0)},setValues:function(m,h,p){return this._setValueOrValues(m,h,p,!0)},unsetAttribute:function(m,h){return this._setValueOrValues(m,h,[],!0)},_setValueOrValues:function(m,h,p,e){this._assert(!this._saveInProgress);this._assertIsItem(m);this._assert(F.isString(h));this._assert("undefined"!==typeof p);
var c=this._getIdentifierAttribute();if(h==c)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");c=this._getValueOrValues(m,h);var f=this.getIdentity(m);if(!this._pending._modifiedItems[f]){var b={};for(d in m)b[d]=d===this._storeRefPropName||d===this._itemNumPropName||d===this._rootItemPropName?m[d]:d===this._reverseRefMap?F.clone(m[d]):m[d].slice(0,m[d].length);this._pending._modifiedItems[f]=b}f=!1;if(F.isArray(p)&&0===p.length){if(f=delete m[h],
p=void 0,this.referenceIntegrity&&c){var d=c;F.isArray(d)||(d=[d]);for(var a=0;a<d.length;a++)b=d[a],this.isItem(b)&&this._removeReferenceFromMap(b,m,h)}}else{f=F.isArray(p)?p.slice(0,p.length):[p];if(this.referenceIntegrity)if(c){d=c;F.isArray(d)||(d=[d]);var g={};z.forEach(d,function(l){this.isItem(l)&&(l=this.getIdentity(l),g[l.toString()]=!0)},this);z.forEach(f,function(l){if(this.isItem(l)){var q=this.getIdentity(l);g[q.toString()]?delete g[q.toString()]:this._addReferenceToMap(l,m,h)}},this);
for(a in g)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a],m,h)}else for(a=0;a<f.length;a++)b=f[a],this.isItem(b)&&this._addReferenceToMap(b,m,h);m[h]=f;f=!0}if(e)this.onSet(m,h,c,p);return f},_addReferenceToMap:function(m,h,p){h=this.getIdentity(h);var e=m[this._reverseRefMap];e||(e=m[this._reverseRefMap]={});(m=e[h])||(m=e[h]={});m[p]=!0},_removeReferenceFromMap:function(m,h,p){h=this.getIdentity(h);var e=m[this._reverseRefMap],c;if(e){for(c in e)c==
h&&(delete e[c][p],this._isEmpty(e[c])&&delete e[c]);this._isEmpty(e)&&delete m[this._reverseRefMap]}},_dumpReferenceMap:function(){var m;for(m=0;m<this._arrayOfAllItems.length;m++){var h=this._arrayOfAllItems[m];h&&h[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(h)+"] is referenced by: "+x.toJson(h[this._reverseRefMap]))}},_getValueOrValues:function(m,h){var p=void 0;this.hasAttribute(m,h)&&(m=this.getValues(m,h),p=1==m.length?m[0]:m);return p},_flatten:function(m){if(this.isItem(m))return{_reference:this.getIdentity(m)};
if("object"===typeof m)for(var h in this._datatypeMap){var p=this._datatypeMap[h];if(F.isObject(p)&&!F.isFunction(p)){if(m instanceof p.type){if(!p.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+h+"]");return{_type:h,_value:p.serialize(m)}}}else if(m instanceof p)return{_type:h,_value:m.toString()}}return m},_getNewFileContentString:function(){var m={},h=this._getIdentifierAttribute();h!==Number&&(m.identifier=h);this._labelAttr&&(m.label=this._labelAttr);m.items=
[];for(h=0;h<this._arrayOfAllItems.length;++h){var p=this._arrayOfAllItems[h];if(null!==p){var e={},c;for(c in p)if(c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._reverseRefMap&&c!==this._rootItemPropName){var f=this.getValues(p,c);if(1==f.length)e[c]=this._flatten(f[0]);else for(var b=[],d=0;d<f.length;++d)b.push(this._flatten(f[d])),e[c]=b}m.items.push(e)}}return x.toJson(m,!0)},_isEmpty:function(m){var h=!0;if(F.isObject(m))for(var p in m){h=!1;break}else F.isArray(m)&&0<m.length&&
(h=!1);return h},save:function(m){this._assert(!this._saveInProgress);this._saveInProgress=!0;var h=this,p=function(){h._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};h._saveInProgress=!1;m&&m.onComplete&&m.onComplete.call(m.scope||n.global)},e=function(f){h._saveInProgress=!1;m&&m.onError&&m.onError.call(m.scope||n.global,f)};if(this._saveEverything){var c=this._getNewFileContentString();this._saveEverything(p,e,c)}this._saveCustom&&this._saveCustom(p,e);this._saveEverything||this._saveCustom||
p()},revert:function(){this._assert(!this._saveInProgress);for(var m in this._pending._modifiedItems){var h=this._pending._modifiedItems[m],p=null;p=this._itemsByIdentity?this._itemsByIdentity[m]:this._arrayOfAllItems[m];h[this._storeRefPropName]=this;for(var e in p)delete p[e];F.mixin(p,h)}for(m in this._pending._deletedItems){var c=this._pending._deletedItems[m];c[this._storeRefPropName]=this;h=c[this._itemNumPropName];c["backup_"+this._reverseRefMap]&&(c[this._reverseRefMap]=c["backup_"+this._reverseRefMap],
delete c["backup_"+this._reverseRefMap]);this._arrayOfAllItems[h]=c;this._itemsByIdentity&&(this._itemsByIdentity[m]=c);c[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(c)}for(m in this._pending._deletedItems)c=this._pending._deletedItems[m],c["backupRefs_"+this._reverseRefMap]&&(z.forEach(c["backupRefs_"+this._reverseRefMap],function(f){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[f.id]:this._arrayOfAllItems[f.id],c,f.attr)},this),delete c["backupRefs_"+this._reverseRefMap]);
for(m in this._pending._newItems)h=this._pending._newItems[m],h[this._storeRefPropName]=null,this._arrayOfAllItems[h[this._itemNumPropName]]=null,h[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,h),this._itemsByIdentity&&delete this._itemsByIdentity[m];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(m){return m?(m=this.getIdentity(m),(new Boolean(this._pending._newItems[m]||this._pending._modifiedItems[m]||this._pending._deletedItems[m])).valueOf()):
!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(m,h,p,e){},onNew:function(m,h){},onDelete:function(m){},close:function(m){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(F,r,z,x,n,v,t,m,h){z=z("dojo.data.ItemFileReadStore",[v],{constructor:function(p){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=p.url;this._jsonData=p.data;this.data=null;this._datatypeMap=p.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(e){return h.fromISOString(e)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==p.urlPreventCache&&(this.urlPreventCache=p.urlPreventCache?!0:!1);void 0!==p.hierarchical&&(this.hierarchical=p.hierarchical?!0:!1);p.clearOnClose&&(this.clearOnClose=!0);"failOk"in p&&(this.failOk=p.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(p){if(!this.isItem(p))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(p){if("string"!==typeof p)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(p,e,c){p=this.getValues(p,e);return 0<p.length?p[0]:c},getValues:function(p,e){this._assertIsItem(p);this._assertIsAttribute(e);return(p[e]||[]).slice(0)},getAttributes:function(p){this._assertIsItem(p);var e=[],c;for(c in p)c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._rootItemPropName&&c!==this._reverseRefMap&&
e.push(c);return e},hasAttribute:function(p,e){this._assertIsItem(p);this._assertIsAttribute(e);return e in p},containsValue:function(p,e,c){var f=void 0;"string"===typeof c&&(f=t.patternToRegExp(c,!1));return this._containsValue(p,e,c,f)},_containsValue:function(p,e,c,f){return x.some(this.getValues(p,e),function(b){if(null!==b&&!r.isObject(b)&&f){if(b.toString().match(f))return!0}else if(c===b)return!0})},isItem:function(p){return p&&p[this._storeRefPropName]===this&&this._arrayOfAllItems[p[this._itemNumPropName]]===
p?!0:!1},isItemLoaded:function(p){return this.isItem(p)},loadItem:function(p){this._assertIsItem(p.item)},getFeatures:function(){return this._features},getLabel:function(p){if(this._labelAttr&&this.isItem(p))return this.getValue(p,this._labelAttr)},getLabelAttributes:function(p){return this._labelAttr?[this._labelAttr]:null},filter:function(p,e,c){var f=[];if(p.query){var b=p.queryOptions?p.queryOptions.ignoreCase:!1;var d={};for(q in p.query){var a=p.query[q];"string"===typeof a?d[q]=t.patternToRegExp(a,
b):a instanceof RegExp&&(d[q]=a)}for(b=0;b<e.length;++b){var g=!0,l=e[b];if(null===l)g=!1;else for(q in p.query)a=p.query[q],this._containsValue(l,q,a,d[q])||(g=!1);g&&f.push(l)}}else for(b=0;b<e.length;++b){var q=e[b];null!==q&&f.push(q)}c(f,p)},_fetchItems:function(p,e,c){var f=this;if(this._loadFinished)this.filter(p,this._getItemsArray(p.queryOptions),e);else if(this._jsonFileUrl!==this._ccUrl?(F.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:p,filter:r.hitch(f,"filter"),findCallback:r.hitch(f,e)});else{this._loadInProgress=!0;var b=n.get({url:f._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});b.addCallback(function(a){try{f._getItemsFromLoadedData(a),
f._loadFinished=!0,f._loadInProgress=!1,f.filter(p,f._getItemsArray(p.queryOptions),e),f._handleQueuedFetches()}catch(g){f._loadFinished=!0,f._loadInProgress=!1,c(g,p)}});b.addErrback(function(a){f._loadInProgress=!1;c(a,p)});var d=null;p.abort&&(d=p.abort);p.abort=function(){var a=b;a&&-1===a.fired&&(a.cancel(),a=null);d&&d.call(p)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,f.filter(p,this._getItemsArray(p.queryOptions),e)}catch(a){c(a,
p)}else c(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),p)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var p=0;p<this._queuedFetches.length;p++){var e=this._queuedFetches[p],c=e.args,f=e.filter;e=e.findCallback;f?f(c,this._getItemsArray(c.queryOptions),e):this.fetchItemByIdentity(c)}this._queuedFetches=[]}},_getItemsArray:function(p){return p&&p.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(p){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(p){function e(y){return null!==
y&&"object"===typeof y&&(!r.isArray(y)||f)&&!r.isFunction(y)&&(y.constructor==Object||r.isArray(y))&&"undefined"===typeof y._reference&&"undefined"===typeof y._type&&"undefined"===typeof y._value&&b.hierarchical}function c(y){b._arrayOfAllItems.push(y);for(var C in y){var D=y[C];if(D)if(r.isArray(D))for(var G=0;G<D.length;++G){var H=D[G];e(H)&&c(H)}else e(D)&&c(D)}}var f=!1,b=this;this._labelAttr=p.label;var d;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=p.items;for(d=0;d<this._arrayOfTopLevelItems.length;++d){var a=
this._arrayOfTopLevelItems[d];r.isArray(a)&&(f=!0);c(a);a[this._rootItemPropName]=!0}var g={},l;for(d=0;d<this._arrayOfAllItems.length;++d)for(l in a=this._arrayOfAllItems[d],a){if(l!==this._rootItemPropName){var q=a[l];null!==q?r.isArray(q)||(a[l]=[q]):a[l]=[null]}g[l]=l}for(;g[this._storeRefPropName];)this._storeRefPropName+="_";for(;g[this._itemNumPropName];)this._itemNumPropName+="_";for(;g[this._reverseRefMap];)this._reverseRefMap+="_";if(g=p.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=
g,d=0;d<this._arrayOfAllItems.length;++d)if(a=this._arrayOfAllItems[d],p=a[g],p=p[0],Object.hasOwnProperty.call(this._itemsByIdentity,p)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+g+"].  Value collided: ["+p+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+g+"].  Value collided: ["+
p+"]");}else this._itemsByIdentity[p]=a;else this._features["dojo.data.api.Identity"]=Number;for(d=0;d<this._arrayOfAllItems.length;++d)a=this._arrayOfAllItems[d],a[this._storeRefPropName]=this,a[this._itemNumPropName]=d;for(d=0;d<this._arrayOfAllItems.length;++d)for(l in a=this._arrayOfAllItems[d],a)for(p=a[l],g=0;g<p.length;++g)if(q=p[g],null!==q&&"object"==typeof q){if("_type"in q&&"_value"in q){var A=q._type,u=this._datatypeMap[A];if(u)if(r.isFunction(u))p[g]=new u(q._value);else if(r.isFunction(u.deserialize))p[g]=
u.deserialize(q._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+A+"'");}if(q._reference){q=q._reference;if(r.isObject(q))for(A=0;A<this._arrayOfAllItems.length;++A){u=this._arrayOfAllItems[A];var k=!0,w;for(w in q)u[w]!=q[w]&&(k=!1);k&&(p[g]=u)}else p[g]=this._getItemByIdentity(q);
this.referenceIntegrity&&(q=p[g],this.isItem(q)&&this._addReferenceToMap(q,a,l))}else this.isItem(q)&&this.referenceIntegrity&&this._addReferenceToMap(q,a,l)}},_addReferenceToMap:function(p,e,c){},getIdentity:function(p){var e=this._features["dojo.data.api.Identity"];return e===Number?p[this._itemNumPropName]:(p=p[e])?p[0]:null},fetchItemByIdentity:function(p){if(this._loadFinished){var e=this._getItemByIdentity(p.identity);if(p.onItem){var c=p.scope?p.scope:F.global;p.onItem.call(c,e)}}else{var f=
this;this._jsonFileUrl!==this._ccUrl?(F.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:p}):(this._loadInProgress=!0,c=n.get({url:f._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),c.addCallback(function(b){var d=p.scope?p.scope:F.global;try{f._getItemsFromLoadedData(b),f._loadFinished=!0,f._loadInProgress=!1,e=f._getItemByIdentity(p.identity),p.onItem&&p.onItem.call(d,e),f._handleQueuedFetches()}catch(a){f._loadInProgress=!1,p.onError&&p.onError.call(d,a)}}),c.addErrback(function(b){f._loadInProgress=!1;p.onError&&p.onError.call(p.scope?p.scope:F.global,b)})):this._jsonData&&(f._getItemsFromLoadedData(f._jsonData),
f._jsonData=null,f._loadFinished=!0,e=f._getItemByIdentity(p.identity),p.onItem&&(c=p.scope?p.scope:F.global,p.onItem.call(c,e)))}},_getItemByIdentity:function(p){var e=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,p)&&(e=this._itemsByIdentity[p]):Object.hasOwnProperty.call(this._arrayOfAllItems,p)&&(e=this._arrayOfAllItems[p]);void 0===e&&(e=null);return e},getIdentityAttributes:function(p){p=this._features["dojo.data.api.Identity"];return p===Number?null:[p]},_forceLoad:function(){var p=
this;this._jsonFileUrl!==this._ccUrl?(F.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var e=n.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,
sync:!0});e.addCallback(function(c){try{if(!0!==p._loadInProgress&&!p._loadFinished)p._getItemsFromLoadedData(c),p._loadFinished=!0;else if(p._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(f){throw console.log(f),f;}});e.addErrback(function(c){throw c;})}else this._jsonData&&(p._getItemsFromLoadedData(p._jsonData),p._jsonData=null,p._loadFinished=!0)}});r.extend(z,m);return z})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(F){var r={};F.setObject("dojo.data.util.filter",r);r.patternToRegExp=function(z,x){for(var n="^",v=null,t=0;t<z.length;t++)switch(v=z.charAt(t),v){case "\\":n+=v;t++;n+=z.charAt(t);break;case "*":n+=".*";break;case "?":n+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":n+="\\";default:n+=v}n+="$";return x?new RegExp(n,"mi"):new RegExp(n,"m")};return r})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang",
"../../_base/kernel","./sorter"],function(F,r,z){var x={};F.setObject("dojo.data.util.simpleFetch",x);x.errorHandler=function(n,v){v.onError&&v.onError.call(v.scope||r.global,n,v)};x.fetchHandler=function(n,v){var t=v.abort||null,m=!1,h=v.start?v.start:0,p=v.count&&Infinity!==v.count?h+v.count:n.length;v.abort=function(){m=!0;t&&t.call(v)};var e=v.scope||r.global;v.store||(v.store=this);v.onBegin&&v.onBegin.call(e,n.length,v);v.sort&&n.sort(z.createSortFunction(v.sort,this));if(v.onItem)for(var c=
h;c<n.length&&c<p;++c){var f=n[c];m||v.onItem.call(e,f,v)}v.onComplete&&!m&&(c=null,v.onItem||(c=n.slice(h,p)),v.onComplete.call(e,c,v))};x.fetch=function(n){n=n||{};n.store||(n.store=this);this._fetchItems(n,F.hitch(this,"fetchHandler"),F.hitch(this,"errorHandler"));return n};return x})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(F){var r={};F.setObject("dojo.data.util.sorter",r);r.basicComparator=function(z,x){var n=-1;null===z&&(z=void 0);null===x&&(x=void 0);if(z==
x)n=0;else if(z>x||null==z)n=1;return n};r.createSortFunction=function(z,x){function n(f,b,d,a){return function(g,l){g=a.getValue(g,f);l=a.getValue(l,f);return b*d(g,l)}}for(var v=[],t,m=x.comparatorMap,h=r.basicComparator,p=0;p<z.length;p++){t=z[p];var e=t.attribute;if(e){t=t.descending?-1:1;var c=h;m&&("string"!==typeof e&&"toString"in e&&(e=e.toString()),c=m[e]||h);v.push(n(e,t,c,x))}}return function(f,b){for(var d=0;d<v.length;){var a=v[d++](f,b);if(0!==a)return a}return 0}};return r})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),
function(F,r,z,x,n,v,t,m,h,p){var e=F(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(c){this.sdf=t.getInstance();this.url=c.url;this.query=c.query;this.pageSizeOption=c.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<c.pageSize?c.pageSize:1E3;this.getFeatureCount()},
getFeatureCount:function(){return this._getQueryType().then(r.hitch(this,function(c){return 1===c?this._getCountForQueryType1():2===c?this._getCountForQueryType2():this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(r.hitch(this,function(c){return 0===c?0:Math.ceil(c/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(r.hitch(this,function(c){if(0<c){for(var f=[],b=1;b<=c;b++)f.push(this.queryByPage(b));return x(f).then(r.hitch(this,
function(d){for(var a=[],g=0;g<d.length;g++)d[g].features&&0<d[g].features.length&&(a=a.concat(d[g].features));a=this._setOrderByFieldValue(a);d=d[0];d.features=a;return d}))}this._getEmptyFeatureSet().then(r.hitch(this,function(d){return d}))}))},_setOrderByFieldValue:function(c){if(2===this.queryType||3===this.queryType){var f=this.query.outFields;c.sort(function(b,d){b=b.attributes[f];d=d.attributes[f];return"string"===typeof b&&"string"===typeof d?b.localeCompare(d):b<d?-1:b===d?0:1})}return c},
_getEmptyFeatureSet:function(){var c=new n;this.layerDefinition&&this.layerDefinition.geometryType?c.resolve(this._getEmptyFeatureSetHandler()):this._getLayerDefinition().then(r.hitch(this,function(){c.resolve(this._getEmptyFeatureSetHandler())}));return c},_getEmptyFeatureSetHandler:function(){var c=new p;c.features=[];c.geometryType=this.layerDefinition.geometryType;c.fields=[];var f=r.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?c.fields=f:c.fields=z.filter(f,r.hitch(this,
function(b){return 0<=this.query.outFields.indexOf(b.name)}));return c},getCurrentPageIndex:function(){return this.nextPageIndex},queryNextPage:function(){var c=this.nextPageIndex;this.nextPageIndex++;return this.queryByPage(c)},queryByPage:function(c){var f=null;0>=c?(f=new n,this._getEmptyFeatureSet().then(r.hitch(this,function(b){f.resolve(b)}))):f=this.getPageCount().then(r.hitch(this,function(b){c>b&&this._getEmptyFeatureSet().then(r.hitch(this,function(d){return d}));return 1===this.queryType?
this._queryPageForType1(c):2===this.queryType?this._queryPageForType2(c):this._queryPageForType3(c)}));return f},_getQueryType:function(){var c=new n;if(0<this.queryType)c.resolve(this.queryType);else return this._getLayerDefinition().then(r.hitch(this,function(f){return this.queryType=e.getQueryType(f)}));return c},_getDefStatus:function(c){return c?c.isFulfilled()?c.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(r.hitch(this,
function(c){this.layerDefinition=c;var f=c.maxRecordCount;0<f&&(!(0<this.pageSizeOption)||this.pageSize>c.maxRecordCount)&&(this.pageSize=f);return this.layerDefinition})));return this.layerDefinitionDef},_getCountForQueryType1:function(){0>=this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(r.hitch(this,function(c){return c.length}))},_getObjectIdsForQueryType2:function(){0>=
this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(r.hitch(this,function(c){return(c.features||[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(c){return this._queryWithPaginationAndOrder((c-1)*this.pageSize)},_queryPageForType2:function(c){return this._getObjectIdsForQueryType2().then(r.hitch(this,
function(f){var b=(c-1)*this.pageSize;f=f.slice(b,b+this.pageSize);return this._queryByObjectIds(f)}))},_queryPageForType3:function(c){return this._doQueryForQueryType3().then(r.hitch(this,function(f){var b=r.mixin({},f);b.features=[];var d=(c-1)*this.pageSize;b.features=(f.features||[]).slice(d,d+this.pageSize);return b}))},_tryLocaleNumber:function(c){var f=v.localizeNumber(c);if(null===f||void 0===f)f=c;return f},_tryLocaleDate:function(c){var f=v.localizeDate(c);f||(f=c.toLocaleDateString());
return f},_getLayerIndexByLayerUrl:function(c){var f=c.lastIndexOf("/");c=c.slice(f+1,c.length);return parseInt(c,10)},_getServiceUrlByLayerUrl:function(c){var f=c.lastIndexOf("/");return c.slice(0,f)},_isImageServiceLayer:function(c){return-1<c.indexOf("/ImageServer")},_isTable:function(c){return"Table"===c.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(c){var f=new m;f.where=c||this.query.where;f.geometry=this.query.geometry;f.outSpatialReference=this.query.outSpatialReference;
f.returnGeometry=this.query.returnGeometry;f.spatialRelationship=this.query.spatialRelationship;f.outFields=this.query.outFields;f.returnDistinctValues=this.query.returnDistinctValues;return(new h(this.url)).execute(f)},_queryIds:function(){var c=new m;c.where=this.query.where;c.geometry=this.query.geometry;c.returnGeometry=!1;c.spatialRelationship=this.query.spatialRelationship;c.outSpatialReference=this.query.outSpatialReference;return(new h(this.url)).executeForIds(c).then(r.hitch(this,function(f){f||
(f=[]);return f}))},_queryByObjectIds:function(c){var f=new n,b=new m;b.returnGeometry=this.query.returnGeometry;b.outSpatialReference=this.query.outSpatialReference;b.spatialRelationship=this.query.spatialRelationship;b.outFields=this.query.outFields;b.objectIds=c;(new h(this.url)).execute(b).then(r.hitch(this,function(d){f.resolve(d)}),r.hitch(this,function(d){if(400===d.code){var a=this._getObjectIdField(),g="",l=c.length;z.forEach(c,r.hitch(this,function(q,A){g+=a+" \x3d "+q;A!==l-1&&(g+=" OR ")}));
this._query(g).then(r.hitch(this,function(q){f.resolve(q)}),r.hitch(this,function(q){f.reject(q)}))}else f.reject(d)}));return f},_queryCount:function(){var c=new m;c.where=this.query.where;c.geometry=this.query.geometry;c.outSpatialReference=this.query.outSpatialReference;c.spatialRelationship=this.query.spatialRelationship;c.returnGeometry=!1;return(new h(this.url)).executeForCount(c)},_queryWithPaginationAndOrder:function(c){var f=new m;f.where=this.query.where;f.geometry=this.query.geometry;f.outSpatialReference=
this.query.outSpatialReference;f.returnGeometry=this.query.returnGeometry;f.spatialRelationship=this.query.spatialRelationship;f.outFields=this.query.outFields;f.returnDistinctValues=this.query.returnDistinctValues;f.start=c;f.num=this.pageSize;(c=this.query.orderByFields)&&0<c.length&&(f.orderByFields=c,c=z.map(c,r.hitch(this,function(b){return b.split(" ")[0]})),z.forEach(c,r.hitch(this,function(b){0>f.outFields.indexOf(b)&&f.outFields.push(b)})));return(new h(this.url)).execute(f)}});e._isServiceSupportsOrderBy=
function(c){var f=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsOrderBy&&(f=!0);return f};e._isServiceSupportsPagination=function(c){var f=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsPagination&&(f=!0);return f};e._isSupportObjectIds=function(c){var f=0;c=c.currentVersion?c:c.toJson().layerDefinition;c.currentVersion&&(f=parseFloat(c.currentVersion));return 10<=f||c.hasOwnProperty("typeIdField")};e.getQueryType=function(c){var f=-1;return f=e._isServiceSupportsOrderBy(c)&&
e._isServiceSupportsPagination(c)?1:e._isSupportObjectIds(c)?2:3};return e})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(F,r){function z(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(x){return x},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(x){x.widgetOnScreen&&x.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===
x.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===x.widgetOnScreen.panel.uri)&&(x.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return x},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(x){var n=0;if(x.widgetOnScreen&&x.widgetOnScreen.widgets){var v=!1;for(n=0;n<x.widgetOnScreen.widgets.length;n++)"widgets/Splash/Widget"===x.widgetOnScreen.widgets[n].uri&&(v=!0);v||x.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",
version:"1.2"});v=!1;for(n=0;n<x.widgetOnScreen.widgets.length;n++)"widgets/TimeSlider/Widget"===x.widgetOnScreen.widgets[n].uri&&(v=!0);v||x.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});v=!1;for(n=0;n<x.widgetOnScreen.widgets.length;n++)"widgets/Swipe/Widget"===x.widgetOnScreen.widgets[n].uri&&(v=!0);v||x.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return x},compatible:!0},
{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(x){(function(n){r.visitElement(n,function(t){t.positionRelativeTo&&(t.position?t.position.relativeTo=t.positionRelativeTo:t.position={relativeTo:t.positionRelativeTo},t.panel&&(t.panel.position?t.panel.position.relativeTo=t.panel.positionRelativeTo:t.panel.position={relativeTo:t.panel.positionRelativeTo}))});var v=n.widgetOnScreen;v&&v.panel&&v.panel.positionRelativeTo&&(v.panel.position?v.panel.position.relativeTo=
v.panel.positionRelativeTo:v.panel.position={relativeTo:v.panel.positionRelativeTo});(v=n.widgetPool)&&v.panel&&v.panel.positionRelativeTo&&(v.panel.position?v.panel.position.relativeTo=v.panel.positionRelativeTo:v.panel.position={relativeTo:v.panel.positionRelativeTo})})(x);x.widgetOnScreen&&x.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===x.widgetOnScreen.panel.uri&&(x.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(n){if(n.widgetOnScreen&&n.widgetOnScreen.widgets&&n.theme&&
"FoldableTheme"===n.theme.name){var v=null,t=null;if(v=n.widgetOnScreen.widgets[4])void 0!==v.position.top?(v={position:{left:205,top:45}},t={position:{left:255,top:45}}):(v={position:{left:205,bottom:55}},t={position:{left:255,bottom:55}}),n.widgetOnScreen.widgets.splice(7,0,v,t)}})(x);(function(){var n=0,v=0,t=!1;for(n=0;n<x.widgetOnScreen.widgets.length;n++)if("widgets/Geocoder/Widget"===x.widgetOnScreen.widgets[n].uri){t=!0;break}var m=!1;for(v=0;v<x.widgetOnScreen.widgets.length;v++)if("widgets/Search/Widget"===
x.widgetOnScreen.widgets[v].uri){m=!0;break}!m&&t&&(n=x.widgetOnScreen.widgets[n],n.uri="widgets/Search/Widget",n.name="Search")})(x);(function(n){var v=0;for(v=n.widgetOnScreen.widgets.length-1;0<=v;v--){var t=n.widgetOnScreen.widgets[v];if("widgets/Swipe/Widget"===t.uri&&!t.closeable&&(n.widgetOnScreen.widgets.splice(v,1),!1!==t.visible)){t.closeable=!0;var m;a:{for(m=m=0;m<n.widgetOnScreen.widgets.length;m++)if(!n.widgetOnScreen.widgets[m].uri)break a;m=-1}0<=m&&(t.position=n.widgetOnScreen.widgets[m].position,
n.widgetOnScreen.widgets[m]=t)}"widgets/TimeSlider/Widget"===t.uri&&(!1===t.visible?n.widgetOnScreen.widgets.splice(v,1):t.closeable=!0)}})(x);x.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});x.loadingPage||(x.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return x},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",
upgrader:function(x){if(x.theme){var n=x.theme.name;if(("FoldableTheme"===n||"JewelryBoxTheme"===n)&&x.widgetOnScreen){var v=x.widgetOnScreen.widgets;if(v&&0<v.length){n="themes/"+n+"/widgets/HeaderController/Widget";for(var t=null,m=0;m<v.length;m++)(t=v[m])&&t.uri===n&&t.position&&310===t.position.paddingRight&&(t.position.paddingRight=275)}}}return x},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(x){x.keepAppState=!0;return x},compatible:!0},
{version:"2.0",description:"The version for Online 4.1.",upgrader:function(x){return x},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(x){return x},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(x){return x},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(x){return x},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(x){function n(m,
h){if(!m||!h)return!1;for(var p in h)if(h.hasOwnProperty(p))if("object"===typeof h[p]){if(!n(m[p],h[p]))return!1}else if(m[p]!==h[p])return!1;return!0}function v(m){function h(){var c=n(m[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),f=n(m[12],{position:{top:10,right:195}});return c&&f}function p(){var c=n(m[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),f=n(m[12],{position:{left:15,top:233}});return c&&f}function e(){var c=n(m[3],{uri:"widgets/MyLocation/Widget",
position:{left:15,top:120}}),f=n(m[12],{position:{right:15,top:195}});return c&&f}(function(){var c=n(m[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),f=n(m[12],{position:{left:240,top:53}});return c&&f})()?m.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):h()?m.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):p()?m.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,
bottom:195},version:"2.3"}):e()&&m.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"})}function t(m){function h(){var e=n(m[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=n(m[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),f=n(m[4],{position:{left:7,bottom:70}});return e&&c&&f}function p(){var e=n(m[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=n(m[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,
relativeTo:"browser"}}),f=n(m[4],{position:{left:7,bottom:70}});return e&&c&&f}(function(){var e=n(m[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=n(m[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),f=n(m[4],{position:{left:55,top:45}});return e&&c&&f}()||h()||p())&&m.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:148,left:7},version:"2.3"})}(function(m,h,p){m=m.theme&&m.theme.name;if("FoldableTheme"===m)if(n(h[11],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(n(h[11],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),p&&p.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:12,top:211},version:"2.3"});else{if(n(h[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){h.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(m=0;m<h.length;m++){var e=h[m];n(e,{uri:"widgets/Scalebar/Widget",position:{left:220,bottom:5}})&&(e.position.left=288);n(e,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(e.position.left=463)}p&&p.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===m)v(h);else if("BoxTheme"===m)h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,
top:131},version:"2.3"});else if("JewelryBoxTheme"===m)t(h);else if("LaunchpadTheme"===m){if(n(h[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}})||n(h[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),p&&p.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===m?(n(h[6],{uri:"widgets/MyLocation/Widget",position:{left:7,
top:110}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),n(h[6],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===m&&n(h[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(x,x.widgetOnScreen.widgets,x.mobileLayout&&
x.mobileLayout.widgetOnScreen&&x.mobileLayout.widgetOnScreen.widgets);return x},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(x){return x},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(x){function n(v,t){if(!v||!t)return!1;for(var m in t)if(t.hasOwnProperty(m))if("object"===typeof t[m]){if(!n(v[m],t[m]))return!1}else if(v[m]!==t[m])return!1;return!0}(function(v,t){v=v.theme&&v.theme.name;if("BillboardTheme"===
v){v=n(t[8],{position:{left:60,top:53}});var m=n(t[8],{position:{left:15,top:53}});v||m?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"})}else if("BoxTheme"===v){a:{v=0;for(m=t.length;v<m;v++){var h=t[v];if(h&&h.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===h.uri){v=h;break a}}v=null}n(v,{position:{right:0,bottom:0}})?t.push({uri:"widgets/FullScreen/Widget",
visible:!1,position:{right:8,top:8},version:"2.5"}):t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===v?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"FoldableTheme"===v?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===v?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===
v?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===v?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===v?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===v&&(n(t[7],{position:{left:45,top:45}})?t.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):t.push({uri:"widgets/FullScreen/Widget",
visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(x,x.widgetOnScreen.widgets);return x},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(x){return x},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(x){return x},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(x){function n(v){var t=[];if("object"===typeof v)for(var m in v){var h=v[m];"FeatureStatistics"===h.type&&t.push(h)}return t}
(function(v){(v=v.dataSource&&v.dataSource.dataSources)&&(v=n(v))&&v.length&&v.forEach(function(t){(t=t.dataSchema&&t.dataSchema.statistics)&&t.length&&t.forEach(function(m){if(m&&"count"===m.statisticType&&"count"===m.outStatisticFieldName)m.outStatisticFieldName="STAT_COUNT";else{var h=(h=m.outStatisticFieldName)&&h.toUpperCase();m.outStatisticFieldName=h}})})})(x);return x},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(x){return x},compatible:!0},{version:"2.10",
description:"The version for Online 6.3.",upgrader:function(x){return x},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(x){return x},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(x){return x},compatible:!0},{version:"2.13",description:"The version for Online 7.2",upgrader:function(x){if(x.theme&&"PlateauTheme"===x.theme.name&&x.widgetOnScreen&&x.widgetOnScreen.widgets)for(var n=x.widgetOnScreen.widgets,v=0;v<n.length;v++)if("widgets/AttributeTable/Widget"===
n[v].uri&&n[v].position){n[v].position.relativeTo="browser";break}return x},compatible:!0},{version:"2.14",description:"The version for Online 7.3",upgrader:function(x){return x},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(x){return x},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(x){return x},compatible:!0},{version:"2.17",description:"The version for Online 8.2",upgrader:function(x){return x},compatible:!0},
{version:"2.18",description:"The version for Online 8.3",upgrader:function(x){return x},compatible:!0},{version:"2.19",description:"The version for Online 8.4",upgrader:function(x){return x},compatible:!0}];this.isCompatible=function(x,n){x=this.getVersionIndex(x);n=this.getVersionIndex(n);for(x+=1;x<=n;x++)if(!1===this.versions[x].compatible)return!1;return!0}}z.prototype=new F;return z.prototype.constructor=z})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(F,r,z){r=this.getVersionIndex(r);z=this.getVersionIndex(z);if(r>z)throw Error("New version should higher than old version.");for(r+=1;r<=z;r++)this.versions[r].upgrader&&(F=this.versions[r].upgrader(F));return F};this.getVersionIndex=function(F){F=this.fixVersion(F);var r,z;for(z=0;z<this.versions.length;z++)this.versions[z].version===F&&(r=z);null===F&&(r=-1);void 0===r&&(r=this.versions.length-1);return r};this.fixVersion=function(F){return F?F:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr dojo/request/script ./utils ./privilegeUtils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w){var y=null;var C=F(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(D,G){this._removeHash(D);this.urlParams=D||{};this.widgetManager=f.getInstance();r.mixin(this,G)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(r.hitch(this,function(D){var G=this.checkConfig(D);if(G)throw Error(G);this.rawAppConfig=r.clone(D);q.getInstance().setRawAppConfig(this.rawAppConfig);
D=this._upgradeAppConfig(D);this._processAfterTryLoad(D);this.appConfig=D;if(this.urlParams.id)return this.loadWidgetsManifest(D).then(r.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(D)})).then(r.hitch(this,function(H){return this.updateNecessaryAttrOfResourceUrlInAppConfig(H,this.urlParams.id)})).then(r.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(D);this._readAndSetSharedTheme(D);return this.getAppConfig()}));d.setPortalUrl(D.portalUrl);w.arcgisUrl=l.getBaseItemUrl(D.portalUrl);
return this._proesssWebTierAndSignin(D).then(r.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var H=l.getStandardPortalUrl(D.portalUrl),L=a.getPortal(H);return c.checkIsSelfOrigin(this.urlParams.appid,L,d.isInBuilderWindow()).then(r.hitch(this,function(T){if(!T)throw T=Error(window.jimuNls.orgUrlMessage),T.isSelfOrigin=!1,T;})).then(r.hitch(this,function(){return c.checkEssentialAppsLicense(this.urlParams.appid,L,d.isInBuilderWindow()).then(r.hitch(this,function(){return this._getAppConfigFromTemplateAppId(D.portalUrl,
this.urlParams.appid).then(r.hitch(this,function(T){this._tryUpdateAppConfigByLocationUrl(T);return this._processInPortalAppProtocol(T)}))}),r.hitch(this,function(T){console.error(T);if(T.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}))}return this._processNotInPortalAppProtocol(D).then(r.hitch(this,function(T){return this._getAppDataAddTemplateDataFromTemplateAppId(T.portalUrl,this.urlParams.appid).then(r.hitch(this,
function(K){K.appData.appConfig&&(T=K.appData.appConfig);T._appData=K.appData;T.templateConfig=K.templateData;T.isTemplateApp=!0;return T}))}))}return this._processNotInPortalAppProtocol(D)})).then(r.hitch(this,function(H){this._processAfterTryLoad(H);this.appConfig=H;return H.map.itemId?H:(H.map["3D"]?a.getDefaultWebScene(H.portalUrl):a.getDefaultWebMap(H.portalUrl)).then(function(L){H.map.itemId=L;return H})})).then(r.hitch(this,function(H){return this.loadWidgetsManifest(H)})).then(r.hitch(this,
function(H){return H._appData?H._appData.values&&H._appData.values.webmap?a.getPortal(H.portalUrl).getItemById(H._appData.values.webmap).then(r.hitch(this,function(L){return e.template.mergeTemplateAppConfigToAppConfig(H,H._appData,L)})):e.template.mergeTemplateAppConfigToAppConfig(H,H._appData):H})).then(r.hitch(this,function(H){return this.loadAndUpgradeAllWidgetsConfig(H)})).then(r.hitch(this,function(H){return H._wabAppId?this.processResourceInAppConfigForConfigLoader(H,this.urlParams):H.appItemId&&
-1<window.JSON.stringify(H).indexOf("${itemId}")?this.updateNecessaryAttrOfResourceUrlInAppConfig(H,H.appItemId):H})).then(r.hitch(this,function(H){this.appConfig=H;this._configLoaded=!0;this._setDocumentTitle(H);this._readAndSetSharedTheme(H);return this.getAppConfig()}))}),r.hitch(this,function(D){var G=new t;G.reject(D);return G}))},processResourceInAppConfigForConfigLoader:function(D,G){var H=D.portalUrl,L=D.appItemId,T=G.appid,K=new t,O=r.clone(D);this.updateNecessaryAttrOfResourceUrlInAppConfig(O,
T).then(function(){if("config"===G.mode){var I=this.getResourceUrlsOfAppConfig(D).result;0!==I.length?a.getItemResources(H,T).then(function(P){if(0===P.length)return I=I.map(function(Q){return{resUrl:Q}}),g.AddResourcesToItemForAppSave(H,I,L,T).then(function(){K.resolve(O)},function(Q){console.warn("Add resource to template based app error:"+Q.message||Q);K.resolve(O)});K.resolve(O)},function(P){console.warn("Get resource of template based item error:"+P.message||P);K.resolve(O)}):K.resolve(O)}else K.resolve(O)}.bind(this),
function(I){console.warn("Insert appId to resource url of appConfig error:"+I.message||I);K.resolve(O)});return K},getResourceUrlsOfAppConfig:function(D){var G={test:function(H){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(H)},func:r.hitch(this,function(H){return H.value})};return e.processItemResourceOfAppConfig(D,G)},updateNecessaryAttrOfResourceUrlInAppConfig:function(D,G){function H(O){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(O)}
function L(O,I){O=K.processItemIDAndTokenOfResources(I.value,O);O=K.setResouceProtocolForHttps(O);var P=I.obj,Q=I.key;"number"===typeof I.i?P[Q][I.i]=O:P[Q]=O;return!0}var T=D.portalUrl,K=this;return a.getPortal(T).getItemById(G).then(r.hitch(this,function(O){O={test:H,func:r.hitch(this,L,{appId:G,isPublic:"public"===O.access,portalUrl:T})};return e.processItemResourceOfAppConfig(D,O).appConfig}))},setResouceProtocolForHttps:function(D){var G=D;"https:"===window.location.protocol&&(G=D.replace(/^http(s?):\/\//i,
"https://"));return G},processItemIDAndTokenOfResources:function(D,G){0<D.indexOf("${itemId}")&&(D=D.replace("${itemId}",G.appId));/(\?|&)token=.+/.test(D)&&(D=D.replace(/(\?|&)token=.+/,""));G.isPublic||(G=d.getPortalCredential(G.portalUrl))&&(D+="?token\x3d"+G.token);return D},_setDocumentTitle:function(D){!window.isBuilder&&D&&D.title&&(document.title=e.stripHTML(D.title))},getAppConfig:function(){var D=r.clone(this.appConfig);D.getConfigElementById=function(G){return e.getConfigElementById(this,
G)};D.getConfigElementsByName=function(G){return e.getConfigElementsByName(this,G)};D.visitElement=function(G){e.visitElement(this,G)};this._addAuthorizedCrossOriginDomains(this.portalSelf,D);return D},_addAuthorizedCrossOriginDomains:function(D,G){D&&D.authorizedCrossOriginDomains&&d.addAuthorizedCrossOriginDomains(D.authorizedCrossOriginDomains);G&&G.authorizedCrossOriginDomains&&d.addAuthorizedCrossOriginDomains(G.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(D){u.defaults.io.alwaysUseProxy=
D.httpProxy&&D.httpProxy.useProxy&&D.httpProxy.alwaysUseProxy;u.defaults.io.proxyUrl="";u.defaults.io.proxyRules=[];D.httpProxy&&D.httpProxy.useProxy&&D.httpProxy.url&&(u.defaults.io.proxyUrl=D.httpProxy.url);D.httpProxy&&D.httpProxy.useProxy&&D.httpProxy.rules&&z.forEach(D.httpProxy.rules,function(G){k.addProxyRule(G)})},addNeedValues:function(D){this._processNoUriWidgets(D);this._processEmptyGroups(D);this._addElementId(D);this._fixRepeatedId(D)},showError:function(D){D&&D.message&&(x.create("div",
{"class":"app-error",innerHTML:e.sanitizeHTML(D.message)},document.body),x.setStyle(jimuConfig.loadingId,"display","none"))},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,h(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(r.hitch(this,function(L){d.setPortalUrl(L.portalUrl);L.portalUrl&&(window.portalUrl=L.portalUrl);
return this.urlParams.token?d.registerToken(this.urlParams.token).then(function(){return L}):L}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var D=l.getPortalUrlFromLocation(),G=new t;d.setPortalUrl(D);window.portalUrl=D;w.arcgisUrl=l.getBaseItemUrl(D);if(this.urlParams.token)var H=d.registerToken(this.urlParams.token);else H=new t,H.resolve();H.then(r.hitch(this,function(){var L=a.getPortal(D);L.loadSelfInfo().then(r.hitch(this,function(T){this.portalSelf=T;T.allSSL&&"http:"===window.location.protocol?
(console.log("redirect from http to https"),window.location.href=l.setHttpsProtocol(window.location.href),G.reject()):this._processSignIn(D).then(r.hitch(this,function(){this._getAppConfigFromAppId(D,this.urlParams.id).then(r.hitch(this,function(K){return c.checkIsSelfOrigin(this.urlParams.id,L,d.isInBuilderWindow()).then(r.hitch(this,function(O){if(O)return K;O=Error(window.jimuNls.orgUrlMessage);O.isSelfOrigin=!1;throw O;}))})).then(r.hitch(this,function(K){return c.checkEssentialAppsLicense(this.urlParams.id,
L,d.isInBuilderWindow()).then(r.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(K);return this._processInPortalAppProtocol(K)}),r.hitch(this,function(O){console.error(O);if(O.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(K){G.resolve(K)},function(K){G.reject(K)})}))}))}),r.hitch(this,function(L){this.showError(L)}));return G}this.configFile="config.json";return h(this.configFile,{handleAs:"json"}).then(r.hitch(this,
function(L){d.setPortalUrl(L.portalUrl);L.portalUrl&&(window.portalUrl=L.portalUrl);return this.urlParams.token?d.registerToken(this.urlParams.token).then(function(){return L}):L}))},_upgradeAppConfig:function(D){var G=window.wabVersion,H=D.wabVersion;D.configWabVersion=D.wabVersion;if(G===H)return D;var L=this.versionManager.getVersionIndex(H),T=this.versionManager.getVersionIndex(G);if(L>T)throw Error("Bad version number, "+H);D=this.versionManager.upgrade(D,H,G);D.wabVersion=G;return D},loadAndUpgradeAllWidgetsConfig:function(D){var G=
new t,H=[];b.visitElement(D,r.hitch(this,function(L){L.uri&&(L=this.widgetManager.tryLoadWidgetConfig(L),H.push(L))}));m(H).then(r.hitch(this,function(){G.resolve(D)}),function(L){G.reject(L)});return G},_processAfterTryLoad:function(D){this._setPortalUrl(D);this._tryUpdateAppConfigByLocationUrl(D);this._processUrlParams(D);this.addNeedValues(D);this.processProxy(D);A.tokenValidity=10080;return D},_readAndSetSharedTheme:function(D){D.theme.sharedTheme?this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme||
(D.theme.sharedTheme.isPortalSupport=!1):(D.theme.sharedTheme={useHeader:!1,useLogo:!1},D.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);D.theme.sharedTheme.useHeader&&(D.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(D.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},D.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));
D.theme.sharedTheme.useLogo&&(D.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(D.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!D.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(D.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),D.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(D){if(!(this.urlParams.config&&
-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var G=l.getPortalUrlFromLocation();G=l.getStandardPortalUrl(G);l.isOnline(G)&&(G=l.updateUrlProtocolByOtherUrl(G,D.portalUrl),D.map.portalUrl&&l.isSamePortalUrl(D.portalUrl,D.map.portalUrl)&&(D.map.portalUrl=G),D.portalUrl=G,D.httpProxy&&D.httpProxy.url&&(D.httpProxy.url=l.getPortalProxyUrl(G)))}},_processWidgetJsons:function(D){b.visitElement(D,function(G,H){H.isWidget&&G.uri&&e.widgetJson.processWidgetJson(G)})},_processNoUriWidgets:function(D){var G=
0;b.visitElement(D,function(H,L){L.isWidget&&!H.uri&&(G++,H.placeholderIndex=G)})},_processEmptyGroups:function(D){var G=0;D.widgetOnScreen.groups&&z.forEach(D.widgetOnScreen.groups,function(H){if(!H.widgets||H.widgets&&0===H.widgets.length)G++,H.placeholderIndex=G})},_addElementId:function(D){var G=0,H;b.visitElement(D,function(L){if(L.id){L.id=L.id.replace(/\//g,"_");var T=L.id.lastIndexOf("_");-1<T&&(H=L.id.substr(T+1),G=Math.max(G,H))}});b.visitElement(D,function(L){L.id||(G++,L.id=L.itemId?L.itemId+
"_"+G:L.uri?L.uri.replace(/\//g,"_")+"_"+G:"_"+G)})},_setPortalUrl:function(D){if(D.portalUrl){var G=l.getPortalUrlFromLocation(),H=l.isOnline(G);l.isSamePortalUrl(D.portalUrl,G)||H||(window.appInfo.isRunInPortal=!1)}else window.isXT&&v("wab_portalurl")?D.portalUrl=v("wab_portalurl"):(window.appInfo.isRunInPortal=!0,D.portalUrl=l.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(D,G){D.portalUrl=l.setProtocol(D.portalUrl,G);D.map.portalUrl&&(D.map.portalUrl=l.setProtocol(D.map.portalUrl,
G));D.httpProxy&&(D.httpProxy.url=l.setProtocol(D.httpProxy.url,G),D.httpProxy&&D.httpProxy.rules&&z.forEach(D.httpProxy.rules,r.hitch(this,function(H){H.proxyUrl=l.setProtocol(H.proxyUrl,G)})))},_processInPortalAppProtocol:function(D){var G=new t,H=a.getPortal(D.portalUrl),L=r.hitch(this,function(T){if("https:"===window.location.protocol)this._changePortalUrlProtocol(D,"https");else{if(T){console.log("redirect from http to https");window.location.href=l.setHttpsProtocol(window.location.href);G.reject();
return}this._changePortalUrlProtocol(D,"http")}this._checkLocale();G.resolve(D)});H.loadSelfInfo().then(r.hitch(this,function(T){this.portalSelf=T;"private"===T.access?(T=0===D.portalUrl.toLowerCase().indexOf("https://"),L(T)):L(T.allSSL)}),r.hitch(this,function(T){G.reject(T)}));return G},_processNotInPortalAppProtocol:function(D){var G=new t;D.portalUrl?a.getPortal(D.portalUrl).loadSelfInfo().then(r.hitch(this,function(H){this.portalSelf=H;var L="https:"===window.location.protocol;(H.allSSL||L)&&
this._changePortalUrlProtocol(D,"https");0!==D.portalUrl.toLowerCase().indexOf("https://")||L||d.isInConfigOrPreviewWindow()?G.resolve(D):(console.log("redirect from http to https"),window.location.href=l.setHttpsProtocol(window.location.href),G.reject())}),r.hitch(this,function(H){G.reject(H)})):G.resolve(D);return G},_proesssWebTierAndSignin:function(D){var G=new t,H=!1,L=D.portalUrl;this._processWebTier(D).then(r.hitch(this,function(T){H=T;return a.getPortal(L).loadSelfInfo()})).then(r.hitch(this,
function(T){this.portalSelf=T;return this._processSignIn(L,H)})).then(r.hitch(this,function(){G.resolve()}),function(T){G.reject(T)});return G},_processWebTier:function(D){var G=new t,H=D.portalUrl;D.isWebTier?(d.addAuthorizedCrossOriginDomains([H]),d.isWebTierPortal(H).then(r.hitch(this,function(){var L=d.getPortalCredential(H);L&&L.ssl&&"http:"===window.location.protocol&&!d.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=l.setHttpsProtocol(window.location.href)):
G.resolve(D.isWebTier)}),r.hitch(this,function(L){G.reject(L)}))):G.resolve(!1);return G},_processSignIn:function(D,G){var H=new t,L=a.getPortal(D),T=l.getSharingUrl(D),K=l.setHttpsProtocol(D+"/sharing/generateToken?f\x3djson");window.appInfo.isRunInPortal?(G=A.checkSignInStatus(T),G.promise.then(r.hitch(this,function(O){O.token?H.resolve():p.get(K,{jsonp:"callback"}).then(r.hitch(this,function(I){I&&I.token&&(O.token=I.token,O.expires||(O.expires=I.expires));H.resolve()}),r.hitch(this,function(I){console.error(I);
H.resolve()}))}),r.hitch(this,function(){H.resolve()}))):(!d.isInBuilderWindow()&&!d.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!G&&d.registerOAuthInfo(D,this.rawAppConfig.appId),G=A.checkSignInStatus(T),G.promise.always(r.hitch(this,function(){d.xtGetCredentialFromCookie(D);L.loadSelfInfo().then(r.hitch(this,function(O){this.portalSelf=O;this._checkLocale();H.resolve()}))})));return H},_checkLocale:function(){if(!d.isInConfigOrPreviewWindow()){var D=
this.portalSelf.user&&this.portalSelf.user.culture||n.locale;D="hi"===D?"en":D.toLowerCase();!this.urlParams.locale&&e.isLocaleChanged(n.locale,D)&&(v("wab_app_locale",D),window.location.reload())}},_getAppConfigFromTemplateAppId:function(D,G){var H=a.getPortal(D);return this._getWabAppIdAndDataFromTemplateAppId(D,G).then(r.hitch(this,function(L){var T=L.appId,K=L.appData;return m([this._getAppConfigFromAppId(D,T),H.getItemData(K.source)]).then(r.hitch(this,function(O){if(K.appConfig){var I=K.appConfig;
delete K.appConfig}else I=O[0];I=this._upgradeAppConfig(I);O=O[1];I._appData=K;I._wabAppId=T;I.templateConfig=O;I.isTemplateApp=!0;return I}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(D,G){var H=a.getPortal(D);return H.getItemData(G).then(function(L){return H.getItemData(L.source).then(function(T){return{appData:L,templateData:T}})})},_getWabAppIdAndDataFromTemplateAppId:function(D,G){var H=new t,L=a.getPortal(D);L.getItemData(G).then(r.hitch(this,function(T){L.getItemById(T.source).then(r.hitch(this,
function(K){K=k.urlToObject(K.url);H.resolve({appId:K.query.id,appData:T})}))}),function(T){H.reject(T)});return H},_getAppConfigFromAppId:function(D,G){return a.getPortal(D).getItemData(G)},_removeHash:function(D){for(var G in D)D[G]&&(D[G]=D[G].replace("#",""))},loadWidgetsManifest:function(D){function G(K,O,I){function P(Q){return K.loadWidgetManifest(Q).then(function(U){return U},function(U){console.log("Widget failed to load, it is removed.",Q.name);U.stack?console.error(U.stack):console.log(U);
H(D,Q)})}return O.itemId?a.getPortal(I).getItemById(O.itemId).then(function(Q){O.uri=e.widgetJson.getUriFromItem(Q);return P(O)},function(Q){console.log("Widget is not loaded, it is removed.",O.name,Q);H(D,O)}):P(O)}function H(K,O){function I(P){K[P]&&K[P].widgets&&(K[P].widgets=K[P].widgets.filter(function(Q){if(O)return Q.id!==O.id;Q.uri&&!Q.manifest&&console.error("Widget is removed because it is not loaded successfully.",Q.uri);return Q.manifest}));K[P]&&K[P].groups&&K[P].groups.forEach(function(Q){Q.widgets&&
(Q.widgets=Q.widgets.filter(function(U){if(O)return U.id!==O.id;U.uri&&!U.manifest&&console.error("Widget is removed because it is not loaded successfully.",U.uri);return U.manifest}))})}I("widgetOnScreen");I("widgetPool")}var L=[],T=new t;this.urlParams.manifest&&D._buildInfo&&D._buildInfo.widgetManifestsMerged&&delete D._buildInfo.widgetManifestsMerged;D._buildInfo&&D._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(r.hitch(this,function(K){b.visitElement(D,r.hitch(this,function(O){O.widgets||
!O.uri&&!O.itemId||(O.uri&&K[O.uri]?(this._addNeedValuesForManifest(K[O.uri],O.uri),e.widgetJson.addManifest2WidgetJson(O,K[O.uri])):L.push(G(this.widgetManager,O,D.portalUrl)))}));m(L).then(function(){T.resolve(D)})})):(b.visitElement(D,r.hitch(this,function(K){K.widgets||!K.uri&&!K.itemId||L.push(G(this.widgetManager,K,D.portalUrl))})),m(L).then(function(){T.resolve(D)}));setTimeout(function(){T.isResolved()||(H(D),T.resolve(D))},6E4);return T},_addNeedValuesForManifest:function(D,G){r.mixin(D,
e.getUriInfo(G));e.manifest.addManifestProperies(D);e.manifest.processManifestLabel(D,n.locale)},_loadMergedWidgetManifests:function(){return h(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(D){var G=[];b.visitElement(D,function(H){0<=G.indexOf(H.id)&&(H.id+="_");G.push(H.id)})},_processUrlParams:function(D){var G=this.urlParams.itemid||this.urlParams.webmap;G&&D.map.itemId!==G&&(D.map.mapOptions&&e.deleteMapOptions(D.map.mapOptions),D.map.itemId=
G);this.urlParams.mode&&(D.mode=this.urlParams.mode);D.map.mapOptions||(D.map.mapOptions={});this.urlParams.scale&&(D.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)D.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});C.getInstance=function(D,G){null===y?y=new C(D,G):(y.urlParams=D||{},y.options=G);return y};return C})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(F,
r,z,x){return{AddResourcesToItemForAppSave:function(n,v,t,m){v=v||[];if(0===v.length){var h=new F;h.resolve(v);return h}v=v.map(function(p){var e=p.resUrl.split("resources/")[1],c=new F;p.b64?(p=x.b64toBlob(p.b64),c.resolve({blob:p,fileName:e.split("/")[1],prefixName:e.split("/")[0]})):(p=p.resUrl,0<p.indexOf("${itemId}")&&(p=p.replace("${itemId}",t)),x.resourcesUrlToBlob(p).then(function(f){c.resolve({blob:f,fileName:e.split("/")[1],prefixName:e.split("/")[0]},function(b){console.error(b.message||
b);c.reject(b)})}));return c});return r(v).then(function(p){if(p instanceof Array&&0<p.length)return p=p.map(function(e){var c=t;m&&(c=m);return z.addResource(n,c,e.blob,e.fileName,e.prefixName)}.bind(this)),r(p).then(function(e){return e})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(F,r,z,x,n,v,t,m,h){var p=null,
e=F(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(c){this.rawAppConfig=c},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var c=x.stringify(this.rawAppConfig.map);this.mapMd5=m(c)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var c=new z,f={};if(h.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return c.resolve(f),
c;var b=this._getAppStateKey(),d=t.get(b);d&&d.appStateMd5===this._getAppStateMd5()?(b=d.map&&d.map.extent,d=d.map&&d.map.layers,b&&(f.extent=new n(b.xmin,b.ymin,b.xmax,b.ymax,new v(b.spatialReference))),d&&(f.layers=d)):t.remove(b);c.resolve(f);return c},saveWabAppState:function(c,f){if(c&&!h.isInConfigOrPreviewWindow()){var b=this._getAppStateKey(),d={extent:{xmin:c.extent.xmin,xmax:c.extent.xmax,ymin:c.extent.ymin,ymax:c.extent.ymax,spatialReference:{wkid:c.extent.spatialReference.wkid,wkt:c.extent.spatialReference.wkt}},
layers:{}};f&&f.traversal&&f.traversal(r.hitch(this,function(a){d.layers[a.id]={visible:a.isVisible()}}));t.set(b,{map:d,appStateMd5:this._getAppStateMd5()})}}});e.getInstance=function(c){null===p&&(p=new e);p.urlParams=c;return p};return e})},"libs/storejs/store":function(){!function(F){"object"==typeof exports&&"undefined"!=typeof module?module.exports=F():"function"==typeof define&&define.amd?define([],F):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?
self:this).store=F()}(function(){return function n(r,z,x){function v(h,p){if(!z[h]){if(!r[h]){var e="function"==typeof require&&require;if(!p&&e)return e(h,!0);if(t)return t(h,!0);p=Error("Cannot find module '"+h+"'");throw p.code="MODULE_NOT_FOUND",p;}p=z[h]={exports:{}};r[h][0].call(p.exports,function(c){var f=r[h][1][c];return v(f?f:c)},p,p.exports,n,r,z,x)}return z[h].exports}for(var t="function"==typeof require&&require,m=0;m<x.length;m++)v(x[m]);return v}({1:[function(r,z,x){x=r("../src/store-engine");
var n=r("../storages/all");r=r("../plugins/all");z.exports=x.createStore(n,r)},{"../plugins/all":2,"../src/store-engine":15,"../storages/all":17}],2:[function(r,z,x){z.exports=[r("./defaults"),r("./dump"),r("./events"),r("./observe"),r("./expire"),r("./json2"),r("./operations"),r("./update"),r("./v1-backcompat")]},{"./compression":3,"./defaults":4,"./dump":5,"./events":6,"./expire":7,"./json2":8,"./observe":11,"./operations":12,"./update":13,"./v1-backcompat":14}],3:[function(r,z,x){var n=r("./lib/lz-string");
z.exports=function(){return{get:function(v,t){v=v(t);if(!v)return v;t=n.decompress(v);return null==t?v:this._deserialize(t)},set:function(v,t,m){m=n.compress(this._serialize(m));v(t,m)}}}},{"./lib/lz-string":10}],4:[function(r,z,x){z.exports=function(){var n={};return{defaults:function(v,t){n=t},get:function(v,t){v=v();return void 0!==v?v:n[t]}}}},{}],5:[function(r,z,x){z.exports=function(){return{dump:function(n){var v={};return this.each(function(t,m){v[m]=t}),v}}}},{}],6:[function(r,z,x){r=r("../src/util");
var n=r.bind,v=r.each,t=r.create,m=r.slice;z.exports=function(){var p=t(h,{_id:0,_subSignals:{},_subCallbacks:{}});return{watch:function(e,c,f){return p.on(c,n(this,f))},unwatch:function(e,c){p.off(c)},once:function(e,c,f){p.once(c,n(this,f))},set:function(e,c,f){var b=this.get(c);e();p.fire(c,f,b)},remove:function(e,c){var f=this.get(c);e();p.fire(c,void 0,f)},clearAll:function(e){var c={};this.each(function(f,b){c[b]=f});e();v(c,function(f,b){p.fire(b,void 0,f)})}}};var h={_id:null,_subCallbacks:null,
_subSignals:null,on:function(p,e){return this._subCallbacks[p]||(this._subCallbacks[p]={}),this._id+=1,this._subCallbacks[p][this._id]=e,this._subSignals[this._id]=p,this._id},off:function(p){delete this._subCallbacks[this._subSignals[p]][p];delete this._subSignals[p]},once:function(p,e){var c=this.on(p,n(this,function(){e.apply(this,arguments);this.off(c)}))},fire:function(p){var e=m(arguments,1);v(this._subCallbacks[p],function(c){c.apply(this,e)})}}},{"../src/util":16}],7:[function(r,z,x){z.exports=
function(){function n(t){v.get(t,Number.MAX_VALUE)<=(new Date).getTime()&&(this.raw.remove(t),v.remove(t))}var v=this.createStore(this.storage,null,this._namespacePrefix+"expire_mixin");return{set:function(t,m,h,p){return this.hasNamespace("expire_mixin")||v.set(m,p),t()},get:function(t,m){return this.hasNamespace("expire_mixin")||n.call(this,m),t()},remove:function(t,m){return this.hasNamespace("expire_mixin")||v.remove(m),t()},getExpiration:function(t,m){return v.get(m)},removeExpiredKeys:function(t){var m=
[];this.each(function(h,p){m.push(p)});for(t=0;t<m.length;t++)n.call(this,m[t])}}}},{}],8:[function(r,z,x){z.exports=function(){return r("./lib/json2"),{}}},{"./lib/json2":9}],9:[function(r,z,x){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v};"object"!==("undefined"==typeof JSON?"undefined":n(JSON))&&(JSON={});(function(){function v(A){return 10>
A?"0"+A:A}function t(){return this.valueOf()}function m(A){return b.lastIndex=0,b.test(A)?'"'+A.replace(b,function(u){var k=l[u];return"string"==typeof k?k:"\\u"+("0000"+u.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+A+'"'}function h(A,u){var k,w,y,C=a,D=u[A];switch(D&&"object"===("undefined"==typeof D?"undefined":n(D))&&"function"==typeof D.toJSON&&(D=D.toJSON(A)),"function"==typeof q&&(D=q.call(u,A,D)),"undefined"==typeof D?"undefined":n(D)){case "string":return m(D);case "number":return isFinite(D)?
String(D):"null";case "boolean":case "null":return String(D);case "object":if(!D)return"null";if(a+=g,y=[],"[object Array]"===Object.prototype.toString.apply(D)){u=D.length;for(A=0;A<u;A+=1)y[A]=h(A,D)||"null";return w=0===y.length?"[]":a?"[\n"+a+y.join(",\n"+a)+"\n"+C+"]":"["+y.join(",")+"]",a=C,w}if(q&&"object"===("undefined"==typeof q?"undefined":n(q)))for(u=q.length,A=0;A<u;A+=1)"string"==typeof q[A]&&(k=q[A],w=h(k,D),w&&y.push(m(k)+(a?": ":":")+w));else for(k in D)Object.prototype.hasOwnProperty.call(D,
k)&&(w=h(k,D),w&&y.push(m(k)+(a?": ":":")+w));return w=0===y.length?"{}":a?"{\n"+a+y.join(",\n"+a)+"\n"+C+"}":"{"+y.join(",")+"}",a=C,w}}var p=/^[\],:{}\s]*$/,e=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,c=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,f=/(?:^|:|,)(?:\s*\[)+/g,b=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+v(this.getUTCMonth()+1)+"-"+v(this.getUTCDate())+"T"+v(this.getUTCHours())+":"+v(this.getUTCMinutes())+":"+v(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=t,Number.prototype.toJSON=t,String.prototype.toJSON=t);var a,g,l,q;"function"!=typeof JSON.stringify&&(l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(A,
u,k){var w;if(a="",g="","number"==typeof k)for(w=0;w<k;w+=1)g+=" ";else"string"==typeof k&&(g=k);if(q=u,u&&"function"!=typeof u&&("object"!==("undefined"==typeof u?"undefined":n(u))||"number"!=typeof u.length))throw Error("JSON.stringify");return h("",{"":A})});"function"!=typeof JSON.parse&&(JSON.parse=function(A,u){function k(y,C){var D,G,H=y[C];if(H&&"object"===("undefined"==typeof H?"undefined":n(H)))for(D in H)Object.prototype.hasOwnProperty.call(H,D)&&(G=k(H,D),void 0!==G?H[D]=G:delete H[D]);
return u.call(y,C,H)}var w;if(A=String(A),d.lastIndex=0,d.test(A)&&(A=A.replace(d,function(y){return"\\u"+("0000"+y.charCodeAt(0).toString(16)).slice(-4)})),p.test(A.replace(e,"@").replace(c,"]").replace(f,"")))return w=eval("("+A+")"),"function"==typeof u?k({"":w},""):w;throw new SyntaxError("JSON.parse");})})()},{}],10:[function(r,z,x){r=function(){function n(h,p){if(!t[h]){t[h]={};for(var e=0;e<h.length;e++)t[h][h.charAt(e)]=e}return t[h][p]}var v=String.fromCharCode,t={},m={compressToBase64:function(h){if(null==
h)return"";h=m._compress(h,6,function(p){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(p)});switch(h.length%4){default:case 0:return h;case 1:return h+"\x3d\x3d\x3d";case 2:return h+"\x3d\x3d";case 3:return h+"\x3d"}},decompressFromBase64:function(h){return null==h?"":""==h?null:m._decompress(h.length,32,function(p){return n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",h.charAt(p))})},compressToUTF16:function(h){return null==h?"":m._compress(h,
15,function(p){return v(p+32)})+" "},decompressFromUTF16:function(h){return null==h?"":""==h?null:m._decompress(h.length,16384,function(p){return h.charCodeAt(p)-32})},compressToUint8Array:function(h){h=m.compress(h);for(var p=new Uint8Array(2*h.length),e=0,c=h.length;e<c;e++){var f=h.charCodeAt(e);p[2*e]=f>>>8;p[2*e+1]=f%256}return p},decompressFromUint8Array:function(h){if(null===h||void 0===h)return m.decompress(h);for(var p=Array(h.length/2),e=0,c=p.length;e<c;e++)p[e]=256*h[2*e]+h[2*e+1];var f=
[];return p.forEach(function(b){f.push(v(b))}),m.decompress(f.join(""))},compressToEncodedURIComponent:function(h){return null==h?"":m._compress(h,6,function(p){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(p)})},decompressFromEncodedURIComponent:function(h){return null==h?"":""==h?null:(h=h.replace(/ /g,"+"),m._decompress(h.length,32,function(p){return n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",h.charAt(p))}))},compress:function(h){return m._compress(h,
16,function(p){return v(p)})},_compress:function(h,p,e){if(null==h)return"";var c,f,b={},d={},a="",g="",l="",q=2,A=3,u=2,k=[],w=0,y=0;for(f=0;f<h.length;f+=1)if(a=h.charAt(f),Object.prototype.hasOwnProperty.call(b,a)||(b[a]=A++,d[a]=!0),g=l+a,Object.prototype.hasOwnProperty.call(b,g))l=g;else{if(Object.prototype.hasOwnProperty.call(d,l)){if(256>l.charCodeAt(0)){for(c=0;c<u;c++)w<<=1,y==p-1?(y=0,k.push(e(w)),w=0):y++;var C=l.charCodeAt(0);for(c=0;8>c;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,
C>>=1}else{C=1;for(c=0;c<u;c++)w=w<<1|C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C=0;C=l.charCodeAt(0);for(c=0;16>c;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C>>=1}q--;0==q&&(q=Math.pow(2,u),u++);delete d[l]}else for(C=b[l],c=0;c<u;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C>>=1;q--;0==q&&(q=Math.pow(2,u),u++);b[g]=A++;l=String(a)}if(""!==l){if(Object.prototype.hasOwnProperty.call(d,l)){if(256>l.charCodeAt(0)){for(c=0;c<u;c++)w<<=1,y==p-1?(y=0,k.push(e(w)),w=0):y++;C=l.charCodeAt(0);for(c=
0;8>c;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C>>=1}else{C=1;for(c=0;c<u;c++)w=w<<1|C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C=0;C=l.charCodeAt(0);for(c=0;16>c;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C>>=1}q--;0==q&&(q=Math.pow(2,u),u++);delete d[l]}else for(C=b[l],c=0;c<u;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C>>=1;q--;0==q&&(q=Math.pow(2,u),u++)}C=2;for(c=0;c<u;c++)w=w<<1|1&C,y==p-1?(y=0,k.push(e(w)),w=0):y++,C>>=1;for(;;){if(w<<=1,y==p-1){k.push(e(w));break}y++}return k.join("")},
decompress:function(h){return null==h?"":""==h?null:m._decompress(h.length,32768,function(p){return h.charCodeAt(p)})},_decompress:function(h,p,e){var c,f,b=[],d=4,a=4,g=3;var l="";var q=[],A=e(0),u=p,k=1;for(c=0;3>c;c+=1)b[c]=c;l=0;var w=Math.pow(2,2);for(f=1;f!=w;){var y=A&u;u>>=1;0==u&&(u=p,A=e(k++));l|=(0<y?1:0)*f;f<<=1}switch(l){case 0:l=0;w=Math.pow(2,8);for(f=1;f!=w;)y=A&u,u>>=1,0==u&&(u=p,A=e(k++)),l|=(0<y?1:0)*f,f<<=1;var C=v(l);break;case 1:l=0;w=Math.pow(2,16);for(f=1;f!=w;)y=A&u,u>>=1,
0==u&&(u=p,A=e(k++)),l|=(0<y?1:0)*f,f<<=1;C=v(l);break;case 2:return""}c=b[3]=C;for(q.push(C);;){if(k>h)return"";l=0;w=Math.pow(2,g);for(f=1;f!=w;)y=A&u,u>>=1,0==u&&(u=p,A=e(k++)),l|=(0<y?1:0)*f,f<<=1;switch(C=l){case 0:l=0;w=Math.pow(2,8);for(f=1;f!=w;)y=A&u,u>>=1,0==u&&(u=p,A=e(k++)),l|=(0<y?1:0)*f,f<<=1;b[a++]=v(l);C=a-1;d--;break;case 1:l=0;w=Math.pow(2,16);for(f=1;f!=w;)y=A&u,u>>=1,0==u&&(u=p,A=e(k++)),l|=(0<y?1:0)*f,f<<=1;b[a++]=v(l);C=a-1;d--;break;case 2:return q.join("")}if(0==d&&(d=Math.pow(2,
g),g++),b[C])l=b[C];else{if(C!==a)return null;l=c+c.charAt(0)}q.push(l);b[a++]=c+l.charAt(0);d--;c=l;0==d&&(d=Math.pow(2,g),g++)}}};return m}();"undefined"!=typeof z&&null!=z&&(z.exports=r)},{}],11:[function(r,z,x){r=r("./events");z.exports=[r,function(){return{observe:function(n,v,t){n=this.watch(v,t);return t(this.get(v)),n},unobserve:function(n,v){this.unwatch(v)}}}]},{"./events":6}],12:[function(r,z,x){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(m){return typeof m}:
function(m){return m&&"function"==typeof Symbol&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m};x=r("../src/util");var v=x.slice,t=x.assign;r=r("./update");z.exports=[r,function(){function m(h,p){var e,c=p[1],f=v(p,2);return this.update(c,[],function(b){e=Array.prototype[h].apply(b,f)}),e}return{push:function(h,p,e,c,f,b){return m.call(this,"push",arguments)},pop:function(h,p){return m.call(this,"pop",arguments)},shift:function(h,p){return m.call(this,"shift",arguments)},unshift:function(h,
p,e,c,f,b){return m.call(this,"unshift",arguments)},assign:function(h,p,e,c,f,b){var d=v(arguments,2);return this.update(p,{},function(a){if("object"!=("undefined"==typeof a?"undefined":n(a)))throw Error('store.assign called for non-object value with key "'+p+'"');return d.unshift(a),t.apply(Object,d)})}}}]},{"../src/util":16,"./update":13}],13:[function(r,z,x){z.exports=function(){return{update:function(n,v,t,m){3==arguments.length&&(m=t,t=void 0);var h=this.get(v,t),p=m(h);this.set(v,void 0!=p?
p:h)}}}},{}],14:[function(r,z,x){function n(c,f){return void 0!==this.get(f)}function v(c,f,b,d){null==d&&(d=b,b=null);null==b&&(b={});c=this.get(f,b);d=d(c);this.set(f,void 0===d?c:d)}function t(c){return this.clearAll.call(this)}function m(c,f){return this.each.call(this,function(b,d){f(d,b)})}function h(c){return this.dump.call(this)}function p(c,f){return JSON.stringify(f)}function e(c,f){if("string"==typeof f)try{return JSON.parse(f)}catch(b){return f||void 0}}x=r("./dump");r=r("./json2");z.exports=
[x,r,function(){return this.disabled=!this.enabled,{has:n,transact:v,clear:t,forEach:m,getAll:h,serialize:p,deserialize:e}}]},{"./dump":5,"./json2":8}],15:[function(r,z,x){function n(){var a="undefined"==typeof console?null:console;a&&(a.warn?a.warn:a.log).apply(a,arguments)}function v(a,g,l){l||(l="");a&&!c(a)&&(a=[a]);g&&!c(g)&&(g=[g]);var q=l?"__storejs_"+l+"_":"",A=l?new RegExp("^"+q):null;if(!/^[a-zA-Z0-9_\-]*$/.test(l))throw Error("store.js namespaces can only have alphanumerics + underscores and dashes");
var u=e({_namespacePrefix:q,_namespaceRegexp:A,_testStorage:function(k){try{k.write("__storejs__test__","__storejs__test__");var w="__storejs__test__"===k.read("__storejs__test__");return k.remove("__storejs__test__"),w}catch(y){return!1}},_assignPluginFnProp:function(k,w){var y=this[w];this[w]=function(){var C=t(arguments,0),D=this,G=[function(){if(y)return h(arguments,function(H,L){C[L]=H}),y.apply(D,C)}].concat(C);return k.apply(D,G)}},_serialize:function(k){return JSON.stringify(k)},_deserialize:function(k,
w){if(!k)return w;var y="";try{y=JSON.parse(k)}catch(C){y=k}return void 0!==y?y:w},_addStorage:function(k){this.enabled||this._testStorage(k)&&(this.storage=k,this.enabled=!0)},_addPlugin:function(k){var w=this;if(c(k))return void h(k,function(C){w._addPlugin(C)});if(!m(this.plugins,function(C){return k===C})){if(this.plugins.push(k),!f(k))throw Error("Plugins must be function values that return objects");var y=k.call(this);if(!b(y))throw Error("Plugins must return an object of function properties");
h(y,function(C,D){if(!f(C))throw Error("Bad plugin property: "+D+" from plugin "+k.name+". Plugins should only return functions.");w._assignPluginFnProp(C,D)})}},addStorage:function(k){n("store.addStorage(storage) is deprecated. Use createStore([storages])");this._addStorage(k)}},d,{plugins:[]});return u.raw={},h(u,function(k,w){f(k)&&(u.raw[w]=p(u,k))}),h(a,function(k){u._addStorage(k)}),h(g,function(k){u._addPlugin(k)}),u}r=r("./util");var t=r.slice,m=r.pluck,h=r.each,p=r.bind,e=r.create,c=r.isList,
f=r.isFunction,b=r.isObject;z.exports={createStore:v};var d={version:"2.0.12",enabled:!1,get:function(a,g){a=this.storage.read(this._namespacePrefix+a);return this._deserialize(a,g)},set:function(a,g){return void 0===g?this.remove(a):(this.storage.write(this._namespacePrefix+a,this._serialize(g)),g)},remove:function(a){this.storage.remove(this._namespacePrefix+a)},each:function(a){var g=this;this.storage.each(function(l,q){a.call(g,g._deserialize(l),(q||"").replace(g._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},
hasNamespace:function(a){return this._namespacePrefix=="__storejs_"+a+"_"},createStore:function(){return v.apply(this,arguments)},addPlugin:function(a){this._addPlugin(a)},namespace:function(a){return v(this.storage,this.plugins,a)}}},{"./util":16}],16:[function(r,z,x){(function(n){function v(f,b){return Array.prototype.slice.call(f,b||0)}function t(f,b){m(f,function(d,a){return b(d,a),!1})}function m(f,b){if(h(f))for(var d=0;d<f.length;d++){if(b(f[d],d))return f[d]}else for(d in f)if(f.hasOwnProperty(d)&&
b(f[d],d))return f[d]}function h(f){return null!=f&&"function"!=typeof f&&"number"==typeof f.length}var p=function(){return Object.assign?Object.assign:function(f,b,d,a){for(var g=1;g<arguments.length;g++)t(Object(arguments[g]),function(l,q){f[q]=l});return f}}(),e=function(){if(Object.create)return function(b,d,a,g){var l=v(arguments,1);return p.apply(this,[Object.create(b)].concat(l))};var f=function(){};return function(b,d,a,g){var l=v(arguments,1);return f.prototype=b,p.apply(this,[new f].concat(l))}}(),
c=function(){return String.prototype.trim?function(f){return String.prototype.trim.call(f)}:function(f){return f.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}();z.exports={assign:p,create:e,trim:c,bind:function(f,b){return function(){return b.apply(f,Array.prototype.slice.call(arguments,0))}},slice:v,each:t,map:function(f,b){var d=h(f)?[]:{};return m(f,function(a,g){return d[g]=b(a,g),!1}),d},pluck:m,isList:h,isFunction:function(f){return f&&"[object Function]"==={}.toString.call(f)},isObject:function(f){return f&&
"[object Object]"==={}.toString.call(f)},Global:"undefined"!=typeof window?window:n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(r,z,x){z.exports=[r("./localStorage"),r("./oldFF-globalStorage"),r("./oldIE-userDataStorage"),r("./cookieStorage"),r("./sessionStorage"),r("./memoryStorage")]},{"./cookieStorage":18,"./localStorage":19,"./memoryStorage":20,"./oldFF-globalStorage":21,"./oldIE-userDataStorage":22,"./sessionStorage":23}],
18:[function(r,z,x){function n(p){for(var e=h.cookie.split(/; ?/g),c=e.length-1;0<=c;c--)if(m(e[c])){var f=e[c].split("\x3d"),b=unescape(f[0]);f=unescape(f[1]);p(f,b)}}function v(p){p&&t(p)&&(h.cookie=escape(p)+"\x3d; expires\x3dThu, 01 Jan 1970 00:00:00 GMT; path\x3d/")}function t(p){return(new RegExp("(?:^|;\\s*)"+escape(p).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d")).test(h.cookie)}r=r("../src/util");x=r.Global;var m=r.trim;z.exports={name:"cookieStorage",read:function(p){if(!p||!t(p))return null;
p="(?:^|.*;\\s*)"+escape(p).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d\\s*((?:[^;](?!;))*[^;]?).*";return unescape(h.cookie.replace(new RegExp(p),"$1"))},write:function(p,e){p&&(h.cookie=escape(p)+"\x3d"+escape(e)+"; expires\x3dTue, 19 Jan 2038 03:14:07 GMT; path\x3d/")},each:n,remove:v,clearAll:function(){n(function(p,e){v(e)})}};var h=x.document},{"../src/util":16}],19:[function(r,z,x){function n(t){return v.localStorage.getItem(t)}var v=r("../src/util").Global;z.exports={name:"localStorage",
read:n,write:function(t,m){return v.localStorage.setItem(t,m)},each:function(t){for(var m=v.localStorage.length-1;0<=m;m--){var h=v.localStorage.key(m);t(n(h),h)}},remove:function(t){return v.localStorage.removeItem(t)},clearAll:function(){return v.localStorage.clear()}}},{"../src/util":16}],20:[function(r,z,x){z.exports={name:"memoryStorage",read:function(v){return n[v]},write:function(v,t){n[v]=t},each:function(v){for(var t in n)n.hasOwnProperty(t)&&v(n[t],t)},remove:function(v){delete n[v]},clearAll:function(v){n=
{}}};var n={}},{}],21:[function(r,z,x){function n(t){for(var m=v.length-1;0<=m;m--){var h=v.key(m);t(v[h],h)}}r=r("../src/util").Global;z.exports={name:"oldFF-globalStorage",read:function(t){return v[t]},write:function(t,m){v[t]=m},each:n,remove:function(t){return v.removeItem(t)},clearAll:function(){n(function(t,m){delete v[t]})}};var v=r.globalStorage},{"../src/util":16}],22:[function(r,z,x){function n(e){return e.replace(/^\d/,"___$\x26").replace(p,"___")}r=r("../src/util").Global;z.exports={name:"oldIE-userDataStorage",
write:function(e,c){if(!h){var f=n(e);m(function(b){b.setAttribute(f,c);b.save(v)})}},read:function(e){if(!h){var c=n(e),f=null;return m(function(b){f=b.getAttribute(c)}),f}},each:function(e){m(function(c){for(var f=c.XMLDocument.documentElement.attributes,b=f.length-1;0<=b;b--){var d=f[b];e(c.getAttribute(d.name),d.name)}})},remove:function(e){var c=n(e);m(function(f){f.removeAttribute(c);f.save(v)})},clearAll:function(){m(function(e){var c=e.XMLDocument.documentElement.attributes;e.load(v);for(var f=
c.length-1;0<=f;f--)e.removeAttribute(c[f].name);e.save(v)})}};var v="storejs",t=r.document,m=function(){if(!t||!t.documentElement||!t.documentElement.addBehavior)return null;try{var e=new ActiveXObject("htmlfile");e.open();e.write('\x3cscript\x3edocument.w\x3dwindow\x3c/script\x3e\x3ciframe src\x3d"/favicon.ico"\x3e\x3c/iframe\x3e');e.close();var c=e.w.frames[0].document;var f=c.createElement("div")}catch(b){f=t.createElement("div"),c=t.body}return function(b){var d=[].slice.call(arguments,0);d.unshift(f);
c.appendChild(f);f.addBehavior("#default#userData");f.load(v);b.apply(this,d);c.removeChild(f)}}(),h=(r.navigator?r.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),p=/[!"#$%&'()*+,/\\:;<=>?@[\]^`{|}~]/g},{"../src/util":16}],23:[function(r,z,x){function n(t){return v.sessionStorage.getItem(t)}var v=r("../src/util").Global;z.exports={name:"sessionStorage",read:n,write:function(t,m){return v.sessionStorage.setItem(t,m)},each:function(t){for(var m=v.sessionStorage.length-1;0<=m;m--){var h=
v.sessionStorage.key(m);t(n(h),h)}},remove:function(t){return v.sessionStorage.removeItem(t)},clearAll:function(){return v.sessionStorage.clear()}}},{"../src/util":16}]},{},[1])(1)})},"libs/md5/md5":function(){(function(F){function r(b,d){var a=(b&65535)+(d&65535);return(b>>16)+(d>>16)+(a>>16)<<16|a&65535}function z(b,d,a,g,l,q){b=r(r(d,b),r(g,q));return r(b<<l|b>>>32-l,a)}function x(b,d,a,g,l,q,A){return z(d&a|~d&g,b,d,l,q,A)}function n(b,d,a,g,l,q,A){return z(d&g|a&~g,b,d,l,q,A)}function v(b,d,
a,g,l,q,A){return z(a^(d|~g),b,d,l,q,A)}function t(b,d){b[d>>5]|=128<<d%32;b[(d+64>>>9<<4)+14]=d;var a=1732584193,g=-271733879,l=-1732584194,q=271733878;for(d=0;d<b.length;d+=16){var A=a;var u=g;var k=l;var w=q;a=x(a,g,l,q,b[d],7,-680876936);q=x(q,a,g,l,b[d+1],12,-389564586);l=x(l,q,a,g,b[d+2],17,606105819);g=x(g,l,q,a,b[d+3],22,-1044525330);a=x(a,g,l,q,b[d+4],7,-176418897);q=x(q,a,g,l,b[d+5],12,1200080426);l=x(l,q,a,g,b[d+6],17,-1473231341);g=x(g,l,q,a,b[d+7],22,-45705983);a=x(a,g,l,q,b[d+8],7,1770035416);
q=x(q,a,g,l,b[d+9],12,-1958414417);l=x(l,q,a,g,b[d+10],17,-42063);g=x(g,l,q,a,b[d+11],22,-1990404162);a=x(a,g,l,q,b[d+12],7,1804603682);q=x(q,a,g,l,b[d+13],12,-40341101);l=x(l,q,a,g,b[d+14],17,-1502002290);g=x(g,l,q,a,b[d+15],22,1236535329);a=n(a,g,l,q,b[d+1],5,-165796510);q=n(q,a,g,l,b[d+6],9,-1069501632);l=n(l,q,a,g,b[d+11],14,643717713);g=n(g,l,q,a,b[d],20,-373897302);a=n(a,g,l,q,b[d+5],5,-701558691);q=n(q,a,g,l,b[d+10],9,38016083);l=n(l,q,a,g,b[d+15],14,-660478335);g=n(g,l,q,a,b[d+4],20,-405537848);
a=n(a,g,l,q,b[d+9],5,568446438);q=n(q,a,g,l,b[d+14],9,-1019803690);l=n(l,q,a,g,b[d+3],14,-187363961);g=n(g,l,q,a,b[d+8],20,1163531501);a=n(a,g,l,q,b[d+13],5,-1444681467);q=n(q,a,g,l,b[d+2],9,-51403784);l=n(l,q,a,g,b[d+7],14,1735328473);g=n(g,l,q,a,b[d+12],20,-1926607734);a=z(g^l^q,a,g,b[d+5],4,-378558);q=z(a^g^l,q,a,b[d+8],11,-2022574463);l=z(q^a^g,l,q,b[d+11],16,1839030562);g=z(l^q^a,g,l,b[d+14],23,-35309556);a=z(g^l^q,a,g,b[d+1],4,-1530992060);q=z(a^g^l,q,a,b[d+4],11,1272893353);l=z(q^a^g,l,q,b[d+
7],16,-155497632);g=z(l^q^a,g,l,b[d+10],23,-1094730640);a=z(g^l^q,a,g,b[d+13],4,681279174);q=z(a^g^l,q,a,b[d],11,-358537222);l=z(q^a^g,l,q,b[d+3],16,-722521979);g=z(l^q^a,g,l,b[d+6],23,76029189);a=z(g^l^q,a,g,b[d+9],4,-640364487);q=z(a^g^l,q,a,b[d+12],11,-421815835);l=z(q^a^g,l,q,b[d+15],16,530742520);g=z(l^q^a,g,l,b[d+2],23,-995338651);a=v(a,g,l,q,b[d],6,-198630844);q=v(q,a,g,l,b[d+7],10,1126891415);l=v(l,q,a,g,b[d+14],15,-1416354905);g=v(g,l,q,a,b[d+5],21,-57434055);a=v(a,g,l,q,b[d+12],6,1700485571);
q=v(q,a,g,l,b[d+3],10,-1894986606);l=v(l,q,a,g,b[d+10],15,-1051523);g=v(g,l,q,a,b[d+1],21,-2054922799);a=v(a,g,l,q,b[d+8],6,1873313359);q=v(q,a,g,l,b[d+15],10,-30611744);l=v(l,q,a,g,b[d+6],15,-1560198380);g=v(g,l,q,a,b[d+13],21,1309151649);a=v(a,g,l,q,b[d+4],6,-145523070);q=v(q,a,g,l,b[d+11],10,-1120210379);l=v(l,q,a,g,b[d+2],15,718787259);g=v(g,l,q,a,b[d+9],21,-343485551);a=r(a,A);g=r(g,u);l=r(l,k);q=r(q,w)}return[a,g,l,q]}function m(b){var d,a="";for(d=0;d<32*b.length;d+=8)a+=String.fromCharCode(b[d>>
5]>>>d%32&255);return a}function h(b){var d,a=[];a[(b.length>>2)-1]=void 0;for(d=0;d<a.length;d+=1)a[d]=0;for(d=0;d<8*b.length;d+=8)a[d>>5]|=(b.charCodeAt(d/8)&255)<<d%32;return a}function p(b){return m(t(h(b),8*b.length))}function e(b,d){var a=h(b),g=[],l=[];g[15]=l[15]=void 0;16<a.length&&(a=t(a,8*b.length));for(b=0;16>b;b+=1)g[b]=a[b]^909522486,l[b]=a[b]^1549556828;d=t(g.concat(h(d)),512+8*d.length);return m(t(l.concat(d),640))}function c(b){var d="",a;for(a=0;a<b.length;a+=1){var g=b.charCodeAt(a);
d+="0123456789abcdef".charAt(g>>>4&15)+"0123456789abcdef".charAt(g&15)}return d}function f(b,d,a){d?a?b=e(unescape(encodeURIComponent(d)),unescape(encodeURIComponent(b))):(b=e(unescape(encodeURIComponent(d)),unescape(encodeURIComponent(b))),b=c(b)):b=a?p(unescape(encodeURIComponent(b))):c(p(unescape(encodeURIComponent(b))));return b}"function"===typeof define&&define.amd?define(function(){return f}):F.md5=f})(this)},"jimu/dijit/AGOLLoading":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AGOLLoading.html dojo/_base/html ../utils".split(" "),
function(F,r,z,x,n,v){return F([r,z],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:x,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&n.setStyle(this.domNode,"display","none");n.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||n.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=
v.sanitizeHTML(this.loadingText))},show:function(t){this.domNode&&this.hidden&&("string"===typeof t&&(this.textNode.innerHTML=t),n.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(n.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f){var b=null;var d=F([x],{constructor:function(a,g){this.own(n.subscribe("appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)));this.own(n.subscribe("appConfigChanged",r.hitch(this,this._onAppConfigChanged)));this.own(n.subscribe("mapLoaded",r.hitch(this,this._onMapLoaded)));this.own(n.subscribe("mapChanged",r.hitch(this,this._onMapChanged)));this.own(n.subscribe("beforeMapDestory",r.hitch(this,this._onBeforeMapDestory)));this.own(n.subscribe("preloadModulesLoaded",
r.hitch(this,this._onPreloadModulesLoaded)));this.own(n.subscribe("openWidget",r.hitch(this,this._onOpenWidgetRequest)));this.own(n.subscribe("builder/actionTriggered",r.hitch(this,this._onActionTriggered)));f.isMobileUa()||this.own(v(window,"resize",p(r.hitch(this,this.resize),200)));this.id=g;this.preloadModulesLoadDef=new m},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=r.clone(a);this.preloadModulesLoadDef.then(r.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(r.hitch(this,function(g){this.layoutManager=g;this.layoutManager.onEnter(this.appConfig,this.mapId).then(r.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadingAnim();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:
"jimu/layoutManagers/AbsolutePositionLayoutManager";var g=new m;e([a],r.hitch(this,function(l){l=l.getInstance();this.map&&l.setMap(this.map);g.resolve(l)}));return g},_loadingAnim:function(){window.isXT&&"config"===this.appConfig.mode||(z.addClass(jimuConfig.loadingId,"loading-fadeOut"),this.own(v(document.getElementById(jimuConfig.loadingId),"animationend",r.hitch(this,function(){z.setStyle(jimuConfig.loadingId,"display","none")}))))},_loadMap:function(a){this.mapManager=c.getInstance({appConfig:this.appConfig,
urlParams:this.urlParams},a);this.mapManager.showMap();this._lazyLoadResources()},_lazyLoadResources:function(){jimuConfig.lazyLoadCss&&e(jimuConfig.lazyLoadCss);e(["dynamic-modules/commonResources"])},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var g=new m;e(["themes/"+a.name+"/main"],r.hitch(this,function(){h([this._loadThemeCommonStyle(a),
this._loadThemeCurrentStyle(a)]).then(r.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();g.resolve()}))}));return g},_loadThemeCommonStyle:function(a){z.addClass(this.domNode,a.name);return f.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){z.addClass(this.domNode,a.styles[0]);return f.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var g=
r.getObject("customStyles",!1,a);if(g){var l=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(l+=a);l=r.replace(l,g,/\$\{([^\}]+)\}/g);g=z.create("style",{type:"text/css"});try{g.appendChild(document.createTextNode(l))}catch(q){g.styleSheet.cssText=l}g.setAttribute("source","custom");document.head.appendChild(g)}},_getFixedThemeStyles:function(a){var g=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";if(a.customStyles.mainBackgroundColor&&
f.isLightColor(a.customStyles.mainBackgroundColor)){var l=e.toUrl("jimu")+"/css/images/api_popup_light.png";g+=".esriPopup .titleButton {background: url("+l+") no-repeat}.esriPopup .titlePane {color: black}"}"PlateauTheme"===a.name?g+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important} .popup-links .title, .popup-links a, .popup-links, .popup-links .line { color: ${mainBackgroundColor} ; border-color: ${mainBackgroundColor};}":
"BillboardTheme"===a.name?g+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .jimu-widget-mylocation .place-holder.nohttps:hover, .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover, .jimu-widget-onscreen-icon:hover, .jimu-widget-onscreen-icon.jimu-state-selected{opacity: 1;}":
"BoxTheme"===a.name?g+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-main-background.jimu-widget-zoomslider{background-color: transparent !important}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-zoomslider .zoom:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover{background-color: ${mainBackgroundColor} !important; opacity: 1;}":
"TabTheme"===a.name?g+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name?g+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{color: ${mainBackgroundColor} !important; opacity: 0.6;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation:hover{color: ${mainBackgroundColor} !important; opacity: 1;}":
"PocketTheme"===a.name&&(g+=".jimu-main-background, .jimu-widget-homebutton, .jimu-widget-mylocation, .jimu-widget-onscreen-icon, .jimu-widget-onscreen-icon.jimu-state-selected, .jimu-widget-zoomslider .zoom, .jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .esriPopup .titlePane, .esriPopupMobile .titlePane, .esriPopup .pointer.top{background-color: ${mainBackgroundColor} !important;}.esriMobileNavigationBar{background-color: ${mainBackgroundColor} !important; background-image: none !important;}");
return g},_onAppConfigChanged:function(a,g,l){a=r.clone(a);switch(g){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,l);break;case "groupChange":this._onGroupChange(a,l);break;case "widgetPoolChange":this._onWidgetPoolChange(a,l);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,l);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,
l);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,l);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,l)}this.appConfig=a},_onMapChanged:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);
this._removeCustomStyle();h([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(r.hitch(this,function(g){var l=g[0];this.layoutManager.name!==l.name?(this.layoutManager.onLeave(),l.onEnter(a,this.mapId).then(r.hitch(this,function(){this.layoutManager=l;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var g=this.appConfig;n.publish("appConfigChanged",a,"mapChange",a);this.appConfig=g;this._loadLayoutManager(a).then(r.hitch(this,function(l){this.layoutManager=
l;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,g){"backgroundColor"in g?z.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in g?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(z.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),z.setStyle(jimuConfig.loadingImageId,"width",
a.width+"px"),z.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(z.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),z.setStyle(jimuConfig.loadingImageId,"width","0px"),z.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in g&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(z.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),z.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),z.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):
(z.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),z.setStyle(jimuConfig.loadingGifId,"width","0px"),z.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_onWidgetChange:function(a,g){this.layoutManager.onWidgetChange(a,g)},_onGroupChange:function(a,
g){this.layoutManager.onGroupChange(a,g)},_onWidgetPoolChange:function(a,g){this.layoutManager.onWidgetPoolChange(a,g)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onLayoutDefinitionChange:function(a,g){this.layoutManager.onLayoutDefinitionChange(a,g)},_onOnScreenGroupsChange:function(a,g){this.layoutManager.onOnScreenGroupsChange(a,g)},_onOnScreenOrderChange:function(a,g){this.layoutManager.onOnScreenOrderChange(a,g)},_removeThemeCommonStyle:function(a){z.removeClass(this.domNode,
a.name);z.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){z.removeClass(this.domNode,a.styles[0]);z.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){t('style[source\x3d"custom"]',document.head).forEach(function(a){z.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});
d.getInstance=function(a,g){null===b&&(b=new d(a,g),window._layoutManager=b);return b};return d})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point esri/layers/FeatureLayer require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C,D,G,H){var L=null,T=F(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(K,O){this.appConfig=K.appConfig;this.urlParams=K.urlParams;this.id=this.mapDivId=O;this.appStateManager=D.getInstance(this.urlParams);this.popupManager=G.getInstance(this);this.filterManager=H.getInstance();this.nls=window.jimuNls;v.subscribe("appConfigChanged",r.hitch(this,
this.onAppConfigChanged));v.subscribe("syncExtent",r.hitch(this,this.onSyncExtent));v.subscribe("mapContentModified",r.hitch(this,this.onMapContentModified));t(window,"resize",r.hitch(this,this.onWindowResize));t(window,"unload",r.hitch(this,this.onUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(K){console.time("Load Map");K.map["3D"]?K.map.itemId?this._show3DWebScene(K):this._show3DLayersMap(K):K.map.itemId?this._show2DWebMap(K):console.log("No webmap found. Please set map.itemId in config.json.")},
onUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(K){K&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),n("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(O){x.destroy(O)}),
n("div.esriMobileNavigationBar").forEach(function(O){x.destroy(O)})),this._mapMobileInfoWindow=new f(null,x.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);u.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!u.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(K){this.map&&
(K=new g(K.extent),this.map.setExtent(K))},_visitConfigMapLayers:function(K,O){z.forEach(K.map.basemaps,function(I,P){I.isOperationalLayer=!1;O(I,P)},this);z.forEach(K.map.operationallayers,function(I,P){I.isOperationalLayer=!0;O(I,P)},this)},_show3DLayersMap:function(K){A(["esri3d/Map"],r.hitch(this,function(O){var I=new O(this.mapDivId,{camera:K.map.mapOptions.camera});this._visitConfigMapLayers(K,r.hitch(this,function(P){this.createLayer(I,"3D",P)}));I.usePlugin=O.usePlugin;this._publishMapEvent(I)}))},
_show3DWebScene:function(K){this._getWebsceneData(K.map.itemId).then(r.hitch(this,function(O){A(["esri3d/Map"],r.hitch(this,function(I){var P=new I(this.mapDivId,K.map.mapOptions);z.forEach(O.itemData.operationalLayers,function(Q){this.createLayer(P,"3D",Q)},this);z.forEach(O.itemData.baseMap.baseMapLayers,function(Q){Q.type="tile";this.createLayer(P,"3D",Q)},this);z.forEach(O.itemData.baseMap.elevationLayers,function(Q){Q.type="elevation";this.createLayer(P,"3D",Q)},this);P.toc=O.itemData.toc;P.bookmarks=
O.itemData.bookmarks;P.tours=O.itemData.tours}))}))},_publishMapEvent:function(K){window._viewerMap=K;C.postProcessUrlParams(this.urlParams,K);console.timeEnd("Load Map");this.map?(this.map=K,this.resetInfoWindow(!0),console.log("map changed."),v.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=K,this.resetInfoWindow(!0),v.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(K){return d({url:"http://184.169.133.166/sharing/rest/content/items/"+K+"/data",handleAs:"json"})},
_show2DWebMap:function(K){this._increasePointCount(K);K.map.mapOptions||(K.map.mapOptions={});var O=this._processMapOptions(K.map.mapOptions)||{};O.slider=!1;var I=K.map.portalUrl,P=K.map.itemId;O={mapOptions:O,bingMapsKey:K.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!K.mode&&K.map.appProxy&&K.map.appProxy.mapItemId===K.map.itemId){var Q=[];z.forEach(K.map.appProxy.proxyItems,function(U){U.useProxy&&U.proxyUrl&&Q.push({url:U.sourceUrl,mixin:{url:U.proxyUrl}})});0<Q.length&&(O.layerMixins=
Q)}this._createWebMapRaw(I,P,this.mapDivId,O).then(r.hitch(this,function(U){var Y=U.map;Y.hideZoomSlider();Y.infoWindow.resize(270,316);Y.itemId=K.map.itemId;Y.itemInfo=U.itemInfo;Y.webMapResponse=U;Y.enableSnapping({snapKey:h.copyKey});x.setStyle(Y.root,"zIndex",0);Y._initialExtent=Y.extent;this.layerInfosObj=k.getInstanceSyncForInit(Y,Y.itemInfo);this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(ca){ca.getLayerObject().then(r.hitch(this,function(da){da&&r.setObject("_wabProperties.originalRefreshinterval",
da.refreshInterval,da)}),r.hitch(this,function(da){console.error("can't get layerObject",da)}))},this);K.map.mapRefreshInterval&&!K.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(K.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(Y);setTimeout(r.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(Y);this._hideError()}),r.hitch(this,function(U){console.error(U);this._showError(U);v.publish("mapCreatedFailed")}))},
_increasePointCount:function(K){if("1"!==window.queryObject.disableLargePointCountForTimeSlider&&"true"!==window.queryObject.disableLargePointCountForTimeSlider){var O=!1;u.visitElement(K,function(I){"widgets/TimeSlider/Widget"===I.uri&&(O=!0)});O&&(q.prototype.maxPointCountForAuto=35E3)}},_handleRefreshLayer:function(K){var O=K._mode._drawFeatures,I=K._mode._clearIIf,P=null;K._mode._drawFeatures=function(Q,U){U&&"number"===typeof U.row&&"number"===typeof U.col&&K._mode._removeCell(U.row,U.col);O.apply(K._mode,
arguments)};m.before(K,"refresh",function(){P=K._mode._cellMap;K._mode._clearIIf=function(){}});m.after(K,"refresh",function(){K._mode._cellMap=P;K._mode._clearIIf=I});t(K,"update-start",function(){K.isUpdating=!0});t(K,"update-end",function(){K.isUpdating=!1})},_showError:function(K){K&&K.message&&x.create("div",{"class":"app-error load-map-error",innerHTML:K.message},document.body)},_hideError:function(){n("div.load-map-error",document.body).forEach(function(K){document.body.removeChild(K)})},_createWebMapRaw:function(K,
O,I,P){return u.createWebMap(K,O,I,P).then(r.hitch(this,function(Q){return Q}),r.hitch(this,function(Q){console.error(Q);if(Q&&Q instanceof Error&&Q.message){var U=r.getObject("arcgis.utils.baseLayerError",!1,p.cache["esri/nls/jsapi/"+e.locale]);if(U&&0<=Q.message.indexOf(U))return new w({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),a.getItem(O).then(r.hitch(this,function(Y){Y.itemData.spatialReference={wkid:102100,latestWkid:3857};Y.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return u.createWebMap(K,Y,I,P)}))}throw Q;}))},_showUnreachableLayersTitleMessage:function(){var K=this.layerInfosObj.getUnreachableLayersTitle(),O="",I=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";I&&K&&0<K.length&&(z.forEach(K,r.hitch(this,function(P){O=O+P+", "})),new w({message:I.replace("${layers}",O)}))},_addDataLoadingOnMapUpdate:function(K){var O=
x.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');x.place(O,K.root);K.updating&&x.addClass(O,"loading");t(K,"update-start",r.hitch(this,function(){x.addClass(O,"loading")}));t(K,"update-end",r.hitch(this,function(){x.removeClass(O,"loading")}));t(K,"unload",r.hitch(this,function(){x.destroy(O);O=null}))},_checkAppState:function(){var K="extent center marker find query scale level".split(" "),O=this.appConfig.keepAppState;O&&z.forEach(K,function(I){I in this.urlParams&&(O=!1)},this);
O&&this.appStateManager.getWabAppState().then(r.hitch(this,function(I){if(I.extent||I.layers){var P=new y({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});P.placeAt("main-page");t(P,"applyAppState",r.hitch(this,function(){this._applyAppState(I,this.map)}));P.startup();P.show()}}))},_applyAppState:function(K,O){this.layerInfosObj.restoreState({layerOptions:K.layers||null});K.extent&&O.setExtent(K.extent)},_processMapOptions:function(K){if(K)return K.lods||delete K.lods,
K.lods&&0===K.lods.length&&delete K.lods,K=r.clone(K),K.extent&&(K.extent=new g(K.extent)),K.center&&!r.isArrayLike(K.center)&&(K.center=new l(K.center)),K.infoWindow&&(K.infoWindow=new c(K.infoWindow,x.create("div",{},this.mapDivId))),K},createLayer:function(K,O,I){A([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer",
"2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[O+"_"+I.type]],r.hitch(this,function(P){var Q={};var U="label url type icon infoTemplate isOperationalLayer".split(" ");
for(var Y in I)0>U.indexOf(Y)&&(Q[Y]=I[Y]);I.infoTemplate?(U=new b(I.infoTemplate.title,I.infoTemplate.content),Q.infoTemplate=U,P=new P(I.url,Q),I.infoTemplate.width&&I.infoTemplate.height&&m.after(P,"onClick",r.hitch(this,function(){K.infoWindow.resize(I.infoTemplate.width,I.infoTemplate.height)}),!0)):P=new P(I.url,Q);P.isOperationalLayer=I.isOperationalLayer;P.label=I.label;P.icon=I.icon;K.addLayer(P)}))},onAppConfigChanged:function(K,O,I){this.appConfig=K;"mapChange"===O?this._recreateMap(K):
"mapOptionsChange"===O?I.lods&&this._recreateMap(K):"mapRefreshIntervalChange"===O&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(I)},onMapContentModified:function(){this._recreateMap(this.appConfig)},_updateRefreshInterval:function(K){var O=-1;O=K.useWebMapRefreshInterval?-1:K.minutes;this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(I){I.getLayerObject().then(r.hitch(this,function(P){if(P){var Q=r.getObject("_wabProperties.originalRefreshinterval",
!1,P);0<Q&&"function"===typeof P.setRefreshInterval&&(0>O?P.setRefreshInterval(Q):P.setRefreshInterval(O))}}),r.hitch(this,function(P){console.error("can't get layerObject",P)}))},this)},_recreateMap:function(K){this.map&&(v.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(K)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});T.getInstance=function(K,O){null===L&&(L=new T(K,O));return L};return T})},
"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q){var A=F([l,c,f,b,g],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:q,
anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(u){this.inherited(arguments);p.place(this.domNode,u.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[A.ANCHOR_UPPERRIGHT,A.ANCHOR_LOWERRIGHT,A.ANCHOR_LOWERLEFT,A.ANCHOR_UPPERLEFT];if(7>v("ie")){var u="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
e.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",k=p.create("div",null,x.body());e.set(k,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:u});var w=setTimeout(function(){p.destroy(k);clearTimeout(w);w=k=null},100);n.query(".sprite",this.domNode).forEach(function(y){y.style.backgroundImage="none";y.style.filter=u})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(u,k){if(u&&k){var w=e.set;w(this._topleft,{height:k+"px",marginLeft:u+"px"});w(this._topright,{width:u+"px",height:k+"px"});w(this._user,"width",u-8+"px");w(this._hide,"marginLeft",u-22+"px");w(this._title,"width",u-25+"px");w(this._content,"height",k-37+"px");w(this._bottomleft,{marginLeft:u+"px",marginTop:k+"px"});w(this._bottomright,{width:u-
5+"px",marginTop:k+"px"});this.width=u;this.height=k;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(u,k)}},_adjustPosition:function(u,k){var w=e.set;w(this._infowindow,{left:Math.round(u.x)+"px",top:Math.round(u.y)+"px"});k===A.ANCHOR_UPPERLEFT?w(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):k===A.ANCHOR_UPPERRIGHT?w(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):k===A.ANCHOR_LOWERRIGHT?w(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):k===A.ANCHOR_LOWERLEFT&&w(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(u){var k=this.map;return k&&u?(u.y<k.height/2?"lower":"upper")+(u.x<k.width/2?"right":"left"):"upperright"},show:function(u,k,w){if(u){u.spatialReference?(this.mapCoords=u,u=this.coords=this.map.toScreen(u,!0)):(this.mapCoords=null,this.coords=u);var y=this.map._getFrameWidth();if(-1!==y&&(u.x%=y,0>u.x&&(u.x+=y),this.map.width>y))for(var C=(this.map.width-
y)/2;u.x<C;)u.x+=y;k&&-1!==z.indexOf(this._ANCHORS,k)||(k=this._getAnchor(u));h.remove(this._pointer,this.anchor);k=this.anchor=this.fixedAnchor||k;this._adjustPosition(u,k);h.add(this._pointer,k);a.show(this.domNode);this.isShowing=!0;if(!w)this.onShow()}},hide:function(u,k){a.hide(this.domNode);this.isShowing=!1;if(!k)this.onHide()},showTitleBar:function(){a.show(this._titlebar);a.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){a.hide(this._titlebar);a.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){a.show(this._content);a.show(this._border);this.isContentShowing=!0},hideContent:function(){a.hide(this._content);a.hide(this._border);this.isContentShowing=!1},move:function(u,k){k?u=this.coords.offset(u.x,u.y):(this.coords=u,this.mapCoords&&(this.mapCoords=this.map.toMap(u)));e.set(this._infowindow,{left:Math.round(u.x)+"px",top:Math.round(u.y)+"px"})},setFixedAnchor:function(u){u&&-1===z.indexOf(this._ANCHORS,u)||(this.fixedAnchor=u,this.isShowing&&this.show(this.mapCoords||
this.coords,u),this.onAnchorChange(u))},setTitle:function(u){this.destroyDijits(this._title);this.__setValue("_title",u);return this},setContent:function(u){this.destroyDijits(this._content);this.__setValue("_content",u);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});r.mixin(A,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});v("extend-esri")&&r.setObject("dijit.InfoWindow",A,d);return A})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k){F=r([a,g],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:F.toUrl("./images/whitex.png"),dArrowIcon:F.toUrl("./images/whitedown.png"),lArrowIcon:F.toUrl("./images/whitel.png"),rArrowIcon:F.toUrl("./images/whiter.png"),constructor:function(w,y){this.initialize();z.mixin(this,w);this.domNode=p.byId(y);this._nls=z.mixin({},
k.widgets.popup);w=this.domNode;c.add(w,"esriPopupMobile");e.set(w,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
y=t.query(".titlePane",w)[0];this._arrowButton=t.query(".arrow",y)[0];this._pointerTop=t.query(".top",w)[0];this._pointerBottom=t.query(".bottom",w)[0];this._title=t.query(".title",y)[0];this._footer=t.query(".footer",y)[0];this._prev=t.query(".prev",y)[0];this._next=t.query(".next",y)[0];this._spinner=t.query(".spinner",y)[0];this._eventConnections=[x.connect(t.query(".close",y)[0],"onclick",this,this.hide),x.connect(this._arrowButton,"onclick",this,this._toggleView),x.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),x.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();u.hide(w);this.isShowing=!1},setMap:function(w){this.inherited(arguments);f.place(this.domNode,w.root);this.highlight&&this.enableHighlight(w)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(w,y){this.destroyDijits(this._title);this.place(w,this._title);
this.destroyDijits(this._footer);this.place(y,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(w){this.destroyDijits(this._contentPane);this.place(w,this._contentPane);this.startupDijits(this._contentPane)},show:function(w){if(w){var y=this.map;w.spatialReference?(this.location=w,w=y.toScreen(w)):this.location=y.toMap(w);this._maximized?this.restore():this._setPosition(w);this.isShowing||(u.show(this.domNode),this.isShowing=!0,this.onShow())}else u.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(u.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);n.forEach(this._eventConnections,x.disconnect);f.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");c.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var w=this.selectedIndex;this._updateUI();0<=w&&(this.setContent(this.features[w].getContent()),this.updateHighlight(this.map,this.features[w]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var w=this.map;this._handles=[x.connect(w,"onPanStart",this,this._onPanStart),x.connect(w,"onPan",this,this._onPan),x.connect(w,"onZoomStart",this,this._onZoomStart),x.connect(w,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var w=this._handles;w&&(n.forEach(w,x.disconnect),this._handles=null)},_onPanStart:function(){var w=this.domNode.style;this._panOrigin={left:w.left,top:w.top,right:w.right,
bottom:w.bottom}},_onPan:function(w,y){var C=this._panOrigin;w=y.x;y=y.y;var D=C.left,G=C.top,H=C.right;C=C.bottom;D&&(D=parseFloat(D)+w+"px");G&&(G=parseFloat(G)+y+"px");H&&(H=parseFloat(H)-w+"px");C&&(C=parseFloat(C)-y+"px");d.set(this.domNode,{left:D,top:G,right:H,bottom:C})},_onZoomStart:function(){u.hide(this.domNode)},_onExtentChange:function(w,y,C){C&&(u.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(w){var y=w.x;w=w.y;var C=
b.getContentBox(this.map.container),D=C.w;C=C.h;var G=0,H=w+10,L=118,T=D-18;18<y&&y<T?(G=y-130,0>G?G=0:G>D-260&&(G=D-260)):18>=y?G=y-18:y>=T&&(G=D-260+(y-T));118<y&&y<D-130?L=118:118>=y?18<y?L=y-12:18>=y&&(L=6):y>=D-130&&(y<T?L=118+y-(D-130):y>=T&&(L=118+T-(D-130)));w<=C/2?(d.set(this.domNode,{left:G+"px",top:H+"px",bottom:null}),d.set(this._pointerTop,{left:L+"px"}),c.add(this._pointerBottom,"hidden"),c.remove(this._pointerTop,"hidden")):(d.set(this.domNode,{left:G+"px",top:H-64+"px",bottom:null}),
d.set(this._pointerBottom,{left:L+"px"}),c.add(this._pointerTop,"hidden"),c.remove(this._pointerBottom,"hidden"))},_showPointer:function(w){n.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(y){y===w?t.query(".pointer."+y,this.domNode).removeClass("hidden"):t.query(".pointer."+y,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();u.show(this.popupNavigationBar.container);
u.show(this.popupInfoView.container);0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(w){this.popupInfoView.animateTo(0);switch(w.name){case "CloseButton":u.hide(this.popupNavigationBar.container);u.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":u.hide(this.popupNavigationBar.container);u.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();
break;case "NextButton":this.selectNext(),this._updateUI()}},_initPopupNavigationBar:function(){var w={};w.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",
src:this.rArrowIcon,srcAlt:this.rArrowIcon,position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new q(w,f.create("div",{},v.body()));x.connect(this.popupNavigationBar,"onCreate",this,function(y){this._prevFeatureButton=y[3]._node;this._nextFeatureButton=y[4]._node});x.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);x.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();u.hide(this.popupNavigationBar.container)},
_initPopupInfoView:function(){this.popupInfoView=new l({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},f.create("div",{},v.body()));c.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();x.connect(this.popupInfoView,"onCreate",this,function(w){this._contentPane=w[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});x.connect(this.popupInfoView,
"onSwipeLeft",this,function(){});x.connect(this.popupInfoView,"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var w="\x26nbsp;",y="\x26nbsp;",C=this.selectedIndex,D=this.features,G=this.deferreds,H=this._prevFeatureButton.parentNode,L=this._nextFeatureButton.parentNode,T=this._spinner,K=this._nls;D&&1<=D.length?(w=D[C].getTitle(),y=C+1+" of "+D.length,c.remove(this._arrowButton,"hidden"),0===C?(c.add(H,"hidden"),c.add(this._prev,"hidden")):(c.remove(H,"hidden"),
c.remove(this._prev,"hidden")),C===D.length-1?(c.add(L,"hidden"),c.add(this._next,"hidden")):(c.remove(L,"hidden"),c.remove(this._next,"hidden"))):(c.add(this._arrowButton,"hidden"),c.add(H,"hidden"),c.add(L,"hidden"),c.add(this._prev,"hidden"),c.add(this._next,"hidden"));this.setTitle(w,y);this.popupNavigationBar.getItems()[1]._node.innerHTML=y;G&&G.length?(c.remove(T,"hidden"),this.setTitle(K.NLS_searching+"...","\x26nbsp;")):(c.add(T,"hidden"),D&&D.length||this.setTitle("No Information","\x26nbsp;"))}});
m("extend-esri")&&z.setObject("dijit.PopupMobile",F,A);return F})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f){F=F(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(b,d){this.container=m.byId(d);this._touchBase=
f(this.container,null);this._slideDiv=p.create("div",null,this.container,"first");this.events=[];this._items=b.items;b.sections&&(this._sections=b.sections);h.add(this.container,"esriMobileInfoView");if(0===this._sections.length)p.create("div",{},this._slideDiv);else for(b=0;b<this._sections.length;b++)d=p.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv),p.create("div",{innerHTML:this._sections[b].title},d);for(b=0;b<this._items.length;b++){d=0;this._items[b].section&&(d=this._items[b].section);
switch(this._items[b].type){case "div":var a=p.create("div",{"class":"esriMobileInfoViewItem",style:this._items[b].style},this._slideDiv.childNodes[d]);a=p.create("div",{innerHTML:this._items[b].text},a)}this._items[b].className&&h.add(a,this._items[b].className);a._index=b;a._item=this._items[b];this._items[b]._node=a}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){z.forEach(this.events,x.disconnect);this._touchBase=null;n.query("img",this.container).forEach(function(b){b._index=
null;b._item=null;p.destroy(b);b=null});this._items=null;p.destroy(this._slideDiv);p.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(b){this._touchBase.setPreventDefault(b)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(x.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(x.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(x.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){x.disconnect(this.events.pop());x.disconnect(this.events.pop());x.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(b){},onUnSelect:function(b){},onCreate:function(b){},
onClick:function(b){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(b){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=b.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(b){this._moveDirection||(this._moveDirection=Math.abs(b.curY)>Math.abs(b.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(b.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(b){this._endTime=new Date;this._deltaMovement=b.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===b.swipeDirection)this.onSwipeLeft();else if("right"===b.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var b=e.getContentBox(this.container);var d=0>this._velocity?.001:-.001;var a=-(this._velocity*this._velocity)/(2*d);var g=-this._velocity/d;d=3*.6;var l=1-d,q=0,A=0;if(b.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,A=300;else if(0<this.contentOffsetY+a){b=0;for(a=Math.floor(g/20);b<a;b++)if(q=(20*l*b^3)+(20*d*b^2)+0*b,q=0>this._velocity?-q:q,0<this.contentOffsetY+q){A=20*b;break}0===A&&(A=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
a)+b.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=b.h-this._slideDiv.scrollHeight,b=0,a=Math.floor(g/20);b<a;b++){if(q=(20*l*b^3)+(20*d*b^2)+0*b,q=0>this._velocity?-q:q,Math.abs(this.contentOffsetY+q)>this._slideDiv.scrollHeight){A=20*b;break}}else A=g,this.contentOffsetY+=a;this._slideDiv.style.webkitTransition="-webkit-transform "+A+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var b=e.getContentBox(this.container);b.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+b.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=b.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(b){this.contentOffsetY=b;this._slideDiv.style.webkitTransform="translate3d(0, "+b+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var b=document.defaultView.getComputedStyle(this._slideDiv,null);
b=new WebKitCSSMatrix(b.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(b.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(b,d){"ON"===d.toggleState?(d.toggleState="OFF",d.src&&(b.src=d.src.toString()),this.onUnSelect(d)):(d.toggleState="ON",d.srcAlt&&(b.src=d.srcAlt),this.onSelect(d))}});v("extend-esri")&&r.setObject("dijit.InfoView",F,c);return F})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(F,r,z,x,n,v){F=F(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(t,m){this.domNode=x.byId(t);this.events=[z.connect(this.domNode,"touchstart",this,this._touchStartHandler),z.connect(this.domNode,"touchmove",this,this._touchMoveHandler),z.connect(this.domNode,"touchend",this,this._touchEndHandler),z.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(t){this._preventDefault=t},disableOnClick:function(){z.disconnect(this.events.pop())},
_clickHandler:function(t){if(this._moved)t.preventDefault();else this.onclick(t)},_touchStartHandler:function(t){this._moved=!1;this.client_x=t.targetTouches[0].clientX;this.client_y=t.targetTouches[0].clientY;this.down_x=t.targetTouches[0].pageX;this.down_y=t.targetTouches[0].pageY;t.downX=this.down_x;t.downY=this.down_y;this.onTouchStart(t)},_touchMoveHandler:function(t){this._preventDefault&&t.preventDefault();this._moved=!0;this.up_x=t.targetTouches[0].pageX;this.cur_x=t.targetTouches[0].pageX-
this.down_x;this.cur_y=t.targetTouches[0].pageY-this.down_y;t.curX=this.cur_x;t.curY=this.cur_y;this.onTouchMove(t)},_touchEndHandler:function(t){this._moved?(t.curX=this.cur_x,t.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?t.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(t.swipeDirection="right")):(t.clientX=this.client_x,t.clientY=this.client_y);this.onTouchEnd(t)},onTouchStart:function(t){},onTouchMove:function(t){},onTouchEnd:function(t){},onclick:function(t){}});
n("extend-esri")&&r.setObject("dijit._TouchBase",F,v);return F})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c){F=F(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(f,b){this.container=m.byId(b);this._touchBase=e(this.container,null);this._slideDiv=p.create("div",
{},this.container,"first");this.events=[z.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=f.items;h.add(this.container,"esriMobileNavigationBar");b=p.create("div",{},this._slideDiv);for(f=0;f<this._items.length;f++){switch(this._items[f].type){case "img":var d=p.create("div",{"class":"esriMobileNavigationItem"},b);var a=p.create("img",{src:this._items[f].src.toString(),style:{width:"100%",height:"100%"}},d);break;case "span":d=p.create("div",{"class":"esriMobileNavigationItem"},
b);a=p.create("span",{innerHTML:this._items[f].text},d);break;case "div":d=p.create("div",{"class":"esriMobileNavigationInfoPanel"},b),a=p.create("div",{innerHTML:this._items[f].text},d)}h.add(d,this._items[f].position);this._items[f].className&&h.add(a,this._items[f].className);a._index=f;a._item=this._items[f];this._items[f]._node=a}},startup:function(){this.onCreate(this._items)},destroy:function(){x.forEach(this.events,z.disconnect);this._touchBase=null;n.query("img",this.container).forEach(function(f){f._index=
null;f._item=null;p.destroy(f);f=null});this._items=null;p.destroy(this._slideDiv);p.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(f){this._markSelected(f._node,f)},onSelect:function(f){},onUnSelect:function(f){},onCreate:function(f){},_onClickHandler:function(f){if("img"===f.target.tagName.toLowerCase()){var b=f.target,d=b._item;n.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===d.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(b,d)}},_toggleNode:function(f,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(f.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(f.src=b.srcAlt),this.onSelect(b))},_markSelected:function(f,b){b.toggleState="ON";b.srcAlt&&(f.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(f,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(f.src=b.src.toString()),this.onUnSelect(b))}});v("extend-esri")&&r.setObject("dijit.NavigationBar",F,c);
return F})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/topic dojo/Evented".split(" "),function(F,r,z,x,n,v,t,m,h){var p=1E3,e=1E4;return F([r,h],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(c){this.inherited(arguments);"animationDuration"in c&&(p=c.animationDuration);"autoCloseInterval"in c&&(e=c.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&x.addClass(this.domNode,"mobile");var c=x.create("div",{"class":"appstate-header"});x.create("div",{"class":"appstate-title",innerHTML:this.nls.title},c);var f=x.create("div",{"class":"appstate-close"},c);x.place(c,this.domNode);c=x.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});x.place(c,this.domNode);this.own(n(c,"click",z.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(n(f,"click",z.hitch(this,
function(){this.hide()})));this.own(n(this.domNode,v.enter,z.hitch(this,function(){this._timerStop()})));this.own(n(this.domNode,v.leave,z.hitch(this,function(){this._timerStart()})))},show:function(){t.animateProperty({node:this.domNode,duration:p,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:z.hitch(this,function(){this.currentState=1})}).play();m.subscribe("splashPopupShow",z.hitch(this,function(){this._timerStop()}));m.subscribe("splashPopupHide",
z.hitch(this,function(){this._timerStart()}));this.timeoutHandler=setTimeout(z.hitch(this,this.hide),e)},hide:function(){0!==this.currentState&&t.animateProperty({node:this.domNode,duration:p,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:z.hitch(this,function(){this.currentState=0;x.setStyle(this.domNode,"display","none")})}).play()},_timerStart:function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(z.hitch(this,
this.hide),e))},_timerStop:function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A){function u(Q,U){var Y=Q.center.split(";");1===Y.length&&(Y=Q.center.split(","));if(2===Y.length||3===Y.length){Q=parseFloat(Y[0]);var ca=parseFloat(Y[1]);if(isNaN(Q)||isNaN(ca))Q=parseFloat(Y[0]),ca=parseFloat(Y[1]);if(!isNaN(Q)&&!isNaN(ca)){var da=4326;3!==Y.length||isNaN(Y[2])||(da=parseInt(Y[2],10));Y=new v(Q,ca,new h(da));O(Y.spatialReference,U.spatialReference)?U.centerAt(Y):K(Y,U.spatialReference,function(ma){U.centerAt(ma[0])},function(){console.error("Project center point error.")})}}}
function k(Q,U){var Y=Q.extent.split("wkt\x3d"),ca=null;2===Y.length?(ca=Y[1],Y=Y[0],Y=Y.split(",")):(Y=Q.extent.split(";"),1===Y.length&&(Y=Q.extent.split(",")));if(4===Y.length||5===Y.length){Q=parseFloat(Y[0]);var da=parseFloat(Y[1]),ma=parseFloat(Y[2]),na=parseFloat(Y[3]);if(isNaN(Q)||isNaN(Q)||isNaN(Q)||isNaN(Q))Q=parseFloat(Y[0]),da=parseFloat(Y[1]),ma=parseFloat(Y[2]),na=parseFloat(Y[3]);if(isNaN(Q)||isNaN(da)||isNaN(ma)||isNaN(na))console.error("Wrong extent parameters.");else{var va=4326;
5!==Y.length||isNaN(Y[4])||(va=parseInt(Y[4],10));Y=null;Y=ca?new t(Q,da,ma,na,new h({wkt:ca})):new t(Q,da,ma,na,new h({wkid:va}));O(U.spatialReference,Y.spatialReference)?U.setExtent(Y):K(Y,U.spatialReference,function(ja){U.setExtent(ja[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function w(Q,U){var Y=null;if(Q.markertemplate){Y={title:"",content:"",isIncludeShareUrl:!1};try{var ca=JSON.parse(decodeURIComponent(Q.markertemplate));F.mixin(Y,
ca)}catch(ra){console.error("urlParams: \x26markertemplate JSON.parse error."+ra.stack)}}ca=Q.marker.split(";");1===ca.length&&(ca=Q.marker.split(","));if(2<=ca.length&&6>=ca.length&&ca[0].length&&!isNaN(ca[0])&&ca[1].length&&!isNaN(ca[1])){var da=parseFloat(ca[0]),ma=parseFloat(ca[1]),na=4326;3<=ca.length&&ca[2].length&&!isNaN(ca[2])&&(na=parseInt(ca[2],10));var va="";4<=ca.length&&(va=ca[3]);Q=null;5<=ca.length&&0===ca[4].indexOf("http")&&(Q=ca[4]);var ja=null;6===ca.length&&(ja=ca[5]);var pa=f.fromJson({type:"esriPMS",
url:Q,contentType:"image/png"}),la=null;ja&&(la=f.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:ja}));C(pa).then(function(){var ra=new v(da,ma,new h({wkid:na}));O(ra.spatialReference,U.spatialReference)?y(ra,pa,la,va,Y,U):K(ra,U.spatialReference,function(X){y(X[0],pa,la,va,Y,U)},function(){console.error("Project center point error.")})})}}
function y(Q,U,Y,ca,da,ma){ca=new a("",ca);if(da){var na=A.getXyContent(da);da.isIncludeShareUrl&&(da=A.getShareUrl(ma,da,!0),da=A.getShareUrlContent(da),na+=da);ca.setContent(na)}na=new d({id:"marker-feature-action-layer"});ma.addLayer(na);ca=new b(Q,U,null,ca);na.add(ca);Y&&(Y.xoffset=U.width/2,Y.yoffset=U.height/2+U.yoffset,U=new b(new v(Q.toJson()),Y),na.add(U),ca._textSymbol=U);ma.centerAt(Q)}function C(Q){var U=new z;Q.url?l.getImagesSize(Q.url).then(function(Y){Q.width=Y[0];Q.height=Y[1];U.resolve(Q)},
function(){Q.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";Q.width=26;Q.height=26;Q.setOffset(0,Q.height/2);U.resolve(Q)}):(Q.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",Q.width=26,Q.height=26,Q.setOffset(0,Q.height/2),U.resolve(Q));return U}function D(Q,U){var Y=Q.query.split(";");1===Y.length&&(Y=Q.query.split(","));if(2!==Y.length&&3!==Y.length)console.error("query URL parameter is not correct.");else{var ca=Y[0];T("name",ca,U).then(function(da){null===da?T("id",ca,
U).then(function(ma){null===ma?console.error("Invalid layer name or id."):G(U,ma,Y)}):G(U,da,Y)})}}function G(Q,U,Y){var ca=new g,da="";ca.outSpatialReference=Q.spatialReference;if(2===Y.length)ca.where=Y[1];else if(3===Y.length&&(U.layerObject.url&&l.isHostedService(U.layerObject.url)&&l.containsNonLatinCharacter(Y[2])&&(da="N"),r.forEach(U.layerObject.fields,function(ma){if(ma.alias.toLowerCase()===Y[1].toLowerCase()||ma.name.toLowerCase()===Y[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(ma.type)?ca.where=ma.name+"\x3d"+Y[2]:-1<["esriFieldTypeString"].indexOf(ma.type)&&(ca.where=Y[1]+"\x3d"+da+"'"+Y[2].replace(/'/g,"''")+"'")},this),!ca.where)){console.error("Invalid field name or type in query URL parameter.");return}ca.maxAllowableOffset=1E-5;U.layerObject.queryFeatures(ca).then(function(ma){ma=ma.features;if(0===ma.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===U.layerObject.geometryType&&
1===ma.length)Q.setExtent(m.getExtentForScale(Q,1E3)),Q.centerAt(ma[0].geometry);else{var na=l.graphicsExtent(ma);Q.setExtent(na)}H(Q,U,ma)}},function(ma){console.error(ma)})}function H(Q,U,Y){function ca(na){r.forEach(Y,function(va){va.setInfoTemplate(na)})}function da(){Q.infoWindow.setFeatures(Y);Q.infoWindow.show(L(Y[0]))}if(Q.getLayer(U.layerInfo.id))da();else{var ma=U.layerInfo.getInfoTemplate();ma?(ca(ma),da()):U.layerInfo.loadInfoTemplate().then(function(na){ca(na);da()})}}function L(Q){Q=
Q.geometry;if("point"!==Q.type)if("multipoint"===Q.type)Q=Q.getPoint(0);else if("polyline"===Q.type)Q=Q.getExtent().getCenter();else if("polygon"===Q.type)Q=Q.getExtent().getCenter();else if("extent"===Q.type)Q=Q.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return Q}function T(Q,U,Y){var ca=new z,da=[];q.getInstance(Y,Y.itemInfo).then(function(ma){ma.traversal(function(na){if(ca.isResolved())return!0;("id"===Q&&na.id.toLowerCase()===U.toLowerCase()||
"name"===Q&&na.title.toLowerCase()===U.toLowerCase())&&da.push(n({layerType:na.getLayerType(),layerObject:na.getLayerObject()}).then(function(va){"FeatureLayer"===va.layerType&&ca.resolve({layerInfo:na,layerObject:va.layerObject})},function(va){console.error("Find layer error from query URL parameter",va);ca.resolve(null)}))});n(da).then(function(){ca.isResolved()||ca.resolve(null)})});return ca}function K(Q,U,Y,ca){var da=[102113,102100,3857];if(4326===Q.spatialReference.wkid&&I(da,U.wkid)){Q.ymin=
Math.max(Q.ymin,-89.99);Q.ymax=Math.min(Q.ymax,89.99);Q=c.geographicToWebMercator(Q);if((ca=Q.spatialReference._getInfo())&&Q.xmin>Q.xmax){da=ca.valid[1]-Q.xmin;var ma=Q.xmax-ca.valid[0];da>ma?Q.xmax=ca.valid[1]+ma:Q.xmin=ca.valid[0]-da}Q.spatialReference.wkid=U.wkid;Y([Q],null)}else I(da,Q.spatialReference.wkid)&&4326===U.wkid?(Q=c.webMercatorToGeographic(Q),(ca=Q.spatialReference._getInfo())&&Q.xmin>Q.xmax&&(da=ca.valid[1]-Q.xmin,ma=Q.xmax-ca.valid[0],da>ma?Q.xmax=ca.valid[1]+ma:Q.xmin=ca.valid[0]-
da),Y([Q],null)):(da=new p,da.geometries=[Q],da.outSR=U,e.defaults.geometryService.project(da,function(na){!(na&&0<na.length&&na[0]&&"extent"===na[0].type)||isNaN(na[0].xmin)||isNaN(na[0].ymin)||isNaN(na[0].xmax)||isNaN(na[0].ymax)?na&&0<na.length&&na[0]&&"point"===na[0].type&&!isNaN(na[0].x)&&!isNaN(na[0].y)&&Y(na,null):Y(na,null)},ca))}function O(Q,U){var Y=[102113,102100,3857];return Q&&U&&Q.wkt===U.wkt&&(Q.wkid===U.wkid||Q.latestWkid&&Q.latestWkid===U.wkid||U.latestWkid&&Q.wkid===U.latestWkid||
Q.latestWkid&&Q.latestWkid===U.latestWkid)||Q&&U&&Q.wkid&&U.wkid&&I(Y,Q.wkid)&&I(Y,U.wkid)?!0:!1}function I(Q,U){for(var Y=Q.length;Y--;)if(Q[Y]===U)return!0;return!1}function P(Q,U,Y,ca){var da=[];Q&&Q[U]&&Q[U].split&&(da=Q[U].split(";"));if(da&&0<=da.length){var ma={};ma[Y]=da;q.getInstance(ca,ca.itemInfo).then(function(na){na.setSimplificationState(ma)})}}return{postProcessUrlParams:function(Q,U){a:for(var Y=["showLayers","hideLayers","showLayersEncoded","hideLayersEncoded"],ca=0,da=Y.length;ca<
da;ca++){var ma=Y[ca],na=ma.toLowerCase(),va;for(va in Q){var ja=va.toLowerCase();if(na===ja){P(Q,va,ma,U);break a}}}if("extent"in Q)return k(Q,U);if("center"in Q)return u(Q,U);if("marker"in Q)return w(Q,U);if("find"in Q)x.publish("publishData","framework","framework",{searchString:Q.find},!0);else if("query"in Q)return D(Q,U)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),
function(F,r,z,x,n,v,t,m,h,p){var e={getBaseHrefUrl:function(c){var f="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",b="";window.isXT?b=window.location.protocol+"//"+window.location.host+window.appInfo.appPath:(b=h.urlToObject(window.location.href).query||{},b=b.appid?c+"apps/"+f+"/index.html?appid\x3d"+b.appid:b.id?c+"apps/"+f+"/index.html?id\x3d"+b.id:h.getAppHref());return b},addQueryParamToUrl:function(c,f,b,d){c=p.urlToObject(c);c.query||(c.query={});c.query[f]=b;f=c.path;
for(var a in c.query)b=c.query[a],!0===d&&(b=encodeURIComponent(b)),f=f===c.path?f+"?"+a+"\x3d"+b:f+"\x26"+a+"\x3d"+b;return f},getQueryParamFromUrl:function(c,f){c=p.urlToObject(c);c.query||(c.query={});return c.query[f]},removeQueryParamFromUrl:function(c,f,b){c=p.urlToObject(c);c.query&&delete c.query[f];f=c.path;for(var d in c.query){var a=c.query[d];!0===b&&(a=encodeURIComponent(a));f=f===c.path?f+"?"+d+"\x3d"+a:f+"\x26"+d+"\x3d"+a}return f},getShareUrlContent:function(c){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+
window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+c+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},getShareUrl:function(c,f,b){var d=e.getBaseHrefUrl(window.portalUrl),a="";if(f)if(f.longitude&&f.latitude){var g=f.longitude;var l=f.latitude;a=f.longitude+","+f.latitude+","}else if(f.x&&f.y&&f.spatialReference&&f.spatialReference.wkid){var q=f.x;var A=f.y;var u=f.spatialReference.wkid;a=f.x+","+f.y+","+f.spatialReference.wkid}d=
e.addQueryParamToUrl(d,"marker",a,!0);d=e.addQueryParamToUrl(d+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:f.title,x:q,y:A,wkid:u,longitude:g,latitude:l,isIncludeShareUrl:b})));f=c.getLevel();return d="number"===typeof f&&-1!==f?e.addQueryParamToUrl(d,"level",c.getLevel(),!0):e.addQueryParamToUrl(d,"scale",c.getScale(),!0)},getXyContent:function(c){var f="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";c.longitude&&c.latitude?f+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+
window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(c.longitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(c.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":c.x&&c.y&&(f+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+
h.localizeNumber(parseFloat(c.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(c.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");return f+"\x3c/div\x3e"},_isUserOwnTheApp:function(c){return c&&c.username&&c.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(c,f,b,d){var a=new n;d=x.getStandardPortalUrl(d);d=d+"/sharing/rest/content/users/"+(f?f.username?f.username:
f.email:b.email);if(v.isDefined(c.folderId)&&"/"!==c.folderId||v.isDefined(c.ownerFolder)&&"/"!==c.ownerFolder)d+="/"+(c.folderId||c.ownerFolder);d+="/items/"+c.id;r({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(F.hitch(this,function(g){a.resolve(g)}),F.hitch(this,function(g){console.error(g);a.reject(g)}));return a},_getProfile:function(c,f){var b=new n;c=x.getUserUrl(f,c.owner);r({url:c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(F.hitch(this,
function(d){b.resolve(d)}),F.hitch(this,function(d){console.error(d);b.reject(d)}));return b},_unshareItemById:function(c,f,b){var d=new n;b=x.getStandardPortalUrl(b);b+="/sharing/rest/content/items/"+f+"/unshare";f={f:"json"};f=F.mixin(f,c);r({url:b,handleAs:"json",content:f,callbackParamName:"callback"},{usePost:!0}).then(F.hitch(this,function(a){d.resolve(a)}),F.hitch(this,function(a){console.error(a);d.reject(a)}));return d},canSharePublic:function(c){return!c.selfUrl||!0!==c.canSharePublic&&
!1!==c.canSharePublic?!0:c.canSharePublic},unshareItemsByUser:function(c,f,b){var d=new n;b=x.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+c+"/unshareItems";c={f:"json"};c=F.mixin(c,f);r({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(F.hitch(this,function(a){d.resolve(a)}),F.hitch(this,function(a){console.error(a);d.reject(a)}));return d},unshareItems:function(c,f,b){var d=new n;b=x.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+(f.owner||
c.email)+"/unshareItems";c={f:"json"};c=F.mixin(c,f);r({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(F.hitch(this,function(a){d.resolve(a)}),F.hitch(this,function(a){console.error(a);d.reject(a)}));return d},shareItemsByUser:function(c,f,b){var d=new n;b=x.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+c+"/shareItems";c={f:"json"};c=F.mixin(c,f);r({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(F.hitch(this,function(a){d.resolve(a)}),
F.hitch(this,function(a){console.error(a);d.reject(a)}));return d},shareItems:function(c,f,b){var d=new n;b=x.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+(f.owner||c.email)+"/shareItems";c={f:"json"};c=F.mixin(c,f);r({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(F.hitch(this,function(a){d.resolve(a)}),F.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getItemsGroups:function(c,f){var b=new n;f=x.getStandardPortalUrl(f);f+="/sharing/rest/content/items/"+
c.id+"/groups";r({url:f,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(F.hitch(this,function(d){b.resolve(d)}),F.hitch(this,function(d){console.error(d);b.reject(d)}));return b},isSharedToPublic:function(c){return window.isXT?!1:null===c?!0:"undefined"!==typeof c&&"undefined"!==typeof c.item&&"undefined"!==typeof c.item.access&&"public"===c.item.access?!0:!1},isShowSocialMediaLinks:function(c){return window.isXT?!0:null===c?!0:"undefined"!==typeof c&&"undefined"!==
typeof c.item&&"undefined"!==typeof c.item.access&&"private"===c.item.access?!1:!0},getItemShareInfo:function(c){var f=new n,b="";if(window.isXT)return f.resolve(null);b=h.urlToObject(h.getAppHref()).query||{};b=b.id||b.appid;if("undefined"===typeof b||""===b)return f.resolve(null);t.getPortal(c).getItemById(b).then(F.hitch(this,function(d){var a={};a.item=d;a.item&&"undefined"===typeof a.item.sharing&&a.item.access&&(a.item.sharing={access:a.item.access});f.resolve(a)}),F.hitch(this,function(d){console.log(d);
f.resolve(null)}));return f},getShareInfo:function(c){var f=t.getPortal(c),b=new n,d="";if(window.isXT)return b.resolve(null);d=h.urlToObject(h.getAppHref()).query||{};d=d.id||d.appid;if("undefined"===typeof d||""===d)return b.resolve(null);z({getUser:f.getUser(),loadSelfInfo:f.loadSelfInfo(),getItem:f.getItemById(d)}).then(F.hitch(this,function(a){var g={};g.item=a.getItem;g.item&&g.item.ownerFolder&&g.item.ownerFolder.length&&"/"!==g.item.ownerFolder&&(g.item.folderId=g.item.ownerFolder);"undefined"===
typeof g.item.sharing&&g.item.access&&(g.item.sharing={access:g.item.access});g.user=a.getUser;e._setUserRole(a.loadSelfInfo,g);g.currentUser=g.user;g.isAdmin=!1;g.userRole&&(g.userRole.isAdmin()||g.userRole.isCustom()&&g.userRole.canUpdateOrgItems())?(g.isAdmin=!0,g.item.owner!==g.currentUser.name?e._getProfile(g.item,c).then(F.hitch(this,function(l){g.itemUser=l;g.itemUser.orgId!==g.currentUser.orgId&&(g.isAdmin=!1);b.resolve(g)})):(g.itemUser=g.currentUser,b.resolve(g))):(g.currentUser&&(g.itemUser=
g.currentUser),b.resolve(g))}),F.hitch(this,function(a){console.log(a);b.resolve(null)}));return b},_setUserRole:function(c,f){f.userPortalUrl=c.urlKey?c.urlKey+"."+c.customBaseUrl:this.portalUrl;!c||c.code||c.message||(f.organization=c);if(c&&c.user)f.userRole=new m({id:c.user.roleId?c.user.roleId:c.user.role,role:c.user.role}),f._isCustomRole=f.userRole.isCustom(),f._roleCanShareToGroup=f._isCustomRole&&f.userRole.canShareItemToGroup(),f._roleCanShareToOrg=f._isCustomRole&&f.userRole.canShareItemToOrg(),
f._roleCanSharePublic=f._isCustomRole&&f.userRole.canShareItemToPublic(),f._roleCanShare=f._roleCanShareToGroup||f._roleCanShareToOrg||f._roleCanShareToPublic,f._roleCanUpdateItems=f._isCustomRole&&f.userRole.canUpdateOrgItems(),f._roleCanShareOthersItemsToGroup=f._isCustomRole&&f.userRole.canShareOthersItemsToGroup(),f._roleCanShareOthersItemsToOrg=f._isCustomRole&&f.userRole.canShareOthersItemsToOrg(),f._roleCanShareOthersItemsToPublic=f._isCustomRole&&f.userRole.canShareOthersItemsToPublic(),f._roleCanShareOthersItems=
f._isCustomRole&&(f.userRole.canShareOthersItemsToGroup()||f.userRole.canShareOthersItemsToOrg()||f._roleCanShareOthersItemsToPublic),f._orgUserCanSharePublicOrOverride=f.organization&&(!0===f.organization.canSharePublic&&(!f._isCustomRole||f._roleCanSharePublic||f._roleCanShareOthersItemsToPublic)||f.userRole.isAdmin());else return!1},getItemById:function(c,f){var b=new n;f=x.getStandardPortalUrl(f);f+="/sharing/rest/content/items/"+c.id;r({url:f,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(F.hitch(this,
function(d){b.resolve(d)}),F.hitch(this,function(d){console.error(d);b.reject(d)}));return b},disableWebMapPopup:function(c){c&&c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!1)},enableWebMapPopup:function(c){c&&c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!0)}};return e})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector ./LayerInfos/LayerInfos".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){var f=null,b=F(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(d){r.mixin(this,d);this.popupMenu=p.getInstance();this.isInited=!1;this.featureActionManager=m.getInstance();n.subscribe("mapLoaded",r.hitch(this,this.onMapLoadedOrChanged));n.subscribe("mapChanged",r.hitch(this,this.onMapLoadedOrChanged));n.subscribe("appConfigChanged",r.hitch(this,this._onAppConfigChanged));n.subscribe("widgetsActionsRegistered",r.hitch(this,
this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&z.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&z.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=
z.create("span",{"class":"popup-menu-button"},t(".actionList",this.popupUnion.bigScreen.domNode)[0]);var d=t("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0];d=z.create("div",{"class":"esriMobileInfoViewItem"},d);this.popupMenuButtonMobile=z.create("span",{"class":"popup-menu-button"},d);v(this.popupMenuButtonMobile,"click",r.hitch(this,this._onPopupMenuButtonClick));v(this.popupMenuButtonDesktop,"click",r.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(d){d=
z.position(d.target);this.menuActionsOfSelectedFeature&&this.popupMenu.setActions(this.menuActionsOfSelectedFeature);this.popupMenu.show(d)},_bindSelectionChangeEvent:function(){v(this.popupUnion.bigScreen,"selection-change",r.hitch(this,this._onSelectionChange));v(this.popupUnion.mobile,"selection-change",r.hitch(this,this._onSelectionChange))},_onSelectionChange:function(d){(this.selectedFeature=d.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),d=this.selectedFeature.getLayer(),
(this.selectedFeature.infoTemplate||d&&d.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){z.addClass(this.popupMenuButtonDesktop,"disabled");z.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){z.removeClass(this.popupMenuButtonDesktop,"disabled");z.removeClass(this.popupMenuButtonMobile,"disabled")},convertFeatures:function(d){var a=new x,g=c.getInstanceSync(),l=d&&d[0]&&d[0].getLayer();
(g=g.getLayerInfoById(l&&l.id))?a=g.getMSShipFeatures(d):a.resolve(null);return a},initPopupMenu:function(d){d?this.convertFeatures(d).then(r.hitch(this,function(a){var g=h.toFeatureSet(a||d);this.featureActionManager.getSupportedActions(g).then(r.hitch(this,function(l){var q="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent CreateLayer".split(" ");l=l.filter(r.hitch(this,function(A){return 0>q.indexOf(A.name)}));0===l.length?this._disablePopupMenu():
this._enablePopupMenu();this.menuActionsOfSelectedFeature=l=l.map(r.hitch(this,function(A){A.data=g;return A}));this.popupMenu.setActions(l)}))})):(this._disablePopupMenu(),this.popupMenu.setActions([]))},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),
this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(d){try{this._relatedRecordsPopupProjector&&this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new e({originalFeature:d,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(a){console.warn(a.message)}}});b.getInstance=function(d){null===f&&(f=new b({mapManager:d}));
return f};return b})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(F,r,z,x,n,v,t,m){var h=null,p=F(null,{constructor:function(){this._actions=[];window.isBuilder?(x.subscribe("app/mapLoaded",r.hitch(this,this._onMapLoaded)),x.subscribe("app/mapChanged",r.hitch(this,this._onMapChanged))):(x.subscribe("mapLoaded",r.hitch(this,this._onMapLoaded)),x.subscribe("mapChanged",
r.hitch(this,this._onMapChanged)));window.isBuilder?(x.subscribe("app/appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)),x.subscribe("app/appConfigChanged",r.hitch(this,this._onAppConfigChanged))):(x.subscribe("appConfigLoaded",r.hitch(this,this._onAppConfigLoaded)),x.subscribe("appConfigChanged",r.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(e){e=this._getFeatureSet(e);var c=[];z.forEach(this._actions,
function(f){var b=this.testActionSupportFeature(f,e);b.action=f;c.push(b)},this);return v(c).then(r.hitch(this,function(f){return f.map(r.hitch(this,function(b,d){return{result:b,action:this._actions[d]}})).filter(function(b){return b.result}).map(function(b){return b.action})}))},testActionSupportFeature:function(e,c){c=this._getFeatureSet(c);var f;c.features&&0<c.features.length&&(f=c.features[0].getLayer());e=e.isFeatureSupported(c,f);var b=new n;e&&"function"===typeof e.then?e.then(function(d){b.resolve(d)},
function(d){console.error(d);b.resolve(!1)}):b.resolve(e);return b},registerAction:function(e){var c=new n;require([e.uri],r.hitch(this,function(f){var b=new f({map:this.map,appConfig:this.appConfig,label:e.label,name:e.name,widgetId:e.widgetId});z.some(this._actions,function(d){return b.name===d.name&&b.widgetId===d.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",b.name),c.reject("Feature/FeatureSet action has been registered.",b.name)):(this._actions.push(b),c.resolve(b))}));
return c},removeActionsByWidgetId:function(e){this._actions=z.filter(this._actions,function(c){return c.widgetId!==e},this)},getActionsByWidgetId:function(e){return z.filter(this._actions,function(c){return c.widgetId===e},this)},getActionsByActionName:function(e){return z.filter(this._actions,function(c){return c.name===e},this)},registerWidgetFeatureActions:function(e){var c=new n;if(!e.featureActions||!e.uri)return c.resolve(),c;var f=[];z.forEach(e.featureActions,function(b){var d=e.manifest["i18nLabels_featureAction_"+
b.name];f.push(this.registerAction({uri:e.isRemote?e.amdFolder+b.uri+".js":e.amdFolder+b.uri,widgetId:e.id,name:b.name,label:d[window.dojoConfig.locale]||d[window.dojoConfig.locale.split("-")[0]]||d.defaultLabel}))},this);return v(f)},registerAllWidgetFeatureActions:function(e){var c=[];e.visitElement(r.hitch(this,function(f){f.uri&&f.visible&&c.push(this.registerWidgetFeatureActions(f))}));return v(c).then(function(){x.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(e){var c=
[];z.forEach(this.getAllActions(),function(f){var b=e.getConfigElementById(f.widgetId);"framework"===f.widgetId||b&&b.uri&&!1!==b.visible||this.removeActionsByWidgetId(f.widgetId)},this);e.visitElement(r.hitch(this,function(f){f.uri&&f.visible&&0===this.getActionsByWidgetId(f.id).length&&c.push(this.registerWidgetFeatureActions(f))}));0<c.length&&v(c).then(function(){x.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){z.forEach(t,function(e){this.registerAction({uri:e.uri,
widgetId:"framework",label:window.jimuNls.featureActions[e.name],name:e.name})},this)},_getFeatureSet:function(e){return"[object Object]"===Object.prototype.toString.call(e)?e.features?e:m.toFeatureSet([e]):m.toFeatureSet(e)},_onAppConfigLoaded:function(e){this.appConfig=e=r.clone(e);this._setActionsAppConfig(e);this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(e){this.appConfig=e=r.clone(e);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(e)},
_onMapLoaded:function(e){this.map=e;this._setActionsMap(e)},_onMapChanged:function(e){this.map=e;this._setActionsMap(e)},_setActionsMap:function(e){z.forEach(this._actions,function(c){c.setMap(e)},this)},_setActionsAppConfig:function(e){z.forEach(this._actions,function(c){c.setAppConfig(e)},this)}});p.getInstance=function(){null===h&&(h=new p,window._featureActionManager=h);return h};return p})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),
function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",
uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(F,r,z){return F(r,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(x){return 0<x.features.length&&x.features[0].geometry},onExecute:function(x){z.featureAction.zoomTo(this.map,
x.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(F,r){return F(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(z){r.mixin(this,z)},isFeatureSupported:function(z,x){return!0},onExecute:function(z,x){},setMap:function(z){this.map=z},setAppConfig:function(z){this.appConfig=z},getIcon:function(z){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+
this.name+"_"+z+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+z+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(F,r,z){return F(r,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(x){return 0<x.features.length&&x.geometryType},onExecute:function(x){z.featureAction.panTo(this.map,x.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(F,r,z,x){return F([z],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(n,v){if(1>n.features.length||!v)return!1;n=n.features[0];var t=r.getObject("renderer.symbol",!1,v);return n&&n.geometry&&(n.symbol||t)&&this.map.getLayer(v.id)},onExecute:function(n,v){x.featureAction.flash(n&&n.features,v)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(F,
r,z){return F([r],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(x,n){return x&&x.features&&1===x.features.length&&n&&n.infoTemplate},onExecute:function(x){z.featureAction.showPopup(this.map,x.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(F,r,z){return F(r,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(x){return 0<x.features.length},onExecute:function(x){x=
z.createDataSource({type:z.TYPE_FEATURESET,filename:"features",data:x});x.setFormat(z.FORMAT_CSV);x.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./CSVUtils ./GeojsonConverters libs/polyfills/FileSaver".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){function l(u,k){10>dojo.isIE?saveTextAs(k,u,"utf-8"):(k=new Blob([k],{type:"text/plain;charset\x3dutf-8"}),saveAs(k,u,!0))}var q={createDataSource:function(u){return new A(u)},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},A=F(null,{filename:void 0,format:void 0,nls:void 0,data:null,url:null,constructor:function(u){this.nls=window.jimuNls.exportTo;this.data=u.data;this.url=u.url;
this.filename=u.filename},setFormat:function(u){this.format=u},download:function(){if(this.format===q.FORMAT_CSV)return this.exportCSV();if(this.format===q.FORMAT_FEATURESET)return this.exportFeatureCollection();if(this.format===q.FORMAT_GEOJSON)return this.exportGeoJSON()},getFeatureSet:function(){var u=new n;if(this.data)u.resolve(this.data);else if(this.url){var k=new v;k.returnGeometry=!0;k.outFields=["*"];this.queryTask=new t(this.url);this.queryTask.execute(k,r.hitch(this,function(w){u.resolve(w)}),
r.hitch(this,function(){u.resolve(null)}))}else u.resolve(null);return u},findPopupInfo:function(u){if(!u||!u.features||0===u.features.length)return null;u=u.features[0];if(u._layer&&(u=u._layer.id,u=b.getInstanceSync().getLayerInfoById(u))){var k=u.getPopupInfo();k||(k=u.layerObject.infoTemplate&&u.layerObject.infoTemplate.info);return k}return null},findLayerDefinition:function(u){if(!u||!u.features||0===u.features.length)return null;var k=u.features[0];if(k._layer)return{geometryType:u.geometryType,
fields:k._layer.fields,objectIdField:k._layer.objectIdField,typeIdField:k._layer.typeIdField,types:k._layer.types};var w=[];k=k.attributes;for(var y in k)k.hasOwnProperty(y)&&w.push({name:y});return{geometryType:u.geometryType,fields:w}},formatAttributes:function(u){var k=new n,w=this.findPopupInfo(u),y=this.findLayerDefinition(u);if(w&&y){var C=z.map(u.features,function(D){return D.attributes});a._formattedData(u.features[0]._layer,{data:C,outFields:y.fields},{formatNumber:!0,formatDate:!0,formatCodedValue:!0,
popupInfo:w,richText:{}}).then(r.hitch(this,function(D){var G=D.datas;D=new m;var H=[];z.forEach(u.features,function(L,T){L=new h(L.toJson());L.attributes=G[T];H.push(L)});D.features=H;D.geometryType=u.geometryType;D.fieldAliases=u.fieldAliases;D.fields=u.fields;k.resolve(D)}))}else k.resolve(u);return k},exportCSV:function(){return this.getFeatureSet().then(r.hitch(this,function(u){var k=this.findPopupInfo(u),w=this.findLayerDefinition(u),y=u.features;if(w&&w.fields){var C=r.clone(w.fields);this._addXYAttribute(C,
"x");this._addXYAttribute(C,"y");w.fields=C;y=[];z.forEach(u.features,r.hitch(this,function(D){D=new h(D.toJson());D.attributes=this._getAttrsWithXY(D);y.push(D)}))}else for(C in w.fields=[],y[0].attributes)w.fields.push({name:C,alias:C});return a.exportCSVByGraphics(this.filename,w,y,{formatNumber:!0,formatDate:!0,formatCodedValue:!0,popupInfo:k})}))},exportGeoJSON:function(){return this.getFeatureSet().then(r.hitch(this,function(u){return this.formatAttributes(u)})).then(r.hitch(this,function(u){return this._projectToWGS84(u)})).then(r.hitch(this,
function(u){var k="";if(u&&u.features&&0<u.features.length){var w={type:"FeatureCollection",features:[]};z.forEach(u.features,function(y){w.features.push(g.arcgisToGeoJSON(y))});k=x.stringify(w)}return k})).then(r.hitch(this,function(u){l(this.filename+".geojson",u)}))},exportFeatureCollection:function(){return this.getFeatureSet().then(r.hitch(this,function(u){return this.formatAttributes(u)})).then(r.hitch(this,function(u){var k="";u&&(u=u.toJson())&&(k=x.stringify(u));return k})).then(r.hitch(this,
function(u){l(this.filename+".json",u)}))},exportToPortal:function(u,k){},_projectToWGS84:function(u){var k=new n,w=this._getSpatialReference(u);if(w)if(4326===parseInt(w.wkid,10))k.resolve(u);else if(w.isWebMercator()){w=new m;var y=[];z.forEach(u.features,function(D){var G=new h(D.toJson());G.geometry=f.webMercatorToGeographic(D.geometry);y.push(G)});w.features=y;w.geometryType=u.geometryType;w.fieldAliases=u.fieldAliases;w.fields=u.fields;k.resolve(w)}else{w=new e;w.geometries=z.map(u.features,
function(D){return D.geometry});w.outSR=new p(4326);var C=c&&c.defaults&&c.defaults.geometryService;C&&"esri.tasks.GeometryService"===C.declaredClass||(C=d.getArcGISDefaultGeometryService());C.project(w).then(function(D){var G=new m,H=[];z.forEach(u.features,function(L,T){L=new h(L.toJson());L.geometry=D[T];H.push(L)});G.features=H;G.geometryType=u.geometryType;G.fieldAliases=u.fieldAliases;G.fields=u.fields;k.resolve(G)},function(D){console.error(D);k.resolve([])})}else k.resolve([]);return k},_getSpatialReference:function(u){if(u.spatialReference)return u.spatialReference;
var k;z.some(u.features,function(w){if(w.geometry&&w.geometry.spatialReference)return k=w.geometry.spatialReference,!0});return k},_getAttrsWithXY:function(u){var k=u.geometry;return k&&"point"===k.type?(u=r.clone(u.attributes),"x"in u?u._x=k.x:u.x=k.x,"y"in u?u._y=k.y:u.y=k.y,u):u.attributes},_addXYAttribute:function(u,k){var w=z.some(u,function(y){return y.name===k})?"_"+k:k;u.push({name:w,alias:w,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});return u}});return q})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/kernel dojo/has dojo/number dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){function d(a){var g=r.clone(a.attributes);(a=a.geometry)&&"point"===a.type&&("x"in g?g._x=a.x:g.x=a.x,"y"in g?g._y=a.y:g.y=a.y);return g}F.exportCSV=function(a,g,l){return F._createCSVStr(g,l).then(function(q){return F._download(a+".csv",q)})};F.exportCSVFromFeatureLayer=function(a,g,l){l=l||{};return F._getExportData(g,{datas:l.datas,objectIds:l.objectIds,fromClient:l.fromClient,withGeometry:l.withGeometry,outFields:l.outFields,filterExpression:l.filterExpression,
outSpatialReference:l.outSpatialReference,arcadeExpressions:l.arcadeExpressions,geometry:l.geometry,orderByFields:l.orderByFields,start:l.start,num:l.num}).then(function(q){return F._formattedData(g,q,{formatNumber:l.formatNumber,formatDate:l.formatDate,formatCodedValue:l.formatCodedValue,richText:{clearFormat:l.richTextFieldsToClear&&!!l.richTextFieldsToClear.length,fieldsToClear:l.richTextFieldsToClear||[]},popupInfo:l.popupInfo}).then(function(A){return F.exportCSV(a,A.datas,A.columns)})})};F.exportCSVByAttributes=
function(a,g,l,q){q=r.mixin({},q);q.datas=l;return F.exportCSVFromFeatureLayer(a,g,q)};F.exportCSVByGraphics=function(a,g,l,q){l=z.map(l,function(A){return A.attributes});return F.exportCSVByAttributes(a,g,l,q)};F._createCSVStr=function(a,g){var l=new m,q="",A=0,u=0,k="",w="",y=","===t.format(1.1,{locale:n.locale}).substring(1,2)?";":",";try{g=z.map(g,function(H){return"string"===typeof H?{name:H}:H});z.forEach(g,function(H){H=H.alias||H.name;-1<H.toString().indexOf(y)&&(H='"'+H+'"');q=q+k+H;k=y});
q+="\r\n";A=a.length;u=g.length;for(var C=0;C<A;C++){k="";for(var D=0;D<u;D++){(w=a[C][g[D].name])||"number"===typeof w||(w="");if("string"===typeof w){var G=!1;(G=";"===y?/[";\r\n]/g.test(w):/[",\r\n]/g.test(w))&&(w='"'+w.replace(/(")/g,'""')+'"')}q=q+k+w;k=y}q+="\r\n"}l.resolve(q)}catch(H){console.error(H),l.resolve("")}return l};F._isIE11=function(){return 11===h.has("ie")};F._isEdge=function(){return h.has("edge")};F._getDownloadUrl=function(a){return window.Blob&&window.URL&&window.URL.createObjectURL?
(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};F._download=function(a,g){var l=new m;try{if(v("ie")&&10>v("ie")){var q=window.top.open("about:blank","_blank");q.document.write("sep\x3d,\r\n"+g);q.document.close();q.document.execCommand("SaveAs",!0,a);q.close()}else if(10===v("ie")||F._isIE11()||F._isEdge()){var A=new Blob(["\ufeff"+g],{type:"text/csv"});navigator.msSaveBlob(A,a)}else{var u=x.create("a",{href:F._getDownloadUrl(g),
target:"_blank",download:a},document.body);if(v("safari")){var k=document.createEvent("MouseEvents");k.initEvent("click",!0,!0);u.dispatchEvent(k)}else u.click();x.destroy(u)}l.resolve()}catch(w){l.reject(w)}return l};F._getExportData=function(a,g){var l=new m,q=null,A=[],u=g.datas,k=g.withGeometry,w=!!g.arcadeExpressions;q=g.outFields;q&&q.length||(q=a.fields);q=r.clone(q);if(k&&!(u&&0<u.length)){w?(A=z.filter(a.fields,function(C){return-1===C.name.indexOf("expression/")}),A=r.clone(A)):A=r.clone(q);
var y="";y=-1!==q.indexOf("x")?"_x":"x";q.push({name:y,alias:y,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});y=-1!==q.indexOf("y")?"_y":"y";q.push({name:y,alias:y,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}u&&0<u.length?(w&&(u=F._getAttrsWithExpressionsBatch(u,g.arcadeExpressions)),l.resolve({data:u||[],outFields:q})):g.fromClient?(u=z.map(a.graphics,function(C){C=k?d(C):r.clone(C);return C=w?F._getAttrsWithExpressions(C,g.arcadeExpressions):
C}),l.resolve({data:u||[],outFields:q})):F._getExportDataFromServer(a,A,g).then(function(C){w&&(C=F._getAttrsWithExpressionsBatch(C,g.arcadeExpressions));l.resolve({data:C||[],outFields:q})});return l};F._getExportDataFromServer=function(a,g,l){var q=new m;if("esri.layers.FeatureLayer"!==a.declaredClass)return q.resolve([]),q;var A=new e(a.url),u=new c;u.where=l.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||"1\x3d1";0<g.length?(a=z.map(g,function(k){return k.name}),u.outFields=
a):u.outFields=["*"];u.objectIds=l.objectIds;u.returnGeometry=l.withGeometry;u.outSR=l.spatialReference;u.geometry=l.geometry;u.orderByFields=l.orderByFields;u.start=l.start;u.num=l.num;u.outSpatialReference=l.outSpatialReference;A.execute(u,function(k){k=z.map(k.features,function(w){return d(w)});q.resolve(k)},function(k){console.error(k);q.resolve([])});return q};F._formattedData=function(a,g,l){var q=new m,A=[],u=g.data;g=g.outFields;for(var k=0,w=u.length;k<w;k++){for(var y={},C=0;C<g.length;C++){var D=
g[C];y[D.name]=F._getExportValue(u[k][D.name],D,a.objectIdField,a.typeIdField,u[k][a.typeIdField],a.types,l)}A.push(y)}a=z.map(g,function(G){return{alias:G.alias,name:G.name}});q.resolve({datas:A,columns:a});return q};F._getExportValue=function(a,g,l,q,A,u,k){function w(T){if(C&&p.isDefined(C.fieldInfos))for(var K=0,O=C.fieldInfos.length;K<O;K++){var I=C.fieldInfos[K];if(I.fieldName===T)return I.format}return null}function y(T){for(var K=0,O=D.length;K<O;K++)if(D[K].fieldName===T)return!0;return!1}
var C=k.popupInfo,D=k.richText.fieldsToClear,G=!!g.domain&&k.formatCodedValue,H="esriFieldTypeDate"===g.type&&k.formatDate,L=l&&g.name===l;q=q&&g.name===q;y="esriFieldTypeString"===g.type&&k.richText.clearFormat&&y(g.name);return H?h.fieldFormatter.getFormattedDate(a,w(g.name)):q?h.fieldFormatter.getTypeName(a,u):G?h.fieldFormatter.getCodedValue(g.domain,a):y?a?(g=document.createElement("span"),g.innerHTML=a,g.textContent||g.innerText||""):a:G||H||L||q||y?a:(k=null,l&&u&&0<u.length&&(l=(l=z.filter(u,
function(T){return T.id===A}))&&l[0])&&l.domains&&l.domains[g.name]&&l.domains[g.name].codedValues&&(k=h.fieldFormatter.getCodedValue(l.domains[g.name],a)),null!==k?k:a)};F._getAttrsWithExpressions=function(a,g){var l=r.getObject("expressionInfos",!1,g);g=r.getObject("layerDefinition",!1,g);var q=new f(null,null,a);return b.customExpr.getAttributesFromCustomArcadeExpr(l,q,g)||a};F._getAttrsWithExpressionsBatch=function(a,g){var l=[];return l=z.map(a,function(q){return F._getAttrsWithExpressions(q,
g)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),function(F,r,z,x,n,v,t,m,h,p){var e={readExprInfo:{}};e.readExprInfo.getArcadeProfilesByType=function(c,f,b){c={map:c,layer:f};return"render"===b?e.readExprInfo._getArcadeRender(c):"label"===b?e.readExprInfo._getArcadeLabel(c):"infoTemplate"===b?e.readExprInfo._getArcadeInfoTemplate(c):
e.readExprInfo._getAllArcade(c)};e.readExprInfo._getArcadeRender=function(c){return e.readExprInfo._lookupArcadeRender({layers:e.readExprInfo._checkPassInLayer(c)})};e.readExprInfo._getArcadeInfoTemplate=function(c){return e.readExprInfo._lookupArcadeInfoTemplate({layers:e.readExprInfo._checkPassInLayer(c)})};e.readExprInfo._getArcadeLabel=function(c){return e.readExprInfo._lookupArcadeLabel({layers:e.readExprInfo._checkPassInLayer(c)})};e.readExprInfo._getAllArcade=function(c){var f=e.readExprInfo._getArcadeRender(c),
b=e.readExprInfo._getArcadeInfoTemplate(c);c=e.readExprInfo._getArcadeLabel(c);return{render:f,infoTemplate:b,label:c}};e.readExprInfo._checkPassInLayer=function(c){var f=[];return f="undefined"!==typeof c?"undefined"!==typeof c.layer?null!==c.layer&&""!==c.layer?e.readExprInfo._getAllMapLayers(c):e.readExprInfo._getAllMapLayers():e.readExprInfo._getAllMapLayers():e.readExprInfo._getAllMapLayers()};e.readExprInfo._getAllMapLayers=function(c){var f="",b=[],d=p.getInstance();c&&c.layer&&(f=c.layer.id);
""!==f?(c=d.getNodeById(f))&&b.push(c._layerInfo.layerObject):d.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&b.push(a._layerInfo.layerObject):b.push(a._layerInfo.layerObject)});return b};e.readExprInfo._lookupArcadeRender=function(c){var f=[];0<c.layers.length&&F.forEach(c.layers,r.hitch(this,function(b){var d={};if("undefined"!==typeof b.renderer){var a=b.renderer;"undefined"!==typeof a.valueExpression&&(d.layer=b.id,
d.valueExpression=a.valueExpression,d.valueExpressionTitle=a.valueExpressionTitle,"undefined"!==typeof a.values&&(d.values=a.values),"undefined"!==typeof a.visualVariables&&(d.visualVariables=a.visualVariables));1<Object.keys(d).length&&d.constructor===Object?f.push(d):f.push({layer:b.id,valueExpression:null,valueExpressionTitle:null,values:null,visualVariables:null})}}));return f};e.readExprInfo._lookupArcadeInfoTemplate=function(c){var f=[];0<c.layers.length&&F.forEach(c.layers,r.hitch(this,function(b){var d=
{};if("undefined"!==typeof b.infoTemplate)"undefined"!==typeof b.infoTemplate.info.expressionInfos&&0<b.infoTemplate.info.expressionInfos.length&&(d.layer=b.id,d.expressionInfos=b.infoTemplate.info.expressionInfos);else if("undefined"!==typeof b.infoTemplates)for(var a in b.infoTemplates)if(b.infoTemplates.hasOwnProperty(a)&&"undefined"!==typeof b.infoTemplates[a].infoTemplate.info.expressionInfos){var g=b.infoTemplates[a].infoTemplate;0<g.info.expressionInfos.length&&(d.layer=b.id,d.expressionInfos=
g.info.expressionInfos)}1<Object.keys(d).length&&d.constructor===Object?f.push(d):f.push({layer:b.id,expressionInfos:null})}));return f};e.readExprInfo._lookupArcadeLabel=function(c){var f=[];0<c.layers.length&&F.forEach(c.layers,r.hitch(this,function(b){var d={};"undefined"!==typeof b.labelingInfo&&F.forEach(b.labelingInfo,r.hitch(this,function(a){"undefined"!==typeof a.name&&(d.layer=b.id,d.name=a.name,d.labelingInfo=a,d.expression=a.labelExpressionInfo.expression)}));1<Object.keys(d).length&&d.constructor===
Object?f.push(d):f.push({layer:b.id,name:null,labelingInfo:null,expression:null})}));return f};e.customExpr={};e.customExpr.getAttributesFromCustomArcadeExpr=function(c,f,b){c=e.InfoTemplate._parseArcadeExpressions(c);return e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(f,c,b)};e.customExpr.getAttributesValueFromCustomArcadeExprBatch=function(c,f,b){var d=[],a;for(a in f)d.push(f[a]);f=e.InfoTemplate._parseArcadeExpressions(c);c=e.InfoTemplate._getExprNamesArrayFromPopupExprInfos(c);
c.relationships=null;c.parsedExpressions=f;var g=new z;e.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,c,b).then(function(l){g.resolve(l)});return g};e.InfoTemplate={};e.InfoTemplate.getAttributesFromInfoTemplate=function(c,f,b){var d={fields:[]};f.layerObject&&f.layerObject.fields&&(d.fields=f.layerObject.fields);c=e.readExprInfo.getArcadeProfilesByType(c,f,"infoTemplate")[0].expressionInfos;if(!c)return b.attributes;c=e.InfoTemplate._parseArcadeExpressions(c);return e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,
c,d)};e.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(c,f,b){var d={fields:[]};f.layerObject&&f.layerObject.fields&&(d.fields=f.layerObject.fields);var a=[];for(l in b)a.push(b[l]);c=e.readExprInfo.getArcadeProfilesByType(c,f,"infoTemplate")[0].expressionInfos;var g=new z;if(!c)return g.resolve([]),g;b=e.InfoTemplate._parseArcadeExpressions(c);var l=null;l=f.getPopupInfo().description;null!==l?(l=e.InfoTemplate._convertPopupDescToFieldNamesArray(l),l.relationships=e.InfoTemplate._getRelationshipQueries(f)):
(l=e.InfoTemplate._getExprNamesArrayFromPopupExprInfos(c),l.relationships=null);l.parsedExpressions=b;e.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(a,l,d).then(function(q){g.resolve(q)});return g};e.InfoTemplate._getRelationshipQueries=function(c){var f=!1,b={},d=/\d+/,a;if(a=c.getPopupInfo().description.match(/\{relationships\/\d+\//gm))f=!0,F.forEach(a,function(g){var l=g.match(d)[0];b.hasOwnProperty(l)||(g=new m,g.outFields=["*"],g.relationshipId=l,g.returnGeometry=!1,b[l]={operLayer:c,
relatedQuery:g})});return f?b:null};e.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(c){var f=[],b;for(b in c)f.push("${expression/"+c[b].name+"}");return f};e.InfoTemplate._convertPopupDescToFieldNamesArray=function(c){c=e.InfoTemplate._convertEndParasToEOLs(c);c=e.InfoTemplate._convertBreaksToEOLs(c);c=e.InfoTemplate._sanitizeNoTags(c).trim();c=c.replace(/\{/gi,"${");c=c.replace(/\u00a0/gi," ");c=c.split("\n");return c=F.map(c,function(f){return f.trim()})};e.InfoTemplate._sanitizeNoTags=
function(c){var f=h.sanitizeHTML(c);c=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;do{var b=f;f=f.replace(c,"")}while(f!==b);return f=f.replace(/</g,"\x26lt;")};e.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=function(c,f,b){var d=new z,a=[],g=[],l=0;f.relationships?(F.forEach(c,function(q){e.InfoTemplate._objEach(f.relationships,function(A,u){var k=new z,
w=A.relatedQuery;g.push(k);var y=q.attributes[A.operLayer.layerObject.objectIdField];w.objectIds=[y];A.operLayer.layerObject.queryRelatedFeatures(w,function(C){var D=[];C[y]&&C[y].features&&(C=C[y].features,F.forEach(C,function(G){var H=[],L;var T=q.attributes;var K="relationships/"+u+"/";e.InfoTemplate._objEach(G.attributes,function(O,I){L=K+I;T[L]=O});F.forEach(f,function(O){H.push(n.substitute(O,e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(q,f.parsedExpressions,b),e.InfoTemplate._useEmptyStringForNull))});
D.push(H)}));k.resolve(D)})})}),x(g).then(function(q){F.forEach(q,function(A){F.forEach(A,function(u){++l;a.push(u)})});console.log(l+" related address features found");d.resolve(a)})):(F.forEach(c,function(q){var A=[];F.forEach(f,function(u){A.push(n.substitute(u,e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(q,f.parsedExpressions,b),e.InfoTemplate._useEmptyStringForNull))});a.push(A)}),d.resolve(a));return d};e.InfoTemplate._parseArcadeExpressions=function(c){if(Array.isArray(c)&&
0<c.length){var f={};F.forEach(c,function(b){f[b.name]=v.parseScript(b.expression)})}return f};e.InfoTemplate._initArcadeContext=function(c,f){var b={vars:{}};b.vars.$feature=t.createFromGraphicLikeObject(c.geometry,c.attributes,f);return b};e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(c,f,b){var d;var a=r.mixin({},c.attributes);if(f)for(d in c=e.InfoTemplate._initArcadeContext(c,b),f)b=v.executeScript(f[d],c),a["expression/"+d]=b?b.toString():"";return a};e.InfoTemplate._convertEndParasToEOLs=
function(c){var f=c;c=c.match(/<\/p>/gi);F.forEach(c,function(b){f=f.replace(b,"\n")});return f};e.InfoTemplate._convertBreaksToEOLs=function(c){var f=c;c=c.match(/<br\s*\/?>/gi);F.forEach(c,function(b){f=f.replace(b,"\n")});return f};e.InfoTemplate._useEmptyStringForNull=function(c){return c?c:""};e.InfoTemplate._objEach=function(c,f,b){for(var d in c)c.hasOwnProperty(d)&&f.call(b,c[d],d)};return e})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),
function(F,r,z,x,n,v){var t=F([n],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(h){this._layerInfos=h;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getBasemapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getBasemapLayerInfoArray())},
getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(h){var p=null;if(h=this._layerInfos.addTable(h))p=h._adaptor;return p},removeTable:function(h){(h=this.getNodeById(h))&&this._layerInfos.removeTable(h._layerInfo)},_traversal:function(h,p){for(var e=0;e<p.length;e++)if(p[e].traversal(h))return!0;
return!1},traversal:function(h){return this._traversal(h,this.getLayerNodes().concat(this.getBasemapLayerNodes().concat(this.getTableNodes())))},traversalWithNodes:function(h,p){return this._traversal(h,p)},getNodeById:function(h){var p=null;this.traversal(function(e){if(e.id===h)return p=e,!0});return p},getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(h){this._layerInfos.restoreState(h)},destroy:function(){r.forEach(this._eventHandles,function(h){h.remove()});
this.inherited(arguments)},_getNodesArrayFromInfosArray:function(h){var p=[];r.forEach(h,function(e){p.push(e._adaptor)},this);return p},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(h){console.warn(h)}},_bindEvents:function(){var h=x(this._layerInfos,"layerInfosChanged",z.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(h);h=x(this._layerInfos,"basemapLayerInfosChanged",z.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(h);h=x(this._layerInfos,
"tableInfosChanged",z.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosReorder",z.hitch(this,this._onLayerReordered));this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosIsShowInMapChanged",z.hitch(this,this._onVisibilityChanged));this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosIsVisibleChanged",z.hitch(this,this._onToggleChanged));this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosFilterChanged",z.hitch(this,this._onFilterChanged));
this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosRendererChanged",z.hitch(this,this._onRendererChanged));this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosOpacityChanged",z.hitch(this,this._onOpacityChanged));this._eventHandles.push(h);h=x(this._layerInfos,"layerInfosTimeExtentChanged",z.hitch(this,this._onTimeExtentChanged));this._eventHandles.push(h)},_onLayerNodesStructureChanged:function(h,p,e){this._emitEvent(t.EVENT_STRUCTURE_CHANGE,{type:p,layerNodes:[e._adaptor],rootLayerNodes:[h._adaptor]})},
_onTableNdoesStructureChanged:function(h,p){h=this._getNodesArrayFromInfosArray(h);this._emitEvent(t.EVENT_STRUCTURE_CHANGE,{type:p,layerNodes:h,rootLayerNodes:h})},_onLayerReordered:function(h,p){h=h?[h._adaptor]:[];this._emitEvent(t.EVENT_STRUCTURE_CHANGE,{type:p,layerNodes:h,rootLayerNodes:h})},_onVisibilityChanged:function(h){h={layerNodes:this._getNodesArrayFromInfosArray(h)};this._emitEvent(t.EVENT_VISIBILITY_CHANGE,h)},_onToggleChanged:function(h){h={layerNodes:this._getNodesArrayFromInfosArray(h)};
this._emitEvent(t.EVENT_TOOGLE_CHANGE,h)},_onFilterChanged:function(h){h={layerNodes:this._getNodesArrayFromInfosArray(h)};this._emitEvent(t.EVENT_FILTER_CHANGE,h)},_onRendererChanged:function(h){h={layerNodes:this._getNodesArrayFromInfosArray(h)};this._emitEvent(t.EVENT_RENDERER_CHANGE,h)},_onOpacityChanged:function(h){h={layerNodes:this._getNodesArrayFromInfosArray(h)};this._emitEvent(t.EVENT_OPACITY_CHANGE,h)},_onTimeExtentChanged:function(h){h={layerNodes:this._getNodesArrayFromInfosArray(h)};
this._emitEvent(t.EVENT_TIME_EXTENT_CHANGE,h)}}),m=null;t.getInstance=function(){m&&m._layerInfos._objectId===v.getInstanceSync()._objectId||(m&&m.destroy(),m=new t(v.getInstanceSync()));return m};t.createInstance=function(h){return new t(v.createInstance(h))};z.mixin(t,{STRUCTURE_CHANGE_ADD:v.ADDED,STRUCTURE_CHANGE_REMOVE:v.REMOVED,STRUCTURE_CHANGE_SUBNODE_ADD:v.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:v.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:v.UPDATED,STRUCTURE_CHANGE_REORDER:v.REORDERED,
EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return t})},"jimu/GeojsonConverters":function(){define([],function(){function F(t){a:{var m=t[0];for(var h=0;h<m.length;h++)if(m[h]!==t[t.length-1][h]){m=!1;break a}m=!0}m||t.push(t[0]);return t}function r(t){var m=0,
h=0,p=t.length,e=t[h];for(h;h<p-1;h++){var c=t[h+1];m+=(c[0]-e[0])*(c[1]+e[1]);e=c}return 0<=m}function z(t,m){for(var h=0;h<t.length-1;h++)for(var p=0;p<m.length-1;p++){a:{var e=t[h],c=t[h+1],f=m[p],b=m[p+1],d=(b[0]-f[0])*(e[1]-f[1])-(b[1]-f[1])*(e[0]-f[0]);var a=(c[0]-e[0])*(e[1]-f[1])-(c[1]-e[1])*(e[0]-f[0]);e=(b[1]-f[1])*(c[0]-e[0])-(b[0]-f[0])*(c[1]-e[1]);if(0!==e&&(d/=e,a/=e,0<=d&&1>=d&&0<=a&&1>=a)){a=!0;break a}a=!1}if(a)return!0}return!1}function x(t){var m=[];t=t.slice(0);var h=F(t.shift().slice(0));
if(4<=h.length)for(r(h)||h.reverse(),m.push(h),h=0;h<t.length;h++){var p=F(t[h].slice(0));4<=p.length&&(r(p)&&p.reverse(),m.push(p))}return m}function n(t){var m={},h;for(h in t)t.hasOwnProperty(h)&&(m[h]=t[h]);return m}var v={arcgisToGeoJSON:function(t,m){var h={};"number"===typeof t.x&&"number"===typeof t.y&&(h.type="Point",h.coordinates=[t.x,t.y]);t.points&&(h.type="MultiPoint",h.coordinates=t.points.slice(0));t.paths&&(1===t.paths.length?(h.type="LineString",h.coordinates=t.paths[0].slice(0)):
(h.type="MultiLineString",h.coordinates=t.paths.slice(0)));if(t.rings){var p=t.rings.slice(0);h=[];var e=[],c,f;for(f=0;f<p.length;f++){var b=F(p[f].slice(0));4>b.length||(r(b)?h.push([b]):e.push(b))}for(b=[];e.length;){f=e.pop();var d=!1;for(p=h.length-1;0<=p;p--){var a=c=h[p][0],g=f;c=z(a,g);g=g[0];for(var l=!1,q=-1,A=a.length,u=A-1;++q<A;u=q)(a[q][1]<=g[1]&&g[1]<a[u][1]||a[u][1]<=g[1]&&g[1]<a[q][1])&&g[0]<(a[u][0]-a[q][0])*(g[1]-a[q][1])/(a[u][1]-a[q][1])+a[q][0]&&(l=!l);a=l;if(!c&&a){h[p].push(f);
d=!0;break}}d||b.push(f)}for(;b.length;){f=b.pop();e=!1;for(p=h.length-1;0<=p;p--)if(c=h[p][0],z(c,f)){h[p].push(f);e=!0;break}e||h.push([f.reverse()])}h=1===h.length?{type:"Polygon",coordinates:h[0]}:{type:"MultiPolygon",coordinates:h}}if(t.geometry||t.attributes)h.type="Feature",h.geometry=t.geometry?v.arcgisToGeoJSON(t.geometry):null,h.properties=t.attributes?n(t.attributes):null,t.attributes&&(h.id=t.attributes[m]||t.attributes.OBJECTID||t.attributes.FID);return h},geojsonToArcGIS:function(t,
m){m=m||"OBJECTID";var h={wkid:4326},p={};switch(t.type){case "Point":p.x=t.coordinates[0];p.y=t.coordinates[1];p.spatialReference=h;break;case "MultiPoint":p.points=t.coordinates.slice(0);p.spatialReference=h;break;case "LineString":p.paths=[t.coordinates.slice(0)];p.spatialReference=h;break;case "MultiLineString":p.paths=t.coordinates.slice(0);p.spatialReference=h;break;case "Polygon":p.rings=x(t.coordinates.slice(0));p.spatialReference=h;break;case "MultiPolygon":m=p;t=t.coordinates.slice(0);for(var e=
[],c=0;c<t.length;c++)for(var f=x(t[c]),b=f.length-1;0<=b;b--){var d=f[b].slice(0);e.push(d)}m.rings=e;p.spatialReference=h;break;case "Feature":t.geometry&&(p.geometry=v.geojsonToArcGIS(t.geometry,m));p.attributes=t.properties?n(t.properties):{};t.id&&(p.attributes[m]=t.id);break;case "FeatureCollection":p=[];for(h=0;h<t.features.length;h++)p.push(v.geojsonToArcGIS(t.features[h],m));break;case "GeometryCollection":for(p=[],h=0;h<t.geometries.length;h++)p.push(v.geojsonToArcGIS(t.geometries[h],m))}return p}};
return v})},"libs/polyfills/FileSaver":function(){(function(F,r){"function"==typeof define&&define.amd?define([],r):"undefined"!=typeof exports?r():(r(),F.FileSaver={})})(this,function(){function F(t,m){return"undefined"==typeof m?m={autoBom:!1}:"object"!=typeof m&&(console.warn("Depricated: Expected third argument to be a object"),m={autoBom:!m}),m.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function r(t,
m,h){var p=new XMLHttpRequest;p.open("GET",t);p.responseType="blob";p.onload=function(){v(p.response,m,h)};p.onerror=function(){console.error("could not download file")};p.send()}function z(t){var m=new XMLHttpRequest;return m.open("HEAD",t,!1),m.send(),200<=m.status&&299>=m.status}function x(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(h){var m=document.createEvent("MouseEvents");m.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);t.dispatchEvent(m)}}var n="object"==typeof window&&
window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,v=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype?function(t,m,h){var p=n.URL||n.webkitURL,e=document.createElement("a");m=m||t.name||"download";e.download=m;e.rel="noopener";"string"==typeof t?(e.href=t,e.origin===location.origin?x(e):z(e.href)?r(t,m,h):x(e,e.target="_blank")):(e.href=p.createObjectURL(t),setTimeout(function(){p.revokeObjectURL(e.href)},
4E4),setTimeout(function(){x(e)},0))}:"msSaveOrOpenBlob"in navigator?function(t,m,h){if(m=m||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(F(t,h),m);else if(z(t))r(t,m,h);else{var p=document.createElement("a");p.href=t;p.target="_blank";setTimeout(function(){x(p)})}}:function(t,m,h,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),"string"==typeof t)return r(t,m,h);m="application/octet-stream"===t.type;h=/constructor/i.test(n.HTMLElement)||
n.safari;var e=/CriOS\/[\d]+/.test(navigator.userAgent);if((e||m&&h)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var d=c.result;d=e?d:d.replace(/^data:[^;]*;/,"data:attachment/file;");p?p.location.href=d:location=d;p=null};c.readAsDataURL(t)}else{var f=n.URL||n.webkitURL,b=f.createObjectURL(t);p?p.location=b:location.href=b;p=null;setTimeout(function(){f.revokeObjectURL(b)},4E4)}});n.saveAs=v.saveAs=v;"undefined"!=typeof module&&(module.exports=v)})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","../exportUtils"],function(F,r,z){return F(r,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(x){return 0<x.features.length&&x.features[0].geometry},onExecute:function(x){x=z.createDataSource({type:z.TYPE_FEATURESET,filename:"features",data:x});x.setFormat(z.FORMAT_FEATURESET);x.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(F,r,z){return F(r,
{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(x){return 0<x.features.length&&x.features[0].geometry},onExecute:function(x){x=z.createDataSource({type:z.TYPE_FEATURESET,filename:"features",data:x});x.setFormat(z.FORMAT_GEOJSON);x.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(F,r,z){return F(r,{iconClass:"icon-statistics",isFeatureSupported:function(x,n){return 1<
x.features.length&&n&&"esri.layers.GraphicsLayer"!==n.declaredClass&&0<this.getNumbericFields(n).length},onExecute:function(x,n){var v=new z;x={featureSet:x,layer:n,fieldNames:this.getNumbericFields(n).map(function(t){return t.name})};v.showContentAsPopup(x)},getNumbericFields:function(x){return x.fields.filter(function(n){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(n.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when jimu/dijit/formSelect esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){return F([r],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;z.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=x.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=
a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new c({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,g){if(d.isStatFromServer(this.statInfo)){var l=new f;l.placeAt(g);l.show()}d.getStatisticsResult(this.statInfo).then(z.hitch(this,function(q){l&&l.destroy();t(".esriAGOTableStatistics",g).remove();
q=this._createStatContent(q);x.place(q,g)}))},_getFieldAliaseFromStatInfo:function(a){var g=this.statInfo.featureSet;(g=g&&g.fieldAliases)&&"undefined"!==typeof g[a]?g=g[a]:this.statInfo.layer?(g=n.filter(this.statInfo.layer.fields,function(l){return l.name===a}),g=g[0]?g[0].alias:""):g=a;return g},_createFieldDom:function(a){if(1<this.statInfo.fieldNames.length){var g=x.create("div",{className:"header"},a);x.create("span",{innerHTML:this.nls.field+": "},g);var l=new p({options:this.statInfo.fieldNames.map(z.hitch(this,
function(q){return{value:q,label:this._getFieldAliaseFromStatInfo(q)}})),style:{width:"150px"},"aria-label":this.nls.field});this.own(v(l,"change",z.hitch(this,function(q){this.statInfo.fieldName=q;this._showOneFieldStatContent(this.statInfo,a)})));l.placeAt(g);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else g=x.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},
a);return g},_createStatContent:function(a){var g={},l="count sum min max ave stddev".split(" "),q;var A=x.create("div",{className:"esriAGOTableStatistics",innerHTML:""});x.create("div",{className:"hzLine",innerHTML:""},A);var u=x.create("table",{className:"attrTable",tabindex:"0",innerHTML:"",style:{cellpadding:0,cellspacing:0}},A);for(k in a)a.hasOwnProperty(k)&&(g[k.toLowerCase()]=a[k]);var k=g.countfield;var w=g.sumfield||"";var y=g.minfield||"";var C=g.maxfield||"";a=g.avgfield||"";g=g.stddevfield||
"";var D=x.create("tbody",{},u);var G=this;n.forEach([k,w,y,C,a,g],function(H,L){""!==H&&(q=x.create("tr",{valign:"top"},D),x.create("td",{"class":"attrName",innerHTML:G.nls[l[L]]},q),x.create("td",{"class":"attrValue",innerHTML:H},q))});x.create("div",{className:"break",innerHTML:""},A);return A}})})},"jimu/dijit/formSelect":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dojo/_base/array dojo/dom-construct dijit/form/Select".split(" "),function(F,r,z,x,n,
v,t,m){return F([m],{postCreate:function(){this.inherited(arguments);var h=this["aria-label"],p=this["aria-labelledby"];if(h&&"focusNode"!==h){var e='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+h+"\x3c/caption\x3e";h=r.toDom(e);t.place(h,this.domNode,"first")}else p?setTimeout(z.hitch(this,function(){var c=p.split(" "),f=[];v.forEach(c,function(b){(b=n("#"+b)[0])&&""!==b&&b.innerHTML&&f.push(b.innerHTML)});0<f.length&&(e='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+
f.join(" ")+"\x3c/caption\x3e",c=r.toDom(e),t.place(c,this.domNode,"first"))}),1E3):(this.setAttrs=function(){this.domNode.title="";var c=this.get("value");c&&(c=this.getOptions(c),this.domNode.title=c.label,r.setAttr(this.domNode,"aria-label",c.label))},this.setAttrs(),x(this,"change",z.hitch(this,this.setAttrs)))}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q){function A(k){return function(w){this._isLoaded?this.inherited(k,arguments):this.loadDropDown(m.hitch(this,k,w))}}var u=r("dijit.form._SelectMenu",f,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(k){k.preventDefault();k.stopPropagation()}))},focus:function(){var k=!1,w=this.parentWidget.value;
m.isArray(w)&&(w=w[w.length-1]);w&&F.forEach(this.parentWidget._getChildren(),function(y){y.option&&w===y.option.value&&(k=!0,this.focusChild(y,!1))},this);k||this.inherited(arguments)}});n=r("dijit.form.Select"+(p("dojo-bidi")?"_NoBidi":""),[e,c,g],{baseClass:"dijitSelect dijitValidationTextBox",templateString:q,_buttonInputDisabled:p("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var k=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=k?k:0].value)}this.dropDown=new u({id:this.id+"_menu",parentWidget:this});x.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(k){if(k.value||k.label){var w=m.hitch(this,"_setValueAttr",k);k=new b({option:k,label:("text"===this.labelType?(k.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):k.label)||this.emptyLabel,
onClick:w,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:k.disabled||!1});k.focusNode.setAttribute("role","option");return k}return new d({ownerDocument:this.ownerDocument})},_addOptionItem:function(k){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(k))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(k){}},focusChild:function(k){k&&this.set("value",
k.option)},_getFirst:function(){var k=this._getChildren();return k.length?k[0]:null},_getLast:function(){var k=this._getChildren();return k.length?k[k.length-1]:null},childSelector:function(k){return(k=l.byNode(k))&&k.getParent()==this.dropDown},onKeyboardSearch:function(k,w,y,C){k&&this.focusChild(k)},_loadChildren:function(k){if(!0===k)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{F.forEach(this._getChildren(),function(y){y.destroyRecursive()});
var w=new b({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(w)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(k){this.inherited(arguments);z.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(k){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(k){this._set("required",k);this.focusNode.setAttribute("aria-required",k);this._refreshState()},_setOptionsAttr:function(k){this._isLoaded=!1;this._set("options",k)},_setDisplay:function(k){k=("text"===this.labelType?(k||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):k)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+k+"\x3c/span\x3e"},validate:function(k){k=this.disabled||this.isValid(k);this._set("state",k?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",k?"false":"true");var w=k?"":this._missingMsg;w&&this.focused&&this._hasBeenBlurred?a.show(w,this.domNode,this.tooltipPosition,!this.isLeftToRight()):a.hide(this.domNode);this._set("message",w);return k},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);a.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=v.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(w){w.preventDefault();w.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var k=this._keyNavCodes;delete k[t.LEFT_ARROW];delete k[t.RIGHT_ARROW]},_setStyleAttr:function(k){this.inherited(arguments);
x.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(k){this._loadChildren(!0);this._isLoaded=!0;k()},destroy:function(k){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(k),delete this.dropDown);a.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){a.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
p("dojo-bidi")&&(n=r("dijit.form.Select",n,{_setDisplay:function(k){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));n._Menu=u;n.prototype._onContainerKeydown=A("_onContainerKeydown");n.prototype._onContainerKeypress=A("_onContainerKeypress");return n})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f){return n("dijit.form._FormSelectWidget",f,{multiple:!1,options:null,store:null,_setStoreAttr:function(b){this._created&&this._deprecatedSetStore(b)},query:null,_setQueryAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:b})},queryOptions:null,_setQueryOptionsAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:b})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(b){var d=this.options||[];if(null==b)return d;if(h.isArrayLike(b))return F.map(b,"return this.getOptions(item);",this);h.isString(b)&&(b={value:b});h.isObject(b)&&(F.some(d,function(a,g){for(var l in b)if(!(l in a)||a[l]!=b[l])return!1;b=g;return!0})||(b=-1));return 0<=b&&b<d.length?d[b]:null},addOption:function(b){F.forEach(h.isArrayLike(b)?b:[b],function(d){d&&h.isObject(d)&&this.options.push(d)},this);this._loadChildren()},removeOption:function(b){b=this.getOptions(h.isArrayLike(b)?
b:[b]);F.forEach(b,function(d){d&&(this.options=F.filter(this.options,function(a){return a.value!==d.value||a.label!==d.label}),this._removeOptionItem(d))},this);this._loadChildren()},updateOption:function(b){F.forEach(h.isArrayLike(b)?b:[b],function(d){var a=this.getOptions({value:d.value}),g;if(a)for(g in d)a[g]=d[g]},this);this._loadChildren()},setStore:function(b,d,a){m.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,d,a)},_deprecatedSetStore:function(b,d,a){var g=this.store;a=a||{};if(g!==b){for(var l;l=this._notifyConnections.pop();)l.remove();b.get||(h.mixin(b,{_oldAPI:!0,get:function(q){var A=new r;this.fetchItemByIdentity({identity:q,onItem:function(u){A.resolve(u)},onError:function(u){A.reject(u)}});return A.promise},query:function(q,A){var u=new r(function(){k.abort&&k.abort()});u.total=new r;var k=this.fetch(h.mixin({query:q,onBegin:function(w){u.total.resolve(w)},
onComplete:function(w){u.resolve(w)},onError:function(w){u.reject(w)}},A));return new c(u)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[z.after(b,"onNew",h.hitch(this,"_onNewItem"),!0),z.after(b,"onDelete",h.hitch(this,"_onDeleteItem"),!0),z.after(b,"onSet",h.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);a.query&&this._set("query",a.query);a.queryOptions&&this._set("queryOptions",a.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new r,this._queryRes=b.query(this.query,this.queryOptions),e(this._queryRes,h.hitch(this,function(q){if(this.sortByLabel&&!a.sort&&q.length)if(b.getValue)q.sort(x.createSortFunction([{attribute:b.getLabelAttributes(q[0])[0]}],b));else{var A=this.labelAttr;q.sort(function(u,k){return u[A]>k[A]?1:k[A]>
u[A]?-1:0})}a.onFetch&&(q=a.onFetch.call(this,q,a));F.forEach(q,function(u){this._addOptionForItem(u)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(h.hitch(this,function(u,k,w){k==w?this._onSetItem(u):(-1!=k&&this._onDeleteItem(u),-1!=w&&this._onNewItem(u))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:d);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(q):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),h.hitch(this,function(q){console.error("dijit.form.Select: "+q.toString());this.onLoadDeferred.reject(q)})));return g},_setValueAttr:function(b,d){this._onChangeActive||(d=null);if(this._loadingStore)this._pendingValue=b;else if(null!=b){b=h.isArrayLike(b)?F.map(b,function(l){return h.isObject(l)?l:{value:l}}):h.isObject(b)?[b]:[{value:b}];b=F.filter(this.getOptions(b),function(l){return l&&l.value});var a=this.getOptions()||[];this.multiple||b[0]&&b[0].value||!a.length||(b[0]=
a[0]);F.forEach(a,function(l){l.selected=F.some(b,function(q){return q.value===l.value})});a=F.map(b,function(l){return l.value});if("undefined"!=typeof a&&"undefined"!=typeof a[0]){var g=F.map(b,function(l){return l.label});this._setDisplay(this.multiple?g:g[0]);this.inherited(arguments,[this.multiple?a:a[0],d]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var b=F.map([].concat(this.get("selectedOptions")),function(d){return d&&"label"in d?d.label:d?d.value:null},this);return this.multiple?
b:b[0]},_setDisplayedValueAttr:function(b){this.set("value",this.getOptions("string"==typeof b?{label:b}:b))},_loadChildren:function(){this._loadingStore||(F.forEach(this._getChildren(),function(b){b.destroyRecursive()}),F.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var b=[].concat(this.value);if(b&&b[0]){var d=this;F.forEach(this._getChildren(),function(a){var g=F.some(b,function(l){return a.option&&
l===a.option.value});g&&!d.multiple&&(d.focusedChild=a);t.toggle(a.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),g);a.domNode.setAttribute("aria-selected",g?"true":"false")},this)}},_getValueFromOpts:function(){var b=this.getOptions()||[];if(!this.multiple&&b.length){var d=F.filter(b,function(a){return a.selected})[0];if(d&&d.value)return d.value;b[0].selected=!0;return b[0].value}return this.multiple?F.map(F.filter(b,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(b,d){d&&d.parent||this._addOptionForItem(b)},_onDeleteItem:function(b){this.removeOption({value:this.store.getIdentity(b)})},_onSetItem:function(b){this.updateOption(this._getOptionObjForItem(b))},_getOptionObjForItem:function(b){var d=this.store,a=this.labelAttr&&this.labelAttr in b?b[this.labelAttr]:d.getLabel(b);return{value:a?d.getIdentity(b):null,label:a,item:b}},_addOptionForItem:function(b){var d=this.store;d.isItemLoaded&&!d.isItemLoaded(b)?d.loadItem({item:b,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(b=this._getOptionObjForItem(b),this.addOption(b))},constructor:function(b){this._oValue=(b||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);v.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?p("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+m._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);z.after(this,"onChange",h.hitch(this,"_updateSelection"));var b=this.store;b&&(b.getIdentity||b.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(b,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var b;b=this._notifyConnections.pop();)b.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(F,r,z,x){return F("dijit.DropDownMenu",x,{templateString:z,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(n){this._moveToPopup(n);n.stopPropagation();n.preventDefault()},
_onLeftArrow:function(n){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else n.stopPropagation(),n.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){return r("dijit._MenuBase",[c,
d,b,f],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){n.toggle(this.domNode,"dijitMenuActive",a);n.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var g=e.byNode(a);return a.parentNode==this.containerNode&&
g&&g.focus},postCreate:function(){var a=this,g="string"==typeof this.childSelector?this.childSelector:v.hitch(this,"childSelector");this.own(m(this.containerNode,m.selector(g,t.enter),function(){a.onItemHover(e.byNode(this))}),m(this.containerNode,m.selector(g,t.leave),function(){a.onItemUnhover(e.byNode(this))}),m(this.containerNode,m.selector(g,p),function(l){a.onItemClick(e.byNode(this),l);l.stopPropagation()}),m(this.containerNode,m.selector(g,"focusin"),function(){a._onItemFocus(e.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,g,l,q){this.inherited(arguments);if(a&&(-1==q||a.popup&&1==q))this.onItemClick(a,g)},_keyboardSearchCompare:function(a,g){return a.shortcutKey?g==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,g){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),g=/^key/.test(g._origType||g.type)||0==g.clientX&&0==g.clientY,this._openItemPopup(a,
g)):(this.onExecute(),a._onClick?a._onClick(g):a.onClick(g))},_openItemPopup:function(a,g){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var l=a.popup;l.parentMenu=this;this.own(this._mouseoverHandle=m.once(l.domNode,"mouseover",v.hitch(this,"_onPopupHover")));var q=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){g&&q.focusChild(a);q._cleanUp()},onExecute:v.hitch(this,
"_cleanUp",!0),onClose:function(){q._mouseoverHandle&&(q._mouseoverHandle.remove(),delete q._mouseoverHandle)}},g);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(x.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return r("dijit._KeyNavContainer",[h,p,m],{connectKeyNavHandlers:function(e,c){var f=this._keyNavCodes={},b=v.hitch(this,"focusPrev"),d=v.hitch(this,"focusNext");F.forEach(e,function(a){f[a]=b});F.forEach(c,function(a){f[a]=d});f[n.HOME]=v.hitch(this,"focusFirstChild");f[n.END]=v.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){x.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);F.forEach(this.getChildren(),
v.hitch(this,"_startupChild"))},addChild:function(e,c){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=
t.byNode(e))&&e.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(F,r,z,x,n,v,t,m){return r("dijit._KeyNavMixin",m,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);z.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var h=this._keyNavCodes={};h[x.HOME]=n.hitch(this,"focusFirstChild");h[x.END]=n.hitch(this,
"focusLastChild");h[this.isLeftToRight()?x.LEFT_ARROW:x.RIGHT_ARROW]=n.hitch(this,"_onLeftArrow");h[this.isLeftToRight()?x.RIGHT_ARROW:x.LEFT_ARROW]=n.hitch(this,"_onRightArrow");h[x.UP_ARROW]=n.hitch(this,"_onUpArrow");h[x.DOWN_ARROW]=n.hitch(this,"_onDownArrow")}var p=this;h="string"==typeof this.childSelector?this.childSelector:n.hitch(this,"childSelector");this.own(v(this.domNode,"keypress",n.hitch(this,"_onContainerKeypress")),v(this.domNode,"keydown",n.hitch(this,"_onContainerKeydown")),v(this.domNode,
"focus",n.hitch(this,"_onContainerFocus")),v(this.containerNode,v.selector(h,"focusin"),function(e){p._onChildFocus(t.getEnclosingWidget(this),e)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(h,p){h&&(this.focusedChild&&h!==this.focusedChild&&this._onChildBlur(this.focusedChild),h.set("tabIndex",this.tabIndex),h.focus(p?"end":"start"))},_onContainerFocus:function(h){h.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){z.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(h){z.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(h){h&&h!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),h.set("tabIndex",this.tabIndex),this.lastFocused=h,this._set("focusedChild",h))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(h,p,e,c){h&&this.focusChild(h)},_keyboardSearchCompare:function(h,p){var e=h.domNode;h=(h.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,p.length).toLowerCase();return p.length&&h==p?-1:0},_isFormElement:function(h){return"INPUT"===h.tagName||"TEXTAREA"===h.tagName||"SELECT"===h.tagName||"BUTTON"===h.tagName},_onContainerKeydown:function(h){if(!this._isFormElement(document.activeElement)){var p=this._keyNavCodes[h.keyCode];p?(p(h,this.focusedChild),h.stopPropagation(),h.preventDefault(),this._searchString=""):h.keyCode!=x.SPACE||!this._searchTimer||
h.ctrlKey||h.altKey||h.metaKey||(h.stopImmediatePropagation(),h.preventDefault(),this._keyboardSearch(h," "))}},_onContainerKeypress:function(h){this._isFormElement(document.activeElement)||h.charCode<=x.SPACE||h.ctrlKey||h.altKey||h.metaKey||(h.preventDefault(),h.stopPropagation(),this._keyboardSearch(h,String.fromCharCode(h.charCode).toLowerCase()))},_keyboardSearch:function(h,p){var e=null,c,f=0;n.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=p;var b=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;c=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var d=this.focusedChild||null;if(1==b||!d)if(d=this._getNextFocusableChild(d,1),!d)return;b=d;do{var a=this._keyboardSearchCompare(d,c);a&&0==f++&&(e=d);if(-1==a){f=-1;break}d=this._getNextFocusableChild(d,1)}while(d&&d!=b)})();this.onKeyboardSearch(e,h,c,f)},_onChildBlur:function(){},_getNextFocusableChild:function(h,p){var e=
h;do{if(h)h=this._getNext(h,p);else if(h=this[0<p?"_getFirst":"_getLast"](),!h)break;if(null!=h&&h!=e&&h.isFocusable())return h}while(h!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(h,p){if(h)for(h=h.domNode;h;)if((h=h[0>p?"previousSibling":"nextSibling"])&&"getAttribute"in h){var e=t.byNode(h);if(e)return e}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){t=F("dijit.MenuItem"+(v("dojo-bidi")?"_NoBidi":""),[m,h,p,e],{templateString:c,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(f){this._set("label",f);var b="";var d=f.search(/{\S}/);if(0<=d){b=f.charAt(d+1);var a=f.substr(0,d);f=f.substr(d+3);d=a+b+f;f=a+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+f}else d=f;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=f;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(f){!f||"label"in this.params||this._set("label",f.innerHTML)},buildRendering:function(){this.inherited(arguments);z.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&z.set(this.accelKeyNode,"id",this.id+"_accel");r.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==v("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(f){}},_setSelected:function(f){x.toggle(this.domNode,
"dijitMenuItemSelected",f)},setLabel:function(f){n.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",f)},setDisabled:function(f){n.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",f)},_setDisabledAttr:function(f){this.focusNode.setAttribute("aria-disabled",f?"true":"false");this._set("disabled",f)},_setAccelKeyAttr:function(f){this.accelKeyNode&&(this.accelKeyNode.style.display=
f?"":"none",this.accelKeyNode.innerHTML=f,z.set(this.containerNode,"colSpan",f?"1":"2"));this._set("accelKey",f)}});v("dojo-bidi")&&(t=F("dijit.MenuItem",t,{_setLabelAttr:function(f){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return t})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(F,r){return F("dijit._Contained",null,{_getSibling:function(z){var x=this.getParent();return x&&x._getSiblingOfChild&&x._getSiblingOfChild(this,
"previous"==z?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var z=this.getParent();return z&&z.getIndexOfChild?z.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(F,r,z,x,n,v){return F("dijit.MenuSeparator",[z,x,n],{templateString:v,
buildRendering:function(){this.inherited(arguments);r.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(F,r,z,x){return F(r,{baseClass:"jimu-loading-indicator jimu-agol-loading",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&z.set(this.domNode,{display:"none"});
z.set(this.domNode,{width:"100%",height:"100%"});x.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&this.hidden&&(z.set(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(z.set(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),
function(F,r,z,x,n,v,t,m,h){function p(l){var q=new n;q.outFields=[l.fieldName];q.outStatistics=[];q.geometry=l.geometry;var A=c(l);F.forEach(A,function(u){var k=new z;k.statisticType=u;k.displayFeildName=l.fieldName;k.onStatisticField=l.fieldName;k.outStatisticFieldName=g[u];q.outStatistics.push(k)});q.where=l.filterExpression?l.filterExpression:l.layer.getDefinitionExpression()?l.layer.getDefinitionExpression():"1\x3d1";l.geometry&&(q.geometry=l.geometry);return(new x(l.layer.url)).execute(q).then(function(u){return u&&
u.features&&0<u.features.length?(u=u.features[0].attributes,d(l,u),u):[]})}function e(l){var q={countField:0,sumField:0},A=c(l),u=0,k=0;l.featureSet.features.forEach(function(y){var C=y.attributes[l.fieldName];null!==C&&"undefined"!==typeof C&&A.forEach(function(D){switch(D){case "count":q.countField++;break;case "sum":q.sumField+=C;break;case "min":q.minField="undefined"===typeof q.minField?C:Math.min(q.minField,C);break;case "max":q.maxField="undefined"===typeof q.maxField?C:Math.max(q.maxField,
C);break;case "avg":u++,k+=C}})});q.avgField=0===u?0:0===u?"":k/u;var w=l.featureSet.features.filter(function(y){y=y.attributes[l.fieldName];return null===y||"undefined"===typeof y?!1:!0}).map(function(y){return y.attributes[l.fieldName]});q.stddevField=f(w);d(l,q);return q}function c(l){return l.statisticTypes&&0<l.statisticTypes.length?a.filter(function(q){return-1<l.statisticTypes.indexOf(q)}):a}function f(l){var q=l.length;if(1>=q)return 0;var A=0;l.forEach(function(w){A+=w});var u=A/q,k=0;l.forEach(function(w){k+=
Math.pow(w-u,2)});return Math.sqrt(1/(q-1)*k)}function b(l){var q=m.getInstanceSync();return l.layer?q.getLayerOrTableInfoById(l.layer.id).loadInfoTemplate().then(function(A){var u={};A.info&&A.info.fieldInfos&&A.info.fieldInfos.forEach(function(k){u[k.fieldName]=k});return u}):r({})}function d(l,q){if(l.fieldInfos&&l.fieldInfos[l.fieldName])for(var A in q)"countField"!==A&&v.isDefined(q[A])&&(q[A]=null===q[A]||"undefined"===typeof q[A]?"":t.localizeNumberByFieldInfo(q[A],l.fieldInfos[l.fieldName]))}
var a="count sum min max avg stddev".split(" "),g={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};h.getStatisticsResult=function(l){return b(l).then(function(q){l.fieldInfos=q;if(l.featureSet)return r(e(l));if(l.layer){if(l.layer.url)return p(l);l.featureSet=t.toFeatureSet(l.layer.graphics);return r(e(l))}})};h.isStatFromServer=function(l){return l.layer&&l.layer.url};h.getStddevVal=f;h.getStatisticsResultFromClientSync=e})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f){return F(h,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(b,d){return 0<b.features.length&&b.features[0].geometry&&d&&d.geometryType&&d.fields&&d.objectIdField},onExecute:function(b,d){var a;b={layerDefinition:{geometryType:d.geometryType,fields:r.clone(d.fields),objectIdField:d.objectIdField},featureSet:b.toJson()};b=new v(b);(a=d._json?x.parse(d._json):null)&&a.drawingInfo&&a.drawingInfo.renderer?(a=a.drawingInfo.renderer,a=t.fromJson(a)):
a=t.fromJson(d.renderer.toJson());b.setRenderer(a);(d=d.getSelectionSymbol())&&b.setSelectionSymbol(m.fromJson(d.toJson()));this._popupAddLayer(b)},_popupAddLayer:function(b){var d=z.create("div",{style:"padding: 0 10px 0 10px;"}),a=(new e({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(d);z.setStyle(a.searchBtn,"display","none");var g=new p({content:d,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:r.hitch(this,
function(){b.name=f.stripHTML(a.getValue());this._addLayerToMap(b);g.close();l&&l.remove&&l.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:r.hitch(this,function(){g.close();l&&l.remove&&l.remove()})}]});a.inputSearch.focus();g.disableButton(0);var l=n(a.inputSearch,"keyup",function(){a.getValue()?g.enableButton(0):g.disableButton(0)})},_addLayerToMap:function(b){var d=c.getInstanceSync(),a=n(d,"layerInfosChanged",r.hitch(this,function(g){b.id===g.id&&(g.enablePopup(),
a.remove())}));this.map.addLayer(b)}})})},"jimu/dijit/Search":function(){define("dojo/_base/declare dojo/_base/html dojo/string dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(F,r,z,x,n,v){return F([n,v],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&r.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return z.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(t){this.doChange();(void 0!==t.keyCode?t.keyCode:t.which)===x.ENTER&&this.doSearch();t.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(F,r,z,x,n,v,t){return F(r,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(m){this._getMarkerLayer();return this._isSupportType(m)&&0<m.features.length&&m.features[0]&&m.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(m)},onExecute:function(m,h){this._addMarker(m,h)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new x({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var m=this.map.snappingManager.layerInfos;m.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(m)}},_addMarker:function(m,
h){var p=m.features[0].geometry,e={};h=h.displayField||m.displayFieldName||h.objectIdField;e.title="";m.features[0].attributes&&h&&(e.title=m.features[0].attributes[h],e.title||(e.title=""));h={};if("point"===p.type)h=p;else if("polygon"===p.type||"polyline"===p.type||"multipoint"===p.type)h=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:p.getExtent().getCenter();h.getLongitude()&&h.getLatitude()?(e.longitude=h.getLongitude(),e.latitude=h.getLatitude()):h.x&&h.y&&
(e.x=h.x,e.y=h.y);var c="";p&&p.spatialReference&&p.spatialReference.wkid&&(c=p.spatialReference.wkid);e.spatialReference={wkid:c};p=t.getXyContent(e);e=t.getShareUrl(this.map,e,!0);e=t.getShareUrlContent(e);e=p+e;p=new n(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");p.width=26;p.height=26;p.setOffset(0,p.height/2);h=new z(h,p,null,null);h._markerFeatureactionGraphic=m.features[0];h.infoTemplate=this._setInfoTemplate(e);this._markerLayer.add(h);this._closePopupWindow()},_setInfoTemplate:function(m){var h=
new v;h.setContent(m);return h},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(m){return m.features[0]&&m.features[0]._graphicsLayer&&m.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===m.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(m){if(m&&m.geometryType){if(m.features&&m.features.length&&1<m.features.length)return!1;m=m.geometryType;return"point"===m||"polygon"===m||"polyline"===
m||"multipoint"===m}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(F,r,z){return F(r,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(x){this._getMarkerLayer();return 0<x.features.length&&x.geometryType&&x.features[0]&&x.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(x)},onExecute:function(x){this._removeMarker(x)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new z({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var x=this.map.snappingManager.layerInfos;x.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(x)}},_removeMarker:function(x){x=x.features[0];x._textSymbol&&this._markerLayer.remove(x._textSymbol);this._markerLayer.remove(x);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(x){return x.features[0]&&
x.features[0]._graphicsLayer&&x.features[0]._graphicsLayer.id?"marker-feature-action-layer"===x.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils esri/IdentityManager jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){return F(c,{name:"SaveToMyContent",
iconClass:"icon-save",isFeatureSupported:function(d){return 0>=d.features.length||!d.features[0].geometry?!1:!0},onExecute:function(d,a){this.checkPrivilege().then(r.hitch(this,function(g){if(g)var l=new b({appConfig:this.appConfig}),q=new f({content:l,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:r.hitch(this,function(){l.showBusy();q.disableButton(0);l.validate().then(r.hitch(this,function(A){A.valid?this._addItem(d,
a,l):(l.hideBusy(),q.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:r.hitch(this,function(){q.close()})}]});else new e({message:window.jimuNls.noEditPrivileges})}))},checkPrivilege:function(){var d=h.getStandardPortalUrl(this.appConfig.portalUrl),a=m.getPortal(d);if(a){if(a.haveSignIn())return this._hasPrivilege(a);t.useSignInPage=!1;return a.signIn().then(r.hitch(this,function(){t.useSignInPage=!0;return this._hasPrivilege(a)}),r.hitch(this,function(){t.useSignInPage=
!0}))}d=new n;d.resolve(!1);return d},_hasPrivilege:function(d){return d.loadSelfInfo().then(r.hitch(this,function(a){if(a&&a.user){var g=new p({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&g.setPrivileges(a.user.privileges);return g.canCreateItem()&&g.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(d,a,g){var l=g.getName(),q=g.getFolderId(),A=g.popup;a=a||{};var u={name:a.name||a.id,type:a.type||"Feature Layer",displayField:a.displayField,
description:a.description,copyrightText:a.copyright,geometryType:a.geometryType||d.geometryType,fields:a.fields||d.fields,objectIdField:a.objectIdField};d.features[0].geometry&&(a=v.graphicsExtent(d.features),u.initialExtent=a,u.fullExtent=a,u.extent=a);!u.objectIdField&&u.fields&&z.some(u.fields,function(k){if("esriFieldTypeOID"===k.type)return u.objectIdField=k.name,!0});d={layers:[{layerDefinition:u,featureSet:d.toJson()}]};g.addItem({name:l,title:l,type:"Feature Collection",typeKeywords:"WAB_created",
text:x.stringify(d)},q).then(r.hitch(this,function(k){!0===k.success?A.close():(g.hideBusy(),A.enableButton(0),new e({message:k.error?k.error.message:""}))}),function(k){g.hideBusy();A.enableButton(0);new e({message:k.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e){return F([n,v,t],{baseClass:"jimu-item-form",templateString:m,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var c=p.getStandardPortalUrl(this.appConfig.portalUrl);h.getPortal(c).getUser().then(r.hitch(this,function(f){this.portalUser=f;return f.getContent()})).then(r.hitch(this,function(f){this.folderStore=this._createFolderStore(f.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var c=new x;this.itemForm.validate()?c.resolve({valid:!0}):
c.resolve({valid:!1,message:"param requried"});return c},addItem:function(c,f){if(this.portalUser)return this.portalUser.addItem(c,f);c=new x;c.resolve({error:{message:"portalUser is null"}});return c},_createFolderStore:function(c,f){var b=new e({data:{identifier:"id",label:"name",items:[]}});b.newItem({name:f,id:""});z.forEach(c,function(d){b.newItem({name:d.title,id:d.id})});return b}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox",
"./ComboBoxMixin"],function(F,r,z,x,n){return F("dijit.form.FilteringSelect",[x,n],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(v,t,m,h){t&&t[this.searchAttr]!==this._lastQuery||!t&&v.length&&this.store.getIdentity(v[0])!=this._lastQuery||(v.length?this.set("item",v[0],h):this.set("value",
"",h||void 0===h&&!this.focused,this.textbox.value,null))},_openResultList:function(v,t,m){t[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(v,t,m,h){this._onChangeActive||(t=null);if(void 0===h){if(null===v||""===v)if(v="",!r.isString(m)){this._setDisplayedValueAttr(m||"",t);return}var p=this;this._lastQuery=v;z(this.store.get(v),
function(e){p._callbackSetLabel(e?[e]:[],void 0,void 0,t)})}else this.valueNode.value=v,this.inherited(arguments,[v,t,m,h])},_setItemAttr:function(v,t,m){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(v){return v.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(v,t){null==v&&(v="");if(!this._created){if(!("displayedValue"in this.params))return;t=!1}if(this.store){this.closeDropDown();var m=r.clone(this.query),h=this._getDisplayQueryString(v);
if(this.store._oldAPI)var p=h;else p=this._patternToRegExp(h),p.toString=function(){return h};this._lastQuery=m[this.searchAttr]=p;this._lastDisplayedValue=this.textbox.value=v;this._set("displayedValue",v);var e=this,c={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};r.mixin(c,this.fetchProperties);this._fetchHandle=this.store.query(m,c);z(this._fetchHandle,function(f){e._fetchHandle=null;e._callbackSetLabel(f||[],m,c,t)},function(f){e._fetchHandle=null;e._cancelingQuery||console.error("dijit.form.FilteringSelect: "+
f.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(F,r,z,x){return F("dijit.form.MappedTextBox",x,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(n){return n.toString?n.toString():""},toString:function(){var n=this.filter(this.get("value"));return null!=
n?"string"==typeof n?n:this.serialize(n,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=z.place("\x3cinput type\x3d'hidden'"+(this.name&&!r("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(F,r,z,x,n,v,t,m,h){return F("dijit.form.ComboBoxMixin",[m,v],{dropDownClass:t,hasDownArrow:!0,templateString:h,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(p){this._set("hasDownArrow",p);this._buttonNode.style.display=p?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(p){p.get||x.mixin(p,{_oldAPI:!0,get:function(e){var c=new r;this.fetchItemByIdentity({identity:e,
onItem:function(f){c.resolve(f)},onError:function(f){c.reject(f)}});return c.promise},query:function(e,c){var f=new r(function(){b.abort&&b.abort()});f.total=new r;var b=this.fetch(x.mixin({query:e,onBegin:function(d){f.total.resolve(d)},onComplete:function(d){f.resolve(d)},onError:function(d){f.reject(d)}},c));return n(f)}});this._set("store",p)},postMixInProperties:function(){var p=this.params.store||this.store;p&&this._setStoreAttr(p);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var e=this.declaredClass;x.mixin(this.store,{getValue:function(c,f){z.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return c[f]},getLabel:function(c){z.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return c.name},fetch:function(c){z.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
x.hitch(this,function(f){(new f({objectStore:this})).fetch(c)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){r=r("dijit.form._AutoCompleterMixin",e,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(c){var f=0;if("number"==typeof c.selectionStart)f=c.selectionStart;else if(m("ie")){var b=c.ownerDocument.selection.createRange().duplicate();c=c.createTextRange();b.move("character",0);c.move("character",0);try{c.setEndPoint("EndToEnd",b),f=String(c.text).replace(/\r/g,"").length}catch(d){}}return f},_setCaretPos:function(c,f){f=parseInt(f);p.selectInputText(c,f,f)},_setDisabledAttr:function(c){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",c?"true":"false")},_onKey:function(c){if(!(32<=c.charCode)){var f=c.charCode||c.keyCode;if(f!=x.ALT&&f!=x.CTRL&&f!=x.META&&f!=x.SHIFT){var b=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!(c.altKey||c.ctrlKey||c.metaKey))switch(this._opened&&(d=b.getHighlightedOption()),f){case x.PAGE_DOWN:case x.DOWN_ARROW:case x.PAGE_UP:case x.UP_ARROW:this._opened&&this._announceOption(d);c.stopPropagation();c.preventDefault();break;case x.ENTER:if(d){if(d==
b.nextButton){this._nextSearch(1);c.stopPropagation();c.preventDefault();break}else if(d==b.previousButton){this._nextSearch(-1);c.stopPropagation();c.preventDefault();break}c.stopPropagation();c.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case x.TAB:f=this.get("displayedValue");if(b&&(f==b._messages.previousMessage||f==b._messages.nextMessage))break;d&&this._selectOption(d);case x.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(c){var f=this.focusNode;p.selectInputText(f,f.value.length);var b=this.ignoreCase?"toLowerCase":"substr";0==c[b](0).indexOf(this.focusNode.value[b](0))?(b=this.autoComplete?this._getCaretPos(f):f.value.length,b+1>f.value.length&&(f.value=c,p.selectInputText(f,b))):(f.value=c,p.selectInputText(f))},_openResultList:function(c,f,b){var d=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();c.length||0!=b.start?(this._nextSearch=this.dropDown.onPage=n.hitch(this,
function(a){c.nextPage(-1!==a);this.focus()}),this.dropDown.createOptions(c,b,n.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in b?(b.direction?this.dropDown.highlightFirstOption():b.direction||this.dropDown.highlightLastOption(),d&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(f[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var c=this.get("displayedValue"),f=this.dropDown;!f||c!=f._messages.previousMessage&&c!=f._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",c)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(c,f,b){var d="";c&&(b||(b=this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(c):b);this.set("value",d,f,b,c)},_announceOption:function(c){if(c){if(c==
this.dropDown.nextButton||c==this.dropDown.previousButton){var f=c.innerHTML;this.item=void 0;this.value=""}else{var b=this.dropDown.items[c.getAttribute("item")];f=(this.store._oldAPI?this.store.getValue(b,this.searchAttr):b[this.searchAttr]).toString();this.set("item",b,!1,f)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",z.get(c,"id"));this._autoCompleteText(f)}},_selectOption:function(c){this.closeDropDown();c&&
this._announceOption(c);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(c){if(!this.dropDown){var f=this.id+"_popup";this.dropDown=new (n.isString(this.dropDownClass)?n.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:n.hitch(this,
this._selectOption),id:f,dir:this.dir,textDir:this.textDir})}this._lastInput=c;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new h({},this.srcNodeRef),!("value"in this.params))){var c=this.item=this.store.fetchSelectedItem();if(c){var f=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(c,f):c[f]}}},postCreate:function(){var c=v('label[for\x3d"'+
this.id+'"]');c.length&&(c[0].id||(c[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",c[0].id));this.inherited(arguments);F.after(this,"onSearch",n.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(c){c=this.labelFunc(c,this.store);var f=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(c=this.doHighlight(c,this._lastInput),f="html");return{html:"html"==f,label:c}},doHighlight:function(c,f){var b=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),d=this.queryExpr.indexOf("${0}");f=t.escapeString(f);return this._escapeHtml(c.replace(new RegExp((0==d?"^":"")+"("+f+")"+(d==this.queryExpr.length-4?"$":""),b),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(c){return c=String(c).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(c,f){return(f._oldAPI?f.getValue(c,this.labelAttr||this.searchAttr):c[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(c,f,b,d){this._set("item",d||null);null==c&&(c="");this.inherited(arguments)}});m("dojo-bidi")&&r.extend({_setTextDirAttr:function(c){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",c)}});return r})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(F,r,z,x,n,v){function t(m){return{id:m.value,value:m.value,name:z.trim(m.innerText||m.textContent||"")}}return F("dijit.form.DataList",n,{constructor:function(m,h){this.domNode=r.byId(h);z.mixin(this,m);this.id&&v.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:x("option",this.domNode).map(t)}])},destroy:function(){v.remove(this.id)},fetchSelectedItem:function(){var m=x("\x3e option[selected]",this.domNode)[0]||x("\x3e option",this.domNode)[0];return m&&t(m)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(F,r,z,x,n,v,t){return F("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(m){this._set("list",m)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(m){return new RegExp("^"+m.replace(/(\\.)|(\*)|(\?)|\W/g,function(h,p,e,c){return e?".*":
c?".":p?p:"\\"+h})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(m){if(!this.disabled&&
!this.readOnly){m=m.charOrCode;this._prev_key_backspace=!1;if(m==r.DELETE||m==r.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(m){this._abortQuery();var h=this,p=z.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},c=n.substitute(this.queryExpr,
[m.replace(/([\\\*\?])/g,"\\$1")]),f=function(){var d=h._fetchHandle=h.store.query(p,e);h.disabled||h.readOnly||b!==h._lastQuery||v(d,function(a){h._fetchHandle=null;h.disabled||h.readOnly||b!==h._lastQuery||v(d.total,function(g){a.total=g;var l=h.pageSize;if(isNaN(l)||l>a.total)l=a.total;a.nextPage=function(q){e.direction=q=!1!==q;e.count=l;q?(e.start+=a.length,e.start>=a.total&&(e.count=0)):(e.start-=l,0>e.start&&(e.count=Math.max(l+e.start,0),e.start=0));0>=e.count?(a.length=0,h.onSearch(a,p,e)):
f()};h.onSearch(a,p,e)})},function(a){h._fetchHandle=null;h._cancelingQuery||console.error(h.declaredClass+" "+a.toString())})};z.mixin(e,this.fetchProperties);if(this.store._oldAPI)var b=c;else b=this._patternToRegExp(c),b.toString=function(){return c};this._lastQuery=p[this.searchAttr]=b;this._queryDeferHandle=this.defer(f,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var m=this.list;m&&(this.store=t.byId(m))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(F,r,z,x,n,v,t,m){return F("dijit.form._ComboBoxMenu",[n,v,m,t],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(r.add(this.previousButton,"dijitMenuItemRtl"),r.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var h=this.ownerDocument.createElement("div");h.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");h.setAttribute("role","option");return h},onHover:function(h){r.add(h,"dijitMenuItemHover")},onUnhover:function(h){r.remove(h,
"dijitMenuItemHover")},onSelect:function(h){r.add(h,"dijitMenuItemSelected")},onDeselect:function(h){r.remove(h,"dijitMenuItemSelected")},_page:function(h){var p=0,e=this.domNode.scrollTop,c=z.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();p<c;){var f=this.getHighlightedOption();if(h){if(!f.previousSibling||"none"==f.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!f.nextSibling||"none"==f.nextSibling.style.display)break;this.selectNextNode()}f=
this.domNode.scrollTop;p+=(f-e)*(h?-1:1);e=f}},handleKey:function(h){switch(h.keyCode){case x.DOWN_ARROW:return this.selectNextNode(),!1;case x.PAGE_DOWN:return this._page(!1),!1;case x.UP_ARROW:return this.selectPreviousNode(),!1;case x.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(F,r,z,x,n){var v=r("dijit.form._ComboBoxMenuMixin"+
(x("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=n.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(t){this._set("value",t);this.onChange(t)},onClick:function(t){if(t==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(t==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(t)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(t,m){var h=this._createMenuItem();t=m(t);t.html?h.innerHTML=t.label:h.appendChild(h.ownerDocument.createTextNode(t.label));""==h.innerHTML&&(h.innerHTML="\x26#160;");return h},createOptions:function(t,m,h){this.items=t;this.previousButton.style.display=0==m.start?"none":"";z.set(this.previousButton,"id",this.id+
"_prev");F.forEach(t,function(e,c){e=this._createOption(e,h);e.setAttribute("item",c);z.set(e,"id",this.id+c);this.nextButton.parentNode.insertBefore(e,this.nextButton)},this);var p=!1;t.total&&!t.total.then&&-1!=t.total?m.start+m.count<t.total?p=!0:m.start+m.count>t.total&&m.count==t.length&&(p=!0):m.count==t.length&&(p=!0);this.nextButton.style.display=p?"":"none";z.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var t=this.containerNode;2<t.childNodes.length;)t.removeChild(t.childNodes[t.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});x("dojo-bidi")&&(v=r("dijit.form._ComboBoxMenuMixin",
v,{_createOption:function(){var t=this.inherited(arguments);this.applyTextDir(t);return t}}));return v})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(F,r,z,x){return F("dijit.form._ListMouseMixin",x,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(n,v){this._setSelectedAttr(v,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(v)})},_onMouseDown:function(n,v){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(v,!1)},_onMouseUp:function(n,v){this._isDragging=!1;var t=this.selected,m=this._hoveredNode;t&&v==t?this.defer(function(){this._onClick(n,
t)}):m&&this.defer(function(){this._onClick(n,m)})},_onMouseOut:function(n,v){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(n,v){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=v;this.onHover(v);this._isDragging&&this._setSelectedAttr(v,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(F,r,z){return F("dijit.form._ListBase",null,{selected:null,_listConnect:function(x,n){var v=this;return v.own(r(v.containerNode,r.selector(function(t,m,h){return t.parentNode==h},x),function(t){v[n](t,this)}))},selectFirstNode:function(){for(var x=this.containerNode.firstChild;x&&"none"==x.style.display;)x=x.nextSibling;this._setSelectedAttr(x,!0)},selectLastNode:function(){for(var x=this.containerNode.lastChild;x&&"none"==x.style.display;)x=x.previousSibling;this._setSelectedAttr(x,
!0)},selectNextNode:function(){var x=this.selected;if(x){for(x=x.nextSibling;x&&"none"==x.style.display;)x=x.nextSibling;x?this._setSelectedAttr(x,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var x=this.selected;if(x){for(x=x.previousSibling;x&&"none"==x.style.display;)x=x.previousSibling;x?this._setSelectedAttr(x,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(x,n){if(this.selected!=x){var v=this.selected;if(v)this.onDeselect(v);
x&&(n&&z.scrollIntoView(x),this.onSelect(x));this._set("selected",x)}else if(x)this.onSelect(x)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(F,r,z,x,n){return F([r,z],{baseClass:"jimu-loading-shelter jimu-agol-loading",declaredClass:"jimu.dijit.LoadingShelter",templateString:x,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=
window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&n.setStyle(this.domNode,"display","none");n.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||n.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(v){this.domNode&&this.hidden&&("string"===typeof v&&(this.textNode.innerHTML=v),n.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&
!this.hidden&&(n.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array jimu/accessibleUtils dojo/on dojo/keys dijit/a11yclick dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f){var b=null,d=F([p,e],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv role\x3d"title" class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode" tabindex\x3d"0"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._setFocusedNodeBeforeOpen();this.inherited(arguments);this.hide();this.menuItems=[];this.own(v(this.domNode,"click",z.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||r.isDescendant(a,this.menuNode)||this.hide()})));this._a11y_addEvents()},_setFocusedNodeBeforeOpen:function(){this.focusedNodeBeforeOpen=document.activeElement},_a11y_addEvents:function(){this.own(v(this.labelNode,"keydown",z.hitch(this,function(a){a.shiftKey&&a.keyCode===t.TAB&&(a.preventDefault(),
this.hide())})));this.own(v(this.closeBtn,m,z.hitch(this,this.hide)));this.own(v(this.menuContent,"focus",z.hitch(this,function(){this.currentMenuItem=this.menuItems[0].domNode;x.forEach(this.menuItems,function(a){r.hasClass(a.domNode,"selected")&&(this.currentMenuItem=a.domNode)});this.currentMenuItem.focus()})));this.own(v(this.menuContent,"keydown",z.hitch(this,function(a){a.keyCode===t.ESCAPE&&(a.stopPropagation(),this.hide());if(r.hasClass(a.target,"popup-menu-item"))if(a.keyCode!==t.TAB||(!a.shiftKey||
this.hasTitle)&&a.shiftKey){if(a.keyCode===t.DOWN_ARROW)var g=this.currentMenuItem.nextSibling?this.currentMenuItem.nextSibling:this.currentMenuItem;else a.keyCode===t.UP_ARROW?g=this.currentMenuItem.previousSibling?this.currentMenuItem.previousSibling:this.currentMenuItem:a.keyCode===t.HOME?g=this.menuItems[0].domNode:a.keyCode===t.END&&(g=this.menuItems[this.menuItems.length-1].domNode);g&&(this.currentMenuItem=g,g.focus())}else a.preventDefault(),this.hide()})))},setActions:function(a){this.clearActions();
x.forEach(a,z.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];r.empty(this.menuContent)},_addMenuItem:function(a){var g=new f({action:a});r.place(g.domNode,this.menuContent);g.startup();this.menuItems.push(g);this.own(v(g,"click",z.hitch(this,function(l){l?(l=0<=["ShowStatistics","SaveToMyContent","ChangeSymbol"].indexOf(g.action.name),n.isInNavMode()&&l||this.hide()):this.hide()})))},markAsSelected:function(a){x.forEach(this.menuItems,
function(g){g.action.label===a.label?g.setSelected(!0):g.setSelected(!1)})},prepareActions:function(a,g){return c.getInstance().getSupportedActions(a).then(z.hitch(this,function(l){!1===g&&(l=x.filter(l,function(q){return 0!==q.name.indexOf("Export")&&"SaveToMyContent"!==q.name}));x.forEach(l,function(q){q.data=a},this);this.setActions(l)}))},hide:function(){r.setStyle(this.domNode,"display","none");this.focusedNodeBeforeOpen&&this.focusedNodeBeforeOpen.focus()},show:function(a,g){if(0===this.menuItems.length)r.setStyle(this.domNode,
"display","none");else{"string"===typeof g&&""!==g?(this.labelNode.innerHTML=g,r.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",r.setStyle(this.titleNode,"display","none"));var l=a.y+a.h;a=window.isRTL?a.x:a.x+a.w;r.setStyle(this.domNode,"display","");r.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});var q=h.getMarginSize(this.menuNode);r.setStyle(this.menuNode,{left:(window.isRTL?a+q.w>window.innerWidth?window.innerWidth-q.w:0>a?0:a:0>a-q.w?0:a>window.innerWidth?
window.innerWidth-q.w:a-q.w)+"px",top:(q.h>window.innerHeight?0:l+q.h>window.innerHeight?window.innerHeight-q.h:l+q.h+5<window.innerHeight?l+5:l)+"px"});"string"===typeof g&&""!==g?(this.labelNode.focus(),this.hasTitle=!0):(this.menuContent.focus(),this.hasTitle=!1)}}});d.getInstance=function(){null===b&&(b=new d,r.place(b.domNode,document.body),b.startup());b.setActions([]);return b};return d})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/keys dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return F([h,p,m],{baseClass:"popup-menu-item",templateString:'\x3cdiv role\x3d"option" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"icon jimu-float-leading" data-dojo-attach-point\x3d"iconContainer"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=
this.action.label,this.labelNode.title=this.action.label,this.action.iconClass?("no-icon"===this.action.iconClass&&r.addClass(this.iconContainer,"no-icon"),r.addClass(this.iconNode,this.action.iconClass)):r.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(n(this.domNode,t.enter,z.hitch(this,this._useHoverIcon))),this.own(n(this.domNode,t.leave,z.hitch(this,this._useNormalIcon))));this.own(n(this.domNode,"click",z.hitch(this,this._clickHandler)));this.own(n(this.domNode,
"keydown",z.hitch(this,function(e){e.keyCode===v.ENTER&&this._clickHandler(e,!0)})))},setSelected:function(e){e?r.addClass(this.domNode,"selected"):r.removeClass(this.domNode,"selected")},_useNormalIcon:function(){this.action.iconClass?r.removeClass(this.iconNode,"highlight"):r.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?r.addClass(this.iconNode,"highlight"):r.setStyle(this.iconNode,"background-image","url("+
this.action.getIcon("hover")+")")},_clickHandler:function(e,c){x.stop(e);if(this.action){var f;this.action.data.features&&0<this.action.data.features.length&&(f=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,f)}this.emit("click",{isEnter:c})}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/has dojo/query dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k){var w=F([p,e],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new c;this.layerInfosObj=k.getInstanceSync();var y=r.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(y);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?x.addClass(this.previouBtn,"icon-arrow-forward"):x.addClass(this.previouBtn,
"icon-arrow-back");y=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(y);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new w.PopupUIController(this):new w.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(y){y=y.data.oriJimuLayerInfo;
var C=new m;y.getRelatedTableInfoArray().then(r.hitch(this,function(D){C.resolve(D)}));return C},_getRelatedRecordsByRelatedQuery:function(y){return y.oriJimuLayerInfo.getRelatedRecords(y.feature,y.destJimuLayerInfo,y.relationshipIndex)},_ignoreCaseToGetFieldObject:function(y,C){var D=null;C&&y&&y.fields&&z.some(y.fields,function(G){if(G.name.toLowerCase()===C.toLowerCase())return D=G,!0});return D},getLocaleDateTime:function(y){return q.localizeDate(new Date(y),{fullYear:!0,formatLength:"medium"})},
_getDisplayTitleOfRelatedRecord:function(y,C,D){var G=y.getInfoTemplate();return(y="popupTitle"===D&&G?"function"===typeof G.title?G.title(C):G.title:this._getDisplayTitleFromPopup(y,C,D))?y:" "},_getDisplayTitleFromPopup:function(y,C,D){(y=this._getPopupTemplateWithOnlyDisplayField(y,D))?(C.setInfoTemplate(y),D=this.popupUIController.getDisplayTitle(C),C.setInfoTemplate(null)):D=C.attributes[D];return D},_getPopupTemplateWithOnlyDisplayField:function(y,C){y=y.getPopupInfo()||y._getDefaultPopupInfo(y.layerObject);
var D={title:"",fieldInfos:[],description:"",showAttachments:!1,mediaInfos:[]};try{y&&y.fieldInfos&&C&&z.some(y.fieldInfos,function(G){return G.fieldName.toLowerCase()===C.toLowerCase()?(G=r.clone(G),G.visible=!0,D.fieldInfos.push(G),!0):!1},this)}catch(G){console.error(G)}return new l(D)},_canShowRelatedData:function(y){var C=!0;(y=y.getPopupInfo())&&y.relatedRecordsInfo&&(C=!1!==y.relatedRecordsInfo.showRelatedRecords);return C},setPopupContent:function(y){this._clearPage();y.data.destJimuLayerInfo?
y.data.relatedFeature||this.showRelatedRecords(y):this.showFeature(y);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(y){var C=y.data,D=C.oriJimuLayerInfo.layerObject,G=r.getObject("_wabProperties.originalLayerName",!1,D)||C.oriJimuLayerInfo.title;D=r.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,D);var H=this._getDisplayTitleOfRelatedRecord(C.oriJimuLayerInfo,C.feature,D);"popupTitle"!==
D&&(H=G+": "+H);this._setOperationTitle(H);r.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,C.oriJimuLayerInfo.layerObject);C.oriJimuLayerInfo.loadInfoTemplate().then(r.hitch(this,function(L){C.oriJimuLayerInfo.layerObject.infoTemplate||y.data.feature.setInfoTemplate(L);this.popupUIController.setFeature(y.data.feature);C.oriJimuLayerInfo.layerObject.infoTemplate||y.data.feature.setInfoTemplate(null)}));this.showRelatedTables(y);this.popupManager.initPopupMenu([y.data.feature]);
this.popupUIController.updateZoomToBtn([y.data.feature])},showRelatedRecords:function(y){var C=y.data,D=r.getObject("_wabProperties.originalLayerName",!1,C.destJimuLayerInfo.layerObject)||C.destJimuLayerInfo.title;this._setOperationTitle(D);this._clearPage();r.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",C,C.destJimuLayerInfo.layerObject);r.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,C.destJimuLayerInfo.layerObject);r.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",
C.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(C).then(r.hitch(this,function(G){0<G.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var H=this._showFieldSelector(C.destJimuLayerInfo);z.forEach(G,function(L,T){L._layer=C.destJimuLayerInfo.layerObject;var K=this._getDisplayTitleOfRelatedRecord(C.destJimuLayerInfo,L,H);T=x.create("div",{"class":"item record-item "+(0===T%2?"oddLine":"evenLine"),
innerHTML:K},this.contentBox);T.relatedRecord=L;T=n(T,"click",r.hitch(this,function(){this._addOperation(y);var O=this._createOperation({feature:L,oriJimuLayerInfo:C.destJimuLayerInfo,relationshipIndex:C.relationshipIndex});this.setPopupContent(O)}));this._temporaryData.eventHandles.push(T)},this);this.popupManager.initPopupMenu(G);this.popupUIController.updateZoomToBtn(G)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(y){this._canShowRelatedData(y.data.oriJimuLayerInfo)&&
this._getRelatedTableInfoArray(y).then(r.hitch(this,function(C){0<C.length&&this._setTitle(window.jimuNls.popup.relatedTables);var D={};z.forEach(C,function(H){void 0===D[H.id]?D[H.id]=0:D[H.id]++},this);var G={};z.forEach(C,function(H,L){void 0===G[H.id]?G[H.id]=0:G[H.id]++;var T='\x3cdiv title\x3d"'+H.title+'"\x3e'+H.title+"\x3c/div\x3e",K=x.create("div",{"class":"item table-item "+(0===L%2?"oddLine":"evenLine"),innerHTML:T},this.contentBox),O=G[H.id];if(0<D[H.id]){L=y.data.oriJimuLayerInfo.getLayerObject();
var I=H.getLayerObject();h({oriLayerObject:L,relatedLayerObject:I}).then(r.hitch(this,function(P){P=y.data.oriJimuLayerInfo.getOriRelationshipByDestLayer(P.oriLayerObject,P.relatedLayerObject,O);P=P.name||P.id;K.innerHTML=T+('\x3cdiv class\x3d"relationshipName" title\x3d"'+P+'"\x3e('+P+")\x3c/div\x3e")}))}L=n(K,"click",r.hitch(this,function(){H.getLayerObject().then(r.hitch(this,function(){this._addOperation(y);var P=this._createOperation({feature:y.data.feature,oriJimuLayerInfo:y.data.oriJimuLayerInfo,
destJimuLayerInfo:H,relationshipIndex:O});this.setPopupContent(P)}))}));this._temporaryData.eventHandles.push(L)},this)}))},_createOperation:function(y){return new w.Operation({feature:y.feature||null,oriJimuLayerInfo:y.oriJimuLayerInfo||null,destJimuLayerInfo:y.destJimuLayerInfo||null,relatedFeature:y.relatedFeature||null,relationshipIndex:y.relationshipIndex||0},this)},_addOperation:function(y){this.undoManager.add(y)},_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){x.empty(this.contentBox);
z.forEach(this._temporaryData.eventHandles,function(y){y&&y.remove&&y.remove()},this);this._temporaryData.eventHandles=[];z.forEach(this._temporaryData.dijits,function(y){y&&y.destroy&&y.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(y,C){y&&x.create("div",{"class":"title-box "+(C?C:""),innerHTML:y},this.contentBox)},_setOperationTitle:function(y){x.setAttr(this.operationTitle,"innerHTML",y);x.setAttr(this.operationTitle,"title",y)},_showFieldSelector:function(y){var C="objecid",
D=t(".title-box",this.contentBox)[0],G=y.layerObject,H=[];if(!D||!y)return C;var L=y.getPopupInfo();L&&L.title&&H.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var T=[];L&&L.fieldInfos?z.forEach(L.fieldInfos,function(P){var Q={};P.visible&&(Q.name=P.fieldName,Q.alias=P.label,T.push(Q))}):T=G.fields;z.forEach(T,function(P){"globalid"!==P.name.toLowerCase()&&"shape"!==P.name.toLowerCase()&&H.push({label:P.alias||P.name,value:P.name})});D=(new u({items:H})).placeAt(D);D.domNode.title=
window.jimuNls.popup.chooseFieldTip;var K=r.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,G),O=this._ignoreCaseToGetFieldObject(y.layerObject,y.layerObject.displayField||y.layerObject.objectIdField),I=A.getInstance().getAppConfig();K?C=K:"2.3"===I.configWabVersion&&O&&O.name?C=O.name:L&&L.title?C="popupTitle":O&&O.name?C=O.name:0<H.length&&(C=H[0].value);C&&(D.setHighlightValue(C),r.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",C,G));this._temporaryData.dijits.push(D);
y=n(D,"click-item",r.hitch(this,function(P,Q){t(".item.record-item",this.contentBox).forEach(r.hitch(this,function(U){r.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",Q,G);var Y=this._getDisplayTitleOfRelatedRecord(P,U.relatedRecord,Q);U.innerHTML=Y}))},y));this._temporaryData.eventHandles.push(y);return C}});w.Operation=F([f],{constructor:function(y,C){this.data=y;this.relatedRecordsPopupProjector=C},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});
w.PopupUIController=F([],{constructor:function(y){this.rrPopupProjector=y;this.popup=y.popup;this.initTempPopup();this._initTempPopupForDisplayTitle();this._initZoomToBtn();this._setScrollable()},initTempPopup:function(){this._tempPopup=new d({},x.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=new d({},x.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&
this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&x.destroy(this._zoomToBtnANode);this.toucemoveScrollHandle&&this.toucemoveScrollHandle.remove&&this.toucemoveScrollHandle.remove()},addDomNode:function(y){setTimeout(r.hitch(this,function(){var C=this._getRefDomNode();C&&x.place(y,C,"after")}),1)},setFeature:function(y){this._tempPopup.setFeatures([y]);if(y=t(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(y),x.place(this.rrPopupProjector.domNode,
y,"after"),this._unsetScrollable()},setContent:function(y){var C=t(".related-records-popup-projector").parent()[0];C&&C.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(y);this._unsetScrollable()},_setScrollable:function(){var y=t(".contentPane",this.popup.domNode)[0];v("esri-touch")&&y&&(this.toucemoveScrollHandle=n(y,"touchmove",r.hitch(this,function(C){C.preventDefault();t(".esriViewPopup",this.popup.domNode)[0]&&(C=y.firstChild,C instanceof Text&&(C=y.childNodes[1]),this.rrPopupProjector.domNode&&
x.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+C._currentX+"px, "+C._currentY+"px)"}))})))},_unsetScrollable:function(){x.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"none","-webkit-transform":"none"});x.setStyle(this.rrPopupProjector.domNode,{"-webkit-transition-property":"none","-webkit-transform":"none"})},getDisplayTitle:function(y){this._tempPopupForDisplayTitle.setFeatures([y]);return(y=
t("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&y.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return t(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var y=t(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=t(".action",y)[0];this._zoomToBtnANode=
x.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},y);this._zoomToBtn=x.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&x.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&x.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&x.setStyle(this._oldZoomToBtnANdoe,"display",
"none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&x.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(y){this._hideOldZoomToBtn();!y||1>y.length||!y[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=n(this._zoomToBtn,"click",r.hitch(this,function(){var C=null;try{C=g.graphicsExtent(y)}catch(D){console.error(D)}C&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(C),
this.popup.hide())})))},changeRefDomNode:function(){x.setStyle(this.rrPopupProjector.operationBox,"display","block");x.addClass(this.rrPopupProjector.domNode,"second-page-mode");var y=this._getViewPopupDomNode();y&&x.addClass(y,"second-page-mode")},revertRefDomNode:function(){x.setStyle(this.rrPopupProjector.operationBox,"display","none");x.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});w.PopupMobileUIController=F([w.PopupUIController],
{initTempPopup:function(){this._tempPopup=new a({},x.create("div"))},setFeature:function(y){this._tempPopup.setFeatures([y]);y=t(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(y=t(".esriViewPopup",y)[0])this.setContent(y),x.place(this.rrPopupProjector.domNode,y,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return t(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var y=t(".esriMobileInfoView.esriMobilePopupInfoView")[0];
return t(".esriViewPopup",y)[0]}});return w})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(F,r,z,x,n,v){F=F([v],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(t){t=t||{};t.maxOperations&&
(this.maxOperations=t.maxOperations);this._historyStack=[]},add:function(t){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,t);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var t=this.peekUndo();this.position--;t?(t=t.performUndo(),this.onUndo(),this._checkAvailability(),x(t).then(r.hitch(this,this.onUndoComplete))):(this.onUndo(),
this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var t=this.peekRedo();this.position++;t?(t=t.performRedo(),this.onRedo(),this._checkAvailability(),x(t).then(r.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=
!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},
get:function(t){return this._historyStack[t]},remove:function(t){0<this._historyStack.length&&(this._historyStack.splice(t,1),0<this.position&&t<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});z("extend-esri")&&(n.UndoManager=F);return F})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(F,r,z){F=F(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(x){x=
x||{};x.label&&(this.label=x.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});r("extend-esri")&&(z.OperationBase=F);return F})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),function(F,r,z,x,n,v,t,m,h){return F([r,z,h],{baseClass:"jimu-dijit-dropdownmenu",
declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuClass:"",dropdownMenuItemClass:"dropdown-menu-item",items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=v.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');this.itemsContainer=v.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container '+
this.dropdownMenuClass+'"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*this.paddingOffsetY+"px";n.forEach(this.items,x.hitch(this,function(p){var e=v.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+p.label+"\x3c/div\x3e");e.itemInfo=p;e.title=p.label;v.place(e,this.itemsContainer)}));this.own(t(this.domNode,"click",x.hitch(this,this._onIconClick)));this.own(t(this.shelter,
"click",x.hitch(this,this._onShelterClick)));this.own(t(this.itemsContainer,"click",x.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},_onIconClick:function(p,e){p.stopPropagation();this.isShowing()?this.hideMenu():(p=v.position(e||p.target||p.srcElement),this.showMenu(p))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(p){p.stopPropagation();p=p.target||p.srcElement;v.hasClass(p,this.dropdownMenuItemClass)&&(p=
p.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(p),this.emit("click-item",p));this.hideMenu()},clearHighlightValue:function(){m("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},setHighlightValue:function(p){this.clearHighlightValue();m("."+this.dropdownMenuItemClass,this.itemsContainer).some(x.hitch(this,function(e){return e.itemInfo.value===p?(v.addClass(e,"selected"),!0):!1}))},getHighlightValue:function(){var p=m("."+this.dropdownMenuItemClass+
".selected",this.itemsContainer)[0];return p?p.itemInfo.value:null},getHighlightLabel:function(){var p=this.getHighlightValue(),e="";n.some(this.items,function(c){return c.value===p?(e=c.label,!0):!1},this);return e},isShowing:function(){return v.hasClass(this.domNode,"showing")},showMenu:function(p){this.itemsContainer.style.top=p.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===window.isRTL?(this.itemsContainer.style.left=p.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=
window.innerWidth-(p.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");v.place(this.shelter,document.body);v.place(this.itemsContainer,document.body);v.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);v.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();v.destroy(this.itemsContainer);v.destroy(this.shelter);
this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(F,r,z,x,n){var v=null,t=F(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(z.subscribe("app/mapLoaded",r.hitch(this,this._onMapLoaded)),z.subscribe("app/mapChanged",r.hitch(this,this._onMapChanged))):(z.subscribe("mapLoaded",r.hitch(this,this._onMapLoaded)),z.subscribe("mapChanged",r.hitch(this,
this._onMapChanged)));z.subscribe("widgetDestroyed",r.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(m,h){return r.getObject(m+".filterExprs."+h,!1,this._filters)},applyWidgetFilter:function(m,h,p,e,c,f){var b="object"===typeof m?m:null;b&&(m=b.layerId,h=b.widgetId,p=b.expression,e=b.enableMapFilter,c=b.useAND,f=b.zoomAfterFilter);this._setFilterExp(m,h,p,e,c);h=this.layerInfos.getLayerInfoById(m)||this.layerInfos.getTableInfoById(m);m=this.getFilterExp(m);null!==m&&h&&h.setFilter(m,
{zoomAfterFilter:f})},_onMapLoaded:function(){this.layerInfos=n.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=n.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(m){for(var h in this._filters)if(this._filters[h]){var p=this._filters[h];if(p){var e=p.filterExprs;p=p.mapFilterControls;e&&delete e[m];p&&delete p[m]}}},_traversalFilter:function(){this.layerInfos.traversalAll(r.hitch(this,function(m){this._filters[m.id]||(this._filters[m.id]={definitionExpression:m.getFilter(),
filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(m){m=r.getObject(m+".mapFilterControls",!1,this._filters);var h=0,p;for(p in m){var e=m[p];e.priority>h&&(h=e.priority)}return h},_getMapFilterControl:function(m){m=r.getObject(m+".mapFilterControls",!1,this._filters);var h=0,p=null,e;for(e in m){var c=m[e];c.priority>h&&(h=c.priority,p=c)}return p},_setFilterExp:function(m,h,p,e,c){var f=m+".filterExprs."+h,b=m+".mapFilterControls."+h;p?(r.setObject(f,p,this._filters),x.isDefined(e)&&
(m=this._getPriorityOfMapFilter(m),r.setObject(b,{enable:e,useAND:c,priority:m+1},this._filters))):(r.getObject(f,!1,this._filters)&&delete this._filters[m].filterExprs[h],r.getObject(b,!1,this._filters)&&delete this._filters[m].mapFilterControls[h])},getFilterExp:function(m,h){if(!this._filters[m])return null;var p=[],e=this._filters[m].definitionExpression,c=this._filters[m].filterExprs;m=this._getMapFilterControl(m);for(var f in c){var b=c[f];h&&0<=f.indexOf(h)||b&&p.push("("+b+")")}h=p.join(" AND ");
return e&&m&&m.enable||e&&null===m?h?m&&!1===m.useAND?"("+e+") OR "+h:"("+e+") AND "+h:e:h}});t.getInstance=function(){if(null===v)v=new t,window._filterManager=v;else return v};return t})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(F,r,z){var x=null;var n=F(null,{constructor:function(v){z.subscribe("publishData",r.hitch(this,this.onDataPublished));z.subscribe("fetchData",r.hitch(this,this.onFetchData));z.subscribe("clearAllData",r.hitch(this,
this.onClearAllData));z.subscribe("removeData",r.hitch(this,this.onRemoveData));z.subscribe("clearDataHistory",r.hitch(this,this.onClearDataHistory));this.widgetManager=v},_dataStore:{},onDataPublished:function(v,t,m,h){"undefined"===typeof h&&(h=!1);this._dataStore[t]?(this._dataStore[t].current=m,h&&(this._dataStore[t].history?this._dataStore[t].history.push(m):this._dataStore[t].history=[m])):(this._dataStore[t]={current:m},h&&(this._dataStore[t].history=[m]))},onFetchData:function(v){var t;if(v)"framework"===
v?this._dataStore[v]?z.publish("dataFetched","framework","framework",this._dataStore[v].current,this._dataStore[v].history):z.publish("noData","framework","framework"):(t=this.widgetManager.getWidgetById(v))?this._dataStore[v]?z.publish("dataFetched",t.name,v,this._dataStore[v].current,this._dataStore[v].history):z.publish("noData",t.name,v):z.publish("noData",void 0,v);else{for(var m in this._dataStore)(t=this.widgetManager.getWidgetById(m))&&z.publish("dataFetched",t.name,m,this._dataStore[m].current,
this._dataStore[m].history);t||z.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};z.publish("allDataCleared")},onRemoveData:function(v){delete this._dataStore[v];z.publish("dataRemoved",v)},onClearDataHistory:function(v){this._dataStore[v]&&(this._dataStore[v].history=[]);z.publish("dataHistoryCleared",v)}});n.getInstance=function(v){null===x&&(x=new n(v));return x};return n})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic dojo/on esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){var d=null,a=F(null,{constructor:function(){window.isBuilder?(n.subscribe("app/mapLoaded",z.hitch(this,this._onMapLoaded)),n.subscribe("app/mapChanged",z.hitch(this,this._onMapChanged))):(n.subscribe("mapLoaded",z.hitch(this,this._onMapLoaded)),n.subscribe("mapChanged",z.hitch(this,this._onMapChanged)))},_displayLayers:{},previousMapScale:null,setSelectionSymbol:function(g){var l=g.geometryType,q=new c(c.STYLE_CIRCLE,16,null,e.fromArray([0,255,255])),A=new f(f.STYLE_SOLID,
e.fromArray([0,255,255]),2),u=new b(b.STYLE_SOLID,A,e.fromArray([0,255,255,.3]));"esriGeometryPoint"===l?g.setSelectionSymbol(q):"esriGeometryPolyline"===l?g.setSelectionSymbol(A):"esriGeometryPolygon"===l&&g.setSelectionSymbol(u)},updateSelectionByFeatures:function(g,l,q){0<l.length&&(l=x.map(l,z.hitch(this,function(u){var k=null;k=0<=g.graphics.indexOf(u)?new p(u.toJson()):u;k.wabIsTemp=!0;return k})));g.getSelectionSymbol()||this.setSelectionSymbol(g);var A=new r;g._selectHandler({features:l},
q,null,null,A);this._isLayerNeedDisplayLayer(g)&&(this._displayLayers[g.id]||(this._displayLayers[g.id]=this._createDisplayLayer(g)),this._updateDisplayLayer(g,l,q));return A},getDisplayLayer:function(g){return this._displayLayers[g]},setSelection:function(g,l){return this.updateSelectionByFeatures(g,l,t.SELECTION_NEW)},addFeaturesToSelection:function(g,l){return this.updateSelectionByFeatures(g,l,t.SELECTION_ADD)},removeFeaturesFromSelection:function(g,l){return this.updateSelectionByFeatures(g,
l,t.SELECTION_SUBTRACT)},clearSelection:function(g){var l=new r;this.clearDisplayLayer(g);g.clearSelection();l.resolve();return l},clearDisplayLayer:function(g){(g=this._displayLayers[g.id])&&g.clear()},getClientFeaturesByGeometry:function(g,l,q){return x.filter(g.graphics,z.hitch(this,function(A){return A.geometry?q?h.contains(l,A.geometry):h.intersects(l,A.geometry):!1}))},getUnionGeometryBySelectedFeatures:function(g){var l=null;g=g.getSelectedFeatures();0<g.length&&(l=x.map(g,z.hitch(this,function(q){return q.geometry})),
l=h.union(l));return l},_createDisplayLayer:function(g){var l=new m,q=g.objectIdField;l.fields=g.fields;l.id="displayLayer_of_"+g.id;this.map.addLayer(l);if(!this.map.spatialReference.equals(g.spatialReference)||g.hasWebGLSurface()){var A=g.getSelectionSymbol();v(g,"update-end",z.hitch(this,function(){var u=Math.round(this.map.getScale());if(this.previousMapScale!==u&&l.graphics&&0<l.graphics.length){this.previousMapScale=u;var k=x.map(l.graphics,function(w){return w.attributes[q]});u=x.filter(g.graphics,
function(w){return 0<=k.indexOf(w.attributes[q])});l.clear();x.forEach(u,z.hitch(this,function(w){w=new p(w.toJson());w.setSymbol(A);l.add(w)}))}}))}return l},_updateDisplayLayer:function(g,l,q){var A=this._displayLayers[g.id],u=g.getSelectionSymbol();g.hasWebGLSurface()?this._updateDisplayLayerWebGL(g,A,u,l,q):(l=g.getSelectedFeatures(),this.clearDisplayLayer(g),x.forEach(l,z.hitch(this,function(k){k.visible&&(k.setSymbol(null),k=new p(k.toJson()),k.setSymbol(u),A.add(k))})))},_updateDisplayLayerWebGL:function(g,
l,q,A,u){u===t.SELECTION_NEW&&(g._selectedFeaturesWebGL={});u===t.SELECTION_NEW||u===t.SELECTION_ADD?x.forEach(A,z.hitch(this,function(w){w.visible&&(g._selectedFeaturesWebGL[w.attributes[g.objectIdField]]=w)})):u===t.SELECTION_SUBTRACT&&x.forEach(A,z.hitch(this,function(w){w=w.attributes[g.objectIdField];w in g._selectedFeaturesWebGL&&delete g._selectedFeaturesWebGL[w]}));this.clearDisplayLayer(g);for(var k in g._selectedFeaturesWebGL)A=new p(g._selectedFeaturesWebGL[k].toJson()),A.setSymbol(q),
l.add(A)},_isLayerNeedDisplayLayer:function(g){return g.hasWebGLSurface()||!g.getMap()},_onMapLoaded:function(g){this.map=g},_onMapChanged:function(g){this.map=g}});a.getInstance=function(){d||(d=new a,window._selectionManager=d);return d};return a})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(F,r,z,x,n,v,t,m,
h,p){return F([v,t,m],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(n.subscribe("publishData",r.hitch(this,this._onReceiveData)));this.own(n.subscribe("dataFetched",r.hitch(this,this._onReceiveData)));
this.own(n.subscribe("noData",r.hitch(this,this._onNoData)));this.own(n.subscribe("dataSourceDataUpdated",r.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(e){},onSignOut:function(){},onPositionChange:function(e){this.setPosition(e)},setPosition:function(e,c){this.position=
e;var f=h.getPositionStyle(this.position);f.position="absolute";c||(c="map"===e.relativeTo?this.map.id:window.jimuConfig.layoutId);x.place(this.domNode,c);x.setStyle(this.domNode,f);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return x.getMarginBox(this.domNode)},setMap:function(e){this.map=e},setState:function(e){this.state=e},setWindowState:function(e){this.windowState=e},resize:function(){},onConfigChanged:function(e){},onAppConfigChanged:function(e,
c,f){},onAction:function(e,c){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return p.getInstance().getPanelById(this.id+"_panel");var e=p.getInstance().getPanelById(this.gid+"_panel");return e?e:p.getInstance().getPanelById(this.id+"_panel")},publishData:function(e,c){"undefined"===typeof c&&(c=!1);n.publish("publishData",this.name,this.id,e,c)},fetchData:function(e){e?n.publish("fetchData",e):0!==this.listenWidgetIds.length?z.forEach(this.listenWidgetIds,
function(c){n.publish("fetchData",c)},this):n.publish("fetchData")},fetchDataByName:function(e){e=this.widgetManager.getWidgetsByName(e);z.forEach(e,function(c){this.fetchData(c.id)},this)},openWidgetById:function(e){return this.widgetManager.triggerWidgetOpen(e)},_onReceiveData:function(e,c,f,b){if(c!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onReceiveData(e,c,f,b)},onReceiveData:function(e,c,f,b){},updateDataSourceData:function(e,c){n.publish("updateDataSourceData",
"widget~"+this.id+"~"+e,c)},onDataSourceDataUpdate:function(e,c){},_onNoData:function(e,c){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onNoData(e,c)},onNoData:function(e,c){}})})},"jimu/dijit/BindLabelPropsMixin":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/query","dojo/_base/array","jimu/utils"],function(F,r,z,x,n){return F("jimu-bind-label-props-mixin",null,{isRenderIdForAttrs:!1,buildRendering:function(){this.inherited(arguments);if(this.isRenderIdForAttrs){var v=
z("[data-a11y-label-id],[data-a11y-label-by], [data-label-for], [data-label-id]",this.domNode);(r.getAttr(this.domNode,"data-a11y-label-id")||r.getAttr(this.domNode,"data-a11y-label-by")||r.getAttr(this.domNode,"data-label-for")||r.getAttr(this.domNode,"data-label-id"))&&v.unshift(this.domNode);var t={},m=[],h={},p=0,e="jimuUniqName_"+n.getUUID();x.forEach(v,function(g){var l=r.getAttr(g,"data-a11y-label-id"),q=r.getAttr(g,"data-a11y-label-by"),A=r.getAttr(g,"data-label-for"),u=r.getAttr(g,"data-label-id");
l?(r.removeAttr(g,"data-a11y-label-id"),a=e+"_"+p,r.setAttr(g,"id",a),t[l]=a,p++):q?m.push(g):A?(h.hasOwnProperty(A)||(h[A]={}),h[A].forDom=g):(h.hasOwnProperty(u)||(h[u]={}),h[u].idDom=g)});for(var c in m){v=m[c];var f=r.getAttr(v,"data-a11y-label-by").split(" "),b=[];x.forEach(f,function(g){b.push(t[g])});r.removeAttr(v,"data-a11y-label-by");r.setAttr(v,"aria-labelledby",b.join(" "))}for(var d in h){var a=e+"_"+p;c=h[d].forDom;v=h[d].idDom;c&&(r.removeAttr(c,"data-label-for"),r.setAttr(c,"for",
a));v&&(r.removeAttr(v,"data-label-id"),r.setAttr(v,"id",a));p++}}}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f){var b=null;var d=F(null,{constructor:function(){this.panels=[];this.widgetManager=f.getInstance();m(window,"resize",r.hitch(this,this.onWindowResize));this.activePanel=
null;h.subscribe("/dnd/move/start",r.hitch(this,this._onMoveStart));h.subscribe("widgetActived",r.hitch(this,this._onWidgetActived))},showPanel:function(a){var g=new v,l=this.getPanelById(a.id+"_panel");l?("closed"===l.state&&this.openPanel(l),g.resolve(l)):t({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(r.hitch(this,function(q){var A=a.id+"_panel",u=this.getPanelById(A),k={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,
panelManager:this,id:A,gid:a.gid,nls:q.nls};r.mixin(k,a.panel.options);try{u=new q.Panel(k),console.log("panel ["+A+"] created.")}catch(w){console.log("create panel error: "+w+", panelId: "+A);g.reject(w);return}u.setPosition(a.panel.position);c.setVerticalCenter(u.domNode);this.openPanel(u);u.domNode.addEventListener("click",r.hitch(this,this._onPanelClick,u),{capture:!0});g.resolve(u)}));return g},setMap:function(a){this.map=a;m(this.map,"resize",r.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a))return;for(var g=0;g<this.panels.length;g++)this.panels[g].gid===a.gid&&this.panels[g].id!==a.id&&this.closePanel(this.panels[g])},closeAllPanelsInGroup:function(a){for(var g=0;g<this.panels.length;g++)this.panels[g].gid===a&&this.closePanel(this.panels[g])},openPanel:function(a){var g=new v;if("string"===typeof a){if(a=this.getPanelById(a),!a)return g.reject(),g}else this.panels.some(function(l){return l.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=
!0,a.startup()}catch(l){console.error("fail to startup panel "+a.id+". "+l.stack)}if("opened"===a.state)return this._activePanel(a),g.resolve(a),g;a.setState("opened");return this.playOpenPanelAnimation(a).then(r.hitch(this,function(){x.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var g=new v;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(g.resolve(),g):this.playClosePanelAnimation(a).then(r.hitch(this,function(){this.activePanel&&
this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&x.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(g){console.log(console.error("fail to minimize panel "+a.id+". "+g.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(g){console.log(console.error("fail to maximize panel "+a.id+". "+g.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(g){console.log(console.error("fail to noralize panel "+a.id+". "+g.stack))}},changeWindowStateTo:function(a,g){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"normal"===g?this.normalizePanel(a):"minimized"===g?this.minimizePanel(a):"maximized"===g?this.maximizePanel(a):console.log("error state: "+g)},getPanelById:function(a){for(var g=0;g<this.panels.length;g++)if(this.panels[g].id===a)return this.panels[g]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==
this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(g){console.log(console.error("fail to destroy panel "+a.id+". "+g.stack))}}},destroyAllPanels:function(){var a=z.map(this.panels,function(g){return g.id});z.forEach(a,function(g){this.destroyPanel(g)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return p();var g=new v;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(x.setStyle(a.domNode,{opacity:0,display:""}),n.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){g.resolve()}}).play()):g.resolve():g.resolve();return g},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return p();var g=new v;"string"===
typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?n.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){g.resolve()}}).play():g.resolve());return g},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var g=x.getMarginBox(window.jimuConfig.layoutId),l=g.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:g.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,
borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(l=0,this.panels.filter(function(q){return"minimized"===q.windowState&&"closed"!==q.state&&q.id!==a.id}).some(function(q){return 0===q._mobileBottom})&&(l=a.titleHeight),a._mobileBottom=l,g.h>g.w?{left:0,right:0,top:"auto",bottom:l,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:g.w-g.w/2,right:0,top:"auto",bottom:l,width:g.w/2,height:a.titleHeight,contentHeight:g.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):g.h>g.w?{left:0,right:0,top:l,bottom:0,width:"auto",height:"auto",contentHeight:g.h-l-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",
borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:g.w-g.w/2,right:0,top:0,bottom:0,width:g.w/2,height:"auto",contentHeight:g.h-l-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"closed"!==a.state&&this._activePanel(a)},
_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&x.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),x.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var g=this.widgetManager.activeWidget;g&&"active"===g.state&&g.getPanel()!==a&&(g.setState("opened"),
!1===g.inPanel&&x.setStyle(g.domNode,"zIndex","undefined"!==typeof g.position.zIndex?g.position.zIndex:"auto"),g.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&x.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var g=this.panels.indexOf(a);-1<g&&this.panels.splice(g,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=
null)},_onMoveStart:function(a){z.forEach(this.panels,function(g){g.domNode===a.node&&this._activePanel(g)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),x.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var g=new v;
e([a],function(l){g.resolve(l)});return g},_loadThemeI18N:function(a){var g=new v;a.startWith("themes")?(a=a.split("/"),e(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(l){g.resolve(l)})):g.resolve({});return g}});d.getInstance=function(){null===b&&(b=new d,window._panelManager=b);return b};return d})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(F,r,z,x){return F([x],{widget:null,baseClass:"jimu-widget-frame jimu-container",
postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&r.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(n){this.loading=n;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(n){this.widget=n;this.loading&&
this.loading.destroy();z.place(n.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(n){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+n.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./a11y/BaseWidgetPanel ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p){F=F([n,v],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var e=this.getAllWidgetConfigs();Array.isArray(this.config.widgets)?(e=this.config.widgets,1<e.length&&this._addTagToGroupPanel()):e=[this.config];z.forEach(e,function(c,f){if(!1!==
c.visible){var b=new m;var d=this.createFrame(c);this._initFrameEvents(d,c,f);this.addChild(d);d.setLoading(b);this.widgetManager.loadWidget(c).then(r.hitch(this,function(a){d.setWidget(a);a.startup()}))}},this)},getAllWidgetConfigs:function(){var e=[];return e=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(e){for(var c=this.getChildren(),f=0;f<c.length;f++)if(c[f].getWidget()&&c[f].getWidget().id===e)return c[f].getWidget()},getWidgets:function(){return this.getChildren().map(function(e){return e.getWidget()})},
createFrame:function(e){return new h},setPosition:function(e,c){this.position=e;var f=p.getPositionStyle(this.position);f.position="absolute";c||(c="map"===e.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(f.display="none");x.place(this.domNode,c);x.setStyle(this.domNode,f)},getPosition:function(){return this.position},setState:function(e){this.state=e},setWindowState:function(e){this.windowState=e},resize:function(){this.getChildren().forEach(function(e){e.resize()})},
onPositionChange:function(e){this.setPosition(e)},onOpen:function(){z.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.openWidget(e.getWidget())},this);this._onOpenAndFocus()},onClose:function(){z.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.closeWidget(e.getWidget())},this)},onMaximize:function(){z.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.maximizeWidget(e.getWidget())},this)},onMinimize:function(){z.forEach(this.getChildren(),
function(e){e.getWidget()&&this.widgetManager.minimizeWidget(e.getWidget())},this)},onNormalize:function(){z.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.normalizeWidget(e.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(e){this._updateConfig(e)},reloadWidget:function(e){this.isWidgetInPanel(e)&&(this._updateConfig(e),this.getChildren().forEach(function(c){c.getWidget()&&c.getWidget().id===e.id&&(c.getWidget().destroy(),c.setLoading(new m),
this.widgetManager.loadWidget(e).then(r.hitch(this,function(f){c.setWidget(f);f.startup();"closed"===this.state&&this.widgetManager.closeWidget(f)})))},this))},isWidgetInPanel:function(e){return z.some(this.getAllWidgetConfigs(),function(c){if(e.id===c.id)return!0})?!0:!1},_updateConfig:function(e){if(Array.isArray(this.config.widgets)){for(var c=-1,f=0;f<this.config.widgets.length;f++)this.config.widgets[f].id===e.id&&(c=f);0<c&&(this.config.widgets[c]=e)}else this.config=e},destroy:function(){this.getChildren().forEach(function(e){try{e.domNode&&
e.destroy()}catch(c){console.error("destroy widget frame error."+c.stack)}});this.inherited(arguments)}});F.extend(t);return F})},"jimu/a11y/BaseWidgetPanel":function(){define("dojo/_base/lang dojo/_base/html dojo/query dojo/on dojo/keys ./../utils".split(" "),function(F,r,z,x,n,v){var t={frameSectionIndex:"91"};t.panelNls=window.jimuNls.panelHeader;t._addTagToGroupPanel=function(){var m=this.config.widgets;this.isGroupPanel=!0;m.forEach(function(h){h.inGroupPanel=!0})};t._setAriaLabel=function(m,
h){if(m.folded){var p=t.panelNls.expanded;r.setStyle(m.containerNode,"display","inherit")}else p=t.panelNls.collapsed,r.setStyle(m.containerNode,"display","none");h=v.getSubstituteString(h,p);r.setAttr(m.titleNode,"aria-label",h)};t._initFrameEvents=function(m,h,p){if(this.isGroupPanel){var e=v.getSubstituteString(h.label,t.panelNls.expanded);h=v.getSubstituteString(h.label,t.panelNls.pressToFocus);r.setAttr(m.titleNode,"aria-label",e);r.setAttr(m.titleNode,"tabindex",t.frameSectionIndex);r.setAttr(m.containerNode,
"aria-label",h);r.setAttr(m.containerNode,"tabindex",t.frameSectionIndex);0===p?this.firstTitleNode=m.titleNode:p===this.config.widgets.length-1&&(this.lastTitleNode=m.titleNode,this.lastContent=m.containerNode);this.own(x(m.titleNode,"click",F.hitch(this,function(){m.foldEnable&&this._setAriaLabel(m,m.label)})));this.own(x(m.titleNode,"keydown",F.hitch(this,function(c){r.hasClass(c.target,"title")&&(c.keyCode===n.TAB?c.target===this.firstTitleNode&&c.shiftKey?(c.preventDefault(),this.lastContent.focus()):
c.target!==this.lastTitleNode||c.shiftKey||"none"!==r.getStyle(this.lastContent,"display")||(c.preventDefault(),this.firstTitleNode.focus()):!m.foldEnable||c.keyCode!==n.ENTER&&c.keyCode!==n.SPACE||(c.stopPropagation(),this._setAriaLabel(m,m.label),m.onFoldableNodeClick()))})));this.own(x(m.containerNode,"keydown",F.hitch(this,function(c){var f=c.target;r.hasClass(f,"jimu-panel-content")?c.keyCode===n.ENTER?(c=z(".jimu-widget",f)[0])&&v.focusFirstFocusNode(c):c.target!==this.lastContent||c.shiftKey||
c.keyCode!==n.TAB||(c.preventDefault(),this.firstTitleNode.focus()):c.keyCode===n.ESCAPE&&(c.stopPropagation(),m.containerNode.focus())})))}};t._onOpenAndFocus=function(){this.config.openAtStart&&!this._isFirstOpenAtStart?this._isFirstOpenAtStart=!0:this.isGroupPanel&&this.firstTitleNode&&this.firstTitleNode.focus()};return t})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(F,r,z,x,n){return F([x,
n],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(z(window,"resize",r.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(F,r,z,x,n,v){return{cloneSymbol:function(t){if(!t)return null;var m=null;try{var h=t.toJson();
m=n.fromJson(h)}catch(p){console.error(p)}return m},getDefaultMarkerSymbol:function(){return n.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return n.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return n.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,
129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return n.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return n.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return n.fromJson({color:[255,
255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var t=F.toUrl("jimu/css/images/grey_pin.png");t=new v(t,16,16);t.setOffset(0,8);return t},createSymbolNode:function(t,m){var h=32,p=32,e=z.create("div",{},document.body);z.setStyle(e,"display","inline-block");if(m)h=m.width,p=m.height;else if(h=80,p=30,this.isSimpleMarkerSymbol(t))p=h=Math.min(t.size+12,125);else if(this.isPictureMarkerSymbol(t)){if(!t.url||
"http://"===t.url||-1===t.url.indexOf("http://")&&-1===t.url.indexOf("https://")&&-1===t.url.indexOf("data:"))return;p=h=Math.min(Math.max(t.width,t.height),125)}else if(this.isSimpleLineSymbol(t)||this.isCartographicLineSymbol(t))h=190,p=20;var c=x.createSurface(e,h,p);if("vml"===x.renderer){var f=c.getEventSource();z.setStyle(f,"position","relative");z.setStyle(f.parentNode,"position","relative")}f=null;f=m?n.getShapeDescriptors(t):this.isSimpleLineSymbol(t)||this.isCartographicLineSymbol(t)?this._getLineShapeDesc(t):
n.getShapeDescriptors(t);try{var b=c.createShape(f.defaultShape);f.fill&&b.setFill(f.fill);f.stroke&&b.setStroke(f.stroke)}catch(d){c.clear();c.destroy();return}t=c.getDimensions();t={dx:t.width/2,dy:t.height/2};c=b.getBoundingBox();m=c.width;c=c.height;if(m>h||c>p)h=((h<p?h:p)-5)/(m>c?m:c),r.mixin(t,{xx:h,yy:h});b.applyTransform(t);e&&z.addClass(e,"symbol");return e},_getLineShapeDesc:function(t){var m=null;if(this.isSimpleLineSymbol(t)||this.isCartographicLineSymbol(t))m={defaultShape:{type:"path",
path:"M -90,0 L 90,0 E"},fill:null,stroke:t.getStroke()};return m},isSimpleMarkerSymbol:function(t){return t&&"esri.symbol.SimpleMarkerSymbol"===t.declaredClass},isPictureMarkerSymbol:function(t){return t&&"esri.symbol.PictureMarkerSymbol"===t.declaredClass},isSimpleLineSymbol:function(t){return t&&"esri.symbol.SimpleLineSymbol"===t.declaredClass},isCartographicLineSymbol:function(t){return t&&"esri.symbol.CartographicLineSymbol"===t.declaredClass},isSimpleFillSymbol:function(t){return t&&"esri.symbol.SimpleFillSymbol"===
t.declaredClass},isPictureFillSymbol:function(t){return t&&"esri.symbol.PictureFillSymbol"===t.declaredClass},isTextSymbol:function(t){return t&&"esri.symbol.TextSymbol"===t.declaredClass}}})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(F,r,z){return F(null,{constructor:function(){this.panelManager=z.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups=
"all")},getOpenedIds:function(){},setOpenedIds:function(x){},getConfigById:function(x){for(var n=this.getAllConfigs(),v=0;v<n.length;v++)if(n[v].id===x)return n[v]},getAllConfigs:function(){var x=[];x=x.concat(this.getWidgetConfigs(),this.getGroupConfigs());x=r.filter(x,function(n){return n.visible});return x.sort(function(n,v){return n.index-v.index})},getAllConfigsIncludeInvisible:function(){var x=[];x=x.concat(this.getWidgetConfigs(),this.getGroupConfigs());return x.sort(function(n,v){return n.index-
v.index})},isControlled:function(x){return r.some(this.getAllConfigsIncludeInvisible(),function(n){return n.id===x})},widgetIsControlled:function(x){return r.some(this.getAllConfigsIncludeInvisible(),function(n){return n.id===x?!0:r.some(n.widgets,function(v){return v.id===x})})},getGroupConfigs:function(){var x=[];if(!this.appConfig.widgetPool)return x;this.appConfig.widgetPool.groups&&r.forEach(this.appConfig.widgetPool.groups,function(n){this.controlledGroups&&(Array.isArray(this.controlledGroups)?
-1<this.controlledGroups.indexOf(n.id)&&x.push(n):"all"===this.controlledGroups&&x.push(n))},this);return x},getWidgetConfigs:function(){var x=[];if(!this.appConfig.widgetPool)return x;this.appConfig.widgetPool.widgets&&r.forEach(this.appConfig.widgetPool.widgets,function(n){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(n.id)&&x.push(n):"all"===this.controlledWidgets&&x.push(n))},this);return x}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),
function(F,r,z,x,n,v,t,m){var h=null,p=null,e=!1;F=F(null,function(){});var c=require.toUrl("jimu"),f=v(c+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),b=v(c+"/SpatialReference/transform.json",{handleAs:"json"});F.loadResource=function(){var d=new x;if(h&&p)return d.resolve(),d;n([f,b]).then(function(a){h=a[0];p=a[1];e=!0;d.resolve()},function(a){console.error(a);e=!1;d.reject(a)});return d};F.getAllCSUnits=function(){if(e){var d=[];z.forEach(h.wkids,r.hitch(this,function(a){a=this.getCSUnit(a);
-1===z.indexOf(d,a)&&d.push(a)}));return d}};F.convertUnit=function(d,a,g){if(e)return m.convertUnit(d,a,g)};F.getUnitRate=function(d,a){if(e)return m.getUnitRate(d,a)};F.isProjectUnit=function(d){if(e)return m.isProjectUnit(d)};F.isGeographicUnit=function(d){if(e)return m.isGeographicUnit(d)};F.getGeographicUnits=function(){if(e)return m.getGeographicUnits()};F.getProjectUnits=function(){if(e)return m.getProjectUnits()};F.getCSUnit=function(d){if(e){d=this.getCSStr(d);var a=0,g=0;a=d.lastIndexOf("UNIT");
g=d.indexOf(",",a);return d.slice(a+6,g-1)}};F.isSameSR=function(d,a){if(e)return d=this.indexOfWkid(d),a=this.indexOfWkid(a),h.labels[d]===h.labels[a]};F.isValidWkid=function(d){if(e)return-1<this.indexOfWkid(d)};F.getSRLabel=function(d){if(e&&this.isValidWkid(d))return d=this.indexOfWkid(d),h.labels[d]};F.indexOfWkid=function(d){if(e)return z.indexOf(h.wkids,d)};F.isWebMercator=function(d){return t.prototype._isWebMercator?t.prototype._isWebMercator.apply({wkid:parseInt(d,10)},[]):(new t(parseInt(d,
10))).isWebMercator()};F.standardizeWkid=function(d){return this.isWebMercator(d)?3857:parseInt(d,10)};F.isValidTfWkid=function(d){if(e)return-1<this.indexOfTfWkid(d)};F.getTransformationLabel=function(d){if(e)return this.isValidTfWkid(d)?(d=this.indexOfTfWkid(d),p.labels[d]):""};F.indexOfTfWkid=function(d){if(e)return z.indexOf(p.tfWkids,d)};F.isGeographicCS=function(d){if(e)return this.isValidWkid(d)?h.details[this.indexOfWkid(d)].startWith("GEOGCS"):!1};F.isProjectedCS=function(d){if(e)return this.isValidWkid(d)?
h.details[this.indexOfWkid(d)].startWith("PROJCS"):!1};F.getGeoCSByProj=function(d){if(e&&this.isProjectedCS(d))return d=this.getSpheroidStr(d),d=z.indexOf(h.details,d),h.wkids[d]};F.getSpheroidStr=function(d){if(e){if(this.isGeographicCS(d))return h.details[this.indexOfWkid(d)];if(this.isProjectedCS(d)){d=h.details[this.indexOfWkid(d)];var a=d.indexOf("GEOGCS"),g=d.indexOf("PROJECTION")-1;return d.slice(a,g)}return null}};F.getCSStr=function(d){if(e)return h.details[this.indexOfWkid(d)]};F.isSameSpheroid=
function(d,a){if(e)return d=this.getSpheroidStr(d),a=this.getSpheroidStr(a),d&&a&&d===a?!0:!1};return F})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(F,r){var z="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
x="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),n={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};F=F(null,function(){});F.convertUnit=function(v,t,m){return n[v.toUpperCase()]/n[t.toUpperCase()]*m};F.getUnitRate=function(v,t){return n[v.toUpperCase()]/n[t.toUpperCase()]};F.isProjectUnit=function(v){return-1<r.indexOf(z,v.toUpperCase())};F.isGeographicUnit=function(v){return-1<
r.indexOf(x,v.toUpperCase())};F.getGeographicUnits=function(){return x};F.getProjectUnits=function(){return z};return F})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(F,r,z,x,n,v,t,m){return F(r,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){t.create("div",
{"class":"jimu-radio-inner"},this.domNode);this.checked&&v.add(this.domNode,"jimu-radio-checked");this.own(n(this.domNode,"click",z.hitch(this,function(){this.checked||this.check()})))},check:function(h){void 0===h&&(h=!0);this.checked=!0;v.add(this.domNode,"jimu-radio-checked");h&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(h){void 0===h&&(h=!0);this.checked=!1;v.remove(this.domNode,"jimu-radio-checked");h&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(h){null!==
this.group&&x.forEach(m.toArray(),function(p){p.id!==this.id&&p["class"]===this["class"]&&p.group===this.group&&(h?p.check(!1):p.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/Evented ./a11y/CheckBox".split(" "),function(F,r,z,x,n,v,t){F=F([r,v],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,disabled:!1,status:!0,label:"",title:"",postCreate:function(){this.checkNode=
x.create("div",{"class":"checkbox jimu-float-leading jimu-icon jimu-icon-checkbox"},this.domNode);this.labelNode=x.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&(x.addClass(this.checkNode,"checked"),x.addClass(this.checkNode,"jimu-icon-checked"));this.status=this._getStatusByDisabled(this.disabled);this.status||(x.addClass(this.domNode,"jimu-state-disabled"),x.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);
this.own(this.watch("disabled",z.hitch(this,function(){this.setStatus(this._getStatusByDisabled(this.disabled))})));this._udpateLabelClass();this.a11y_init()},setLabel:function(m){this.label=m;this.labelNode.innerHTML=this.label;this.labelNode.title=this.label;this.a11y_updateAriaLabel(m);this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?x.removeClass(this.labelNode,"not-visible"):x.addClass(this.labelNode,"not-visible"))},setValue:function(m){this.status&&
(!0===m?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(m){m=!!m;var h=this.status!==m;(this.status=m)?(n.remove(this.domNode,"jimu-state-disabled"),x.removeClass(this.checkNode,"jimu-state-disabled")):(n.add(this.domNode,"jimu-state-disabled"),x.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);h&&this.emit("status-change",m)},getStatus:function(){return this.status},check:function(m){if(this.status&&(this.checked=!0,this.a11y_changeAriaCheckedAttr(),
x.addClass(this.checkNode,"checked jimu-icon-checked"),x.removeClass(this.checkNode,"checked jimu-icon-checkbox"),!m))this.onStateChange()},uncheck:function(m){if(this.status&&(this.checked=!1,this.a11y_changeAriaCheckedAttr(),x.removeClass(this.checkNode,"checked"),x.removeClass(this.checkNode,"jimu-icon-checked"),x.addClass(this.checkNode,"jimu-icon-checkbox"),!m))this.onStateChange()},onStateChange:function(){if(this.onChange&&z.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",
this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&this.checkNode.focus()},_getStatusByDisabled:function(m){return!0===m||"true"===m||"disabled"===m?!1:!0}});F.extend(t);return F})},"jimu/dijit/a11y/CheckBox":function(){define(["dojo/_base/lang","dojo/on","dojo/_base/html","dijit/a11yclick"],function(F,r,z,x){return{a11y_init:function(){z.setAttr(this.domNode,"tabindex","0");z.setAttr(this.domNode,"role","checkbox");this.setLabel(this.label);this.a11y_changeAriaCheckedAttr();this.own(r(this.domNode,
"focus",F.hitch(this,function(){z.addClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(r(this.domNode,"blur",F.hitch(this,function(){z.removeClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(r(this.domNode,x,F.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})))},a11y_changeAriaCheckedAttr:function(){z.setAttr(this.domNode,"aria-checked",this.checked?"true":"false")},a11y_setDisabled:function(n){n=n.toString();"false"===n?z.removeAttr(this.domNode,"disabled"):
z.setAttr(this.domNode,"disabled",n);z.setAttr(this.domNode,"aria-disabled",n)},a11y_updateAriaLabel:function(n){""===this.label?(z.setAttr(this.domNode,"title",this.title),z.setAttr(this.domNode,"aria-label",this.title)):z.setAttr(this.domNode,"aria-label",this.title?this.title:n)}}})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr dojo/Deferred dojox/gfx dojo/promise/all jimu/utils jimu/symbolUtils jimu/portalUrlUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font esri/arcgis/Portal esri/request jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency jimu/dijit/LoadingIndicator jimu/dijit/formSelect dijit/form/NumberSpinner".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C,D,G,H,L,T){return F([r,z,x,n,t],{templateString:v,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,isArrow:!1,symbol:null,type:null,DEFAULT_PORTAL_URL:"//arcgis.com/",_portalLoadTimeoutInMs:3E3,_isOnline:!0,_localTypes:"basic A-Z arrows business cartographic nationalParkService outdoorRecreation peoplePlaces safetyHealth shapes transportation damage disasters emergencyManagement generalInfrastructure localGovernment numbers pointsOfInterest stateGovernment FireFly".split(" "),
cropImage:!1,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser;this._setTemplateNls()},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(e(document.body,"click",m.hitch(this,this._onBodyClicked)));(this._isIE8=8===c("ie"))&&h.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(K){this.reset();var O=
K&&K.declaredClass;O&&"string"===typeof O&&0<=O.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(K),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(K){this.reset();
if("marker"===K||"line"===K||"fill"===K||"text"===K)this.type=K,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(K){var O=null;"marker"===this.type?O=this._getPointSymbolBySetting(K):"line"===this.type?O=this._getLineSymbolBySetting(K):"fill"===this.type?
O=this._getFillSymbolBySetting(K):"text"===this.type&&(O=this._getTextSymbolBySetting(K));K=null;O&&(K=this._cloneSymbol(O));return K},hideColorPicker:function(){for(var K="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),O=0,I=K.length;O<I;O++){var P=K[O];this[P]&&this[P].hideTooltipDialog()}},_onBodyClicked:function(K){K=K.target||K.srcElement;this._tryHideDropDownOfSelectDijit(K,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(K,this.lineStylesSelect)},
_tryHideDropDownOfSelectDijit:function(K,O){var I=O.domNode,P=O.dropDown.domNode;I=K===I||h.isDescendant(K,I);K=K===P||h.isDescendant(K,P);if(!I&&!K)O.dropDown.onCancel()},_onChange:function(K){K=this._cloneSymbol(K);this.emit("change",K)},_hideAllSections:function(){f(".symbol-section",this.domNode).style("display","none")},_showSection:function(K){this._hideAllSections();f("."+K+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(K,O,I){return l.getAncestorDom(K,O,I)},
_getAbsoluteUrl:function(K){return window.location.protocol+"//"+window.location.host+require.toUrl(K)},_cloneSymbol:function(K){if(!K)return null;var O=K;try{var I=K.toJson();O=u.fromJson(I);"fill"===this.type&&(O.arrowWidth=K.arrowWidth)}catch(P){console.error(P)}return O},_createSymbolIconTable:function(K,O,I){var P=this.type+"-icon-table";K=h.toDom('\x3ctable class\x3d"icon-table '+(P+" "+(P+"-"+K))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');P=f("tbody",K)[0];for(var Q=Math.ceil(O.length/
8),U=0;U<Q;U++)h.create("tr",{},P);var Y=f("tr",K);p.forEach(O,m.hitch(this,function(ca,da){var ma=m.clone(ca),na=u.fromJson(ca);da=h.create("td",{},Y[Math.floor(da/8)]);h.addClass(da,"symbol-td-item");na=this._createSymbolNode(na);h.addClass(na,"symbol-div-item");var va=na.firstChild;h.addClass(va,"svg-node");if(this._isIE8&&"point"===I)if(window.isRTL){if("Cross"===ca.name||"X"===ca.name)h.setStyle(va,"right","-20px"),h.setStyle(na,"marginTop","20px")}else"Cross"!==ca.name&&"X"!==ca.name||h.setStyle(na,
"marginTop","20px");na.symbol=ma;h.place(na,da)}));return K},_updatePreview:function(K){var O=this._cloneSymbol(this.symbol);h.empty(K);(O=q.createSymbolNode(O))||(O=h.create("div"));h.place(O,K)},_createSymbolNode:function(K){(K=q.createSymbolNode(K,{width:36,height:36}))||(K=h.create("div"));h.setStyle(K,{width:"36px",height:"36px"});return K},_getLineShapeDesc:function(K){var O=null;if(this.isSimpleLineSymbol(K)||this.isCartographicLineSymbol(K))O={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},
fill:null,stroke:K.getStroke()};return O},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new k({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());
this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(e(this.pointIconTables,".symbol-div-item:click",m.hitch(this,this._onPointSymIconItemClick)));this.own(e(this.pointSymClassSelect,"change",m.hitch(this,this._onPointSymClassSelectChange)));this.own(e(this.pointSize,"change",m.hitch(this,this._onPointSymbolChange,!1)));this.own(e(this.pointColor,"change",m.hitch(this,this._onPointSymbolChange,!1)));this.own(e(this.pointAlpha,"change",m.hitch(this,
this._onPointSymbolChange,!1)));this.own(e(this.pointOutlineColor,"change",m.hitch(this,this._onPointSymbolChange,!1)));this.own(e(this.pointOutlineWidth,"change",m.hitch(this,this._onPointSymbolChange,!1)))},_onPointSymbolChange:function(K){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(K),this._onChange(this.symbol))},_initPointSettings:function(K){if(K){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(K)){if(this.pointSize.set("value",K.size),this.pointColor.setColor(K.color),
this.pointAlpha.setAlpha(parseFloat(K.color.a.toFixed(2))),K=K.outline)this.pointOutlineColor.setColor(K.color),this.pointOutlineWidth.set("value",parseFloat(K.width.toFixed(0)))}else this.isPictureMarkerSymbol(K)&&this.pointSize.set("value",K.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(K){return K&&"esri.symbol.SimpleMarkerSymbol"===K.declaredClass},isPictureMarkerSymbol:function(K){return K&&"esri.symbol.PictureMarkerSymbol"===K.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===
this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var K=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+K]?(K=this.pointSymClassSelect.getOptions(K),this.pointSymClassSelect.domNode.title=
K?K.label:""):this._requestPointSymJson(K)}},_hideAllPointSymIconTable:function(){f(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();var K=this.pointSymClassSelect.get("value");K=f(".marker-icon-table-"+K,this.pointIconTables);0<K.length&&K.style("display","table")},_getLocalSymbols:function(K){K=K||this.pointSymClassSelect.get("value");K=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+K+".json");return b(K,
{handleAs:"json"})},_getPortalSymbolsByType:function(K){var O=new d;K?this._fetchSymbols(K).then(m.hitch(this,function(I){O.resolve(I)}),m.hitch(this,function(I){O.reject(I)})):O.reject(null);return O},_requestPointSymJson:function(K){this.pointSymClassSelect["def"+K]||(this.loadingShelter.show(),!this._isOnline&&window.isXT?this._offLineGetSymbols(K):this._symbolTypes?this._handleGetPointSymbols(m.hitch(this,this._getPortalSymbolsByType),K):this._initPortal().then(m.hitch(this,this._fetchSymbolTypes)).then(m.hitch(this,
function(O){this.domNode&&(this._clearOptions(),this._createOptions(O),this._handleGetPointSymbols(m.hitch(this,this._getPortalSymbolsByType),K))}),m.hitch(this,function(O){this.domNode&&(window.isXT?this._offLineGetSymbols(K):(this.loadingShelter.hide(),console.error("Fetching symbols failed",O)))})))},_offLineGetSymbols:function(K){this._isOnline=!1;if(0===this.pointSymClassSelect.options.length){var O=[];p.forEach(this._localTypes,m.hitch(this,function(I,P){O.push({id:P,title:this.nls[I]||I})}));
this._clearOptions();this._createOptions(O)}this._handleGetPointSymbols(m.hitch(this,this._getLocalSymbols),K)},_clearOptions:function(){this.pointSymClassSelect&&this.pointSymClassSelect.removeOption(this.pointSymClassSelect.options)},_createOptions:function(K){if(this.pointSymClassSelect){var O=[],I="",P=!1;"[object Array]"===Object.prototype.toString.call(K)&&0<K.length&&p.forEach(K,m.hitch(this,function(Q){I=Q.title||Q.name;P=Q.defaultType?!0:!1;I&&(Q.id||0===Q.id)&&O.push({label:I,value:Q.id,
selected:P})}));O.push({label:this.nls.customImage,value:"custom"});this.pointSymClassSelect.addOption(O)}},_initPortal:function(){var K=new d;if(this._portal)K.resolve();else{var O=A.getStandardPortalUrl(window.portalUrl),I=new H.Portal(O?O:this.DEFAULT_PORTAL_URL);if(I.loaded)return this._portal=I,K.resolve(),K.promise;this.own(I.on("load",m.hitch(this,function(){this._portal=I;K.resolve()})));setTimeout(function(){K.reject()},this._portalLoadTimeoutInMs)}return K},_handleGetPointSymbols:function(K,
O){if(this.pointSymClassSelect){var I=O||this.pointSymClassSelect.get("value");O="def"+I;K=K(I);this.pointSymClassSelect[O]=K;K.then(m.hitch(this,function(P){this.domNode&&(this.loadingShelter.hide(),this._getPointSymbolsSucess(I,P))}),m.hitch(this,function(P){this.domNode&&(this.loadingShelter.hide(),console.error("Fetching symbols failed",P))}))}},_getPointSymbolsSucess:function(K,O){if(this.domNode){var I=this.pointSymClassSelect.getOptions(K);this.pointSymClassSelect.domNode.title=I?I.label:"";
K=this._createSymbolIconTable(K,O,"point");h.place(K,this.pointIconTables);this._showSelectedPointSymIconTable()}},_fetchSymbols:function(K){var O=[],I=new d;O=this._symbolTypes.filter(function(P){return P.id===K});this._getSymbolListData(O).then(m.hitch(this,function(P){I.resolve(P)}),m.hitch(this,function(P){console.warn("fetch symbols failed",P);I.reject(P)}));return I},_getSymbolListData:function(K){K=p.filter(K,function(O){return O.dataUrl});K=p.map(K,function(O){return L({url:O.dataUrl}).promise});
return g(K).then(function(O){return O[0]})},_fetchSymbolTypes:function(){var K=new d;this._symbolTypes?K.resolve(this._symbolTypes):this._getSymbolListGroupId().then(m.hitch(this,this._getSymbolListItems)).then(m.hitch(this,function(O){this._symbolTypes=O;K.resolve(O)}),m.hitch(this,function(O){console.warn("fetch symbol types failed",O);K.reject(O)}));return K},_getSymbolListGroupId:function(){var K=new d;this._portal||K.reject("no portal");this._portal.queryGroups({q:this._portal.symbolSetsGroupQuery}).then(function(O){K.resolve(O.results[0].id)},
m.hitch(this,function(O){console.warn("get symbol list group id failed",O);K.reject(O)}));return K},_getSymbolListItems:function(K){var O=new d,I=this._portal;K="group:"+K+' AND type:"Symbol Set"';var P=[];this._portal||O.reject("no portal");K="vml"===a.renderer?K+' AND -typekeywords:"by value"':K+' AND (typekeywords:"by value" AND typekeywords:"marker")';I.queryItems({q:K,num:50,sortField:"title"}).then(m.hitch(this,function(Q){var U,Y,ca,da;p.forEach(Q.results,function(ma){U=ma.typeKeywords.join(" ");
-1<U.indexOf("marker")&&(Y=ma.title,ca={name:Y,id:ma.id,title:ma.title,keywords:U,dataUrl:ma.itemDataUrl},(da="Basic"===ma.name)?(ca.defaultType=!0,P.unshift(ca)):P.push(ca))},this);0<P.length?O.resolve(P):O.reject()}),function(){O.reject()});return O},_onPointSymIconItemClick:function(K){if(K=this._getAncestor(K.target||K.srcElement,function(I){return h.hasClass(I,"symbol-div-item")},5))if(f(".selected-symbol-div-item",K.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),h.addClass(K,
"selected-symbol-div-item"),K=K.symbol){this.symbol=u.fromJson(K);K=h.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange(!0);var O=h.getStyle(this.pointColorTr,"display");K!==O&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){h.addClass(this.pointCustomImageTr,"hidden");h.removeClass(this.pointIconTablesTr,"hidden");h.removeClass(this.pointColorTr,"hidden");
h.removeClass(this.pointOpacityTr,"hidden");h.removeClass(this.pointOutlineColorTr,"hidden");h.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){h.addClass(this.pointCustomImageTr,"hidden");h.removeClass(this.pointIconTablesTr,"hidden");h.addClass(this.pointColorTr,"hidden");h.addClass(this.pointOpacityTr,"hidden");h.addClass(this.pointOutlineColorTr,"hidden");h.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){h.removeClass(this.pointCustomImageTr,
"hidden");h.addClass(this.pointIconTablesTr,"hidden");h.addClass(this.pointColorTr,"hidden");h.addClass(this.pointOpacityTr,"hidden");h.addClass(this.pointOutlineColorTr,"hidden");h.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(K){if(!this.symbol||K&&!this.pointSize.validate())return null;var O=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(K&&!this.pointOutlineWidth.validate())return null;this.symbol.setSize(O);K=this.pointColor.getColor();
O=this.pointAlpha.getAlpha();K.a=O;this.symbol.setColor(K);K=this.pointOutlineColor.getColor();O=(O=parseFloat(this.pointOutlineWidth.get("value")))?O:0;var I=new y;I.setStyle(y.STYLE_SOLID);I.setColor(K);I.setWidth(O);this.symbol.setOutline(I)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(O),this.symbol.setHeight(O));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new T({cropImage:this.cropImage,customZIndex:this.customZIndex,
showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});h.addClass(this.imageChooser.domNode,"custom-image-chooser");this.own(e(this.imageChooser,"change",m.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(K,O){this.imageNameNode.innerHTML=O.fileName;K=K.replace(/^data:image\/.*;base64,/,"");O=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=
new w({type:"esriPMS",url:null,imageData:K,contentType:"image/png",color:null,width:O,height:O,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(e(this.lineIconTables,".symbol-div-item:click",m.hitch(this,this._onLineSymIconItemClick)));
this.own(e(this.lineColor,"change",m.hitch(this,this._onLineSymbolChange)));this.own(e(this.lineStylesSelect,"change",m.hitch(this,this._onLineSymbolChange)));this.own(e(this.lineAlpha,"change",m.hitch(this,this._onLineSymbolChange)));this.own(e(this.lineWidth,"change",m.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(K){K&&(this._invokeSymbolChangeEvent=!1,
this.lineColor.setColor(K.color),this.lineAlpha.setAlpha(parseFloat(K.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(K.width.toFixed(0))),this.lineStylesSelect.set("value",K.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(K){return K&&"esri.symbol.SimpleLineSymbol"===K.declaredClass},isCartographicLineSymbol:function(K){return K&&"esri.symbol.CartographicLineSymbol"===K.declaredClass},_requestLineSymJson:function(K){var O=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
K+".json");b(O,{handleAs:"json"}).then(m.hitch(this,function(I){this.domNode&&(I=this._createSymbolIconTable(K,I,"line"),h.place(I,this.lineIconTables))}),m.hitch(this,function(I){console.error("get line symbol failed",I)}))},_onLineSymIconItemClick:function(K){if(K=this._getAncestor(K.target||K.srcElement,function(O){return h.hasClass(O,"symbol-div-item")},5))if(f(".selected-symbol-div-item",K.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),h.addClass(K,"selected-symbol-div-item"),
K=K.symbol)K=u.fromJson(K),this._initLineSettings(K),this._onLineSymbolChange()},_getLineSymbolBySetting:function(K){if(K&&!this.lineWidth.validate())return null;this.symbol=new y;K=this.lineColor.getColor();var O=this.lineStylesSelect.get("value");K.a=this.lineAlpha.getAlpha();var I=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(O);this.symbol.setColor(K);this.symbol.setWidth(I);this._updatePreview(this.lineSymPreview);return this.symbol},setFillSectionType:function(K){K?h.addClass(this.fillSection,
"arrow-symbol-section"):(h.removeClass(this.fillSection,"arrow-symbol-section"),this.isArrow&&!this.arrowWidth.validate()&&this.arrowWidth.set("value",12));this.isArrow=K},_initFillSection:function(){this.setFillSectionType(this.isArrow);this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(e(this.fillIconTables,".symbol-div-item:click",
m.hitch(this,this._onFillSymIconItemClick)));this.own(e(this.fillColor,"change",m.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.fillAlpha,"change",m.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.fillOutlineColor,"change",m.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.fillOutlineWidth,"change",m.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.arrowWidth,"change",m.hitch(this,this._onFillSymbolChange,!1)))},_onFillSymbolChange:function(K){this._invokeSymbolChangeEvent&&
(this._getFillSymbolBySetting(K),this._onChange(this.symbol))},_initFillSettings:function(K){K&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(K.color),this.fillAlpha.setAlpha(parseFloat(K.color.a.toFixed(2))),K.outline&&(this.fillOutlineColor.setColor(K.outline.color),this.fillOutlineWidth.set("value",parseInt(K.outline.width,10))),this._invokeSymbolChangeEvent=!0,this.arrowWidth.set("value",parseInt(K.arrowWidth,10)))},_isSimpleFillSymbol:function(K){return K&&"esri.symbol.SimpleFillSymbol"===
K.declaredClass},_requestFillSymJson:function(K){var O=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+K+".json");b(O,{handleAs:"json"}).then(m.hitch(this,function(I){this.domNode&&(I=this._createSymbolIconTable(K,I,"fill"),h.place(I,this.fillIconTables))}),m.hitch(this,function(I){console.error("get fill symbol failed",I)}))},_onFillSymIconItemClick:function(K){if(K=this._getAncestor(K.target||K.srcElement,function(O){return h.hasClass(O,"symbol-div-item")},5))if(f(".selected-symbol-div-item",K.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),
h.addClass(K,"selected-symbol-div-item"),K=K.symbol)K=u.fromJson(K),K.arrowWidth=this.symbol.arrowWidth,this._initFillSettings(K),this._onFillSymbolChange()},_getFillSymbolBySetting:function(K){if(K&&(!this.fillOutlineWidth.validate()||this.isArrow&&!this.arrowWidth.validate()))return null;this.symbol=new C;var O=this.fillColor.getColor();O.a=this.fillAlpha.getAlpha();K=this.fillOutlineColor.getColor();var I=parseInt(this.fillOutlineWidth.get("value"),10);I=I?I:0;this.symbol.setColor(O);this.symbol.setStyle(C.STYLE_SOLID);
O=new y;O.setStyle(y.STYLE_SOLID);O.setColor(K);O.setWidth(I);this.symbol.setOutline(O);K=parseInt(this.arrowWidth.get("value"),10);this.symbol.arrowWidth=K;this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(e(this.inputText,"change",m.hitch(this,this._onTextSymbolChange)));
this.own(e(this.textColor,"change",m.hitch(this,this._onTextSymbolChange)));this.own(e(this.textFontSize,"change",m.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(K){K&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=K.text,this.textColor.setColor(K.color),K=parseInt(K.font.size,10),this.textFontSize.set("value",K),this._invokeSymbolChangeEvent=!0)},
_isTextSymbol:function(K){return K&&"esri.symbol.TextSymbol"===K.declaredClass},_updateTextPreview:function(K,O){var I=this.textColor.getColor().toHex(),P=parseInt(this.textFontSize.get("value"),10)+"px";h.setStyle(this.textPreview,{color:I,fontSize:P,fontFamily:O});this.textPreview.innerHTML=K},_getTextSymbolBySetting:function(K){var O=l.sanitizeHTML(this.inputText.value);if(K&&(""===O.replace(/^\s+|\s+$/g,"")||!this.textFontSize.validate()))return null;this.symbol=new D;K=this.textColor.getColor();
var I=parseInt(this.textFontSize.get("value"),10),P=new G;P.setSize(I);this.symbol.setText(O);this.symbol.setColor(K);this.symbol.setFont(P);this._updateTextPreview(O,P.family);return this.symbol},_setTemplateNls:function(){"undefined"===typeof this.nls.damage&&(this.nls.damage="Damage");"undefined"===typeof this.nls.disasters&&(this.nls.disasters="Disasters");"undefined"===typeof this.nls.emergencyManagement&&(this.nls.emergencyManagement="Emergency Management");"undefined"===typeof this.nls.generalInfrastructure&&
(this.nls.generalInfrastructure="General Infrastructure");"undefined"===typeof this.nls.localGovernment&&(this.nls.localGovernment="Local Government");"undefined"===typeof this.nls.numbers&&(this.nls.numbers="Numbers");"undefined"===typeof this.nls.pointsOfInterest&&(this.nls.pointsOfInterest="Points of Interest");"undefined"===typeof this.nls.stateGovernment&&(this.nls.stateGovernment="State Government")}})})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){var f={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},b=function(y){function C(D){y[D]||(y[D]=function(){var G=arguments;return x.when(y,function(H){Array.prototype.unshift.call(G,H.results||H);return b(n[D].apply(n,G))})})}if(!y)return y;y.then&&(y=r.delegate(y));y.total||(y.total=x.when(y,function(D){return h.isDefined(D.total)?D.total:D.length||0}));C("forEach");C("filter");C("map");C("some");C("every");return y},d={useSSL:function(y,C){var D=f&&
f.self||{};if(D&&!D.isPortal)return-1!==y.indexOf("https:")||D.allSSL?C.replace("http:","https:"):C;var G=d.getLocation(C);return-1<D.portalHostname.toLowerCase().indexOf(G.hostname.toLowerCase())&&G.port&&"80"!==G.port&&"443"!==G.port?(C=G.pathname,C=0===C.indexOf("/")?C:"/"+C,D.allSSL||-1<y.indexOf("https:")?"https://"+G.hostname+(D.httpsPort&&"443"!==D.httpsPort?":"+D.httpsPort:"")+C+G.search:"http://"+G.hostname+(D.httpPort&&"80"!==D.httpPort?":"+D.httpPort:"")+C+G.search):-1!==y.indexOf("https:")||
D.allSSL?C.replace("http:","https:"):C},formatUrl:function(y){var C=f.currentToken;return-1!==y.indexOf("null")?null:d.useSSL(window.location.protocol,C?y+(-1!==y.indexOf("?")?"\x26":"?")+("token\x3d"+C):y)},getLocation:function(y){var C=document.createElement("a");C.href=y;return{protocol:C.protocol,hostname:C.hostname,port:C.port,pathname:C.pathname,search:C.search,hash:C.hash,host:C.host}},resultsToTypedArray:function(y,C,D){D=D?D.listings||D.notifications||D.userInvitations||D.tags||D.items||
D.groups||D.comments||D.provisions||D.results||D:[];return n.map(D,function(G){G=r.mixin(G,C||{});return y?new y(G):G})},clearFieldsFromObject:function(y,C){var D,G=y.length;if(r.isArray(y))for(D=0;D<G;D++)delete C[y[D]];else for(D in y)delete C[D];return C},requestToTypedArray:function(y,C,D,G,H){return b(d.request(y,C,D).then(r.partial(d.resultsToTypedArray,G,H)))},request:function(y,C,D){C&&C.portal&&delete C.portal;if(C&&C.form){var G=C.form;delete C.form}C=r.mixin(r.mixin({},C||{}),f.requestParams);
D=r.mixin(D||{},f.options);return p({url:d.useSSL(window.location.protocol,y.url||y),content:C,callbackParamName:"callback",timeout:D&&D.timeout||0,form:G},D)},formatQueryParams:function(y,C,D){y=r.mixin(r.mixin({},y),r.isString(C)?{q:C}:C||{});y.q=!D&&f.extraQuery?"("+y.q+")"+f.extraQuery:y.q;return y}},a=F([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(y){r.mixin(this,y);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),
g=F([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(y){r.mixin(this,y);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),l=F([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(y){r.mixin(this,y);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+
(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=d.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=d.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var y=this.type;return{source:-1<
n.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===y?y:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(y){var C=r.isString(y)?{comment:y}:y;return d.request(this.itemUrl+"/addComment",C,{usePost:!0}).then(r.hitch(this,function(D){return new a(r.mixin(C,{id:D.commentId,item:this}))}))},updateComment:function(y){if(y&&y.url&&y.comment)return d.request(y.url+"/update",{comment:y.comment},
{usePost:!0}).then(function(C){y.id=C.commentId;return y});throw Error();},getComments:function(){return d.requestToTypedArray(this.itemUrl+"/comments",null,null,a,{item:this})},deleteComment:function(y){if(y&&y.url)return d.request(y.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(y){var C=r.isObject(y)?y:{rating:parseFloat(y)};return d.request(this.itemUrl+"/addRating",C,{usePost:!0}).then(r.hitch(this,function(D){return new g(r.mixin(C,{id:D.ratingId,item:this}))}))},getRating:function(){return d.request(this.itemUrl+
"/rating").then(r.hitch(this,function(y){return new g(r.mixin(y,{item:this}))}))},deleteRating:function(){return d.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var y=this.type,C=this.typeKeywords||[],D=y;"Feature Service"===y||"Feature Collection"===y?D=-1<n.indexOf(C,"Table")?"Table":-1<n.indexOf(C,"Route Layer")?"Route Layer":-1<n.indexOf(C,"Markup")?"Markup":"Feature Layer":"Image Service"===y?D=-1<n.indexOf(C,"Elevation 3D Layer")?"Elevation Layer":-1<n.indexOf(C,
"Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===y?D="Scene Layer":"Scene Package"===y?D="Scene Layer Package":"Stream Service"===y?D="Feature Layer":"Geoprocessing Service"===y&&this.portal&&this.portal.isPortal?D=-1<n.indexOf(C,"Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===y?D="GeoEnrichment Service":"Geocoding Service"===y?D="Locator":"Microsoft Powerpoint"===y?D="Microsoft PowerPoint":"GeoJson"===y?this.type=D="GeoJSON":"Globe Service"===y?D="Globe Layer":
"Vector Tile Service"===y?D="Tile Layer":"netCDF"===y?D="NetCDF":"Map Service"===y?D=-1===n.indexOf(C,"Spatiotemporal")&&(-1<n.indexOf(C,"Hosted Service")||-1<n.indexOf(C,"Tiled"))&&-1===n.indexOf(C,"Relational")?"Tile Layer":"Map Image Layer":y&&-1<y.toLowerCase().indexOf("add in")?D=y.replace(/(add in)/ig,"Add-In"):"datastore catalog service"===y?D="Big Data File Share":"Compact Tile Package"===y?D="Tile Package (tpkx)":"Raster function template"===y&&(D="Raster Function Template");return D},_getIconUrl:function(){var y=
this.type&&this.type.toLowerCase()||"",C=this.typeKeywords||[],D=!1,G=!1,H=!1,L=!1,T=!1,K=!1;G=!1;0<y.indexOf("service")||"feature collection"===y||"kml"===y||"wms"===y||"wmts"===y||"wfs"===y?(D=-1<n.indexOf(C,"Hosted Service"),"feature service"===y||"feature collection"===y||"kml"===y||"wfs"===y?(L=-1<n.indexOf(C,"Table"),G=-1<n.indexOf(C,"Route Layer"),H=-1<n.indexOf(C,"Markup"),T=-1!==n.indexOf(C,"Spatiotemporal"),K=-1!==n.indexOf(C,"UtilityNetwork"),y=T&&L?"spatiotemporaltable":L?"table":G?"routelayer":
H?"markup":T?"spatiotemporal":K?"utilitynetwork":D?"featureshosted":"features"):"map service"===y||"wms"===y||"wmts"===y?(T=-1!==n.indexOf(C,"Spatiotemporal"),G=-1!==n.indexOf(C,"Relational"),y=T||G?"mapimages":D||-1<n.indexOf(C,"Tiled")||"wmts"===y?"maptiles":"mapimages"):y="scene service"===y?-1<n.indexOf(C,"Line")?"sceneweblayerline":-1<n.indexOf(C,"3DObject")?"sceneweblayermultipatch":-1<n.indexOf(C,"Point")?"sceneweblayerpoint":-1<n.indexOf(C,"IntegratedMesh")?"sceneweblayermesh":-1<n.indexOf(C,
"PointCloud")?"sceneweblayerpointcloud":-1<n.indexOf(C,"Polygon")?"sceneweblayerpolygon":-1<n.indexOf(C,"Building")?"sceneweblayerbuilding":"sceneweblayer":"image service"===y?-1<n.indexOf(C,"Elevation 3D Layer")?"elevationlayer":-1<n.indexOf(C,"Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===y?"streamlayer":"vector tile service"===y?"vectortile":"datastore catalog service"===y?"datastorecollection":"geocoding service"===y?"geocodeservice":"geoprocessing service"===y?-1<n.indexOf(C,
"Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"knowledge graph service"===y?"knowledgegraph":"layers"):y="web map"===y||"cityengine web scene"===y?"maps":"web scene"===y?-1<n.indexOf(C,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===y||"mobile application"===y||"application"===y||"operation view"===y||"desktop application"===y?"apps":"map document"===y||"map package"===y||"published map"===y||"scene document"===y||"globe document"===y||"basemap package"===
y||"mobile basemap package"===y||"mobile map package"===y||"project package"===y||"project template"===y||"pro map"===y||"layout"===y||"layer"===y&&-1<n.indexOf(C,"ArcGIS Pro")||"explorer map"===y&&n.indexOf(C,"Explorer Document")?"mapsgray":"service definition"===y||"csv"===y||"shapefile"===y||"cad drawing"===y||"geojson"===y||"360 vr experience"===y||"netcdf"===y||"administrative report"===y?"datafiles":"explorer add in"===y||"desktop add in"===y||"windows viewer add in"===y||"windows viewer configuration"===
y?"appsgray":"arcgis pro add in"===y||"arcgis pro configuration"===y?"addindesktop":"rule package"===y||"file geodatabase"===y||"sqlite geodatabase"===y||"csv collection"===y||"kml collection"===y||"windows mobile package"===y||"map template"===y||"desktop application template"===y||"gml"===y||"arcpad package"===y||"code sample"===y||"form"===y||"document link"===y||"operations dashboard add in"===y||"rules package"===y||"image"===y||"workflow manager package"===y||"explorer map"===y&&-1<n.indexOf(C,
"Explorer Mapping Application")||-1<n.indexOf(C,"Document")?"datafilesgray":"network analysis service"===y||"geoprocessing service"===y||"geodata service"===y||"geometry service"===y||"geoprocessing package"===y||"locator package"===y||"geoprocessing sample"===y||"workflow manager service"===y?"toolsgray":"layer"===y||"layer package"===y||"explorer layer"===y?"layersgray":"scene package"===y?"scenepackage":"mobile scene package"===y?"mobilescenepackage":"tile package"===y||"compact tile package"===
y?"tilepackage":"task file"===y?"taskfile":"report template"===y?"report-template":"statistical data collection"===y?"statisticaldatacollection":"insights workbook"===y?"workbook":"insights model"===y?"insightsmodel":"insights page"===y?"insightspage":"insights theme"===y?"insightstheme":"hub initiative"===y?"hubinitiative":"hub page"===y?"hubpage":"hub site application"===y?"hubsite":"hub event"===y?"hubevent":"relational database connection"===y?"relationaldatabaseconnection":"big data file share"===
y?"datastorecollection":"image collection"===y?"imagecollection":"desktop style"===y?"desktopstyle":"style"===y?"style":"dashboard"===y?"dashboard":"raster function template"===y?"rasterprocessingtemplate":"vector tile package"===y?"vectortilepackage":"ortho mapping project"===y?"orthomappingproject":"ortho mapping template"===y?"orthomappingtemplate":"solution"===y?"solutions":"geopackage"===y?"geopackage":"deep learning package"===y?"deeplearningpackage":"real time analytic"===y?"realtimeanalytics":
"big data analytic"===y?"bigdataanalytics":"feed"===y?"feed":"excalibur imagery project"===y?"excaliburimageryproject":"notebook"===y?"notebook":"storymap"===y?"storymap":"survey123 add in"===y?"survey123addin":"mission"===y?"mission":"mission report"===y?"missionreport":"quickcapture project"===y?"quickcaptureproject":"pro report"===y?"proreport":"urban model"===y?"urbanmodel":"web experience"===y?"experiencebuilder":"web experience template"===y?"webexperiencetemplate":"workflow"===y?"workflow":
"kernel gateway connection"===y?"kernelgatewayconnection":"insights script"===y?"insightsscript":"hub initiative template"===y?"hubinitiativetemplate":"storymap theme"===y?"storymaptheme":"maps";return y?t.toUrl("../css/images/item_type_icons/"+y+"16.png"):null},_getIsPremiumContent:function(){var y=this.typeKeywords,C=!1;if(-1<n.indexOf(y,"Requires Subscription")||-1<n.indexOf(y,"Requires Credits"))C=!0;return C},_getPremiumIconUrl:function(){var y=this.typeKeywords,C;this.isPremiumContent&&(C=-1<
n.indexOf(y,"Requires Credits")?"premiumcredits":"premiumitem");return C?t.toUrl("../css/images/item_type_icons/"+C+"16.png"):null},getThumbnailUrl:function(y){var C=this.thumbnailUrl;C&&y&&(C+=(-1===C.indexOf("?")?"?":"\x26")+"w\x3d"+y);return C}}),q=F([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(y){r.mixin(this,y);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";
this.created=this.created?new Date(this.created):null;this.banner=this.banner?d.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?d.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?d.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",
trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var C in this.listingProperties)this[C]&&(this.listingProperties[C]=this[C]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=n.map(this.screenshots,r.hitch(this,function(D){return d.formatUrl(this.url+"/info/"+D)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?d.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):
d.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return d.requestToTypedArray(this.commentsUrl,null,null,a,{item:this})},getVendor:function(){return this.vendor}}),A=F([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(y){r.mixin(this,y);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=y.listing?
new q(r.mixin(y.listing,{portal:this.portal})):null}}),u=F([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(y){r.mixin(this,y);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=d.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return d.request(this.url+"/users")},queryItems:function(y,C){y=d.formatQueryParams({},
y,C);y.q="group:"+this.id+(y.q?" "+y.q:"");return this.portal.queryItems(y)},getThumbnailUrl:function(y){var C=this.thumbnailUrl;C&&y&&(C+=(-1===C.indexOf("?")?"?":"\x26")+"w\x3d"+y);return C}}),k=F([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(y){r.mixin(this,y);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return d.requestToTypedArray(this.url,null,null,l,{portal:this.portal,
folderId:this.id})}}),w=F([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(y){r.mixin(this,y);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?d.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return b(d.request(this.url).then(r.hitch(this,
function(y){return d.resultsToTypedArray(u,{portal:this.portal},y.groups)})))},getNotifications:function(){return d.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return d.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return d.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return b(this.getContent(null,{num:1}).then(function(y){return y.folders}))},
getItems:function(y){return b(this.getContent(y).then(function(C){return C.items}))},getItem:function(y){return d.request(this.portal.portalUrl+"content/items/"+y).then(r.hitch(this,function(C){return new l(r.mixin(C,{portal:this.portal}))}))},getContent:function(y,C){var D=this.url.replace("/community/","/content/")+(y?"/"+y:"");return d.request(D,C).then(r.hitch(this,function(G){G.folders=d.resultsToTypedArray(k,{portal:this.portal},G.folders);G.items=d.resultsToTypedArray(l,{portal:this.portal,
folderId:y},G.items);return G}))},getThumbnailUrl:function(y){var C=this.thumbnailUrl;C&&y&&(C+=(-1===C.indexOf("?")?"?":"\x26")+"w\x3d"+y);return C}});F={Portal:F([c],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(y){y=r.isObject(y)?y:{url:y};this.registerConnectEvents();f={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};y.self?(f.self=y.self,r.mixin(this,{url:y.url||e.getProtocolForWebResource()+"//"+(y.self.urlKey?y.self.urlKey+"."+
y.self.customBaseUrl:y.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",y=y.self.user?this.signIn():this.init(this.url)):(y.url&&r.mixin(this,{url:y.url}),y=this.init(this.url));y.then(r.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(y,C){y=(y||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==y.indexOf("/sharing")?y+"/":y+"/sharing/rest/";return this._getSelf(this.portalUrl).then(r.hitch(this,function(D){f.self=
r.mixin({},D);(D=D.user)&&C&&(f.currentToken=C&&C.token,f.loggedInUser=new w(r.mixin(D,{portal:this,credential:C})));f.self.id&&!1===f.self.canSearchPublic&&(f.extraQuery=" AND orgid:"+f.self.id);r.mixin(this,f.self);this.thumbnailUrl=d.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length?!0:!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),r.hitch(this,function(D){this.onError(D);
throw D;}))},signIn:function(){var y=new x,C=r.hitch(this,function(){this._onSignIn().then(r.hitch(this,function(){y.resolve(f.loggedInUser)}),r.hitch(this,function(D){y.reject(D)}))});if(f&&f.self)f&&f.loggedInUser?setTimeout(function(){y.resolve(f.loggedInUser)},0):C();else this.on("load",r.hitch(this,function(){C()}));return y},signOut:function(){f.loggedInUser.credential&&f.loggedInUser.credential.destroy();f.loggedInUser=null;f.options.disableIdentityLookup=!0;d.clearFieldsFromObject(f.self,
this);f.self=null;return this.init(this.url)},getPortalUser:function(){return f.loggedInUser},addResource:function(y,C){return d.request(this.portalUrl+"portals/self/addResource",{key:y,text:C},{usePost:!0})},update:function(y){return d.request(this.portalUrl+"portals/self/update",y,{usePost:!0})},queryGroups:function(y,C){return this._queryPortal(this.portalUrl+"community/groups",d.formatQueryParams({},y,C),u)},queryItems:function(y,C){return this._queryPortal(this.portalUrl+"search",d.formatQueryParams({},
y,C),l)},queryListings:function(y){y=d.formatQueryParams({},y,!0);var C="";y.q&&-1<y.q.toLowerCase().indexOf("mylistings:true")?(y.q=y.q.toLowerCase().replace("mylistings:true",""),C="?mylistings\x3dtrue"):y.q||(y.q='""');return this._queryPortal(this.portalUrl+"content/listings"+C,y,q)},queryCustomerList:function(y,C){y=d.formatQueryParams({},y,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",y)},getProvisions:function(){return this.getCustomers().then(r.hitch(this,function(y){return y.purchases}))},
getInterests:function(){return this.getCustomers().then(r.hitch(this,function(y){return y.interests}))},getTrials:function(){return this.getCustomers().then(r.hitch(this,function(y){return y.trials}))},getCustomers:function(y){return d.request(this.portalUrl+"portals/self/customers",{status:y||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(y){return y.purchases})},getMyInterests:function(){return this.getPurchases().then(function(y){return y.interests})},getPurchases:function(){return d.request(this.portalUrl+
"portals/self/purchases").then(r.hitch(this,function(y){y.interests=n.map(y.interests,function(C){return r.mixin(C.provision,{listing:C.listing})});y.purchases=n.map(y.purchases,function(C){return r.mixin(C.provision,{listing:C.listing})});y.trials=n.map(y.trials,function(C){return r.mixin(C.provision,{listing:C.listing})});y.interests=d.resultsToTypedArray(A,{portal:this},y.interests);y.trials=d.resultsToTypedArray(A,{portal:this},y.trials);y.purchases=d.resultsToTypedArray(A,{portal:this},y.purchases);
return y}))},queryUsers:function(y,C){return this._queryPortal(this.portalUrl+"community/users",d.formatQueryParams({sortField:"username"},y,C),w)},_onSignIn:function(){f.options.disableIdentityLookup=!1;f.self=null;return m.id.getCredential(this.portalUrl).then(r.hitch(this,"init",this.url)).then(function(){return f.loggedInUser},r.hitch(this,function(y){f.options.disableIdentityLookup=!0;this.onError(y);throw y;}))},_getSelf:function(y){y+="portals/self";if(f.self){var C=new x;setTimeout(function(){C.resolve(f.self)},
0)}else C=d.request(y,{culture:z.locale});return C},_queryPortal:function(y,C,D){var G=r.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},C),H=["start","query","num","nextStart"];y=d.request(y,G).then(r.hitch(this,function(L){L.results=d.resultsToTypedArray(D,{portal:this},L);L.queryParams=r.mixin({},G);L.nextQueryParams=r.mixin(G,{start:L.nextStart});return d.clearFieldsFromObject(H,L)}));y=r.delegate(y);y.queryParams=r.mixin({},G);y.nextQueryParams=x.when(y,function(L){return L.nextQueryParams});
return b(y)}}),PortalFolder:k,PortalGroup:u,PortalItem:l,PortalUser:w,PortalComment:a,PortalRating:g,PortalUtil:d,PortalResult:b,PortalListing:q};v("extend-esri")&&r.mixin(r.getObject("arcgis",!0,m),F);return F})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){var a=0;F=r([z,x,F],{templateString:m,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,stretchImg:!0,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,customZIndex:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},
postCreate:function(){this._initial();e.file.supportHTML5()||h("safari")||!e.file.isEnabledFlash()||e.file.loadFileAPI().then(n.hitch(this,function(){v.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(g){this.goldenWidth=g.width;this.goldenHeight=g.height},disableChooseImage:function(){v.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&v.addClass(this.displayText,"disable-label");v.removeAttr(this.domNode,"title")},enableChooseImage:function(){v.setStyle(this.fileForm,
"display","block");this.label&&"string"===typeof this.label&&v.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(g){this.defaultSelfSrc=g;this.imageData=this.selfImg.src=g},getImageData:function(){return this.imageData},_initial:function(){this._initFileForm();this._processProperties();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=e.sanitizeHTML(this.label),v.setStyle(this.hintText,
"display","block"));this.showSelfImg&&v.setStyle(this.hintImage,"display","block");!1===this.stretchImg?v.addClass(this.selfImg,"no-stretch-img"):v.removeClass(this.selfImg,"no-stretch-img");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var g="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?g=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(g=this.format.join(","));v.setAttr(this.fileInput,
"accept",g)}e.file.supportHTML5()||h("safari")||!e.file.isEnabledFlash()||v.setStyle(this.fileInput,{width:"100%",height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_newMessage:function(g){this.msgPopupOpen=!0;this.msgPopup=new b({customZIndex:this.customZIndex,message:g})},_porcessMaskClick:function(){v.setAttr(this.fileInput,"id","imageChooser_"+a);v.setAttr(this.mask,"for","imageChooser_"+a);a++;t.once(this.mask,"click",n.hitch(this,function(g){g.stopPropagation();if(h("safari")&&
7>h("safari"))this._newMessage(this.nls.unsupportReaderAPI),g.preventDefault();else{if(!e.file.supportHTML5()){if(!e.file.isEnabledFlash()){var l=v.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,target:"_blank"});this._newMessage(l);g.preventDefault();return}if(!e.file.supportFileAPI()){this._newMessage(this.nls.unsupportReaderAPI);g.preventDefault();return}}v.setStyle(this.fileInput,"display","none");setTimeout(n.hitch(this,function(){v.setStyle(this.fileInput,
"display","block")}),200)}}))},triggerImgUpload:function(){var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!1);this.mask.dispatchEvent(g)},_addTip:function(){if(this.showTip){var g=p.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);v.setAttr(this.domNode,"title",g)}else v.setAttr(this.domNode,"title","")},_onFileInputChange:function(g){var l=g.target.files&&g.target.files[0]||g.files&&g.files[0];if(this.format&&-1===this.format.indexOf(l.type))this._newMessage(this.nls.invalidType),
this._initFileForm();else{var q=1024*this.maxSize;e.file.readFile(g,"image/*",q,n.hitch(this,function(A,u,k){A?(u=this.nls[A.errCode],"exceed"===A.errCode&&(u=u.replace("1024",q/1024)),this._newMessage(u)):(this.fileProperty.fileName=u,this.cropImage&&"image/gif"!==l.type?this._cropImageByUser(k,l.type):this._readFileData(k));this._initFileForm()}))}},_initFileForm:function(){this.mask&&v.destroy(this.mask);this.fileInput&&v.destroy(this.fileInput);this.fileForm&&v.destroy(this.fileForm);this.fileForm=
v.create("form",{"data-dojo-attach-point":"fileForm"},this.domNode);this.mask=v.create("label",{"data-dojo-attach-point":"mask"},this.fileForm);this.fileInput=v.create("input",{type:"file","data-dojo-attach-point":"fileInput"},this.fileForm);this._porcessMaskClick();t.once(this.fileInput,"change",n.hitch(this,this._onFileInputChange))},_readFileData:function(g){this.onImageChange(g,this.fileProperty);this.displayImg&&v.setAttr(this.displayImg,"src",g);this.showSelfImg&&(this.selfImg?v.setAttr(this.selfImg,
"src",g):this.selfImg.src=g,(g=v.getMarginBox(this.hintImage))&&g.w&&g.h&&(v.style(this.selfImg,"maxWidth",g.w+"px"),v.style(this.selfImg,"maxHeight",g.h+"px")))},_cropImageByUser:function(g,l){var q=new c({imageSrc:g,type:l,nls:n.clone(this.nls),goldenWidth:this.goldenWidth,goldenHeight:this.goldenHeight}),A=new d({hidden:!0});this.cropPopupOpen=!0;this.cropPopup=new f({titleLabel:this.nls.cropImage,content:q,customZIndex:this.customZIndex,width:500,height:480,buttons:[{label:this.nls.common.ok,
onClick:n.hitch(this,function(){A.show();var u=q.getData();u&&this._readFileData(u);this.cropPopup.close();q.destroy();A.hide()})}]});A.placeAt(this.cropPopup.domNode);q.startup();v.addClass(this.cropPopup.domNode,"image-chooser-crop-popup")},onImageChange:function(g){this.imageData=g;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});F.GIF="image/gif";F.JPEG="image/jpeg";F.PNG="image/png";return F})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message libs/cropperjs/cropperjs xstyle/css!libs/cropperjs/cropper.css dojo/NodeList-dom".split(" "),
function(F,r,z,x,n,v,t,m,h){return F([n,v],{templateString:t,imageSrc:null,type:null,goldenWidth:4,goldenHeight:3,_haveShowReadErrMsg:!1,postCreate:function(){this.type||(this.type="image/jpeg");this.setImageSrc(this.imageSrc);this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this._checkImgError();this.own(x(this.baseImage,"load",z.hitch(this,function(){r.setStyle(this.loadingImg,"display","none");this._initCropper()})))},_initCropper:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();
this.cropper=new h(this.baseImage,{aspectRatio:this.goldenWidth/this.goldenHeight,preview:".img-preview"})},setImageSrc:function(p){r.setAttr(this.baseImage,"src",p)},getData:function(){try{var p=this.cropper.getCroppedCanvas();this.cropper.getCroppedCanvas();return p.toDataURL(this.type||"image/jpeg")}catch(e){return this._readError(),null}},destroy:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.inherited(arguments)},_checkImgError:function(){setTimeout(z.hitch(this,function(){"none"!==
r.getStyle(this.loadingImg,"display")&&this._readError()}),5E3)},_readError:function(){this._haveShowReadErrMsg||(new m({message:this.nls.readError}),this._haveShowReadErrMsg=!0)}})})},"libs/cropperjs/cropperjs":function(){!function(F,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(F=F||self).Cropper=r()}(this,function(){function F(R){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Z){return typeof Z}:
function(Z){return Z&&"function"==typeof Symbol&&Z.constructor===Symbol&&Z!==Symbol.prototype?"symbol":typeof Z})(R)}function r(R,Z){for(var W=0;W<Z.length;W++){var ba=Z[W];ba.enumerable=ba.enumerable||!1;ba.configurable=!0;"value"in ba&&(ba.writable=!0);Object.defineProperty(R,ba.key,ba)}}function z(R){if(!(R=function(Z){if(Array.isArray(Z)){for(var W=0,ba=Array(Z.length);W<Z.length;W++)ba[W]=Z[W];return ba}}(R)||function(Z){if(Symbol.iterator in Object(Z)||"[object Arguments]"===Object.prototype.toString.call(Z))return Array.from(Z)}(R)))throw new TypeError("Invalid attempt to spread non-iterable instance");
return R}function x(R){return"number"==typeof R&&!ya(R)}function n(R){return"object"===F(R)&&null!==R}function v(R){if(!n(R))return!1;try{var Z=R.constructor,W=Z.prototype;return Z&&W&&wa.call(W,"isPrototypeOf")}catch(ba){return!1}}function t(R){return"function"==typeof R}function m(R){return Array.from?Array.from(R):M.call(R)}function h(R,Z){return R&&t(Z)&&(Array.isArray(R)||x(R.length)?m(R).forEach(function(W,ba){Z.call(R,W,ba,R)}):n(R)&&Object.keys(R).forEach(function(W){Z.call(R,R[W],W,R)})),
R}function p(R){var Z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1E11;return E.test(R)?Math.round(R*Z)/Z:R}function e(R,Z){var W=R.style;h(Z,function(ba,ha){J.test(ha)&&x(ba)&&(ba="".concat(ba,"px"));W[ha]=ba})}function c(R,Z){if(Z)if(x(R.length))h(R,function(ba){c(ba,Z)});else if(R.classList)R.classList.add(Z);else{var W=R.className.trim();W?0>W.indexOf(Z)&&(R.className="".concat(W," ").concat(Z)):R.className=Z}}function f(R,Z){Z&&(x(R.length)?h(R,function(W){f(W,Z)}):R.classList?R.classList.remove(Z):
0<=R.className.indexOf(Z)&&(R.className=R.className.replace(Z,"")))}function b(R,Z,W){Z&&(x(R.length)?h(R,function(ba){b(ba,Z,W)}):W?c(R,Z):f(R,Z))}function d(R){return R.replace(N,"$1-$2").toLowerCase()}function a(R,Z){return n(R[Z])?R[Z]:R.dataset?R.dataset[Z]:R.getAttribute("data-".concat(d(Z)))}function g(R,Z,W){n(W)?R[Z]=W:R.dataset?R.dataset[Z]=W:R.setAttribute("data-".concat(d(Z)),W)}function l(R,Z,W){var ba=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},ha=W;Z.trim().split(S).forEach(function(ia){if(!V){var ta=
R.listeners;ta&&ta[ia]&&ta[ia][W]&&(ha=ta[ia][W],delete ta[ia][W],0===Object.keys(ta[ia]).length&&delete ta[ia],0===Object.keys(ta).length&&delete R.listeners)}R.removeEventListener(ia,ha,ba)})}function q(R,Z,W){var ba=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},ha=W;Z.trim().split(S).forEach(function(ia){if(ba.once&&!V){var ta=R.listeners,oa=void 0===ta?{}:ta;ha=function(){delete oa[ia][W];R.removeEventListener(ia,ha,ba);for(var xa=arguments.length,sa=Array(xa),ua=0;ua<xa;ua++)sa[ua]=
arguments[ua];W.apply(R,sa)};oa[ia]||(oa[ia]={});oa[ia][W]&&R.removeEventListener(ia,oa[ia][W],ba);oa[ia][W]=ha;R.listeners=oa}R.addEventListener(ia,ha,ba)})}function A(R,Z,W){var ba;return t(Event)&&t(CustomEvent)?ba=new CustomEvent(Z,{detail:W,bubbles:!0,cancelable:!0}):(ba=document.createEvent("CustomEvent")).initCustomEvent(Z,!0,!0,W),R.dispatchEvent(ba)}function u(R){R=R.getBoundingClientRect();return{left:R.left+(window.pageXOffset-document.documentElement.clientLeft),top:R.top+(window.pageYOffset-
document.documentElement.clientTop)}}function k(R){R=R.match(fa);return null!==R&&(R[1]!==aa.protocol||R[2]!==aa.hostname||R[3]!==aa.port)}function w(R){var Z="timestamp\x3d".concat((new Date).getTime());return R+(-1===R.indexOf("?")?"?":"\x26")+Z}function y(R){var Z=R.rotate,W=R.scaleX,ba=R.scaleY,ha=R.translateX;R=R.translateY;var ia=[];x(ha)&&0!==ha&&ia.push("translateX(".concat(ha,"px)"));x(R)&&0!==R&&ia.push("translateY(".concat(R,"px)"));x(Z)&&0!==Z&&ia.push("rotate(".concat(Z,"deg)"));x(W)&&
1!==W&&ia.push("scaleX(".concat(W,")"));x(ba)&&1!==ba&&ia.push("scaleY(".concat(ba,")"));Z=ia.length?ia.join(" "):"none";return{WebkitTransform:Z,msTransform:Z,transform:Z}}function C(R,Z){var W=R.pageX;R=R.pageY;var ba={endX:W,endY:R};return Z?ba:B({startX:W,startY:R},ba)}function D(R){var Z=R.aspectRatio,W=R.height,ba=R.width,ha=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"contain",ia=0<ba&&ba<1/0,ta=0<W&&W<1/0;ia&&ta?(ia=W*Z,"contain"===ha&&ba<ia||"cover"===ha&&ia<ba?W=ba/Z:ba=W*Z):
ia?W=ba/Z:ta&&(ba=W*Z);return{width:ba,height:W}}function G(R){R=new DataView(R);try{var Z,W;if(255===R.getUint8(0)&&216===R.getUint8(1))for(var ba=R.byteLength,ha=2;ha+1<ba;){if(255===R.getUint8(ha)&&225===R.getUint8(ha+1)){var ia=ha;break}ha+=1}if(ia){ba=ia+10;var ta=ia+4;ia=4;ha="";for(ia+=ta;ta<ia;ta+=1)ha+=ea(R.getUint8(ta));if("Exif"===ha){var oa=R.getUint16(ba);if(((Z=18761===oa)||19789===oa)&&42===R.getUint16(ba+2,Z)){var xa=R.getUint32(ba+4,Z);8<=xa&&(W=ba+xa)}}}if(W){var sa,ua,za=R.getUint16(W,
Z);for(ua=0;ua<za;ua+=1)if(sa=W+12*ua+2,274===R.getUint16(sa,Z)){sa+=8;var Ba=R.getUint16(sa,Z);R.setUint16(sa,1,Z);break}}}catch(Ea){Ba=1}return Ba}var H="undefined"!=typeof window,L=H?window:{},T=!!H&&"ontouchstart"in L.document.documentElement,K=!!H&&"PointerEvent"in L,O="".concat("cropper","-crop"),I="".concat("cropper","-disabled"),P="".concat("cropper","-hidden"),Q="".concat("cropper","-hide"),U="".concat("cropper","-invisible"),Y="".concat("cropper","-modal"),ca="".concat("cropper","-move"),
da="".concat("cropper","Action"),ma="".concat("cropper","Preview"),na=K?"pointerdown":T?"touchstart":"mousedown",va=K?"pointermove":T?"touchmove":"mousemove",ja=K?"pointerup pointercancel":T?"touchend touchcancel":"mouseup",pa=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,la=/^data:image\/jpeg;base64,/,ra=/^img|canvas$/i,X={viewMode:0,dragMode:"crop",initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,
highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},ya=Number.isNaN||L.isNaN,wa=Object.prototype.hasOwnProperty,M=Array.prototype.slice,B=Object.assign||
function(R){for(var Z=arguments.length,W=Array(1<Z?Z-1:0),ba=1;ba<Z;ba++)W[ba-1]=arguments[ba];return n(R)&&0<W.length&&W.forEach(function(ha){n(ha)&&Object.keys(ha).forEach(function(ia){R[ia]=ha[ia]})}),R},E=/\.\d*(?:0|9){12}\d*$/,J=/^width|height|left|top|marginLeft|marginTop$/,N=/([a-z\d])([A-Z])/g,S=/\s\s*/,V=function(){var R=!1;if(H){var Z=!1,W=function(){},ba=Object.defineProperty({},"once",{get:function(){return R=!0,Z},set:function(ha){Z=ha}});L.addEventListener("test",W,ba);L.removeEventListener("test",
W,ba)}return R}(),aa=L.location,fa=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i,ea=String.fromCharCode,qa=/^data:.*,/,ka=L.Cropper;T=function(){function R(ba){var ha=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(this instanceof R))throw new TypeError("Cannot call a class as a function");if(!ba||!ra.test(ba.tagName))throw Error("The first argument is required and must be an \x3cimg\x3e or \x3ccanvas\x3e element.");this.element=ba;this.options=B({},X,v(ha)&&ha);this.disabled=this.cropped=!1;this.pointers=
{};this.sizing=this.sized=this.replaced=this.reloading=this.ready=!1;this.init()}var Z,W;return W=[{key:"noConflict",value:function(){return window.Cropper=ka,R}},{key:"setDefaults",value:function(ba){B(X,v(ba)&&ba)}}],Z=[{key:"init",value:function(){var ba,ha=this.element,ia=ha.tagName.toLowerCase();if(!ha.cropper){if(ha.cropper=this,"img"===ia){if(this.isImg=!0,ba=ha.getAttribute("src")||"",!(this.originalUrl=ba))return;ba=ha.src}else"canvas"===ia&&window.HTMLCanvasElement&&(ba=ha.toDataURL());
this.load(ba)}}},{key:"load",value:function(ba){var ha=this;if(ba){this.url=ba;this.imageData={};var ia=this.element,ta=this.options;if(ta.rotatable||ta.scalable||(ta.checkOrientation=!1),ta.checkOrientation&&window.ArrayBuffer)if(la.test(ba))this.read((oa=ba.replace(qa,""),xa=atob(oa),sa=new ArrayBuffer(xa.length),h(ua=new Uint8Array(sa),function(Ba,Ea){ua[Ea]=xa.charCodeAt(Ea)}),sa));else{var oa,xa,sa,ua,za=new XMLHttpRequest;oa=this.clone.bind(this);this.reloading=!0;(this.xhr=za).onabort=oa;za.onerror=
oa;za.ontimeout=oa;za.onprogress=function(){"image/jpeg"!==za.getResponseHeader("content-type")&&za.abort()};za.onload=function(){ha.read(za.response)};za.onloadend=function(){ha.reloading=!1;ha.xhr=null};ta.checkCrossOrigin&&k(ba)&&ia.crossOrigin&&(ba=w(ba));za.open("GET",ba);za.responseType="arraybuffer";za.withCredentials="use-credentials"===ia.crossOrigin;za.send()}else this.clone()}}},{key:"read",value:function(ba){var ha=this.options,ia=this.imageData,ta=G(ba),oa=0,xa=1,sa=1;1<ta&&(this.url=
function(ua,za){var Ba=[];for(ua=new Uint8Array(ua);0<ua.length;)Ba.push(ea.apply(null,m(ua.subarray(0,8192)))),ua=ua.subarray(8192);return"data:".concat(za,";base64,").concat(btoa(Ba.join("")))}(ba,"image/jpeg"),ba=function(ua){var za=0,Ba=1,Ea=1;switch(ua){case 2:Ba=-1;break;case 3:za=-180;break;case 4:Ea=-1;break;case 5:za=90;Ea=-1;break;case 6:za=90;break;case 7:za=90;Ba=-1;break;case 8:za=-90}return{rotate:za,scaleX:Ba,scaleY:Ea}}(ta),oa=ba.rotate,xa=ba.scaleX,sa=ba.scaleY);ha.rotatable&&(ia.rotate=
oa);ha.scalable&&(ia.scaleX=xa,ia.scaleY=sa);this.clone()}},{key:"clone",value:function(){var ba,ha,ia=this.element,ta=this.url;this.options.checkCrossOrigin&&k(ta)&&(ha=(ba=ia.crossOrigin)?ta:(ba="anonymous",w(ta)));this.crossOrigin=ba;this.crossOriginUrl=ha;var oa=document.createElement("img");ba&&(oa.crossOrigin=ba);oa.src=ha||ta;(this.image=oa).onload=this.start.bind(this);oa.onerror=this.stop.bind(this);c(oa,Q);ia.parentNode.insertBefore(oa,ia.nextSibling)}},{key:"start",value:function(){var ba=
this,ha=this.isImg?this.element:this.image;ha.onload=null;ha.onerror=null;this.sizing=!0;var ia=L.navigator&&/^(?:.(?!chrome|android))*safari/i.test(L.navigator.userAgent),ta=function(sa,ua){B(ba.imageData,{naturalWidth:sa,naturalHeight:ua,aspectRatio:sa/ua});ba.sizing=!1;ba.sized=!0;ba.build()};if(!ha.naturalWidth||ia){var oa=document.createElement("img"),xa=document.body||document.documentElement;(this.sizingImage=oa).onload=function(){ta(oa.width,oa.height);ia||xa.removeChild(oa)};oa.src=ha.src;
ia||(oa.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",xa.appendChild(oa))}else ta(ha.naturalWidth,ha.naturalHeight)}},{key:"stop",value:function(){var ba=this.image;ba.onload=null;ba.onerror=null;ba.parentNode.removeChild(ba);this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var ba=this.element,ha=this.options,ia=this.image,ta=ba.parentNode,oa=document.createElement("div");
oa.innerHTML='\x3cdiv class\x3d"cropper-container" touch-action\x3d"none"\x3e\x3cdiv class\x3d"cropper-wrap-box"\x3e\x3cdiv class\x3d"cropper-canvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-drag-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-crop-box"\x3e\x3cspan class\x3d"cropper-view-box"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-center"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-cropper-action\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-cropper-action\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-cropper-action\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-cropper-action\x3d"se"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
oa=oa.querySelector(".".concat("cropper","-container"));var xa=oa.querySelector(".".concat("cropper","-canvas")),sa=oa.querySelector(".".concat("cropper","-drag-box")),ua=oa.querySelector(".".concat("cropper","-crop-box")),za=ua.querySelector(".".concat("cropper","-face"));this.container=ta;this.cropper=oa;this.canvas=xa;this.dragBox=sa;this.cropBox=ua;this.viewBox=oa.querySelector(".".concat("cropper","-view-box"));this.face=za;xa.appendChild(ia);c(ba,P);ta.insertBefore(oa,ba.nextSibling);this.isImg||
f(ia,Q);this.initPreview();this.bind();ha.initialAspectRatio=Math.max(0,ha.initialAspectRatio)||NaN;ha.aspectRatio=Math.max(0,ha.aspectRatio)||NaN;ha.viewMode=Math.max(0,Math.min(3,Math.round(ha.viewMode)))||0;c(ua,P);ha.guides||c(ua.getElementsByClassName("".concat("cropper","-dashed")),P);ha.center||c(ua.getElementsByClassName("".concat("cropper","-center")),P);ha.background&&c(oa,"".concat("cropper","-bg"));ha.highlight||c(za,U);ha.cropBoxMovable&&(c(za,ca),g(za,da,"all"));ha.cropBoxResizable||
(c(ua.getElementsByClassName("".concat("cropper","-line")),P),c(ua.getElementsByClassName("".concat("cropper","-point")),P));this.render();this.ready=!0;this.setDragMode(ha.dragMode);ha.autoCrop&&this.crop();this.setData(ha.data);t(ha.ready)&&q(ba,"ready",ha.ready,{once:!0});A(ba,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),f(this.element,P))}},{key:"uncreate",value:function(){this.ready?
(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],r(R.prototype,Z),W&&r(R,W),R}();return B(T.prototype,{render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.cropped&&this.renderCropBox()},initContainer:function(){var R=this.element,Z=this.options,W=this.container,ba=this.cropper;c(ba,P);f(R,P);Z={width:Math.max(W.offsetWidth,
Number(Z.minContainerWidth)||200),height:Math.max(W.offsetHeight,Number(Z.minContainerHeight)||100)};e(ba,{width:(this.containerData=Z).width,height:Z.height});c(R,P);f(ba,P)},initCanvas:function(){var R=this.containerData,Z=this.imageData,W=this.options.viewMode,ba=90==Math.abs(Z.rotate)%180,ha=ba?Z.naturalHeight:Z.naturalWidth,ia=ba?Z.naturalWidth:Z.naturalHeight,ta=ha/ia;ba=R.width;var oa=R.height;R.height*ta>R.width?3===W?ba=R.height*ta:oa=R.width/ta:3===W?oa=R.width/ta:ba=R.height*ta;ha={aspectRatio:ta,
naturalWidth:ha,naturalHeight:ia,width:ba,height:oa};ha.left=(R.width-ba)/2;ha.top=(R.height-oa)/2;ha.oldLeft=ha.left;ha.oldTop=ha.top;this.canvasData=ha;this.limited=1===W||2===W;this.limitCanvas(!0,!0);this.initialImageData=B({},Z);this.initialCanvasData=B({},ha)},limitCanvas:function(R,Z){var W=this.options,ba=this.containerData,ha=this.canvasData,ia=this.cropBoxData,ta=W.viewMode,oa=ha.aspectRatio,xa=this.cropped&&ia;R&&(R=Number(W.minCanvasWidth)||0,W=Number(W.minCanvasHeight)||0,1<ta?(R=Math.max(R,
ba.width),W=Math.max(W,ba.height),3===ta&&(R<W*oa?R=W*oa:W=R/oa)):0<ta&&(R?R=Math.max(R,xa?ia.width:0):W?W=Math.max(W,xa?ia.height:0):xa&&((R=ia.width)<(W=ia.height)*oa?R=W*oa:W=R/oa)),oa=D({aspectRatio:oa,width:R,height:W}),R=oa.width,W=oa.height,ha.minWidth=R,ha.minHeight=W,ha.maxWidth=1/0,ha.maxHeight=1/0);Z&&((xa?0:1)<ta?(Z=ba.width-ha.width,oa=ba.height-ha.height,ha.minLeft=Math.min(0,Z),ha.minTop=Math.min(0,oa),ha.maxLeft=Math.max(0,Z),ha.maxTop=Math.max(0,oa),xa&&this.limited&&(ha.minLeft=
Math.min(ia.left,ia.left+(ia.width-ha.width)),ha.minTop=Math.min(ia.top,ia.top+(ia.height-ha.height)),ha.maxLeft=ia.left,ha.maxTop=ia.top,2===ta&&(ha.width>=ba.width&&(ha.minLeft=Math.min(0,Z),ha.maxLeft=Math.max(0,Z)),ha.height>=ba.height&&(ha.minTop=Math.min(0,oa),ha.maxTop=Math.max(0,oa))))):(ha.minLeft=-ha.width,ha.minTop=-ha.height,ha.maxLeft=ba.width,ha.maxTop=ba.height))},renderCanvas:function(R,Z){var W=this.canvasData,ba=this.imageData;if(Z){Z=ba.naturalWidth*Math.abs(ba.scaleX||1);var ha=
ba.naturalHeight*Math.abs(ba.scaleY||1);ba=ba.rotate||0;if(90==(ba=Math.abs(ba)%180))ha={width:ha,height:Z};else{var ia=ba%90*Math.PI/180,ta=Math.sin(ia),oa=Math.cos(ia);ia=Z*oa+ha*ta;Z=Z*ta+ha*oa;ha=90<ba?{width:Z,height:ia}:{width:ia,height:Z}}Z=ha.width;ha=ha.height;ba=Z/W.naturalWidth*W.width;ta=ha/W.naturalHeight*W.height;W.left-=(ba-W.width)/2;W.top-=(ta-W.height)/2;W.width=ba;W.height=ta;W.aspectRatio=Z/ha;W.naturalWidth=Z;W.naturalHeight=ha;this.limitCanvas(!0,!1)}(W.width>W.maxWidth||W.width<
W.minWidth)&&(W.left=W.oldLeft);(W.height>W.maxHeight||W.height<W.minHeight)&&(W.top=W.oldTop);W.width=Math.min(Math.max(W.width,W.minWidth),W.maxWidth);W.height=Math.min(Math.max(W.height,W.minHeight),W.maxHeight);this.limitCanvas(!1,!0);W.left=Math.min(Math.max(W.left,W.minLeft),W.maxLeft);W.top=Math.min(Math.max(W.top,W.minTop),W.maxTop);W.oldLeft=W.left;W.oldTop=W.top;e(this.canvas,B({width:W.width,height:W.height},y({translateX:W.left,translateY:W.top})));this.renderImage(R);this.cropped&&this.limited&&
this.limitCropBox(!0,!0)},renderImage:function(R){var Z=this.canvasData,W=this.imageData,ba=Z.width/Z.naturalWidth*W.naturalWidth,ha=Z.height/Z.naturalHeight*W.naturalHeight;B(W,{width:ba,height:ha,left:(Z.width-ba)/2,top:(Z.height-ha)/2});e(this.image,B({width:W.width,height:W.height},y(B({translateX:W.left,translateY:W.top},W))));R&&this.output()},initCropBox:function(){var R=this.options,Z=this.canvasData,W=R.aspectRatio||R.initialAspectRatio;R=Number(R.autoCropArea)||.8;var ba={width:Z.width,
height:Z.height};W&&(Z.height*W>Z.width?ba.height=ba.width/W:ba.width=ba.height*W);this.cropBoxData=ba;this.limitCropBox(!0,!0);ba.width=Math.min(Math.max(ba.width,ba.minWidth),ba.maxWidth);ba.height=Math.min(Math.max(ba.height,ba.minHeight),ba.maxHeight);ba.width=Math.max(ba.minWidth,ba.width*R);ba.height=Math.max(ba.minHeight,ba.height*R);ba.left=Z.left+(Z.width-ba.width)/2;ba.top=Z.top+(Z.height-ba.height)/2;ba.oldLeft=ba.left;ba.oldTop=ba.top;this.initialCropBoxData=B({},ba)},limitCropBox:function(R,
Z){var W=this.options,ba=this.containerData,ha=this.canvasData,ia=this.cropBoxData,ta=this.limited,oa=W.aspectRatio;if(R){R=Number(W.minCropBoxWidth)||0;W=Number(W.minCropBoxHeight)||0;var xa=ta?Math.min(ba.width,ha.width,ha.width+ha.left,ba.width-ha.left):ba.width,sa=ta?Math.min(ba.height,ha.height,ha.height+ha.top,ba.height-ha.top):ba.height;R=Math.min(R,ba.width);W=Math.min(W,ba.height);oa&&(R&&W?R<W*oa?W=R/oa:R=W*oa:R?W=R/oa:W&&(R=W*oa),xa<sa*oa?sa=xa/oa:xa=sa*oa);ia.minWidth=Math.min(R,xa);ia.minHeight=
Math.min(W,sa);ia.maxWidth=xa;ia.maxHeight=sa}Z&&(ia.maxTop=ta?(ia.minLeft=Math.max(0,ha.left),ia.minTop=Math.max(0,ha.top),ia.maxLeft=Math.min(ba.width,ha.left+ha.width)-ia.width,Math.min(ba.height,ha.top+ha.height)-ia.height):(ia.minLeft=0,ia.minTop=0,ia.maxLeft=ba.width-ia.width,ba.height-ia.height))},renderCropBox:function(){var R=this.options,Z=this.containerData,W=this.cropBoxData;(W.width>W.maxWidth||W.width<W.minWidth)&&(W.left=W.oldLeft);(W.height>W.maxHeight||W.height<W.minHeight)&&(W.top=
W.oldTop);W.width=Math.min(Math.max(W.width,W.minWidth),W.maxWidth);W.height=Math.min(Math.max(W.height,W.minHeight),W.maxHeight);this.limitCropBox(!1,!0);W.left=Math.min(Math.max(W.left,W.minLeft),W.maxLeft);W.top=Math.min(Math.max(W.top,W.minTop),W.maxTop);W.oldLeft=W.left;W.oldTop=W.top;R.movable&&R.cropBoxMovable&&g(this.face,da,W.width>=Z.width&&W.height>=Z.height?"move":"all");e(this.cropBox,B({width:W.width,height:W.height},y({translateX:W.left,translateY:W.top})));this.cropped&&this.limited&&
this.limitCanvas(!0,!0);this.disabled||this.output()},output:function(){this.preview();A(this.element,"crop",this.getData())}},{initPreview:function(){var R=this.crossOrigin,Z=this.options.preview,W=R?this.crossOriginUrl:this.url,ba=document.createElement("img");if(R&&(ba.crossOrigin=R),ba.src=W,this.viewBox.appendChild(ba),this.viewBoxImage=ba,Z)ba=Z,"string"==typeof Z?ba=this.element.ownerDocument.querySelectorAll(Z):Z.querySelector&&(ba=[Z]),h(this.previews=ba,function(ha){var ia=document.createElement("img");
g(ha,ma,{width:ha.offsetWidth,height:ha.offsetHeight,html:ha.innerHTML});R&&(ia.crossOrigin=R);ia.src=W;ia.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"';ha.innerHTML="";ha.appendChild(ia)})},resetPreview:function(){h(this.previews,function(R){var Z=a(R,ma);e(R,{width:Z.width,height:Z.height});R.innerHTML=Z.html;if(n(R[ma]))try{delete R[ma]}catch(W){R[ma]=void 0}else if(R.dataset)try{delete R.dataset[ma]}catch(W){R.dataset[ma]=
void 0}else R.removeAttribute("data-".concat(d(ma)))})},preview:function(){var R=this.imageData,Z=this.canvasData,W=this.cropBoxData,ba=W.width,ha=W.height,ia=R.width,ta=R.height,oa=W.left-Z.left-R.left,xa=W.top-Z.top-R.top;this.cropped&&!this.disabled&&(e(this.viewBoxImage,B({width:ia,height:ta},y(B({translateX:-oa,translateY:-xa},R)))),h(this.previews,function(sa){var ua=a(sa,ma),za=ua.width;ua=ua.height;var Ba=za,Ea=ua,Ca=1;ba&&(Ea=ha*(Ca=za/ba));ha&&ua<Ea&&(Ba=ba*(Ca=ua/ha),Ea=ua);e(sa,{width:Ba,
height:Ea});e(sa.getElementsByTagName("img")[0],B({width:ia*Ca,height:ta*Ca},y(B({translateX:-oa*Ca,translateY:-xa*Ca},R))))}))}},{bind:function(){var R=this.element,Z=this.options,W=this.cropper;t(Z.cropstart)&&q(R,"cropstart",Z.cropstart);t(Z.cropmove)&&q(R,"cropmove",Z.cropmove);t(Z.cropend)&&q(R,"cropend",Z.cropend);t(Z.crop)&&q(R,"crop",Z.crop);t(Z.zoom)&&q(R,"zoom",Z.zoom);q(W,na,this.onCropStart=this.cropStart.bind(this));Z.zoomable&&Z.zoomOnWheel&&q(W,"wheel",this.onWheel=this.wheel.bind(this),
{passive:!1,capture:!0});Z.toggleDragModeOnDblclick&&q(W,"dblclick",this.onDblclick=this.dblclick.bind(this));q(R.ownerDocument,va,this.onCropMove=this.cropMove.bind(this));q(R.ownerDocument,ja,this.onCropEnd=this.cropEnd.bind(this));Z.responsive&&q(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var R=this.element,Z=this.options,W=this.cropper;t(Z.cropstart)&&l(R,"cropstart",Z.cropstart);t(Z.cropmove)&&l(R,"cropmove",Z.cropmove);t(Z.cropend)&&l(R,"cropend",Z.cropend);t(Z.crop)&&
l(R,"crop",Z.crop);t(Z.zoom)&&l(R,"zoom",Z.zoom);l(W,na,this.onCropStart);Z.zoomable&&Z.zoomOnWheel&&l(W,"wheel",this.onWheel,{passive:!1,capture:!0});Z.toggleDragModeOnDblclick&&l(W,"dblclick",this.onDblclick);l(R.ownerDocument,va,this.onCropMove);l(R.ownerDocument,ja,this.onCropEnd);Z.responsive&&l(window,"resize",this.onResize)}},{resize:function(){var R=this.options,Z=this.container,W=this.containerData,ba=Number(R.minContainerWidth)||200,ha=Number(R.minContainerHeight)||100;if(!(this.disabled||
W.width<=ba||W.height<=ha)){var ia,ta,oa=Z.offsetWidth/W.width;if(1!==oa||Z.offsetHeight!==W.height)R.restore&&(ia=this.getCanvasData(),ta=this.getCropBoxData()),this.render(),R.restore&&(this.setCanvasData(h(ia,function(xa,sa){ia[sa]=xa*oa})),this.setCropBoxData(h(ta,function(xa,sa){ta[sa]=xa*oa})))}},dblclick:function(){var R;this.disabled||"none"===this.options.dragMode||this.setDragMode((R=this.dragBox,(R.classList?R.classList.contains(O):-1<R.className.indexOf(O))?"move":"crop"))},wheel:function(R){var Z=
this,W=Number(this.options.wheelZoomRatio)||.1,ba=1;this.disabled||(R.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){Z.wheeling=!1},50),R.deltaY?ba=0<R.deltaY?1:-1:R.wheelDelta?ba=-R.wheelDelta/120:R.detail&&(ba=0<R.detail?1:-1),this.zoom(-ba*W,R)))},cropStart:function(R){var Z=R.buttons,W=R.button;if(!(this.disabled||x(Z)&&1!==Z||x(W)&&0!==W||R.ctrlKey)){Z=this.options;var ba=this.pointers;R.changedTouches?h(R.changedTouches,function(ha){ba[ha.identifier]=C(ha)}):ba[R.pointerId||
0]=C(R);Z=1<Object.keys(ba).length&&Z.zoomable&&Z.zoomOnTouch?"zoom":a(R.target,da);pa.test(Z)&&!1!==A(this.element,"cropstart",{originalEvent:R,action:Z})&&(R.preventDefault(),this.action=Z,this.cropping=!1,"crop"===Z&&(this.cropping=!0,c(this.dragBox,Y)))}},cropMove:function(R){var Z=this.action;if(!this.disabled&&Z){var W=this.pointers;R.preventDefault();!1!==A(this.element,"cropmove",{originalEvent:R,action:Z})&&(R.changedTouches?h(R.changedTouches,function(ba){B(W[ba.identifier]||{},C(ba,!0))}):
B(W[R.pointerId||0]||{},C(R,!0)),this.change(R))}},cropEnd:function(R){if(!this.disabled){var Z=this.action,W=this.pointers;R.changedTouches?h(R.changedTouches,function(ba){delete W[ba.identifier]}):delete W[R.pointerId||0];Z&&(R.preventDefault(),Object.keys(W).length||(this.action=""),this.cropping&&(this.cropping=!1,b(this.dragBox,Y,this.cropped&&this.options.modal)),A(this.element,"cropend",{originalEvent:R,action:Z}))}}},{change:function(R){var Z=this.canvasData,W=this.containerData,ba=this.cropBoxData,
ha=this.pointers,ia=this.action,ta=this.options.aspectRatio,oa=ba.left,xa=ba.top,sa=ba.width,ua=ba.height,za=oa+sa,Ba=xa+ua,Ea=0,Ca=0,Ha=W.width,Ka=W.height,Ga=!0;!ta&&R.shiftKey&&(ta=sa&&ua?sa/ua:1);this.limited&&(Ea=ba.minLeft,Ca=ba.minTop,Ha=Ea+Math.min(W.width,Z.width,Z.left+Z.width),Ka=Ca+Math.min(W.height,Z.height,Z.top+Z.height));var Ma,Na;Z=ha[Object.keys(ha)[0]];var Da=Z.endX-Z.startX,Aa=Z.endY-Z.startY;W=function(Ja){switch(Ja){case "e":za+Da>Ha&&(Da=Ha-za);break;case "w":oa+Da<Ea&&(Da=
Ea-oa);break;case "n":xa+Aa<Ca&&(Aa=Ca-xa);break;case "s":Ba+Aa>Ka&&(Aa=Ka-Ba)}};switch(ia){case "all":oa+=Da;xa+=Aa;break;case "e":if(0<=Da&&(Ha<=za||ta&&(xa<=Ca||Ka<=Ba))){Ga=!1;break}W("e");0>(sa+=Da)&&(ia="w",oa-=sa=-sa);ta&&(ua=sa/ta,xa+=(ba.height-ua)/2);break;case "n":if(0>=Aa&&(xa<=Ca||ta&&(oa<=Ea||Ha<=za))){Ga=!1;break}W("n");ua-=Aa;xa+=Aa;0>ua&&(ia="s",xa-=ua=-ua);ta&&(sa=ua*ta,oa+=(ba.width-sa)/2);break;case "w":if(0>=Da&&(oa<=Ea||ta&&(xa<=Ca||Ka<=Ba))){Ga=!1;break}W("w");sa-=Da;oa+=Da;
0>sa&&(ia="e",oa-=sa=-sa);ta&&(ua=sa/ta,xa+=(ba.height-ua)/2);break;case "s":if(0<=Aa&&(Ka<=Ba||ta&&(oa<=Ea||Ha<=za))){Ga=!1;break}W("s");0>(ua+=Aa)&&(ia="n",xa-=ua=-ua);ta&&(sa=ua*ta,oa+=(ba.width-sa)/2);break;case "ne":if(ta){if(0>=Aa&&(xa<=Ca||Ha<=za)){Ga=!1;break}W("n");ua-=Aa;xa+=Aa;sa=ua*ta}else W("n"),W("e"),0<=Da?za<Ha?sa+=Da:0>=Aa&&xa<=Ca&&(Ga=!1):sa+=Da,0>=Aa?Ca<xa&&(ua-=Aa,xa+=Aa):(ua-=Aa,xa+=Aa);0>sa&&0>ua?(ia="sw",xa-=ua=-ua,oa-=sa=-sa):0>sa?(ia="nw",oa-=sa=-sa):0>ua&&(ia="se",xa-=ua=
-ua);break;case "nw":if(ta){if(0>=Aa&&(xa<=Ca||oa<=Ea)){Ga=!1;break}W("n");ua-=Aa;xa+=Aa;sa=ua*ta;oa+=ba.width-sa}else W("n"),W("w"),0>=Da?Ea<oa?(sa-=Da,oa+=Da):0>=Aa&&xa<=Ca&&(Ga=!1):(sa-=Da,oa+=Da),0>=Aa?Ca<xa&&(ua-=Aa,xa+=Aa):(ua-=Aa,xa+=Aa);0>sa&&0>ua?(ia="se",xa-=ua=-ua,oa-=sa=-sa):0>sa?(ia="ne",oa-=sa=-sa):0>ua&&(ia="sw",xa-=ua=-ua);break;case "sw":if(ta){if(0>=Da&&(oa<=Ea||Ka<=Ba)){Ga=!1;break}W("w");sa-=Da;oa+=Da;ua=sa/ta}else W("s"),W("w"),0>=Da?Ea<oa?(sa-=Da,oa+=Da):0<=Aa&&Ka<=Ba&&(Ga=!1):
(sa-=Da,oa+=Da),0<=Aa?Ba<Ka&&(ua+=Aa):ua+=Aa;0>sa&&0>ua?(ia="ne",xa-=ua=-ua,oa-=sa=-sa):0>sa?(ia="se",oa-=sa=-sa):0>ua&&(ia="nw",xa-=ua=-ua);break;case "se":if(ta){if(0<=Da&&(Ha<=za||Ka<=Ba)){Ga=!1;break}W("e");ua=(sa+=Da)/ta}else W("s"),W("e"),0<=Da?za<Ha?sa+=Da:0<=Aa&&Ka<=Ba&&(Ga=!1):sa+=Da,0<=Aa?Ba<Ka&&(ua+=Aa):ua+=Aa;0>sa&&0>ua?(ia="nw",xa-=ua=-ua,oa-=sa=-sa):0>sa?(ia="sw",oa-=sa=-sa):0>ua&&(ia="ne",xa-=ua=-ua);break;case "move":this.move(Da,Aa);Ga=!1;break;case "zoom":this.zoom((Ma=B({},ha),
Na=[],h(ha,function(Ja,Pa){delete Ma[Pa];h(Ma,function(Fa){var Ia=Math.abs(Ja.startX-Fa.startX),Oa=Math.abs(Ja.startY-Fa.startY),Ua=Math.abs(Ja.endX-Fa.endX);Fa=Math.abs(Ja.endY-Fa.endY);Ia=Math.sqrt(Ia*Ia+Oa*Oa);Na.push((Math.sqrt(Ua*Ua+Fa*Fa)-Ia)/Ia)})}),Na.sort(function(Ja,Pa){return Math.abs(Ja)<Math.abs(Pa)}),Na[0]),R);Ga=!1;break;case "crop":Da&&Aa?(R=u(this.cropper),oa=Z.startX-R.left,xa=Z.startY-R.top,sa=ba.minWidth,ua=ba.minHeight,0<Da?ia=0<Aa?"se":"ne":0>Da&&(oa-=sa,ia=0<Aa?"sw":"nw"),0>
Aa&&(xa-=ua),this.cropped||(f(this.cropBox,P),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))):Ga=!1}Ga&&(ba.width=sa,ba.height=ua,ba.left=oa,ba.top=xa,this.action=ia,this.renderCropBox());h(ha,function(Ja){Ja.startX=Ja.endX;Ja.startY=Ja.endY})}},{crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&c(this.dragBox,Y),f(this.cropBox,P),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&
!this.disabled&&(this.imageData=B({},this.initialImageData),this.canvasData=B({},this.initialCanvasData),this.cropBoxData=B({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(B(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),f(this.dragBox,Y),c(this.cropBox,P)),this},replace:function(R){var Z=1<arguments.length&&void 0!==arguments[1]&&
arguments[1];return!this.disabled&&R&&(this.isImg&&(this.element.src=R),Z?(this.url=R,this.image.src=R,this.ready&&(this.viewBoxImage.src=R,h(this.previews,function(W){W.getElementsByTagName("img")[0].src=R}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(R))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,f(this.cropper,I)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,c(this.cropper,I)),this},destroy:function(){var R=
this.element;return R.cropper&&(R.cropper=void 0,this.isImg&&this.replaced&&(R.src=this.originalUrl),this.uncreate()),this},move:function(R){var Z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:R,W=this.canvasData,ba=W.left;W=W.top;return this.moveTo(void 0===R?R:ba+Number(R),void 0===Z?Z:W+Number(Z))},moveTo:function(R){var Z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:R,W=this.canvasData,ba=!1;return R=Number(R),Z=Number(Z),this.ready&&!this.disabled&&this.options.movable&&(x(R)&&
(W.left=R,ba=!0),x(Z)&&(W.top=Z,ba=!0),ba&&this.renderCanvas(!0)),this},zoom:function(R,Z){var W=this.canvasData;return R=0>(R=Number(R))?1/(1-R):1+R,this.zoomTo(W.width*R/W.naturalWidth,null,Z)},zoomTo:function(R,Z,W){var ba,ha,ia,ta=this.options,oa=this.canvasData,xa=oa.width,sa=oa.height,ua=oa.naturalWidth,za=oa.naturalHeight;if(0<=(R=Number(R))&&this.ready&&!this.disabled&&ta.zoomable){ta=ua*R;za*=R;if(!1===A(this.element,"zoom",{ratio:R,oldRatio:xa/ua,originalEvent:W}))return this;W?(Z=this.pointers,
R=u(this.cropper),W=Z&&Object.keys(Z).length?(ia=ha=ba=0,h(Z,function(Ba){var Ea=Ba.startY;ba+=Ba.startX;ha+=Ea;ia+=1}),{pageX:ba/=ia,pageY:ha/=ia}):{pageX:W.pageX,pageY:W.pageY},oa.left-=(W.pageX-R.left-oa.left)/xa*(ta-xa),oa.top-=(W.pageY-R.top-oa.top)/sa*(za-sa)):v(Z)&&x(Z.x)&&x(Z.y)?(oa.left-=(Z.x-oa.left)/xa*(ta-xa),oa.top-=(Z.y-oa.top)/sa*(za-sa)):(oa.left-=(ta-xa)/2,oa.top-=(za-sa)/2);oa.width=ta;oa.height=za;this.renderCanvas(!0)}return this},rotate:function(R){return this.rotateTo((this.imageData.rotate||
0)+Number(R))},rotateTo:function(R){return x(R=Number(R))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=R%360,this.renderCanvas(!0,!0)),this},scaleX:function(R){var Z=this.imageData.scaleY;return this.scale(R,x(Z)?Z:1)},scaleY:function(R){var Z=this.imageData.scaleX;return this.scale(x(Z)?Z:1,R)},scale:function(R){var Z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:R,W=this.imageData,ba=!1;return R=Number(R),Z=Number(Z),this.ready&&!this.disabled&&this.options.scalable&&
(x(R)&&(W.scaleX=R,ba=!0),x(Z)&&(W.scaleY=Z,ba=!0),ba&&this.renderCanvas(!0,!0)),this},getData:function(){var R=0<arguments.length&&void 0!==arguments[0]&&arguments[0],Z=this.options,W=this.imageData,ba=this.canvasData,ha=this.cropBoxData;if(this.ready&&this.cropped){var ia={x:ha.left-ba.left,y:ha.top-ba.top,width:ha.width,height:ha.height};var ta=W.width/W.naturalWidth;if(h(ia,function(oa,xa){ia[xa]=oa/ta}),R)R=Math.round(ia.y+ia.height),ba=Math.round(ia.x+ia.width),ia.x=Math.round(ia.x),ia.y=Math.round(ia.y),
ia.width=ba-ia.x,ia.height=R-ia.y}else ia={x:0,y:0,width:0,height:0};return Z.rotatable&&(ia.rotate=W.rotate||0),Z.scalable&&(ia.scaleX=W.scaleX||1,ia.scaleY=W.scaleY||1),ia},setData:function(R){var Z=this.options,W=this.imageData,ba=this.canvasData,ha={};if(this.ready&&!this.disabled&&v(R)){var ia=!1;Z.rotatable&&x(R.rotate)&&R.rotate!==W.rotate&&(W.rotate=R.rotate,ia=!0);Z.scalable&&(x(R.scaleX)&&R.scaleX!==W.scaleX&&(W.scaleX=R.scaleX,ia=!0),x(R.scaleY)&&R.scaleY!==W.scaleY&&(W.scaleY=R.scaleY,
ia=!0));ia&&this.renderCanvas(!0,!0);Z=W.width/W.naturalWidth;x(R.x)&&(ha.left=R.x*Z+ba.left);x(R.y)&&(ha.top=R.y*Z+ba.top);x(R.width)&&(ha.width=R.width*Z);x(R.height)&&(ha.height=R.height*Z);this.setCropBoxData(ha)}return this},getContainerData:function(){return this.ready?B({},this.containerData):{}},getImageData:function(){return this.sized?B({},this.imageData):{}},getCanvasData:function(){var R=this.canvasData,Z={};return this.ready&&h("left top width height naturalWidth naturalHeight".split(" "),
function(W){Z[W]=R[W]}),Z},setCanvasData:function(R){var Z=this.canvasData,W=Z.aspectRatio;return this.ready&&!this.disabled&&v(R)&&(x(R.left)&&(Z.left=R.left),x(R.top)&&(Z.top=R.top),x(R.width)?(Z.width=R.width,Z.height=R.width/W):x(R.height)&&(Z.height=R.height,Z.width=R.height*W),this.renderCanvas(!0)),this},getCropBoxData:function(){var R,Z=this.cropBoxData;return this.ready&&this.cropped&&(R={left:Z.left,top:Z.top,width:Z.width,height:Z.height}),R||{}},setCropBoxData:function(R){var Z,W,ba=this.cropBoxData,
ha=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&v(R)&&(x(R.left)&&(ba.left=R.left),x(R.top)&&(ba.top=R.top),x(R.width)&&R.width!==ba.width&&(Z=!0,ba.width=R.width),x(R.height)&&R.height!==ba.height&&(W=!0,ba.height=R.height),ha&&(Z?ba.height=ba.width/ha:W&&(ba.width=ba.height*ha)),this.renderCropBox()),this},getCroppedCanvas:function(){var R=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var Z,W,ba,ha,ia,
ta,oa,xa,sa,ua,za,Ba,Ea,Ca,Ha,Ka,Ga,Ma,Na,Da,Aa,Ja,Pa,Fa,Ia,Oa,Ua,bb,Va,Qa,cb,db,Ya,Za,eb,fb,gb,hb,jb,La=this.canvasData,Ta=(Z=this.image,W=this.imageData,ba=W.aspectRatio,ha=W.naturalWidth,ia=W.naturalHeight,ta=W.rotate,oa=void 0===ta?0:ta,xa=W.scaleX,sa=void 0===xa?1:xa,ua=W.scaleY,za=void 0===ua?1:ua,Ba=La.aspectRatio,Ea=La.naturalWidth,Ca=La.naturalHeight,Ha=R.fillColor,Ka=void 0===Ha?"transparent":Ha,Ga=R.imageSmoothingEnabled,Ma=void 0===Ga||Ga,Na=R.imageSmoothingQuality,Da=void 0===Na?"low":
Na,Aa=R.maxWidth,Ja=void 0===Aa?1/0:Aa,Pa=R.maxHeight,Fa=void 0===Pa?1/0:Pa,Ia=R.minWidth,Oa=void 0===Ia?0:Ia,Ua=R.minHeight,bb=void 0===Ua?0:Ua,Va=document.createElement("canvas"),Qa=Va.getContext("2d"),cb=D({aspectRatio:Ba,width:Ja,height:Fa}),db=D({aspectRatio:Ba,width:Oa,height:bb},"cover"),Ya=Math.min(cb.width,Math.max(db.width,Ea)),Za=Math.min(cb.height,Math.max(db.height,Ca)),eb=D({aspectRatio:ba,width:Ja,height:Fa}),fb=D({aspectRatio:ba,width:Oa,height:bb},"cover"),gb=Math.min(eb.width,Math.max(fb.width,
ha)),hb=Math.min(eb.height,Math.max(fb.height,ia)),jb=[-gb/2,-hb/2,gb,hb],Va.width=p(Ya),Va.height=p(Za),Qa.fillStyle=Ka,Qa.fillRect(0,0,Ya,Za),Qa.save(),Qa.translate(Ya/2,Za/2),Qa.rotate(oa*Math.PI/180),Qa.scale(sa,za),Qa.imageSmoothingEnabled=Ma,Qa.imageSmoothingQuality=Da,Qa.drawImage.apply(Qa,[Z].concat(z(jb.map(function(ib){return Math.floor(p(ib))})))),Qa.restore(),Va);if(!this.cropped)return Ta;ba=this.getData();ha=ba.x;W=ba.y;Z=ba.width;ba=ba.height;La=Ta.width/Math.floor(La.naturalWidth);
1!==La&&(ha*=La,W*=La,Z*=La,ba*=La);oa=Z/ba;ia=D({aspectRatio:oa,width:R.maxWidth||1/0,height:R.maxHeight||1/0});ta=D({aspectRatio:oa,width:R.minWidth||0,height:R.minHeight||0},"cover");oa=D({aspectRatio:oa,width:R.width||(1!==La?Ta.width:Z),height:R.height||(1!==La?Ta.height:ba)});La=oa.width;oa=oa.height;La=Math.min(ia.width,Math.max(ta.width,La));oa=Math.min(ia.height,Math.max(ta.height,oa));ia=document.createElement("canvas");ta=ia.getContext("2d");ia.width=p(La);ia.height=p(oa);ta.fillStyle=
R.fillColor||"transparent";ta.fillRect(0,0,La,oa);oa=R.imageSmoothingEnabled;R=R.imageSmoothingQuality;ta.imageSmoothingEnabled=void 0===oa||oa;R&&(ta.imageSmoothingQuality=R);var Sa,Ra,$a,ab,Wa,Xa;R=Ta.width;oa=Ta.height;ha<=-Z||R<ha?Wa=$a=Sa=ha=0:0>=ha?($a=-ha,ha=0,Wa=Sa=Math.min(R,Z+ha)):ha<=R&&($a=0,Wa=Sa=Math.min(Z,R-ha));0>=Sa||W<=-ba||oa<W?Xa=ab=Ra=W=0:0>=W?(ab=-W,W=0,Xa=Ra=Math.min(oa,ba+W)):W<=oa&&(ab=0,Xa=Ra=Math.min(ba,oa-W));Sa=[ha,W,Sa,Ra];0<Wa&&0<Xa&&(Ra=La/Z,Sa.push($a*Ra,ab*Ra,Wa*
Ra,Xa*Ra));return ta.drawImage.apply(ta,[Ta].concat(z(Sa.map(function(ib){return Math.floor(p(ib))})))),ia},setAspectRatio:function(R){var Z=this.options;return this.disabled||void 0===R||(Z.aspectRatio=Math.max(0,R)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(R){var Z=this.options,W=this.dragBox,ba=this.face;if(this.ready&&!this.disabled){var ha="crop"===R,ia=Z.movable&&"move"===R;R=ha||ia?R:"none";Z.dragMode=R;g(W,da,R);b(W,O,ha);b(W,ca,ia);
Z.cropBoxMovable||(g(ba,da,R),b(ba,O,ha),b(ba,ca,ia))}return this}}),T})},"xstyle/css":function(){define(["require"],function(F){function r(z,x,n){var v=document.documentElement;z=v.insertBefore(document.createElement(z),v.firstChild);z.id=x;x=(z.currentStyle||getComputedStyle(z,null)||{})[n];v.removeChild(z);return x}return{load:function(z,x,n,v){function t(e){var c=r("x-parse",null,"content"),f=e&&(e.sheet||e.styleSheet);c&&"none"!=c&&"normal"!=c?x([eval(c)],function(b){e?b.process(e,n):(b.processAll(),
n(f))}):n(f)}var m=x.toUrl(z);if(m.match(/!$/)){var h={wait:!1};m=m.slice(0,-1)}var p=x.cache&&x.cache["url:"+m];if(null!=p)p.xCss&&(p=p.cssText),"string"==typeof p?F(["./core/load-css"],function(e){t(e.insertCss(p))}):t();else{if("none"==r("div",z.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return t();F(["./core/load-css"],function(e){e(m,t,h)})}}}})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorSelector jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){return F([r,z],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:'\x3cdiv role\x3d"button" tabindex\x3d"0"data-dojo-attach-event\x3d"onclick:_domNodeClick,onkeydown:_domNodeKeydown" aria-pressed\x3d"false"\x3e\x3c/div\x3e',_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?
this.color instanceof m||(this.color=new m(this.color)):this.color=new m("#ccc");n.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){p.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(f){var b=this.tooltipDialog.domNode;return f===b||n.isDescendant(f,b)},hideTooltipDialog:function(){this._hideTooltipDialog()},
_showTooltipDialog:function(){p.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0;this.picker.cursorNode.focus()},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();p.close(this.tooltipDialog)},_createTooltipDialog:function(){var f=n.create("div");this.tooltipDialog=new h({content:f});n.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");this.own(v(this.tooltipDialog.domNode,"keydown",x.hitch(this,function(a){a.keyCode===
t.ESCAPE&&(this._hideTooltipDialog(),this.domNode.focus(),n.setAttr(this.domNode,"aria-pressed","false"))})));var b=new e({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:x.hitch(this,function(a){this.ensureMode||(a=new m(a),this.setColor(a))})});b.placeAt(f);b.startup();if(this.ensureMode){var d=n.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},f);this.own(v(d,"click",x.hitch(this,
function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(d=n.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},f),this.own(v(d,"click",x.hitch(this,function(){var a=this.picker.get("value");this.setColor(new m(a));this._hideTooltipDialog()}))));f=n.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},f);this.own(v(f,"click",x.hitch(this,function(){var a=this.picker.get("value");this.setColor(new m(a))})))}this.own(v(document.body,
"click",x.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=b},_domNodeClick:function(f){f.stopPropagation();f.preventDefault();this._isTooltipDialogOpened?(this._hideTooltipDialog(),n.setAttr(this.domNode,"aria-pressed","false")):(this._showTooltipDialog(),n.setAttr(this.domNode,"aria-pressed","true"))},_domNodeKeydown:function(f){f.keyCode!==t.ENTER&&f.keyCode!==t.SPACE||this._domNodeClick(f)},setColor:function(f,b){if(f instanceof m){var d=
this.color,a="";d&&(a=d.toHex());d=f.toHex();this.color=f;n.setStyle(this.domNode,"backgroundColor",d);if(a!==d&&(this.picker.set("value",d),!1!==b))this.onChange(new m(d))}},getColor:function(){return this.color},_changeLabel:function(f){n.empty(this.domNode);n.create("span",{innerHTML:f.toHex(),className:"color-label",style:{color:c.invertColor(f.toHex())}},this.domNode)},onChange:function(f){this.showLabel&&this._changeLabel(f)},onClose:function(){},getPopup:function(){return this.tooltipDialog||
null},setLabel:function(f){n.empty(this.domNode);n.create("span",{innerHTML:f||"",className:"text-label"},this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},"jimu/dijit/ColorSelector":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dojox/widget/ColorPicker dijit/_base/focus dojo/fx dojo/_base/lang dojo/_base/html dojo/sniff".split(" "),function(F,r,z,x,n,v,t,m,h){return r([z,x,F],{baseClass:"jimu-color-selector",declaredClass:"jimu.dijit.ColorSelector",
_setPoint:function(p){p&&n.focus(p.target);if(!this._CURSOR_WIDTH||!this._CURSOR_HEIGHT){var e=m.getMarginBox(this.cursorNode);e.w&&e.h&&(this._CURSOR_WIDTH=e.w/2,this._CURSOR_HEIGHT=e.h/2)}this._BORDER_WIDTH&&this._BORDER_HEIGHT||(e=m.getBorderExtents(p.target||p.srcElement),e.w&&e.h&&(this._BORDER_WIDTH=e.w,this._BORDER_HEIGHT=e.h));var c=e=0;h("ff")||h("ie")||h("MSIE")?(e=p.offsetX,c=p.offsetY):p.offsetX&&p.offsetY&&(e=p.offsetX+this._BORDER_WIDTH,c=p.offsetY+this._BORDER_HEIGHT);p=c-this._CURSOR_HEIGHT;
e-=this._CURSOR_WIDTH;this.animatePoint?v.slideTo({node:this.cursorNode,duration:this.slideDuration,top:p,left:e,onEnd:t.hitch(this,function(){this._updateColor(!0);n.focus(this.cursorNode)})}).play():(m.style(this.cursorNode,{left:e+"px",top:p+"px"}),this._updateColor(!0))},_setHuePoint:function(p){p=p.offsetY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?v.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:p,left:0,onEnd:t.hitch(this,function(){this._updateColor(!0);n.focus(this.hueCursorNode)})}).play():
(m.style(this.hueCursorNode,"top",p+"px"),this._updateColor(!0))}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w){F.experimental("dojox.widget.ColorPicker");return r("dojox.widget.ColorPicker",g,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:w,postMixInProperties:function(){e.contains(m.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=d.getUniqueId(this.id);z.mixin(this,A.getLocalization("dojox.widget","ColorPicker"));z.mixin(this,A.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>t("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new b.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new b.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(v.subscribe("/dnd/move/stop",z.hitch(this,"_clearTimer"))),this._subs.push(v.subscribe("/dnd/move/start",
z.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(l.addKeyListener(this.hueCursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,z.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(l.addKeyListener(this.hueCursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,z.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(l.addKeyListener(this.cursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,z.hitch(this,this._updateCursorNode),25,25)),this._connects.push(l.addKeyListener(this.cursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,z.hitch(this,this._updateCursorNode),25,25)),this._connects.push(l.addKeyListener(this.cursorNode,{charOrCode:c.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,z.hitch(this,this._updateCursorNode),25,25)),this._connects.push(l.addKeyListener(this.cursorNode,{charOrCode:c.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,z.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(y,C){this._started&&this.setColor(y,C)},setColor:function(y,C){y=q.fromString(y);this._updatePickerLocations(y);this._updateColorInputs(y);this._updateValue(y,C)},_setTimer:function(y){if(y.node==this.cursorNode||y.node==this.hueCursorNode)a.focus(y.node),p.setSelectable(this.domNode,!1),this._timer=setInterval(z.hitch(this,"_updateColor"),45)},_clearTimer:function(y){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),p.setSelectable(this.domNode,!0))},_setHue:function(y){n.style(this.colorUnderlay,"backgroundColor",q.fromHsv(y,100,100).toHex())},_updateHueCursorNode:function(y,C,D){if(-1!==y){y=n.style(this.hueCursorNode,"top");C=this.PICKER_HUE_SELECTOR_H/2;y+=C;var G=!1;D.charOrCode==c.UP_ARROW?0<y&&(--y,G=!0):D.charOrCode==c.DOWN_ARROW&&y<this.PICKER_HUE_H&&(y+=1,G=!0);G&&n.style(this.hueCursorNode,"top",y-C+"px")}else this._updateColor(!0)},_updateCursorNode:function(y,
C,D){C=this.PICKER_SAT_SELECTOR_H/2;var G=this.PICKER_SAT_SELECTOR_W/2;if(-1!==y){y=n.style(this.cursorNode,"top");var H=n.style(this.cursorNode,"left");y+=C;H+=G;var L=!1;D.charOrCode==c.UP_ARROW?0<y&&(--y,L=!0):D.charOrCode==c.DOWN_ARROW?y<this.PICKER_SAT_VAL_H&&(y+=1,L=!0):D.charOrCode==c.LEFT_ARROW?0<H&&(--H,L=!0):D.charOrCode==c.RIGHT_ARROW&&H<this.PICKER_SAT_VAL_W&&(H+=1,L=!0);L&&(H-=G,n.style(this.cursorNode,"top",y-C+"px"),n.style(this.cursorNode,"left",H+"px"))}else this._updateColor(!0)},
_updateColor:function(y){var C=this.PICKER_HUE_SELECTOR_H/2,D=this.PICKER_SAT_SELECTOR_H/2,G=this.PICKER_SAT_SELECTOR_W/2;C=n.style(this.hueCursorNode,"top")+C;D=n.style(this.cursorNode,"top")+D;G=n.style(this.cursorNode,"left")+G;C=Math.round(360-C/this.PICKER_HUE_H*360);G=q.fromHsv(C,G/this.PICKER_SAT_VAL_W*100,100-D/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(G);this._updateValue(G,y);C!=this._hue&&this._setHue(C)},_colorInputChange:function(y){var C=!1;switch(y.target){case this.hexCode:var D=
q.fromString(y.target.value);C=!0;break;case this.Rval:case this.Gval:case this.Bval:D=q.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);C=!0;break;case this.Hval:case this.Sval:case this.Vval:D=q.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),C=!0}C&&(this._updatePickerLocations(D),this._updateColorInputs(D),this._updateValue(D,!0))},_updateValue:function(y,C){y=y.toHex();this.value=this.valueNode.value=y;if(C&&(!this._timer||this.liveUpdate))this.onChange(y)},_updatePickerLocations:function(y){var C=
this.PICKER_HUE_SELECTOR_H/2,D=this.PICKER_SAT_SELECTOR_H/2,G=this.PICKER_SAT_SELECTOR_W/2;y=y.toHsv();C=Math.round(this.PICKER_HUE_H-y.h/360*this.PICKER_HUE_H)-C;G=Math.round(y.s/100*this.PICKER_SAT_VAL_W)-G;D=Math.round(this.PICKER_SAT_VAL_H-y.v/100*this.PICKER_SAT_VAL_H)-D;this.animatePoint?(f.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:C,left:0}).play(),f.slideTo({node:this.cursorNode,duration:this.slideDuration,top:D,left:G}).play()):(n.style(this.hueCursorNode,"top",C+"px"),
n.style(this.cursorNode,{left:G+"px",top:D+"px"}));y.h!=this._hue&&this._setHue(y.h)},_updateColorInputs:function(y){var C=y.toHex();this.showRgb&&(this.Rval.value=y.r,this.Gval.value=y.g,this.Bval.value=y.b);this.showHsv&&(y=y.toHsv(),this.Hval.value=Math.round(y.h),this.Sval.value=Math.round(y.s),this.Vval.value=Math.round(y.v));this.showHex&&(this.hexCode.value=C);this.previewNode.style.backgroundColor=C;this.webSafe&&(this.safePreviewNode.style.backgroundColor=C)},_setHuePoint:function(y){var C=
this.PICKER_HUE_SELECTOR_H/2;y=y.layerY||y.y-y.target.getBoundingClientRect().top;y-=C;this.animatePoint?f.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:y,left:0,onEnd:z.hitch(this,function(){this._updateColor(!0);a.focus(this.hueCursorNode)})}).play():(n.style(this.hueCursorNode,"top",y+"px"),this._updateColor(!0))},_setPoint:function(y){var C=this.PICKER_SAT_SELECTOR_H/2,D=this.PICKER_SAT_SELECTOR_W/2,G=y.layerY||y.y-y.target.getBoundingClientRect().top;G-=C;C=y.layerX||y.x-y.target.getBoundingClientRect().left;
C-=D;y&&a.focus(y.target);this.animatePoint?f.slideTo({node:this.cursorNode,duration:this.slideDuration,top:G,left:C,onEnd:z.hitch(this,function(){this._updateColor(!0);a.focus(this.cursorNode)})}).play():(n.style(this.cursorNode,{left:C+"px",top:G+"px"}),this._updateColor(!0))},_handleKey:function(y){},focus:function(){this.focused||a.focus(this.focusNode)},_stopDrag:function(y){h.stop(y)},destroy:function(){this.inherited(arguments);x.forEach(this._subs,function(y){v.unsubscribe(y)});delete this._subs}})})},
"dojox/color":function(){define(["./color/_base"],function(F){return F})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(F,r,z,x){F=r.getObject("color",!0,F);F.Color=z;F.blend=z.blendColors;F.fromRgb=z.fromRgb;F.fromHex=z.fromHex;F.fromArray=z.fromArray;F.fromString=z.fromString;F.greyscale=x.makeGrey;r.mixin(F,{fromCmy:function(n,v,t){r.isArray(n)?(v=n[1],t=n[2],n=n[0]):r.isObject(n)&&(v=n.m,t=n.y,n=n.c);return new z({r:Math.round(255*
(1-n/100)),g:Math.round(255*(1-v/100)),b:Math.round(255*(1-t/100))})},fromCmyk:function(n,v,t,m){r.isArray(n)?(v=n[1],t=n[2],m=n[3],n=n[0]):r.isObject(n)&&(v=n.m,t=n.y,m=n.b,n=n.c);m/=100;return new z({r:Math.round(255*(1-Math.min(1,n/100*(1-m)+m))),g:Math.round(255*(1-Math.min(1,v/100*(1-m)+m))),b:Math.round(255*(1-Math.min(1,t/100*(1-m)+m)))})},fromHsl:function(n,v,t){r.isArray(n)?(v=n[1],t=n[2],n=n[0]):r.isObject(n)&&(v=n.s,t=n.l,n=n.h);v/=100;for(t/=100;0>n;)n+=360;for(;360<=n;)n-=360;if(120>
n){var m=(120-n)/60;var h=n/60;n=0}else 240>n?(m=0,h=(240-n)/60,n=(n-120)/60):(m=(n-240)/60,h=0,n=(360-n)/60);m=2*v*Math.min(m,1)+(1-v);h=2*v*Math.min(h,1)+(1-v);n=2*v*Math.min(n,1)+(1-v);.5>t?(m*=t,h*=t,n*=t):(m=(1-t)*m+2*t-1,h=(1-t)*h+2*t-1,n=(1-t)*n+2*t-1);return new z({r:Math.round(255*m),g:Math.round(255*h),b:Math.round(255*n)})}});F.fromHsv=function(n,v,t){r.isArray(n)?(v=n[1],t=n[2],n=n[0]):r.isObject(n)&&(v=n.s,t=n.v,n=n.h);360==n&&(n=0);v/=100;t/=100;var m,h;if(0==v)var p=h=m=t;else{var e=
n/60;n=Math.floor(e);var c=e-n;e=t*(1-v);var f=t*(1-v*c);v=t*(1-v*(1-c));switch(n){case 0:m=t;p=v;h=e;break;case 1:m=f;p=t;h=e;break;case 2:m=e;p=t;h=v;break;case 3:m=e;p=f;h=t;break;case 4:m=v;p=e;h=t;break;case 5:m=t,p=e,h=f}}return new z({r:Math.round(255*m),g:Math.round(255*p),b:Math.round(255*h)})};r.extend(z,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var n=this.r/255,v=this.g/255,t=this.b/255;
var m=Math.min(1-n,1-v,1-t);return{c:Math.round((1-n-m)/(1-m)*100),m:Math.round((1-v-m)/(1-m)*100),y:Math.round((1-t-m)/(1-m)*100),b:Math.round(100*m)}},toHsl:function(){var n=this.r/255,v=this.g/255,t=this.b/255,m=Math.min(n,t,v),h=Math.max(n,v,t),p=h-m,e=0,c=0;m=(m+h)/2;0<m&&1>m&&(c=p/(.5>m?2*m:2-2*m));0<p&&(h==n&&h!=v&&(e+=(v-t)/p),h==v&&h!=t&&(e+=2+(t-n)/p),h==t&&h!=n&&(e+=4+(n-v)/p),e*=60);return{h:e,s:Math.round(100*c),l:Math.round(100*m)}},toHsv:function(){var n=this.r/255,v=this.g/255,t=this.b/
255,m=Math.max(n,v,t),h=m-Math.min(n,t,v),p=null,e=0==m?0:h/m;0==e?p=0:(p=n==m?60*(v-t)/h:v==m?120+60*(t-n)/h:240+60*(n-v)/h,0>p&&(p+=360));return{h:p,s:Math.round(100*e),v:Math.round(100*m)}}});return F})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(F,r,z,x){var n={};r.setObject("dojo.colors",n);var v=function(m,h,p){0>p&&++p;1<p&&--p;var e=6*p;return 1>e?m+(h-m)*e:1>2*p?h:2>3*p?m+(h-m)*(2/3-p)*6:m};F.colorFromRgb=z.fromRgb=function(m,
h){var p=m.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(p){m=p[2].split(/\s*,\s*/);var e=m.length;p=p[1];if("rgb"==p&&3==e||"rgba"==p&&4==e)return p=m[0],"%"==p.charAt(p.length-1)?(p=x.map(m,function(b){return 2.56*parseFloat(b)}),4==e&&(p[3]=m[3]),z.fromArray(p,h)):z.fromArray(m,h);if("hsl"==p&&3==e||"hsla"==p&&4==e){p=(parseFloat(m[0])%360+360)%360/360;var c=parseFloat(m[1])/100,f=parseFloat(m[2])/100;c=.5>=f?f*(c+1):f+c-f*c;f=2*f-c;p=[256*v(f,c,p+1/3),256*v(f,c,p),256*v(f,c,p-1/
3),1];4==e&&(p[3]=m[3]);return z.fromArray(p,h)}}return null};var t=function(m,h,p){m=Number(m);return isNaN(m)?p:m<h?h:m>p?p:m};z.prototype.sanitize=function(){this.r=Math.round(t(this.r,0,255));this.g=Math.round(t(this.g,0,255));this.b=Math.round(t(this.b,0,255));this.a=t(this.a,0,1);return this};n.makeGrey=z.makeGrey=function(m,h){return z.fromArray([m,m,m,h])};r.mixin(z.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,
228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,
140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],
greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,
178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,
255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,
128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return z})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule ./a11y/_Transparency".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){F=F([z,x,n,v],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:t,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var d=r.locale||"";d=d.toLowerCase();"ar"===d?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===d&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha);this.a11y_initAriaAttrs()},setAlpha:function(d){this.opacitySlider.set("value",Math.round(100-100*d))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var d=this.getAlpha();this.emit("change",d)}});F.extend(b);return F})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u){var k=r("dijit.form._SliderMover",e,{onMouseMove:function(w){var y=this.widget,C=y._abspos;C||(C=y._abspos=n.position(y.sliderBarContainer,!0),y._setPixelValue_=m.hitch(y,"_setPixelValue"),y._isReversed_=y._isReversed());w=w[y._mousePixelCoord]-C[y._startingPixelCoord];y._setPixelValue_(y._isReversed_?C[y._pixelCount]-w:w,C[y._pixelCount],!1)},destroy:function(w){e.prototype.destroy.apply(this,arguments);var y=this.widget;y._abspos=null;y._setValueAttr(y.value,
!0)}});z=r("dijit.form.HorizontalSlider",[q,A],{templateString:u,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:d.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(w){this.disabled||this.readOnly||w.altKey||w.ctrlKey||w.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(w){if(!(this.disabled||this.readOnly||w.altKey||w.ctrlKey||w.metaKey)){switch(w.keyCode){case t.HOME:this._setValueAttr(this.minimum,!1);break;case t.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?t.RIGHT_ARROW:t.LEFT_ARROW:case !1===this._descending?t.DOWN_ARROW:t.UP_ARROW:case !1===this._descending?t.PAGE_DOWN:t.PAGE_UP:this.increment(w);
break;case this._descending||this.isLeftToRight()?t.LEFT_ARROW:t.RIGHT_ARROW:case !1===this._descending?t.UP_ARROW:t.DOWN_ARROW:case !1===this._descending?t.PAGE_UP:t.PAGE_DOWN:this.decrement(w);break;default:return}w.stopPropagation();w.preventDefault()}},_onHandleClick:function(w){this.disabled||this.readOnly||(h("ie")||a.focus(this.sliderHandle),w.stopPropagation(),w.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(w){if(!this.disabled&&!this.readOnly&&
this.clickSelect){a.focus(this.sliderHandle);w.stopPropagation();w.preventDefault();var y=n.position(this.sliderBarContainer,!0),C=w[this._mousePixelCoord]-y[this._startingPixelCoord];this._setPixelValue(this._isReversed()?y[this._pixelCount]-C:C,y[this._pixelCount],!0);this._movable.onMouseDown(w)}},_setPixelValue:function(w,y,C){if(!this.disabled&&!this.readOnly){var D=this.discreteValues;if(1>=D||Infinity==D)D=y;D--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(w/
(y/D))/D+this.minimum,this.maximum),this.minimum),C)}},_setValueAttr:function(w,y){this._set("value",w);this.valueNode.value=w;this.focusNode.setAttribute("aria-valuenow",w);this.inherited(arguments);var C=this.maximum>this.minimum?(w-this.minimum)/(this.maximum-this.minimum):0,D=!1===this._descending?this.remainingBar:this.progressBar,G=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(y&&0<this.slideDuration&&
D.style[this._progressPixelSize]){var H=this,L={},T=parseFloat(D.style[this._progressPixelSize]),K=this.slideDuration*(C-T/100);0!=K&&(0>K&&(K=0-K),L[this._progressPixelSize]={start:T,end:100*C,units:"%"},this._inProgressAnim=x.animateProperty({node:D,duration:K,onAnimate:function(O){G.style[H._progressPixelSize]=100-parseFloat(O[H._progressPixelSize])+"%"},onEnd:function(){delete H._inProgressAnim},properties:L}),this._inProgressAnim.play())}else D.style[this._progressPixelSize]=100*C+"%",G.style[this._progressPixelSize]=
100*(1-C)+"%"},_bumpValue:function(w,y){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var C=v.getComputedStyle(this.sliderBarContainer),D=n.getContentBox(this.sliderBarContainer,C);C=this.discreteValues;if(1>=C||Infinity==C)C=D[this._pixelCount];C--;w=Math.round((this.value-this.minimum)*C/(this.maximum-this.minimum))+w;0>w&&(w=0);w>C&&(w=C);w=w*(this.maximum-this.minimum)/C+this.minimum;this._setValueAttr(w,y)}},_onClkBumper:function(w){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(w,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(w){this._bumpValue(w.keyCode==t.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(w){this._bumpValue(w.keyCode==t.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(w){this.focused&&(w.stopPropagation(),w.preventDefault(),this._bumpValue(0>w.wheelDelta?-1:1,!0))},
startup:function(){this._started||(F.forEach(this.getChildren(),function(w){this[w.container]!=this.containerNode&&this[w.container].appendChild(w.domNode)},this),this.inherited(arguments))},_typematicCallback:function(w,y,C){if(-1==w)this._setValueAttr(this.value,!0);else this[y==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](C)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var w=c('label[for\x3d"'+this.id+'"]');w.length&&(w[0].id||(w[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",w[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(g.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),g.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(b(this.domNode,
f.wheel,m.hitch(this,"_mouseWheeled")));var w=r(k,{widget:this});this._movable=new p(this.sliderHandle,{mover:w});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});z._Mover=k;return z})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(F,r,z,x,n,v){F=F("dijit.form.HorizontalRuleLabels",
v,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(t){return t},_genHTML:function(t,m){m=
this.labels[m];return this._positionPrefix+this._calcPosition(t)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(m)+this._labelPrefix+m+this._suffix},_genDirectionHTML:function(t){return""},getLabels:function(){var t=this.labels;!t.length&&this.srcNodeRef&&(t=x("\x3e li",this.srcNodeRef).map(function(e){return String(e.innerHTML)}));if(!t.length&&1<this.count){t=[];for(var m=this.minimum,h=(this.maximum-m)/(this.count-1),p=0;p<this.count;p++)t.push(p<this.numericMargin||p>=this.count-
this.numericMargin?"":z.format(m,this.constraints)),m+=h}return t},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});r("dojo-bidi")&&F.extend({_setTextDirAttr:function(t){this.textDir!=t&&(this._set("textDir",t),x(".dijitRuleLabelContainer",this.domNode).forEach(n.hitch(this,function(m){m.style.direction=this.getTextDir(m.innerText||m.textContent||"")})))},_genDirectionHTML:function(t){return this.textDir?"direction:"+this.getTextDir(t)+
";":""}});return F})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(F,r,z){return F("dijit.form.HorizontalRule",[r,z],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(x){return this._positionPrefix+
x+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);if(1==this.count)var x=this._genHTML(50,0);else{var n,v=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){x=this._genHTML(0,0);for(n=1;n<this.count-1;n++)x+=this._genHTML(v*n,n);x+=this._genHTML(100,this.count-1)}else{x=this._genHTML(100,0);for(n=1;n<this.count-1;n++)x+=this._genHTML(100-v*n,n);x+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=x}})})},"jimu/dijit/a11y/_Transparency":function(){define(["dojo/_base/html"],
function(F){return{a11y_initAriaAttrs:function(){var r=this["aria-labelledby"];r&&(F.removeAttr(this.domNode,"aria-labelledby"),F.setAttr(this.opacitySlider.focusNode,"aria-labelledby",r))}}})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(F,r,z,x){return F("dijit.form.NumberSpinner",[z,x.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(n,v){var t=this.constraints,m=isNaN(n),h=!isNaN(t.max),p=
!isNaN(t.min);m&&0!=v&&(n=0<v?p?t.min:h?t.max:0:h?this.constraints.max:p?t.min:0);v=n+v;if(m||isNaN(v))return n;h&&v>t.max&&(v=t.max);p&&v<t.min&&(v=t.min);return v},_onKeyDown:function(n){if(!(this.disabled||this.readOnly||n.keyCode!=r.HOME&&n.keyCode!=r.END||n.ctrlKey||n.altKey||n.metaKey||"undefined"==typeof this.get("value"))){var v=this.constraints[n.keyCode==r.HOME?"min":"max"];"number"==typeof v&&this._setValueAttr(v,!1);n.stopPropagation();n.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return F("dijit.form._Spinner",m,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:h,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(e){return e},_arrowPressed:function(e,c,f){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),c*f),!1),p.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(e,c,f){var b=this.smallDelta;c==this.textbox&&(c=f.keyCode,b=c==r.PAGE_UP||c==r.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==r.UP_ARROW||c==r.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==e?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,b)},_wheelTimer:null,_mouseWheeled:function(e){if(this.focused){e.stopPropagation();e.preventDefault();var c=e.wheelDelta/120;Math.floor(c)!=c&&(c=0<e.wheelDelta?1:-1);e=e.detail?-1*e.detail:c;if(0!==e){var f=
this[0<e?"upArrowNode":"downArrowNode"];this._arrowPressed(f,e,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(f)},50)}}},_setConstraintsAttr:function(e){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(e,c){this.focusNode.setAttribute("aria-valuenow",e);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(v(this.domNode,n.wheel,z.hitch(this,"_mouseWheeled")),t.addListener(this.upArrowNode,this.textbox,{keyCode:r.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),t.addListener(this.downArrowNode,this.textbox,
{keyCode:r.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),t.addListener(this.upArrowNode,this.textbox,{keyCode:r.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),t.addListener(this.downArrowNode,this.textbox,{keyCode:r.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(F,r,z){return F("dijit.form.RangeBoundTextBox",z,{rangeMessage:"",rangeCheck:function(x,n){return("min"in n?0<=this.compare(x,n.min):!0)&&("max"in n?0>=this.compare(x,n.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var x=this.get("value");
if(null==x)return!1;var n=!1;"min"in this.constraints&&(n=this.constraints.min,n=0>this.compare(x,"number"==typeof n&&0<=n&&0!=x?0:n));!n&&"max"in this.constraints&&(n=this.constraints.max,n=0<this.compare(x,"number"!=typeof n||0<n?n:0));return n},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(x){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(x))},getErrorMessage:function(x){var n=
this.get("value");return null==n||""===n||"number"==typeof n&&isNaN(n)||this.isInRange(x)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=r.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(F,r,z,x,n,v){var t=
function(h){h=h||{};var p=z.getLocalization("dojo.cldr","number",z.normalizeLocale(h.locale)),e=h.pattern?h.pattern:p[(h.type||"decimal")+"Format"];h="number"==typeof h.places?h.places:"string"===typeof h.places&&0<h.places.length?h.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:p.decimal,places:h}},m=F("dijit.form.NumberTextBoxMixin",null,{pattern:function(h){return"("+(this.focused&&this.editOptions?this._regExpGenerator(r.delegate(h,this.editOptions))+
"|":"")+this._regExpGenerator(h)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:n.format,_regExpGenerator:n.regexp,_decimalInfo:t(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(h){var p="number"==typeof h.places?h.places:0;p&&p++;"number"!=typeof h.max&&(h.max=9*Math.pow(10,15-p));"number"!=typeof h.min&&(h.min=-9*Math.pow(10,15-p));this.inherited(arguments,[h]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&
this.set("value",this.value);this._decimalInfo=t(h)},_onFocus:function(h){if(!this.disabled&&!this.readOnly){var p=this.get("value");"number"!=typeof p||isNaN(p)||(p=this.format(p,this.constraints),void 0!==p&&(this.textbox.value=p,"mouse"!==h&&this.textbox.select()));this.inherited(arguments)}},format:function(h,p){var e=String(h);if("number"!=typeof h)return e;if(isNaN(h))return"";if(!("rangeCheck"in this&&this.rangeCheck(h,p))&&!1!==p.exponent&&/\de[-+]?\d/i.test(e))return e;this.editOptions&&
this.focused&&(p=r.mixin({},p,this.editOptions));return this._formatter(h,p)},_parser:n.parse,parse:function(h,p){var e=r.mixin({},p,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=e.places){var c=e.places;c="number"===typeof c?c:Number(c.split(",").pop());e.places="0,"+c}e=this._parser(h,e);this.editOptions&&this.focused&&isNaN(e)&&(e=this._parser(h,p));return e},_getDisplayedValueAttr:function(){var h=this.inherited(arguments);return isNaN(h)?this.textbox.value:h},filter:function(h){if(null==
h||"string"==typeof h&&""==h)return NaN;"number"!=typeof h||isNaN(h)||0==h||(h=n.round(h,this._decimalInfo.places));return this.inherited(arguments,[h])},serialize:function(h,p){return"number"!=typeof h||isNaN(h)?"":this.inherited(arguments)},_setBlurValue:function(){var h=r.hitch(r.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(h,!0)},_setValueAttr:function(h,p,e){if(void 0!==h&&void 0===e)if(e=String(h),"number"==typeof h)if(isNaN(h))e="";else{if("rangeCheck"in this&&this.rangeCheck(h,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else h?h=void 0:(e="",h=NaN);this.inherited(arguments,[h,p,e])},_getValueAttr:function(){var h=this.inherited(arguments);if(isNaN(h)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+n._realNumberRegexp(r.delegate(this.constraints))+"$")).test(this.textbox.value))return h=Number(this.textbox.value),isNaN(h)?void 0:h}else return h},isValid:function(h){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var p=this.get("value");return!isNaN(p)&&this.rangeCheck(p,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var h="number"==typeof this.constraints.min,p="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!h&&!p)return this.inherited(arguments);var c=e|0,f=0>e,b=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
d=(this.maxLength||20)-this.textbox.value.length,a=b?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";c=b?c+"."+a:c+"";d=x.rep("9",d);b=e;f?b=Number(c+d):e=Number(c+d);return!(h&&e<this.constraints.min||p&&b>this.constraints.max)}});F=F("dijit.form.NumberTextBox",[v,m],{baseClass:"dijitTextBox dijitNumberTextBox"});F.Mixin=m;return F})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(F,r,z,x,n,v,t,m){return F([m],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=r.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=r.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=r.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);r.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(x(this,"Change",z.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(h,p){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof h&&(this._fetchHandle=v.after(this,"onFetch",h),this.own(this._fetchHandle));"function"===typeof p&&(this._fetchErrHandle=v.after(this,"onFetchError",p),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(h){return h},onFetchError:function(h){},getStatus:function(){return this._status},_onServiceUrlChange:function(h){var p=new n;p.then(z.hitch(this,function(){this._valid()}),z.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();h?t({url:z.trim(h||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(z.hitch(this,function(e){this.onFetch({url:this.getValue(),data:e})?p.resolve("success"):p.reject("error")}),z.hitch(this,function(e){p.reject(e)})):p.reject("error")},_validating:function(){this._status="validating";r.removeClass(this.domNode,"jimu-serviceurl-input-invalid");r.removeClass(this.domNode,"jimu-serviceurl-input-valid");r.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";r.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
r.removeClass(this.domNode,"jimu-serviceurl-input-validating");r.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";r.removeClass(this.domNode,"jimu-serviceurl-input-validating");r.removeClass(this.domNode,"jimu-serviceurl-input-valid");r.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox dijit/form/Select".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f){return F([r,z,x],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,singleClickEdit:!1,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(e.bindClickAndDblclickEvents(this.tableInBodySection,n.hitch(this,function(a){if(a=e.getAncestorDom(a.target||a.srcElement,function(g){return v.hasClass(g,"simple-table-row")&&v.hasClass(g,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),n.hitch(this,function(a){if(a=e.getAncestorDom(a.target||a.srcElement,function(g){return v.hasClass(g,"simple-table-row")&&v.hasClass(g,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var b=Math.random().toString();this._name="jimu_table_"+b.slice(2,b.length);if(this.fields&&0<this.fields.length){var d=v.create("tr",{},this.thead);t.forEach(this.fields,n.hitch(this,function(a){var g="auto";"actions"===a.type&&(a.name="actions");a.hidden?g=1:void 0!==a.width&&null!==a.width?g=a.width:"actions"!==a.type||a.name||(a.width=this._calculateActionsWidth(a)+20,g=a.width);v.create("col",{width:g},this.headColgroup);
v.create("col",{width:g},this.bodyColgroup);g=v.create("th",{innerHTML:e.sanitizeHTML(a.title),title:a.title},d);if("checkbox"===a.type){g.innerHTML="";var l=new c({label:a.title});this.own(m(l.domNode,"click",n.hitch(this,function(){l.getValue()?this._checkAllTdCheckBoxes(a.name):this._uncheckAllTdCheckBoxes(a.name)})));l.placeAt(g)}v.addClass(g,"simple-table-field");a.hidden&&v.addClass(g,"hidden-column");a["class"]&&v.addClass(g,a["class"]);v.addClass(g,a.name)}))}else this.fields=null},_getThCheckBox:function(b){var d=
null;b=h(".simple-table-field."+b+" .jimu-checkbox",this.thead)[0];return d=p.byNode(b)},_getAllEnabledTdCheckBoxes:function(b){b=h(".simple-table-cell."+b+" .jimu-checkbox",this.tbody);b=t.map(b,function(d){return p.byNode(d)});return b=t.filter(b,function(d){return d.getStatus()})},_checkAllTdCheckBoxes:function(b){b=this._getAllEnabledTdCheckBoxes(b);t.forEach(b,function(d){d.getValue()||d.setValue(!0)})},_uncheckAllTdCheckBoxes:function(b){b=this._getAllEnabledTdCheckBoxes(b);t.forEach(b,function(d){d.getValue()&&
d.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(b){setTimeout(n.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(b)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(b){var d=this._getAllEnabledTdCheckBoxes(b);d=t.filter(d,n.hitch(this,function(a){return a.getStatus()}));0!==d.length&&(b=this._getThCheckBox(b),t.every(d,function(a){return a.getValue()})?b.getValue()||b.setValue(!0):b.getValue()&&b.setValue(!1))},clear:function(){var b=this._getNotEmptyRows(),
d=t.map(b,n.hitch(this,function(a){return this.getRowData(a)}));v.empty(this.tbody);t.forEach(b,n.hitch(this,function(a,g){this._onDeleteRow(a,d[g])}));this.updateUI();this._rowIndex=0;this._onClearRows(b)},addRows:function(b){var d=[];this.fields&&b&&0<b.length&&t.forEach(b,n.hitch(this,function(a){d.push(this.addRow(a,-1,!0))}));this.updateUI();return d},addRow:function(b,d,a){this._rowIndex++;var g={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==
typeof b)return g;var l=t.filter(this.fields,n.hitch(this,function(A){return"text"===A.type&&!0===A.unique}));l=t.filter(l,n.hitch(this,function(A){return 0<this.getRowDataArrayByFieldValue(A.name,b[A.name]).length}));if(0<l.length)return g.errorCode=this.REPEATING_ERROR,g.errorMessage="repeating data",g.repeatFields=l,g;var q=v.create("tr",{"class":"simple-table-row not-empty"},this.tbody);v.setAttr(q,"rowId","row"+this._rowIndex);t.forEach(this.fields,n.hitch(this,function(A){var u=b[A.name],k=
A.type,w=null;"actions"===k?w=this._createActionsTd(q,A):("text"===k?w=this._createTextTd(q,A,u):"radio"===k?w=this._createRadioTd(q,A,u):"checkbox"===k?w=this._createCheckboxTd(q,A,u):"empty"===k?w=this._createEmptyTd(q,A):"extension"===k?w=this._createExtensionTd(q,A,u):"dropdown"===k&&(w=this._createDropdownTd(q,A,u)),A.hidden&&v.addClass(w,"hidden-column"))}));a||(this.updateUI(),a=this.getRows(),"number"===typeof d&&0<=d&&d<a.length&&v.place(q,a[d],"before"));g.success=!0;g.tr=q;g.errorMessage=
null;this._onAddRow(q);return g},deleteRow:function(b){if(b){var d=this.getRowData(b);v.destroy(b);this.updateUI();this._onDeleteRow(b,d)}},selectRow:function(b){this.selectable&&(h(".simple-table-row",this.tbody).removeClass("jimu-state-active"),v.addClass(b,"jimu-state-active"),this._onSelectRow(b))},updateUI:function(){this._updateRowClassName();this._updateHeight();v.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
v.addClass(this.domNode,this._classVerticalScroll);t.forEach(this.fields,n.hitch(this,function(b){"checkbox"===b.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(b.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var b=v.getContentBox(this.tableInBodySection).w,d="100%";"number"===typeof b&&0<b&&(d=b+"px");v.setStyle(this.tableInHeadSection,"width",d)}},_updateHeight:function(){var b=this.getRows();this.autoHeight&&v.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<b.length?b.length:1)+1+"px");b&&0<b.length&&this.bodyTableDiv&&(b=v.getMarginSize(b[0]))&&b.h&&v.setStyle(this.bodyTableDiv,"backgroundSize","1px "+b.h+"px")},_updateRowClassName:function(){var b=h("."+this._classFirstSimpleTableRow,this.tbody)[0];b&&(b=h("."+this._classRowUpDiv,b)[0])&&v.removeClass(b,this._classJimuStateDisabled);(b=h("."+this._classLastSimpleTableRow,this.tbody)[0])&&(b=h("."+this._classRowDownDiv,b)[0])&&v.removeClass(b,this._classJimuStateDisabled);b=h("."+this._classSimpleTableRow,
this.tbody);b.removeClass("odd");b.removeClass("even");b.removeClass(this._classFirstSimpleTableRow);b.removeClass(this._classLastSimpleTableRow);t.forEach(b,n.hitch(this,function(a,g){0===g%2?v.addClass(a,"odd"):v.addClass(a,"even")}));if(0<b.length){var d=b[0];v.addClass(d,this._classFirstSimpleTableRow);(d=h("."+this._classRowUpDiv,d)[0])&&v.addClass(d,this._classJimuStateDisabled);b=b[b.length-1];v.addClass(b,this._classLastSimpleTableRow);(b=h("."+this._classRowDownDiv,b)[0])&&v.addClass(b,this._classJimuStateDisabled)}},
_createTextTd:function(b,d,a){var g=null;return g=d.editable?this._createEditableTextTd(b,d,a):this._createNormalTextTd(b,d,a)},_createNormalTextTd:function(b,d,a){var g=v.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');v.addClass(g,d.name);var l=h("div",g)[0];l.innerHTML=e.sanitizeHTML(a)||"";l.title=a||"";d["class"]&&v.addClass(g,d["class"]);v.place(g,b);return g},_createEditableTextTd:function(b,d,a){var g=v.toDom('\x3ctd class\x3d"editable-text-td '+
d.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');v.addClass(g,"simple-table-cell");v.place(g,b);d["class"]&&v.addClass(g,d["class"]);var l=h("div",g)[0],q=h("input",g)[0];l.innerHTML=e.sanitizeHTML(a)||"";""!==l.innerHTML&&(l.title=l.innerText||l.innerHTML);q.value=l.innerHTML;this.own(m(l,this.singleClickEdit?"click":"dblclick",n.hitch(this,function(A){this.singleClickEdit||A.stopPropagation();
q.value=l.innerText||l.innerHTML;v.setStyle(l,"display","none");v.setStyle(q,"display","inline");q.focus();q.select&&q.select()})));this.own(m(q,"blur",n.hitch(this,function(){q.value=n.trim(e.sanitizeHTML(q.value));var A=l.innerText||l.innerHTML,u=q.value;""!==u?d.unique?0<this.getRowDataArrayByFieldValue(d.name,u,b).length?q.value=A:l.innerHTML=e.sanitizeHTML(u):l.innerHTML=e.sanitizeHTML(u):q.value=A;v.setStyle(q,"display","none");v.setStyle(l,"display","block")})));return g},_createRadioTd:function(b,
d,a){var g=v.toDom('\x3ctd class\x3d"radio-td '+d.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');v.addClass(g,"simple-table-cell");v.place(g,b);d["class"]&&v.addClass(g,d["class"]);b=h("input",g)[0];b.name=d.radio&&"row"===d.radio?this._name+this._rowIndex:this._name+d.name;b.checked=!0===a;return g},_createCheckboxTd:function(b,d,a){var g=v.toDom('\x3ctd class\x3d"checkbox-td '+d.name+'"\x3e\x3c/td\x3e');v.addClass(g,"simple-table-cell");v.place(g,b);d["class"]&&
v.addClass(g,d["class"]);var l=new c({onChange:n.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(d.name);"function"===typeof d.onChange&&setTimeout(n.hitch(this,function(){d.onChange(b,l)}),200)})});this.own(m(l,"status-change",n.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(d.name)})));this._setValueForCheckBox(l,a);l.placeAt(g);return g},_createActionsTd:function(b,d){var a=v.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');
v.addClass(a,"simple-table-cell");var g=h(".action-item-parent",a)[0];v.place(a,b);d["class"]&&v.addClass(a,d["class"]);t.forEach(d.actions,n.hitch(this,function(l){"up"===l?(l=v.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},g),l.title=this.nls.moveUp,this.own(m(l,"click",n.hitch(this,function(q){q.stopPropagation();if(this.onBeforeRowUp(b)){q=h(".simple-table-row",this.tbody);var A=t.indexOf(q,b);0<A&&(q=q[A-1])&&(v.place(b,q,"before"),this.updateUI(),
this.emit("row-up",b))}})))):"down"===l?(l=v.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},g),l.title=this.nls.moveDown,this.own(m(l,"click",n.hitch(this,function(q){q.stopPropagation();if(this.onBeforeRowDown(b)){q=h(".simple-table-row",this.tbody);var A=t.indexOf(q,b);A<q.length-1&&(q=q[A+1])&&(v.place(b,q,"after"),this.updateUI(),this.emit("row-down",b))}})))):"edit"===l?(l=v.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},
g),l.title=this.nls.edit,this.own(m(l,"click",n.hitch(this,function(q){q.stopPropagation();this.onBeforeRowEdit(b)&&this._onActionsEdit(b)})))):"delete"===l&&(l=v.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},g),l.title=this.nls.deleteRow,this.own(m(l,"click",n.hitch(this,function(q){q.stopPropagation();this.onBeforeRowDelete(b)&&this.deleteRow(b)}))))}));d=this._calculateActionsWidth(d)+"px";v.setStyle(g,"width",d);return a},_calculateActionsWidth:function(b){return 20*
t.map(b.actions,function(d){return"up"===d||"down"===d||"edit"===d||"delete"===d}).length},_createEmptyTd:function(b,d){b=v.create("td",{"class":d.name},b);v.addClass(b,"simple-table-cell");v.addClass(b,"empty-text-td");d["class"]&&v.addClass(b,d["class"]);return b},_createExtensionTd:function(b,d,a){b=v.create("td",{"class":d.name},b);v.addClass(b,"simple-table-cell");v.addClass(b,"extension-td");d["class"]&&v.addClass(b,d["class"]);d.create&&"function"===typeof d.create&&d.create(b);d.setValue&&
"function"===typeof d.setValue&&d.setValue(b,a);return b},_createDropdownTd:function(b,d,a){b=v.create("td",{"class":d.name},b);v.addClass(b,"simple-table-cell");v.addClass(b,"dropdown-td");d["class"]&&v.addClass(b,d["class"]);(new f({options:a})).placeAt(b);return b},editRow:function(b,d){var a={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof d||!v.isDescendant(b,this.tbody))return a;var g=n.mixin([],this.fields);g=t.filter(g,n.hitch(this,
function(q){return"text"===q.type&&!0===q.unique}));g=t.filter(g,n.hitch(this,function(q){return 0<this.getRowDataArrayByFieldValue(q.name,d[q.name],b).length}));if(0<g.length)return a.errorCode=this.REPEATING_ERROR,a.errorMessage="repeating data",a.repeatFields=g,a;var l=h(".simple-table-cell",b);t.forEach(this.fields,n.hitch(this,function(q,A){if(d.hasOwnProperty(q.name)){A=l[A];var u=d[q.name],k=q.type;"text"===k?q.editable?this._editEditableText(A,q,u):this._editNormalText(A,q,u):"radio"===k?
this._editRadio(A,q,u):"checkbox"===k?this._editCheckbox(A,q,u):"extension"===k?this._editExtension(A,q,u):"dropdown"===k&&this._editDropdown(A,q,u)}}));a.success=!0;a.tr=b;a.errorMessage=null;this._onEditRow(b);return a},_editNormalText:function(b,d,a){b=h("div",b)[0];b.innerHTML=e.sanitizeHTML(a)||"";b.title=b.innerHTML},_editEditableText:function(b,d,a){d=h("div",b)[0];d.innerHTML=e.sanitizeHTML(a)||"";h("input",b)[0].value=d.innerHTML},_editRadio:function(b,d,a){h("input",b)[0].checked=!0===a},
_editCheckbox:function(b,d,a){b=h(".jimu-checkbox",b)[0];b=p.byNode(b);this._setValueForCheckBox(b,a)},_setValueForCheckBox:function(b,d){null===d?b.setStatus(!1):(b.setStatus(!0),d!==b.getValue()&&b.setValue(d))},_editExtension:function(b,d,a){d.setValue&&"function"===typeof d.setValue&&d.setValue(b,a)},_editDropdown:function(b,d,a){b=h(".dijitSelect",b)[0];p.byNode(b).set("value",a)},_getAllRows:function(){return h(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var b=this._getAllRows();
return t.filter(b,n.hitch(this,function(d){return!v.hasClass(d,"empty")}))},_getEmptyRows:function(){var b=this._getAllRows();return t.filter(b,n.hitch(this,function(d){return v.hasClass(d,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var b=null,d=h(".simple-table-row",this.tbody);d=t.filter(d,n.hitch(this,function(a){return!v.hasClass(a,"empty")&&v.hasClass(a,"jimu-state-active")}));0<d.length&&(b=d[0]);return b},getSelectedRowData:function(){var b=null,
d=this.getSelectedRow();d&&(b=this._getRowDataByTr(d));return b},getData:function(b){var d=this._getNotEmptyRows();b&&(d=t.filter(d,n.hitch(this,function(a){return a!==b})));return t.map(d,n.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(b){return this._getRowDataByTr(b)},_getRowDataByTr:function(b){var d=null;if(b)d={};else return null;t.forEach(this.fields,n.hitch(this,function(a){var g=a.type;if("actions"!==g){var l=a.name;d[l]=null;var q=h(".simple-table-cell."+
l,b)[0];q&&("text"===g?(a=h("div",q)[0],d[l]=a.innerText||a.innerHTML):"radio"===g?(a=h("input",q)[0],d[l]=a.checked):"checkbox"===g?(a=h(".jimu-checkbox",q)[0],a=p.byNode(a),a.getStatus()?d[l]=a.getValue():d[l]=null):"extension"===g?a.getValue&&"function"===typeof a.getValue&&(d[l]=a.getValue(q,a)):"dropdown"===g&&(a=h(".dijitSelect",q)[0],a=p.byNode(a),d[l]=a.get("value")))}}));return d},getRowDataArrayByFieldValue:function(b,d,a){var g=[];if(!this.fields||!t.some(this.fields,n.hitch(this,function(l){return l.name===
b})))return[];a=this.getData(a);return g=t.filter(a,n.hitch(this,function(l){return l[b]==d}))},moveToTop:function(b){b&&b.parentNode===this.tbody&&v.place(b,this.tbody,"first")},_onClickRow:function(b){this.emit("row-click",b)},_onDblClickRow:function(b){this.emit("row-dblclick",b)},_onSelectRow:function(b){this.emit("row-select",b)},_onAddRow:function(b){this.emit("row-add",b)},_onEditRow:function(b){this.emit("row-edit",b)},_onDeleteRow:function(b,d){this.emit("row-delete",b,d)},_onEnterRow:function(b){this.emit("row-enter",
b)},_onClearRows:function(b){this.emit("rows-clear",b)},_onActionsEdit:function(b){this.emit("actions-edit",b)},onBeforeRowUp:function(b){return!0},onBeforeRowDown:function(b){return!0},onBeforeRowEdit:function(b){return!0},onBeforeRowDelete:function(b){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(F,r,z,
x,n,v,t,m,h,p,e){return F([m,h,t],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new p(null,this.containerNode);this.own(n(this.containerNode,"keydown",r.hitch(this,
function(f){f.keyCode===v.ESCAPE&&(f.stopPropagation(),this._currentCtrlNode.focus())})));var c=1/this.tabs.length*100;this.isNested&&x.addClass(this.domNode,"nested");z.forEach(this.tabs,function(f){this._createTab(f,c)},this);this.own(n(this.controlNode,"keydown",r.hitch(this,function(f){var b=f.target,d;f.keyCode===v.RIGHT_ARROW?d=b.nextElementSibling?b.nextElementSibling:this.controlNodes[0]:f.keyCode===v.LEFT_ARROW?d=b.previousElementSibling?b.previousElementSibling:this.controlNodes[this.controlNodes.length-
1]:f.keyCode===v.HOME?d=this.controlNodes[0]:f.keyCode===v.END&&(d=this.controlNodes[this.controlNodes.length-1]);d&&(b=d,d.focus())})))}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);e.setVerticalCenter(this.domNode)},_createTab:function(c,f){f=x.create("div",{innerHTML:e.sanitizeHTML(c.title),"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":f+"%"},label:c.title},this.controlNode);this.viewStack.viewType=c.content.domNode?
"dijit":"dom";c.content.label=c.title;this.viewStack.addView(c.content);this.own(n(f,"click",r.hitch(this,function(b){this.onSelect(c.title,b)})));this.own(n(f,"keydown",r.hitch(this,function(b){if(b.keyCode===v.ENTER||b.keyCode===v.SPACE)this.onSelect(c.title,b)})));f.label=c.title;this.controlNodes.push(f)},onSelect:function(c,f){x.hasClass(f.target,"jimu-state-selected")||this.selectTab(c,f)},selectTab:function(c){this._selectControl(c);this.viewStack.switchView(c);this.emit("tabChanged",c)},_selectControl:function(c){z.forEach(this.controlNodes,
function(f){x.removeClass(f,"jimu-state-selected");x.setAttr(f,"tabindex","-1");f.label===c&&(this._currentCtrlNode=f,x.addClass(f,"jimu-state-selected"),x.setAttr(f,"tabindex","0"))},this)}})})},"jimu/dijit/ViewStack":function(){define("dojo/_base/declare dojo/_base/fx dojo/_base/lang dojo/_base/html dojo/_base/array dijit/_WidgetBase".split(" "),function(F,r,z,x,n,v){return F(v,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);
this.views||(this.views=[]);n.forEach(this.views,z.hitch(this,function(t){1===t.nodeType?(x.place(t,this.domNode),x.addClass(t,"view"),x.setStyle(t,"display","none")):t.domNode&&(x.place(t.domNode,this.domNode),x.addClass(t.domNode,"view"),x.setStyle(t.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var t="",m=this.getSelectedView();m&&(t=m.label);return t},
getViewByLabel:function(t){for(var m=0;m<this.views.length;m++)if(t===this.views[m].label)return this.views[m];return null},addView:function(t){this.views.push(t);1===t.nodeType?(x.place(t,this.domNode),x.addClass(t,"view")):t.domNode&&(x.place(t.domNode,this.domNode),x.addClass(t.domNode,"view"))},removeView:function(t){var m=this.views.length;this.views=n.filter(this.views,function(h){return t!==h});m!==this.views.length&&(1===t.nodeType?x.destroy(t):t.domNode&&t.destroyRecursive())},switchView:function(t){var m;
var h="number"===typeof t?this.views[t]:"string"===typeof t?this.getViewByLabel(t):t;this.views.forEach(z.hitch(this,function(p){if(p)if(1===p.nodeType?m=p:p.domNode&&(m=p.domNode),p===h){if(x.setStyle(m,"display","block"),r.fadeIn({node:m}).play(),p.domNode)if(!p._started)p.startup(),p._started=!0;else if("function"===typeof p.onShown)p.onShown()}else if(x.setStyle(m,"display","none"),r.fadeOut({node:m}).play(),p.domNode&&"function"===typeof p.onHidden)p.onHidden()}));this._currentView=h;this.onViewSwitch(h)},
onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack jimu/utils".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f){return F([h,p,t],{templateString:e,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,selected:"",tabs:null,average:!0,postCreate:function(){this.inherited(arguments);
this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(b){z.forEach(this.tabItems,r.hitch(this,function(d,a){x.removeClass(d,"jimu-state-active");x.setAttr(d,"tabindex","-1");d.label===b&&(x.addClass(d,"jimu-state-active"),x.setAttr(d,"tabindex","0"),this._currentIndex=a)}));this.viewStack.switchView(b);this.emit("tabChanged",b)},addTab:function(b){if(!this.average){var d=m("td:last-child",this.tabTr);0<d.length&&x.destroy(d[0])}0<
z.filter(this.tabs,function(a){return a.title===b.title}).length?console.error("tab title conflict: "+b.title):(this.tabs.push(b),this._createTab(b),this.average||this._addEmptyTab())},_addEmptyTab:function(){var b=x.toDom('\x3ctd nowrap class\x3d"tab-item-td tab-item-td-empty" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');x.place(b,this.tabTr)},removeTab:function(b){var d=-1;if(z.some(this.tabs,function(g,l){if(g.title===b)return d=l,!0})){var a=
this.tabs.splice(d,1)[0];z.some(this.tabItems,function(g,l){if(g.label===b)return this.tabItems.splice(l,1),x.destroy(g),!0},this);this.viewStack.removeView(a.content)}},showShelter:function(){x.setStyle(this.shelter,"display","block")},hideShelter:function(){x.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},_initSelf:function(){this.viewStack=new c(null,this.containerNode);this.own(n(this.containerNode,
"keydown",r.hitch(this,function(b){b.keyCode===v.ESCAPE&&(b.stopPropagation(),this.tabItems[this._currentIndex].focus())})));this.tabItems=[];z.forEach(this.tabs,function(b){this._createTab(b)},this);this.own(n(this.tabTr,"keydown",r.hitch(this,function(b){var d=b.target,a;b.keyCode===v.RIGHT_ARROW?a=d.nextElementSibling?!this.average&&x.hasClass(d.nextElementSibling,"tab-item-td-empty")?this.tabItems[0]:d.nextElementSibling:this.tabItems[0]:b.keyCode===v.LEFT_ARROW?a=d.previousElementSibling?d.previousElementSibling:
this.tabItems[this.tabItems.length-1]:b.keyCode===v.HOME?a=this.tabItems[0]:b.keyCode===v.END&&(a=this.tabItems[this.tabItems.length-1]);a&&(d=a,a.focus())})));this.average?(this.controlTable.style.tableLayout="fixed",x.addClass(this.domNode,"average")):this._addEmptyTab()},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(b){var d=x.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');d.label=b.title||"";d.title=
b.title;x.place(d,this.tabTr);var a=m(".tab-item-div",d)[0];a.innerHTML=f.sanitizeHTML(d.label);a.label=d.label;b.content.label=d.label;this.viewStack.addView(b.content);this.own(n(d,"click",r.hitch(this,function(g){this._onSelect(b.title,g)})));this.own(n(d,"keydown",r.hitch(this,function(g){g.keyCode!==v.ENTER&&g.keyCode!==v.SPACE||this._onSelect(b.title,g)})));this.tabItems.push(d)},_onSelect:function(b,d){x.hasClass(d.target,"jimu-state-active")||this.selectTab(b)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(F,r,z,x){return F([x],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(r.hitch(this,function(n){this._placeItem(n)}));this.resize()},_placeItem:function(n){n.domNode?z.place(n.domNode,this.domNode):z.place(n,this.domNode)},addItem:function(n){this.items.push(n);this._placeItem(n);
this.resize()},addItems:function(n){this.items=this.items.concat(n);this.items.forEach(r.hitch(this,function(v){this._placeItem(v)}));this.resize()},removeItem:function(n){var v;for(v=0;v<this.items.length;v++)if(this.items[v].label===n){this.items[v].domNode?this.items[v].destroy():z.destroy(this.items[v]);this.items.splice(v,1);this.resize();break}},empty:function(){var n;for(n=0;n<this.items.length;n++)this.items[n].domNode?this.items[n].destroy():z.destroy(this.items[n]);this.items=[]},resize:function(){var n=
z.getMarginBox(this.domNode);var v=this.getItemSize(n);var t=Math.floor((n.w+this.hmargin)/(v.width+this.hmargin));this.items.forEach(r.hitch(this,function(m,h){this.setItemPosition(m,h,v,t)}))},getItemSize:function(n){var v={},t;if("fixWidth"===this.strategy)v.width=this.itemSize.width,v.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(t=0;t<this.itemSize.length;t++){if(n.w<=this.itemSize[t].screenWidth){v.width=this.itemSize[t].width;v.height=this.itemSize[t].height;break}}else"fixCols"===
this.strategy&&(v.width=(n.w-this.hmargin*(this.maxCols-1))/this.maxCols,v.height="number"===typeof this.itemSize.height?this.itemSize.height:v.width*parseFloat(this.itemSize.height.substring(0,this.itemSize.height.length-1))/100);return v},setItemPosition:function(n,v,t,m){v++;var h=v%m;v=Math.ceil(v/m);0===h&&(h=m);m={position:"absolute",top:(this.vmargin+t.height)*(v-1)+"px"};m[window.isRTL?"right":"left"]=(this.hmargin+t.width)*(h-1)+"px";0<=t.width&&(m.width=t.width+"px");0<=t.height&&(m.height=
t.height+"px");z.setStyle(n.domNode?n.domNode:n,m)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer jimu/dijit/Draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){var l={};return F([r,z,x,c],
{templateString:n,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var q={};this.drawLayerId&&(q.id=this.drawLayerId);
this.drawLayer=new b(q);this._initDefaultSymbols();this._initTypes();q=e(".draw-item",this.domNode);q.forEach(function(A){t.setAttr(A,"role","button");t.setAttr(A,"tabindex","0")});this.own(q.on(p,v.hitch(this,this._onItemClick)));t.setAttr(this.btnClear,"role","button");t.setAttr(this.btnClear,"tabindex","0");this.own(h(this.btnClear,p,v.hitch(this,this._onClickClear)));this.own(h(document.body,"keydown",v.hitch(this,function(A){this._shiftKey=!!A.shiftKey;this._ctrlKey=!!A.ctrlKey;this._metaKey=
!!A.metaKey})));this.own(h(document.body,"keyup",v.hitch(this,function(A){this._shiftKey=!!A.shiftKey;this._ctrlKey=!!A.ctrlKey;this._metaKey=!!A.metaKey})));this.map&&this.setMap(this.map);t.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable();l[this.id]=this},enable:function(){this._isDisabled=!1;t.addClass(this.domNode,"enabled");t.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;t.addClass(this.domNode,"disabled");t.removeClass(this.domNode,
"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var q=e(".draw-item.jimu-state-active",this.domNode);return q&&0<q.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&
this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;delete l[this.id];this.inherited(arguments)},setMap:function(q){q&&(this.map=q,this.map.addLayer(this.drawLayer),this.drawToolBar=new d(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(h(this.drawToolBar,"draw-end",v.hitch(this,this._onDrawEnd))))},setPointSymbol:function(q){this.pointSymbol=q;
this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(q){this.polylineSymbol=q;this.drawToolBar.setLineSymbol(q)},setPolygonSymbol:function(q){this.polygonSymbol=q;this.drawToolBar.setFillSymbol(q)},setTextSymbol:function(q){this.textSymbol=q},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();e(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),
this.emit("draw-deactivate"))},activate:function(q){var A=null,u=e(".draw-item",this.domNode);"TEXT"===q?(q="POINT",A=this.textIcon):(u=u.filter(function(k){return k.getAttribute("data-geotype")===q}),0<u.length&&(A=u[0]));A&&this._activate(A)},onIconSelected:function(q,A,u){this.emit("icon-selected",q,A,u)},onDrawEnd:function(q,A,u,k,w,y){this.emit("draw-end",q,A,u,k,w,y)},onClear:function(){this.emit("clear")},addGraphic:function(q){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(q)},
removeGraphic:function(q){this.drawLayer.remove(q)},getFirstGraphic:function(){var q=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(q=this.drawLayer.graphics[0]);return q},show:function(){t.removeClass(this.domNode,"hidden")},hide:function(){t.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return e(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var q={style:"esriSMSCircle",color:[0,
0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},A={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},u={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=a.fromJson(q));this.polylineSymbol||(this.polylineSymbol=a.fromJson(A));this.polygonSymbol||(this.polygonSymbol=a.fromJson(u))},_initTypes:function(){this.geoTypes&&
0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","arrow","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("arrow")&&(this.geoTypes=this.geoTypes.concat(["ARROW"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),
0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var q=e(".draw-item",this.domNode);q.style("display","none");m.forEach(q,v.hitch(this,function(A){var u=A.getAttribute("data-geotype");u=0<=m.indexOf(this.geoTypes,u);t.setStyle(A,"display",u?"block":"none")}))},_onItemClick:function(q){this._isDisabled||(q=q.target||q.srcElement,t.hasClass(q,"draw-item")&&(t.hasClass(q,"jimu-state-active")?this.deactivate():this._activate(q)))},_activate:function(q){this._deactiveAllDrawBoxes();
e(".draw-item",this.domNode).removeClass("jimu-state-active");t.addClass(q,"jimu-state-active");var A=q.getAttribute("data-geotype"),u=q.getAttribute("data-commontype"),k=d[A];"TEXT"===A&&(k=d.POINT);this.disableWebMapPopup();this.drawToolBar.activate(k);this.emit("draw-activate",k);this.onIconSelected(q,A,u)},_onDrawEnd:function(q){var A=e(".draw-item.jimu-state-active",this.domNode)[0],u=A.getAttribute("data-geotype");A=A.getAttribute("data-commontype");var k=null;k="extent"===q.geometry.type?g.fromExtent(q.geometry):
q.geometry;k.geoType=u;k.commonType=A;q=k.type;var w=null;w="point"===q||"multipoint"===q?t.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===q||"polyline"===q?this.polylineSymbol:this.polygonSymbol;k=new f(k,w,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(k);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(k,u,A,this._shiftKey,this._ctrlKey,this._metaKey)},_deactiveAllDrawBoxes:function(){var q;m.forEach(Object.keys(l),
v.hitch(this,function(A){(q=l[A])&&q.drawToolBar&&A!==this.id&&q.deactivate()}))}})})},"jimu/dijit/Draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/has esri/kernel esri/toolbars/draw esri/graphic esri/geometry/Polyline esri/geometry/Polygon esri/geometry/Multipoint esri/geometry/Rect".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){var c=F([v],{baseClass:"jimu-draw",declaredClass:"jimu.dijit.Draw",_onMouseDragHandler:function(f){if(this._graphic||this._points.length)if(x("esri-touch")&&
!this._points.length)f.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var b=this.map.snappingManager._snappingPoint;var d=this._points[0],a=b||f.mapPoint,g=this.map,l=g.spatialReference;b=this._graphic;var q=c,A=g.toScreen(d),u=g.toScreen(a),k=[];k=u.x-A.x;u=u.y-A.y;var w=Math.sqrt(k*k+u*u);switch(this._geometryType){case q.CIRCLE:this._hideTooltip();b.geometry=h.createCircle({center:A,r:w,numberOfPoints:60,map:g});b.setGeometry(b.geometry);break;case q.ELLIPSE:this._hideTooltip();
b.geometry=h.createEllipse({center:A,longAxis:k,shortAxis:u,numberOfPoints:60,map:g});b.setGeometry(b.geometry);break;case q.TRIANGLE:this._hideTooltip();k=[[0,-w],[.8660254037844386*w,.5*w],[-.8660254037844386*w,.5*w],[0,-w]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.ARROW:this._hideTooltip();d=u/w;g=k/w;a=.25*g*w;l=.25*w/(u/k);w*=.25*d;q=this.fillSymbol?this.fillSymbol.arrowWidth:12;k=[[k,u],[k-a*(1+q/l),u+q*g-w],[k-a*(1+q/2/l),u+q/2*g-w],[-q/2*d,q/2*g],[q/2*d,
-q/2*g],[k-a*(1-q/2/l),u-q/2*g-w],[k-a*(1-q/l),u-q*g-w],[k,u]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.LEFT_ARROW:this._hideTooltip();k=0>=k?[[k,0],[.75*k,u],[.75*k,.5*u],[0,.5*u],[0,-.5*u],[.75*k,-.5*u],[.75*k,-u],[k,0]]:[[0,0],[.25*k,u],[.25*k,.5*u],[k,.5*u],[k,-.5*u],[.25*k,-.5*u],[.25*k,-u],[0,0]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.RIGHT_ARROW:this._hideTooltip();k=0<=k?[[k,0],[.75*k,u],[.75*k,.5*u],[0,.5*u],[0,-.5*
u],[.75*k,-.5*u],[.75*k,-u],[k,0]]:[[0,0],[.25*k,u],[.25*k,.5*u],[k,.5*u],[k,-.5*u],[.25*k,-.5*u],[.25*k,-u],[0,0]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.UP_ARROW:this._hideTooltip();k=0>=u?[[0,u],[-k,.75*u],[-.5*k,.75*u],[-.5*k,0],[.5*k,0],[.5*k,.75*u],[k,.75*u],[0,u]]:[[0,0],[-k,.25*u],[-.5*k,.25*u],[-.5*k,u],[.5*k,u],[.5*k,.25*u],[k,.25*u],[0,0]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.DOWN_ARROW:this._hideTooltip();k=
0<=u?[[0,u],[-k,.75*u],[-.5*k,.75*u],[-.5*k,0],[.5*k,0],[.5*k,.75*u],[k,.75*u],[0,u]]:[[0,0],[-k,.25*u],[-.5*k,.25*u],[-.5*k,u],[.5*k,u],[.5*k,.25*u],[k,.25*u],[0,0]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.RECTANGLE:this._hideTooltip();k=[[0,0],[k,0],[k,u],[0,u],[0,0]];b.geometry=this._toPolygon(k,A.x,A.y);b.setGeometry(b.geometry);break;case q.LINE:b.setGeometry(r.mixin(b.geometry,{paths:[[[d.x,d.y],[a.x,a.y]]]}));break;case q.EXTENT:b&&g.graphics.remove(b,!0);
b=new e(this._normalizeRect(d,a,l));b._originOnly=!0;this._graphic=g.graphics.add(new t(b,this.fillSymbol),!0);g.snappingManager&&g.snappingManager._setGraphic(this._graphic);break;case q.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(f)){x("esri-touch")&&f.preventDefault();return}this._points.push(f.mapPoint.offset(0,0));b.geometry._insertPoints([a.offset(0,0)],0);b.setGeometry(b.geometry);break;case q.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(f)){x("esri-touch")&&
f.preventDefault();return}this._points.push(f.mapPoint.offset(0,0));b.geometry._insertPoints([a.offset(0,0)],0);b.setGeometry(b.geometry)}x("esri-touch")&&f.preventDefault()}},_onClickHandler:function(f){if(this.map.snappingManager)var b=this.map.snappingManager._snappingPoint;var d=b||f.mapPoint;f=this.map;b=f.toScreen(d);var a=c;this._points.push(d.offset(0,0));switch(this._geometryType){case a.POINT:this.onDrawStart();this._drawEnd(d.offset(0,0));this._setTooltipMessage(0);break;case a.POLYLINE:1===
this._points.length?(b=new m(f.spatialReference),b.addPath(this._points),this._graphic=f.graphics.add(new t(b,this.lineSymbol),!0),f.snappingManager&&f.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=z.connect(f,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([d.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case a.POLYGON:1===this._points.length?(b=new h(f.spatialReference),
b.addRing(this._points),this._graphic=f.graphics.add(new t(b,this.fillSymbol),!0),f.snappingManager&&f.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=z.connect(f,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([d.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case a.MULTI_POINT:b=this._points;1===b.length?(d=new p(f.spatialReference),d.addPoint(b[b.length-1]),this._graphic=
f.graphics.add(new t(d,this.markerSymbol),!0),f.snappingManager&&f.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(b[b.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case a.ARROW:f=this.fillSymbol?this.fillSymbol.arrowWidth:12;this._addShape([[0,0],[-f,f],[-f,f/2],[-96,f/2],[-96,-f/2],[-f,-f/2],[-f,-f],[0,0]],b.x,b.y);break;case a.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,
-12],[24,-24],[0,0]],b.x,b.y);break;case a.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],b.x,b.y);break;case a.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],b.x,b.y);break;case a.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],b.x,b.y);break;case a.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],b.x,b.y);break;case a.RECTANGLE:this._addShape([[0,
-96],[96,-96],[96,0],[0,0],[0,-96]],b.x-48,b.y+48);break;case a.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(h.createCircle({center:b,r:48,numberOfPoints:60,map:f}));break;case a.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(h.createEllipse({center:b,longAxis:48,shortAxis:24,numberOfPoints:60,map:f}))}this._setTooltipMessage(this._points.length)}});r.mixin(c,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",
FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});x("extend-esri")&&r.setObject("toolbars.Draw",c,n);return c})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u,k,w,y,C,D){var G=F(d,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(H,L){this.markerSymbol=new a(a.STYLE_SOLID,10,new g(g.STYLE_SOLID,new n([255,0,0]),2),new n([0,0,0,.25]));this.lineSymbol=new g(g.STYLE_SOLID,new n([255,0,0]),2);this.fillSymbol=new l(l.STYLE_SOLID,new g(g.STYLE_SOLID,new n([255,0,0]),2),new n([0,0,0,.25]));this._points=[];this._mouse=!t("esri-touch")&&!t("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=r.mixin(r.mixin({},this._defaultOptions),L||{});if(m("ios")||m("android"))this._options.showTooltips=!1;this._onKeyDownHandler=r.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=r.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=r.hitch(this,this._onMouseUpHandler);this._onClickHandler=r.hitch(this,this._onClickHandler);this._onMouseMoveHandler=r.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=r.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=r.hitch(this,this._onDblClickHandler);this._updateTooltip=r.hitch(this,this._updateTooltip);this._hideTooltip=r.hitch(this,this._hideTooltip);this._redrawGraphic=r.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(H){this.respectDrawingVertexOrder=H},setMarkerSymbol:function(H){this.markerSymbol=H},setLineSymbol:function(H){this.lineSymbol=H},
setFillSymbol:function(H){this.fillSymbol=H},activate:function(H,L){this._geometryType&&this.deactivate();var T=this.map,K=x.connect,O=G;this._options=r.mixin(r.mixin({},this._options),L||{});T.navigationManager.setImmediateClick(!1);switch(H){case O.ARROW:case O.LEFT_ARROW:case O.RIGHT_ARROW:case O.UP_ARROW:case O.DOWN_ARROW:case O.TRIANGLE:case O.CIRCLE:case O.ELLIPSE:case O.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=K(T,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=K(T,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=K(T,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=K(T,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=K(T,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=K(T,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=K(T,"onMouseDragEnd",this._onMouseUpHandler));t("esri-touch")&&(this._onMouseDownHandler2_connect=
K(T,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=K(T,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=K(T,"onSwipeEnd",this._onMouseUpHandler));break;case O.POINT:this._onClickHandler_connect=K(T,"onClick",this._onClickHandler);break;case O.LINE:case O.EXTENT:case O.FREEHAND_POLYLINE:case O.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=K(T,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
K(T,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=K(T,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=K(T,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=K(T,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=K(T,"onMouseDragEnd",this._onMouseUpHandler));t("esri-touch")&&(this._onMouseDownHandler2_connect=K(T,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=K(T,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=K(T,"onSwipeEnd",this._onMouseUpHandler));break;case O.POLYLINE:case O.POLYGON:case O.MULTI_POINT:T.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=K(T,"onClick",this._onClickHandler);this._onDblClickHandler_connect=K(T,"onDblClick",this._onDblClickHandler);this._dblClickZoom=T.isDoubleClickZoom;T.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+H);return}this._onKeyDown_connect=K(T,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=K(T,"onExtentChange",this._redrawGraphic);this._geometryType=H;this._toggleTooltip(!0);T.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(T.snappingManager._startSelectionLayerQuery(),T.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var H=this.map;this._clear();var L=x.disconnect;L(this._onMouseMoveHandler_connect);L(this._onMouseDownHandler_connect);L(this._onMouseDragHandler_connect);
L(this._onMouseUpHandler_connect);L(this._onMouseDownHandler2_connect);L(this._onMouseDragHandler2_connect);L(this._onMouseUpHandler2_connect);L(this._onClickHandler_connect);L(this._onDblClickHandler_connect);L(this._onKeyDown_connect);L(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;H.snappingManager&&(H.snappingManager._stopSelectionLayerQuery(),H.snappingManager._killOffSnapping());switch(this._geometryType){case G.CIRCLE:case G.ELLIPSE:case G.TRIANGLE:case G.ARROW:case G.LEFT_ARROW:case G.RIGHT_ARROW:case G.UP_ARROW:case G.DOWN_ARROW:case G.RECTANGLE:case G.LINE:case G.EXTENT:case G.FREEHAND_POLYLINE:case G.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case G.POLYLINE:case G.POLYGON:case G.MULTI_POINT:this._dblClickZoom&&
H.enableDoubleClickZoom()}L=this._geometryType;this._geometryType=null;H.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(L)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var H=this._points,L=this.map.spatialReference,T=G;H=H.slice(0,H.length);switch(this._geometryType){case T.POLYLINE:if(!this._graphic||2>
H.length)return;var K=new k(L);K.addPath([].concat(H));break;case T.POLYGON:if(!this._graphic||3>H.length)return;K=new w(L);H=[].concat(H,[H[0].offset(0,0)]);w.prototype.isClockwise(H)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),H.reverse());K.addRing(H);break;case T.MULTI_POINT:K=new y(L),z.forEach(H,function(O){K.addPoint(O)})}x.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(K)},_drawEnd:function(H){if(H){var L=this.map.spatialReference,T;this.onDrawEnd(H);L&&(L.isWebMercator()?T=u.webMercatorToGeographic(H,!0):4326===L.wkid&&(T=A.fromJson(H.toJson())));this.onDrawComplete({geometry:H,geographicGeometry:T})}},_normalizeRect:function(H,L,T){var K=H.x;H=H.y;var O=L.x;L=L.y;return{x:Math.min(K,O),y:Math.max(H,L),width:Math.abs(K-O),height:Math.abs(H-L),spatialReference:T}},_onMouseDownHandler:function(H){this._dragged=!1;if(this.map.snappingManager)var L=this.map.snappingManager._snappingPoint;
var T=L||H.mapPoint,K=G;L=this.map;var O=L.spatialReference;this._points.push(T.offset(0,0));switch(this._geometryType){case K.LINE:this._graphic=L.graphics.add(new q(new k({paths:[[[T.x,T.y],[T.x,T.y]]],spatialReference:O}),this.lineSymbol),!0);L.snappingManager&&L.snappingManager._setGraphic(this._graphic);break;case K.FREEHAND_POLYLINE:this._oldPoint=H.screenPoint;T=new k(O);T.addPath(this._points);this._graphic=L.graphics.add(new q(T,this.lineSymbol),!0);L.snappingManager&&L.snappingManager._setGraphic(this._graphic);
break;case K.CIRCLE:case K.ELLIPSE:case K.TRIANGLE:case K.ARROW:case K.LEFT_ARROW:case K.RIGHT_ARROW:case K.UP_ARROW:case K.DOWN_ARROW:case K.RECTANGLE:case K.FREEHAND_POLYGON:this._oldPoint=H.screenPoint,T=new w(O),T.addRing(this._points),this._graphic=L.graphics.add(new q(T,this.fillSymbol),!0),L.snappingManager&&L.snappingManager._setGraphic(this._graphic)}t("esri-touch")&&H.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(H){if(this.map.snappingManager)var L=
this.map.snappingManager._snappingPoint;H=L||H.mapPoint;L=this._graphic.geometry;switch(this._geometryType){case G.POLYLINE:case G.POLYGON:var T=this._points.length,K=!!L.getPoint(0,T);H=H.offset(0,0);K?L.setPoint(0,T,H):L.insertPoint(0,T,H);this._graphic.setGeometry(L)}},_onMouseDragHandler:function(H){if(this._graphic||this._points.length)if(t("esri-touch")&&!this._points.length)H.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var L=this.map.snappingManager._snappingPoint;var T=
this._points[0],K=L||H.mapPoint,O=this.map,I=O.spatialReference;L=this._graphic;var P=G,Q=O.toScreen(T),U=O.toScreen(K),Y=[];Y=U.x-Q.x;U=U.y-Q.y;var ca=Math.sqrt(Y*Y+U*U);switch(this._geometryType){case P.CIRCLE:this._hideTooltip();L.geometry=w.createCircle({center:Q,r:ca,numberOfPoints:60,map:O});L.setGeometry(L.geometry);break;case P.ELLIPSE:this._hideTooltip();L.geometry=w.createEllipse({center:Q,longAxis:Y,shortAxis:U,numberOfPoints:60,map:O});L.setGeometry(L.geometry);break;case P.TRIANGLE:this._hideTooltip();
Y=[[0,-ca],[.8660254037844386*ca,.5*ca],[-.8660254037844386*ca,.5*ca],[0,-ca]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);break;case P.ARROW:this._hideTooltip();T=U/ca;O=Y/ca;K=.25*O*ca;I=.25*ca/(U/Y);ca*=.25*T;Y=[[Y,U],[Y-K*(1+24/I),U+24*O-ca],[Y-K*(1+12/I),U+12*O-ca],[-12*T,12*O],[12*T,-12*O],[Y-K*(1-12/I),U-12*O-ca],[Y-K*(1-24/I),U-24*O-ca],[Y,U]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);break;case P.LEFT_ARROW:this._hideTooltip();Y=0>=Y?[[Y,0],[.75*
Y,U],[.75*Y,.5*U],[0,.5*U],[0,-.5*U],[.75*Y,-.5*U],[.75*Y,-U],[Y,0]]:[[0,0],[.25*Y,U],[.25*Y,.5*U],[Y,.5*U],[Y,-.5*U],[.25*Y,-.5*U],[.25*Y,-U],[0,0]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);break;case P.RIGHT_ARROW:this._hideTooltip();Y=0<=Y?[[Y,0],[.75*Y,U],[.75*Y,.5*U],[0,.5*U],[0,-.5*U],[.75*Y,-.5*U],[.75*Y,-U],[Y,0]]:[[0,0],[.25*Y,U],[.25*Y,.5*U],[Y,.5*U],[Y,-.5*U],[.25*Y,-.5*U],[.25*Y,-U],[0,0]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);break;case P.UP_ARROW:this._hideTooltip();
Y=0>=U?[[0,U],[-Y,.75*U],[-.5*Y,.75*U],[-.5*Y,0],[.5*Y,0],[.5*Y,.75*U],[Y,.75*U],[0,U]]:[[0,0],[-Y,.25*U],[-.5*Y,.25*U],[-.5*Y,U],[.5*Y,U],[.5*Y,.25*U],[Y,.25*U],[0,0]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);break;case P.DOWN_ARROW:this._hideTooltip();Y=0<=U?[[0,U],[-Y,.75*U],[-.5*Y,.75*U],[-.5*Y,0],[.5*Y,0],[.5*Y,.75*U],[Y,.75*U],[0,U]]:[[0,0],[-Y,.25*U],[-.5*Y,.25*U],[-.5*Y,U],[.5*Y,U],[.5*Y,.25*U],[Y,.25*U],[0,0]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);
break;case P.RECTANGLE:this._hideTooltip();Y=[[0,0],[Y,0],[Y,U],[0,U],[0,0]];L.geometry=this._toPolygon(Y,Q.x,Q.y);L.setGeometry(L.geometry);break;case P.LINE:L.setGeometry(r.mixin(L.geometry,{paths:[[[T.x,T.y],[K.x,K.y]]]}));break;case P.EXTENT:L&&O.graphics.remove(L,!0);L=new C(this._normalizeRect(T,K,I));L._originOnly=!0;this._graphic=O.graphics.add(new q(L,this.fillSymbol),!0);O.snappingManager&&O.snappingManager._setGraphic(this._graphic);break;case P.FREEHAND_POLYLINE:this._hideTooltip();if(!1===
this._canDrawFreehandPoint(H)){t("esri-touch")&&H.preventDefault();return}this._points.push(H.mapPoint.offset(0,0));L.geometry._insertPoints([K.offset(0,0)],0);L.setGeometry(L.geometry);break;case P.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(H)){t("esri-touch")&&H.preventDefault();return}this._points.push(H.mapPoint.offset(0,0));L.geometry._insertPoints([K.offset(0,0)],0);L.setGeometry(L.geometry)}t("esri-touch")&&H.preventDefault()}},_canDrawFreehandPoint:function(H){if(!this._oldPoint)return!1;
var L=this._oldPoint.x-H.screenPoint.x,T=this._oldPoint.y-H.screenPoint.y,K=this._options.tolerance;if((0>L?-1*L:L)<K&&(0>T?-1*T:T)<K)return!1;L=new Date;if(L-this._startTime<this._options.drawTime)return!1;this._startTime=L;this._oldPoint=H.screenPoint;return!0},_onMouseUpHandler:function(H){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(H.mapPoint.offset(0,0));if(this.map.snappingManager)var L=this.map.snappingManager._snappingPoint;var T=this._points[0];L=L||H.mapPoint;
var K=this.map.spatialReference,O=G;switch(this._geometryType){case O.CIRCLE:case O.ELLIPSE:case O.TRIANGLE:case O.ARROW:case O.LEFT_ARROW:case O.RIGHT_ARROW:case O.UP_ARROW:case O.DOWN_ARROW:case O.RECTANGLE:var I=this._graphic.geometry;break;case O.LINE:I=new k({paths:[[[T.x,T.y],[L.x,L.y]]],spatialReference:K});break;case O.EXTENT:I=(new C(this._normalizeRect(T,L,K))).getExtent();break;case O.FREEHAND_POLYLINE:I=new k(K);I.addPath([].concat(this._points,[L.offset(0,0)]));break;case O.FREEHAND_POLYGON:I=
new w(K),T=[].concat(this._points,[L.offset(0,0),this._points[0].offset(0,0)]),w.prototype.isClockwise(T)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),T.reverse()),I.addRing(T)}t("esri-touch")&&H.preventDefault();this._clear();this._drawEnd(I)}else this._clear()},_isPointToPointTool:function(H){switch(H){case G.POLYLINE:case G.POLYGON:case G.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(H){if(this.map.snappingManager)var L=
this.map.snappingManager._snappingPoint;L=L||H.mapPoint;H=this.map;var T=H.toScreen(L),K=G;if(this._isPointToPointTool(this._geometryType)){var O=this._points[this._points.length-1];if(L&&O&&L.x===O.x&&L.y===O.y)return;this._points.push(L.offset(0,0))}switch(this._geometryType){case K.POINT:this.onDrawStart();this._drawEnd(L.offset(0,0));this._setTooltipMessage(0);break;case K.POLYLINE:1===this._points.length?(L=new k(H.spatialReference),L.addPath(this._points),this._graphic=H.graphics.add(new q(L,
this.lineSymbol),!0),H.snappingManager&&H.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=x.connect(H,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,L.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case K.POLYGON:1===this._points.length?(L=new w(H.spatialReference),L.addRing(this._points),this._graphic=H.graphics.add(new q(L,this.fillSymbol),
!0),H.snappingManager&&H.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=x.connect(H,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,L.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case K.MULTI_POINT:L=this._points;1===L.length?(T=new y(H.spatialReference),T.addPoint(L[L.length-1]),this._graphic=H.graphics.add(new q(T,this.markerSymbol),
!0),H.snappingManager&&H.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(L[L.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case K.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],T.x,T.y);break;case K.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],T.x,T.y);break;case K.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],T.x,T.y);break;case K.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],T.x,T.y);break;case K.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],T.x,T.y);break;case K.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],T.x,T.y);break;case K.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],T.x-48,T.y+48);break;case K.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(w.createCircle({center:T,r:48,numberOfPoints:60,map:H}));break;case K.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(w.createEllipse({center:T,longAxis:48,shortAxis:24,numberOfPoints:60,map:H}))}this._setTooltipMessage(this._points.length)},_addShape:function(H,L,T){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(H,L,T))},_toPolygon:function(H,L,T){var K=this.map,O=new w(K.spatialReference);O.addRing(z.map(H,function(I){return K.toMap({x:I[0]+
L,y:I[1]+T})}));return O},_onDblClickHandler:function(H){var L=this._points,T=this.map.spatialReference,K=G;t("esri-touch")&&L.push(H.mapPoint);var O=L[L.length-1],I=L[L.length-2];L=O&&I&&O.x===I.x&&O.y===I.y?L.slice(0,L.length-1):L.slice(0,L.length);switch(this._geometryType){case K.POLYLINE:if(!this._graphic||2>L.length){x.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(H);return}var P=new k(T);P.addPath([].concat(L));break;case K.POLYGON:if(!this._graphic||3>L.length)return;
P=new w(T);H=[].concat(L,[L[0].offset(0,0)]);w.prototype.isClockwise(H)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),H.reverse());P.addRing(H);break;case K.MULTI_POINT:P=new y(T),z.forEach(L,function(Q){P.addPoint(Q)})}x.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(P)},_onKeyDownHandler:function(H){H.keyCode===h.ESCAPE&&(x.disconnect(this._onMouseMoveHandler_connect),
this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(H){this._options.showTooltips&&(H?this._tooltip||(this._tooltip=p.create("div",{"class":"esriMapTooltip"},this.map.container),c.isBodyLtr()||e.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=x.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=x.connect(this.map,
"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=x.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(x.disconnect(this._onTooltipMouseEnterHandler_connect),x.disconnect(this._onTooltipMouseLeaveHandler_connect),x.disconnect(this._onTooltipMouseMoveHandler_connect),p.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var H=this._tooltip;H&&(H.style.display="none")},_setTooltipMessage:function(H){var L=this._tooltip;if(L){var T="";switch(this._geometryType){case G.POINT:T=
D.toolbars.draw.addPoint;break;case G.ARROW:case G.LEFT_ARROW:case G.RIGHT_ARROW:case G.UP_ARROW:case G.DOWN_ARROW:case G.TRIANGLE:case G.RECTANGLE:case G.CIRCLE:case G.ELLIPSE:T=D.toolbars.draw.addShape;break;case G.LINE:case G.EXTENT:case G.FREEHAND_POLYLINE:case G.FREEHAND_POLYGON:T=D.toolbars.draw.freehand;break;case G.POLYLINE:case G.POLYGON:T=D.toolbars.draw.start;1===H?T=D.toolbars.draw.resume:2<=H&&(T=D.toolbars.draw.complete);break;case G.MULTI_POINT:T=D.toolbars.draw.addMultipoint,1<=H&&
(T=D.toolbars.draw.finish)}L.innerHTML=T}},_updateTooltip:function(H){var L=this._tooltip;if(L){if(H.clientX||H.pageY){var T=H.clientX;H=H.clientY}else T=H.clientX+v.body().scrollLeft-v.body().clientLeft,H=H.clientY+v.body().scrollTop-v.body().clientTop;L.style.display="none";e.set(L,{left:T+this._options.tooltipOffset+"px",top:H+"px"});L.style.display=""}},_redrawGraphic:function(H,L,T,K){(T||this.map.wrapAround180)&&(H=this._graphic)&&H.setGeometry(H.geometry)},onActivate:function(){},onDeactivate:function(){},
onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});r.mixin(G,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});t("extend-esri")&&r.setObject("toolbars.Draw",G,f);return G})},
"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(F,r,z,x,n){F=F([n],{declaredClass:"esri.toolbars._Toolbar",constructor:function(v){this.map=v},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(v,t,m,h){var p=this.map;v&&(this._mapNavState=
{isDoubleClickZoom:p.isDoubleClickZoom,isClickRecenter:p.isClickRecenter,isPan:p.isPan,isRubberBandZoom:p.isRubberBandZoom,isKeyboardNavigation:p.isKeyboardNavigation,isScrollWheelZoom:p.isScrollWheelZoom},p.disableDoubleClickZoom(),p.disableClickRecenter(),p.disablePan(),p.disableRubberBandZoom(),p.disableKeyboardNavigation());t&&p.hideZoomSlider();m&&p.hidePanArrows();h&&p.graphics.disableMouseEvents()},_activateMapTools:function(v,t,m,h){var p=this.map,e=this._mapNavState;v&&e&&(e.isDoubleClickZoom&&
p.enableDoubleClickZoom(),e.isClickRecenter&&p.enableClickRecenter(),e.isPan&&p.enablePan(),e.isRubberBandZoom&&p.enableRubberBandZoom(),e.isKeyboardNavigation&&p.enableKeyboardNavigation(),e.isScrollWheelZoom&&p.enableScrollWheelZoom());t&&p.showZoomSlider();m&&p.showPanArrows();h&&p.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var v=this.map;this._scrollWheelState={isScrollWheelZoom:v.isScrollWheelZoom,isScrollWheelPan:v.isScrollWheelPan};v.disableScrollWheelZoom();v.disableScrollWheelPan()},
_activateScrollWheel:function(){var v=this.map,t=this._scrollWheelState;t&&(t.isScrollWheelZoom&&v.enableScrollWheelZoom(),t.isScrollWheelPan&&v.enableScrollWheelPan())}});z("extend-esri")&&r.setObject("toolbars._Toolbar",F,x);return F})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(F,r,z,x){return F([z],{declaredClass:"jimu.dijit.URLInput",required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,
allowNamed:!0,allowLocal:!0,postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-url-input")},validator:function(n){if(!1===this.required&&""===n)return!0;if(isFinite(n))return!1;var v="^"+x.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal});v=new RegExp(v,"g");v.lastIndex=0;v=v.test(n);return this.rest?(n=/\/rest\/services/gi.test(n),
v&&n):v}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(F,r,z){var x=F.getObject("validate.regexp",!0,z);return x=z.validate.regexp={ipAddress:function(n){n="object"==typeof n?n:{};"boolean"!=typeof n.allowDottedDecimal&&(n.allowDottedDecimal=!0);"boolean"!=typeof n.allowDottedHex&&(n.allowDottedHex=!0);"boolean"!=typeof n.allowDottedOctal&&(n.allowDottedOctal=!0);"boolean"!=typeof n.allowDecimal&&(n.allowDecimal=!0);"boolean"!=typeof n.allowHex&&
(n.allowHex=!0);"boolean"!=typeof n.allowIPv6&&(n.allowIPv6=!0);"boolean"!=typeof n.allowHybrid&&(n.allowHybrid=!0);var v=[];n.allowDottedDecimal&&v.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");n.allowDottedHex&&v.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");n.allowDottedOctal&&v.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");n.allowDecimal&&v.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");
n.allowHex&&v.push("0[xX]0*[\\da-fA-F]{1,8}");n.allowIPv6&&v.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");n.allowHybrid&&v.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");n="";0<v.length&&(n="("+v.join("|")+")");return n},host:function(n){n="object"==typeof n?n:{};"boolean"!=typeof n.allowIP&&(n.allowIP=!0);"boolean"!=typeof n.allowLocal&&(n.allowLocal=!1);"boolean"!=typeof n.allowPort&&(n.allowPort=!0);"boolean"!=typeof n.allowNamed&&
(n.allowNamed=!1);var v=n.allowPort?"(\\:\\d+)?":"",t="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";n.allowIP&&(t+="|"+x.ipAddress(n));n.allowLocal&&(t+="|localhost");n.allowNamed&&(t+="|^[^-][a-zA-Z0-9_-]*");return"("+t+")"+v},url:function(n){n="object"==typeof n?n:{};"scheme"in n||(n.scheme=[!0,!1]);return r.buildGroupRE(n.scheme,function(v){return v?"(https?|ftps?)\\://":""})+x.host(n)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},
emailAddress:function(n){n="object"==typeof n?n:{};"boolean"!=typeof n.allowCruft&&(n.allowCruft=!1);n.allowPort=!1;var v="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+x.host(n);n.allowCruft&&(v="\x3c?(mailto\\:)?"+v+"\x3e?");return v},emailAddressList:function(n){n="object"==typeof n?n:{};"string"!=typeof n.listSeparator&&(n.listSeparator="\\s;,");var v=x.emailAddress(n);return"("+v+"\\s*["+n.listSeparator+"]\\s*)*"+v+"\\s*["+n.listSeparator+"]?\\s*"},numberFormat:function(n){n=
"object"==typeof n?n:{};"undefined"==typeof n.format&&(n.format="###-###-####");return r.buildGroupRE(n.format,function(v){return r.escapeString(v,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(n){n="object"==typeof n?n:{};"boolean"!=typeof n.allowTerritories&&(n.allowTerritories=!0);"boolean"!=typeof n.allowMilitary&&(n.allowMilitary=!0);
var v="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";n.allowTerritories&&(v+="|AS|FM|GU|MH|MP|PW|PR|VI");n.allowMilitary&&(v+="|AA|AE|AP");return"("+v+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/CustomColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a){return r([z,n,x,F],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!1,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!1},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);
this.value=this.value?new h(this.value):new h("#fff");this._createContent()},initUI:function(){this._toggleCustomColorPicker("init",!1)},_createContent:function(){this.appearance=v.mixin(this._defaultAppearance,this.appearance);var g=t.create("div",{"class":"jimu-colorpalette"},this.domNode);this.initPanel=t.create("div",{"class":"init-panel"},g);this.customPanel=t.create("div",{"class":"custom-panel hide"},g);this.appearance.showTransparent&&this._createSpecialColors(this.initPanel);this.appearance.showColorPalette&&
this._createColorChooser(this.initPanel);this.appearance.showCoustom&&this._createCustomColorPicker(this.initPanel);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(this.initPanel)},setColor:function(g){this._isColorEqual(g)||(this.value=new h(g),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new h("transparent"),!1),this.picker.setColor(new h("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),
!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},getColor:function(){return this.value},changeColor:function(g){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex());this.emit("change",this.value);!0===this.appearance.closeDialogWhenChange&&!1!==g&&this._closeDialog()},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){b.close(this.tooltipDialog);
this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(g){g=t.create("div",{"class":"special-color"},g);this.transparentBtn=t.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},g);this.own(m(this.transparentBtn,a,v.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new h("transparent"));
this.changeColor()},_setSpatialColor:function(g){if(this.transparentBtn){var l=p(".btn-wapper",this.transparentBtn)[0];t.removeClass(l,"selected");g&&g.toString&&g.toString()===this._TRANSPARENT_STR&&t.addClass(l,"selected")}},_createColorChooser:function(g){this.colorChooser=new e({});this.colorChooser.placeAt(g);this.own(m(this.colorChooser,"change",v.hitch(this,function(l){l=new h(l);this.setColor(l);this.changeColor()})))},_createCustomColorPicker:function(){this.coustomtBtn=t.create("div",{"class":"coustom btn",
innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+this.nls.custom+"\x3c/div\x3e\x3c/div\x3e"},this.initPanel);this.own(m(this.coustomtBtn,"click",v.hitch(this,function(){this._toggleCustomColorPicker("custom")})));this.picker=new c({showOk:this.appearance.showColorPickerOK,showApply:this.appearance.showColorPickerApply,value:this.value.toHex()});this.picker.placeAt(this.customPanel);this.picker.setColor(this.value);
this.own(m(this.picker,"ok",v.hitch(this,function(g){this.setColor(new h(g));this.changeColor();this._addAColorRecord(g);this._toggleCustomColorPicker("init");this._closeDialog()})));this.own(m(this.picker,"apply",v.hitch(this,function(g){this.setColor(new h(g));this.changeColor(!1);this._addAColorRecord(g)})));this.own(m(this.picker,"cancel",v.hitch(this,function(){this._toggleCustomColorPicker("init");this._closeDialog()})))},_toggleCustomColorPicker:function(g,l){"custom"===g?(t.removeClass(this.customPanel,
"hide"),t.addClass(this.initPanel,"hide")):(t.addClass(this.customPanel,"hide"),t.removeClass(this.initPanel,"hide"));"undefined"!==typeof l&&!1===l||this.emit("change-style")},_createCoustomRecord:function(g){this.colorRecords=new f({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(g);this.own(m(this.colorRecords,"choose",v.hitch(this,function(l){this.setColor(new h(l));this.changeColor()})))},_addAColorRecord:function(g){this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(g)},
_isColorEqual:function(g){return this.value.toString()===(new h(g)).toString()?!0:!1},_changeLabel:function(g){t.empty(this.domNode);t.create("span",{innerHTML:g.toHex(),className:"color-label",style:{color:d.invertColor(g.toHex())}},this.domNode)},onOpen:function(){this.openDialog()},openDialog:function(){this.initUI()},_closeDialog:function(){this.emit("close")},onClose:function(){this._closeDialog()}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){return r([z,x,n,F],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=p.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var f=0;f<this._row;f++)for(var b=t.create("tr",{role:"row"},this.gridNode),d=0;d<this._col;d++){var a=this.colorsArray[f][d],g=e.named[a],l="";g?l=a:"rgb(0,0,1)"===
a&&(l="black",g="rgb(0,0,1)");a=this.colorTitleNls[l];g=(new e(g)).toString();this["record"+d]=t.create("td",{"class":"dijitPaletteCell","data-title":g,role:"gridcell"},b);var q=t.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+d]);t.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:a,title:a,"data-title":l,width:"16px",height:"16px",style:"background-color: "+g},q)}this.own(m(this.gridNode,c,v.hitch(this,this.onColorClick)))},onColorClick:function(f){for(var b=
f.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=t.getAttr(b,"data-title");b=(new e(b)).toString();this.setColor(b);f.stopPropagation();f.preventDefault()},_onChange:function(f){this.emit("change",f)},setColor:function(f,b){f=new e(f);for(var d=null,a=h("td",this.domNode),g=0,l=a.length;g<l;g++)t.removeClass(a[g],"dijitPaletteCellSelected");g=0;for(l=a.length;g<l;g++)if(f.toString()===t.getAttr(a[g],"data-title")){d=a[g];break}d&&t.addClass(d,"dijitPaletteCellSelected");
(d&&"undefined"===typeof b||!0===b)&&this._onChange(f)}})})},"jimu/dijit/CustomColorPicker":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color jimu/dijit/ColorSelector".split(" "),function(F,r,z,x,n,v,t,m,h){return r([z,x,F],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,
ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof m||(this.color=new m(this.color)):this.color=new m("#ccc");v.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createDialog(this.domNode)},destroy:function(){this.picker.destroy();this.inherited(arguments)},_handlerOk:function(p){p&&p.stopPropagation&&p.preventDefault&&(p.stopPropagation(),p.preventDefault());this.emit("ok",
this.color)},_handlerApply:function(p){p&&p.stopPropagation&&p.preventDefault&&(p.stopPropagation(),p.preventDefault());this.emit("apply",this.color)},_handlerCancel:function(p){p&&p.stopPropagation&&p.preventDefault&&(p.stopPropagation(),p.preventDefault());this.emit("cancel")},_createDialog:function(){var p=v.create("div",{"class":"dojox-color-picker-container"},this.domNode),e=new h({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:n.hitch(this,function(f){f=
new m(f);this.setColor(f)})});e.placeAt(p);e.startup();p=v.create("div",{"class":"btns-container jimu-float-trailing"},p);if(!0===this.showOk){var c=v.create("div",{"class":"jimu-btn jimu-float-leading ok",title:this.nls.ok,innerHTML:this.nls.ok},p);this.own(t(c,"click",n.hitch(this,function(f){var b=this.picker.get("value");this.setColor(new m(b));this._handlerOk(f)})))}!0===this.showApply&&(c=v.create("div",{"class":"jimu-btn jimu-float-leading apply",title:this.nls.apply,innerHTML:this.nls.apply},
p),this.own(t(c,"click",n.hitch(this,function(f){var b=this.picker.get("value");this.setColor(new m(b));this._handlerApply(f)}))));p=v.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-leading",title:this.nls.cancel,innerHTML:this.nls.cancel},p);this.own(t(p,"click",n.hitch(this,function(f){this._handlerCancel(f)})));this.picker=e},setColor:function(p){if(p instanceof m){var e=this.color,c="";e&&(c=e.toHex());e=p.toHex();this.color=p;c!==e&&this.picker.set("value",e)}},getColor:function(){return this.color},
onClose:function(){}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f){return r([z,x,n,F],{templateString:c,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,
postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(b){this.colorList.unshift(b);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(b){b=new p(b);for(var d=null,a=h("td",this.domNode),g=0,l=a.length;g<l;g++)t.removeClass(a[g],"dijitPaletteCellSelected");g=0;for(l=a.length;g<l;g++)if(b.toString()===t.getAttr(a[g],"title")){d=a[g];
break}d&&(t.addClass(d,"dijitPaletteCellSelected"),this.onChoose(b))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var b=0;b<this.recordsLength;b++){var d=this["record"+b];if(d&&this.colorList[b]&&this.colorList[b].toString){var a=this.colorList[b].toString();t.setAttr(d,"title",a);d=this._findImg(d);t.setStyle(d,"background-color",a);t.setAttr(d,"alt",a);t.setAttr(d,"title",a)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var b=0;b<this.recordsLength;b++){this["record"+
b]=t.create("td",{"class":"dijitPaletteCell",tabindex:b,title:"",role:"gridcell"},this.container);var d=t.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);t.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},d)}this.own(m(this.gridNode,f,v.hitch(this,this.onRecordClick)))},onRecordClick:function(b){for(var d=b.target;"TD"!==d.tagName;){if(!d.parentNode||d===this.gridNode)return;d=d.parentNode}d=t.getAttr(d,
"title");d=(new p(d)).toString();this.onChoose(d);b.stopPropagation();b.preventDefault()},onChoose:function(b){this.emit("choose",b)},_findImg:function(b){var d=null;return b.nodeName&&"IMG"===b.nodeName.toUpperCase()?b:d=h(".dijitColorPaletteSwatch",b)[0]},_setCookie:function(b){for(var d=[],a=0,g=this.recordsLength;a<g;a++){var l=this.colorList[a];l&&l.toString&&(d[a]=l.toString())}this._cleanCookie(b);try{var q=JSON.stringify(d);e(b,q,{expires:1E3,path:"/"})}catch(A){console.error("ColorRecords: cookieList JSON.stringify error."+
A.stack)}},_getCookie:function(b){b=e(b);if("undefined"!==typeof b)try{var d=JSON.parse(b);if(d&&"undefined"!==typeof d.length){b=0;for(var a=this.recordsLength;b<a;b++){var g=d[b];g&&g.toString&&(this.colorList[b]=new p(g.toString()))}}}catch(l){console.error("ColorRecords: cookieList JSON.parse error."+l.stack)}},_cleanCookie:function(b){e(b,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle ./a11y/OnScreenWidgetPanel dojo/touch".split(" "),
function(F,r,z,x,n,v,t,m,h,p){F=F([t,v],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3ch2 class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode" tabindex\x3d"-1" data-dojo-attach-event\x3d"onkeydown:_onTitleLabelKeyDown"\x3e${label}\x3c/h2\x3e\x3cdiv class\x3d"btns-container"\x3e\x3cdiv tabindex\x3d"0" class\x3d"foldable-btn jimu-vcenter" aria-label\x3d"${headerNls.foldWindow}" role\x3d"button"data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked,onkeydown:_onFoldableBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"max-btn jimu-vcenter" aria-label\x3d"${headerNls.maxWindow}" role\x3d"button"data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked,onkeydown:_onMaxBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"close-btn jimu-vcenter" aria-label\x3d"${headerNls.closeWindow}" role\x3d"button"data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,onkeydown:_onCloseBtnKey"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postMixInProperties:function(){this.headerNls=window.jimuNls.panelHeader},postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w);this.a11y_init()},_onMaxBtnClicked:function(e){e.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?(z.setAttr(this.maxNode,"aria-label",
this.headerNls.maxWindow),this.panelManager.normalizePanel(this)):(z.setAttr(this.maxNode,"aria-label",this.headerNls.restoreWindow),this.panelManager.maximizePanel(this),z.removeClass(this.foldableNode,"fold-up"),z.addClass(this.foldableNode,"fold-down"),z.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)),this._setMobilePosition());this.panelManager.activatePanel(this)},_onFoldableBtnClicked:function(e){e&&e.stopPropagation();this._getPositionInfo().isRunInMobile&&("minimized"===
this.windowState?(z.removeClass(this.foldableNode,"fold-up"),z.addClass(this.foldableNode,"fold-down"),z.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow),this.panelManager.normalizePanel(this)):(z.removeClass(this.foldableNode,"fold-down"),z.addClass(this.foldableNode,"fold-up"),z.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow),this.panelManager.minimizePanel(this)),z.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow),this._setMobilePosition())},_onCloseBtnClicked:function(e){e.preventDefault();
e.stopPropagation();this.panelManager.closePanel(this)},_normalizePositionObj:function(e){var c=this._getLayoutBox();e.left=isFinite(e.left)?e.left:c.w-e.right;e.top=isFinite(e.top)?e.top:c.h-e.bottom;delete e.right;delete e.bottom;this.position=r.mixin(r.clone(this.position),e)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||
400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();this.resizeHandle=(new h({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(e,c){this.disableMoveable();var f=z.getMarginBox(jimuConfig.layoutId);f.l=f.l-e+
c;f.w+=2*(e-c);this.moveable=new n.boxConstrainedMoveable(this.domNode,{box:f,handle:this.titleNode,within:!0});this.own(x(this.moveable,"Moving",r.hitch(this,this.onMoving)));this.own(x(this.moveable,"MoveStop",r.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&(this._setMobilePosition(),
m.isInNavMode()&&"minimized"===this.windowState&&this._onFoldableBtnClicked());this.inherited(arguments)},_switchToMobileUI:function(){z.removeClass(this.titleNode,"title-normal");z.addClass(this.titleNode,"title-full");z.setStyle(this.foldableNode,"display","block");z.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(z.removeClass(this.foldableNode,"fold-up"),z.addClass(this.foldableNode,"fold-down"),z.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)):(z.removeClass(this.foldableNode,
"fold-down"),z.addClass(this.foldableNode,"fold-up"),z.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow))},_switchToDesktopUI:function(){z.removeClass(this.titleNode,"title-full");z.addClass(this.titleNode,"title-normal");z.setStyle(this.foldableNode,"display","none");z.setStyle(this.maxNode,"display","none")},resize:function(e){var c=this._getPositionInfo(),f={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};e&&(e.t=this.domNode.offsetTop,
f.left=isFinite(e.l)?e.l:f.left,f.top=isFinite(e.t)?e.t:f.top,f.width=isFinite(e.w)?e.w:f.width,f.height=isFinite(e.h)?e.h:f.height,this._normalizePositionObj(r.clone(f)),this.makePositionInfoBox(),f.width=this._positionInfoBox.w,f.height=this._positionInfoBox.h);c.position=f;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(e){e.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(e.position),
this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(e){this._normalizePositionObj(e);this.makePositionInfoBox();e=this._getPositionInfo();this._onResponsible(e)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var e=jimuConfig.layoutId;e="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return z.getMarginBox(e)},_getPositionInfo:function(){var e=
{isRunInMobile:!1,position:{left:0,top:5}},c=this._getLayoutBox(),f=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return e.isRunInMobile=!0,e;window.isRTL?(e.position.left=c.w-f,e.position.left+this._positionInfoBox.w>c.w&&(e.position.left-=this._positionInfoBox.w,0>e.position.left&&(e.position.left=c.w-this._positionInfoBox.w))):(e.position.left=f,e.position.left+this._positionInfoBox.w>c.w&&(e.position.left=c.w>this._positionInfoBox.w?c.w-this._positionInfoBox.w:0));f=this._positionInfoBox.t;
c=c.h-f;f>=c?f>=this._positionInfoBox.h&&(e.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):c>=this._positionInfoBox.h&&(e.position.top=this._positionInfoBox.t+40+3);return e},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==z.byId(jimuConfig.layoutId)&&z.place(this.domNode,jimuConfig.layoutId);var e=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(e.zIndex=this.position.zIndex);var c=m.getPositionStyle(e);r.mixin(c,
e.borderRadiusStyle);z.setStyle(this.domNode,c)},_setDesktopPosition:function(e){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==z.byId(jimuConfig.mapId)&&z.place(this.domNode,jimuConfig.mapId);z.setStyle(this.domNode,{left:e.left+"px",right:"auto",top:e.top+"px",width:(e.width||this.position.width||this._originalBox.w)+"px",height:(e.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(e){z.setStyle(e.node,"opacity",.9)},onMoveStop:function(e){z.setStyle(e.node,
"opacity",1);e=z.getMarginBox(e.node);this._normalizePositionObj(r.clone({left:e.l,top:e.t,width:e.w,height:e.h}));this.makePositionInfoBox()}});F.extend(p);return F})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(F,
r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){F.experimental("dojox.layout.ResizeHandle");var l=f("dojox.layout._ResizeHelper",a,{show:function(){c.set(this.domNode,"display","")},hide:function(){c.set(this.domNode,"display","none")},resize:function(q){e.setMarginBox(this.domNode,q)}});return f("dojox.layout.ResizeHandle",[a,g],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,
constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,b.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=d.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new l({id:"dojoxGlobalResizeHelper"})).placeAt(t.body()),
p.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var q=r.partial(p.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;q("dojoxResizeNW");break;case "x":this._resizeX=!0;q("dojoxResizeW");break;case "y":this._resizeY=!0,q("dojoxResizeN")}},_beginSizing:function(q){if(!this._isSizing&&
(z.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=d.byId(this.targetId))?this.targetWidget.domNode:h.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var A=e.position(this.targetDomNode,!0);this._resizeHelper.resize({l:A.x,t:A.y,w:A.w,h:A.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:A.x,t:A.y})}this._isSizing=!0;this.startPoint={x:q.clientX,y:q.clientY};
A=c.getComputedStyle(this.targetDomNode);var u="border-model"===e.boxModel?{w:0,h:0}:e.getPadBorderExtents(this.targetDomNode,A),k=e.getMarginExtents(this.targetDomNode,A);this.startSize={w:c.get(this.targetDomNode,"width",A),h:c.get(this.targetDomNode,"height",A),pbw:u.w,pbh:u.h,mw:k.w,mh:k.h};this.isLeftToRight()||"absolute"!=c.get(this.targetDomNode,"position")||(A=e.position(this.targetDomNode,!0),this.startPosition={l:A.x,t:A.y});this._pconnects=[z.connect(t.doc,b.move,this,"_updateSizing"),
z.connect(t.doc,b.release,this,"_endSizing")];n.stop(q)}},_updateSizing:function(q){if(this.activeResize)this._changeSizing(q);else{var A=this._getNewCoords(q,"border",this._resizeHelper.startPosition);if(!1===A)return;this._resizeHelper.resize(A)}q.preventDefault()},_getNewCoords:function(q,A,u){try{if(!q.clientX||!q.clientY)return!1}catch(y){return!1}this._activeResizeLastEvent=q;var k=(this.isLeftToRight()?1:-1)*(this.startPoint.x-q.clientX),w=this.startPoint.y-q.clientY;q=this.startSize.w-(this._resizeX?
k:0);w=this._checkConstraints(q,this.startSize.h-(this._resizeY?w:0));(u=u||this.startPosition)&&this._resizeX&&(w.l=u.l+k,w.w!=q&&(w.l+=q-w.w),w.t=u.t);switch(A){case "margin":w.w+=this.startSize.mw,w.h+=this.startSize.mh;case "border":w.w+=this.startSize.pbw,w.h+=this.startSize.pbh}return w},_checkConstraints:function(q,A){if(this.minSize){var u=this.minSize;q<u.w&&(q=u.w);A<u.h&&(A=u.h)}this.constrainMax&&this.maxSize&&(u=this.maxSize,q>u.w&&(q=u.w),A>u.h&&(A=u.h));if(this.fixedAspect){u=this.startSize.w;
var k=this.startSize.h,w=u*A-k*q;0>w?q=A*u/k:0<w&&(A=q*k/u)}return{w:q,h:A}},_changeSizing:function(q){var A=this.targetWidget&&r.isFunction(this.targetWidget.resize),u=this._getNewCoords(q,A&&"margin");if(!1!==u&&(A?this.targetWidget.resize(u):this.animateSizing?m[this.animateMethod]([v.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:u.w}},duration:this.animateDuration}),v.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:u.h}},
duration:this.animateDuration})]).play():c.set(this.targetDomNode,{width:u.w+"px",height:u.h+"px"}),this.intermediateChanges))this.onResize(q)},_endSizing:function(q){x.forEach(this._pconnects,z.disconnect);var A=r.partial(z.publish,this.endTopic,[this]);this.activeResize?A():(this._resizeHelper.hide(),this._changeSizing(q),setTimeout(A,this.animateDuration+15));this._isSizing=!1;this.onResize(q)},onResize:function(q){}})})},"jimu/a11y/OnScreenWidgetPanel":function(){define(["dojo/_base/lang","dojo/on",
"dojo/_base/html","dojo/keys"],function(F,r,z,x){return{a11y_init:function(){this.own(r(this.domNode,"keydown",F.hitch(this,function(n){z.hasClass(n.target,"close-btn")||n.keyCode!==x.ESCAPE||(n.stopPropagation(),this.closeNode.focus())})))},_onTitleLabelKeyDown:function(n){n.shiftKey&&n.keyCode===x.TAB&&n.preventDefault()},_onMaxBtnKeyDown:function(n){n.keyCode!==x.ENTER&&n.keyCode!==x.SPACE||this._onMaxBtnClicked(n)},_onFoldableBtnKeyDown:function(n){n.keyCode===x.ENTER||n.keyCode===x.SPACE?this._onFoldableBtnClicked(n):
n.keyCode===x.TAB&&n.shiftKey&&n.preventDefault()},_onCloseBtnKey:function(n){n.keyCode===x.ENTER||n.keyCode===x.SPACE?this._onCloseBtnClicked(n):n.keyCode===x.TAB&&n.shiftKey&&(window.appInfo.isRunInMobile||n.preventDefault())}}})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),function(F,r,z,x,n,v){return F(v,{constructor:function(t,m,h,p){this.noLegend=p},_initVisible:function(){var t=
!1,m=this.originOperLayer.mapService;this.originOperLayer.mapService&&m.layerInfo._subLayerVisible[m.subId]&&(t=!0);this._visible=t},_setTopLayerVisible:function(t){if(this.originOperLayer.mapService){var m=this.originOperLayer.mapService;if(0<this.originOperLayer.subLayers.length){m.layerInfo._subLayerVisible[m.subId]=t?!0:!1;this._visible=t;var h={};this.traversal(function(p){0===p.getSubLayers().length&&(h[p.originOperLayer.mapService.subId]=p.isVisbleOrInvisilbe())});m.layerInfo._setSubLayerVisible(h)}}},
setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(t){},_sevVisible:function(t){this.visible=t},obtainNewSubLayers:function(){var t=[];r.forEach(this.originOperLayer.subLayers,function(m){m.parentLayerInfo=this;m=this._layerInfoFactory.create(m);t.push(m);m.init()},this);return t},getOpacity:function(){},setOpacity:function(t){},getLayerObject:function(){var t=new x;this.layerObject.empty?n({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(z.hitch(this,
function(m){var h=this.layerObject.url;this.layerObject=m;this.layerObject.url=h;this.layerObject.id=this.id;t.resolve(this.layerObject)}),function(m){t.reject(m)}):t.resolve(this.layerObject);return t},getLayerType:function(){var t=new x;t.resolve("GroupLayer");return t},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var t=this.originOperLayer.mapService;return(t=t.layerInfo._getJsapiLayerInfoById(t.subId))&&
0<=t.minScale&&0<=t.maxScale?{minScale:t.minScale,maxScale:t.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/on dijit/a11yclick dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet jimu/dijit/formSelect ./LoadingIndicator".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u){return x([n,v,t,h,z],{templateString:m,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,runtime:!1,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=window.jimuNls.common.add;
this.nls.apply=window.jimuNls.common.apply;this.layerInfosObj=e.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=p.sanitizeHTML(this.noFilterTip));this._bindBtnsEvent()},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},_bindBtnsEvent:function(){this.own(F(this.btnAddExpDesktop,r,b.hitch(this,
function(){this._onBtnAddExpClick()})));this.own(F(this.btnAddSetDesktop,r,b.hitch(this,function(){this._onBtnAddSetClick()})));this.own(F(this.btnAddExpMobile,r,b.hitch(this,function(){this._onBtnAddExpClick()})));this.own(F(this.btnAddSetMobile,r,b.hitch(this,function(){this._onBtnAddSetClick()})))},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():this._setMobileMode())},setMode:function(k){"desktop"===k?this._setDesktopMode():
"mobile"===k&&this._setMobileMode()},_setMode:function(k){this.mode=k;this._setModeClass(this.mode)},_setModeClass:function(k){d.removeClass(this.domNode,"desktop-mode");d.removeClass(this.domNode,"mobile-mode");d.addClass(this.desktopAddSection,"hidden");d.addClass(this.mobileAddSection,"hidden");k&&d.addClass(this.domNode,k+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");d.removeClass(this.desktopAddSection,"hidden")},_setMobileMode:function(){this._setMode("mobile");
d.removeClass(this.mobileAddSection,"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(k){var w=new l;this.isBuilding()?w.reject("Filter is already building."):(this._def=null,this.reset(),this.url=k.url,this.isHosted=p.isHostedService(this.url),
this._layerDefinition=k.layerDefinition,this.featureLayerId=k.featureLayerId,k.widgetId&&(this.widgetId=k.widgetId),k.partsObj?(this.partsObj=this._updatePartsObj(k.partsObj),this._def=this._init("partsObj")):(this.expr=k.expr||"1\x3d1",this._def=this._init("expr")),w=this._def);return w},buildByExpr:function(k,w,y){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:k,expr:w,layerDefinition:y,featureLayerId:this.featureLayerId})},buildByFilterObj:function(k,
w,y){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:k,partsObj:w,layerDefinition:y,featureLayerId:this.featureLayerId})},_updatePartsObj:function(k){a.forEach(k,b.hitch(this,function(w){w.parts?a.forEach(w.parts,b.hitch(this,function(y){y.interactiveObj&&!0===y.interactiveObj.cascade?y.interactiveObj.cascade="previous":!1===y.interactiveObj.cascade&&(y.interactiveObj.cascade="none")})):w.interactiveObj&&!0===w.interactiveObj.cascade?
w.interactiveObj.cascade="previous":!1===w.interactiveObj.cascade&&(w.interactiveObj.cascade="none")}));return k},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(k,w){var y=new l;w?y.resolve(w):(this.loading.show(),q({url:k,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(C){this.domNode?(this.loading.hide(),y.resolve(C)):y.reject()}),b.hitch(this,function(C){console.error(C);y.reject();this.domNode&&this.loading.hide()})));
return y},_validateLayerDefinition:function(k){return this._isObject(k)},_init:function(k){var w=new l;if(!this._isString(this.url))return w.reject(),w;var y=b.hitch(this,function(){setTimeout(b.hitch(this,function(){this.emit("change");w.resolve()}),1500)}),C=b.hitch(this,function(){d.addClass(this.errorSection,"hidden");this.removeAllFilters();if(this.featureLayerId){this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition);var D=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo()}var G=
this._layerDefinition.fields;G&&0<G.length?(this._popupFieldsInfo=D?p.completePopupFieldFromLayerField(G,D.fieldInfos):G,(G=a.filter(G,b.hitch(this,function(H){return 0<=this._supportFieldTypes.indexOf(H.type)})))&&0<G.length?(this._validOptions=!0,d.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),d.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),d.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),d.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),
this.valueProviderFactory=new c({url:this.url,layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),"expr"===k?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?y():w.reject()):w.reject():"partsObj"===k?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),y()):w.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),y()):this._isString(this.expr)?this._parseExpr(this.expr)?
y():w.reject():(this.removeAllFilters(),y())):(this._showErrorOptions(this.nls.error.noFilterFields),w.reject())):(D&&(this._popupFieldsInfo=D.fieldInfos),w.reject())});this._validateLayerDefinition(this._layerDefinition)?C():(this.loading.show(),q({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(D){this.domNode?(this.loading.hide(),this._layerDefinition=D,C()):w.reject()}),b.hitch(this,function(D){console.error(D);w.reject();this.domNode&&
this.loading.hide()})));return w},_tryOverrideFieldAliases:function(k,w){if(k=this.layerInfosObj.getLayerOrTableInfoById(k))if(k=k.getPopupInfo())if(k=k.fieldInfos,w=w.fields,k&&0<k.length&&w&&0<w.length){var y={};a.forEach(k,b.hitch(this,function(C){C.fieldName&&(y[C.fieldName]=C)}));a.forEach(w,b.hitch(this,function(C){var D=y[C.name];D&&D.label&&(C.alias=D.label)}))}},toJson:function(){var k={logicalOperator:this.allAnySelect.value,parts:[]},w=this._getAllSingleFiltersAndFilterSets();if(0===w.length)return k.expr=
"1\x3d1",k;a.forEach(w,b.hitch(this,function(y){y=y.toJson();k.parts.push(y)}));return a.every(k.parts,b.hitch(this,function(y){return!!y}))&&0<k.parts.length?(k.expr=this.getExprByFilterObj(k),k):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var k=b.clone(this._layerDefinition.fields);0===this.setFieldsStoreByFieldInfos(k)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},
_parsePartsObj:function(k){this._validatePartsObj(k)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(k))},_parseExpr:function(k){this._destroyAllFilters();var w=null;if(!this._validateLayerDefinition(this._layerDefinition))return w;if(!k||"string"!==typeof k)return this._showErrorOptions(this.nls.error.invalidSQL),w;if("1\x3d1"===this.expr.replace(/\s/gi,""))return w={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{w=this.getFilterObjByExpr(k)}catch(y){w=null,console.error(y)}w?this._buildEditUIByPartsObj(w):
this._showErrorOptions(this.nls.error.cantParseSQL);return w},_buildEditUIByPartsObj:function(k){k&&(this._destroyAllFilters(),a.forEach(k.parts,b.hitch(this,function(w){w.parts?this._addFilterSet(w):w.fieldObj&&w.operator&&w.valueObj&&this._addSingleFilter(w)})),this.allAnySelect.value=k.logicalOperator,this._setFilterMsgUI(k.parts.length))},_addSingleFilter:function(k){k={widgetId:this.widgetId,url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,
dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:k,OPERATORS:b.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};k=new A(k);k.placeAt(this.allExpsBox);k.startup();this.own(g.after(k,"_destroySelf",b.hitch(this,function(){this._checkFilterNumbers();this._focusOnMobileAdd();this.emit("change")})));this.own(F(k,"change",b.hitch(this,function(){this.emit("change")})));
this._checkFilterNumbers();return k},_focusOnMobileAdd:function(){d.hasClass(this.mobileAddSection,"hidden")||this.btnAddExpMobile.focus()},_addFilterSet:function(k){k={widgetId:this.widgetId,url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:k,OPERATORS:b.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,
valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};k=new u(k);k.placeAt(this.allExpsBox);k.startup();this.own(g.after(k,"_destroySelf",b.hitch(this,function(){this._checkFilterNumbers();this._focusOnMobileAdd();this.emit("change")})));this.own(F(k,"change",b.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return k},_destroyAllFilters:function(){for(var k=this._getAllSingleFiltersAndFilterSets();0<k.length;)k[0].destroy(),k.splice(0,1);this._checkFilterNumbers()},
_getAllSingleFiltersAndFilterSetsDoms:function(){var k=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&a.forEach(this.allExpsBox.childNodes,b.hitch(this,function(w){(d.hasClass(w,"jimu-single-filter")||d.hasClass(w,"jimu-filter-set"))&&k.push(w)}));return k},_getAllSingleFiltersAndFilterSets:function(){var k=this._getAllSingleFiltersAndFilterSetsDoms();return a.map(k,b.hitch(this,function(w){return f.byNode(w)}))},_setFilterMsgUI:function(k){2>k?(this.allAnySelect.value="AND",
d.setStyle(this.allAnySelect.domNode,"display","none"),d.setStyle(this.oneOrZeroMsg,"display","block")):(d.setStyle(this.oneOrZeroMsg,"display","none"),d.setStyle(this.allAnySelect.domNode,"display","inline-table"))},_checkFilterNumbers:function(){var k=this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(k.length);0<k.length?d.addClass(this.noFilterTipSection,"hidden"):d.removeClass(this.noFilterTipSection,"hidden");this.emit("filter-number-change")},_showErrorOptions:function(k){console.error(k);
d.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=k;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&(this._addFilterSet(),this.emit("change"))},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./AdvancedListValueProvider ./PredefinedValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){var d={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},
values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,
filterCodedValueIfPossible:!0}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0,
customVirtualDates:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},a=z([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(g){F.mixin(this,g);this.nls=window.jimuNls.filterBuilder;g=b.getInstanceSync();this.featureLayerId&&
(this.layerInfo=g.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(g,l){var q=[];if(l=d[l])l.value&&q.push("value"),l.field&&0<this._getSameShortTypeFieldNames(g).length&&q.push("field"),l.unique&&this.url&&(this._isStreamServer(this.url)||q.push("unique")),l.multiple&&this.url&&(this._isStreamServer(this.url)||q.push("multiple")),l.uniquePredefined&&this.url&&(this._isStreamServer(this.url)||q.push("uniquePredefined")),
l.multiplePredefined&&this.url&&(this._isStreamServer(this.url)||q.push("multiplePredefined"));return q},_isStreamServer:function(g){g=(g||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(g)},_getSameShortTypeFieldNames:function(g){var l=[],q=this._getFieldInfo(this.layerDefinition,g),A=a.getShortTypeByEsriType(q.type);r.forEach(this.layerDefinition.fields,F.hitch(this,function(u){u.name!==g&&a.getShortTypeByEsriType(u.type)===A&&l.push(u.name)}));return l},_getSameShortTypeFieldNameLabels:function(g){var l=
[],q=this._getFieldInfo(this.layerDefinition,g),A=a.getShortTypeByEsriType(q.type);r.forEach(this.layerDefinition.fields,F.hitch(this,function(u){u.name!==g&&a.getShortTypeByEsriType(u.type)===A&&l.push({value:u.name,label:u.alias})}));return l},getValueProvider:function(g,l){var q=null,A=F.clone(d[g.operator]);if(A){var u=g.valueObj.type,k=g.fieldObj.name,w=this._getFieldInfo(this.layerDefinition,k),y=A[u],C=y.normalProviderType,D=null,G=f.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,
k);"field"===u?(k=this._getSameShortTypeFieldNameLabels(k),0<k.length&&(D=k)):G&&0<G.length&&y.codedValueProviderType&&(C=y.codedValueProviderType);g={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:g,fieldInfo:w,codedValues:G,staticValues:D,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:A,filterCodedValueIfPossible:!!y.filterCodedValueIfPossible,runtime:l};if("BLANK_VALUE_PROVIDER"===C)q=new x(g);else if("SIMPLE_VALUE_PROVIDER"===C)q=new n(g);else if("TWO_NUMBERS_VALUE_PROVIDER"===
C)q=new v(g);else if("TWO_DATES_VALUE_PROVIDER"===C)q=new t(g);else if("LIST_VALUE_PROVIDER"===C)g.showNullValues=!1,"value"===u||"field"===u?q=new m(g):(g.providerType=C,g.selectUI="dropdown",q=new h(g));else if("NUMBER_LIST_VALUE_PROVIDER"===C)q=new e(g);else if("DATE_IS_IN_VALUE_PROVIDER"===C)q=new c(g);else if("ADVANCED_LIST_VALUE_PROVIDER"===C)g.providerType=C,g.selectUI="dropdown",q=new h(g);else if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===C||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===C)g.providerType=
C,g.selectUI=g.partObj.valueObj?g.partObj.valueObj.selectUI:null,q=l?new h(g):new p(g)}return q},_getFieldInfo:function(g,l){g=g.fields;for(var q=0;q<g.length;q++){var A=g[q];if(l===A.name)return A}return null}});a.getOperatorInfo=function(g){return F.clone(d[g])};a.isSupportVirtualDates=function(g){var l=d[g];return l&&l.value&&l.value.customVirtualDates?{status:!0,num:"dateOperatorIsBetween"===g||"dateOperatorIsNotBetween"===g?2:1}:{status:!1}};a.getOperatorsByShortType=function(g,l){var q=[];"string"===
g?q="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsAnyOf stringOperatorIsNoneOf stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===g?q="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsAtMost numberOperatorIsLessThan numberOperatorIsGreaterThan numberOperatorIsAnyOf numberOperatorIsNoneOf numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===g&&(q="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),l&&q.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return q};a.getShortTypeByEsriType=function(g){var l=null;"esriFieldTypeString"===g?l="string":"esriFieldTypeDate"===g?l="date":0<=["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(g)&&(l="number");return l};return a})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(F,r,z){return r([z],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);F.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},
setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/FilterManager jimu/utils esri/lang".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){return v([t,m,r],{baseClass:"jimu-filter-value-provider",fieldName:null,
shortType:null,_enabled:!1,cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&
this.codedValues&&this.filterCodedValueIfPossible&&p.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&n.some(this.popupInfo.fieldInfos,z.hitch(this,function(c){return c.fieldName===this.fieldName?(this.fieldPopupInfo=c,!0):!1}))},postCreate:function(){this.inherited(arguments);this.filterManager=h.getInstance()},getDijits:function(){return[]},bindChangeEvents:function(){var c=
this.getDijits();n.forEach(c,z.hitch(this,function(f){f.declaredClass&&0===f.declaredClass.indexOf("dijit.")&&x.addClass(f.domNode,f.declaredClass.replace(/\./g,"-"));this.own(F(f,"change",z.hitch(this,this._onChanged)));this.own(F(f,"enter",z.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");this.emit("enter");setTimeout(z.hitch(this,function(){this._onEnterTriggered=
!1}),100)},tryLocaleNumber:function(c){var f=p.localizeNumber(c);if(null===f||void 0===f)f=c;return f},getPartObject:function(){var c=this.getValueObject();if(!c)return null;var f=z.clone(this.partObj);f.valueObj=c;return f},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var c=1,f=this.getDijits();0<f.length&&(c=n.map(f,z.hitch(this,function(b){return"function"===typeof b.getStatus?b.getStatus():
this.getStatusForDijit(b)})),c=Math.min.apply(c,c));return c},getStatusForDijit:function(c){return c.validate()?c.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var c="1\x3d1";c=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade){var f=this.getCascadeFilterExpr();c="("+
c+") AND ("+f+")"}return c},getLayerFilterExpr:function(){var c="1\x3d1";this.layerInfo&&(c=this.layerInfo.getFilter());c||(c="1\x3d1");return c},_getWebMapFilterExpr:function(){var c="";this.layerInfo&&(c=this.layerInfo.getFilterOfWebmap());c||(c="1\x3d1");return c},getDropdownFilterExpr:function(c){var f="1\x3d1";c=this.layerInfo&&this.runtime&&c?this.filterManager.getFilterExp(this.layerInfo.id,c):this._getWebMapFilterExpr();"all"===this.cascade||"previous"===this.cascade?(f=this.getCascadeFilterExpr(),
f=c?"("+c+") AND ("+f+")":"("+f+")"):c&&(f=c);return f},getCascadeFilterExpr:function(){return"1\x3d1"},getDropdownFilterPartsObj:function(){var c={parts:[]};if("all"===this.cascade||"previous"===this.cascade)c=this.getCascadeFilterPartsObj();return c},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(c,f,b,d){var a=p.getFieldInfoByFieldName(c.fields,f),g=c.typeIdField,l=null;b=b.parts;for(var q in b){var A=b[q];if(A.fieldObj.name===g){g=A.valueObj.value;l=p._getCodedValueBySubTypeId(c,
f,g,a);break}}l||(l=d?d:p._getAllCodedValue(c,a));if(l&&0<l.length)var u=l[0].value;return{selectedValue:u,valueLabels:l}},isDefined:function(c){return e.isDefined(c)},disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled},destroy:function(){this.inherited(arguments)}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/_base/lang dojo/on dojo/keys jimu/utils ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return r([t],{templateString:"\x3cdiv\x3e\x3c/div\x3e",_dijit:null,customId:null,postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;F.addClass(this.domNode,"jimu-filter-simple-value-provider");var e=null;"string"===this.shortType?(e={required:!1,trim:!0,intermediateChanges:!1},this.customId&&(e.id=this.customId),this._dijit=new m(e),this._dijit.startup(),this._dijit.on("keydown",function(c){(c.keyCode||c.which)===n.ENTER&&this._dijit.emit("enter")}.bind(this))):
"number"===this.shortType?(e={required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}},this.customId&&(e.id=this.customId),this._dijit=new h(e),this._dijit.startup(),this._dijit.on("keydown",function(c){(c.keyCode||c.which)===n.ENTER&&this._dijit.emit("enter")}.bind(this))):(e={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo},this.runtime&&(e.virtualDates=this.partObj.interactiveObj.virtualDates),this.customId&&(e.customId=this.customId,e.prompt=this.partObj.interactiveObj.prompt+
" "+this.partObj.interactiveObj.hint),this._dijit=new p(e),this.own(x(this._dijit,"change",z.hitch(this,function(c){this.emit("change",c,"start")}))));!this.customId||"string"!==this.shortType&&"number"!==this.shortType||(e=F.toDom('\x3clabel for\x3d"'+this.customId+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e"),F.place(e,this.domNode));F.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},
getDijits:function(){return[this._dijit]},setValueObject:function(e){this.isDefined(e.value)&&("date"===this.shortType?this._dijit.setValueObject(e):this._dijit.set("value",e.value))},getValueObject:function(){if(this.isValidValue())if("date"===this.shortType){var e=this._dijit.getValueObject();if(e&&e.value)return e.isValid=!0,e.type=this.partObj.valueObj.type,e}else return e=this._dijit.get("value"),e="number"===this.shortType?parseFloat(e):v.sanitizeHTML(e),{isValid:!0,type:this.partObj.valueObj.type,
value:e};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(e){this._dijit.set("required",e)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/keys dojo/query dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase jimu/filterUtils jimu/utils jimu/dijit/Popup jimu/dijit/formSelect jimu/dijit/dateTimePicker".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){return h([p,r],{virtualDates:null,customId:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);v.addClass(this.domNode,"jimu-date-value-selector");this.dateTypeSelect=new b({"aria-label":this.prompt});v.addClass(this.dateTypeSelect.domNode,"date-type-select");v.addClass(this.dateTypeSelect.domNode,"restrict-select-width");this.dateTypeSelect.placeAt(this.domNode);
this.own(z(this.dateTypeSelect,"change",t.hitch(this,function(){this._onDateTypeSelectChanged()})));this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[e.VIRTUAL_DATE_TODAY,e.VIRTUAL_DATE_YESTERDAY,e.VIRTUAL_DATE_TOMORROW],this.runtime&&this.virtualDates.unshift(e.VIRTUAL_DATE_CUSTOM));this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});(!this.runtime||this.runtime&&0<=this.virtualDates.indexOf(e.VIRTUAL_DATE_CUSTOM))&&this.dateTypeSelect.addOption({value:"custom",label:this.nls.custom});
m.map(this.virtualDates,t.hitch(this,function(a){if("custom"!==a){var g={value:a,label:a};switch(a){case e.VIRTUAL_DATE_TODAY:g.label=this.nls.today;break;case e.VIRTUAL_DATE_YESTERDAY:g.label=this.nls.yesterday;break;case e.VIRTUAL_DATE_TOMORROW:g.label=this.nls.tomorrow}this.dateTypeSelect.addOption(g)}}));this.dateTypeSelect.startup();this.own(z(v.byId("main-page"),"click",t.hitch(this,function(){this.hideDateTimePopup()})));this.own(F.before(this.dateTypeSelect,"openDropDown",t.hitch(this,function(){this.hideDateTimePopup();
"custom"===this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&(this.dateTypeSelect.textDirNode.innerText=this.dateTimeObj.value);"custom"!==this.dateTypeSelect.getValue()&&this.dateTimePopup&&this.dateTimePopup.hide()})));this.own(F.after(this.dateTypeSelect,"closeDropDown",t.hitch(this,function(){this.customId||v.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText);this.dateTypeSelect.textDirNode.title="";setTimeout(t.hitch(this,function(){"custom"===
this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&this.dateTypeSelect.textDirNode&&(this.dateTypeSelect.textDirNode.innerText=this.dateTimeObj.value,this.dateTypeSelect.textDirNode.title=this.dateTimeObj.value);this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===v.getStyle(this.dateTimePopup.domNode,"display")&&this.dateTimePicker&&this.dateTimePicker.calendar&&this.dateTimePicker.calendar.focus()}),200)})));this.own(F.after(this.dateTypeSelect.dropDown,"onItemClick",
t.hitch(this,function(a){a&&"custom"===a.option.value&&this.showDateTimePopup()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(t.hitch(this,function(a){return a.fieldName===this._fieldInfo.name}))[0])},hideDateTimePopup:function(){this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===v.getStyle(this.dateTimePopup.domNode,"display")&&(this.dateTimePicker&&!0===this.dateTimePopupClick?this.dateTimePopupClick=!1:this.dateTimePopup.hide())},getDijits:function(){return[]},
setValueObject:function(a){if(a.virtualDate&&"custom"!==a.virtualDate)this.dateTypeSelect.set("value",a.virtualDate,!1),this.customId||v.setAttr(this.dateTypeSelect,"aria-label",a.virtualDate);else if(this.dateTypeSelect.set("value","custom",!1),a.value){var g=c.getDateByDateTimeStr(a.value),l=c.localizeDateTimeByFieldInfo(g,this.fieldInfo,a.enableTime,a.timeAccuracy);this.dateTimeObj={date:g,value:l};this.dateTypeSelect.textDirNode.innerText=l;this.dateTypeSelect.textDirNode.title=l;this.enableTime=
a.enableTime;this.timeAccuracy=a.timeAccuracy;this.customId||v.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText)}},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var a={value:null,virtualDate:""},g=this.dateTypeSelect.get("value"),l=null;"custom"===g?(l=this.dateTimeObj.date,a.value=l?c.getDateTimeStr(l,!0):null,a.virtualDate="",a.enableTime=this.enableTime?this.enableTime:
!1,a.timeAccuracy=this.timeAccuracy?this.timeAccuracy:""):(l=e.getRealDateByVirtualDate(g),a.virtualDate=g,l?a.value=c.getDateTimeStr(l):a=null);return a},setRequired:function(){},getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this.dateTimePicker?this._getStatusForDijit(this.dateTimePicker):this.dateTimeObj?1:0:""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(a){return a.validate()?a.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},
isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_onDateTypeSelectChanged:function(){"dateTime"===this.dateTypeSelect.get("value")&&this.showDateTimePopup();this.emit("change",this.dateTypeSelect.get("value"))},showDateTimePopup:function(){if(this.dateTimePopup)this.resize(),this.dateTimePicker.reset(),this.dateTimePopup.show();else{this.dateTimeObj||(this.dateTimeObj={date:null});this.dateTimePicker=new d({runtime:this.runtime,value:this.dateTimeObj.date,
fieldInfo:this.fieldInfo,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy});this.own(z(this.dateTimePicker,"created",t.hitch(this,function(g){this.dateTypeSelect.textDirNode.innerText=g.value;this.dateTypeSelect.textDirNode.title=g.value;this.dateTimeObj=g})));this.own(z(this.dateTimePicker,"timeChange",t.hitch(this,function(g){g&&(this.dateTypeSelect.textDirNode.innerText=g.value,this.dateTypeSelect.textDirNode.title=g.value,this.enableTime=g.enableTime,this.timeAccuracy=g.timeAccuracy,
this.dateTimeObj=g,this.emit("change"))})));this.own(z(this.dateTimePicker,"timeStatusChanged",t.hitch(this,function(){this.popupH=this.enableTime?353:309})));this.own(z(this.dateTimePicker,"close",t.hitch(this,function(){this.dateTimePopup.hide();this.dateTypeSelect.focus()})));this.runtime?this._isOnlyShowDate()?(this.popupH=265,this.own(z(this.dateTimePicker,"calendarChange",t.hitch(this,function(g){g&&this.dateTypeSelect.textDirNode.innerText!==g.value&&(this.dateTypeSelect.textDirNode.innerText=
g.value,this.dateTypeSelect.textDirNode.title=g.value,this.enableTime=g.enableTime,this.timeAccuracy=g.timeAccuracy,this.dateTimeObj=g,this.emit("change"))})))):this.popupH=320:this.popupH=this.enableTime?353:309;var a=this._calculatePopup();this.dateTimePopup=new f({width:this.popupW,autoHeight:!0,classNames:["dijitCalendarPopup","jimu-popup-date-time-picker"],content:this.dateTimePicker.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:a.left,
top:a.top},useFocusLogic:!1,onClose:t.hitch(this,function(){this.dateTimePopup.hide();return!1}),buttons:[]});this._isOnlyShowDate()&&v.setStyle(this.dateTimePopup.contentContainerNode,{marginBottom:"-3px"});this.own(z(this.dateTimePopup.domNode,"click",t.hitch(this,function(){this.dateTimePopupClick=!0})));this.own(z(this.dateTimePopup.domNode,"keydown",t.hitch(this,function(g){g.keyCode===x.ESCAPE?(this.dateTimePopup.hide(),this.dateTypeSelect.focus()):this.runtime&&g.keyCode===x.TAB&&(g.preventDefault(),
this._isOnlyShowDate()||(v.hasClass(g.target,"dijitCalendarSelectedDate")?this.dateTimePicker.timeTextBox.focusNode:this.dateTimePicker.calendar).focus())})))}},_getLastBtnFromDTPopup:function(){for(var a=null,g=n(".jimu-btn",this.dateTimePopup.buttonContainer),l=g.length-1;0<=l;l--)if("none"!==v.getStyle(g[l],"display")){a=g[l];break}return a},_isOnlyShowDate:function(){return this.runtime&&!this.enableTime?!0:!1},_calculatePopup:function(){var a=v.getStyle(this.domNode,"width");this.popupW=210<
a?a:210;var g=v.position(this.domNode),l=v.position(document.body).h,q=g.y+30;l-q<this.popupH&&(q=g.y-this.popupH,q=0<q?q:(l-this.popupH)/2);l=v.position(document.body).w;g.x+this.popupW>l&&(g.x-=this.popupW-a);return{left:g.x,top:q-1}},resize:function(){var a=this._calculatePopup();this.dateTimePopup.setCustomPosition(a.left,a.top,this.popupW,this.popupH)},destroy:function(){this.dateTimePopup&&(this.dateTimePopup.onClose=t.hitch(this,function(){return!0}),this.dateTimePopup.close())}})})},"jimu/dijit/dateTimePicker":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang jimu/utils dijit/Calendar dijit/form/TimeTextBox dojo/text!./templates/dateTimePicker.html dojo/on dojo/Evented jimu/dijit/CheckBox".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){return F([z,x,n,c],{baseClass:"jimu-datetimepicker",declaredClass:"jimu.datetimepicker",templateString:p,value:null,fieldInfo:null,enableTime:!1,timeAccuracy:"",runtime:!1,postMixInProperties:function(){this.timeNls=window.apiNls.widgets.imageFilter.imageFilterSettings;this.timeUnit=window.jimuNls.timeUnit},postCreate:function(){this._initSelf()},_initSelf:function(){this.calendar=new m({value:this.value,"class":"jimu-calendar"},this.calendarDiv);this.own(e(this.calendar,
"change",v.hitch(this,function(){this._valueChange();this.runtime&&!this.enableTime&&this.emit("close")})));this.calendar.startup();if(this.runtime)if(r.setStyle(this.timeTextContainerSetting,"display","none"),this.enableTime){r.setStyle(this.timeTextContainerRuntime,"display","block");var f={constraints:{timePattern:"s"===this.timeAccuracy?"HH:mm:ss":"m"===this.timeAccuracy?"HH:mm":"HH",clickableIncrement:"T00:30:00",visibleIncrement:"T01:00:00",visibleRange:"T01:00:00"}};"h"===this.timeAccuracy&&
(f.constraints.clickableIncrement="T01:00:00");this.timeTextBox=new h(f,this.timeTextBoxDiv);this.own(e(this.timeTextBox,"change",v.hitch(this,function(){this.enableTime=""===this.timeTextBox.displayedValue?!1:!0;this._valueChange()})));this.timeTextBox.startup();this.timeTextBox.set("value",this.value)}else r.setStyle(this.timeTextContainerRuntime,"display","none");else r.setStyle(this.timeTextContainerRuntime,"display","none"),r.setStyle(this.timeTextContainerSetting,"display","block"),this._initTimePickers();
this._enableTime=this.enableTime;this.emit("created",this.getValueObj())},_initTimePickers:function(){this.timeCheckbox.setValue(this.enableTime);this.enableTime&&(r.setStyle(this.timeTableContainer,"display","block"),this.value&&this._setTimeBox_HMS(this.value));this.own(e(this.timeCheckbox,"change",v.hitch(this,function(){this._changeTimeCheckStatus();this._valueChange();this.emit("timeStatusChanged")})));this.own(e(this.hourSelect,"change",v.hitch(this,function(){this._valueChange()})));this.own(e(this.minuteSelect,
"change",v.hitch(this,function(){this._valueChange()})));this.own(e(this.secondSelect,"change",v.hitch(this,function(){this._valueChange()})))},_changeTimeCheckStatus:function(){(this._enableTime=this.timeCheckbox.checked)?r.setStyle(this.timeTableContainer,"display","block"):r.setStyle(this.timeTableContainer,"display","none")},_valueChange:function(){this.emit("timeChange",this.getValueObj())},isValid:function(){if(null===this.calendar.value)return!1;if(this.runtime){if(this._enableTime&&!this.timeTextBox.isValid())return!1}else if(this.timeCheckbox.checked){if(!this.hourSelect.isValid()||
!this.minuteSelect.isValid()||!this.secondSelect.isValid()||""===this.hourSelect.displayedValue||""!==this.hourSelect.displayedValue&&""!==this.secondSelect.displayedValue&&""===this.minuteSelect.displayedValue)return!1}else this.hourSelect.isValid()||this.hourSelect.set("value",null),this.minuteSelect.isValid()||this.minuteSelect.set("value",null),this.secondSelect.isValid()||this.secondSelect.set("value",null);return!0},getValueObj:function(){if(!this.isValid())return!1;var f=new Date(this.calendar.value.toDateString());
if(this.runtime){if(this.enableTime){var b=this.timeTextBox.get("value");b&&(f.setHours(b.getHours()),f.setMinutes(b.getMinutes()),f.setSeconds(b.getSeconds()))}}else if(this.enableTime=this._enableTime){b=this.hourSelect.get("value");var d=this.minuteSelect.get("value"),a=this.secondSelect.get("value");this.timeAccuracy=a?"s":d?"m":"h";f.setHours(b?b.getHours():null);f.setMinutes(d?d.getMinutes():null);f.setSeconds(a?a.getSeconds():null)}else this.timeAccuracy="";b=t.localizeDateTimeByFieldInfo(f,
this.fieldInfo,this.enableTime,this.timeAccuracy);this.value=f;return{date:f,value:b,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy}},validate:function(){this.set("DisplayedValue",this.calendar.value?1:0);return!0},reset:function(){var f=this.calendar.get("value");f&&this.value&&this.value.toDateString()===f.toDateString()||this.calendar.set("value",this.value);this.timeCheckbox.setValue(this.enableTime);this.runtime?this.enableTime&&this.timeTextBox.set("value",this.value):this._setTimeBox_HMS(this.enableTime?
this.value:null)},_setTimeBox_HMS:function(f){var b=null,d=null,a=null;"h"===this.timeAccuracy?b=f:"m"===this.timeAccuracy?b=d=f:"s"===this.timeAccuracy&&(b=d=a=f);this.hourSelect.set("value",b);this.minuteSelect.set("value",d);this.secondSelect.set("value",a)}})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){var l=x("dijit.Calendar",[f,b,d],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(q){m.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",q)},_createMonthWidget:function(){return new l._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:p.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(e(this.domNode,"keydown",p.hitch(this,"_onKeyDown")),e(this.dateRowsNode,"mouseover",p.hitch(this,"_onDayMouseOver")),e(this.dateRowsNode,"mouseout",p.hitch(this,"_onDayMouseOut")),e(this.dateRowsNode,"mousedown",p.hitch(this,"_onDayMouseDown")),e(this.dateRowsNode,"mouseup",p.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(q){var A=
new this.dateClassObj(this.currentFocus);A.setDate(1);A.setMonth(q);q=this.dateModule.getDaysInMonth(A);var u=this.currentFocus.getDate();A.setDate(Math.min(u,q));this._setCurrentFocusAttr(A)},_onDayMouseOver:function(q){(q=v.contains(q.target,"dijitCalendarDateLabel")?q.target.parentNode:q.target)&&(q.dijitDateValue&&!v.contains(q,"dijitCalendarDisabledDate")||q==this.previousYearLabelNode||q==this.nextYearLabelNode)&&(v.add(q,"dijitCalendarHoveredDate"),this._currentNode=q)},_onDayMouseOut:function(q){!this._currentNode||
q.relatedTarget&&q.relatedTarget.parentNode==this._currentNode||(q="dijitCalendarHoveredDate",v.contains(this._currentNode,"dijitCalendarActiveDate")&&(q+=" dijitCalendarActiveDate"),v.remove(this._currentNode,q),this._currentNode=null)},_onDayMouseDown:function(q){(q=q.target.parentNode)&&q.dijitDateValue&&!v.contains(q,"dijitCalendarDisabledDate")&&(v.add(q,"dijitCalendarActiveDate"),this._currentNode=q)},_onDayMouseUp:function(q){(q=q.target.parentNode)&&q.dijitDateValue&&v.remove(q,"dijitCalendarActiveDate")},
handleKey:function(q){var A=-1,u=this.currentFocus;switch(q.keyCode){case h.RIGHT_ARROW:A=1;case h.LEFT_ARROW:var k="day";this.isLeftToRight()||(A*=-1);break;case h.DOWN_ARROW:A=1;case h.UP_ARROW:k="week";break;case h.PAGE_DOWN:A=1;case h.PAGE_UP:k=q.ctrlKey||q.altKey?"year":"month";break;case h.END:u=this.dateModule.add(u,"month",1),k="day";case h.HOME:u=new this.dateClassObj(u);u.setDate(1);break;default:return!0}k&&(u=this.dateModule.add(u,k,A));this._setCurrentFocusAttr(u);return!1},_onKeyDown:function(q){this.handleKey(q)||
(q.stopPropagation(),q.preventDefault())},onValueSelected:function(){},onChange:function(q){this.onValueSelected(q)},getClassForDate:function(){}});l._MonthDropDownButton=x("dijit.Calendar._MonthDropDownButton",g,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new l._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(q){var A=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,q);this.dropDown.set("months",
A);this.containerNode.innerHTML=(6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+A[q.getMonth()]+"\x3c/div\x3e"}});l._MonthDropDown=x("dijit.Calendar._MonthDropDown",[b,a,d],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(q){this.domNode.innerHTML=
"";F.forEach(q,function(A,u){t.create("div",{className:"dijitCalendarMonthLabel",month:u,innerHTML:A},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(q){this.onChange(n.get(q.target,"month"))},onChange:function(){}});return l})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a){var g=r("dijit.CalendarLite",[b,d],{templateString:a,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(l){return l&&!isNaN(l)&&"object"==typeof l&&l.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var l=this._get("value");if(l&&!isNaN(l)){var q=
new this.dateClassObj(l);q.setHours(0,0,0,0);q.getDate()<l.getDate()&&(q=this.dateModule.add(q,"hour",1));return q}return null},_setValueAttr:function(l,q){"string"==typeof l&&(l=v.fromISOString(l));l=this._patchDate(l);if(this._isValidDate(l)&&!this.isDisabledDate(l,this.lang)){if(this._set("value",l),this.set("currentFocus",l),this._markSelectedDates([l]),this._created&&(q||"undefined"==typeof q))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(l){if(l||
0===l)l=new this.dateClassObj(l),l.setHours(1,0,0,0);return l},_setText:function(l,q){for(;l.firstChild;)l.removeChild(l.firstChild);l.appendChild(l.ownerDocument.createTextNode(q))},_populateGrid:function(){var l=new this.dateClassObj(this.currentFocus);l.setDate(1);l=this._patchDate(l);var q=l.getDay(),A=this.dateModule.getDaysInMonth(l),u=this.dateModule.getDaysInMonth(this.dateModule.add(l,"month",-1)),k=new this.dateClassObj,w=0<=this.dayOffset?this.dayOffset:z.getFirstDayOfWeek(this.lang);w>
q&&(w-=7);if(!this.summary){var y=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,l);this.gridNode.setAttribute("summary",y[l.getMonth()])}this._date2cell={};F.forEach(this.dateCells,function(C,D){var G=D+w,H=new this.dateClassObj(l),L="dijitCalendar",T=0;G<q?(G=u-q+G+1,T=-1,L+="Previous"):G>=q+A?(G=G-q-A+1,T=1,L+="Next"):(G=G-q+1,L+="Current");T&&(H=this.dateModule.add(H,"month",T));H.setDate(G);this.dateModule.compare(H,k,"date")||(L="dijitCalendarCurrentDate "+L);this.isDisabledDate(H,
this.lang)?(L="dijitCalendarDisabledDate "+L,C.setAttribute("aria-disabled","true")):(L="dijitCalendarEnabledDate "+L,C.removeAttribute("aria-disabled"),C.setAttribute("aria-selected","false"));(T=this.getClassForDate(H,this.lang))&&(L=T+" "+L);C.className=L+"Month dijitCalendarDateTemplate";L=H.valueOf();this._date2cell[L]=C;C.dijitDateValue=L;L=H.getDateLocalized?H.getDateLocalized(this.lang):H.getDate();this._setText(this.dateLabels[D],L);h.set(C,"aria-label",n.format(H,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var l=new this.dateClassObj(this.currentFocus);l.setDate(1);this.monthWidget.set("month",l);var q=l.getFullYear()-1,A=new this.dateClassObj;F.forEach(["previous","current","next"],function(u){A.setFullYear(q++);this._setText(this[u+"YearLabelNode"],this.dateLocaleModule.format(A,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(l){this.dateModule=l.datePackage?p.getObject(l.datePackage,
!1):x;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=l.datePackage?p.getObject(l.datePackage+".locale",!1):n},_createMonthWidget:function(){return g._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var l=this.dowTemplateString,q=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),A=0<=this.dayOffset?this.dayOffset:z.getFirstDayOfWeek(this.lang);this.dayCellsHtml=f.substitute([l,
l,l,l,l,l,l].join(""),{d:""},function(){return q[A++%7]});l=f.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[l,l,l,l,l,l].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);t.setSelectable(this.domNode,!1);l=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",l,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var l=p.hitch(this,function(q,
A,u){this[q].dojoClick=!0;return e(this[q],"click",p.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,A,u))}))});this.own(l("incrementMonth","month",1),l("decrementMonth","month",-1),l("nextYearLabelNode","year",1),l("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(l,q){var A=this.currentFocus,u=this._getNodeByDate(A);l=this._patchDate(l);this._set("currentFocus",l);this._date2cell&&0==this.dateModule.difference(A,l,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));l=this._getNodeByDate(l);l.setAttribute("tabIndex",this.tabIndex);(this.focused||q)&&l.focus();u&&u!=l&&(c("webkit")?u.setAttribute("tabIndex","-1"):u.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(l){l.stopPropagation();l.preventDefault();for(l=l.target;l&&!l.dijitDateValue&&0!==l.dijitDateValue;l=l.parentNode);l&&!m.contains(l,"dijitCalendarDisabledDate")&&this.set("value",
l.dijitDateValue)},_getNodeByDate:function(l){return(l=this._patchDate(l))&&this._date2cell?this._date2cell[l.valueOf()]:null},_markSelectedDates:function(l){function q(A,u){m.toggle(u,"dijitCalendarSelectedDate",A);u.setAttribute("aria-selected",A?"true":"false")}F.forEach(this._selectedCells||[],p.partial(q,!1));this._selectedCells=F.filter(F.map(l,this._getNodeByDate,this),function(A){return A});F.forEach(this._selectedCells,p.partial(q,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
g._MonthWidget=r("dijit.CalendarLite._MonthWidget",b,{_setMonthAttr:function(l){var q=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,l),A=6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+F.map(q,function(u){return"\x3cdiv\x3e"+u+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=A+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+q[l.getMonth()]+"\x3c/div\x3e"}});return g})},"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),
function(F,r,z,x,n,v){return F("dijit.form.TimeTextBox",v,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:n,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(t){this.inherited(arguments);var m=z(".dijitTimePickerItemSelected",this.dropDown.domNode),h=this.dropDown.domNode.parentNode;h.scrollTop=m[0]?m[0].offsetTop-(h.clientHeight-m[0].clientHeight)/2:(h.scrollHeight-h.clientHeight)/2;this.dropDown.on("input",x.hitch(this,function(){this.set("value",this.dropDown.get("value"),
!1)}))},_onInput:function(){this.inherited(arguments);var t=this.get("displayedValue");this.filterString=t&&!this.parse(t,this.constraints)?t.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a){return n("dijit._TimePicker",[d,a],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:x.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(g){m.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",g)},_setValueAttr:function(g){this._set("value",g);this._showText()},_setFilterStringAttr:function(g){this._set("filterString",g);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(g,l,q,A){g=this.ownerDocument.createDocumentFragment();for(l=0;l<this._maxIncrement;l++)(q=this._createOption(l))&&g.appendChild(q);return g},_showText:function(){var g=x.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=g(this.clickableIncrement);
this._visibleIncrementDate=g(this.visibleIncrement);var l=function(A){return 3600*A.getHours()+60*A.getMinutes()+A.getSeconds()},q=l(this._clickableIncrementDate);l=l(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=g(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=l/q;g=g(this.pickerMax);g.setFullYear(1970,0,1);g=.001*(g.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((g+1)/q);q=this._getFilteredNodes();
!q.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(q)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(g){for(var l in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})l in g&&(this[l]=g[l]);g.locale||(g.locale=this.lang)},_createOption:function(g){var l=new Date(this._refDate),q=this._clickableIncrementDate;l.setHours(l.getHours()+
q.getHours()*g,l.getMinutes()+q.getMinutes()*g,l.getSeconds()+q.getSeconds()*g);"time"==this.constraints.selector&&l.setFullYear(1970,0,1);var A=z.format(l,this.constraints);if(this.filterString&&0!==A.toLowerCase().indexOf(this.filterString))return null;q=this.ownerDocument.createElement("div");q.className=this.baseClass+"Item";q.date=l;q.idx=g;t.create("div",{"class":this.baseClass+"ItemInner",innerHTML:A},q);A=1>g%this._visibleIncrement&&-1<g%this._visibleIncrement;g=!A&&!(g%this._clickableIncrement);
A?q.className+=" "+this.baseClass+"Marker":g&&(q.className+=" "+this.baseClass+"Tick");this.isDisabledDate(l)&&(q.className+=" "+this.baseClass+"ItemDisabled");this.value&&!r.compare(this.value,l,this.constraints.selector)&&(q.selected=!0,q.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=q,A?q.className+=" "+this.baseClass+"MarkerSelected":g&&(q.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(q,!0));return q},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(g,l){(g=g.target.date||g.target.parentNode.date)&&!this.isDisabledDate(g)&&(this._set("value",g),this.emit("input"),l&&(this._highlighted_option=null,this.set("value",g),this.onChange(g)))},onChange:function(){},_highlightOption:function(g,l){if(g){if(l)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=g;else{if(this._highlighted_option!==g)return;this._highlighted_option=null}v.toggle(g,this.baseClass+
"ItemHover",l);v.contains(g,this.baseClass+"Marker")?v.toggle(g,this.baseClass+"MarkerHover",l):v.toggle(g,this.baseClass+"TickHover",l)}},handleKey:function(g){if(g.keyCode==h.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),g.stopPropagation(),g.preventDefault(),!1;if(g.keyCode==h.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),g.stopPropagation(),g.preventDefault(),!1;if(g.keyCode==h.ENTER||
g.keyCode===h.TAB){if(!this._keyboardSelected&&g.keyCode===h.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return g.keyCode===h.TAB}},onHover:function(g){this._highlightOption(g,!0)},onUnhover:function(g){this._highlightOption(g,!1)},onSelect:function(g){this._highlightOption(g,!0)},onDeselect:function(g){this._highlightOption(g,!1)},onClick:function(g){this._onOptionSelected({target:g},!0)}})})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(F,r,z,x,n,v,t,m){new Date("X");return x("dijit.form._DateTimeTextBox",[v,t],{templateString:m,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:r.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(h,p){var e=this._isInvalidDate(h),c=this._isInvalidDate(p);if(e||c)return e&&c?0:e?-1:1;h=this.format(h,this._unboundedConstraints);p=this.format(p,this._unboundedConstraints);
e=this.parse(h,this._unboundedConstraints);c=this.parse(p,this._unboundedConstraints);return h==p?0:F.compare(e,c,this._selector)},autoWidth:!0,format:function(h,p){return h?this.dateLocaleModule.format(h,p):""},parse:function(h,p){return this.dateLocaleModule.parse(h,p)||(this._isEmpty(h)?null:void 0)},serialize:function(h,p){h.toGregorian&&(h=h.toGregorian());return z.toISOString(h,p)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(h){h=
h||{};this.dateModule=h.datePackage?n.getObject(h.datePackage,!1):F;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=h.datePackage?n.getObject(h.datePackage+".locale",!1):r;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(h){h.selector=this._selector;h.fullYear=!0;var p=z.fromISOString;"string"==typeof h.min&&(h.min=p(h.min),this.dateClassObj instanceof Date||(h.min=new this.dateClassObj(h.min)));"string"==typeof h.max&&(h.max=p(h.max),this.dateClassObj instanceof Date||(h.max=new this.dateClassObj(h.max)));this.inherited(arguments);this._unboundedConstraints=n.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(h){return!h||
isNaN(h)||"object"!=typeof h||h.toString()==this._invalidDate},_setValueAttr:function(h,p,e){void 0!==h&&("string"==typeof h&&(h=z.fromISOString(h)),this._isInvalidDate(h)&&(h=null),h instanceof Date&&!(this.dateClassObj instanceof Date)&&(h=new this.dateClassObj(h)));this.inherited(arguments,[h,p,e]);this.value instanceof Date&&(this.filterString="");!1!==p&&this.dropDown&&this.dropDown.set("value",h,!1)},_set:function(h,p){if("value"==h){p instanceof Date&&!(this.dateClassObj instanceof Date)&&
(p=new this.dateClassObj(p));var e=this._get("value");if(e instanceof this.dateClassObj&&0==this.compare(p,e))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(h){this._isInvalidDate(h)&&(h=new this.dateClassObj);this._set("dropDownDefaultValue",h)},openDropDown:function(h){this.dropDown&&this.dropDown.destroy();var p=n.isString(this.popupClass)?n.getObject(this.popupClass,!1):this.popupClass,e=this,c=this.get("value");this.dropDown=new p({onChange:function(f){e.set("value",
f,!0)},id:this.id+"_popup",dir:e.dir,lang:e.lang,value:c,textDir:e.textDir,currentFocus:this._isInvalidDate(c)?this.dropDownDefaultValue:c,constraints:e.constraints,filterString:e.filterString,datePackage:e.datePackage,isDisabledDate:function(f){return!e.rangeCheck(f,e.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(h,p){this._setValueAttr(this.parse(h,this.constraints),p,h)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/lang dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h){return z([x,n,v],{templateString:t,customId:null,postCreate:function(){this.inherited(arguments);F.addClass(this.domNode,"jimu-two-numbers-filter-value-provider");this.customId=this.partObj.vpId;var p={required:!1,intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},e=r.clone(p);if(this.customId){p.id=this.customId+"_between";var c=this.customId;var f=F.toDom('\x3clabel for\x3d"'+p.id+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+
" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e");F.place(f,this._dijit1_container)}else c=h.getUUID();e.id=c+"_and";c=F.toDom('\x3clabel for\x3d"'+e.id+'" class\x3d"screen-readers-only"\x3e'+this.nls.and+"\x3c/label\x3e");F.place(c,this._dijit2_container);this._dijit1=new m(p);this._dijit2=new m(e);this._dijit1.startup();this._dijit2.startup();this._dijit1.on("blur",function(){this._onRangeNumberBlur()}.bind(this));this._dijit2.on("blur",function(){this._onRangeNumberBlur()}.bind(this));F.setStyle(this._dijit1.domNode,
"width","100%");F.setStyle(this._dijit2.domNode,"width","100%");this._dijit1.placeAt(this._dijit1_container);this._dijit2.placeAt(this._dijit2_container)},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var p=parseFloat(this._dijit1.get("value")),e=parseFloat(this._dijit2.get("value"));p>e&&(this._dijit1.set("value",e),this._dijit2.set("value",p))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(p){this.isDefined(p.value1)&&this._dijit1.set("value",
p.value1);this.isDefined(p.value2)&&this._dijit2.set("value",p.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var p={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(p.value1)&&(p.value1=null);isNaN(p.value2)&&(p.value2=null);return p}return null},setRequired:function(p){this._dijit1.set("required",p);this._dijit2.set("required",p)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/on dojo/_base/html dojo/_base/declare dojo/_base/lang ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html jimu/utils".split(" "),function(F,r,z,x,n,v,t,m,h,p){return x([v,t,F],{templateString:h,
customId:null,postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;z.addClass(this.domNode,"jimu-two-dates-filter-value-provider");var e={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},c=n.clone(e);if(this.customId){e.customId=this.customId+"_between";e.prompt=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint;var f=this.customId}else f=p.getUUID();c.customId=f+"_and";c.prompt=this.nls.and;this.runtime&&
(e.virtualDates=this.partObj.interactiveObj.virtualDates1,c.virtualDates=this.partObj.interactiveObj.virtualDates2);this._dijit1=new m(e,this._dijitDiv1);this._dijit2=new m(c,this._dijitDiv2);this.own(r(this._dijit1,"change",n.hitch(this,function(b){this.emit("change",b,"start")})));this.own(r(this._dijit2,"change",n.hitch(this,function(b){this.emit("change",b,"end")})))},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},getDijits:function(){return[this._dijit1,
this._dijit2]},setValueObject:function(e){this._setValueObject(this._dijit1,e,1);this._setValueObject(this._dijit2,e,2)},_setValueObject:function(e,c,f){var b="value"+f;if(this.isDefined(c[b])){var d={enableTime:c["enableTime"+f],timeAccuracy:c["timeAccuracy"+f],value:null,virtualDate:""};d.value=c[b];d.virtualDate=c["virtualDate"+f];e.setValueObject(d)}},getValueObject:function(){if(this.isValidValue()){var e=this._dijit1.getValueObject(),c=this._dijit2.getValueObject();if(e.value&&c.value)return{isValid:!0,
type:this.partObj.valueObj.type,enableTime1:e.enableTime?!0:!1,timeAccuracy1:e.timeAccuracy?e.timeAccuracy:"",enableTime2:c.enableTime?!0:!1,timeAccuracy2:c.timeAccuracy?c.timeAccuracy:"",value1:e.value,value2:c.value,virtualDate1:e.virtualDate,virtualDate2:c.virtualDate}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,virtualDate2:null}:null},getStatus:function(){return 1===
this._dijit1.getStatus()&&1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/_base/declare ./ValueProvider dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){return t([m],
{templateString:"\x3cdiv\x3e\x3c/div\x3e",codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,ifDropDown:!1,customId:null,postCreate:function(){this.inherited(arguments);x.addClass(this.domNode,"jimu-filter-list-value-provider");this.customId=this.partObj.vpId;this._initValueSelect();this._uniqueValueCache={};this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";var c=new h({idProperty:"id",data:[]});this.valuesSelect.set("store",c);this.isNumberField=p.isNumberField(this.fieldInfo.type);!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(F.before(this.valuesSelect,"_onDropDownMouseDown",z.hitch(this,this._onBeforeDropDownMouseDown))),this.own(v(document.body,"click",z.hitch(this,this._onBodyClick))),this.layerInfo&&
this.layerInfo.getLayerObject().then(z.hitch(this,function(f){f.on("edits-complete",z.hitch(this,function(){this.layerDataChanged=!0}))})))},_initValueSelect:function(){var c={searchAttr:"label",required:!1,intermediateChanges:!0};this.customId&&(c["aria-label"]=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint);this.valuesSelect=new e(c);this.valuesSelect.startup();this.valuesSelect.on("input",z.hitch(this,this._onFilteringSelectInput));x.setStyle(this.valuesSelect.domNode,
"width","100%");this.valuesSelect.placeAt(this.domNode)},_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var c=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,c,this.codedValues)},_onBeforeDropDownMouseDown:function(){this.ifDropDown=!0;this._tryUpdatingUniqueValues(void 0,!0);return arguments},_onBodyClick:function(c){c=c.target||c.srcElement;c===this.domNode||x.isDescendant(c,this.domNode)||
this.msgDiv&&x.setStyle(this.msgDiv,"display","none")},getDijits:function(){return[this.valuesSelect]},isValidValue:function(){return 0<this.getStatus()},getStatus:function(){var c=this.valuesSelect.get("item");if(c&&void 0!==c.value){if(this.isNumberField&&!p.isValidNumber(c.value)&&"value"===this.partObj.valueObj.type){var f=parseFloat(c.value);return p.isValidNumber(f)?(c.value=f,this._getStatusForDijit(this.valuesSelect)):-1}return this._getStatusForDijit(this.valuesSelect)}return 0},_getStatusForDijit:function(c){return c.validate()?
c.get("DisplayedValue")?1:0:-1},setValueObject:function(c){return this.staticValues?this._setValueForStaticValues(c.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(c.value,!1):this._setValueForStaticValues(c.value,this.codedValues):this._tryUpdatingUniqueValues(c.value,!1)},getValueObject:function(){if(this.isValidValue()){var c=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:c}}return null},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(c){this.valuesSelect.set("required",c)},_setValueForStaticValues:function(c,f){var b=null,d=-1;b=null;f&&(b=n.map(f,z.hitch(this,function(a,g){a={id:g,value:a.value,label:a.label};a.value+""===c+""&&(d=g);return a})),this.valuesSelect.store.setData(b),0<=d&&(b=this.valuesSelect.store.get(d))&&this.valuesSelect.set("item",b),this._checkIfNoData())},
_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(c,f){var b=new r;if(this.valuesSelect._opened)this._checkIfNoData(),b.resolve();else{var d=this.getDropdownFilterExpr();d!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=d,this._uniqueValueLoadingDef=this._getUniqueValues(d),
this._uniqueValueLoadingDef.then(z.hitch(this,function(a){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(c,a),this._hideLoadingIcon(),f&&this.valuesSelect.toggleDropDown(),this._checkIfNoData(),b.resolve())}),z.hitch(this,function(a){console.error(a);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),this._checkIfNoData(),b.reject(a))}))):(this._checkIfNoData(),b.resolve())}return b},_setValueForUniqueValues:function(c,
f){f.sort(function(a,g){return a.value<g.value?-1:a.value===g.value?0:1});this.showNullValues||(f=n.filter(f,z.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===c){var b=this.getValueObject();b&&(c=b.value)}var d=-1;b=null;f=n.map(f,z.hitch(this,function(a,g){var l={id:g,value:a.value,label:a.label};a.value+""===c+""&&(d=g);return l}));this.valuesSelect.store.setData(f);0<=d&&(b=this.valuesSelect.store.get(d));this.valuesSelect.set("item",b)},_checkIfNoData:function(){this.runtime&&
this.ifDropDown&&(this.ifDropDown=!1,0===this.valuesSelect.store.data.length&&(this.msgDiv?x.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),x.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.valuesSelect.domNode.parentNode.appendChild(this.msgDiv))))},_showLoadingIcon:function(){x.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){x.removeClass(this.valuesSelect.domNode,"loading")},
_getUniqueValues:function(c){var f=new r;this._uniqueValueCache[c]&&!this.layerDataChanged?f.resolve(this._uniqueValueCache[c]):(this._showLoadingIcon(),p.getUniqueValues(this.url,this.fieldName,c,this.layerDefinition,this.fieldPopupInfo).then(z.hitch(this,function(b){this.domNode&&(this._uniqueValueCache[c]=b,f.resolve(b),this._hideLoadingIcon())}),z.hitch(this,function(b){this.domNode&&(f.reject(b),this._hideLoadingIcon())})));this.layerDataChanged=!1;return f}})})},"jimu/dijit/_filter/AdvancedListValueProvider":function(){define("dojo/Deferred dojo/_base/lang dojo/on dojo/keys dojo/Evented dojo/_base/html dojo/_base/array dojo/_base/declare dojo/query ./ValueProvider ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueProvider.html jimu/utils jimu/dijit/_filter/pageControlForQuery jimu/dijit/Popup".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){return m([p,c,f,n],{templateString:b,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";v.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"ADVANCED_LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="multipleDynamic",this.checkedNumDiv.style.display="block"):"LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="uniqueDynamic",this.checkedNameDiv.style.display="block"):(this.runtime&&"dropdown"===this.selectUI&&("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?this.checkedNameDiv.style.display=
"block":this.checkedNumDiv.style.display="block"),this.controlType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiplePredefined":"uniquePredefined");this.selectType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiple":"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"unique":"LIST_VALUE_PROVIDER"===this.providerType?"unique":"multiple";this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel=
"alias");!this.runtime||"multipleDynamic"!==this.controlType&&"uniqueDynamic"!==this.controlType||(this.isLoadDataAdvanced=!0);this.runtime&&"esriFieldTypeDate"===this.fieldInfo.type&&this.partObj.fieldObj&&(this.fieldPopupInfo={format:{dateFormat:this.partObj.fieldObj.dateFormat}});this.isNumberField=d.isNumberField(this.fieldInfo.type);this.pageControlForQuery||(this.pageControlForQuery=new a({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,
fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}),this.pageControlForQuery.on("query_getNewExpr",r.hitch(this,this._resetPageControlNewExpr)));this.listSelect||(this._resetPromptLabel(!1),this.listSelectDataList=this.partObj&&this.partObj.valueObj&&this.partObj.valueObj.value?this.partObj.valueObj.value:[],this.listSelect=new e({label:this.promptLabel.innerHTML,emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectUI:this.selectUI,controlType:this.controlType,
selectType:this.selectType,dataList:this.listSelectDataList,selectedDataList:[],isNumberField:this.isNumberField}),r.isArray(this.listSelectDataList)?this.getCheckedList(this.listSelectDataList):(this.listSelect.checkedList=[this.listSelectDataList],this.listSelect._updateCheckedLabelListFromCheckedList()),this.listSelect.on("advancedListValueSelect_itemChecked",r.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",r.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",
r.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",r.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",r.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemsConfirmed",r.hitch(this,function(){this.cbxPopup&&this.cbxPopup.domNode&&("block"===v.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide()),this.checkedBtn.focus())})),this.own(z(this.checkedBtn,
"keydown",r.hitch(this,function(l){v.hasClass(l.target||l.srcElement,"checkBtn")&&l.keyCode===x.ENTER&&this._checkedBtnEvent()}))),this.staticValues||"function"!==typeof this._checkedBtnEvent||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.layerInfo&&this.layerInfo.getLayerObject().then(r.hitch(this,function(l){l.on("edits-complete",r.hitch(this,function(){this.layerDataChanged=!0}))})));"dropdown"===this.selectUI?(v.setStyle(this.checkedBtn,"display","block"),this._multipleSelectProviderEventHandler=
r.hitch(this,this._multipleSelectProviderEvent),document.addEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0})):this.listSelect.placeAt(this.listContent)},_resetPromptLabel:function(l){l=l?this.nls.noFilterValueTip+" ":"";"undefined"!==typeof this.promptLabel&&(this.promptLabel.innerHTML=d.sanitizeHTML(this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+l))},filterExpr:null,_resetPageControlNewExpr:function(){var l=this.getDropdownFilterExpr(this.partObj.widgetId);
return this.filterExpr!==l?(this.pageControlForQuery.reset(),this.filterExpr=this.pageControlForQuery.cascadeFilterExprs=l,!0):!1},_multipleSelectProviderEvent:function(l){l=l.target||l.srcElement;if(this.cbxPopup&&this.cbxPopup.domNode){if(v.isDescendant(l,this.cbxPopup.domNode)||v.isDescendant(l,this.checkedBtn))return;"block"===v.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide())}else!v.isDescendant(l,this.checkedBtn)&&this.isPopupLoading&&(this.isLoadDataAdvanced=
!0);this.msgDiv&&v.setStyle(this.msgDiv,"display","none")},_checkedBtnEvent:function(){this._showPopup()},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},_isRestSelectList:!1,_resetListSelectState:function(l){"block"===v.getStyle(l.listSelect.searchKeyInput,"display")&&("multipleDynamic"===this.controlType&&this.listSelect.showAllList(),l.listSelect.listContainer.scrollTop=0,l.listSelect.queryState=!0,l.listSelect.valueInput.set("value",""),this._isRestSelectList=
!0)},_createTarget:function(l){this._checkedChanged(1,l);this.cbxPopup&&("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this.cbxPopup.domNode&&(this._resetListSelectState(this),this.cbxPopup.close())},_destoryTarget:function(l){this._checkedChanged(-1,l)},_checkedChanged:function(l,q){if("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)q&&(l=parseInt(this.checkedNum.innerText,10)+l,this.checkedNum.innerText=
0<l?l:0);else if("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)"uniqueDynamic"===this.controlType&&(q===this.emptyStr?v.addClass(this.checkedNameDiv,"checkedEmptyNameDiv"):v.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv")),l=q?q:this._getCheckedNameDivText(),this._setCheckedNameDivText(l);this.listSelect.set("displayedValue","12345678");this.emit("change")},_clearCheckedTxt:function(){this.runtime&&"dropdown"===this.selectUI&&
("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?this.checkedNum.textContent?this.checkedNum.textContent=0:this.checkedNum.innerText=0:("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this._setCheckedNameDivText(""),this.valueList=[],this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[],this.listSelect.valueInput.set("value",""),"multipleDynamic"===this.controlType&&this.listSelect.showAllList());this.listSelect.set("displayedValue",
"12345678");this.emit("change")},_layerDataChangedCallback:function(){this.layerDataChanged&&(this.pageControlForQuery.reset(),this.listSelect.ifFristPage=!0,this.layerDataChanged=!1)},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(r.hitch(this,function(l){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.ifFristPage&&this._checkIfNoData(l)||
(this.listSelect.setCBXData(l,!0,this.listSelect.ifFristPage),this._hideLoadingIcon())}),r.hitch(this,function(l){console.log(l);this.listSelect.queryState=!1;this._hideLoadingIcon()})))},_searchKey:function(l){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery._searchKey(l).then(r.hitch(this,function(q){this.listSelect.setCBXContentBySearch(q);this._resetPopupStyles(!q.length);this._hideLoadingIcon()}),r.hitch(this,function(q){console.log(q);this._hideLoadingIcon()})))},
_searchKeyLocal:function(l,q){if(this.listSelect){"uniqueDynamic"===this.controlType&&this._isRestSelectList&&(this.listSelect.keyQueryMode=!1,this._isRestSelectList=this.listSelect.cacheQueryMode=!1);this._showLoadingIcon();var A=this.pageControlForQuery._searchKeyLocal(l);""===l&&0===A.length?(this.layerDataChanged=!0,this._layerDataChangedCallback(),this._addNextPage()):this.listSelect.setCBXContentBySearch(A,q);this._resetPopupStyles(!0);this._hideLoadingIcon()}},queryByPage:function(){var l=
this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);l.then(r.hitch(this,function(q){l.resolve(q)}),r.hitch(this,function(q){console.log(q);l.reject(q)}))},getCheckedList:function(l){this.listSelect.checkedList=[];this.listSelect.checkedLabelList=[];t.forEach(l,r.hitch(this,function(q){if(r.isObject(q)){if(q.isChecked)var A=q.value}else A=q;if(A||0===A)A=this.isNumberField?parseFloat(A):A,this.listSelect.checkedList.push(A)}))},getCheckedStrsList:function(l){var q=[];t.forEach(l,r.hitch(this,
function(A){var u;r.isObject(A)?A.isChecked&&(u=A[this.disPlayLabel]):u=A;(u||0===u)&&q.push(u)}));return q},showContent:function(l){var q=new F;this.getCheckedList(this.valueList);this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="value";if("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType){this.runtime&&(this.listSelect.disPlayLabel="alias");var A=this._checkIfNoData(this.valueList);A||(this.listSelect.setCBXData(this.valueList,!0,l),this.listSelect._updateCheckedLabelListFromCheckedList());
this._hideLoadingIcon();q.resolve(A);return q}if(this.staticValues)return A=this._setValueForStaticValues(this.staticValues),q.resolve(A),q;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return A=this._setValueForStaticValues(this.codedValues),q.resolve(A),q;this._showLoadingIcon();if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(l).then(r.hitch(this,function(u){this.listSelect.isCacheFinish=
this.pageControlForQuery._isUniqueValueCacheFinish;u=this._handleCodedValue(u);(A=this._checkIfNoData(u))||this.listSelect.setCBXData(u,!0,l);this._hideLoadingIcon();q.resolve(A)}),r.hitch(this,function(u){console.log(u);this._hideLoadingIcon();q.reject(u)}));return q},_handleCodedValue:function(l){this.listSelect.disPlayLabel="label";if(!this.codedValues)return this.listSelect._updateCheckedLabelListFromCheckedList(),l;this.pageControlForQuery._codedvalueCache=l;"uniqueDynamic"===this.controlType&&
this._setCheckedName(this.listSelect.checkedList?this.listSelect.checkedList[0]:"",l);this.listSelect._updateCheckedLabelList(this.codedValues);return l},_showDropdown:function(l){var q=v.position(l.target);var A=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var u=v.position(A);if("none"!==v.getStyle(this.listContentPopup,"display"))v.setStyle(this.listContentPopup,"display","none");else{t.forEach(h(".value-type-popup",A),function(w){v.setStyle(w,"display",
"none")},this);v.place(this.listContentPopup,A);var k=v.hasClass(h(".desktop-add-section",A.parentNode)[0],"hidden")?-5:30;k=q.y-u.y-A.parentNode.scrollTop+k;k+170>A.parentNode.scrollHeight&&(k=A.parentNode.scrollHeight-170-40);window.isRTL?q=q.x-u.x+20:(q=q.x-u.x-100-90,q+150>A.clientWidth&&(q=A.clientWidth-150));v.setStyle(this.listContentPopup,{display:"block",left:q+"px",top:k+"px"});l.stopPropagation()}},_calculatePopup:function(){var l=v.position(this.domNode.parentNode),q=v.position(document.body).h,
A=l.y+30;q-A<this._cbxHeight&&(A=l.y-this._cbxHeight);return{left:l.x,top:A}},_cbxWidth:210,_cbxHeight:362,popupIsNoData:!1,isPopupLoading:!1,isLoadDataAdvanced:!1,_showPopup:function(){if(!this.isPopupLoading)if(this.cbxPopup&&this.cbxPopup.domNode&&"block"===v.getStyle(this.cbxPopup.domNode,"display"))this._resetListSelectState(this),this.cbxPopup.hide();else{var l=this._resetPageControlNewExpr();l&&this.cbxPopup&&(this.cbxPopup.close(),this._clearCheckedTxt());if(l||this.cbxPopup){var q=this._calculatePopup();
this._cbxWidth=v.getStyle(this.checkedBtn,"width");if(!l&&this.cbxPopup&&this.cbxPopup.domNode&&!this.layerDataChanged)this.popupIsNoData?this._checkIfNoData([]):(this.cbxPopup.show(),this._resetPopupStyles(),this.listSelect.valueInput&&"block"===v.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus(),this.listSelect.queryState=!1);else{this.isPopupLoading=!0;this.isLoadDataAdvanced||this._showDataQueryingIcon();var A=this.showContent(!0);
A.then(r.hitch(this,function(u){this.isPopupLoading=!1;this._hideDataQueryingIcon();(this.popupIsNoData=u)?this._clearCheckedTxt():(this.cbxPopup=new g({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:q.left,top:q.top},hiddenAfterInit:this.isLoadDataAdvanced,useFocusLogic:!1,onClose:r.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this.cbxPopup.setDomNodeStyls({"border-radius":0,
border:"1px solid #999"}),this.cbxPopup.on("popupHasInitedSuccessfully",r.hitch(this,function(k){this._resetPopupStyles(!1,!0);k||(this.listSelect.valueInput&&"block"===v.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus())})));this.isLoadDataAdvanced&&(this.isLoadDataAdvanced=!1)}),r.hitch(this,function(u){this.isPopupLoading=!1;console.log(u);A.reject(u)}))}}else v.setStyle(this.msgDiv,"display","block")}},_itemContainerH:300,
_resetPopupStyles:function(l,q){var A=this._itemContainerH,u=v.getStyle(this.listSelect.listContent,"height");0===u&&this.cbxPopup&&this.cbxPopup.domNode&&"none"===v.getStyle(this.cbxPopup.domNode,"display")&&(u=this.popupInitHeight);q&&(this.popupInitHeight=u);!l||this.listSelect.codedValues||this.pageControlForQuery._isUniqueValueCacheFinish||(u+=25);this.pageControlForQuery._isUniqueValueCacheFinish&&"block"===v.getStyle(this.listSelect.noDataTips,"display")&&(u+=30);A=u<A?u:A;v.setStyle(this.listSelect.listContainer,
"height",A+"px");v.setStyle(this.listSelect.selectedContainer,"height",A+30+"px");"multipleDynamic"===this.controlType?A=A+30+30:"uniqueDynamic"===this.controlType&&(A+=30);this._cbxHeight=A+10;l=this._calculatePopup();this._cbxWidth=v.getStyle(this.checkedBtn,"width");this.cbxPopup.setCustomPosition(l.left,l.top,this._cbxWidth,this._cbxHeight);this._resetItemWidth()},_resetItemWidth:function(){var l=this._cbxWidth-20;"uniqueDynamic"===this.controlType||this.runtime&&"uniquePredefined"===this.controlType&&
"dropdown"===this.selectUI||!this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)||(l=!this.runtime||"dropdown"===this.selectUI||"uniquePredefined"!==this.controlType&&"multiplePredefined"!==this.controlType?l-30:l-15);window.isRTL&&(l-=3);this.listSelect._itemLabelW=l;h(".item .label",this.listSelect.listContent).style({"max-width":l+"px"})},_setValueForStaticValues:function(l){this.listSelect.codedValues=!0;this.listSelect._updateCheckedLabelList(this.codedValues);
if(l){this.pageControlForQuery._codedvalueCache=l;var q=this._checkIfNoData(l);q||(this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(l,!0,!0));return q}return!1},_checkIfNoData:function(l){if(this.runtime&&"dropdown"===this.selectUI){if(l&&0<l.length)return this._resetPromptLabel(!1),!1;this.msgDiv?v.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),v.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,
this.checkedBtn.parentNode.appendChild(this.msgDiv));this._resetPromptLabel(!0);return!0}this._resetPromptLabel(!1);return!1},getDijits:function(){return[this.listSelect]},_setCheckedName:function(l,q){var A=l;if(q=q?q:this.codedValues){for(var u=!1,k=0;k<q.length;k++){var w=q[k];if(w.value===l){A=w.label;u=!0;break}}u||(A=this.emptyStr,this.valueList=[],this.listSelect&&(this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[]))}else void 0===l?(A=this.emptyStr,v.addClass(this.checkedNameDiv,
"checkedEmptyNameDiv")):v.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv");this._setCheckedNameDivText(A)},setValueObject:function(l){l.value=l.value||0===l.value?l.value:[];this.valueList=l.value;this.enableEmpty=l.enableEmpty;this.listSelect.enableEmpty=l.enableEmpty;if("multipleDynamic"===this.controlType)this.checkedNum.innerText=this.valueList.length,this.isLoadDataAdvanced&&this._checkedBtnEvent();else if("uniqueDynamic"===this.controlType){l=this.valueList;r.isArray(l)&&0===l.length&&
(l=void 0);this._setCheckedName(l);this.valueList=[this.valueList];if(l&&"esriFieldTypeDate"===this.fieldInfo.type){var q=d.getDateByDateTimeStrAndFormat(l,this.fieldPopupInfo);l=d.getDateTimeStrByFieldInfo(q,this.fieldPopupInfo);q=d.localizeDateByFieldInfo(q,this.fieldPopupInfo);this._setCheckedName(q);this.valueList=[l]}this.isLoadDataAdvanced&&this._checkedBtnEvent()}else this.emptyStr=l.emptyLabel?l.emptyLabel:this.emptyStr,this.listSelect.emptyStr=this.emptyStr,this.runtime&&"dropdown"===this.selectUI&&
(q=[],"value"===this.disPlayLabel?(this.getCheckedList(this.valueList),q=this.listSelect.checkedList):q=this.getCheckedStrsList(this.valueList),"uniquePredefined"===this.controlType?0<this.listSelect.checkedList.length?this._setCheckedNameDivText(q[0]):this._setCheckedNameDivText(l.enableEmpty?this.emptyStr:""):this.checkedNum.innerText=q.length),this.showContent(!0),setTimeout(r.hitch(this,function(){this._cbxWidth=v.getStyle(this.listSelect.listContent,"width");this._resetItemWidth()}),50)},_getCheckedNameDivText:function(){return this.checkedNameDiv.textContent||
this.checkedNameDiv.innerText||""},_setCheckedNameDivText:function(l){this.isNumberField&&"number"===typeof l&&(l=d._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,[l])[0].label);this.checkedNameDiv.textContent?this.checkedNameDiv.textContent=l:this.checkedNameDiv.innerText=l},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var l=null;l="multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?[]:"string"===
this.shortType?"":null;return{isValid:!0,type:this.partObj.valueObj.type,value:l}}return null},getValueObject:function(){if(this.isValidValue()){var l="multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.listSelect.getListCheckedValues():this.listSelect.getListValues();"uniqueDynamic"===this.controlType&&(l=r.isArray(l)?l[0]:l);return{isValid:!0,type:this.partObj.valueObj.type,value:l}}return null},setRequired:function(l){this.listSelect.set("required",l)},_showDataQueryingIcon:function(){this._validatingNode||
(this._validatingNode=v.create("div",{"class":"jimu-circle-loading"},this.checkedBtn));v.setStyle(this._validatingNode,"display","block")},_hideDataQueryingIcon:function(){this._validatingNode&&v.setStyle(this._validatingNode,"display","none")},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&v.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&v.removeClass(this.listSelect.listContainer,
"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0});this.cbxPopup&&this.cbxPopup.domNode&&(this.cbxPopup.onClose=r.hitch(this,function(){return!0}),this.cbxPopup.close());this.inherited(arguments)},destroyProvider:function(){this.listSelect&&this.listSelect.destroy();this.listSelect=null}})})},"jimu/dijit/_filter/AdvancedListValueSelect":function(){define("dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/declare dijit/_WidgetBase dojo/on dojo/keys dojo/query dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueSelect.html jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c){return x([n,h,p,r],{templateString:e,selectType:null,dataList:[],checkedList:[],checkedLabelList:[],_itemLabelW:215,ifFristPage:!0,queryState:!0,isCacheFinish:!1,keyQueryMode:!1,cacheQueryMode:!1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.jimuCommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.noDataNls=window.apiNls.widgets.FeatureTable.noData},postCreate:function(){this.inherited(arguments);this.inputType="unique"===
this.selectType?"radio":"checkbox";if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)z.addClass(this.listContainer,"items-setting-dropdown-content"),this.searchKeyInput.style.display="block";"uniqueDynamic"===this.controlType&&z.addClass(this.listContainer,"items_content_no_selected_toggle");this.runtime?(z.addClass(this.listContainer,"items-widget-content"),"dropdown"!==this.selectUI&&(z.addClass(this.listContainer,"items-widget-expaned-content"),z.addClass(this.listContent,
"jimu-multiple-items-expanded-list"),z.setAttr(this.listContent,"aria-label",this.label),z.addClass(this.listContent,c.lastFocusNodeClassInDOM),z.removeAttr(this.multipleSelect,"tabindex"))):(z.addClass(this.listContainer,"items-setting-popup-content"),this.searchKeyInput.style.display="block");this.runtime||"predefined"!==this.controlType||(z.addClass(this.listContainer,"items-setting-dropdown-content"),z.addClass(this.listContainer,"items_content_no_selected_toggle"),this.searchKeyInput.style.display=
"block");this._addCBXClickEvent();this._addCBXHoverEvent();this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel="alias");"multipleDynamic"===this.controlType&&(this.selectedToggleDiv.style.display="block",this.selectedToggle=m(".showAllIcon",this.selectedToggleDiv)[0],this.own(v(this.selectedToggleDiv,"click",F.hitch(this,"_toggleFilter"))),this.own(v(this.selectedToggleDiv,"keydown",F.hitch(this,function(f){f.keyCode===
t.ENTER&&this._toggleFilter(f)}))),this._addSelectedContainerEvent());this._addKeyDownEvent()},_addKeyDownEvent:function(){this.own(v(this.multipleSelect,"keydown",F.hitch(this,function(f){var b=f.which||f.keyCode,d=f.target;if(b===t.ESCAPE||"dropdown"===this.selectUI&&("INPUT"===d.tagName&&f.shiftKey&&b===t.TAB||("multipleDynamic"===this.controlType&&z.hasClass(d,"clearAllSelectedIcon")||"multipleDynamic"!==this.controlType&&z.hasClass(d,"item"))&&!f.shiftKey&&b===t.TAB))f.preventDefault(),this.currentHoverItem&&
(z.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed")})));this.own(v(this.listContent,"focus",F.hitch(this,function(){c.isInNavMode()&&(this.currentItem=(this.currentItem=this.getCurrentItem())?this.currentItem:this._getCheckInputItems()[0],this.currentHoverItem=this.currentItem.parentNode,"dropdown"===this.selectUI?this.currentHoverItem.focus():this._isFocusFirstItem=!0,z.addClass(this.currentHoverItem,"active"),setTimeout(F.hitch(this,
function(){z.addClass(this.currentHoverItem,"active")}),10))})));this.own(v(this.listContent,"blur",F.hitch(this,function(){this.currentHoverItem&&z.removeClass(this.currentHoverItem,"active")})));this.own(v(this.showAllIconBtn,"keydown",F.hitch(this,function(f){f.shiftKey&&f.keyCode===t.TAB&&(f.preventDefault(),"block"===z.getStyle(this.selectedContainer,"display")?this.selectedListContent.focus():this.listContent.focus())})));this.own(v(this.listContent,"keydown",F.hitch(this,function(f){if(c.isInNavMode()){var b=
f.which||f.keyCode;-1<[t.SPACE,t.UP_ARROW,t.DOWN_ARROW].indexOf(b)&&f.preventDefault();if(b===t.TAB&&z.hasClass(f.target,"item"))f.preventDefault(),this.currentHoverItem&&z.removeClass(this.currentHoverItem,"active"),"dropdown"===this.selectUI?(this.currentHoverItem=null,f.shiftKey?"block"===this.searchKeyInput.style.display?this.valueInput.focus():this.emit("advancedListValueSelect_itemsConfirmed"):"multipleDynamic"===this.controlType&&this.showAllIconBtn.focus()):this.listContent.focus();else if(b===
t.SPACE||b===t.ENTER)f=m(".checkInput",this.currentHoverItem)[0],b=m(".label",this.currentHoverItem)[0],this._setCBXChecked(f,this._getNodeText(b)),"radio"===this.inputType&&("dropdown"===this.selectUI&&(z.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed"));else if(b===t.UP_ARROW||b===t.DOWN_ARROW)if("dropdown"!==this.selectUI&&this._isFocusFirstItem)this._isFocusFirstItem=!1,this.currentHoverItem.focus(),setTimeout(F.hitch(this,
function(){z.addClass(this.currentHoverItem,"active")}),5);else{f=(f=b===t.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?f:this.currentHoverItem;if(this.listContainer.scrollHeight>this.listContainer.clientHeight){b=this.listContainer.clientHeight+this.listContainer.scrollTop;var d=f.offsetTop+f.offsetHeight;d-=30;d>b?this.listContainer.scrollTop=d-this.listContainer.clientHeight:f.offsetTop<this.listContainer.scrollTop+30&&(this.listContainer.scrollTop=f.offsetTop-
30)}z.removeClass(this.currentHoverItem,"active");this.currentHoverItem=f;z.addClass(this.currentHoverItem,"active");this.currentHoverItem.focus()}}})));this.own(v(this.selectedListContent,"focus",F.hitch(this,function(){if(c.isInNavMode()){var f=m(".item",this.selectedListContent);f.length&&(this.currentHoverItem=f[0],this.currentHoverItem.focus(),z.addClass(this.currentHoverItem,"active"),setTimeout(F.hitch(this,function(){z.addClass(this.currentHoverItem,"active")}),50))}})));this.own(v(this.selectedListContent,
"blur",F.hitch(this,function(){c.isInNavMode()&&this.currentHoverItem&&z.removeClass(this.currentHoverItem,"active")})));this.own(v(this.selectedContainer,"keydown",F.hitch(this,function(f){if(c.isInNavMode()){var b=f.which||f.keyCode;if(b===t.TAB)f.preventDefault(),this.currentHoverItem&&z.removeClass(this.currentHoverItem,"active"),this.showAllIconBtn.focus();else if(0!==m(".item",this.selectedListContent).length)if(-1<[t.SPACE,t.UP_ARROW,t.DOWN_ARROW].indexOf(b)&&f.preventDefault(),b===t.SPACE||
b===t.ENTER)f=m(".checkInput",this.currentHoverItem)[0],b=m(".label",this.currentHoverItem)[0],this._setCBXSelectedChecked(f,this._getNodeText(b));else if(b===t.UP_ARROW||b===t.DOWN_ARROW)f=(f=b===t.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?f:this.currentHoverItem,this.selectedContainer.scrollHeight>this.selectedContainer.clientHeight&&(b=f.offsetTop+f.offsetHeight,b>this.selectedContainer.clientHeight+this.selectedContainer.scrollTop?this.selectedContainer.scrollTop=
b-this.selectedContainer.clientHeight:f.offsetTop<this.selectedContainer.scrollTop&&(this.selectedContainer.scrollTop=f.offsetTop)),z.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=f,z.addClass(this.currentHoverItem,"active"),this.currentHoverItem.focus()}})))},_toggleFilter:function(f){var b=f.target;z.hasClass(b,"clearAllSelectedIcon")?(this._clearAllSelected(),this.currentHoverItem=this.currentItem=null):z.hasClass(b,"iconHover")||z.hasClass(b,"selectedToggleDiv")||(z.hasClass(b,
"showAllIcon")?(this.selectedContainer.style.display="none",this.listContent.focus()):(this._initSelectedContainerItems(),this.selectedContainer.style.display="block",this.selectedListContent.focus()),z.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=b,z.addClass(this.selectedToggle,"iconHover"),f.stopPropagation())},showAllList:function(){z.hasClass(this.selectedToggle,"showSelectedIcon")&&z.hasClass(this.selectedToggle,"iconHover")&&(z.removeClass(this.selectedToggle,"iconHover"),
this.selectedToggle=m(".showAllIcon",this.selectedToggleDiv)[0],z.addClass(this.selectedToggle,"iconHover"),z.setStyle(this.selectedContainer,"display","none"))},_clearAllSelected:function(){var f=z.hasClass(this.selectedToggle,"showAllIcon")?this.listContainer:this.selectedListContent;f=m(".item .checkInput.checked",f);for(var b=0;b<f.length;b++)f[b].click()},_initSelectedContainerItems:function(){for(var f=this.selectedListContent.innerHTML="",b=this.runtime?" labelRuntime":"",d=0;d<this.checkedList.length;d++){var a=
this.checkedList[d],g="value"===this.disPlayLabel?a:this.checkedLabelList[d];a='data\x3d"'+(this.isNumberField?a:encodeURIComponent(a))+'"';f+='\x3cdiv role\x3d"option" class\x3d"item" tabindex\x3d"-1" aria-selected\x3d"true" aria-checked\x3d"true"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+' checked" '+a+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label jimu-ellipsis-Blanks'+b+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+g+"\x3c/div\x3e\x3c/div\x3e"}this.selectedListContent.innerHTML=f},_addSelectedContainerEvent:function(){this.own(v(this.selectedListContent,
"click",F.hitch(this,function(f){var b=f.target;if(z.hasClass(b,"item")){var d=b.firstElementChild;b=b.firstElementChild.nextSibling}else if(z.hasClass(b,"checkInput"))d=b,b=b.nextSibling;else if(z.hasClass(b,"label"))d=b.previousSibling;else{f.stopPropagation();return}this._setCBXSelectedChecked(d,this._getNodeText(b));f.stopPropagation()})))},_setCBXSelectedChecked:function(f,b){var d=b;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)d=decodeURIComponent(z.getAttr(f,"data"));z.hasClass(f,
"checked")?(z.setAttr(f.parentNode,"aria-checked","false"),"radio"!==this.inputType&&(z.removeClass(f,"checked"),this._updateCheckedList("remove",d,b),this.checkCBXItems(),this.emit("advancedListValueSelect_itemUnChecked",b))):(z.setAttr(f.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),z.removeClass(this.currentItem,"checked")),z.addClass(f,"checked"),this._updateCheckedList("add",d,b),this.checkCBXItems(),
this.emit("advancedListValueSelect_itemChecked",b))},_getNodeText:function(f){return f.textContent||f.innerText||""},_updateCheckedList:function(f,b,d){b!==this.emptyStr&&(b=this.isNumberField?parseFloat(b):b);if("remove"===f)for(var a in this.checkedList){if(this.checkedList[a]===b||this.isNumberField&&isNaN(this.checkedList[a])&&isNaN(b)){this.checkedList.splice(a,1);this.checkedLabelList.splice(a,1);break}}else"radio"===this.inputType?(this.checkedList=[b],this.checkedLabelList=[d]):(this.checkedList.push(b),
this.checkedLabelList.push(d));this._updateListContentLabel()},_updateListContentLabel:function(){if("dropdown"!==this.selectUI&&this.runtime){var f=this.checkedLabelList.join(" ");f=f?f:this.emptyStr;z.setAttr(this.listContent,"aria-label",this.label+f)}},_updateCheckedLabelList:function(f){this.checkedLabelList=[];for(var b=0;b<this.checkedList.length;b++)for(var d=0;d<f.length;d++)this.checkedList[b]===f[d].value&&this.checkedLabelList.push(f[d].label)},_updateCheckedLabelListFromCheckedList:function(){for(var f=
0;f<this.checkedList.length;f++)this.checkedLabelList.push(this.checkedList[f]+"");this._updateListContentLabel()},_createTarget:function(f){f=this._getNodeText(f.target).split(": ")[1];this.emit("advancedListValueSelect_itemChecked",f)},_deleteCBXItem:function(){},_getCheckInputItems:function(){return m(".item .checkInput",this.listContent)},getListCheckedValuesOrigin:function(){for(var f=[],b=this._getCheckInputItems(),d=0;d<b.length;d++){var a=b[d],g=this._getNodeText(a.nextSibling);z.hasClass(a,
"checked")&&f.push(g)}return f},getListCheckedValues:function(){for(var f=[],b=F.clone(this.checkedList),d=0;d<b.length;d++){var a=b[d];a=this.isNumberField?parseFloat(a):a;f.push(a)}return f},getListValues:function(){var f=[],b=this._getCheckInputItems();if(0===b.length)return this.dataList;for(var d=0;d<b.length;d++){var a=b[d],g=this._getNodeText(a.nextSibling);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)g=decodeURIComponent(z.getAttr(a,"data"));g=this.isNumberField?parseFloat(g):
g;g={value:g,isChecked:!1};z.hasClass(a,"checked")&&(g.isChecked=!0);f.push(g)}return f},getIfValueExist:function(f){for(var b=this._getCheckInputItems(),d=0;d<b.length;d++){var a=this._getNodeText(b[d].nextSibling);if(f===a)return!0}return!1},getCurrentItem:function(){for(var f=this._getCheckInputItems(),b=0;b<f.length;b++){var d=f[b];if(z.hasClass(d,"checked"))return d}return null},checkCBXItems:function(f){f=f?"":this.valueInput.get("value");this.valueInput.set("value",f);f=m(".item .label",this.listContent);
for(var b=0;b<f.length;b++){var d=f[b],a="value"===this.disPlayLabel?this._getNodeText(d):decodeURIComponent(z.getAttr(d.previousSibling,"data"));a=this.isNumberField?parseFloat(a):a;0<=this.checkedList.indexOf(a)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(a))?z.addClass(d.previousSibling,"checked"):z.removeClass(d.previousSibling,"checked")}},reset:function(){this.listContent.innerHTML=""},setCBXData:function(f,b,d,a){a||(this.queryState=!1);f=f?f:[];if(this.listContent){z.setStyle(this.noDataTips,
"display","none");var g=0,l="radio"===this.inputType?" labelBig":"",q=this.runtime?" labelRuntime":"";a=this.listContent.innerHTML;if(d){a=this.listContent.innerHTML="";if("uniquePredefined"===this.controlType&&this.enableEmpty||"uniqueDynamic"===this.controlType&&!this.keyQueryMode)d=a="",this.checkedList[0]===this.emptyStr&&(a=" checked",d=" active",g=1),0===this.checkedList.length&&(a=" checked",this.currentItem=!0,g=1),a='\x3cdiv role\x3d"option" class\x3d"item emptyItem'+d+'" aria-selected\x3d"true" tabindex\x3d"-1" '+
(a?'aria-checked\x3d"true"':'aria-checked\x3d"false"')+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+a+"\" data\x3d'"+(this.emptyStr+"'\x3e\x3c/div\x3e\x3cdiv class\x3d\"label")+l+" jimu-ellipsis-Blanks"+q+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+this.emptyStr+"\x3c/div\x3e\x3c/div\x3e";this.listContainer.scrollTop=0}if(0===f.length)return f=this.listContent.innerHTML.replace(/(^\s*)|(\s*$)/g,""),""!==f||this.cacheQueryMode&&!this.isCacheFinish||z.setStyle(this.noDataTips,"display",
"block"),""===f&&(this.listContent.innerHTML=a),this.listContent;d="";for(var A=0;A<f.length;A++){var u=f[A],k="";if(b)if(this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType))u.isChecked&&(k=" checked",this.currentItem=!0,g++);else if(0<=this.checkedList.indexOf(u.value)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(u.value)))k=" checked",this.currentItem=!0,g++;var w="";w=k?'aria-checked\x3d"true"':'aria-checked\x3d"false"';var y='data\x3d"'+
(this.isNumberField?u.value:encodeURIComponent(u.value))+'"';d+='\x3cdiv class\x3d"item" role\x3d"option" tabindex\x3d"-1" aria-selected\x3d"true" '+w+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+k+'" '+y+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+l+" jimu-ellipsis-Blanks"+q+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+u[this.disPlayLabel]+"\x3c/div\x3e\x3c/div\x3e"}f=this.checkedList.length-g;if(this.runtime&&0<f)for(b=0;b<f;b++)this.emit("advancedListValueSelect_itemUnChecked","");this.listContent.innerHTML=
a+d;return this.listContent}},setCBXContentBySearch:function(f,b){0===f.length?this.setCBXData([],!1,!0,b):this.setCBXData(f,!0,!0,b)},_onSearchKeyChange:function(){var f=this.valueInput.get("value");this.searchName=f;this.listContainer.scrollTop=0;this.reset();this.cacheQueryMode=this.keyQueryMode=this.ifFristPage=!0;this.emit("advancedListValueSelect_searchKeyLocal",f);this.codedValues||(this.isCacheFinish||z.setStyle(this.loadMoreDataBtn,"display","block"),0===f.length&&(this.queryState=this.cacheQueryMode=
this.keyQueryMode=!1,z.setStyle(this.loadMoreDataBtn,"display","none")))},_loadMoreDataFromServer:function(){this.keyQueryMode=this.ifFristPage=!0;this.cacheQueryMode=!1;this.queryState=!0;z.setStyle(this.loadMoreDataBtn,"display","none");var f=this.valueInput.get("value");this.searchName=f;this.listContainer.scrollTop=0;"multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.emit("advancedListValueSelect_searchKey",f):this.runtime||this.emit("advancedListValueSelect_searchKey",
f)},currentHoverItem:null,_addCBXHoverEvent:function(){this.own(v(this.listContent,"mouseover",F.hitch(this,function(f){f=f.target||f.srcElement;if(f=z.hasClass(f,"item")?f:c.getAncestorDom(f,function(b){return z.hasClass(b,"item")},3))this.currentHoverItem&&z.removeClass(this.currentHoverItem,"active"),z.addClass(f,"active"),this.currentHoverItem=f})));this.own(v(this.listContent,"mouseout",F.hitch(this,function(){this.currentHoverItem&&z.removeClass(this.currentHoverItem,"active");this.currentHoverItem=
null})))},_addCBXClickEvent:function(){this.own(v(this.valueInput,"change",F.hitch(this,function(){this._onSearchKeyChange()})));this.own(v(this.loadMoreDataBtn,"click",F.hitch(this,function(){this._loadMoreDataFromServer()})));this.own(v(this.listContainer,"scroll",F.hitch(this,this.dropDownScroll)));this.own(v(this.searchKeyInput,"click",F.hitch(this,function(f){f.stopPropagation()})));this.own(v(this.listContainer,"click",F.hitch(this,function(f){var b=f.target;if(z.hasClass(b,"item")){var d=b.firstElementChild;
b=b.firstElementChild.nextSibling}else if(z.hasClass(b,"checkInput"))d=b,b=b.nextSibling;else if(z.hasClass(b,"label"))d=b.previousSibling;else{f.stopPropagation();return}this._setCBXChecked(d,this._getNodeText(b));f.stopPropagation()})))},scrollDiff:100,dropDownScroll:function(f){this.runtime&&("uniquePredefined"===this.controlType||"multiplePredefined"===this.controlType)||this.cacheQueryMode||this.codedValues||(this.queryState?this.listContainer.scrollTop=this.containerScrollTop:(f=f.target,f.scrollHeight-
f.clientHeight-f.scrollTop<=this.scrollDiff&&!this.queryState&&(this.containerScrollTop=this.listContainer.scrollTop,this.queryState=!0,this.ifFristPage=!1,this.emit("advancedListValueSelect_addNextPage"))))},_setCBXChecked:function(f,b){var d=b;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)d=decodeURIComponent(z.getAttr(f,"data"));z.hasClass(f,"checked")?(z.setAttr(f.parentNode,"aria-checked","false"),"radio"===this.inputType?this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",
b):this.emit("advancedListValueSelect_itemCheckedForPredefined",d,b):(z.removeClass(f,"checked"),this._updateCheckedList("remove",d,b),this.emit("advancedListValueSelect_itemUnChecked",b))):(z.setAttr(f.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),this.currentItem&&(z.removeClass(this.currentItem,"checked"),z.setAttr(this.currentItem.parentNode,"aria-checked","false"))),z.addClass(f,"checked"),this.currentItem=
f,this._updateCheckedList("add",d,b),this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",b):this.emit("advancedListValueSelect_itemCheckedForPredefined",d,b))},initDoms:function(f,b){this.setCBXData(f,b)},getData:function(){},refreshData:function(){this.checkCBXItems()},validate:function(){var f=this.checkedList.length?"12345678":null;1===this.checkedList.length&&this.checkedList[0]===this.emptyStr&&(f=null);if(this.isNumberField)for(var b=0;b<this.checkedList.length;b++){var d=
this.checkedList[b];if(d!==this.emptyStr&&isNaN(d)){f=null;break}}this.set("DisplayedValue",f);return!0},setRequired:function(f){this.mutiValuesSelect.set("required",f)},destroy:function(){z.destroy(this.domNode);this.inherited(arguments)}})})},"jimu/dijit/_filter/pageControlForQuery":function(){define("dojo/Deferred esri/tasks/query dojo/_base/array dojo/_base/lang dojo/_base/declare jimu/Query jimu/LayerStructure dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./pageControlForQuery.html jimu/filterUtils jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f){return n([m,h,p],{templateString:e,layerUrl:null,fieldInfo:null,fieldPopupInfo:null,spatialReference:null,layerDefinition:null,isNumberField:!1,showNullValues:!1,_isUniqueValueCacheFinish:!1,_uniqueValueCache:{},_uniqueValueCacheForOtherTypes:{},_codedvalueCache:[],cascadeFilterExprs:"1\x3d1",numbericFieldLength:{esriFieldTypeOID:32,esriFieldTypeSmallInteger:16,esriFieldTypeInteger:32,esriFieldTypeSingle:128,esriFieldTypeDouble:1024},pageIndex:1,pageSize:1E3,postCreate:function(){this.inherited(arguments);
this.spatialReference=t.getInstance().map.spatialReference;this.reset();this.queryType=v.getQueryType(this.layerDefinition);this.isNumberField?this.fieldLength=this.numbericFieldLength[this.fieldInfo.type]:(this.filterUtils=new c,this.isLayerHosted=f.isHostedService(this.layerUrl))},reset:function(){this.pageIndex=1;this._isUniqueValueCacheFinish=!1;this._uniqueValueCache={};this._uniqueValueCacheForOtherTypes={};this._codedvalueCache=[]},isKeyQueryLoader:!1,_searchKey:function(b){var d=new F,a=new r,
g="";this.isNumberField?g="CAST("+this.fieldInfo.name+" AS CHAR("+this.fieldLength+")) LIKE '%"+b+"%'":(g=this.isLayerHosted&&this.filterUtils.containsNonLatinCharacter(b)?"N":"",g=this.isLayerHosted?this.fieldInfo.name+" LIKE "+g+"'%"+b.replace(/'/g,"''")+"%'":"UPPER("+this.fieldInfo.name+") LIKE "+g+"'%"+b.replace(/'/g,"''").toUpperCase()+"%'");a.where="(("+this.cascadeFilterExprs+") AND ("+g+"))";a.geometry=null;a.outSpatialReference=this.spatialReference;a.outFields=[this.fieldInfo.name];a.returnDistinctValues=
!0;a.returnGeometry=!1;a.orderByFields=a.outFields;this.layerLoaderForKey=new v({url:this.layerUrl,query:a,pageSize:this.pageSize});this.isKeyQueryLoader=!0;this._uniqueValueCacheForOtherTypes={};this.queryByPage(!0).then(x.hitch(this,function(l){d.resolve(l)}),x.hitch(this,function(l){d.reject("reject:"+l)}));return d},_searchKeyLocal:function(b){b=b.toUpperCase();this.isKeyQueryLoader=!1;var d=[],a=this._codedvalueCache;if(0<a.length)for(var g=0;g<a.length;g++){var l=a[g];l.label&&0<=l.label.toString().toUpperCase().indexOf(b)&&
d.push(l)}else for(g in a=this._uniqueValueCache,a)for(var q=a[g],A=0;A<q.length;A++){l=q[A];var u=l.label;u&&0<=u.toString().toUpperCase().indexOf(b)&&d.push(l)}return d},queryByPage:function(b){var d=new F;this.layerLoader&&this.layerLoader.query.where!==this.cascadeFilterExprs&&(this.layerLoader=null,this.isKeyQueryLoader=!1,this.reset());if(!this.layerLoader){var a=new r;a.where=this.cascadeFilterExprs;a.geometry=null;a.outSpatialReference=this.spatialReference;a.outFields=[this.fieldInfo.name];
a.returnDistinctValues=!0;a.returnGeometry=!1;a.orderByFields=a.outFields;this.layerLoader=new v({url:this.layerUrl,query:a,pageSize:this.pageSize})}b&&(this.pageIndex=1);b=[];if(this.isKeyQueryLoader){if(this._uniqueValueCacheForOtherTypes[this.pageIndex])return b=this._resolveValueLabelsFromCache(this._uniqueValueCacheForOtherTypes),d.resolve(b),d;b=this.layerLoaderForKey}else{if(this._uniqueValueCache[this.pageIndex])return b=this._resolveValueLabelsFromCache(this._uniqueValueCache),d.resolve(b),
d;b=this.layerLoader}1===this.queryType?b.queryByPage(this.pageIndex).then(x.hitch(this,function(g){if(g){var l=g.features||[];g=l.length;this.showNullValues||(l=this._getNotNullValues(l));l=this._getValueLabelsFromFeatures(l);this.isKeyQueryLoader?(this._uniqueValueCacheForOtherTypes[this.pageIndex-1]=l,g<this.pageSize&&(this._uniqueValueCacheForOtherTypes[this.pageIndex]=[])):(this._uniqueValueCache[this.pageIndex-1]=l,g<this.pageSize&&(this._uniqueValueCache[this.pageIndex]=[],this._isUniqueValueCacheFinish=
!0));0===l.length&&this.pageIndex--;d.resolve(l)}else d.reject("Can't get features from current layer")}),x.hitch(this,function(g){d.reject(g)})):b.getAllFeatures().then(x.hitch(this,function(g){if(g){var l=g.features||[];this.showNullValues||(l=this._getNotNullValues(l));g=0<l.length?!0:!1;l=this._getDistinctValues(l);l=this._getValueLabelsFromFeatures(l);l=this.isKeyQueryLoader?this._getAndStoreValueLabelsForOtherTypes(l,this._uniqueValueCacheForOtherTypes):this._getAndStoreValueLabelsForOtherTypes(l,
this._uniqueValueCache);this._isUniqueValueCacheFinish=!0;d.resolve(g?l:[])}else d.reject("Can't get features from current layer")}),x.hitch(this,function(g){d.reject(g)}));this.pageIndex++;return d},_resolveValueLabelsFromCache:function(b){b=b[this.pageIndex];0!==b.length&&this.pageIndex++;return b},_getAndStoreValueLabelsForOtherTypes:function(b,d){for(var a=0;a<b.length;a+=this.pageSize)d[parseInt(a/this.pageSize,10)+1]=b.slice(a,a+this.pageSize);for(var g in d)b=parseInt(g,10)+1,d[b]||(d[b]=[]);
return d[1]},_getDistinctValues:function(b){var d={},a=[],g;for(g in b){var l=b[g],q=l.attributes[this.fieldInfo.name];d[q]||(d[q]=!0,a.push(l))}return a},_getNotNullValues:function(b){return b=z.filter(b,x.hitch(this,function(d){d=d.attributes[this.fieldInfo.name];return"\x3cNull\x3e"!==d&&null!==d}))},_getValueLabelsFromFeatures:function(b){var d=this.fieldInfo.name;b=z.map(b,function(a){return a.attributes[d]});b=f._getValues(this.layerDefinition,this.fieldPopupInfo,d,b);"esriFieldTypeDate"===
this.fieldInfo.type&&(b=this._getDistinctValueLabelsByFormat(b));return b},_getDistinctValueLabelsByFormat:function(b){var d={},a=[],g;for(g in b){var l=b[g].value;d[l]||(d[l]=!0,a.push(b[g]))}return a}})})},"jimu/dijit/_filter/PredefinedValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/text!./PredefinedValueProvider.html dojo/_base/lang dojo/on jimu/dijit/Popup ./PredefinedValuePopup ./ValueProvider".split(" "),function(F,r,z,x,n,v,t,m){return r([m],{templateString:z,nls:null,
url:"",layerDefinition:null,partObj:null,fieldInfo:null,codedValues:null,staticValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,runtime:!1,providerType:null,valueProvider:null,postCreate:function(){this.inherited(arguments);this.jimuNls=window.jimuNls;F.addClass(this.domNode,"jimu-filter-indexBtn-value-provider");F.addClass(this.valueProviderPopupNode,"value-type-popup");F.setStyle(this.valueProviderPopupNode,"display","none");var h="";"UNIQUE_PREDEFINED_VALUE_PROVIDER"===
this.providerType?h=this.nls.predefinedUniqueTips:"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(h=this.nls.predefinedMultipleTips);this.indexBtnTips.title=h;this.indexBtnTips.innerText=h+" ...";this._initProvider();this._bindEvent()},_initProvider:function(){var h={preDefinedTips:this.indexBtnTips,nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:this.partObj,fieldInfo:this.fieldInfo,codedValues:this.codedValues,staticValues:this.staticValues,layerInfo:this.layerInfo,
popupInfo:this.popupInfo,operatorInfo:this.operatorInfo,filterCodedValueIfPossible:this.filterCodedValueIfPossible,runtime:this.runtime,selectUI:this.selectUI,providerType:this.providerType};if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType)this.valueProvider=new t(h);this.valueProvider.on("predefinedValuePopup_setApplyBtnState",x.hitch(this,function(p){this.popup&&(p?this.popup.enableButton(0):this.popup.disableButton(0))}))},_bindEvent:function(){this.own(n(this.indexBtn,
"click",x.hitch(this,function(){this.valueProvider&&this.destroyProvider();this._initProvider();this.setValueObject(this.valueObjEnd,this.valueObjEnd.type);this.popup=new v({width:800,height:600,content:this.valueProvider,titleLabel:this.indexBtnTips.title,useFocusLogic:!1,onClose:x.hitch(this,function(){this.getValueObject(!1);this._closeCBXPopup();this.destroyProvider()}),buttons:[{label:this.nls.apply,disable:!0,onClick:x.hitch(this,function(){this.getValueObject(!0)?this.popup.close():alert("please configurate some items")})},
{label:this.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:x.hitch(this,function(){this.popup.close()})}]});F.addClass(this.popup.domNode,"widget-at-filter-popup");setTimeout(x.hitch(this,function(){this.valueProvider._setApplyState(this.getValueObject(!0));this.valueProvider._setDisplayTypeStyle()}),100)})))},_closeCBXPopup:function(){this.valueProvider.cbxPopup&&this.valueProvider.cbxPopup.domNode&&(this.valueProvider.cbxPopup.onClose=x.hitch(this,function(){return!0}),this.valueProvider.cbxPopup.close())},
_saveData:function(){this.valueProvider.saveData()},reset:function(){},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(h){h&&(this.valueObjEnd=h);this.valueProvider.setValueObject(h,!0)},valueObj:null,getValueObject:function(h){if(h)return this.valueObjEnd=h=this.valueProvider.getValueObject(),h.value.length;delete this.valueObjEnd.valueList;return 0===this.valueObjEnd.value.length?0:this.valueObjEnd},destroyProvider:function(){this.valueProvider&&this.valueProvider.destroyProvider();
this.valueProvider=null}})})},"jimu/dijit/_filter/PredefinedValuePopup":function(){define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PredefinedValuePopup.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/_filter/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,
f,b,d,a,g,l){return n([m,e,c,v],{templateString:f,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";z.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");
this.controlType="unique";"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType="multiple");this.isNumberField=d.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new h({tableType:this.controlType,dataList:[],codedValues:this.codedValues,emptyStr:this.emptyStr,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),this.editTable.on("editTable_openListSelectByName",
F.hitch(this,this._showListSelectByTable)),this.editTable.on("editTable_itemChanged",F.hitch(this,this._editTableItemChanged)),this.editTable.on("editTable_getValLabelsArrayForNumber",F.hitch(this,this._getValLabelsArrayForNumber)));this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new g({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}));
this.listSelect||(this.listSelect=new p({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("advancedListValueSelect_itemChecked",F.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",F.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",F.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",
F.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",F.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",F.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||(this.mutiValuesSelect=new l({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=F.hitch(this,this._multipleSelectProviderEvent);document.addEventListener("click",this._multipleSelectProviderEventHandler);
var q=new b({idProperty:"id",data:[]});this.listSelect.set("store",q)},_multipleSelectProviderEvent:function(q){var A=q.target||q.srcElement,u=z.isDescendant(A,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?(u?"block"===z.getStyle(this.cbxPopup.domNode,"display")?z.setStyle(this.cbxPopup.domNode,"display","none"):z.setStyle(this.cbxPopup.domNode,"display","block"):z.isDescendant(A,this.cbxPopup.domNode)||this._createTargetForPredefined(),q.stopPropagation()):this._isInSelectPopup(A)||
this.runtime?q.stopPropagation():z.setStyle(this.valuesPopupNode,"display","none")},_initAdvancedListValueSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new p({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField});this.listSelect.on("advancedListValueSelect_itemChecked",
F.hitch(this,this._createTarget));this.listSelect.on("advancedListValueSelect_itemUnChecked",F.hitch(this,this._destoryTarget));this.listSelect.on("advancedListValueSelect_addNextPage",F.hitch(this,this._addNextPage));this.listSelect.on("advancedListValueSelect_searchKey",F.hitch(this,this._searchKey));this.listSelect.on("advancedListValueSelect_searchKeyLocal",F.hitch(this,this._searchKeyLocal));this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",F.hitch(this,this._createTargetForPredefined))},
_isInSelectPopup:function(q){for(var A="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),u=!1,k=0;k<=A.length;k++)if(z.hasClass(q,A[k])){u=!0;break}return u},_createTarget:function(){this.editTable._createTarget("","","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(q,A){this.editTable._setNewLabel(q,A);this.cbxPopup.close();this._editTableItemChanged()},
_destoryTarget:function(q){this.editTable._destroyTarget(q);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var q=this.getValueObject();this._setApplyState(q.value.length)}},_setApplyState:function(q){this.emit("predefinedValuePopup_setApplyBtnState",q)},_cbxWidth:245,_cbxHeight:340,isPopupLoading:!1,_showListSelectByTable:function(q){if(!this.isPopupLoading){this._initAdvancedListValueSelect();this.valueList=[q];this.getCheckedList(this.valueList);q=z.position(this.editTable.searchBtn);
var A=q.x-226,u=q.y+30;window.isRTL&&(A=q.x);this.cbxPopup=new a({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:A,top:u},useFocusLogic:!1,buttons:[]});this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"});this.cbxPopup.on("popupHasInitedSuccessfully",F.hitch(this,function(){var k=z.position(this.editTable.searchBtn),w=k.x-226,y=k.y+30;window.isRTL&&
(w=k.x);this.cbxPopup.setCustomPosition(w,y)}));this.listSelect.valueInput&&this.listSelect.valueInput.focus();this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(F.hitch(this,function(k){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==k){var w=!1;this.valueList&&0!==this.valueList.length&&(w=!0);this.listSelect.setCBXData(k,w)}}))}},_valueLabels:function(){var q=new r;this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="label";if(this.staticValues)return this._setValueForStaticValues(this.staticValues),
q.resolve(!0),q;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),q.resolve(!0),q;this.pageControlForQuery.queryByPage(!0).then(F.hitch(this,function(A){q.resolve(A)}),F.hitch(this,function(A){console.log(A);this._hideLoadingIcon();q.reject(A)}));return q},_setValueForStaticValues:function(q){this.listSelect.codedValues=!0;q&&(this.pageControlForQuery._codedvalueCache=q,q=0<q.length?q:[],this.listSelect.setCBXData(q,
!0,!0))},_changeDisplayType:function(q){q=q.target||q.srcElement;q=z.hasClass(q,"option")?q:d.getAncestorDom(q,function(A){return z.hasClass(A,"option")},2);z.hasClass(q,"checked")||(z.addClass(q,"checked"),q=t("."+this.selectUI+"Option ",this.displayTypes)[0],z.removeClass(q,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var q=t(".title",this.displayTypes)[0],A=t(".label",this.displayTypes);q=(z.getStyle(this.displayTypes,"width")-z.getStyle(q,
"width")-80)/2;var u=z.getStyle(A[0],"width");u=u<q?u:q;var k=z.getStyle(A[1],"width");k=k<q?k:q;z.setStyle(A[0],"width",u+"px");z.setStyle(A[1],"width",k+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(F.hitch(this,function(q){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.setCBXData(q,!0);this._hideLoadingIcon()}),F.hitch(this,function(q){console.log(q);
this._hideLoadingIcon()})))},_searchKey:function(q){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(q).then(F.hitch(this,function(A){this.listSelect.setCBXContentBySearch(A);this._hideLoadingIcon()}),F.hitch(this,function(A){console.log(A);this._hideLoadingIcon()})))},_searchKeyLocal:function(q){this.listSelect&&(this._showLoadingIcon(),q=this.pageControlForQuery._searchKeyLocal(q),this.listSelect.setCBXContentBySearch(q),this._hideLoadingIcon())},_handlerPageValues:function(){},
getCheckedList:function(q){this.listSelect.checkedList=[];this.isNumberField?x.forEach(q,F.hitch(this,function(A){this.listSelect.checkedList.push(parseFloat(A))})):this.listSelect.checkedList=q},_showPopup:function(){var q=this.getValueObject().valueList;this.valueList=null===q?void 0:q;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=new a({width:355,height:596,content:this.listSelect.domNode,titleLabel:this.layerDefinition.name+
"("+this.fieldName+")",isResize:!1,useFocusLogic:!1,onClose:F.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.queryByPage().then(F.hitch(this,function(A){this._hideLoadingIcon();var u=!1;this.valueList&&0!==this.valueList.length&&(u=!0);this.listSelect.setCBXData(A,u)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(q){q.value=q.value?q.value:[];var A=t("."+(q.selectUI?q.selectUI:this.selectUI)+"Option ",
this.displayTypes)[0];z.addClass(A,"checked");A=null;if(this.isNumberField){A=[];for(var u=0;u<q.value.length;u++)A.push(q.value[u].value);A=this._getValLabelsArrayForNumber(!1,A)}this.editTable.emptyLabel=q.emptyLabel;this.editTable.enableEmpty=q.enableEmpty;this.editTable.setListValues(q.value,A)},_getValLabelsArrayForNumber:function(q,A){A=d._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,A);q&&(this.editTable.currentValLabel=A[0].label);return A},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:[],valueList:[]}:null},getValueObject:function(){if(this.isValidValue()){var q=this.editTable.getListValues(),A={isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:q.list,valueList:q.valueList};"unique"===this.controlType&&(A.emptyLabel=q.emptyLabel,A.enableEmpty=q.enableEmpty);return A}return null},setRequired:function(q){this.mutiValuesSelect.set("required",q)},
queryByPage:function(){var q=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);q.then(F.hitch(this,function(A){q.resolve(A)}),F.hitch(this,function(A){console.log(A);q.reject(A)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&z.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&z.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&
document.removeEventListener("click",this._multipleSelectProviderEventHandler);this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();z.destroy(this.domNode)}})})},"jimu/dijit/_filter/EditTable":function(){define("dojo/_base/lang dojo/_base/html dojo/Evented dojo/on dojo/keys dojo/dom-attr dojo/_base/declare dijit/_WidgetBase dojo/query dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./EditTable.html jimu/utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){return t([m,c,f,z],{templateString:b,currentItem:null,dataList:[],codedValues:null,isNumberField:!0,tableType:"unique",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"unique"===this.tableType?(this.inputType="radio",r.addClass(this.listContent,"radio-items-list-content")):
this.inputType="checkbox"},_onListContentDblClicked:function(a){this.isSearch=!1;var g=a.target||a.srcElement,l=d.getAncestorDom(g,function(A){return r.hasClass(A,"item")},3);if(l&&(r.hasClass(g,"name")||r.hasClass(g,"alias"))&&(!r.hasClass(l,"empty")||!r.hasClass(g,"name"))){this._dijit?(this.editState="active",this.updateInputDivPre=this.updateInputDiv,this._dijitPre=this._dijit):this.editState="negative";a=this._getNodeText(g);var q=decodeURIComponent(r.getAttr(g,"data"));l=r.hasClass(l,"custom");
this.placeHolder=r.hasClass(g,"name")&&!this.codedValues?q:a;l?r.hasClass(g,"alias")&&this.placeHolder!==this.customLabel?this.currentLabel=a:this.currentLabel=NaN:this.currentLabel=this.isNumberField&&r.hasClass(g,"name")&&!this.codedValues?parseFloat(this.placeHolder):this.placeHolder;v.set(g,"innerHTML","");a="";r.hasClass(g,"name")&&(a='\x3cdiv class\x3d"searchBtn"\x3e\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\x3c/div\x3e');this.updateInputDiv=r.create("div",{"class":"updateInputDiv",
innerHTML:'\x3cdiv class\x3d"inputDiv"\x3e\x3c/div\x3e'+a},g);a=h(".inputDiv",this.updateInputDiv)[0];this.searchBtn=h(".searchBtn",this.updateInputDiv)[0];this.own(x(this.updateInputDiv,"dblclick",F.hitch(this,function(A){A.stopPropagation();A.preventDefault()})));q={required:!1,intermediateChanges:!1,value:this.currentLabel};this.codedValues&&r.hasClass(g,"name")&&(q.disabled=!0);this.isNumberField&&r.hasClass(g,"name")?(q.constraints={pattern:"#####0.##########"},this._dijit=new e(q)):(q.trim=
!0,this._dijit=new p(q));this._dijit.startup();this._dijit.on("keydown",function(A){(A.keyCode||A.which)===n.ENTER&&this._dijit.emit("blur")}.bind(this));this._dijit.on("blur",F.hitch(this,function(){if(this._dijit){var A="Error"!==this._dijit.state?this._dijit.displayedValue:this.currentLabel;this.isNumberField&&r.hasClass(g,"name")&&"Error"===this._dijit.state&&this._dijit.setValue(parseFloat(A));A=d.sanitizeHTML(A);var u=this._dijit.get("value");""!==u&&u?r.hasClass(g,"name")&&(this.placeHolder===
this.customValue||"NaN"===this.placeHolder&&""!==this._dijit.displayedValue)&&(u=d.getAncestorDom(this._dijit.domNode,function(k){return r.hasClass(k,"item")},4),r.removeClass(u,"custom"),this.emit("editTable_itemChanged")):A=this.placeHolder;this.newLabel=A;setTimeout(F.hitch(this,function(){if(this.isSearch||"active"===this.editState)"active"===this.editState&&(k=this.updateInputDivPre.parentNode,w=decodeURIComponent(r.getAttr(k,"data")),r.hasClass(k,"name")?this.currentValLabel=""===this._dijitPre.displayedValue?
w===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(w):w:this.isNumberField?this._getLocalNumber(this._dijitPre.value):this._dijitPre.value:this.currentValLabel=""===this._dijitPre.displayedValue?w===this.customLabel?this.customLabel:w:this._dijitPre.displayedValue,!r.hasClass(k,"name")||"NaN"===this.newLabel||this.newLabel===this.customValue||this._getNodeText(k.nextSibling)!==this.customLabel&&this._dijit.value!==this.customLabel||(r.isDescendant(this.updateInputDiv,k.nextSibling)?
this._dijit.set("value",this.currentValLabel):(y=this.isNumberField?this.currentValLabel:this.newLabel,r.setAttr(k.nextSibling,"data",encodeURIComponent(y)),this._setNodeText(k.nextSibling,y),r.setAttr(k.nextSibling,"title",y))),y=r.hasClass(k,"name")?""===this._dijitPre.displayedValue?w===this.customValue?this.customValue:w:this._dijitPre.value:this.newLabel,r.setAttr(k,"data",encodeURIComponent(y)),y=r.hasClass(k,"name")?this.currentValLabel:this.newLabel,this._setNodeText(k,y),r.setAttr(k,"title",
y),this._dijitPre=this.updateInputDivPre=null,this.editState="negative");else{var k=this.updateInputDiv.parentNode;var w=decodeURIComponent(r.getAttr(k,"data"));r.hasClass(k,"name")?this.currentValLabel=""===this._dijit.displayedValue?w===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(w):w:this.isNumberField?this._getLocalNumber(this._dijit.value):this._dijit.value:this.currentValLabel=""===this._dijit.displayedValue?w===this.customLabel?this.customLabel:w:this._dijit.displayedValue;
if(r.hasClass(k,"name")&&"NaN"!==this.newLabel&&this.newLabel!==this.customValue&&this._getNodeText(k.nextSibling)===this.customLabel){var y=this.isNumberField?this.currentValLabel:this.newLabel;r.setAttr(k.nextSibling,"data",encodeURIComponent(y));this._setNodeText(k.nextSibling,y);r.setAttr(k.nextSibling,"title",y)}y=r.hasClass(k,"name")?""===this._dijit.displayedValue?w===this.customValue?this.customValue:w:this._dijit.value:this.newLabel;r.setAttr(k,"data",encodeURIComponent(y));y=r.hasClass(k,
"name")?this.currentValLabel:this.newLabel;this._setNodeText(k,y);r.setAttr(k,"title",y);this._dijit=null;this.isSearch=!1}}),300);this.placeHolder=""}}));r.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(a);h("input",this._dijit.domNode)[1].focus();this.searchBtn&&(this.own(x(this.searchBtn,"click",F.hitch(this,function(A){this.isSearch||(this.isSearch=!0,this.searchTarget=A.target||A.srcElement,this.emit("editTable_openListSelectByName",this.newLabel),A.stopPropagation(),A.preventDefault())}))),
this.codedValues&&this.searchBtn.click())}},_getLocalNumber:function(a){"string"===typeof a&&(a=parseFloat(a));this.emit("editTable_getValLabelsArrayForNumber",!0,[a]);return this.currentValLabel},_setNewLabel:function(a,g){if(void 0===a&&void 0===g)if(""!==this._dijit.displayedValue)this.codedValues?(g=this._dijit.displayedValue,a=this._getCodeFromCodevalueLabel(g)):(g=a=this._dijit.value,this.isNumberField&&this.newLabel!==this.customValue&&(g=this._getLocalNumber(a)));else if(a=g=this.customValue,
this.updateInputDiv&&this.updateInputDiv.parentNode){var l=this.updateInputDiv.parentNode;l=decodeURIComponent(r.getAttr(l,"data"));l!==this.customValue&&(a=this.isNumberField?parseFloat(l):l,g=this.codedValues?this._getLabelFromCodevalue(a):this.isNumberField?this._getLocalNumber(a):a)}this.updateInputDiv&&this.updateInputDiv.parentNode&&(l=this.updateInputDiv.parentNode,g!==this.customValue&&this._getNodeText(l.nextSibling)===this.customLabel&&(r.setAttr(l.nextSibling,"data",encodeURIComponent(g)),
this._setNodeText(l.nextSibling,g),r.setAttr(l.nextSibling,"title",g)),this.codedValues||(a=a?a:decodeURIComponent(r.getAttr(l,"data"))),r.setAttr(l,"data",encodeURIComponent(a)),a=l.parentNode,g!==this.customValue&&r.removeClass(a,"custom"),this._setNodeText(l,g),r.setAttr(l,"title",g));this._dijit=this.updateInputDiv=null},_onListContentClicked:function(a){a=a.target||a.srcElement;var g=d.getAncestorDom(a,function(l){return r.hasClass(l,"item")},3);g&&(r.hasClass(a,"checkboxEmpty")?r.hasClass(a,
"checked")?r.removeClass(a,"checked"):r.addClass(a,"checked"):r.hasClass(a,this.inputType)?("radio"===this.inputType&&!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),r.hasClass(a,"checked")?"radio"!==this.inputType?r.removeClass(a,"checked"):r.hasClass(this.currentItem,"checked")||r.removeClass(a,"checked"):("radio"===this.inputType&&this.currentItem&&r.removeClass(this.currentItem,"checked"),r.addClass(a,"checked"),this.currentItem=a)):r.hasClass(a,"action")&&(r.hasClass(a,"up")?
g.previousElementSibling&&r.place(g,g.previousElementSibling,"before"):r.hasClass(a,"down")?g.nextElementSibling&&r.place(g,g.nextElementSibling,"after"):r.hasClass(a,"delete")&&(r.destroy(g),this.emit("editTable_itemChanged"))))},_getLabelFromCodevalue:function(a){for(var g=a,l=0;l<this.codedValues.length;l++){var q=this.codedValues[l];if(q.value===a){g=q.label;break}}return g},_getCodeFromCodevalueLabel:function(a){for(var g=a,l=0;l<this.codedValues.length;l++){var q=this.codedValues[l];if(q.label===
a){g=q.value;break}}return g},_createEmptyTarget:function(a){for(var g=this.emptyStr,l=this.emptyLabel?this.emptyLabel:g,q=" checked",A=0;A<a.length;A++)if(a[A].isChecked){q="";break}" checked"===q&&(this.currentItem=!0);A='data\x3d"'+encodeURIComponent(g)+'"';var u="",k=this.Nls.emptyValueTips;if(0===a.length||this.enableEmpty)u=" checked";return r.create("div",{"class":"item empty",innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis" style\x3d"cursor: default;"'+A+"\x3e"+g+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+
l+'"\x3e'+l+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+q+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"label checkbox checkboxEmpty'+u+' jimu-ellipsis jimu-flipx" title\x3d"'+k+'"\x3e\x3c/div\x3e'},this.listContent)},_createTarget:function(a,g,l,q,A){var u="item";A&&(a=g=this.customValue,l=this.customLabel,u="item custom");a=a||0===a?a:"";g=g||"";l=l?l:a;q=q?q:"";var k=a;(this.codedValues||this.isNumberField)&&a!==this.Nls.addValuePlaceHolder&&(k=this.codedValues?this._getLabelFromCodevalue(a):
g);g=this.isNumberField?a:encodeURIComponent(a);q=r.create("div",{"class":u,innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis-Blanks" data\x3d"'+(g+'"\x3e')+k+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+l+'"\x3e'+l+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+q+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"actions jimu-float-trailing"\x3e\x3cdiv class\x3d"delete action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"down action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"up action jimu-float-trailing"\x3e\x3c/div\x3e\x3c/div\x3e'},
this.listContent);A&&(A=h(".name",q)[0],r.setAttr(A,"title",a),r.setAttr(A.nextSibling,"title",l));return q},_destroyTarget:function(a){for(var g=h(".item .name",this.listContent),l=0;l<g.length;l++){var q=g[l];if(v.get(this._dijit.domNode.parentNode,"innerHTML")===a){r.destroy(q.parentNode);break}}},getCurrentItem:function(){for(var a=h(".item .radio",this.listContent),g=0;g<a.length;g++){var l=a[g];if(r.hasClass(l,"checked"))return l}return null},_getEmptyLabel:function(){var a=h(".label.alias",
this.listContent.firstChild)[0],g=this._getNodeText(a);a.children.length&&(g="Error"===this._dijit.state?decodeURIComponent(r.getAttr(a,"data")):this._dijit.value);return g=d.sanitizeHTML(g)},_getEmptyStatus:function(){var a=h(".checkboxEmpty",this.listContent.firstChild)[0];return r.hasClass(a,"checked")?!0:!1},_getNodeText:function(a){return a.textContent||a.innerText||""},_setNodeText:function(a,g){a.innerHTML="\x26nbsp;";a.textContent?a.textContent=g:a.innerText=g},getListValues:function(){this.listItemsArray=
[];this.listValuesArray=[];for(var a=h(".item .name",this.listContent),g="radio"===this.inputType?1:0;g<a.length;g++){var l=a[g],q=d.getAncestorDom(l,function(u){return r.hasClass(u,"item")},3);if(!r.hasClass(q,"custom")){q=this._getNodeText(l);var A=decodeURIComponent(r.getAttr(l,"data"));if(this.isNumberField||this.codedValues)q=A;l.children.length&&(q="Error"===this._dijit.state?A:this._dijit.value,this.codedValues&&(q=this._getCodeFromCodevalueLabel(q),q=void 0!==q?q:A));q=this.isNumberField?
parseFloat(q):d.sanitizeHTML(q);A=this._getNodeText(l.nextSibling);A===this.customLabel&&(A=q.toString(),this.isNumberField&&(A=this._getLocalNumber(A)));l.nextSibling.children.length&&(A="Error"===this._dijit.state?decodeURIComponent(r.getAttr(l.nextSibling,"data")):this._dijit.value);A=d.sanitizeHTML(A);A={value:q,alias:A,isChecked:!1};this.listItemsArray.push(A);this.listValuesArray.push(q);r.hasClass(l.nextSibling.nextSibling,"checked")&&(A.isChecked=!0)}}a={list:this.listItemsArray,valueList:this.listValuesArray};
"radio"===this.inputType&&(a.emptyLabel=this._getEmptyLabel(),a.enableEmpty=this._getEmptyStatus());return a},setListValues:function(a,g){v.set(this.listContent,"innerHTML","");"radio"===this.inputType&&this._createEmptyTarget(a);for(var l=0;l<a.length;l++){var q=a[l],A="";q.isChecked&&(A=" checked",this.currentItem=!0);this._createTarget(q.value,g?g[l].label:q.value,q.alias,A)}a=h(".name",this.listContent);for(g=0;g<a.length;g++)l=a[g],r.setAttr(l,"title",this._getNodeText(l)),l=l.nextSibling,r.setAttr(l,
"title",this._getNodeText(l))},_initTable:function(){},getDijits:function(){return[this.mutiValuesSelect]},destroy:function(){this.inherited(arguments)}})})},"dojox/form/CheckedMultiSelect":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/dom-geometry dojo/dom-class dojo/dom-construct dojo/i18n dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/_FormSelectWidget dijit/form/ComboButton dojo/text!dojox/form/resources/_CheckedMultiSelectMenuItem.html dojo/text!dojox/form/resources/_CheckedMultiSelectItem.html dojo/text!dojox/form/resources/CheckedMultiSelect.html dojo/i18n!dojox/form/nls/CheckedMultiSelect dijit/form/CheckBox".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u){var k=F("dojox.form._CheckedMultiSelectItem",[h,p,e],{templateString:q,baseClass:"dojoxMultiSelectItem",option:null,parent:null,disabled:!1,readOnly:!1,postMixInProperties:function(){this._type=this.parent.multiple?{type:"checkbox",baseClass:"dijitCheckBox"}:{type:"radio",baseClass:"dijitRadio"};this.disabled||(this.disabled=this.option.disabled=this.option.disabled||!1);this.readOnly||(this.readOnly=this.option.readOnly=this.option.readOnly||!1);
this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.labelNode.innerHTML=this.option.label},_changeBox:function(){this.get("disabled")||this.get("readOnly")||(this.parent.multiple?this.option.selected=this.checkBox.get("value")&&!0:this.parent.set("value",this.option.value),this.parent._updateSelection(),this.parent.focus())},_onClick:function(C){this.get("disabled")||this.get("readOnly")?x.stop(C):this.checkBox._onClick(C)},_updateBox:function(){this.checkBox.set("value",
this.option.selected)},_setDisabledAttr:function(C){this.disabled=C||this.option.disabled;this.checkBox.set("disabled",this.disabled);v.toggle(this.domNode,"dojoxMultiSelectDisabled",this.disabled)},_setReadOnlyAttr:function(C){this.checkBox.set("readOnly",C);this.readOnly=C}}),w=F("dojox.form._CheckedMultiSelectMenu",f,{multiple:!1,buildRendering:function(){this.inherited(arguments);var C=this.menuTableNode=this.domNode,D=this.domNode=t.create("div",{style:{overflowX:"hidden",overflowY:"scroll"}});
C.parentNode&&C.parentNode.replaceChild(D,C);v.remove(C,"dijitMenuTable");D.className=C.className+" dojoxCheckedMultiSelectMenu";C.className="dijitReset dijitMenuTable";C.setAttribute("role","listbox");D.setAttribute("role","presentation");D.appendChild(C)},resize:function(C){C&&(n.setMarginBox(this.domNode,C),"w"in C&&(this.menuTableNode.style.width="100%"))},onClose:function(){this.inherited(arguments);this.menuTableNode&&(this.menuTableNode.style.width="")},onItemClick:function(C,D){"undefined"==
typeof this.isShowingNow&&this._markActive();this.focusChild(C);if(C.disabled||C.readOnly)return!1;if(!this.multiple)this.onExecute();C.onClick(D)}}),y=F("dojox.form._CheckedMultiSelectMenuItem",b,{templateString:l,option:null,parent:null,iconClass:"",postMixInProperties:function(){this.parent.multiple?(this._iconClass="dojoxCheckedMultiSelectMenuCheckBoxItemIcon",this._type={type:"checkbox"}):(this._iconClass="",this._type={type:"hidden"});this.disabled=this.option.disabled;this.checked=this.option.selected;
this.label=this.option.label;this.readOnly=this.option.readOnly;this.inherited(arguments)},onChange:function(C){},_updateBox:function(){v.toggle(this.domNode,"dojoxCheckedMultiSelectMenuItemChecked",!!this.option.selected);this.domNode.setAttribute("aria-checked",this.option.selected);this.inputNode.checked=this.option.selected;this.parent.multiple||v.toggle(this.domNode,"dijitSelectSelectedOption",!!this.option.selected)},_onClick:function(C){this.disabled||this.readOnly||(this.parent.multiple?(this.option.selected=
!this.option.selected,this.parent.onChange(),this.onChange(this.option.selected)):this.option.selected||(z.forEach(this.parent.getChildren(),function(D){D.option.selected=!1}),this.option.selected=!0,this.parent.onChange(),this.onChange(this.option.selected)));this.inherited(arguments)}});return F("dojox.form.CheckedMultiSelect",a,{templateString:A,baseClass:"dojoxCheckedMultiSelect",required:!1,invalidMessage:"$_unset_$",_message:"",dropDown:!1,labelText:"",tooltipPosition:[],postMixInProperties:function(){this.inherited(arguments);
this._nlsResources=m.getLocalization("dojox.form","CheckedMultiSelect",this.lang);"$_unset_$"==this.invalidMessage&&(this.invalidMessage=this._nlsResources.invalidMessage)},_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var C=this.srcNodeRef.selectedIndex||0;this.value=this.options[0<=C?C:0].value}this.dropDown&&(v.toggle(this.selectNode,"dojoxCheckedMultiSelectHidden"),this.dropDownMenu=new w({id:this.id+"_menu",style:"display: none;",multiple:this.multiple,
onChange:r.hitch(this,"_updateSelection")}))},startup:function(){this.dropDown&&(this.dropDownButton=new g({label:this.labelText,dropDown:this.dropDownMenu,baseClass:"dojoxCheckedMultiSelectButton",maxHeight:this.maxHeight},this.comboButtonNode));this.inherited(arguments)},_onMouseDown:function(C){C.preventDefault()},validator:function(){return this.required?z.some(this.getOptions(),function(C){return C.selected&&null!=C.value&&0!=C.value.toString().length}):!0},validate:function(C){d.hide(this.domNode);
(C=this.isValid(C))||this.displayMessage(this.invalidMessage);return C},isValid:function(C){return this.validator()},getErrorMessage:function(C){return this.invalidMessage},displayMessage:function(C){d.hide(this.domNode);C&&d.show(C,this.domNode,this.tooltipPosition)},onAfterAddOptionItem:function(C,D){},_addOptionItem:function(C){if(this.dropDown){var D=new y({option:C,parent:this.dropDownMenu});this.dropDownMenu.addChild(D)}else D=new k({option:C,parent:this,disabled:this.disabled,readOnly:this.readOnly}),
this.wrapperDiv.appendChild(D.domNode);this.onAfterAddOptionItem(D,C)},_refreshState:function(){this.validate(this.focused)},onChange:function(C){this._refreshState()},reset:function(){this.inherited(arguments);d.hide(this.domNode)},_updateSelection:function(){this.inherited(arguments);this._handleOnChange(this.value);z.forEach(this._getChildren(),function(H){H._updateBox()});t.empty(this.containerNode);var C=this;z.forEach(this.value,function(H){H=t.create("option",{value:H,label:H,selected:"selected"});
t.place(H,C.containerNode)});if(this.dropDown&&this.dropDownButton){var D=0,G="";z.forEach(this.options,function(H){H.selected&&(D++,G=H.label)});this.dropDownButton.set("label",this.multiple?r.replace(this._nlsResources.multiSelectLabelText,{num:D}):G)}},_getChildren:function(){return this.dropDown?this.dropDownMenu.getChildren():z.map(this.wrapperDiv.childNodes,function(C){return c.byNode(C)})},invertSelection:function(C){this.multiple&&(z.forEach(this.options,function(D){D.selected=!D.selected}),
this._updateSelection())},_setDisabledAttr:function(C){this.inherited(arguments);this.dropDown&&this.dropDownButton.set("disabled",C);z.forEach(this._getChildren(),function(D){D&&D.set&&D.set("disabled",C)})},_setReadOnlyAttr:function(C){this.inherited(arguments);"readOnly"in this.attributeMap&&this[this.attributeMap.readOnly].setAttribute("readonly",C);this.readOnly=C;z.forEach(this._getChildren(),function(D){D&&D.set&&D.set("readOnly",C)})},uninitialize:function(){d.hide(this.domNode);z.forEach(this._getChildren(),
function(C){C.destroyRecursive()});this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a){e("dijit-legacy-requires")&&a(0,function(){F(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return z("dijit.Menu",
d,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):r.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(g){return f.get(this._iframeContentDocument(g))||this._iframeContentDocument(g).__parent__||g.name&&document.frames[g.name]||null},_iframeContentDocument:function(g){return g.contentDocument||
g.contentWindow&&g.contentWindow.document||g.name&&document.frames[g.name]&&document.frames[g.name].document||null},bindDomNode:function(g){g=x.byId(g,this.ownerDocument);if("iframe"==g.tagName.toLowerCase()){var l=g;var q=this._iframeContentWindow(l);q=c.body(q.document)}else q=g==c.body(this.ownerDocument)?this.ownerDocument.documentElement:g;var A={node:g,iframe:l};n.set(g,"_dijitMenu"+this.id,this._bindings.push(A));var u=h.hitch(this,function(k){var w=this.selector,y=w?function(D){return p.selector(w,
D)}:function(D){return D},C=this;return[p(k,y(this.leftClickToOpen?"click":"contextmenu"),function(D){D.stopPropagation();D.preventDefault();(new Date).getTime()<C._lastKeyDown+500||C._scheduleOpen(this,l,{x:D.pageX,y:D.pageY},D.target)}),p(k,y("keydown"),function(D){if(93==D.keyCode||D.shiftKey&&D.keyCode==m.F10||C.leftClickToOpen&&D.keyCode==m.SPACE)D.stopPropagation(),D.preventDefault(),C._scheduleOpen(this,l,null,D.target),C._lastKeyDown=(new Date).getTime()})]});A.connects=q?u(q):[];l&&(A.onloadHandler=
h.hitch(this,function(){var k=this._iframeContentWindow(l);k=c.body(k.document);A.connects=u(k)}),l.addEventListener?l.addEventListener("load",A.onloadHandler,!1):l.attachEvent("onload",A.onloadHandler))},unBindDomNode:function(g){try{var l=x.byId(g,this.ownerDocument)}catch(k){return}g="_dijitMenu"+this.id;if(l&&n.has(l,g)){for(var q=n.get(l,g)-1,A=this._bindings[q],u;u=A.connects.pop();)u.remove();(u=A.iframe)&&(u.removeEventListener?u.removeEventListener("load",A.onloadHandler,!1):u.detachEvent("onload",
A.onloadHandler));n.remove(l,g);delete this._bindings[q]}},_scheduleOpen:function(g,l,q,A){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:A,delegatedTarget:g,iframe:l,coords:q})},1))},_openMyself:function(g){function l(){D.refocus&&G&&G.focus();b.close(D)}var q=g.target,A=g.iframe,u=g.coords,k=!u;this.currentTarget=g.delegatedTarget;if(u){if(A){g=v.position(A,!0);q=this._iframeContentWindow(A);q=v.docScroll(q.document);var w=t.getComputedStyle(A),
y=t.toPixelValue,C=(e("ie")&&e("quirks")?0:y(A,w.paddingLeft))+(e("ie")&&e("quirks")?y(A,w.borderLeftWidth):0);A=(e("ie")&&e("quirks")?0:y(A,w.paddingTop))+(e("ie")&&e("quirks")?y(A,w.borderTopWidth):0);u.x+=g.x+C-q.x;u.y+=g.y+A-q.y}}else u=v.position(q,!0),u.x+=10,u.y+=10;var D=this;A=this._focusManager.get("prevNode");g=this._focusManager.get("curNode");var G=!g||x.isDescendant(g,this.domNode)?A:g;b.open({popup:this,x:u.x,y:u.y,onExecute:l,onCancel:l,orient:this.isLeftToRight()?"L":"R"});this.focus();
k||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);b.close(this)}},destroy:function(){r.forEach(this._bindings,function(g){g&&this.unBindDomNode(g.node)},this);this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(F,r,z,x,n,v,t,m,h){x("dijit-legacy-requires")&&
v(0,function(){F(["dijit/form/RadioButton"])});return r("dijit.form.CheckBox",[t,m],{templateString:h,baseClass:"dijitCheckBox",_setValueAttr:function(p,e){"string"==typeof p&&(this.inherited(arguments),p=!0);this._created&&this.set("checked",p,e)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&
n("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&n("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(F,r){return F("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(z){this._set("readOnly",z);r.set(this.focusNode,"readOnly",
z)},_setLabelAttr:void 0,_getSubmitValue:function(z){return null==z||""===z?"on":z},_setValueAttr:function(z){z=this._getSubmitValue(z);this._set("value",z);r.set(this.focusNode,"value",z)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));r.set(this.focusNode,"value",this.value)},_onClick:function(z){return this.readOnly?(z.stopPropagation(),z.preventDefault(),!1):this.inherited(arguments)}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(F,r,z,x,n,v,t,m){return x([n,v,t],{templateString:m,postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());z.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),F.hitch(this,function(h){this.rangeSelect.addOption({value:h,label:this.nls[h]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(h){this.isDefined(h.value)&&this._dijit1.set("value",h.value);this.isDefined(h.range)&&this.rangeSelect.set("value",h.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var h=this.rangeSelect.get("value");"none"===h&&(h=null);return h},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var h={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(h.value)&&(h.value=null);return h}return null},setRequired:function(h){this._dijit1.set("required",h);this.rangeSelect.set("required",h)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(F,r,z,x,n,v,t,m,h){return x([t,n,F],{templateString:v,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(z.hitch(this,function(p){this.dateTypeSelect.addOption({value:p,label:this.nls[p]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(p,e,c,f){if(this.isDefined(e[c])){var b={value:null,virtualDate:""};b.value=e[c];b.virtualDate=e[f];p.setValueObject(b)}},setValueObject:function(p){this.dateTypeSelect.set("value",p.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var p={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},e=this.dateTypeSelect.get("value"),
c=m.getRealDateByVirtualDate(e);p.virtualDate=e;c&&(p.value1=h.getDateTimeStr(c[0]),p.value2=h.getDateTimeStr(c[1]));return p},setRequired:function(p){this.dateTypeSelect.set("required",p)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(F,r,z){return F("dijit.form.DateTextBox",z,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:r,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/keys dijit/a11yclick dijit/focus dojo/query dojo/store/Memory jimu/utils jimu/filterUtils dijit/Tooltip dojo/mouse jimu/dijit/_filter/ValueProviderFactory dijit/popup jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,A,u){return r([z,x,n,F],{templateString:v,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,dateOptionsObj:{status:!1},allDates:[g.VIRTUAL_DATE_CUSTOM,g.VIRTUAL_DATE_TODAY,g.VIRTUAL_DATE_YESTERDAY,g.VIRTUAL_DATE_TOMORROW],
runtime:!1,widgetId:"",postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(p(this.valueTypeSetNode,c,t.hitch(this,this._onValueTypeSetClick)));this.own(p(this.btnDelete,
c,t.hitch(this,function(){this._destroySelf()})));this.own(p(document,"click",t.hitch(this,function(k){k=k.target;m.isDescendant(k,this.valueTypePopupNode)&&!m.hasClass(k,"value-type-popup-icon")||this._closeEsriPopup()})));this.customDijit&&this.own(p(window,"resize",t.hitch(this,function(){this._closeEsriPopup()})))},toJson:function(){var k={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},w=this._getFieldObjByUI();if(!w)return null;k.fieldObj=w;w=this._getOperatorByUI();
if(!w)return null;k.operator=w;k.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();w=this._getValueTypeByUI();var y=this._isUseAskForValues();if(y){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;k.interactiveObj={prompt:a.sanitizeHTML(this.promptTB.get("value")),hint:a.sanitizeHTML(this.hintTB.get("value")),cascade:"none"};this.dateOptionsObj.status&&(1===this.dateOptionsObj.num?k.interactiveObj.virtualDates=this._getRelativeDatesByUI("start"):
(k.interactiveObj.virtualDates1=this._getRelativeDatesByUI("start"),k.interactiveObj.virtualDates2=this._getRelativeDatesByUI("end")));if("unique"===w||"multiple"===w)k.interactiveObj.cascade=this.cascadeSelect.get("value")}k.valueObj={isValid:!0,type:""};y=y?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!y)return null;y.type=w;k.valueObj=y;return k},_getRelativeDatesByUI:function(k){var w=[];h.forEach(this.allDates,function(y){this[y+"_"+k+"_date"].checked&&w.push(y)},
this);return w},_removeRelativeDateChangeEvents:function(){h.forEach(this.allDates,function(k){var w=this[k+"_start_date"];w.changeEvent&&w.changeEvent.remove();2===this.dateOptionsObj.num&&(k=this[k+"_end_date"],k.changeEvent&&k.changeEvent.remove())},this)},_getFieldObjByUI:function(){var k=this._getSelectedFilteringItem(this.fieldsSelect);if(!k)return null;var w="";0!==this.popupFieldsInfo.length&&(w=a.getDateFieldFormatByFieldName(this.popupFieldsInfo,k.name));return{name:k.name,label:k.name,
dateFormat:w,shortType:k.shortType,type:k.type}},_getOperatorByUI:function(){var k=this.operatorsSelect.get("value");"none"===k&&(k=null);return k},showDelteIcon:function(){m.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){m.setStyle(this.btnDelete,"display","none")},_showCaseSensitive:function(){m.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){m.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);
this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(p(this.fieldsSelect,"MouseEnter",t.hitch(this,this._updateFieldsSelectTitle)));this.own(p(this.operatorsSelect,"MouseEnter",t.hitch(this,this._updateOperatorsSelectTitle)));this.enableAskForValues?
(m.setStyle(this.cbxAskValues.domNode,"display","inline-block"),m.setStyle(this.promptSection,"display","block"),this.own(p(this.cbxAskValues,"status-change",t.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=t.hitch(this,this._onCbxAskValuesClicked)):(m.setStyle(this.cbxAskValues.domNode,"display","none"),m.setStyle(this.promptSection,"display","none"));var k=this.layerInfo.fields;k&&0<k.length&&(k=h.filter(k,t.hitch(this,function(w){return 0<=this.supportFieldTypes.indexOf(w.type)})),
0<k.length&&(this._initValueTypeUI(),this._enableAllValueTypeOptions(),this._initFieldsSelect(k),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(t.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.fieldsSelect&&(this._handle1=p(this.fieldsSelect,"change",t.hitch(this,this._onFieldsSelectChange)));this.operatorsSelect&&
(this._handle2=p(this.operatorsSelect,"change",t.hitch(this,this._onOperatorsSelectChange)))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(k,w){if(this._isStreamServer(k))return!1;k=w.currentVersion?w:w.toJson().layerDefinition;return 10.1<=parseFloat(k.currentVersion)},_isStreamServer:function(k){k=(k||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(k)},
_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title="";var k=this._getSelectedFilteringItem(this.fieldsSelect);k&&(this.fieldsSelect.domNode.title=k.displayName||k.alias||k.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var k=this.operatorsSelect.get("value");k&&(k=this.operatorsSelect.getOptions(k),this.operatorsSelect.domNode.title=k.label,m.setAttr(this.operatorsSelect.domNode,"aria-label",k.label))},_showValidationErrorTip:function(k){try{!k.validate()&&
k.domNode&&k.focusNode&&(k.focusNode.focus(),k.focusNode.blur())}catch(w){console.error(w)}},_getSelectedFilteringItem:function(k){if(k.validate()){var w=k.get("item");if(w)return w}this._showValidationErrorTip(k);return null},_getShortTypeByFieldType:function(k){return k===this.stringFieldType?"string":k===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(k)?"number":null},_initFieldsSelect:function(k){k=h.map(k,t.hitch(this,function(y,C){var D=t.mixin({},y);D.id=C;D.shortType=this._getShortTypeByFieldType(y.type);
D.alias||(D.alias=D.name);y="";"string"===D.shortType?y=this.nls.string:"number"===D.shortType?y=this.nls.number:"date"===D.shortType&&(y=this.nls.date);D.displayName=D.alias+" ("+y+")";return D}));if(0<k.length){var w=new d({data:k});this.fieldsSelect.set("store",w);this.fieldsSelect.set("value",k[0].id)}setTimeout(t.hitch(this,function(){this.fieldsSelect&&this.fieldsSelect.focusNode&&this.fieldsSelect.focusNode.focus()}),2);this._updateOperatorsByFieldsSelect()},_showPart:function(k){if((this.part=
k)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var w=this.part.fieldObj.name;k=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;w=this.fieldsSelect.store.query({name:w});0!==w.length&&(w=w[0])&&(this.fieldsSelect.set("value",w.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",k),this._resetByFieldAndOperator(this.part),k=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),
this.promptTB.set("value",k.prompt||""),this.hintTB.set("value",k.hint||""),"unique"===this.part.valueObj.type||"multiple"===this.part.valueObj.type?this.cascadeSelect.set("value",k.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",
label:this.nls.none});var k=this._getSelectedFilteringItem(this.fieldsSelect);k&&(this.operatorsSelect.shortType=k.shortType,k=A.getOperatorsByShortType(k.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),h.forEach(k,t.hitch(this,function(w){this.operatorsSelect.addOption({value:w,label:this.nls[w]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){m.removeClass(this.domNode,"value-type");m.removeClass(this.domNode,
"field-type");m.removeClass(this.domNode,"unique-type");m.removeClass(this.domNode,"support-cascade");var k=this._getValueTypeByUI();"value"===k?(m.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none")):"field"===k?(m.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value","none")):(m.addClass(this.domNode,"unique-type"),this.cascadeSelect.set("value","previous"),k=!0,k=this._getSelectedFilteringItem(this.fieldsSelect),k=a.getCodedValuesOrTypesCount(k,this.layerInfo),
(k=0<k?a.isCodedValuesSupportFilter(this.layerInfo,k):!0)?(this.cascadeSelect.set("value","previous"),m.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none"))},_enableValueTypeSelectOption:function(k,w){k=b("li[data-type\x3d"+k+"]",this.valueTypePopupNode)[0];w?(m.removeClass(k,"disabled"),m.setAttr(k,"aria-disabled","false")):(m.addClass(k,"disabled"),m.setAttr(k,"aria-disabled","true"))},_setVisibleValueTypeSelectOption:function(k,w){k=b("li[data-type\x3d"+k+"]",this.valueTypePopupNode)[0];
w?m.setStyle(k,"display","block"):m.setStyle(k,"display","none")},_calcValueTypePosition:function(k){k=m.position(k.target);var w=m.position(document.body).w;var y=m.position(document.body).h;var C=m.getStyle(this.valueTypePopupNode,"width"),D=m.getStyle(this.valueTypePopupNode,"height");y=y-k.y-16-10>=D?k.y+16+10:k.y-D-10;w=w-k.x>=C?k.x:k.x+16-C;window.isRTL&&(w=k.x+16>=C?k.x+16-C:k.x);return{left:w,top:y}},_onValueTypeSetClick:function(k){u.open({popup:this.customDijit,around:k.target});var w=this._calcValueTypePosition(k);
u.open({x:w.left,y:w.top,popup:this.customDijit});k.stopPropagation();a.isInNavMode()&&f.focus(this.valueTypePopupDelBtn)},_onValueTypeClick:function(k){var w=m.getAttr(k.currentTarget,"data-type");m.hasClass(k.currentTarget,"disabled")?k.stopPropagation():(b("li",this.valueTypePopupNode).forEach(function(y){m.removeClass(y,"selected")}),m.addClass(k.currentTarget,"selected"),this._resetByFieldAndOperator(null,w),this._closeEsriPopup())},_enableValueTypeOption:function(k){this._enableValueTypeSelectOption("value",
k)},_enableFieldTypeOption:function(k){this._enableValueTypeSelectOption("field",k)},_enableUniqueTypeOption:function(k){this._enableValueTypeSelectOption("unique",k)},_enableUniquePredefinedTypeOption:function(k){this.runtime?this._setVisibleValueTypeSelectOption("uniquePredefined",!1):this._enableValueTypeSelectOption("uniquePredefined",k)},_enableValuesTypeOption:function(k){this._enableValueTypeSelectOption("values",k)},_enableMultipleTypeOption:function(k){this._enableValueTypeSelectOption("multiple",
k)},_enableMultiplePredefinedTypeOption:function(k){this.runtime?this._setVisibleValueTypeSelectOption("multiplePredefined",!1):this._enableValueTypeSelectOption("multiplePredefined",k)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);this._enableUniqueTypeOption(!0);this._enableUniquePredefinedTypeOption(!0);this._enableMultipleTypeOption(!0);this._enableMultiplePredefinedTypeOption(!0)},_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);
this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1);this._enableUniquePredefinedTypeOption(!1);this._enableMultipleTypeOption(!1);this._enableMultiplePredefinedTypeOption(!1)},_resetByFieldAndOperator:function(k,w){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideCaseSensitive();this._disableAllValueTypeOptions();k||(k={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},k.fieldObj=this._getFieldObjByUI(),k.operator=this._getOperatorByUI());
k.widgetId=this.widgetId;var y=[],C=null;k.fieldObj&&k.operator&&(y=this.valueProviderFactory.getSupportedValueTypes(k.fieldObj.name,k.operator),k.valueObj?C=k.valueObj.type:(C=w&&0<=y.indexOf(w)?w:y[0],k.valueObj={type:C}),0<=y.indexOf("value")&&this._enableValueTypeOption(!0),0<=y.indexOf("field")&&this._enableFieldTypeOption(!0),0<=y.indexOf("unique")&&this._enableUniqueTypeOption(!0),0<=y.indexOf("values")&&this._enableValuesTypeOption(!0),0<=y.indexOf("uniquePredefined")&&this._enableUniquePredefinedTypeOption(!0),
0<=y.indexOf("multiple")&&this._enableMultipleTypeOption(!0),0<=y.indexOf("multiplePredefined")&&this._enableMultiplePredefinedTypeOption(!0),"value"===C?(this._enableValueTypeOption(!0),this.dateOptionsObj.status=!1,m.removeClass(this.domNode,"support-relative-start-date"),m.removeClass(this.domNode,"support-relative-end-date"),this._initDateOptionsUI(k)):"field"===C?this._enableFieldTypeOption(!0):"unique"===C?this._enableUniqueTypeOption(!0):"values"===C?this._enableValuesTypeOption(!0):"uniquePredefined"===
C?this._enableUniquePredefinedTypeOption(!0):"multiple"===C?this._enableMultipleTypeOption(!0):"multiplePredefined"===C&&this._enableMultiplePredefinedTypeOption(!0),this._updateValueTypeUI(C));0<y.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(k,this.runtime),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(k.valueObj),this.own(p(this.valueProvider,"change",t.hitch(this,function(D,G){D&&this.dateOptionsObj.status&&this[D+"_"+G+"_date"].setValue(!0);
this.emit("change")}))),this.valueProvider.bindChangeEvents(),this.valueProvider.isBlankValueProvider()?(m.addClass(this.valueProvider.domNode,"hidden"),m.addClass(this.attributeValueContainer,"hidden")):m.removeClass(this.attributeValueContainer,"hidden"),(w=A.getOperatorInfo(k.operator))&&C&&(w[C]&&w[C].supportCaseSensitive&&this._showCaseSensitive(),k&&this.cbxCaseSensitive.setValue(k.caseSensitive))):m.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},
_initDateOptionsUI:function(k){k.fieldObj.type===this.dateFieldType&&(this.dateOptionsObj=A.isSupportVirtualDates(k.operator),this.dateOptionsObj.status&&(1===this.dateOptionsObj.num?(this._initDateOptions(k.interactiveObj.virtualDates,"start"),this.startDateOptions.innerHTML=this.nls.dateOptions):(this._initDateOptions(k.interactiveObj.virtualDates1,"start"),this._initDateOptions(k.interactiveObj.virtualDates2,"end"),m.addClass(this.domNode,"support-relative-end-date"),this.startDateOptions.innerHTML=
this.nls.startDateOptions),m.addClass(this.domNode,"support-relative-start-date")))},_initDateOptions:function(k,w){k||(k=this.allDates);h.forEach(this.allDates,function(y){var C=this[y+"_"+w+"_date"];C.changeEvent&&C.changeEvent.remove();C.setValue(0<=k.indexOf(y));C.changeEvent=p(C,"change",t.hitch(this,this._onShowTooltipCBXsChange,C,y,w))},this)},_onShowTooltipCBXsChange:function(k,w,y){if(k&&!1===k.checked){var C="";if(this._isCurrentDateOptIsSelected(w,y))C=this.nls.notUncheckedCurrent;else if(this._isDateOptionsAllHide(y))C=
this.nls.atLeastOne;else return;k.check();l.hide();l.show(C,k.domNode);this.own(p.once(k.domNode,q.leave,t.hitch(this,function(){l.hide(k.domNode)})))}},_isDateOptionsAllHide:function(k){var w=!0;h.some(this.allDates,function(y){if(!0===this[y+"_"+k+"_date"].checked)return w=!1,!0},this);return w},_isCurrentDateOptIsSelected:function(k,w){var y=this.valueProvider.getValueObject();if(y)if("start"===w)if(1===this.dateOptionsObj.num){if(!y.virtualDate&&k===g.VIRTUAL_DATE_CUSTOM||y.virtualDate===k)return!0}else{if(!y.virtualDate1&&
k===g.VIRTUAL_DATE_CUSTOM||y.virtualDate1===k)return!0}else if(!y.virtualDate2&&k===g.VIRTUAL_DATE_CUSTOM||y.virtualDate2===k)return!0;return!1},_updateWhenValueRadioChanged:function(){this._updatePrompt(!1,!0);this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();this._updatePrompt(!0)},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){var k=this._getValueTypeByUI();return"uniquePredefined"===k||"multiplePredefined"===
k?!0:this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var k=this._isValueRequired();this.valueProvider.setRequired(k)},_getValueTypeByUI:function(){var k=b("li.selected",this.valueTypePopupNode)[0];return k?m.getAttr(k,"data-type"):null},_closeEsriPopup:function(){this.customDijit&&u.close(this.customDijit)},_destroyEsriPopup:function(){this.customDijit&&(this.customDijit.destroy(),u.close(this.customDijit))},
_initValueTypeUI:function(){if(!this.valueTypePopupNode){this.valueTypePopupNode=document.createElement("DIV");m.addClass(this.valueTypePopupNode,"value-type-popup");this.valueTypePopupNode.innerHTML='\x3cdiv class\x3d"value-type-popup-header"\x3e\x3cspan class\x3d"value-type-popup-title jimu-ellipsis" title\x3d"'+this.nls.setInputType+'"\x3e'+this.nls.setInputType+'\x3c/span\x3e\x3cspan role\x3d"button" tabindex\x3d"0" aria-label\x3d"'+this.nls.deleteText+'" class\x3d"value-type-popup-icon jimu-icon jimu-icon-delete"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul role\x3d"listbox" tabindex\x3d"0"\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"value" title\x3d"'+
this.nls.value+'"\x3e\x3cspan\x3e'+this.nls.value+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"field" title\x3d"'+this.nls.field+'"\x3e\x3cspan\x3e'+this.nls.field+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"unique" title\x3d"'+this.nls.unique+'"\x3e\x3cspan\x3e'+this.nls.unique+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"uniquePredefined" title\x3d"'+
this.nls.uniquePredefined+'"\x3e\x3cspan\x3e'+this.nls.uniquePredefined+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiple" title\x3d"'+this.nls.multiple+'"\x3e\x3cspan\x3e'+this.nls.multiple+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiplePredefined" title\x3d"'+this.nls.multiplePredefined+'"\x3e\x3cspan\x3e'+this.nls.multiplePredefined+"\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e";
this.customDijit=new z({baseClass:"jimu-filter-valueType",domNode:this.valueTypePopupNode});this.valueTypePopupDelBtn=b(".value-type-popup-icon",this.valueTypePopupNode)[0];this.own(p(this.valueTypePopupDelBtn,"click",t.hitch(this,function(w){this._closeEsriPopup();w.stopPropagation()})));this.own(p(this.valueTypePopupDelBtn,"keydown",t.hitch(this,function(w){w.keyCode===e.ENTER||w.keyCode===e.SPACE||w.keyCode===e.ESCAPE?(w.stopPropagation(),this._closeEsriPopup(),a.isInNavMode()&&f.focus(this.valueTypeSetNode)):
w.shiftKey||w.keyCode!==e.TAB||this.valueTypeList.focus()})));this.valueTypeList=b("ul",this.valueTypePopupNode)[0];var k=b("li",this.valueTypePopupNode);this.own(p(this.valueTypeList,"focus",t.hitch(this,function(){this.selectedValueType=b("li.selected",this.valueTypePopupNode)[0];this.selectedValueType.focus()})));this.own(p(this.valueTypeList,"keydown",t.hitch(this,function(w){if(w.keyCode===e.TAB)w.shiftKey?(w.preventDefault(),this.valueTypePopupDelBtn.focus()):(w.preventDefault(),this._closeEsriPopup(),
a.isInNavMode()&&f.focus(this.valueTypeSetNode));else{var y=!1;if(w.keyCode===e.DOWN_ARROW){var C=this.selectedValueType;for(w=0;w<k.length-1;w++)if(y){if("none"!==m.getStyle(k[w],"display")){C=k[w];break}}else k[w]===this.selectedValueType&&(y=!0)}else if(w.keyCode===e.UP_ARROW)for(C=this.selectedValueType,w=k.length-1;0<=w;w--)if(y){if("none"!==m.getStyle(k[w],"display")){C=k[w];break}}else k[w]===this.selectedValueType&&(y=!0);else if(w.keyCode===e.HOME)C=k[0];else if(w.keyCode===e.END)for(w=k.length-
1;0<=w;w--)if("none"!==m.getStyle(k[w],"display")){C=k[w];break}C&&(this.selectedValueType=C,C.focus())}})));this.own(p(k,"click",t.hitch(this,function(w){this._onValueTypeClick(w)})));this.own(p(k,"keydown",t.hitch(this,function(w){w.keyCode===e.ENTER&&(this._onValueTypeClick(w),m.hasClass(w.target,"disabled")||this.valueTypeSetNode.focus())})));this.own(p(this.valueTypePopupNode,"keydown",t.hitch(this,function(w){w.keyCode===e.ESCAPE&&(w.stopPropagation(),f.focus(this.valueTypePopupDelBtn))})))}},
_updateValueTypeUI:function(k){b("li",this.valueTypePopupNode).forEach(function(w){m.removeClass(w,"selected")});if(k=b("li[data-type\x3d"+k+"]",this.valueTypePopupNode)[0])return m.addClass(k,"selected")},_updatePrompt:function(k,w){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);!k&&w&&this.cbxAskValues.uncheck(!0);m.setStyle(this.promptTable,"display","table");w=this.operatorsSelect.get("value");var y=this.nls[w],C=!1,D=this._getValueTypeByUI(),G=A.getOperatorInfo(w);
G&&D&&(G=G[D])&&G.supportAskForValue&&(C=!0);C||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));G=this.cbxAskValues.getValue();(D=0<=["uniquePredefined","multiplePredefined"].indexOf(D)?!0:!1)?this.cbxAskValues.check(!0):k?G?this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0):C?this.cbxAskValues.status||this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0);this.cbxAskValues.status&&this.cbxAskValues.checked?(m.setStyle(this.promptTable,"display","table"),(k=this._getSelectedFilteringItem(this.fieldsSelect))&&
"none"!==w&&this.promptTB.set("value",(k.alias||k.name)+" "+y)):m.setStyle(this.promptTable,"display","none");D?(this.cbxAskValues.setStatus(!1),this.cascadeSelect.setDisabled(!0)):this.cascadeSelect.setDisabled(!1)},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.dateOptionsObj.status&&this._removeRelativeDateChangeEvents();this._destroyEsriPopup();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d){return r([z,x,n,F],{templateString:v,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,runtime:!1,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText;this.nls.addText=window.jimuNls.common.add;this.inherited(arguments)},
postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var a=b(".jimu-single-filter",this.allExpsBox);a=p.map(a,m.hitch(this,function(g){return t.byNode(g).toJson()}));return p.every(a,m.hitch(this,function(g){return!!g}))&&0<a.length?{logicalOperator:this.allAnySelect.value,parts:a}:null},showDelteIcon:function(){h.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){h.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(e(this.btnDelete,
c,m.hitch(this,function(){this._destroySelf()})));this.own(e(this.btnAdd,c,m.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):p.forEach(a,m.hitch(this,function(g){this._addSingleFilter(g)}))}else this._addSingleFilter(),this._addSingleFilter();setTimeout(m.hitch(this,
function(){this.allAnySelect.focus()}),5)},_addSingleFilter:function(a){a=new d({widgetId:this.widgetId,url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,part:a,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0,runtime:this.runtime});a.placeAt(this.allExpsBox);a.startup();
this.own(f.after(a,"_destroySelf",m.hitch(this,function(){this._checkFilterNumbers();this.allAnySelect.focus()})));this.own(e(a,"change",m.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_checkFilterNumbers:function(){var a=b(".jimu-single-filter",this.allExpsBox),g=2<a.length;p.forEach(a,m.hitch(this,function(l){l=t.byNode(l);g?l.showDelteIcon():l.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g){return n([v,t,m,r],{baseClass:"jimu-filter-parameters",templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new b;this.OPERATORS=
h.clone(this._filterUtils.OPERATORS);this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(l){var q=this._getNewValidPartsObj(this.partsObj,!0),A=q?this._getFilterExprByPartsObj(q):null;return l&&l.ifDisplaySQL?void 0===q.displaySQL?A:q.displaySQL:A},getValueProviders:function(){for(var l=[],q=this._getAllInteractiveSinglePartArray(this.partsObj),A=0;A<q.length;A++){var u=q[A].spId;u&&(u=this._getSingleFilterParameterBySpId(u),l.push(u))}return l},
_getNewValidPartsObj:function(l,q){l=h.clone(l);for(var A={logicalOperator:l.logicalOperator,parts:[]},u=h.hitch(this,function(D){if(D.spId){var G=this._getSingleFilterParameterBySpId(D.spId),H=G.getValueObject();D.valueObj=H;if(!H||"uniquePredefined"!==H.type&&"multiplePredefined"!==H.type)return H&&"multipleDynamic"===H.type?0<H.value.length?1:-1:H&&"unique"===H.type?null===H.value||void 0===H.value||""===H.value?-1:1:G.getStatus();G=[];for(var L in H.value)H.value[L].isChecked&&G.push(H.value[L]);
if(0<G.length)return D.valueObj.value=G,1;D.valueObj.value="";return-1}return D.valueObj?1:-1}),k=h.hitch(this,function(D){var G=u(D);0<G&&A.parts.push(D);return G}),w=h.hitch(this,function(D){var G=[];D.parts=e.filter(D.parts,h.hitch(this,function(H){H=u(H);G.push(H);return 0<H}));1===D.parts.length?A.parts.push(D.parts[0]):2<=D.parts.length&&A.parts.push(D);return Math.min.apply(G,G)}),y=0;y<l.parts.length;y++){var C=l.parts[y];if(C.parts){if(0>w(C)&&q)return null}else if(0>k(C)&&q&&C.valueObj&&
"uniquePredefined"!==C.valueObj.type&&"multiplePredefined"!==C.valueObj.type&&"unique"!==C.valueObj.type)return null}return A},_getFilterExprByPartsObj:function(l){this._filterUtils.isHosted=d.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(l)},_getSingleFilterParameterBySpId:function(l){return this._spObj[l]},_getCascadeFilterPartsObj:function(l){var q={logicalOperator:this.partsObj.logicalOperator,parts:[]},A=h.clone(this.partsObj);var u="none";l.interactiveObj&&l.interactiveObj.cascade&&
(u=l.interactiveObj.cascade);if("previous"===u)for(u=0;u<A.parts.length;u++){var k=A.parts[u];if(k.majorCascadeIndex<l.majorCascadeIndex)q.parts.push(k);else if(k.parts&&k.majorCascadeIndex===l.majorCascadeIndex){var w=h.clone(k);w.parts=e.filter(w.parts,h.hitch(this,function(y){return y.minorCascadeIndex<l.minorCascadeIndex}));q.parts.push(w)}}else if("all"===u)for(u=0;u<A.parts.length;u++)k=A.parts[u],k.majorCascadeIndex!==l.majorCascadeIndex?q.parts.push(k):k.majorCascadeIndex===l.majorCascadeIndex&&
k.parts&&(w=h.clone(k),e.some(k.parts,h.hitch(this,function(y){return y.spId===l.spId}))&&(w.parts=e.filter(w.parts,h.hitch(this,function(y){return y.minorCascadeIndex!==l.minorCascadeIndex})),q.parts.push(w)));return q=this._getNewValidPartsObj(q,!1)},_getCascadeFilterExpr:function(l){var q="1\x3d1";(l=this._getCascadeFilterPartsObj(l))&&(q=this._getFilterExprByPartsObj(l));q||(q="1\x3d1");return q},clear:function(){this.featureLayerId=this.url=null;this.widgetId="";var l=c(".jimu-single-filter-parameter",
this.tbody);e.forEach(l,h.hitch(this,function(q){f.byNode(q).destroy()}));p.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(l,q,A,u,k){var w=new z;this.clear();this.url=l;this.layerInfo=q;this.partsObj=h.clone(A);this.partsObj=this._updatePartsObj(this.partsObj);this.featureLayerId=u;this.widgetId=k;this._setCascadeIndexForPartsObj(this.partsObj);l=this._getAllInteractiveSinglePartArray(this.partsObj);var y=this.partsObj.wId;if(0<l.length){var C=new g({url:this.url,layerDefinition:q,
featureLayerId:this.featureLayerId});l=e.map(l,h.hitch(this,function(D,G){y&&(D.vpId=y+"_"+G);D.widgetId=this.widgetId;G=p.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody);G=c("td",G)[0];var H=this._getFieldInfo(D.fieldObj.name,this.layerInfo);H=new a({nls:this.nls,url:this.url,layerDefinition:q,fieldInfo:H,part:D,valueProviderFactory:C});this.own(F(H,"change",h.hitch(this,this._onSingleFilterParameterChanged)));this.own(F(H,"enter",h.hitch(this,this._catchSingleFilterParameterEnter)));
H.placeAt(G);H.startup();D.spId=H.id;return this._spObj[H.id]=H}));e.forEach(l,h.hitch(this,function(D){D.valueProvider.getCascadeFilterExpr=h.hitch(this,this._getCascadeFilterExpr,D.part);D.valueProvider.getCascadeFilterPartsObj=h.hitch(this,this._getCascadeFilterPartsObj,D.part)}));l=e.map(l,h.hitch(this,function(D){return D.init()}));x(l).then(h.hitch(this,function(D){w.resolve(D)}),h.hitch(this,function(){w.reject()}))}else w.resolve();return w},_updatePartsObj:function(l){e.forEach(l,h.hitch(this,
function(q){q.parts?e.forEach(q.parts,h.hitch(this,function(A){A.interactiveObj&&!0===A.interactiveObj.cascade?A.interactiveObj.cascade="previous":!1===A.interactiveObj.cascade&&(A.interactiveObj.cascade="none")})):q.interactiveObj&&!0===q.interactiveObj.cascade?q.interactiveObj.cascade="previous":!1===q.interactiveObj.cascade&&(q.interactiveObj.cascade="none")}));return l},_setCascadeIndexForPartsObj:function(l){for(var q=0;q<l.parts.length;q++){var A=l.parts[q];A.majorCascadeIndex="AND"===l.logicalOperator?
q:0;A.minorCascadeIndex=0;A.cascadeIndex=A.majorCascadeIndex;if(A.parts)for(var u=0;u<A.parts.length;u++){var k=A.parts[u];k.majorCascadeIndex=A.majorCascadeIndex;k.minorCascadeIndex="AND"===A.logicalOperator?u:0;k.cascadeIndex=parseFloat(k.majorCascadeIndex+"."+k.minorCascadeIndex)}}},_getFieldInfo:function(l,q){q=q.fields;for(var A=0;A<q.length;A++){var u=q[A];if(l===u.name)return u}return null},_getAllInteractiveSinglePartArray:function(l){for(var q=[],A=0;A<l.parts.length;A++){var u=l.parts[A];
if(u.parts)for(var k=0;k<u.parts.length;k++){var w=u.parts[k];w.interactiveObj&&q.push(w)}else u.interactiveObj&&q.push(u)}return q},_catchSingleFilterParameterEnter:function(){this.emit("enter")},_onSingleFilterParameterChanged:function(){this.emit("change",this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang ../utils".split(" "),
function(F,r,z,x,n,v,t,m,h,p){return x([n,v,t,r],{baseClass:"jimu-single-filter-parameter",templateString:m,valueProvider:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,part:null,valueProviderFactory:null,postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(F(this.valueProvider,"change",h.hitch(this,this._onValueProviderChanged)));this.own(F(this.valueProvider,
"enter",h.hitch(this,this._onValueProviderEnter)));this.valueProvider.bindChangeEvents()},getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,this.part)},build:function(e,c){var f=null;this.fieldInfo=e;this.part=c;if(e=c.interactiveObj)this.promptNode.innerHTML=p.sanitizeHTML(e.prompt||""),this.hintNode.innerHTML=p.sanitizeHTML(e.hint||"");(e=this.valueProvider.setValueObject(this.part.valueObj))&&"function"===typeof e.then?f=e:(f=
new z,f.resolve(this.valueProvider));return f},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},_showValidationErrorTip:function(e){!e.validate()&&e.domNode&&e.focusNode&&(e.focusNode.focus(),e.focusNode.blur())},_onValueProviderEnter:function(){this.emit("enter")},_onValueProviderChanged:function(){this.emit("change")}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(F,r,z,x,n,v,t,m,h){return v("dijit.layout._LayoutWidget",[r,z,x],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);t.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var p=this.getParent&&this.getParent();p&&p.isLayoutContainer||(this.resize(),this.own(n.on("resize",F.hitch(this,"resize"))))}},resize:function(p,e){var c=this.domNode;p&&m.setMarginBox(c,p);e=e||{};
F.mixin(e,p||{});"h"in e&&"w"in e||(e=F.mixin(m.getMarginBox(c),e));p=h.getComputedStyle(c);var f=m.getMarginExtents(c,p),b=m.getBorderExtents(c,p);e=this._borderBox={w:e.w-(f.w+b.w),h:e.h-(f.h+b.h)};f=m.getPadExtents(c,p);this._contentBox={l:h.toPixelValue(c,p.paddingLeft),t:h.toPixelValue(c,p.paddingTop),w:e.w-f.w,h:e.h-f.h};this.layout()},layout:function(){},_setupChild:function(p){t.add(p.domNode,this.baseClass+"-child "+(p.baseClass?this.baseClass+"-"+p.baseClass:""))},addChild:function(p,e){this.inherited(arguments);
this._started&&this._setupChild(p)},removeChild:function(p){t.remove(p.domNode,this.baseClass+"-child"+(p.baseClass?" "+this.baseClass+"-"+p.baseClass:""));this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(F,r,z){return F("dgrid.OnDemandGrid",[r,z],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),
function(F,r,z,x,n,v,t){function m(e,c){c&&c.nodeType&&e.appendChild(c)}function h(e,c,f,b){if(this.formatter){b=this.formatter;var d=this.grid.formatterScope;f.innerHTML="string"===typeof b&&d?d[b](c,e):this.formatter(c,e)}else null!=c&&f.appendChild(document.createTextNode(c))}var p=8>x("ie")&&!x("quirks");r=r("dgrid.Grid",v,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(e){return"object"!=typeof e?this.columns[e]:this.cell(e).column},listType:"grid",cell:function(e,
c){if(e.column&&e.element)return e;e.target&&e.target.nodeType&&(e=e.target);if(e.nodeType){do{if(this._rowIdToObject[e.id])break;var f=e.columnId;if(f){c=f;var b=e;break}e=e.parentNode}while(e&&e!=this.domNode)}if(!b&&"undefined"!=typeof c){var d=this.row(e);if(f=d&&d.element){f=f.getElementsByTagName("td");for(var a=0;a<f.length;a++)if(f[a].columnId==c){b=f[a];break}}}if(null!=e)return{row:d||this.row(e),column:c&&this.column(c),element:b}},createRowCells:function(e,c,f,b){var d=n("table.dgrid-row-table[role\x3dpresentation]"),
a=9>x("ie")||x("quirks")?n(d,"tbody"):d,g,l,q;f=f||this.subRows;var A=0;for(g=f.length;A<g;A++){var u=f[A];var k=n(a,"tr");u.className&&n(k,"."+u.className);var w=0;for(l=u.length;w<l;w++){var y=u[w];var C=y.id;var D=y.field?".field-"+t.escapeCssIdentifier(y.field,"-"):"";(q="function"===typeof y.className?y.className(b):y.className)&&(D+="."+q);D=n(e+(".dgrid-cell.dgrid-cell-padding"+(C?".dgrid-column-"+t.escapeCssIdentifier(C,"-"):"")+D.replace(/ +/g,"."))+"[role\x3d"+("th"===e?"columnheader":"gridcell")+
"]");D.columnId=C;p?(C=n(D,"!dgrid-cell-padding div.dgrid-cell-padding"),D.contents=C):C=D;if(q=y.colSpan)D.colSpan=q;if(q=y.rowSpan)D.rowSpan=q;c(C,y);k.appendChild(D)}}return d},left:function(e,c){e.element||(e=this.cell(e));return this.cell(this._move(e,-(c||1),"dgrid-cell"))},right:function(e,c){e.element||(e=this.cell(e));return this.cell(this._move(e,c||1,"dgrid-cell"))},renderRow:function(e,c){var f=this.createRowCells("td",function(b,d){var a=e;d.get?a=d.get(e):"field"in d&&"_item"!=d.field&&
(a=a[d.field]);d.renderCell?m(b,d.renderCell(e,a,b,c)):h.call(d,e,a,b,c)},c&&c.subRows,e);return n("div[role\x3drow]\x3e",f)},renderHeader:function(){var e=this,c=this.headerNode,f=c.childNodes.length;for(c.setAttribute("role","row");f--;)n(c.childNodes[f],"!");f=this.createRowCells("th",function(b,d){var a=d.headerNode=b;p&&(b=b.parentNode);var g=d.field;g&&(b.field=g);d.renderHeaderCell?m(a,d.renderHeaderCell(a)):("label"in d||d.field)&&a.appendChild(document.createTextNode("label"in d?d.label:
d.field));!1!==d.sortable&&g&&"_item"!=g&&(b.sortable=!0,b.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[f.id=this.id+"-header"]=this.columns;c.appendChild(f);this._sortListener&&this._sortListener.remove();this._sortListener=z(f,"click,keydown",function(b){if("click"==b.type||32==b.keyCode||!x("opera")&&13==b.keyCode){var d=b.target,a,g;do if(d.sortable){var l=[{attribute:a=d.field||d.columnId,descending:(g=e._sort[0])&&g.attribute==a&&!g.descending}];
a={bubbles:!0,cancelable:!0,grid:e,parentType:b.type,sort:l};z.emit(b.target,"dgrid-sort",a)&&(e._sortNode=d,e.set("sort",l));break}while((d=d.parentNode)&&d!=c)}})},resize:function(){var e=this.headerNode.firstChild,c=this.contentNode,f;this.inherited(arguments);if(!x("ie")||7<x("ie")&&!x("quirks"))c.style.width="",c&&e&&(f=e.offsetWidth)!=c.offsetWidth&&(c.style.width=f+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(e,
c){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(e){var c=this.columns,f;for(f in c){var b=c[f];if(b.field==e)return b.headerNode}},updateSortArrow:function(e,c){this._lastSortedArrow&&(n(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),n(this._lastSortedArrow,"!"),delete this._lastSortedArrow);c&&(this._sort=e);if(e[0]&&(c=e[0].attribute,e=e[0].descending,c=this._sortNode||this._findSortArrowParent(c),delete this._sortNode,c)){c=c.contents||
c;var f=this._lastSortedArrow=n("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]");f.innerHTML="\x26nbsp;";c.insertBefore(f,c.firstChild);n(c,e?".dgrid-sort-down":".dgrid-sort-up");this.resize()}},styleColumn:function(e,c){return this.addCssRule("#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+t.escapeCssIdentifier(e,"-"),c)},_configColumns:function(e,c){var f=[],b=c instanceof Array;t.each(c,function(d,a){"string"==typeof d&&(c[a]=d={label:d});b||d.field||(d.field=a);a=d.id=d.id||
(isNaN(a)?a:e+a);this._configColumn&&(this._configColumn(d,a,c,e),a=d.id);b&&(this.columns[a]=d);d.grid=this;"function"===typeof d.init&&d.init();f.push(d)},this);return b?c:f},_destroyColumns:function(){var e=this.subRows,c=e&&e.length,f,b;this.cleanup();for(f=0;f<c;f++){var d=0;for(b=e[f].length;d<b;d++){var a=e[f][d];"function"===typeof a.destroy&&a.destroy()}}},configStructure:function(){var e=this.subRows,c=this._columns=this.columns;this.columns=!c||c instanceof Array?{}:c;if(e)for(c=0;c<e.length;c++)e[c]=
this._configColumns(c+"-",e[c]);else this.subRows=[this._configColumns("",c)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(e){this._destroyColumns();this.subRows=null;this.columns=e;this._updateColumns()},_setSubRows:function(e){this._destroyColumns();this.subRows=e;this._updateColumns()},setColumns:function(e){F.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",e)},setSubRows:function(e){F.deprecated("setSubRows(...)",
'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",e)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});r.appendIfNode=m;r.defaultRenderCell=h;return r})},"put-selector/put":function(){(function(F){var r,z=/[-+,> ]/;F([],r=function(x,n){function v(e){function c(){g&&a&&g!=a&&(a==e&&(f||(f=z.test(u)&&
x.createDocumentFragment()))?f:a).insertBefore(g,d||null)}for(var f,b,d,a,g,l=arguments,q=l[0],A=0;A<l.length;A++){var u=l[A];if("object"==typeof u){b=!1;if(u instanceof Array){g=x.createDocumentFragment();for(var k=0;k<u.length;k++)g.appendChild(v(u[k]));u=g}if(u.nodeType)g=u,c(),a=u,d=0;else for(k in u)g[k]=u[k]}else if(b)b=!1,g.appendChild(x.createTextNode(u));else{1>A&&(e=null);b=!0;if(q=u.replace(t,function(w,y,C,D,G,H){y&&(c(),"-"==y||"+"==y?(a=(d=g||a).parentNode,g=null,"+"==y&&(d=d.nextSibling)):
("\x3c"==y?a=g=(g||a).parentNode:(","==y?a=e:g&&(a=g),g=null),d=0),g&&(a=g));if((w=!C&&D)||!g&&(C||G))"$"==w?(w=l[++A],a.appendChild(x.createTextNode(w))):(w=w||v.defaultTag,(y=p&&l[A+1]&&l[A+1].name)&&(w="\x3c"+w+' name\x3d"'+y+'"\x3e'),g=h&&~(m=w.indexOf("|"))?x.createElementNS(h[w.slice(0,m)],w.slice(m+1)):x.createElement(w));if(C)if("$"==D&&(D=l[++A]),"#"==C)g.id=D;else if(y=(w=g.className)&&(" "+w+" ").replace(" "+D+" "," "),"."==C)g.className=w?(y+D).substring(1):D;else if("!"==u){var L;p?v("div",
g,"\x3c").innerHTML="":(L=g.parentNode)&&L.removeChild(g)}else y=y.substring(1,y.length-1),y!=w&&(g.className=y);G&&("$"==H&&(H=l[++A]),"style"==G?g.style.cssText=H:(C="!"==G.charAt(0)?(G=G.substring(1))&&"removeAttribute":"setAttribute",H=""===H?G:H,h&&~(m=G.indexOf("|"))?g[C+"NS"](h[G.slice(0,m)],G.slice(m+1),H):g[C](G,H)));return""}))throw new SyntaxError("Unexpected char "+q+" in "+u);c();a=q=g||a}}e&&f&&e.appendChild(f);return q}z=n||z;var t=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,
m,h=!1;x=x||document;var p="object"==typeof x.createElement;v.addNamespace=function(e,c){x.createElementNS?(h||(h={}))[e]=c:x.namespaces.add(e,c)};v.defaultTag="div";v.forDocument=r;return v})})(function(F,r,z){z=z||r;"function"===typeof define?define([],function(){return z()}):"undefined"==typeof window?require("./node-html")(module,z):put=z()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/query dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),
function(F,r,z,x,n,v,t,m,h,p){function e(k,w){return n("#"+t.escapeCssIdentifier(k),w)[0]}function c(k,w){p(document.body,k,".dgrid-scrollbar-measure");w=k["offset"+w]-k["client"+w];k.className="";k.parentNode&&document.body.removeChild(k);return w}function f(k){var w=k?"."+k.replace(A,"."):"";this._class&&(w="!"+this._class.replace(A,"!")+w);p(this.domNode,w);this._class=k}function b(){return this._class}function d(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function a(k){"undefined"!==
typeof k.x&&(this.bodyNode.scrollLeft=k.x);"undefined"!==typeof k.y&&(this.bodyNode.scrollTop=k.y)}h("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var g,l;v.add("dom-scrollbar-width",function(k,w,y){return c(y,"Width")});v.add("dom-scrollbar-height",function(k,w,y){return c(y,"Height")});v.add("dom-rtl-scrollbar-left",function(k,w,y){k=p("div");p(document.body,y,".dgrid-scrollbar-measure[dir\x3drtl]");p(y,k);w=!!v("ie")||!!v("trident")||k.offsetLeft>=v("dom-scrollbar-width");
y.className="";y.parentNode&&document.body.removeChild(y);p(k,"!");y.removeAttribute("dir");return w});var q=0,A=/ +/g,u=7>v("ie")&&!v("quirks")?function(){if(this._started){var k=document.documentElement;var w=k.clientWidth;k=k.clientHeight;var y=this._prevWinDims||[];if(y[0]!==w||y[1]!==k)this.resize(),this._prevWinDims=[w,k]}}:function(){this._started&&this.resize()};return r("dgrid.List",v("touch")?m:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,
addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(k,w){var y=this;(this._Row=function(C,D,G){this.id=C;this.data=D;this.element=G}).prototype.remove=function(){y.removeRow(this.element)};w&&(this.srcNodeRef=w=w.nodeType?w:e(w));this.create(k,w)},listType:"list",create:function(k,w){w=this.domNode=w||p("div");if(k){this.params=k;r.safeMixin(this,k);var y=k["class"]||k.className||w.className;this._sort=k.sort||[];delete this.sort}else this._sort=
[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=w.id=w.id||this.id||"dgrid_"+q++;null===this.useTouchScroll&&(this.useTouchScroll=!v("dom-scrollbar-width"));this.buildRendering();y&&f.call(this,y);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var k=this.domNode,w=this.addUiClasses,y=this;var C=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||
document.body.style.direction).toLowerCase();k.className="";p(k,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(w?".ui-widget":""));var D=this.headerNode=p(k,"div.dgrid-header.dgrid-header-row"+(w?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(v("quirks")||8>v("ie"))&&p(k,"div.dgrid-spacer");var G=this.bodyNode=p(k,"div.dgrid-scroller");v("ff")&&(G.tabIndex=-1);this.headerScrollNode=p(k,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(w?".ui-widget-header":""));var H=
this.footerNode=p("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));p(k,H);C&&(k.className+=" dgrid-rtl"+(v("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));x(G,"scroll",function(L){y.showHeader&&(D.scrollLeft=L.scrollLeft||G.scrollLeft);L.stopPropagation();x.emit(k,"scroll",{scrollTarget:G})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=p(this.bodyNode,"div.dgrid-content"+(w?".ui-widget-content":""));this._listeners.push(this._resizeHandle=x(window,"resize",
t.throttleDelayed(u,this)))},postCreate:v("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var k=this.bodyNode,w=this.headerNode,y=this.footerNode,C=w.offsetHeight,D=this.showFooter?y.offsetHeight:0,G=v("quirks")||7>v("ie");this.headerScrollNode.style.height=k.style.marginTop=C+"px";k.style.marginBottom=
D+"px";G&&(k.style.height="",k.style.height=Math.max(this.domNode.offsetHeight-C-D,0)+"px",D&&(y.style.bottom="1px",setTimeout(function(){y.style.bottom=""},0)));g||(g=v("dom-scrollbar-width"),l=v("dom-scrollbar-height"),v("ie")&&(g++,l++),t.addCssRule(".dgrid-scrollbar-width","width: "+g+"px"),t.addCssRule(".dgrid-scrollbar-height","height: "+l+"px"),17==g||G||(t.addCssRule(".dgrid-header-row","right: "+g+"px"),t.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+g+"px")));G&&(w.style.width=
k.clientWidth+"px",setTimeout(function(){w.scrollLeft=k.scrollLeft},0))},addCssRule:function(k,w){k=t.addCssRule(k,w);this.cleanAddedRules&&this._listeners.push(k);return k},on:function(k,w){k=x(this.domNode,k,w);v("dom-addeventlistener")||this._listeners.push(k);return k},cleanup:function(){var k=this.observers,w;for(w in this._rowIdToObject)if(this._rowIdToObject[w]!=this.columns){var y=e(w,this.domNode);y&&this.removeRow(y,!0)}for(w=0;w<k.length;w++)(y=k[w])&&y.cancel();this.observers=[];this._numObservers=
0;this.preload=null},destroy:function(){if(this._listeners){for(var k=this._listeners.length;k--;)this._listeners[k].remove();delete this._listeners}this._started=!1;this.cleanup();p(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(k,w,y,C,D){if(w){var G=this.insertRow(k,w,y,C,D);p(G,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":
""));setTimeout(function(){p(G,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return G}},adjustRowIndices:function(k){var w=k.rowIndex;if(-1<w){do-1<k.rowIndex&&(this.maintainOddEven&&-1<(k.className+" ").indexOf("dgrid-row ")&&p(k,"."+(1==w%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==w%2?"dgrid-row-odd":"dgrid-row-even")),k.rowIndex=w++);while((k=k.nextSibling)&&k.rowIndex!=w)}},renderArray:function(k,w,y){function C(){var na=arguments;if(-1<P)for(var va=0;va<na.length;va++){var ja=
na[va],pa=ca[ja?0:ca.length-1];if(pa=pa&&D(pa)){var la=pa[ja?"previousSibling":"nextSibling"];la&&(la=L.row(la));la&&la.element!=pa&&(ja=ja?"unshift":"push",k[ja](la.data),ca[ja](la.element),y.count++)}}}function D(na){return!z.isDescendant(na,L.domNode)&&e(na.id)?L.row(na.id.slice(L.id.length+5)).element:na}function G(na){U=L.insertRow(na,Q,null,T++,y);U.observerIndex=P;return U}function H(na){Y=na.slice(0);(O=w?w.parentNode:L.contentNode)&&O.parentNode&&(O!==L.contentNode||na.length)?(O.insertBefore(Q,
w||null),(U=na[na.length-1])&&L.adjustRowIndices(U)):K[P]&&L.cleanEmptyObservers&&L._onEmptyRender(P);ca=na;I&&(I.rows=ca)}y=y||{};var L=this,T=y.start||0,K=this.observers,O;w||(this._lastCollection=k);if(k.observe&&this.shouldObserveStore){L._numObservers++;var I=k.observe(function(na,va,ja){var pa;if(-1<va&&ca[va]){var la=ca.splice(va,1)[0];la.parentNode==O&&((pa=la.nextSibling)&&va!=ja&&pa.rowIndex--,L.removeRow(la));y.count--;L._processScroll&&L._processScroll()}if(-1<ja){if(ca.length)if(0===
ja)var ra=(ra=ca[ja])&&D(ra);else{if(ra=ca[ja-1])ra=D(ra),ra=(ra.connected||ra).nextSibling}else ra=L._getFirstRowSibling&&L._getFirstRowSibling(O);la&&ra&&la.id===ra.id&&(ra=(ra.connected||ra).nextSibling);ra&&!ra.parentNode&&(ra=e(ra.id));la=w&&w.parentNode||ra&&ra.parentNode||L.contentNode;if(la=L.newRow(na,la,ra,y.start+ja,y))if(la.observerIndex=P,ca.splice(ja,0,la),!pa||ja<va)pa=(pa=la.previousSibling)&&pa.rowIndex+1!=la.rowIndex&&0!=la.rowIndex?pa:la;y.count++}0===va?C(1,1):va===k.length-(-1===
ja?0:1)&&C(0,0);va!=ja&&pa&&L.adjustRowIndices(pa);L._onNotification(ca,na,va,ja)},!0);var P=K.push(I)-1}var Q=document.createDocumentFragment(),U,Y;if(k.map){var ca=k.map(G,console.error);if(ca.then)return k.then(function(na){k=na;return ca.then(function(va){H(va);C(1,1,0,0);return Y})})}else{ca=[];for(var da=0,ma=k.length;da<ma;da++)ca[da]=G(k[da])}H(ca);C(1,1,0,0);return Y},_onEmptyRender:function(k){"undefined"!==typeof k&&(this.observers[k].cancel(),this.observers[k]=0,this._numObservers--)},
_onNotification:function(k,w,y,C){},renderHeader:function(){},_autoId:0,insertRow:function(k,w,y,C,D){var G=D.parentId;G=this.id+"-row-"+(G?G+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(k):this._autoId++);var H=e(G,this.domNode),L=H&&H.previousSibling;H&&(H===y&&(y=(y.connected||y).nextSibling),this.removeRow(H));H=this.renderRow(k,D);H.className=(H.className||"")+" dgrid-row "+(1==C%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[H.id=
G]=k;w.insertBefore(H,y||null);L&&this.adjustRowIndices(L);H.rowIndex=C;return H},renderRow:function(k,w){return p("div",""+k)},removeRow:function(k,w){k=k.element||k;delete this._rowIdToObject[k.id];w||p(k,"!")},row:function(k){var w;if(k instanceof this._Row)return k;k.target&&k.target.nodeType&&(k=k.target);if(k.nodeType){do{var y=k.id;if(w=this._rowIdToObject[y])return new this._Row(y.substring(this.id.length+5),w,k);k=k.parentNode}while(k&&k!=this.domNode)}else return"object"==typeof k?w=this.store.getIdentity(k):
(w=k,k=this._rowIdToObject[this.id+"-row-"+w]),new this._Row(w,k,e(this.id+"-row-"+w,this.domNode))},cell:function(k){return{row:this.row(k)}},_move:function(k,w,y,C){var D;var G=D=k.element;w=w||1;do if(k=D[0>w?"previousSibling":"nextSibling"]){do if((D=k)&&-1<(D.className+" ").indexOf(y+" ")){G=D;w+=0>w?1:-1;break}while(k=(!C||!D.hidden)&&D[0>w?"lastChild":"firstChild"])}else if(D=D.parentNode,!D||D===this.bodyNode||D===this.headerNode)break;while(w);return G},up:function(k,w,y){k.element||(k=this.row(k));
return this.row(this._move(k,-(w||1),"dgrid-row",y))},down:function(k,w,y){k.element||(k=this.row(k));return this.row(this._move(k,w||1,"dgrid-row",y))},scrollTo:v("touch")?function(k){return this.useTouchScroll?this.inherited(arguments):a.call(this,k)}:a,getScrollPosition:v("touch")?function(){return this.useTouchScroll?this.inherited(arguments):d.call(this)}:d,get:function(k){var w="_get"+k.charAt(0).toUpperCase()+k.slice(1);return"function"===typeof this[w]?this[w].apply(this,[].slice.call(arguments,
1)):this[k]},set:function(k,w){if("object"===typeof k)for(var y in k)this.set(y,k[y]);else y="_set"+k.charAt(0).toUpperCase()+k.slice(1),"function"===typeof this[y]?this[y].apply(this,[].slice.call(arguments,1)):this[k]=w;return this},_getClass:b,_setClass:f,_getClassName:b,_setClassName:f,_setSort:function(k,w){this._sort="string"!=typeof k?k:[{attribute:k,descending:w}];this.refresh();this._lastCollection&&(k.length&&("string"!=typeof k&&(w=k[0].descending,k=k[0].attribute),this._lastCollection.sort(function(y,
C){y=y[k];C=C[k];void 0===y&&(y="");void 0===C&&(C="");return y==C?0:y>C==!w?1:-1})),this.renderArray(this._lastCollection))},sort:function(k,w){F.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",k,w)},_getSort:function(){return this._sort},_setShowHeader:function(k){var w=this.headerNode;this.showHeader=k;p(w,(k?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();k&&(w.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(k){F.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",k)},_setShowFooter:function(k){this.showFooter=k;p(this.footerNode,(k?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has"],function(F){F.add("dom-contains",function(p,e,c){return!!c.contains});var r=[],z,x,n,v=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,t=setTimeout,m=clearTimeout;F.add("requestidlecallback",function(p){return"function"===typeof p.requestIdleCallback});var h={defaultDelay:15,
throttle:function(p,e,c){var f=!1;c=c||h.defaultDelay;return function(){f||(f=!0,p.apply(e,arguments),t(function(){f=!1},c))}},throttleDelayed:function(p,e,c){var f=!1;c=c||h.defaultDelay;return function(){if(!f){f=!0;var b=arguments;t(function(){f=!1;p.apply(e,b)},c)}}},debounce:function(p,e,c){var f;c=c||h.defaultDelay;return function(){f&&(m(f),f=null);var b=arguments;f=t(function(){f=null;p.apply(e,b)},c)}},each:function(p,e,c){var f;if(p)if("number"===typeof p.length){var b=0;for(f=p.length;b<
f;b++)e.call(c,p[b],b,p)}else for(b in p)e.call(c,p[b],b,p)},contains:function(p,e){return F("dom-contains")?p.contains(e):p.compareDocumentPosition(e)&8},addCssRule:function(p,e){z||(z=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(z),z=z.sheet||z.styleSheet,x=z.deleteRule?"deleteRule":"removeRule",n=z.cssRules?"cssRules":"rules");var c=r.length;r[c]=(z.cssRules||z.rules).length;z.addRule?z.addRule(p,e):z.insertRule(p+"{"+e+"}",r[c]);return{get:function(f){return z[n][r[c]].style[f]},
set:function(f,b){"undefined"!==typeof r[c]&&(z[n][r[c]].style[f]=b)},remove:function(){var f=r[c],b;if(void 0!==f){z[x](f);r[c]=void 0;var d=c+1;for(b=r.length;d<b;d++)r[d]>f&&r[d]--}}}},escapeCssIdentifier:function(p,e){return"string"===typeof p?p.replace(v,e||"\\$1"):p}};return h})},"xstyle/has-class":function(){define(["dojo/has"],function(F){var r={};return function(){for(var z,x=arguments,n=0;n<x.length;n++)if(z=x[n],!r[z]){r[z]=!0;var v=z.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),t=F(v[2]),
m=-v[4];(0<m?m<=t&&(-v[5]||m)>=t:!!t)==!v[1]&&(document.documentElement.className+=" has-"+z)}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(F,r,z,x,n,v,t,m,h){return z("dgrid.OnDemandList",[F,r],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:m.defaultDelay,keepScrollPosition:!1,
rowHeight:22,postCreate:function(){this.inherited(arguments);var p=this;t(this.bodyNode,"scroll",m[this.pagingMethod](function(e){p._processScroll(e)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(p,e){function c(u){h(A,"!");if(u)throw f._refreshDeferred&&(f._refreshDeferred.reject(u),delete f._refreshDeferred),u;}var f=this,b=e&&e.container||this.contentNode,d={query:p,count:0,options:e},a,g=this.preload,
l,q={node:h(b,"div.dgrid-preload",{rowIndex:0}),count:0,query:p,next:d,options:e};q.node.style.height="0";d.node=a=h(b,"div.dgrid-preload");d.previous=q;a.rowIndex=this.minRowsPerPage;g?((d.next=g.next)&&a.offsetTop>=g.node.offsetTop?d.previous=g:(d.next=g,d.previous=g.previous),d.previous.next=d,d.next.previous=d):this.preload=d;var A=h(a,"-div.dgrid-loading");h(A,"div.dgrid-below").innerHTML=this.loadingMessage;e=x.mixin(this.get("queryOptions"),e,{start:0,count:this.minRowsPerPage},"level"in p?
{queryLevel:p.level}:null);this._trackError(function(){return l=p(e)});if("undefined"===typeof l)c();else return n.when(f.renderArray(l,a,e),function(u){return n.when("undefined"===typeof l.total?l.length:l.total,function(k){var w=u.length,y=a.parentNode,C=f.noDataNode;h(A,"!");"queryLevel"in e||(f._total=k);0===k&&y&&(C&&(h(C,"!"),delete f.noDataNode),f.noDataNode=C=h("div.dgrid-no-data"),y.insertBefore(C,f._getFirstRowSibling(y)),C.innerHTML=f.noDataMessage);for(var D=C=0;D<w;D++)C+=f._calcRowHeight(u[D]);
w&&C&&(f.rowHeight=C/w);C=f.rowHeight*f.bufferRows;C>f.farOffRemoval&&(f.farOffRemoval=C);k-=w;d.count=k;a.rowIndex=w;k?a.style.height=Math.min(k*f.rowHeight,f.maxEmptySpace)+"px":(a.style.display="none",e.count++);f._previousScrollPosition&&y&&y.offsetHeight&&(f.scrollTo(f._previousScrollPosition),delete f._previousScrollPosition);f._processScroll();f._refreshDeferred&&(f._refreshDeferred.resolve(l),delete f._refreshDeferred);return u},c)},c),l},refresh:function(p){var e=this,c=p&&p.keepScrollPosition;
"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store){c=this._refreshDeferred=new n;var f=e.renderQuery(function(b){return e.store.query(e.query,b)});"undefined"===typeof f&&c.reject();return c.then(function(b){e._refreshTimeout=setTimeout(function(){t.emit(e.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:e,results:b});e._refreshTimeout=null},0);delete e._refreshDeferred;return b},function(b){delete e._refreshDeferred;
throw b;})}},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(p){return p.lastChild},_calcRowHeight:function(p){var e=p.nextSibling;return e&&!/\bdgrid-preload\b/.test(e.className)?e.offsetTop-p.offsetTop:p.offsetHeight},lastScrollTop:0,_processScroll:function(p){function e(Q,U,Y,ca){var da=b.farOffRemoval,ma=Q.node;if(U>2*da){for(var na,va=ma[Y],ja=0,pa=0,la=[];na=va;){var ra=b._calcRowHeight(na);if(ja+ra+da>U||0>va.className.indexOf("dgrid-row")&&0>
va.className.indexOf("dgrid-loading"))break;va=na[Y];ja+=ra;pa+=na.count||1;b.removeRow(na,!0);la.push(na)}Q.count+=pa;ca?(ma.rowIndex-=pa,c(Q)):ma.style.height=ma.offsetHeight+ja+"px";var X=h("div",la);setTimeout(function(){h(X,"!")},1)}}function c(Q,U){Q.node.style.height=Math.min(Q.count*b.rowHeight,U?Infinity:b.maxEmptySpace)+"px"}function f(Q,U){do Q=U?Q.next:Q.previous;while(Q&&!Q.node.offsetWidth);return Q}var b=this,d=b.bodyNode;p=p&&p.scrollTop||this.getScrollPosition().y;d=d.offsetHeight+
p;var a=b.preload,g=b.lastScrollTop,l=b.bufferRows*b.rowHeight,q=l-b.rowHeight,A,u,k,w=!0;for(b.lastScrollTop=p;a&&!a.node.offsetWidth;)a=a.previous;for(;a&&a!=y;){var y=b.preload;b.preload=a;var C=a.node;var D=C.offsetTop;if(d+1+q<D)a=f(a,w=!1);else if(p-1-q>D+C.offsetHeight)a=f(a,w=!0);else{var G=((C.rowIndex?p-l:d)-D)/b.rowHeight;D=(d-p+2*l)/b.rowHeight;D+=Math.min(Math.abs(Math.max(Math.min((p-g)*b.rowHeight,b.maxRowsPerPage/2),b.maxRowsPerPage/-2)),10);0==C.rowIndex&&(G-=D);G=Math.max(G,0);10>
G&&0<G&&D+G<b.maxRowsPerPage&&(D+=Math.max(0,G),G=0);D=Math.min(Math.max(D,b.minRowsPerPage),b.maxRowsPerPage,a.count);if(0==D)a=f(a,w);else{D=Math.ceil(D);G=Math.min(Math.floor(G),a.count-D);var H=x.mixin(b.get("queryOptions"),a.options);a.count-=D;var L=C,T=b.queryRowsOverlap,K=(0<C.rowIndex||C.offsetTop>p)&&a;if(K){var O=a.previous;O&&(e(O,p-(O.node.offsetTop+O.node.offsetHeight),"nextSibling"),0<G&&O.node==C.previousSibling?(G=Math.min(a.count,G),a.previous.count+=G,c(a.previous,!0),C.rowIndex+=
G,T=0):D+=G,a.count-=G);H.start=C.rowIndex-T;H.count=Math.min(D+T,b.maxRowsPerPage);C.rowIndex=H.start+H.count}else{if(a.next)if(e(a.next,a.next.node.offsetTop-d,"previousSibling",!0),L=C.nextSibling,L==a.next.node)a.next.count+=a.count-G,a.next.node.rowIndex=G+D,c(a.next),a.count=G,T=0;else var I=!0;H.start=a.count;H.count=Math.min(D+T,b.maxRowsPerPage)}I&&L&&L.offsetWidth&&(I=L.offsetTop);c(a);"level"in a.query&&(H.queryLevel=a.query.level);if("queryLevel"in H||!(H.start>b._total||0>H.count)){C=
h(L,"-div.dgrid-loading[style\x3dheight:"+D*b.rowHeight+"px]");h(C,"div.dgrid-"+(K?"below":"above")).innerHTML=b.loadingMessage;C.count=D;var P=a.query(H);if(void 0===b._trackError(function(){return P})){h(C,"!");return}(function(Q,U,Y,ca){k=n.when(b.renderArray(ca,Q,H),function(da){u=ca;L=Q.nextSibling;h(Q,"!");if(Y&&L&&L.offsetWidth){var ma=b.getScrollPosition();b.scrollTo({x:ma.x,y:ma.y+L.offsetTop-Y,preserveMomentum:!0})}n.when(ca.total||ca.length,function(na){"queryLevel"in H||(b._total=na);
U&&(U.count=na-U.node.rowIndex,0===U.count&&H.count++,c(U))});b._processScroll();return da},function(da){h(Q,"!");throw da;})}).call(this,C,K,I,P);a=a.previous}}}}k&&(A=this._refreshDeferred)&&(delete this._refreshDeferred,n.when(k,function(){A.resolve(u)}))},removeRow:function(p,e){if(p){var c=p.previousSibling,f=p.nextSibling,b;if(b=c)b=c.observerIndex,b=null!=b?b:c.previousObserverIndex;c=b;if(b=f)b=f.observerIndex,b=null!=b?b:f.nextObserverIndex;f=p.observerIndex;p.observerIndex=void 0;e&&(p.nextObserverIndex=
b,p.previousObserverIndex=c);if(this.cleanEmptyObservers&&-1<f&&f!==c&&f!==b&&(c=this.observers,b=c[f])){if(!e)for(var d=b.rows,a=0;a<d.length;a++)if(d[a]!=p&&v.isDescendant(d[a],this.domNode))return this.inherited(arguments);b.cancel();this._numObservers--;c[f]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(F,r,z,x,n,v,t){function m(p){return p}
function h(p){if("object"!==typeof p)p=Error(p);else if("cancel"===p.dojoType)return;p.grid=this;n.emit(this.domNode,"dgrid-error",{grid:this,error:p,cancelable:!0,bubbles:!0})&&console.error(p)}return r("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};v.before(this,"configStructure",z.hitch(this,function(){this._columnsWithSet=
{}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(p){p.set&&(this._columnsWithSet[p.field]=p);this.inherited(arguments)},_updateNotifyHandle:function(p){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);p&&"function"===typeof p.notify&&this.shouldObserveStore&&(this._notifyHandle=v.after(p,"notify",z.hitch(this,
"_onNotify"),!0),(p=this.get("sort"))&&p.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(p,e,c){this._updateNotifyHandle(p);this.store=p;this.dirty={};this.set("query",e,c)},_setQuery:function(p,e){var c=e&&e.sort;this.query=void 0!==p?p:this.query;this.queryOptions=e||this.queryOptions;this._started&&(c?this.set("sort",c):this.refresh())},
setStore:function(p,e,c){F.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",p,e,c)},setQuery:function(p,e){F.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",p,e)},_getQueryOptions:function(){var p=z.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)p.sort=this._sort;return p},_getQuery:function(){var p=this.query;return"object"==typeof p&&null!=p?z.delegate(p,{}):p},_setSort:function(p,
e){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(p,e){this.inherited(arguments);p&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var p=this.inherited(arguments);this.store||(this.noDataNode=t(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return p},renderArray:function(){var p=this,e=this.inherited(arguments);this.store||x.when(e,function(c){c.length&&p.noDataNode&&t(p.noDataNode,"!")});
return e},_onEmptyRender:function(){},insertRow:function(p,e,c,f,b){var d=this.store,a=this.dirty;d=d&&d.getIdentity(p);var g;d in a&&!(d in this._updating)&&(g=a[d]);g&&(p=z.delegate(p,g));return this.inherited(arguments)},updateDirty:function(p,e,c){var f=this.dirty,b=f[p];b||(b=f[p]={});b[e]=c},setDirty:function(p,e,c){F.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(p,e,c)},save:function(){function p(q,A){return function(u){var k=e._columnsWithSet,w=e._updating,
y;if("function"===typeof u.set)u.set(A);else for(y in A)u[y]=A[y];for(y in k){var C=k[y].set(u);void 0!==C&&(u[y]=C)}w[q]=!0;return x.when(c.put(u),function(){delete f[q];delete w[q]})}}var e=this,c=this.store,f=this.dirty,b=new x,d=b.promise,a=function(q){var A;return e.getBeforePut||!(A=e.row(q).data)?function(){return c.get(q)}:function(){return A}},g;for(g in f){var l=p(g,f[g]);d=d.then(a(g)).then(l)}b.resolve();return d},revert:function(){this.dirty={};this.refresh()},_trackError:function(p){"string"==
typeof p&&(p=z.hitch(this,p));try{var e=p()}catch(c){h.call(this,c)}return x.when(e,m,z.hitch(this,h))},newRow:function(){var p=this.inherited(arguments);this.noDataNode&&(t(this.noDataNode,"!"),delete this.noDataNode);return p},removeRow:function(p,e){var c={element:p};!e&&this.noDataMessage&&this.up(c).element===p&&this.down(c).element===p&&(this.noDataNode=t(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/mouse dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(F,r,z,x,n,v,t,m,h,p){function e(l,q){q=l.unselectable=q?"on":"";l=l.getElementsByTagName("*");for(var A=l.length;--A;)"INPUT"!==l[A].tagName&&"TEXTAREA"!==l[A].tagName&&(l[A].unselectable=q)}function c(l,q){var A=l.bodyNode,u=q?"text":21>n("ff")?"-moz-none":"none";b&&"msUserSelect"!==b?A.style[b]=u:n("dom-selectstart")?q||l._selectstartHandle?q&&l._selectstartHandle&&(l._selectstartHandle.remove(),delete l._selectstartHandle):l._selectstartHandle=x(A,"selectstart",function(k){var w=k.target&&
k.target.tagName;"INPUT"!==w&&"TEXTAREA"!==w&&k.preventDefault()}):(e(A,!q),q||l._unselectableHandle)?q&&l._unselectableHandle&&(l._unselectableHandle.remove(),delete l._unselectableHandle):l._unselectableHandle=t.after(l,"renderRow",function(k){e(k,!0);return k})}n.add("dom-comparedocumentposition",function(l,q,A){return!!A.compareDocumentPosition});n.add("pointer",function(l){return"PointerEvent"in l?"pointer":"MSPointerEvent"in l?"MSPointer":!1});n.add("css-user-select",function(l,q,A){l=A.style;
q=["Khtml","O","ms","Moz","Webkit"];A=q.length;var u="userSelect";do if("undefined"!==typeof l[u])return u;while(A--&&(u=q[A]+"UserSelect"));return!1});n.add("dom-selectstart","undefined"!==typeof document.onselectstart);var f=n("mac")?"metaKey":"ctrlKey",b=n("css-user-select"),d=(m=n("pointer"))&&"MS"===m.slice(0,2),a=m?m+(d?"Down":"down"):"mousedown",g=m?m+(d?"Up":"up"):"mouseup";"WebkitUserSelect"===b&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(b=!1);return r("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:a+","+g+",dgrid-cellfocusin",selectionTouchEvents:n("touch")?h.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var l=this.selectionMode;this.selectionMode="";this._setSelectionMode(l)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(l){l!=this.selectionMode&&(this.clearSelection(),this.selectionMode=l,this._selectionHandlerName="_"+l+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(l){F.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",l)},_setAllowTextSelection:function(l){"undefined"!==typeof l?c(this,l):c(this,"none"===this.selectionMode);this.allowTextSelection=l},_handleSelect:function(l,q){if(!v.isRight(l)&&this[this._selectionHandlerName]&&this.allowSelect(this.row(q))&&("dgrid-cellfocusin"!==l.type||"mousedown"!==l.parentType)&&(l.type!==g||q==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=l;if(!l.keyCode||!l.ctrlKey||32==l.keyCode)if(!l.shiftKey&&l.type===a&&this.isSelected(q))this._waitForMouseUp=
q;else this[this._selectionHandlerName](l,q);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(l,q){l=l.keyCode?l.ctrlKey:l[f];this._lastSelected===q?this.select(q,null,!l||!this.isSelected(q)):(this.clearSelection(),this.select(q),this._lastSelected=q)},_multipleSelectionHandler:function(l,q){var A=this._lastSelected,u=l.keyCode?l.ctrlKey:l[f];if(!l.shiftKey){var k=u?null:!0;A=null}this.select(q,A,k);A||(this._lastSelected=q)},_extendedSelectionHandler:function(l,q){if(l[f]||!this.isSelected(q)||
1!==this.getSelectedCount())(2===l.button?this.isSelected(q):l.keyCode?l.ctrlKey:l[f])||this.clearSelection(null,!0),this._multipleSelectionHandler(l,q)},_toggleSelectionHandler:function(l,q){this.select(q,null,null)},_initSelectionEvents:function(){var l=this,q=this.contentNode,A=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};n("touch")&&!n("pointer")&&this.selectionTouchEvents?(x(q,h.selector(A,this.selectionTouchEvents),function(u){l._handleSelect(u,this);l._ignoreMouseSelect=
this}),x(q,x.selector(A,this.selectionEvents),function(u){l._ignoreMouseSelect!==this?l._handleSelect(u,this):u.type===g&&(l._ignoreMouseSelect=null)})):x(q,x.selector(A,this.selectionEvents),function(u){l._handleSelect(u,this)});this.addKeyHandler&&this.addKeyHandler(32,function(u){l._handleSelect(u,u.target)});if(this.allowSelectAll)this.on("keydown",function(u){u[f]&&65==u.keyCode&&!/\bdgrid-input\b/.test(u.target.className)&&(u.preventDefault(),l[l.allSelected?"clearSelection":"selectAll"]())});
this._setStore&&t.after(this,"_setStore",function(){l._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function l(w,y,C){w=y||w&&w[q.idProperty||"id"];if(null!=w&&(y=(w=q.row(w))&&q.selection[w.id]))q[C](w,null,y)}var q=this,A=this.store;this._removeDeselectSignals&&this._removeDeselectSignals();if(A&&A.notify){var u=t.before(A,"notify",function(w,y){w||l(w,y,"deselect")});var k=t.after(A,"notify",function(w,y){l(w,y,"select")},!0);this._removeDeselectSignals=
function(){u.remove();k.remove()}}else u=t.before(this,"removeRow",function(w,y){y||(w=this.row(w))&&w.id in this.selection&&this.deselect(w)}),this._removeDeselectSignals=function(){u.remove()}},allowSelect:function(l){return!0},_fireSelectionEvent:function(l){var q=this._selectionEventQueues[l],A=this._selectionTriggerEvent;var u={bubbles:!0,grid:this};A&&(u.parentType=A.type);u[this._selectionTargetType]=q;this._selectionEventQueues[l]=[];x.emit(this.contentNode,"dgrid-"+l,u)},_fireSelectionEvents:function(){var l=
this._selectionEventQueues,q;for(q in l)l[q].length&&this._fireSelectionEvent(q)},_select:function(l,q,A){"undefined"===typeof A&&(A=!0);l.element||(l=this.row(l));if(!1===A||this.allowSelect(l)){var u=this.selection;var k=!!u[l.id];null===A&&(A=!k);var w=l.element;A||this.allSelected?u[l.id]=A:delete this.selection[l.id];w&&(A?p(w,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):p(w,"!dgrid-selected!ui-state-active"));A!==k&&w&&this._selectionEventQueues[(A?"":"de")+"select"].push(l);
if(q)if(q.element||(q=this.row(q)),q){if(q=q.element)for(u=this._determineSelectionDirection(w,q),u||(q=document.getElementById(q.id),u=this._determineSelectionDirection(w,q));l.element!=q&&(l=this[u](l));)this._select(l,null,A)}else this._lastSelected=w,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:n("dom-comparedocumentposition")?function(l,q){l=q.compareDocumentPosition(l);return l&1?!1:2===l?"down":"up"}:function(l,q){return 1>q.sourceIndex?!1:q.sourceIndex>l.sourceIndex?"down":"up"},select:function(l,q,A){this._select(l,q,A);this._fireSelectionEvents()},deselect:function(l,q){this.select(l,q,!1)},clearSelection:function(l,q){this.allSelected=!1;for(var A in this.selection)l!==A&&this._select(A,null,!1);q||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var l in this._rowIdToObject){var q=this.row(this._rowIdToObject[l]);this._select(q.id,null,!0)}this._fireSelectionEvents()},getSelectedCount:function(){var l=0,q;for(q in this.selection)q&&(l+=1);return l},isSelected:function(l){if("undefined"===typeof l||null===l)return!1;l.element||(l=this.row(l));return l.id in this.selection?!!this.selection[l.id]:this.allSelected&&(!l.data||this.allowSelect(l))},refresh:function(){this.deselectOnRefresh&&
this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var l=this,q=this.inherited(arguments);z.when(q,function(A){var u=l.selection,k,w;for(k=0;k<A.length;k++){var y=l.row(A[k]);(w=y.id in u?u[y.id]:l.allSelected)&&l._select(y,null,w)}l._fireSelectionEvents()});return q}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(F,r,z,x,n){function v(p){p=
document.getElementsByTagName(p);for(var e=0;e<p.length;e++)m(p[e])}function t(){v("link");v("style")}function m(p,e,c){function f(){F(["xstyle/core/load-imports"],function(A){A(p,function(){m(p,e,!0)})})}function b(A){for(var u=A.cssRules,k=0;k<u.length;k++){var w=u[k];if(w.selectorText&&"x-"==w.selectorText.substring(0,2)&&(a=!0,/^'/.test(w.style.content)))return h(eval(w.style.content),A,e),!0}}var d=p.sheet||p.styleSheet;if(d&&(!d.processed||c)){d.processed=!0;var a=d.needsParsing,g=d.rules||
d.cssRules;if((d.href||d.imports&&d.imports.length)&&!c)return f();if(!a)for(var l=0;l<g.length;l++){var q=g[l];if(q.href&&!c){if(!b(q.styleSheet))return f();return}}h(d.localSource||(d.ownerNode||d.owningElement).innerHTML,d,e)}}function h(p,e,c){e.addRule||(e.addRule=function(b,d,a){return this.insertRule(b+"{"+d+"}",0<=a?a:this.cssRules.length)});e.deleteRule||(e.deleteRule=e.removeRule);var f=1;(e.href||location.href).replace(/[^\/]+$/,"");z.css=p;r(z,p,e);0==--f&&c&&c(e);return z}x.ready(t);
r.getStyleSheet=function(p,e){return p.styleSheet||p};return{process:m,processAll:t,parse:h,generate:n,update:x.update,load:function(p,e,c,f){e(["xstyle/css"],function(b){b.load(p,e,function(d){d?m({sheet:d},c):(t(),c())},f)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function F(){this.push.apply(this,arguments)}function r(c){this.value=c}function z(){var c=this.args[0];if("string"==typeof c)var f=c.split(/\s*,\s*/);else if(c){f=[];for(var b=0,d=0;d<c.length+1;d++){var a=
c[d];if("string"==typeof a||void 0===a)if(a=a&&a.split(/\s*,\s*/),1<f.length||void 0===a){var g=c.slice(b,d);0<b&&g.unshift(f.pop());b=d+1;f.push(g);a&&f.push.apply(f,a.slice(1))}}}else return[];return f}function x(c,f,b){function d(q,A){function u(T){C=!1;var K=g.lastIndex;T.then(function(){C=!0;O&&(g.lastIndex=K,k())});var O=!0}function k(){function T(ya){ya&&"string"==typeof ya&&I&&(ya=I+ya);ma?ma.push?"string"==typeof ma[ma.length-1]&&"string"==typeof ya?ma[ma.length-1]+=ya:ya&&ma.push(ya):"string"==
typeof ma&&"string"==typeof ya?ma+=ya:ma=new F(ma,ya):ma=ya}for(C=!0;C;){var K=g.exec(q);if(!K)break;var O=K[5],I=K[1],P=K[2],Q=K[3],U=K[4];U=U&&p(U);P=P&&p(P);if(L){if(Q){var Y=P;var ca=Q.charAt(0);var da="?"==Q.charAt(1);-1<Q.indexOf("\n")&&(U=Q.slice(1))}else U=P;var ma=U;L=!1}else U=Q?P+Q:P,T(U);"{"!=O&&(H+=K[0]);switch(O){case "'":case '"':var na="'"==O?n:v;na.lastIndex=g.lastIndex;(O=na.exec(q))||w("unterminated string");P=O[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(ya,wa){if(wa)return String.fromCharCode(parseInt(wa,
16))});g.lastIndex=na.lastIndex;T(new r(P));H+=O[0];continue;case "\\":O=na.lastIndex++;T(q.charAt(O));continue;case "(":case "{":case "[":if("{"==O){L=!0;":"==ca&&Q&&(P+=Q);P&&I&&(P=I+P);H=p((H+P).replace(/\s+/g," "));T(Q=y.newRule(H));"\x3d"==ca&&(G=!1,ma.creating=!0);var va=null,ja=D;K[6]&&(U=A.cssRules||A.rules,Q.cssRule=va=U[K[6].slice(1)])&&(H=va.selectorText);if(y.root&&G)for(U=A.cssRules||A.rules;va=U[D++];)if(va.selectorText==H||va.selectorText&&va.selectorText.replace(/::/g,":").replace(/'/g,
'"')==H.replace(/::/g,":").replace(/'/g,'"')){Q.cssRule=va;break}va||(Q.ruleIndex=D=ja);Q.styleSheet=A;ma.creating?(Q.selector="."+("\x3d"==ca?P.match(/[\w-]*$/g,"")[0]:"")+"-x-"+h++,Q.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(H)?Q.setMediaSelector(H):Q.selector=y.root?H:y.selector+" "+H;H=""}else P=U.match(/(.*?)([\w-]*)$/),T(Q=y.newCall(P[2],ma,y)),Q.ref=y.getDefinition(P[2]),Q.getArgs=z,(ma.calls||(ma.calls=[])).push(Q);y.currentName=Y;y.currentSequence=ma;y.assignmentOperator=ca;var pa;
"{"==O&&(pa=Q.selector.match(/[@:]\w+/))&&(pa=pa[0],(Y=y.getDefinition(pa))&&Y.selector&&Y.selector(Q));l.push(y=Q);y.operator=O;y.start=g.lastIndex;ma=Y=null;continue}if(ma)if(P="string"==typeof ma?ma:ma[0],P.charAt&&"@"==P.charAt(0))if(K=P.match(/\w+/)[0],"import"==K)P=x.getStyleSheet((A.cssRules||A.imports)[D++],ma,A),K=g.lastIndex,d(P.localSource,P),g.lastIndex=K;else{if("xstyle"==K){if("start"==P.slice(8,13))Q=y?y.newRule(""):la,Q.root=y.root,l.push(y=Q);else{var la=y||la;l.pop();y=l[l.length-
1]}g=y?a:/(@[\w\s])/g}}else if("\x3d"===ca)try{var ra=y.declareDefinition(Y,ma,da);ra&&ra.then&&u(ra)}catch(ya){w(ya)}switch(O){case ":":"\x3d"==ca?(L=!0,ca=":"):T(":");break;case "}":if(Y&&!y.root&&!y.isMediaBlock)try{y[":"==ca?"setValue":"declareDefinition"](Y,ma,da)}catch(ya){w(ya)}case ")":case "]":m[y.operator]!=O&&w("Incorrect opening operator "+y.operator+" with closing operator "+O);Y=null;Y=q.slice(y.start,g.lastIndex-1);y.cssText=y.cssText?y.cssText+";"+Y:Y;if("}"==O){"}"==X&&(X=y.parent.selector)&&
"@"==!X.charAt(0)&&w("A nested rule must end with a semicolon");if(y.root)w("Unmatched "+O);else{try{y.onRule(y.selector,y)}catch(ya){w(ya)}G=!0}H=""}if(")"==O||"]"==O)y.args=[ma];if(")"==O&&!ca){try{ra=l[l.length-2].onArguments&&l[l.length-2].onArguments(y)}catch(ya){w(ya)}ra&&ra.then&&u(ra)}l.pop();y=l[l.length-1];ma=y.currentSequence;Y=y.currentName;ca=y.assignmentOperator;if(y.root&&"}"==O){if(ca)try{y[":"==ca?"setValue":"declareDefinition"](Y,ma,da)}catch(ya){w(ya)}L=!0;ca=!1}break;case "":case void 0:return;
case ";":if(y&&Y){try{(ra=y[":"==ca?"setValue":"declareDefinition"](Y,ma,da))&&ra.then&&u(ra)}catch(ya){w(ya)}Y}ma=null;L=!0;ca=G=!1;H=""}var X=O}}function w(T){var K=q.slice(0,g.lastIndex).split("\n"),O=K[K.length-1];K=(A.href||"in-page stylesheet")+":"+K.length+":"+O.length+" near:\n"+O.slice(-40);if(d.onerror)d.onerror(T,K);console.error(T.message||T,K);T.stack&&console.error(T.stack)}q=q.replace(t,function(T){return T.replace(/[^\n]/g,"")});var y=c;g.lastIndex=0;var C,D=0,G=!0,H="",L=!0;k()}b=
b||{addRule:function(){},cssRules:[]};var a,g=a=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,l=[c];c.parse=d;d(f,b)}var n=/((?:\\.|[^'])*)'/g,v=/((?:\\.|[^"])*)"/g,t=/\/\*[\w\W]*?\*\//g,m={"{":"}","[":"]","(":")"},h=0,p="".trim?function(c){return c.trim()}:function(c){return c.replace(/^\s+|\s+$/g,"")},e=F.prototype=[];e.toString=function(){return this.join("")};e.isSequence=!0;r.prototype.toString=
function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};r.prototype.isLiteralString=!0;return x})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),function(F,r,z,x,n,v,t){function m(q,A,u){function k(y){return{selectElement:function(C){u.newElement&&(C=C.parentNode);if(y&&y.selector)for(;!g(C,y);)if(C=C.parentNode,!C)throw Error("Rule not found");
if(u.inherit)for(;!(q in C);)if(C=C.parentNode,!C)throw Error(q?q+" not found":"Property was never defined");return C},forElement:function(C){var D=C;C=this.selectElement(C);u.newElement&&(C["_"+q+"Node"]=D);C=u.get?u.get(C,q):C[q];return void 0===C&&y?c(q).valueOf().forRule(y):C},forRule:u.inherit&&function(C){return k(C)}}}var w=new z(function(){return k(A)});w.define=function(y,C){return m(q||C,y,u)};w.keepCSSValue=!0;w.put=u.inherit?function(y,C){return c(q).put(y,C,q)}:function(y){return{forElement:function(C){if(A&&
A.selector)for(;!g(C,A);)if(C=C.parentNode,!C)throw Error("Rule not found");u.set?u.set(C,q,y):C[q]=y;w.invalidate({elements:[C]})}}};return w}function h(q,A,u,k){return x.when(r.evaluate(q,u),function(w){w.forElement?F.addRenderer(q,function(y){k(w.forElement(y),y)}):k(w)})}function p(q,A){return{apply:function(u,k,w){h(u,w,k[0],function(y,C){y.observe(function(D){D=D?q:A;value.toString().replace(new RegExp(q+"\\([^)]+\\)","g"),D);C?C.style[w]=D:u.setStyle(w,D)})})}}}function e(q,A){var u=q.variables;
if(u&&A in u)return u[A];if(q=q.bases)for(u=0;u<q.length;u++){var k=e(q[u],A);if(void 0!==k)return k}}function c(q){var A=l[q];A||(A=l[q]=new z(function(){return{forRule:function(u){a:{do{var k=e(u,q);if(void 0!==k){u=k;break a}u=u.parent}while(u);u=void 0}return u}}}),A.put=function(u,k,w){return{forRule:function(y){function C(G){D.push(G);for(var H in G.rules)C(G.rules[H])}(y.variables||(y.variables={}))[w]=u;for(var D=[];y;)C(y),y=y.parent;A.invalidate({rules:D})}}});return A}var f=n("div"),b=
navigator.userAgent,d=-1<b.indexOf("WebKit")?"-webkit-":-1<b.indexOf("Firefox")?"-moz-":-1<b.indexOf("MSIE")?"-ms-":-1<b.indexOf("Opera")?"-o-":"",a;v=new v;var g=F.matchesRule;v.root=!0;var l={};v.definitions={Math:Math,window:window,global:window,module:r.selfResolving(function(q,A){q[0].value&&(q=q[0].value);A||require([q]);return{then:function(u){return(new t.Promise(function(k){require([q],function(w){k(w)})})).then(u)}}}),item:m("item",null,{inherit:!0}),pageContent:new z,content:m("content",
null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:m(null,null,{}),elementClass:m(null,null,{get:function(q,A){return-1<(" "+q.className+" ").indexOf(" "+A+" ")},set:function(q,A,u){this.get(q,A)!=u&&(q.className=u?q.className+(" "+A):(" "+q.className+" ").replace(" "+A+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(q){return q},define:function(q){return{forElement:function(A){for(;!g(A,q);)if(A=A.parentNode,!A)throw Error("Rule not found");return A}}}},
event:{observe:function(q){q(a)},valueOf:function(){return a}},each:{put:function(q){return{forRule:function(A){A.each=q}}}},prefix:{put:function(q,A,u){return{forRule:function(k){if("string"==typeof f.style[d+u])return k._setStyleFromValue(d+u,q),!0}}}},"var":{define:function(q,A){return c(A)},selfResolving:!0,apply:function(q,A){return c(x.convertCssNameToJs(A[0]))}},inline:p("inline","none"),block:p("block","none"),visible:p("visible","hidden"),"extends":{apply:function(q,A){for(;0<A.length;)return x.extend(q,
A[0],console.error)}},set:{selfExecuting:!0,apply:function(q,A){return A[0].put(A[1].valueOf())}},get:{apply:function(q,A){return A[0]},put:function(q,A){r.evaluate(A,q)}},toggle:{selfExecuting:!0,apply:function(q,A){return A[0].put(!A[0].valueOf())}},on:{put:function(q,A,u){return{forRule:function(k){F.on(document,u.charAt(2).toLowerCase()+u.slice(3),k,function(w){a=w;try{x.when(r.evaluate(k,q).valueOf(),function(y){y&&y.forRule&&(y=y.forRule(k));y&&y.forElement&&(y=y.forElement(w.target));a=null},
function(y){console.error("Error in "+u+" event handler, executing "+q,y)})}catch(y){console.error("Error in "+u+" event handler, executing "+q,y)}})}}}},title:{put:function(q){return{forRule:function(A){r.observe(r.evaluate(A,q),function(u){document.title=u})}}}},"@supports":{selector:function(q){function A(u){var k;if(k=u.match(/^\s*not(.*)/))return!A(k[1]);if(k=u.match(/\((.*)\)/))return A(k[1]);if(k=u.match(/([^:]*):(.*)/))return u=x.convertCssNameToJs(k[1]),k=f.style[u]=k[2],f.style[u]==k;if(k=
u.match(/\w+\[(.*)=(.*)\]/))return n(k[0])[k[1]]==k[2];if(k=u.match(/\w+/))return x.isTagSupported(k);throw Error("can't parse @supports string");}A(q.selector.slice(10))?q.selector="":q.disabled=!0}},"true":!0,"false":!1,"null":null};v.elementProperty=m;return v})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils"],function(F,r){function z(w,y,C,D){function G(H){if(!C)return D(H);var L=H.target;do if(k(L,C))return D(H);while((L=L.parentNode)&&
1===L.nodeType)}c?w.addEventListener(y,G,!!f[y]):x(w,f[y]||y,G)}function x(w,y,C){y="on"+y;var D=w[y];w[y]=function(G){G=G||window.event;G.target=G.target||G.srcElement;D&&D(G);C(G)}}function n(w){/e/.test(p.readyState||"")?w():p.addEventListener("DOMContentLoaded",w)}function v(w){for(var y=p.querySelectorAll(w.selector),C=w.name,D=0,G=y.length;D<G;D++){var H=y[D],L=H.elementalStyle;L||(L=H.elementalStyle={},H.elementalSpecificities={});var T=H.renderings;T||(T=H.renderings=[],q.push(H));T.push({name:C,
rendered:L[C]==w.propertyValue,renderer:w});L[C]=w.propertyValue}}function t(){for(;q.length;){for(var w=q.shift(),y=w.renderings,C=w.elementalStyle;y.length;){var D=y.shift(),G=D.renderer,H=G.rendered;u=C[D.name]==G.propertyValue;if(!H&&u)try{G.render(w)}catch(L){console.error(L,L.stack),F(w,"div.error",L.toString())}H&&!u&&G.unrender&&G.unrender(w)}w.renderings=void 0}}function m(w,y){for(var C=0,D=g.length;C<D;C++){var G=g[C];y&&y!=G.selector||!k(w,G.rule)||G.render(w)}}function h(w,y){var C={selector:w.selector,
rule:w,render:y};g.push(C);A&&v(C);t();return{remove:function(){g.splice(g.indexOf(C),1)}}}var p=document,e=1,c=!!p.addEventListener,f={blur:"focusout",focus:"focusin"};z(p,"change",null,function(w){w=w.target;for(var y=0,C=l.length;y<C;y++){var D=l[y];if(-1<(" "+w.className+" ").indexOf(D.rule.selector.slice(1))){var G=D.definition.valueOf();G&&G.forRule&&(G=G.forRule(D.rule));G&&G.forElement&&(G=G.forElement(w));var H="checkbox"===w.type?w.checked:w.value;"number"===typeof G&&isFinite(H)&&(H=+H);
(G=D.definition.put(H))&&G.forRule&&(G=G.forRule(D.rule));G&&G.forElement&&G.forElement(w)}}});navigator.userAgent.match(/MSIE|Trident/)&&z(p,"keydown",null,function(w){if(13==w.keyCode){var y=w.target;if(document.createEvent)w=document.createEvent("Events"),w.initEvent("change",!0,!0),y.dispatchEvent(w);else document.onchange({target:y})}});var b=p.createElement("div"),d={"dom-qsa2.1":!!b.querySelectorAll},a=b.matches||b.matchesSelector||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector||
b.oMatchesSelector,g=[],l=[],q=[],A;n(function(){if(!A)if(A=!0,d["dom-qsa2.1"]){for(var w=0,y=g.length;w<y;w++)v(g[w]);t()}else{var C=p.all;w=0;for(y=C.length;w<y;w++)m(C[w])}});var u,k=a?function(w,y){return a.call(w,y.selector)}:function(w,y){y.ieId||y.setStyle(y.ieId="x-ie-"+e++,"true");return!!w.currentStyle[y.ieId]};return{ready:n,on:z,matchesRule:k,addRenderer:h,addInputConnector:function(w,y){l.push({rule:w,definition:y})},update:m,clearRenderers:function(){g=[]},observeForElement:function(w,
y,C){return r.when(w,function(D){function G(H){H.observe?H.observe(C):C(H)}D.forElement?h(y,function(H){G(D.forElement(H))}):G(D)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function F(n,v){for(var t=0,m=n.length;t<m;t++){var h=n[t];if(h&&"object"==typeof h&&v in h)return!0}}function r(n,v){return v.toUpperCase()}var z="div"==document.createElement("div").tagName,x={};return{when:function(n,v,t){return n&&n.then?n.then(v,t)||n:v(n)},whenAll:function(n,v){return F(n,
"then")?{then:function(t,m){function h(){p--;p||t(v(e))}for(var p=1,e=[],c=0;c<n.length;c++){var f=n[c];p++;f&&f.then?function(b){f.then(function(d){e[b]=d;h()},m)}(c):(e[c]=f,h())}h()},inputs:n}:v(n)},convertCssNameToJs:function(n){return n.replace(/-(\w)/g,r)},isTagSupported:function(n){if(n in x)return x[n];var v=document.createElement(n);z?(v=v.toString(),v=!("[object HTMLUnknownElement]"==v||"[object]"==v)):v=v.tagName==n.toUpperCase();return x[n]=v},extend:function(n,v){var t=v.split(".");v=
t[0];var m=n.getDefinition(v,"rules");t[0]="";n.selector+=n.extraSelector=t.join(".");if(m)return this.when(m,function(h){if(h.extend)h.extend(n,!0);else for(var p in h)n[p]=h[p]});n.tagName=v;if(!this.isTagSupported(v))throw Error("Extending undefined definition "+v);},someHasProperty:F}})},"xstyle/core/expression":function(){define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(F,r){function z(b,d){var a=d[0];return a&&b?(a=h(a),z(b.property?b.property(a):b[a],
d.slice(1))):b}function x(b,d,a){if(p(d,b)){var g={};g[b]=function(l){for(var q=[],A=0,u=d.length;A<u;A++){var k=d[A];k&&"function"==typeof k[b]&&(k=k[b](l));q[A]=k}return a(q)};return g}return a(d)}function n(b,d){return{apply:function(a,g,l){for(var q=0,A=g.length;q<A;q++){var u=g[q];u.dependencyOf&&u.dependencyOf(l)}q=function(){var k=[];if(b.selfExecuting)return b.apply(a,g,l);for(var w=0,y=g.length;w<y;w++)k[w]=g[w].valueOf();if(b.selfWaiting)return b.apply(a,k,l);k.push(a);return F.whenAll(k,
function(C){var D=C.pop();return x("forRule",C,function(G){return x("forElement",G,function(H){return b.apply(D,H,l)})})})};q.reverse=function(k){return d(k,g)};return q}}}function v(b){return c[b]||(c[b]=new Function("a","b","return "+b))}function t(b,d,a,g,l){function q(k){k.skipResolve=!0;k.precedence=d;k.infix=!1!==l}var A=function(k,w){var y=w[0];w=w[1];if(y&&y.put)k=g(k,w&&w.valueOf()),k!==e&&y.put(k);else if(w&&w.put)w.put(l(k,y&&y.valueOf()));else throw new TypeError("Can not put");},u={apply:function(k,
w,y){var C;a=v(a);g=g&&v(g);l=l&&v(l);f[b]=C=n(a,A);q(C);return C.apply(k,w,y)}};q(u);f[b]=u}function m(b,d){function a(C){for(;w<=C.precedence;){var D=A.pop(),G=f[A.pop()],H=new r;H.setCompute(G.apply(null,G.infix?[A.pop(),D]:[D],H));u=A.length?A[A.length-1]:void 0;A.push(H);w=u&&f[u]&&f[u].precedence}}var g;d=d.join?d.slice():[d];for(g=0;g<d.length;g++){var l=d[g];if("string"==typeof l){var q=l.match(/"[^"]*"|[+\-<>\|\/\?:^*!&|]+|[\w_$\.\/-]+/g);l=[g,1];q&&l.push.apply(l,q);d.splice.apply(d,l);
g+=l.length-3}}var A=[],u;q={};for(g=0;g<d.length;g++){l=d[g];if("("==l.operator){var k=A[A.length-1];void 0===k||f.hasOwnProperty(k)?l=m(b,l.getArgs()[0]):(A.pop(),l=function(C,D){function G(K){return F.when(C.valueOf(),function(O){var I=C.parent&&C.parent.valueOf();if(!O.selfResolving){if(!H){H=[];for(var P=0,Q=D.length;P<Q;P++)H[P]=m(b,D[P]);L=O.selfReacting?O.apply(I,H,T):n(O).apply(I,H,T)}return L()}O=O.apply(I,D,T);return K?O:O.valueOf()})}var H,L,T=new r(G);T.setReverseCompute(function(){var K=
arguments;return F.when(G(!0),function(O){return O.put.apply(O,K)})});return T}(k,l.getArgs()))}else if(f.hasOwnProperty(l)){k=f[l];a(k);var w=(u||k).precedence}else if(-1<l)l=+l;else if(l.isLiteralString)l=l.value;else{l=l.split(/\s*\/\s*/);k=l[0];var y=b.getDefinition(k);if("string"==typeof y||y instanceof Array)y=m(b,y);else if(void 0===y)throw Error('Could not find reference "'+k+'"');q[k]=y;1<l.length&&(y=z(y,l.slice(1)));l=y}A.push(l)}a({precedence:100});if(1<A.length)throw Error("Could not reduce expression");
l=A[0];l.inputs=q;return l}var h=F.convertCssNameToJs,p=F.someHasProperty,e={},c={},f={};t("+",6,"a+b","a-b","a-b");t("-",6,"a-b","a+b","b-a");t("*",5,"a*b","a/b","a/b");t("/",5,"a/b","a*b","b/a");t("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");t(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");t("!",4,"!a","!a",!1);t("%",5,"a%b");t("\x3e",8,"a\x3eb");t("\x3e\x3d",8,"a\x3e\x3db");t("\x3c",8,"a\x3cb");t("\x3c\x3d",8,"a\x3c\x3db");t("\x3d\x3d",9,"a\x3d\x3d\x3db");t("\x26",8,
"a\x26\x26b");t("|",8,"a||b");return{react:n,evaluate:m,selfResolving:function(b){b.selfResolving=!0;return b}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(F,r){function z(m){(this.computeValue=m)&&m.reverse&&this.setReverseCompute(m.reverse)}function x(m,h,p){if(h&&h.forElement)return{forElement:function(e){e=h.selectElement?h.selectElement(e):e;var c=["_cache_"+m.id];if(c in e){var f=e[c+"observe"];f.addKey&&f.addKey(p);return e[c][p]}var b=e[c]=
h.forElement(e),d=e[c+"observe"]=n(m,b,p,{elements:[e]});e.xcleanup=function(a){a&&r.unobserve(b,d)};return b[p]}}}function n(m,h,p,e){var c=m._properties;if("object"==typeof h){var f=function(b){for(var d=0;d<b.length;d++){var a=c[b[d].name];a&&a.invalidate&&a.invalidate(e)}};r.observe(h,f);f.addKey&&f.addKey(p)}return f}var v={},t=1;z.prototype={id:"x-variable-"+t++,cache:v,valueOf:function(){if((this.dependents||this._properties)&&this.cache!==v)return this.cache;var m=this,h=this.computeValue;
if(h.then)return this.cache=h.then(function(p){m.computeValue=p;(p=m.cache=p())&&p.then&&p.then(function(e){m.cache=e});return p});(h=m.cache=h())&&h.then&&h.then(function(p){m.cache=p});return h},property:function(m){var h=this._properties||(this._properties={}),p=h[m];if(!p){var e=this;p=h[m]=new z(function(){return F.when(e.valueOf(),function(c){if(c&&c.forRule)return{forRule:function(b){b=c.selectRule?c.selectRule(b):b;var d=["_cache_"+e.id],a;if((a=d in b?b[d]:b[d]=c.forRule(b))&&a.forElement)return x(e,
a,m);var g=b[d+"observe"];g&&(g.addKey?g.addKey(m):b[d+"observe"]=n(e,a,m,{rules:[b]}));return a[m]}};if(c&&c.forElement)return x(e,c,m);var f=e.cacheObserve;f?f.addKey&&f.addKey(m):f=e.cacheObserve=n(e,c,m);return c[m]})});p.key=m;p.parent=this;p.put=function(c){return F.when(e.valueOf(),function(f){function b(d){if(d.forElement)return{forElement:function(a){d.forElement(a)[m]=c}};d[m]=c}if(f.forRule)return{forRule:function(d){return b(f.forRule(d))}};b(f)})};p.id=this.id+"-"+m}return p},invalidate:function(m){var h=
this.cacheObserve;h&&(r.unobserve(this.cache,h),this.cacheObserve=null);this.cache=v;h=this._properties;for(e in h)h[e].invalidate(m);var p=this.dependents||0;var e=0;for(h=p.length;e<h;e++)try{p[e].invalidate(m)}catch(c){console.error(c,"invalidating a definition")}},dependencyOf:function(m){(this.dependents||(this.dependents=[])).push(m)},notDependencyOf:function(m){for(var h=this.dependents||0,p=0;p<h.length;p++)h[p]===m&&h.splice(p--,1)},setReverseCompute:function(m){this.put=function(){var h=
m.apply(this,arguments);this.invalidate();return h}},setCompute:function(m){(this.computeValue=m)&&m.reverse&&this.setReverseCompute(m.reverse);this.invalidate()},setSource:function(m){this.computeValue=function(){return m};this.invalidate()},observe:function(m){this.computeValue&&m(this.valueOf());var h=this;return this.dependencyOf({invalidate:function(){m(h.valueOf())}})},newElement:function(){return F.when(this.valueOf(),function(m){return m&&m.newElement&&m.newElement()})}};return z})},"xstyle/core/es6":function(){define("xstyle/core/es6",
[],function(){function F(f,b,d){v?-1===v.indexOf(f)&&v.push(f):(v=[f],setTimeout(function(){v.forEach(function(a){var g=[];a.properties.forEach(function(l){g.push({target:a.object,name:l})});a(g);a.object=null;a.properties=null});v=null},0));f.object=b;f=f.properties||(f.properties=[]);-1===f.indexOf(d)&&f.push(d)}function r(){return r}var z=Object.observe,x;if(x=Object.defineProperty)a:{try{Object.defineProperty({},"t",{});x=!0;break a}catch(f){}x=void 0}var n={observe:z,defineProperty:x,promise:"undefined"!==
typeof Promise,WeakMap:"function"===typeof WeakMap};z=n.observe?Object.observe:n.defineProperty?function(f,b){b.addKey=function(d){var a="key"+d;if(!this[a]){this[a]=!0;var g=f[d];if((a=Object.getOwnPropertyDescriptor(f,d))&&a.set){var l=a.set,q=a.get;Object.defineProperty(f,d,{get:function(){return g=q.call(this)},set:function(A){l.call(this,A);g!==A&&(g=A,b&&F(b,this,d))}})}else Object.defineProperty(f,d,{get:function(){return g},set:function(A){g!==A&&(g=A,b&&F(b,this,d))}})}};b.remove=function(){b=
null}}:function(f,b){p||(p=!0,setInterval(function(){for(var g=0,l=t.length;g<l;g++){var q=void 0,A=void 0,u=m[g],k=t[g],w=h[g];for(q in u)u.hasOwnProperty(q)&&u[q]!==k[q]&&(u[q]=k[q],(A||(A=[])).push({name:q}));for(q in k)k.hasOwnProperty(q)&&!u.hasOwnProperty(q)&&(u[q]=k[q],(A||(A=[])).push({name:q}));A&&w(A)}},20));var d={},a;for(a in f)f.hasOwnProperty(a)&&(d[a]=f[a]);t.push(f);m.push(d);h.push(b)};var v;x=n.observe?Object.unobserve:function(f,b){b.remove&&b.remove();for(var d=0,a=t.length;d<
a;d++)if(t[d]===f&&h[d]===b){t.splice(d,1);m.splice(d,1);h.splice(d,1);break}};var t=[],m=[],h=[],p=!1,e=1,c=function(){};c.prototype.toJSON=r;return{Promise:n.promise?Promise:function(){function f(b){function d(k){k&&k.then?k.then(d,a):(q=k,g())}function a(k){A=k;g()}function g(){l=!0;for(var k=0,w=u.length;k<w;k++)u[k]();u=0}var l,q,A,u=0;b(d,a);return{then:function(k,w){return new f(function(y,C){function D(){try{A&&!w?C(A):y(A?w(A):k?k(q):q)}catch(G){C(G)}}l?D():(u||(u=[])).push(D)})}}}return f}(),
WeakMap:n.WeakMap?WeakMap:function(f,b){var d="__"+(b||"")+e++;return n.defineProperty?{get:function(a){return a[d]},set:function(a,g){Object.defineProperty(a,d,{value:g,enumerable:!1})}}:{get:function(a){return(a=a[d])&&a.value},set:function(a,g){(a[d]||(a[d]=new c)).value=g}}},observe:z,unobserve:x,copy:function(f,b){for(var d in b)f[d]=b[d];return f}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression","xstyle/core/Definition","put-selector/put","xstyle/core/es6",
"xstyle/core/utils"],function(F,r,z,x,n){function v(g,l,q){try{g[l]=q}catch(A){}}function t(){}function m(g,l,q,A){if(g.calls){var u;for(q=0;q<g.length;q++){var k=g[q];if(k instanceof h){g.hasOwnProperty(q)||(g[q]=k=c(k));var w=k.ref&&(k.ref.selfResolving?k.ref.apply(l,k.getArgs(),l):F.evaluate(l,[k.caller,k]));void 0!==w&&((u||(u=[])).push(w),k.evaluated=!0)}}}if(u)return l=F.react(function(){for(var y=0,C=g.slice(),D=0;D<g.length;D++){var G=g[D];G instanceof h&&G.evaluated&&(C[D-1]=g[D-1].slice(0,
-G.caller.length),C[D]=arguments[y++])}return C.join("")}),l.skipResolve=!0,A=new r,A.setCompute(l.apply(A,u,A)),A;if(!A)return g.toString()}function h(g){this.caller=g;this.args=[]}function p(g,l,q,A){return n.when(l,function(u){var k=u;u&&u.forRule&&((g._subRuleListeners||(g._subRuleListeners=[])).push(function(w){var y=k.forRule(w,!0);y&&y.forElement?e(w,y,A):q&&q(y)}),u=u.forRule(g));if(u&&u.forElement)return e(g,u,A);q&&q(u)})}function e(g,l,q){return require(["xstyle/core/elemental"],function(A){A.addRenderer(g,
function(u){var k=l.forElement(u);q&&q(k,u)})})}var c=Object.create||function(g){function l(){}l.prototype=g;return new l},f=n.convertCssNameToJs,b={"{":"}","[":"]","(":")"},d=z("div").style;t.prototype={property:function(g){return(this._properties||(this._properties={}))[g]||(this._properties[g]=new Proxy(this.get(g)))},eachProperty:function(g){for(var l=this.values||0,q=0;q<l.length;q++){var A=l[q];g.call(this,A||"unnamed",l[A])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():
"")+(this.selector||"")+" "},newRule:function(g){g=(this.rules||(this.rules={}))[g]=new t;g.disabled=this.disabled;g.parent=this;return g},newCall:function(g){g=new h(g);g.parent=this;return g},addSheetRule:function(g,l){if("@"!=g.charAt(0)){var q=this.styleSheet,A=q.cssRules||q.rules,u=-1<this.ruleIndex?this.ruleIndex:A.length;try{q.addRule(g,l||" ",u)}catch(k){g.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",g,l)}return A[u]}},onRule:function(){var g=this.getCssRule();if(this.installStyles)for(var l=
0;l<this.installStyles.length;l++){var q=this.installStyles[l];v(g.style,q[0],q[1])}},setMediaSelector:function(g){this.isMediaBlock=!0;this.selector=g},setStyle:function(g,l){this.cssRule?v(this.cssRule.style,g,l):(this.installStyles||(this.installStyles=[])).push([g,l])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(g){return this.values[g]},elements:function(g){var l=this;require(["xstyle/core/elemental"],function(q){q.addRenderer(l,
function(A){g(A)})})},declareDefinition:function(g,l,q){g=g&&f(g);if(!this.disabled){var A=this;if(l.length)if("\x3e"==l[0].toString().charAt(0))g||(this.generator=l,require(["xstyle/core/generate","xstyle/core/elemental"],function(G,H){l=G.forSelector(l,A);H.addRenderer(A,l)}));else{var u=g in d||this.getDefinition(g);if(!q||!u){q=this.definitions||(this.definitions={});var k=l[0];if(k.indexOf&&-1<k.indexOf(",")){k=l.join("").split(/\s*,\s*/);for(var w=[],y=0;y<k.length;y++)w[y]=F.evaluate(this,
k[y])}l[0]&&"{"==l[0].operator?w=l[0]:l[1]&&"{"==l[1].operator&&(w=l[1],n.extend(w,l[0]));w=w||F.evaluate(this,l);if(w.then){var C=w;w={then:function(G){return C.then(function(H){return G(D(H))})}}}var D=function(G){G.define&&(G=G.define(A,g));return G};u&&console.warn('Overriding existing property "'+g+'"');return q[g]=D(w)}}else return q=this.definitions||(this.definitions={}),q[g]=l}},onArguments:function(g){var l=g.ref;return l&&l.apply(this,g.getArgs(),this)},setValue:function(g,l,q){var A=f(g);
if(!this.disabled){var u=this.values||(this.values=[]);u.push(g);u[g]=l;if(g){do{u=(q||this).getDefinition(g);if(void 0!==u){if(this.cssRule&&(!u||!u.keepCSSValue)){var k=this.cssRule.style;A in k&&v(k,A,"")}p(this,u.put(l,this,A))}g=g.substring(0,g.lastIndexOf("-"))}while(g)}A in d&&this._setStyleFromValue(A,l,!0)}},_setStyleFromValue:function(g,l,q){var A=l[0];if(A instanceof t)for(q=A.values,A=0;A<q.length;A++){var u=q[A];this._setStyleFromValue(g+("main"==u?"":u.charAt(0).toUpperCase()+u.slice(1)),
q[u])}else{if(l.calls){var k=this;if(l.expression=m(l,this,g,!0)){var w=l.expression&&l.expression.valueOf(),y=function(D,G){var H=w&&w.forRule?w.forRule(D,!0):w;if(H&&H.forElement)if(G=G&&G.elements)for(var L=0;L<G.length;L++)for(var T=G[L].querySelectorAll(D.selector),K=0;K<T.length;K++){var O=T[K];v(O.style,g,H.forElement(O))}else e(D,H,function(I,P){v(P.style,g,I)});else D.setStyle(g,H)},C=[k];n.when(w,function(D){(w=D)&&w.forRule&&(k._subRuleListeners||(k._subRuleListeners=[])).push(function(G){C.push(G);
y(G)});y(k)});l.expression.dependencyOf({invalidate:function(D){n.when(l.expression.valueOf(),function(G){w=G;for(G=0;G<C.length;G++){var H=!0,L=C[G];if(D&&D.rules){H=!1;for(var T=0;T<D.rules.length;T++)if(D.rules[T]===L){H=!0;break}}H&&y(L,D)}})}})}}q||this.setStyle(g,l)}},put:function(g){var l=this;return{forRule:function(q){l.extend(q);if("defaults"!=g&&g&&"string"==typeof g&&l.values)for(var A=g.toString().split(/,\s*/),u=0;u<A.length;u++){var k=l.values[u];k&&q.setValue(k,A[u],l)}}}},extend:function(g,
l){(this.derivatives||(this.derivatives=[])).push(g);var q=this.extraSelector;q&&(g.selector+=q);var A=this.cssRule.style,u=g.getCssRule().style,k=g.inheritedStyles||(g.inheritedStyles={});for(q=0;q<A.length;q++){var w=f(A[q]);if(!u[w]||k[w])u[w]=A[w],k[w]=!0}if(q=this.values){q=c(q);var y=g.values;g.values=y?x.copy(q,y):q}if(l){if(q=this.definitions){q=c(q);var C=g.definitions;g.definitions=C?x.copy(q,C):q}g.tagName=this.tagName||g.tagName}(g.bases||(g.bases=[])).push(this);l=this._subRuleListeners||
0;for(q=0;q<l.length;q++)l[q](g);var D=g.getCssRule().style;this.eachProperty(function(G,H){G=f(G);"object"==typeof H&&(H=c(H));G in d&&!D[G]&&g._setStyleFromValue(G,H)});if(y&&g.definitions)for(q=0,l=y.length;q<l;q++)w=y[q],A=f(w),g.definitions[A]!==(C&&C[A])&&g.setValue(w,y[A]);if(y=this.generator){if(y instanceof Array)for(y=y.slice(0),q=0;q<y.length;q++)C=y[q],"{"===C.operator&&(l=g.newRule(),l.selector=C.selector+g.selector.slice(1),l.styleSheet=g.styleSheet||g.cssRule.parentStyleSheet,C.extend(l,
!0),y[q]=l);g.declareDefinition(null,y)}},getDefinition:function(g,l){g=f(g);var q=this;do{var A=q.definitions&&q.definitions[g];void 0===A&&l&&q[l]&&(A=q[l][g]);q=q.parent}while(void 0===A&&q);return A},newElement:function(){return z((this.tagName||"span")+(this.selector||""))},cssText:""};F.evaluateText=m;var a=h.prototype=new t;a.declareDefinition=a.setValue=function(g,l){this.args.push(l)};a.toString=function(){var g=this.operator;return g+this.args+b[g]};t.updateStaleProperties=function(){};
return t})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(F,r,z,x,n){function v(g,l){g=g.sort?g:[g];return function(q,A,u){var k=q,w;"content"in q||(q.content=void 0);if(void 0===u){var y=(q._contentNode||q).childNodes||0,C=y[0];if(C){var D=d.createDocumentFragment();do D.appendChild(C);while(C=y[0]);q.content=D}if(q._contentNode){q._contentNode=void 0;try{q.innerHTML=
""}catch(da){}}}var G=0,H=[q],L=[];y=0;for(C=g.length;y<C;y++){var T=K,K=g[y];try{if(K.eachProperty){if(K.args)if("("==K.operator){var O=g[y+1];t(K,O,k,function(da,ma,na){p(da,ma,na,l)})}else{var I=K.args[0];if("string"===typeof I){var P=I.split("\x3d");try{k.setAttribute(P[0],P[1])}catch(da){console.error(da)}}else{var Q=I[0].replace(/=$/,""),U=I[1];"("==U.operator?t(I[1],Q,k,function(da,ma,na){h(da,ma,na,l)}):k.setAttribute(Q,U.value)}}}else if("string"==typeof K){"\x3d"==K.charAt(0)&&(K=K.slice(1));
var Y=k;O=g[y+1];P=[];K.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){P.push(arguments)});for(var ca=0;ca<P.length;ca++)(function(da,ma,na,va,ja,pa,la){function ra(){var wa=Y._contentNode;wa&&(wa.innerHTML="",Y=wa)}ma?(da=na?na.length:0,da>G?(ra(),H[da]=Y):Y=H[da]||Y,G=da):ra();if(va)var X=(T&&T.args?"":"span")+va+ja;else{va=ja.match(/^[-\w]+/);if(!va)throw new SyntaxError("Unable to parse selector",ja);va=va[0];if(ca===P.length-1&&O&&O.selector){O.bases||
z.extend(O,va);var ya=O}else ya=l.getDefinition(va);ya&&(ya.then||ya.newElement)?Y=function(wa,M,B,E){var J;z.when(ya&&ya.newElement&&ya.newElement(),function(S){(J=S)?(B=B.slice(E.length))&&r(J,B):J=r(B);if(N){N.parentNode.replaceChild(J,N);S=N.childNodes;var V;for(J=J._contentNode||J;V=S[0];)J.appendChild(V)}});if(J)return wa.insertBefore(J,M||null);var N=r("span");return wa.insertBefore(N,M||null)}(Y,u,ja,va):X=ja}X&&(Y=r(u||Y,(u?"-":"")+X));u=null;pa&&Y.setAttribute(pa,""===la?pa:la);A&&(Y.item=
A);w=w||Y;(ca<P.length-1||Y!=k&&Y!=q)&&L.push(ca==P.length-1&&O&&O.selector,Y);k=Y}).apply(this,P[ca])}else k.appendChild(d.createTextNode(K.value))}catch(da){console.error(da,da.stack),k.innerHTML&&(k.innerHTML=""),k.appendChild(d.createTextNode(da))}}for(;K=L.pop();)F.update(K,L.pop());return w}}function t(g,l,q,A){var u;if(l&&l.eachProperty){r(q,u=l.selector);var k=l}else r(q,u=g.selector||(g.selector=".-xbind-"+a++)),k=g;var w=g.getArgs()[0],y=g.expressionResult,C=g.expressionDefinition;C||(C=
g.expressionDefinition=x.evaluate(g.parent,w),y=C.valueOf(),F.addInputConnector(k,C),function(D,G,H){g.expressionResult=y;H.dependencyOf&&H.dependencyOf({invalidate:function(L){L=L?F.matchesRule(L.elements[0],k)?L.elements:L.elements[0].querySelectorAll(G):document.querySelectorAll(G);for(var T=0,K=L.length;T<K;T++)A(L[T],D,H.valueOf())}})}(l,u,C));A(q,l,y)}function m(g,l,q,A){return z.when(g,function(u){u&&u.forRule&&(u=u.forRule(l));u&&u.forElement&&(u=u.forElement(q));A(u)})}function h(g,l,q,A){m(q,
A,g,function(u){g.setAttribute(l,u)})}function p(g,l,q,A){g._defaultBinding=!0;if(q&&q.then&&"INPUT"!==g.tagName)try{g.appendChild(d.createTextNode("Loading"))}catch(u){}m(q,A,g,function(u){if(g._defaultBinding)if(e(g),g.childNodes.length&&(g.innerHTML=""),u&&u.sort)if(u.isSequence)v(u,A)(g);else{var k=l&&l.definitions&&l.definitions.each,w=A.newRule();k=k?v(k,w):function(G,H,L){return r(L||G,(L?"-":"")+(f[G.tagName]||"span"),""+H)};var y=[];if(u.track){u=u.track();var C=u.tracking}u.forEach(function(G){y.push(k(g,
G,null))});if(u.on)var D=u.on("add,delete,update",function(G){var H=G.target,L=G.previousIndex;G=G.index;if(-1<L){var T=y[L];e(T,!0);T.parentNode.removeChild(T);y.splice(L,1)}-1<G&&y.splice(G,0,k(g,H,y[G]||null))});if(C=C||D)g.xcleanup=function(){C.remove()}}else u&&u.nodeType?g.appendChild(u):(u=void 0===u?"":u,g.tagName in b?"checkbox"===g.type?g.checked=u:g.value=u:g.appendChild(d.createTextNode(u)))})}function e(g,l){g.xcleanup&&g.xcleanup(l);g=g.getElementsByTagName("*");l=0;for(var q=g.length;l<
q;l++){var A=g[l];A.xcleanup&&A.xcleanup(!0)}}function c(g,l){return v(l,n)(g)}var f={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},b={INPUT:1,TEXTAREA:1,SELECT:1},d=document,a=1;c.forSelector=v;return c})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c){z.isAsync||m(0,function(){require(["dojo/dnd/AutoSource",
"dojo/dnd/Target"])});var f=r("dojo.dnd.Source",e,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(b,d){x.mixin(this,x.mixin({},d));b=this.accept;if(b.length)for(this.accept={},d=0;d<b.length;++d)this.accept[b[d]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&n.add(this.node,"dojoDndSource");
this.targetState="";this.accept&&n.add(this.node,"dojoDndTarget");this.horizontal&&n.add(this.node,"dojoDndHorizontal");this.topics=[h.subscribe("/dnd/source/over",x.hitch(this,"onDndSourceOver")),h.subscribe("/dnd/start",x.hitch(this,"onDndStart")),h.subscribe("/dnd/drop",x.hitch(this,"onDndDrop")),h.subscribe("/dnd/cancel",x.hitch(this,"onDndCancel"))]},checkAcceptance:function(b,d){if(this==b)return!this.copyOnly||this.selfAccept;for(var a=0;a<d.length;++a){for(var g=b.getItem(d[a].id).type,l=
!1,q=0;q<g.length;++q)if(g[q]in this.accept){l=!0;break}if(!l)return!1}return!0},copyState:function(b,d){if(b)return!0;2>arguments.length&&(d=this==c.manager().target);if(d){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){f.superclass.destroy.call(this);F.forEach(this.topics,function(b){b.remove()});this.targetAnchor=null},onMouseMove:function(b){if(!this.isDragging||"Disabled"!=this.targetState){f.superclass.onMouseMove.call(this,b);var d=c.manager();
if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(b.pageX-this._lastX)>this.delay||Math.abs(b.pageY-this._lastY)>this.delay)){var a=this.getSelectedNodes();a.length&&d.startDrag(this,a,this.copyState(p.getCopyKeyState(b),!0))}this.isDragging&&(a=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=v.position(this.current,!0)),a=this.horizontal?b.pageX-this.targetBox.x<this.targetBox.w/2==v.isBodyLtr(this.current.ownerDocument):b.pageY-this.targetBox.y<this.targetBox.h/
2),this.current!=this.targetAnchor||a!=this.before)&&(this._markTargetAnchor(a),d.canDrop(!this.current||d.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(b){this.mouseDown||!this._legalMouseDown(b)||this.skipForm&&p.isFormElement(b)||(this.mouseDown=!0,this._lastX=b.pageX,this._lastY=b.pageY,f.superclass.onMouseDown.call(this,b))},onMouseUp:function(b){this.mouseDown&&(this.mouseDown=!1,f.superclass.onMouseUp.call(this,b))},onDndSourceOver:function(b){this!==b?(this.mouseDown=
!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(b=c.manager(),b.canDrop("Disabled"!=this.targetState&&(!this.current||b.source!=this||!(this.current.id in this.selection))))},onDndStart:function(b,d,a){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==b?a?"Copied":"Moved":"");d=this.accept&&this.checkAcceptance(b,d);this._changeState("Target",d?"":"Disabled");this==b&&c.manager().overSource(this);this.isDragging=!0},onDndDrop:function(b,d,a,g){if(this==
g)this.onDrop(b,d,a);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(b,d,a){if(this!=b)this.onDropExternal(b,d,a);else this.onDropInternal(d,a)},onDropExternal:function(b,d,a){var g=this._normalizedCreator;this._normalizedCreator=this.creator?function(l,q){return g.call(this,b.getItem(l.id).data,q)}:a?function(l){var q=
b.getItem(l.id);l=l.cloneNode(!0);l.id=p.getUniqueId();return{node:l,data:q.data,type:q.type}}:function(l){var q=b.getItem(l.id);b.delItem(l.id);return{node:l,data:q.data,type:q.type}};this.selectNone();a||this.creator||b.selectNone();this.insertNodes(!0,d,this.before,this.current);!a&&this.creator&&b.deleteSelectedNodes();this._normalizedCreator=g},onDropInternal:function(b,d){var a=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(d)this._normalizedCreator=this.creator?
function(g,l){return a.call(this,this.getItem(g.id).data,l)}:function(g){var l=this.getItem(g.id);g=g.cloneNode(!0);g.id=p.getUniqueId();return{node:g,data:l.data,type:l.type}};else{if(!this.current)return;this._normalizedCreator=function(g){var l=this.getItem(g.id);return{node:g,data:l.data,type:l.type}}}this._removeSelection();this.insertNodes(!0,b,this.before,this.current);this._normalizedCreator=a}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){f.superclass.onOverEvent.call(this);
c.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){f.superclass.onOutEvent.call(this);c.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(b){if(this.current!=this.targetAnchor||this.before!=b)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=b,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(b){this._changeState("Source",b?"Copied":"Moved")},_legalMouseDown:function(b){if("touchstart"!=b.type&&!t.isLeft(b))return!1;if(!this.withHandles)return!0;for(b=b.target;b&&b!==this.node;b=b.parentNode){if(n.contains(b,"dojoDndHandle"))return!0;
if(n.contains(b,"dojoDndItem")||n.contains(b,"dojoDndIgnore"))break}return!1}});return f})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c){var f=r("dojo.dnd.Selector",c,{constructor:function(b,d){d||(d={});this.singular=d.singular;this.autoSync=d.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;
this.events.push(h(this.node,p.press,x.hitch(this,"onMouseDown")),h(this.node,p.release,x.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new m,d=e._empty,a;for(a in this.selection)a in d||b.push(n.byId(a));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(b,d){this._addItemClass(n.byId(d),"Selected");this.selection[d]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=e._empty,
d;for(d in this.selection)if(!(d in b)){var a=n.byId(d);this.delItem(d);v.destroy(a)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(b,d){d=d||z.global;var a=this.selection,g=e._empty,l;for(l in a)l in g||b.call(d,this.getItem(l),l,this)},sync:function(){f.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var b=[],d=e._empty,a;for(a in this.selection)a in d||this.getItem(a)||b.push(a);F.forEach(b,function(g){delete this.selection[g]},
this);return this},insertNodes:function(b,d,a,g){var l=this._normalizedCreator;this._normalizedCreator=function(q,A){q=l.call(this,q,A);b?(this.anchor?this.anchor!=q.node&&(this._removeItemClass(q.node,"Anchor"),this._addItemClass(q.node,"Selected")):(this.anchor=q.node,this._removeItemClass(q.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[q.node.id]=1):(this._removeItemClass(q.node,"Selected"),this._removeItemClass(q.node,"Anchor"));return q};f.superclass.insertNodes.call(this,
d,a,g);this._normalizedCreator=l;return this},destroy:function(){f.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!e.getCopyKeyState(b)&&!b.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,t.isLeft(b)&&(b.stopPropagation(),b.preventDefault());else{if(!this.singular&&b.shiftKey){e.getCopyKeyState(b)||this._removeSelection();var d=this.getAllNodes();if(d.length&&(this.anchor||(this.anchor=
d[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var a=0,g;a<d.length&&(g=d[a],g!=this.anchor&&g!=this.current);++a);for(++a;a<d.length;++a){g=d[a];if(g==this.anchor||g==this.current)break;this._addItemClass(g,"Selected");this.selection[g.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?e.getCopyKeyState(b)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):e.getCopyKeyState(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);b.stopPropagation();b.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=h(this.node,
p.move,x.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var b=e._empty,d;for(d in this.selection)if(!(d in b)){var a=n.byId(d);a&&this._removeItemClass(a,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return f})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){r=r("dojo.dnd.Container",h,{skipForm:!1,allowNested:!1,constructor:function(d,a){this.node=v.byId(d);a||(a={});this.creator=a.creator||null;this.skipForm=a.skipForm;this.parent=a.dropParent&&v.byId(a.dropParent);this.map={};this.current=null;this.containerState="";t.add(this.node,"dojoDndContainer");a&&a._skipStartup||this.startup();this.events=[e(this.node,f.over,x.hitch(this,"onMouseOver")),e(this.node,f.out,x.hitch(this,"onMouseOut")),e(this.node,"dragstart",
x.hitch(this,"onSelectStart")),e(this.node,"selectstart",x.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(d){return this.map[d]},setItem:function(d,a){this.map[d]=a},delItem:function(d){delete this.map[d]},forInItems:function(d,a){a=a||z.global;var g=this.map,l=b._empty,q;for(q in g)q in l||d.call(a,g[q],q,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return c((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var d={};this.getAllNodes().forEach(function(a){if(a.id){var g=
this.getItem(a.id);if(g){d[a.id]=g;return}}else a.id=b.getUniqueId();g=a.getAttribute("dndType");var l=a.getAttribute("dndData");d[a.id]={data:l||a.innerHTML,type:g?g.split(/\s*,\s*/):["text"]}},this);this.map=d;return this},insertNodes:function(d,a,g){this.parent.firstChild?a?g||(g=this.parent.firstChild):g&&(g=g.nextSibling):g=null;if(g)for(a=0;a<d.length;++a){var l=this._normalizedCreator(d[a]);this.setItem(l.node.id,{data:l.data,type:l.type});g.parentNode.insertBefore(l.node,g)}else for(a=0;a<
d.length;++a)l=this._normalizedCreator(d[a]),this.setItem(l.node.id,{data:l.data,type:l.type}),this.parent.appendChild(l.node);return this},destroy:function(){F.forEach(this.events,function(d){d.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(d,a,g){d._skipStartup=!0;return new g(a,d)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var d=this.parent.getElementsByTagName("tbody");d&&d.length&&(this.parent=
d[0])}this.defaultCreator=b._defaultCreator(this.parent);this.sync()},onMouseOver:function(d){for(var a=d.relatedTarget;a&&a!=this.node;)try{a=a.parentNode}catch(g){a=null}a||(this._changeState("Container","Over"),this.onOverEvent());a=this._getChildByEvent(d);this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(d){for(d=d.relatedTarget;d;){if(d==this.node)return;try{d=d.parentNode}catch(a){d=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(d){this.withHandles||this.skipForm&&b.isFormElement(d)||(d.stopPropagation(),d.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(d,a){var g="dojoDnd"+d;d=d.toLowerCase()+"State";t.replace(this.node,g+a,g+this[d]);this[d]=a},_addItemClass:function(d,a){t.add(d,"dojoDndItem"+a)},_removeItemClass:function(d,a){t.remove(d,"dojoDndItem"+
a)},_getChildByEvent:function(d){if(d=d.target)for(var a=d.parentNode;a;d=a,a=d.parentNode)if((a==this.parent||this.allowNested)&&t.contains(d,"dojoDndItem"))return d;return null},_normalizedCreator:function(d,a){d=(this.creator||this.defaultCreator).call(this,d,a);x.isArray(d.type)||(d.type=["text"]);d.node.id||(d.node.id=b.getUniqueId());t.add(d.node,"dojoDndItem");return d}});b._createNode=function(d){return d?function(a){return m.create(d,{innerHTML:a})}:b._createSpan};b._createTrTd=function(d){var a=
m.create("tr");m.create("td",{innerHTML:d},a);return a};b._createSpan=function(d){return m.create("span",{innerHTML:d})};b._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};b._defaultCreator=function(d){d=d.tagName.toLowerCase();var a="tbody"==d||"thead"==d?b._createTrTd:b._createNode(b._defaultCreatorNodes[d]);return function(g,l){var q=g&&x.isObject(g);if(q&&g.tagName&&g.nodeType&&g.getAttribute){var A=g.getAttribute("dndData")||g.innerHTML;q=(q=g.getAttribute("dndType"))?q.split(/\s*,\s*/):
["text"]}else A=q&&g.data?g.data:g,q=q&&g.type?g.type:["text"],g=("avatar"==l?b._createSpan:a)(String(A));g.id||(g.id=b.getUniqueId());return{node:g,data:A,type:q}}};return r})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b){var d=r("dojo.dnd.Manager",[v],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:t("touch")?4:16,OFFSET_Y:t("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());p.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),p.publish("/dnd/source/over",null)):p.publish("/dnd/source/over",null)},startDrag:function(a,
g,l){function q(A){A.preventDefault();A.stopPropagation()}f.autoScrollStart(x.doc);this.source=a;this.nodes=g;this.copy=!!l;this.avatar=this.makeAvatar();x.body().appendChild(this.avatar.node);p.publish("/dnd/start",a,g,this.copy);this.events=[h(x.doc,e.move,z.hitch(this,"onMouseMove")),h(x.doc,e.release,z.hitch(this,"onMouseUp")),h(x.doc,"keydown",z.hitch(this,"onKeyDown")),h(x.doc,"keyup",z.hitch(this,"onKeyUp")),h(x.doc,"dragstart",q),h(x.body(),"selectstart",q)];a="dojoDnd"+(l?"Copy":"Move");
n.add(x.body(),a)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){n.remove(x.body(),["dojoDndCopy","dojoDndMove"]);F.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new b(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var g=this.avatar;g&&(f.autoScrollNodes(a),g=g.node.style,
g.left=a.pageX+this.OFFSET_X+"px",g.top=a.pageY+this.OFFSET_Y+"px",g=!!this.source.copyState(c.getCopyKeyState(a)),this.copy!=g&&this._setCopyStatus(g));t("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var g=!!this.source.copyState(c.getCopyKeyState(a));p.publish("/dnd/drop/before",this.source,this.nodes,g,this.target,a);p.publish("/dnd/drop",this.source,this.nodes,g,this.target,a)}else p.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case m.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case m.ESCAPE:p.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==m.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();n.replace(x.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});c._manager=null;d.manager=c.manager=function(){c._manager||
(c._manager=new d);return c._manager};return d})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(F,r,z,x,n,v,t,m){return F("dojo.dnd.Avatar",null,{constructor:function(h){this.manager=h;this.construct()},construct:function(){var h=v.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),p=this.manager.source,e=v.create("tbody",null,h),c=v.create("tr",
null,e),f=v.create("td",null,c),b=Math.min(5,this.manager.nodes.length),d=0;t("highcontrast")&&v.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},f);v.create("span",{innerHTML:p.generateText?this._generateText():""},f);for(x.set(c,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});d<b;++d){if(p.creator)var a=p._normalizedCreator(p.getItem(this.manager.nodes[d].id).data,"avatar").node;else a=this.manager.nodes[d].cloneNode(!0),"tr"==a.tagName.toLowerCase()&&(c=v.create("table"),
v.create("tbody",null,c).appendChild(a),a=c);a.id="";c=v.create("tr",null,e);f=v.create("td",null,c);f.appendChild(a);x.set(c,{"class":"dojoDndAvatarItem",style:{opacity:(9-d)/10}})}this.node=h},destroy:function(){v.destroy(this.node);this.node=!1},update:function(){n.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(t("highcontrast")){var h=z.byId("a11yIcon"),p="+";this.manager.canDropFlag&&!this.manager.copy?p="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||
(p="x"):p="o";h.innerHTML=p}m("tr.dojoDndAvatarHeader td span"+(t("highcontrast")?" span":""),this.node).forEach(function(e){e.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(F,r,z,x){return F("dijit.CheckedMenuItem",z,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:x,checked:!1,_setCheckedAttr:function(n){this.domNode.setAttribute("aria-checked",n?"true":"false");this._set("checked",n)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(n){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(n)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(F,r,z,x,n,v,t,m,h,p,e){var c=h("dijit.ColorPalette",[z,x,n],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:r,baseClass:"dijitColorPalette",_dyeFactory:function(f,b,d,a){return new this._dyeClass(f,
b,d,a)},buildRendering:function(){this.inherited(arguments);this._dyeClass=h(c._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],t.getLocalization("dojo","colors",this.lang))}});c._Color=h("dijit._Color",m,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":F.toUrl("./themes/a11y/colors7x10.png"),"3x4":F.toUrl("./themes/a11y/colors3x4.png")},constructor:function(f,b,d,a){this._title=a;this._row=b;this._col=d;this.setColor(m.named[f])},getValue:function(){return this.toHex()},fillCell:function(f,b){b=e.substitute(v("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:b,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});p.place(b,f)}});return c})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(F,r,z,x,n,v,t,m,h,p,e){return F("dijit._PaletteMixin",m,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(c){return new ("string"==
typeof this.dyeClass?v.getObject(this.dyeClass):this.dyeClass)(c)},_preparePalette:function(c,f){this._cells=[];var b=this._blankGif;this.own(t(this.gridNode,h,v.hitch(this,"_onCellClick")));for(var d=0;d<c.length;d++)for(var a=x.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),g=0;g<c[d].length;g++){var l=c[d][g];if(l){var q=this._dyeFactory(l,d,g,f[l]);l=x.create("td",{"class":this.cellClass,tabIndex:"-1",title:f[l],role:"gridcell"},a);q.fillCell(l,b);l.idx=this._cells.length;this._cells.push({node:l,
dye:q})}}this._xDim=c[0].length;this._yDim=c.length;var A={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},u;for(u in A)this.own(e.addKeyListener(this.domNode,{keyCode:n[u],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var k=A[u];return function(w){this._navigateByKey(k,w)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){p.focus(this._currentFocus)},
_onCellClick:function(c){for(var f=c.target;"TD"!=f.tagName;){if(!f.parentNode||f==this.gridNode)return;f=f.parentNode}var b=this._getDye(f).getValue();this._setCurrent(f);p.focus(f);this._setValueAttr(b,!0);c.stopPropagation();c.preventDefault()},_setCurrent:function(c){"_currentFocus"in this&&r.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=c)&&r.set(c,"tabIndex",this.tabIndex)},_setValueAttr:function(c,f){0<=this._selectedCell&&z.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(c)for(var b=0;b<this._cells.length;b++)if(c==this._cells[b].dye.getValue()){this._selectedCell=b;z.add(this._cells[b].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?c:null);if(f||void 0===f)this.onChange(c)},onChange:function(){},_navigateByKey:function(c,f){-1!=f&&(c=this._currentFocus.idx+c,c<this._cells.length&&-1<c&&(c=this._cells[c].node,this._setCurrent(c),this.defer(v.hitch(p,"focus",c))))},_getDye:function(c){return this._cells[c.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(F){return F})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(F,r,z){return F("dijit.form.ComboBox",[r,z],{})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(F,r,z,x){F=function(n){function v(e,c){var f=n[e];f&&(n[e]=function(b){var d;"put"===e&&(d=n.getIdentity(b));if(p)return f.apply(this,arguments);
p=!0;try{var a=f.apply(this,arguments);z(a,function(g){c("object"==typeof g&&g||b,d)});return a}finally{p=!1}})}var t=[],m=0;n=r.delegate(n);n.notify=function(e,c){m++;for(var f=t.slice(),b=0,d=f.length;b<d;b++)f[b](e,c)};var h=n.query;n.query=function(e,c){c=c||{};var f=h.apply(this,arguments);if(f&&f.forEach){var b=r.mixin({},c);delete b.start;delete b.count;var d=n.queryEngine&&n.queryEngine(e,b),a=m,g=[],l;f.observe=function(q,A){1==g.push(q)&&t.push(l=function(k,w){z(f,function(y){var C=y.length!=
c.count,D;if(++a!=m)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var G=-1,H=-1;if(void 0!==w){var L=[].concat(y);d&&!k&&(L=d(y));var T=0;for(D=y.length;T<D;T++){var K=y[T];if(n.getIdentity(K)==w&&!(0>L.indexOf(K))){var O=K;G=T;!d&&k||y.splice(T,1);break}}}d?k&&(d.matches?d.matches(k):d([k]).length)&&(T=-1<G?G:y.length,y.splice(T,0,k),H=x.indexOf(d(y),k),y.splice(T,1),c.start&&0==H||!C&&H==y.length?H=-1:y.splice(H,0,k)):k&&(void 0!==w?H=G:c.start||
(H=n.defaultIndex||0,y.splice(H,0,k)));if((-1<G||-1<H)&&(A||!d||G!=H))for(C=g.slice(),T=0;y=C[T];T++)y(k||O,G,H)})});var u={};u.remove=u.cancel=function(){var k=x.indexOf(g,q);-1<k&&(g.splice(k,1),g.length||t.splice(x.indexOf(t,l),1))};return u}}return f};var p;v("put",function(e,c){n.notify(e,c)});v("add",function(e){n.notify(e)});v("remove",function(e){n.notify(void 0,e)});return n};r.setObject("dojo.store.Observable",F);return F})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare",
"dojo/dom-class","dojo/sniff","./TextBox"],function(F,r,z,x){return F("dijit.form.SimpleTextarea",x,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);z("ie")&&this.cols&&
r.add(this.textbox,"dijitTextAreaCols")},filter:function(n){n&&(n=n.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(n){if(this.maxLength){var v=parseInt(this.maxLength),t=this.textbox.value.replace(/\r/g,"");v=t.length-v;if(0<v){var m=this.textbox;if(m.selectionStart){var h=m.selectionStart,p=0;z("opera")&&(p=(this.textbox.value.substring(0,h).match(/\r/g)||[]).length);this.textbox.value=t.substring(0,h-v-p)+t.substring(h-p);m.setSelectionRange(h-v,h-v)}else this.ownerDocument.selection&&
(m.focus(),t=this.ownerDocument.selection.createRange(),t.moveStart("character",-v),t.text="",t.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(F,r,z){return F("dijit.form.RadioButton",[r,z],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(F,r,z,x,n,v){return r("dijit.form._RadioButtonMixin",
null,{type:"radio",_getRelatedWidgets:function(){var t=[];n("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(x.hitch(this,function(m){m.name==this.name&&m.form==this.focusNode.form&&(m=v.getEnclosingWidget(m))&&t.push(m)}));return t},_setCheckedAttr:function(t){this.inherited(arguments);this._created&&t&&F.forEach(this._getRelatedWidgets(),x.hitch(this,function(m){m!=this&&m.checked&&m.set("checked",!1)}))},_getSubmitValue:function(t){return null==t?"on":t},_onClick:function(t){if(this.checked||
this.disabled)return t.stopPropagation(),t.preventDefault(),!1;if(this.readOnly)return t.stopPropagation(),t.preventDefault(),F.forEach(this._getRelatedWidgets(),x.hitch(this,function(p){z.set(this.focusNode||this.domNode,"checked",p.checked)})),!1;var m=!1,h;F.some(this._getRelatedWidgets(),function(p){return p.checked?(h=p,!0):!1});this.checked=!0;h&&(h.checked=!1);if(!1===this.onClick(t)||t.defaultPrevented)m=!0;this.checked=!1;h&&(h.checked=!0);m?t.preventDefault():this.set("checked",!0);return!m}})})},
"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv class\x3d"symbol-chooser" style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.markerCategory}" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" style\x3d"position:relative"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-symbolSize"\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" data-a11y-label-by\x3d"point-symbol-section-symbolSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"point-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner"  data-a11y-label-by\x3d"point-symbol-section-outlineWidth" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"line-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-style"\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"jimu/dijit/formSelect" data-a11y-label-by\x3d"line-symbol-section-style" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"line-symbol-section-transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"line-symbol-section-width" data-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"arrowWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"arrow-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"arrowWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"arrow-symbol-section-width" data-dojo-props\x3d\'value:12,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"fill-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"fill-symbol-section-outlineWidth" data-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-text"\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text"  data-a11y-label-by\x3d"text-symbol-section-text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontColor"\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"text-symbol-section-fontColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontSize"\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"text-symbol-section-fontSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n  \x3cimg class\x3d"tmp-image" style\x3d"display:none" data-dojo-attach-point\x3d"tmpImg"\x3e--\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\r\n\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" width\x3d"100%" height\x3d"100%" style\x3d"display:none;width:100%;height:100%"\x3e\r\n\x3c/div\x3e\r\n',"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.arrow}" data-geotype\x3d"ARROW" data-commontype\x3d"arrow" class\x3d"draw-item arrow-icon" data-dojo-attach-point\x3d"arrowIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddExpDesktop" class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddSetDesktop" class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" tabindex\x3d"0" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect" data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"dijit-form-Select restrict-select-width" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/dateTimePicker.html":'\x3cdiv data-dojo-attach-point\x3d"dateTimeBox" class\x3d"jimu-dateTimeBox"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"calendarDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerRuntime" class\x3d"timeTextContainer timeTextContainerRuntime"\x3e\r\n\t\t\x3cdiv class\x3d"timeTextIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTextBoxDiv"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerSetting" class\x3d"timeTextContainer" style\x3d"display:none;"\x3e\r\n\t\t\x3cdiv class\x3d"timeCheckbox" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"timeCheckbox" data-dojo-props\x3d"checked:true, label:\'${timeNls.showTime}\'"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTableContainer" style\x3d"display:none;"\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.hour}"\x3e${timeUnit.hour}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.minute}"\x3e${timeUnit.minute}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.second}"\x3e${timeUnit.second}\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"hourSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'HH\', clickableIncrement: \'T01:00:00\', visibleIncrement: \'T01:00:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"minuteSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'mm\', clickableIncrement: \'T00:05:00\', visibleIncrement: \'T00:05:00\',pickerMin: \'T01:00:00\',pickerMax: \'T01:59:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"secondSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'ss\', clickableIncrement: \'T00:00:05\', visibleIncrement: \'T00:00:05\',pickerMin: \'T01:00:00\',pickerMax: \'T01:00:59\'}"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit1_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit2_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueSelect.html":'\x3cdiv class\x3d"jimu-list-multiple-select" data-dojo-attach-point\x3d"multipleSelect" tabindex\x3d"0"\x3e\r\n  \x3cdiv class\x3d"selectedContainer" data-dojo-attach-point\x3d"selectedContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-items-list items-content" data-dojo-attach-point\x3d"selectedListContent" tabindex\x3d"0"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv\x3e\r\n    \x3c!-- \x3cdiv style\x3d"position:absolute;height:345px;width:100%;z-index:1;display:none;" data-dojo-attach-point\x3d"listContainerOverlay"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"searchKeyInput" data-dojo-attach-point\x3d"searchKeyInput" style\x3d"display:none;"\x3e\r\n      \x3cinput value\x3d"" placeholder\x3d"${jimuCommonNls.search}" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n       data-dojo-attach-point\x3d"valueInput" data-dojo-props\x3d\'"required":false,intermediateChanges:true\' style\x3d"width:100%;" tabindex\x3d"0"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"items-content loading-center" data-dojo-attach-point\x3d"listContainer"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listContentStore"style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\r\n      \x3c/div\x3e --\x3e\r\n      \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"listContent" tabindex\x3d"0"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadMoreDataBtn" class\x3d"jimu-list-multiple-select-Tips load-more-data-Tips"\x3e${jimuCommonNls.searchMore}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${Nls.noData}\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${noDataNls}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv class\x3d"createNewItem" data-dojo-attach-point\x3d"createNewItem" data-dojo-attach-event\x3d"click:_createTarget"\x3e\x26nbsp;\x3c/div\x3e --\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n    \x3cspan class\x3d"selectedToggle" data-dojo-attach-point\x3d"selectedToggle"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"toggleTxt" title\x3d"${Nls.showSelected}"\x3e${Nls.showSelected}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n      \x3cdiv class\x3d"showAllIcon iconHover jimu-flipx" title\x3d"${Nls.showAll}" data-dojo-attach-point\x3d"showAllIconBtn"  tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"showSelectedIcon jimu-flipx" title\x3d"${Nls.showSelected}" data-dojo-attach-point\x3d"showSelectedIconBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"clearAllSelectedIcon jimu-flipx" title\x3d"${Nls.unCheckAll}" data-dojo-attach-point\x3d"clearAllSelectedBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueProvider.html":'\x3cdiv\x3e\r\n   \x3cdiv role\x3d"button" aria-haspopup\x3d"true" class\x3d"checkBtn" tabindex\x3d"0" data-dojo-attach-point\x3d"checkedBtn" style\x3d"display:none;" data-dojo-attach-event\x3d"click:_checkedBtnEvent"\x3e\r\n       \x3cspan class\x3d"screen-readers-only" data-dojo-attach-point\x3d"promptLabel"\x3e\x3c/span\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNumDiv" class\x3d"checkedNumDiv"\x3e\x3cspan class\x3d"checkedNum" data-dojo-attach-point\x3d"checkedNum"\x3e\x3c/span\x3e${CommonNls.selected}\x3c/div\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNameDiv" class\x3d"checkedNum checkedNameDiv jimu-ellipsis-Blanks"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 checkBtnDownIcon"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n   \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3cdiv class\x3d"value-multiple-popup" data-dojo-attach-point\x3d"listContentPopup"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/pageControlForQuery.html":'\x3cdiv class\x3d"pageControl pageItem"\x3e\r\n  \x3c!--\r\n  \x3cdiv data-dojo-attach-point\x3d"prevPage" class\x3d"pageBtn pageDisabled pageItem"\x3e\x3c-prevPage\x3c/div\x3e\r\n  \x3cdiv class\x3d"pageItem" data-dojo-attach-point\x3d"currentPage"\x3e1\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"nextPage" class\x3d"pageBtn pageItem"\x3enextPage-\x3e\x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3c!-- \x3cdiv data-dojo-attach-point\x3d"addNextPage"\x3eLoad more data(Test)\x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValueProvider.html":'\x3cdiv\x3e\r\n    \x3c!-- \x3cdiv data-dojo-attach-point\x3d"valueproviderStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3cdiv class\x3d"predefined-btn"  data-dojo-attach-point\x3d\'indexBtn\'\x3e\r\n        \x3cdiv class\x3d"tip jimu-ellipsis" title\x3d"predefined" data-dojo-attach-point\x3d\'indexBtnTips\'\x3epredefined\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d\'valueProviderPopupNode\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/EditTable.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${Nls.value}"\x3e${Nls.value}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${CommonNls.label}"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"${CommonNls.defaults}"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis" title\x3d"${CommonNls.actions}"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked, dblclick:_onListContentDblClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValuePopup.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e',
"url:dojox/form/resources/_CheckedMultiSelectMenuItem.html":'\x3ctr class\x3d"dijitReset dijitMenuItem" dojoAttachPoint\x3d"focusNode" role\x3d"menuitemcheckbox" tabIndex\x3d"-1"\r\n\tdojoAttachEvent\x3d"ondijitclick:_onClick"\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\r\n\t\t\x3e\x3cdiv src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitMenuItemIcon ${_iconClass}" dojoAttachPoint\x3d"iconNode"\r\n\t\t\t\x3e\x3cinput class\x3d"dojoxCheckedMultiSelectCheckBoxInput" dojoAttachPoint\x3d"inputNode" type\x3d"${_type.type}"\r\n\t\t/\x3e\x3c/div\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" dojoAttachPoint\x3d"containerNode,labelNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" dojoAttachPoint\x3d"accelKeyNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26nbsp;\x3c/td\r\n\x3e\x3c/tr\x3e',
"url:dojox/form/resources/_CheckedMultiSelectItem.html":'\x3cdiv class\x3d"dijitReset ${baseClass}"\r\n\t\x3e\x3cinput class\x3d"${baseClass}Box" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"checkBox" \r\n\t\tdata-dojo-attach-event\x3d"_onClick:_changeBox" type\x3d"${_type.type}" data-dojo-props\x3d\'disabled:${disabled}, readOnly:${readOnly}\' baseClass\x3d"${_type.baseClass}"\r\n\t/\x3e\x3cdiv class\x3d"dijitInline ${baseClass}Label" data-dojo-attach-point\x3d"labelNode" data-dojo-attach-event\x3d"onclick:_onClick"\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/form/resources/CheckedMultiSelect.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"comboButtonNode"\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"selectNode" class\x3d"dijit dijitReset dijitInline ${baseClass}Wrapper" data-dojo-attach-event\x3d"onmousedown:_onMouseDown,onclick:focus"\r\n\t\t\x3e\x3cselect class\x3d"${baseClass}Select dojoxCheckedMultiSelectHidden" multiple\x3d"true" data-dojo-attach-point\x3d"containerNode,focusNode"\x3e\x3c/select\r\n\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"wrapperDiv"\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"relativeDatesTr" class\x3d"relative-start-date-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"startDateOptions"\x3e${nls.dateOptions}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"custom_start_date" data-dojo-props\x3d\'title:"${nls.custom}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.custom}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"today_start_date" data-dojo-props\x3d\'title:"${nls.today}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.today}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"yesterday_start_date" data-dojo-props\x3d\'title:"${nls.yesterday}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.yesterday}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"tomorrow_start_date" data-dojo-props\x3d\'title:"${nls.tomorrow}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.tomorrow}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"relativeDatesTr" class\x3d"relative-end-date-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"endDateOptions"\x3e${nls.endDateOptions}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"custom_end_date" data-dojo-props\x3d\'title:"${nls.custom}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.custom}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"today_end_date" data-dojo-props\x3d\'title:"${nls.today}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.today}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"yesterday_end_date" data-dojo-props\x3d\'title:"${nls.yesterday}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.yesterday}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"tomorrow_end_date" data-dojo-props\x3d\'title:"${nls.tomorrow}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.tomorrow}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnDelete" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnAdd" aria-label\x3d"\'${nls.addText}\'" class\x3d"jimu-icon jimu-icon-add" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"*now":function(F){F(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/keys dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main esri/main dojo/ready".split(" "),function(F,r,z,x,n,v,t,m,h,p,e,c,f,b,d,a,g,l,q,
A,u,k,w,y,C,D,G,H,L,T){function K(){var U=window.location.search,Y={query:!0};if(""===U)return{};U=q.queryToObject(U.substr(1));for(var ca in U)Y[ca]||(U[ca]=C.sanitizeHTML(U[ca]));return U}function O(U,Y){I=U;"loadingPageChange"!==Y&&h.setStyle(jimuConfig.mainPageId,"display","block")}g={};var I;window.topic=d;A.defaults.io.timeout=18E4;"function"!==typeof a.getAll&&(a.getAll=function(U){var Y=[];(U=a(U))&&Y.push(U);return Y});window.jimuNls=H;window.apiNls=L.bundle;w.setProtocolErrorHandler(function(){return!0});
w=C.getAncestorWindow();var P=!1,Q=/^http(s?):\/\//gi;try{P=0===w.location.href.indexOf("https://")}catch(U){}u.setRequestPreCallback(function(U){U.content&&U.content.printFlag&&(U.timeout=3E5);P&&(U.url=U.url.replace(Q,"//"));if(-1!==U.url.indexOf("/queryRelatedRecords?")){var Y=U.url,ca=A.defaults.io.proxyUrl;ca&&0===U.url.indexOf(ca+"?")&&(Y=U.url.replace(ca+"?",""));C.isHostedService(Y)||(U.url=U.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(U.url)&&(U.preventCache=(new Date).getTime());
window.isBuilder||!I||I.mode||(I.appProxies&&0<I.appProxies.length&&e.some(I.appProxies,function(da){var ma=da.sourceUrl;da=da.proxyUrl;P&&(ma=ma.replace(Q,"//"),da=da.replace(Q,"//"));if(0<=U.url.indexOf(ma))return U.url=U.url.replace(ma,da),!0}),I.map.appProxy&&e.some(I.map.appProxy.proxyItems,function(da){if(!da.useProxy||!da.proxyUrl)return!1;var ma=da.sourceUrl;da=da.proxyUrl;P&&(ma=ma.replace(Q,"//"),da=da.replace(Q,"//"));if(0<=U.url.indexOf(ma))return U.url=U.url.replace(ma,da),!0}));return U});
c(window,"mousedown",function(U){C.isInNavMode()&&(h.removeClass(document.body,"jimu-nav-mode"),window.isMoveFocusWhenInit=!1);if(b.isMiddle(U))return U.preventDefault(),U.stopPropagation(),U.returnValue=!1});c(window,"keydown",function(U){U.keyCode!==f.TAB||C.isInNavMode()||h.addClass(document.body,"jimu-nav-mode")});String.prototype.startWith=function(U){return this.substr(0,U.length)===U?!0:!1};String.prototype.endWith=function(U){return this.substr(this.length-U.length,U.length)===U?!0:!1};Number.isNaN=
Number.isNaN||function(U){return U!==U};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=p.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.19";window.productVersion="Online 8.4";window.isBuilder?(d.subscribe("app/appConfigLoaded",O),d.subscribe("app/appConfigChanged",O)):(d.subscribe("appConfigLoaded",O),d.subscribe("appConfigChanged",
O));if(p=C.has("ie"))9<p?h.addClass(document.body,"ie-nav-mode"):h.addClass(document.body,"ie-low-nav-mode"),10<p&&h.addClass(document.body,"ie-gte-10");g.initApp=function(){console.log("jimu.js init...");var U=K();if(U.mobileBreakPoint)try{var Y=parseInt(U.mobileBreakPoint,10);jimuConfig.breakPoints[0]=Y}catch(ca){console.error("mobileBreakPoint URL parameter must be a number.",ca)}U.mode&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"));z.getInstance(x.getInstance());
n.getInstance();v.getInstance();t.getInstance();m.getInstance();Y=r.getInstance({mapId:jimuConfig.mapId,urlParams:U},jimuConfig.layoutId);U=F.getInstance(U);Y.startup();U.loadConfig();D(["dynamic-modules/preload"]);T(function(){setTimeout(function(){h.removeClass(document.body,"dj_a11y")},50)})};return g});