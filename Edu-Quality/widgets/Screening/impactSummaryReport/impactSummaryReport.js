// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/impactSummaryReport/impactSummaryReport.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTImpactSummaryLayerContainer" data-dojo-attach-point\x3d"impactSummaryLayerContainer"\x3e\r\n    \x3c!--title \x26 field icon table--\x3e\r\n    \x3cdiv class\x3d"esriCTLayerTitleAndFieldParentContainer esriCTLayerSectionDisabled esriCTCursorPointer"\r\n      data-dojo-attach-point\x3d"layerTitleAndFieldParentContainer" tabindex\x3d"0" role\x3d"group"\x3e\r\n      \x3c!--title \x26 field icon row--\x3e\r\n      \x3cdiv class\x3d"esriCTLayerTitleAndFieldChildContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTLayerPanelIcon esriCTLayerPanelExpand" data-dojo-attach-point\x3d"layerSectionIcon" tabindex\x3d"-1"\r\n          role\x3d"button" aria-expanded\x3d"false" aria-label\x3d"${nls.reportsTab.expandCollapseIconLabel}"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--title--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerTitle" data-dojo-attach-point\x3d"impactSummaryLayerTitle"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--field icon--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerFieldIcon esriCTImpactSummaryLayerFieldIconDisabled"\r\n          data-dojo-attach-point\x3d"impactSummaryLayerField" title\x3d"${nls.reportsTab.attributeChooserTooltip}"\r\n          tabindex\x3d"-1" aria-label\x3d"${nls.reportsTab.attributeChooserTooltip}" role\x3d"button"\x3e\x3c/div\x3e\r\n        \x3c!--feature count--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerFeatureCount esriCTLoadingIcon"\r\n          data-dojo-attach-point\x3d"impactSummaryLayerFeatureCount"\x3e\x3c/div\x3e\r\n        \x3c!-- Hint for count exceeding max record count --\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerMaxRecordHint esriCTHidden" title\x3d"${nls.reportsTab.unableToAnalyzeText}"\r\n          data-dojo-attach-point\x3d"impactSummaryLayerMaxRecordHint" tabindex\x3d"-1" role\x3d"button"\r\n          aria-label\x3d"${nls.reportsTab.unableToAnalyzeText}"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--layer description--\x3e\r\n    \x3cdiv class\x3d"esriCTImpactSummaryLayerDetailContainer esriCTHidden"\r\n      data-dojo-attach-point\x3d"impactSummaryLayerDetailContainer"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"impactSummaryLayerDetailsMsg" class\x3d"esriCTImpactSummaryLayerDetailsMsg"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"impactSummaryLayerDetails" class\x3d"esriCTImpactSummaryLayerDetails"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noFieldsSelectedContainer" class\x3d"esriCTNoFieldSelectedContainer esriCTHidden"\x3e\r\n        ${nls.reportsTab.noFieldsSelected}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./impactSummaryReport.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/array dojo/Evented jimu/BaseWidget dojo/on dojo/dom-class dojo/dom-attr esri/geometry/geometryEngine esri/geometry/Polyline esri/SpatialReference esri/graphic dojo/dom-construct esri/tasks/query esri/tasks/QueryTask dojo/Deferred ../geometryUtils ../conversionUtils ../highlightSymbolUtils ../fieldSelectorPopup/fieldSelectorPopup esri/lang jimu/utils dojo/query dojo/number dojo/string dojo/promise/all dojo/keys dijit/focus dojo/_base/event".split(" "),
function(J,K,L,k,t,M,N,v,h,m,y,O,P,E,x,F,G,C,H,Q,R,S,T,w,I,B,U,V,u,D,z){return J([N,L,M],{baseClass:"jimu-widget-screening-impactSummaryReport",templateString:K,_feetUnitData:[],_squareFeetUnitData:[],_milesUnitData:[],_acresUnitData:[],_metersUnitData:[],_squareMetersUnitData:[],_kilometersUnitData:[],_squareKilometersUnitData:[],_squareMilesUnitData:[],_hectaresUnitData:[],_printCompleteData:{},_printData:{},_feetUnitInfo:[],_squareFeetUnitInfo:[],_countUnitInfo:[],_milesUnitInfo:[],_acresUnitInfo:[],
_metersUnitInfo:[],_squareMetersUnitInfo:[],_kilometersUnitInfo:[],_squareKilometersUnitInfo:[],_hectaresUnitInfo:[],_squareMilesUnitInfo:[],_intersectFeatureCount:0,isExceedingMaxRecordCount:!1,intersectingFeatureIdsToTolerance:[],intersectingFeatureIds:[],_lengthAnalysisUnitsArray:[],_areaAnalysisUnitsArray:[],_aggregatedFeatureGeometries:[],_featureIntersectResultArr:[],_layerDefinition:null,_isFieldsSelectorClick:!1,_selectedFields:[],constructor:function(b){this._feetUnitData=[];this._squareFeetUnitData=
[];this._milesUnitData=[];this._acresUnitData=[];this._metersUnitData=[];this._squareMetersUnitData=[];this._kilometersUnitData=[];this._squareKilometersUnitData=[];this._squareMilesUnitData=[];this._hectaresUnitData=[];this._printCompleteData={};this._printData={};this._feetUnitInfo=[];this._squareFeetUnitInfo=[];this._countUnitInfo=[];this._milesUnitInfo=[];this._acresUnitInfo=[];this._metersUnitInfo=[];this._squareMetersUnitInfo=[];this._kilometersUnitInfo=[];this._squareKilometersUnitInfo=[];
this._hectaresUnitInfo=[];this._squareMilesUnitInfo=[];this._intersectFeatureCount=0;this.isExceedingMaxRecordCount=!1;this.intersectingFeatureIdsToTolerance=[];this.intersectingFeatureIds=[];this._lengthAnalysisUnitsArray=[];this._areaAnalysisUnitsArray=[];this._aggregatedFeatureGeometries=[];this._featureIntersectResultArr=[];this._layerDefinition=null;this._isFieldsSelectorClick=!1;this._selectedFields=[];k.mixin(this,b)},postCreate:function(){this._layerDefinition=w.getFeatureLayerDefinition(this.featureLayer);
this._lengthAnalysisUnitsArray=["Feet","Miles","Meters","Kilometers"];this._areaAnalysisUnitsArray="SquareFeet Acres SquareMeters SquareKilometers Hectares SquareMiles".split(" ");this.own(v(this.impactSummaryLayerMaxRecordHint,"click",k.hitch(this,function(b){b.stopPropagation();b.preventDefault();this.isExceedingMaxRecordCount?this.emit("showMessage",this.nls.reportsTab.unableToAnalyzeText):this.emit("showMessage",this.nls.reportsTab.layerNotVisibleText)})));this._attachEventToNodes()},_displayLayerNotVisibleText:function(){h.add(this.impactSummaryLayerFeatureCount,
"esriCTHidden");h.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled");m.set(this.impactSummaryLayerMaxRecordHint,"title",this.nls.reportsTab.layerNotVisibleText);h.remove(this.impactSummaryLayerMaxRecordHint,"esriCTHidden");h.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth");this._showMessage(this.nls.reportsTab.layerNotVisibleText)},generateReport:function(b,a,c){var e,f;var d=new C;this._setAttributeToFeatureLayerContainer();this._setFeatureLayerTitle();this._attachEventToLayerTitle();
this._aggregatedFeatureGeometries=[];this._featureIntersectResultArr=[];(f=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))&&f.isVisible()&&f.isInScale()||f&&!f.isVisible()&&!this.config.allowVisibleLayerAnalysisOnly||f&&!f.isInScale()&&!this.config.allowVisibleLayerAnalysisOnly||this.isFeatureCollectionLayer?this._getIntersectingFeaturesCount(c).then(k.hitch(this,function(g){this._getIntersectingFeaturesCount(a).then(k.hitch(this,function(l){this.intersectingFeatureIdsToTolerance=this._getUniqueIds(g,
l);this._getIntersectingFeaturesCount(b).then(k.hitch(this,function(q){this.intersectingFeatureIds=k.clone(q);q=this._getUniqueIds(l,q);if(this.isExceedingMaxRecordCount)this._setFeatureLayerIntersectFeatureCount(q.length),this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null),this._printData={},this._printData=k.clone(this._printCompleteData),this._showMessage(this.nls.reportsTab.unableToAnalyzeText),h.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled"),this._showReport(),
d.resolve(this._getReportLayerDetails([]));else{var n=b||a;this._getFeatureByChunks(q,n).then(k.hitch(this,function(p){var r=[];this._featureIntersectResultArr=[];t.forEach(p,k.hitch(this,function(A){b&&y.touches(A.geometry,b)||r.push(A)}));p=[];this._setFeatureLayerIntersectFeatureCount(r.length);0<r.length?("esriGeometryPolyline"!==this.featureLayer.geometryType&&"esriGeometryPolygon"!==this.featureLayer.geometryType||!b?p=r:(e=this._polygonToPolyline(b),p=this._getCutOrWithInFeatures(e,r,b)),this._createLayerDetails(p,
this.featureLayer.geometryType),this._filterPrintDataObjAccToConfiguredFields(this.configuredField),h.remove(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")):(this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null),this._printData={},this._printData=k.clone(this._printCompleteData),this._showMessage(this.nls.reportsTab.noDetailsAvailableText));h.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled");this._featureIntersectResultArr=p;this._showReport();
d.resolve(this._getReportLayerDetails(p))}))}}))}))})):(this._displayLayerNotVisibleText(),d.resolve());return d.promise},retainLastSelectedField:function(){null!==this.retainSelectedFieldsArr&&(this._selectedFields=this.retainSelectedFieldsArr,h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._filterFieldsForReport(this.retainSelectedFieldsArr))},_getReportLayerDetails:function(b){var a={};a.id=this.id;a.featureLayerId=this.featureLayer.id;a.features=b;a.printInfo=
{};a.printInfo.isExceedingMaxRecordCount=this.isExceedingMaxRecordCount;a.printInfo.featureCount=this._intersectFeatureCount;a.printInfo.info=this._printData;a.printInfo.feetUnitInfo=this._feetUnitInfo;a.printInfo.squareFeetUnitInfo=this._squareFeetUnitInfo;a.printInfo.countUnitInfo=this._countUnitInfo;a.printInfo.milesUnitInfo=this._milesUnitInfo;a.printInfo.acresUnitInfo=this._acresUnitInfo;a.printInfo.metersUnitInfo=this._metersUnitInfo;a.printInfo.squareMetersUnitInfo=this._squareMetersUnitInfo;
a.printInfo.kilometersUnitInfo=this._kilometersUnitInfo;a.printInfo.squareKilometersUnitInfo=this._squareKilometersUnitInfo;a.printInfo.squareMilesUnitInfo=this._squareMilesUnitInfo;a.printInfo.hectaresUnitInfo=this._hectaresUnitInfo;a.printInfo.geometryType=this.featureLayer.geometryType;a.printInfo.groupbyfieldCheckBoxStatus=this.groupbyfieldCheckBoxStatus;return a},_setAttributeToFeatureLayerContainer:function(){m.set(this.impactSummaryLayerContainer,"featureLayerID",this.featureLayer.id)},_setFeatureLayerTitle:function(b){var a=
this.configuredLayerLabel;this.configuredLayerLabel||(a=this.configuredLayerLabel=this.featureLayer.name);if(b||0===b)a=U.substitute(this.nls.reportsTab.layerNameWithFeatureCount,{layerName:this.configuredLayerLabel,featureCount:b});m.set(this.impactSummaryLayerTitle,"innerHTML",w.sanitizeHTML(this.configuredLayerLabel));m.set(this.impactSummaryLayerTitle,"title",w.sanitizeHTML(this.configuredLayerLabel));m.set(this.layerTitleAndFieldParentContainer,"aria-label",a)},_attachEventToLayerTitle:function(){this.own(v(this.layerTitleAndFieldParentContainer,
"click",k.hitch(this,function(b){h.contains(b.target,"esriCTImpactSummaryLayerFieldIcon")?h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget():h.contains(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled")||this._showOrHideLayerDetailsContainer()})))},_createFieldSelectorPopupWidget:function(){this._isFieldsSelectorClick=!0;if(this._fieldSelectorWidget)this._fieldSelectorWidget.onFieldsSelectorClick();else this._fieldSelectorWidget=
new S({outFields:this.configuredField,popupTitle:this.configuredLayerLabel,fieldTitle:this.nls.reportsTab.selectReportFieldTitle,nls:this.nls,appConfig:this.appConfig,retainSelectedFieldsArr:this.retainSelectedFieldsArr}),v(this._fieldSelectorWidget,"onFieldSelectComplete",k.hitch(this,function(b){this._selectedFields=b;this._filterFieldsForReport(b)})),v(this._fieldSelectorWidget,"onCancel",k.hitch(this,function(){this._selectedFields=null!==this.retainSelectedFieldsArr?this.retainSelectedFieldsArr:
this._getAllFields()})),v(this._fieldSelectorWidget,"onClose",k.hitch(this,function(){this._selectedFields=null!==this.retainSelectedFieldsArr?this.retainSelectedFieldsArr:this._getAllFields()})),this._fieldSelectorWidget.startup();"DartTheme"===this.appConfig.theme.name&&h.add(this._fieldSelectorWidget.fieldsPopup.domNode,"esriCTDartPanel")},_getAllFields:function(){var b;var a=[];for(b in this.configuredField)this.configuredField.hasOwnProperty(b)&&(this.configuredField[b].hasOwnProperty("fieldName")&&
a.push(this.configuredField[b].fieldName),this.configuredField[b].hasOwnProperty("name")&&a.push(this.configuredField[b].name));return a},getSelectedFields:function(){return h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")?0<this._selectedFields.length?this._selectedFields:0===this._selectedFields.length&&null===this.retainSelectedFieldsArr?this._getAllFields():0===this._selectedFields.length&&0===this.retainSelectedFieldsArr.length?[]:this._getAllFields():this._isFieldsSelectorClick&&
0<this._selectedFields.length?this._selectedFields:this._isFieldsSelectorClick&&0===this._selectedFields.length?[]:!this._isFieldsSelectorClick&&0<this._selectedFields.length?this._selectedFields:this._isFieldsSelectorClick||0!==this._selectedFields.length||null!==this.retainSelectedFieldsArr?this._isFieldsSelectorClick||0!==this._selectedFields.length||0!==this.retainSelectedFieldsArr.length?this._getAllFields():[]:this._getAllFields()},_filterFieldsForReport:function(b){var a=k.clone(this.configuredField),
c;for(c in this.configuredField)-1>=b.indexOf(c)&&delete a[c];this._filterPrintDataObjAccToConfiguredFields(a);(b=I(".esriCTAttrTableHighlighted",this.domNode.parentElement))&&0<b.length&&m.get(b[0],"esriCTLayerId")===this.featureLayer.id&&(h.remove(b[0],"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear());this._showReport();this.emit("printDataUpdated",{id:this.id,printData:this._printData})},_showOrHideLayerDetailsContainer:function(){h.toggle(this.layerTitleAndFieldParentContainer,
"esriCTBoldFont");h.toggle(this.impactSummaryLayerDetailContainer,"esriCTHidden");h.contains(this.layerSectionIcon,"esriCTLayerPanelExpand")?(h.replace(this.layerSectionIcon,"esriCTLayerPanelCollapse","esriCTLayerPanelExpand"),m.set(this.layerSectionIcon,"aria-expanded","true")):(h.replace(this.layerSectionIcon,"esriCTLayerPanelExpand","esriCTLayerPanelCollapse"),m.set(this.layerSectionIcon,"aria-expanded","false"))},_getIntersectingFeaturesCount:function(b){var a,c;var e=new C;if(b)if(this.isFeatureCollectionLayer){var f=
[];if(0<this.featureLayer.graphics.length)for(c=0;c<this.featureLayer.graphics.length;c++)(a=this.featureLayer.graphics[c].geometry?y.intersects(b,this.featureLayer.graphics[c].geometry):null)&&f.push(c);e.resolve(f)}else{var d;f=new F;a=new G(this.featureLayer.url);(d=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))&&(c=d.getFilter()?d.getFilter():"1\x3d1");c&&(f.where=c);f.geometry=b;a.executeForIds(f,k.hitch(this,function(g){g&&0!==g.length?(g.length>this.maxFeaturesForAnalysis&&(h.remove(this.impactSummaryLayerMaxRecordHint,
"esriCTHidden"),h.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth"),this.isExceedingMaxRecordCount=!0,this.emit("exceedingMaxRecordCount")),e.resolve(g)):e.resolve([])}),k.hitch(this,function(){e.resolve([])}))}else e.resolve([]);return e.promise},_getFeatureByChunks:function(b,a){var c=new C;var e=[];var f=this.featureLayer.maxRecordCount;if(this.isFeatureCollectionLayer)e.push(this._getIntersectFeature(b,a));else for(;0<b.length;)e.push(this._getIntersectFeature(b.splice(0,f),a));
V(e).then(k.hitch(this,function(d){var g=[];t.forEach(d,k.hitch(this,function(l){g=g.concat(l)}));c.resolve(g)}));return c.promise},_getIntersectFeature:function(b,a){var c;var e=new C;if(this.isFeatureCollectionLayer){var f=[];if(0<this.featureLayer.graphics.length)for(b=0;b<this.featureLayer.graphics.length;b++)(c=this.featureLayer.graphics[b].geometry?y.intersects(a,this.featureLayer.graphics[b].geometry):null)&&f.push(this.featureLayer.graphics[b]);e.resolve(f.splice(0,this.maxFeaturesForAnalysis))}else f=
new F,f.outFields=["*"],f.returnGeometry=!0,f.objectIds=b,f.outSpatialReference=a.spatialReference,a=new G(this.featureLayer.url),a.execute(f,k.hitch(this,function(d){d.features?e.resolve(d.features):e.resolve([])}),k.hitch(this,function(){e.resolve([])}));return e.promise},_setFeatureLayerIntersectFeatureCount:function(b){this._intersectFeatureCount=B.format(b);h.remove(this.impactSummaryLayerFeatureCount,"esriCTLoadingIcon");m.set(this.impactSummaryLayerFeatureCount,"innerHTML","("+this._intersectFeatureCount+
")");m.set(this.impactSummaryLayerFeatureCount,"title","("+this._intersectFeatureCount+")");this._setFeatureLayerTitle(b)},_isDonutPolygon:function(b){var a=!1;"polygon"===b.type&&1<b.rings.length&&t.forEach(b.rings,k.hitch(this,function(c){b.isClockwise(c)||(a=!0)}));return a},_getCutOrWithInFeatures:function(b,a,c){var e=[];for(var f=0;f<b.length;f++)for(var d=0;d<a.length;d++){var g=y.cut(a[d].geometry,b[f]);0<g.length?e=this._getWithinFeature({cutFeatureArr:g,bufferGeometry:c,featureIntersectResultArr:e,
intersectFeatureArr:a,index:d}):(y.within(a[d].geometry,c)?g=new E(a[d].geometry,null,a[d].attributes):(g=y.intersect(a[d].geometry,c),g=new E(g,null,a[d].attributes,null)),e.push(g))}return e},_getWithinFeature:function(b){var a;var c=b.cutFeatureArr;var e=b.bufferGeometry;var f=b.intersectFeatureArr;var d=b.featureIntersectResultArr;var g=b.index;t.forEach(c,k.hitch(this,function(l){y.within(l,e)&&(a=new E(l,null,f[g].attributes),d.push(a))}));return d},_polygonToPolyline:function(b){var a,c;var e=
[];var f=new O(new P({wkid:102100}));for(c=0;c<b.rings.length;c++){var d=[];for(a=0;a<b.rings[c].length;a++)d.push(b.rings[c][a]);f.addPath(d)}e.push(f);return e},_updateFormattedAttribute:function(b){t.forEach(b,k.hitch(this,function(a,c){var e;var f=a.attributes[this.featureLayer.objectIdField];var d=null;-1===this.intersectingFeatureIds.indexOf(f)&&(e=!0);this.isFeatureCollectionLayer||(f=this.layerInfosObj.getLayerInfoById(this.featureLayer.id),d=f.originOperLayer.popupInfo);f=this._getFormatedAttrs(k.clone(a.attributes),
this.featureLayer.fields,d);b[c].setAttributes(f);t.forEach(this.featureLayer.fields,k.hitch(this,function(g){b[c].attributes.hasOwnProperty(g.name)||(b[c].attributes[g.name]=this.nls.reportsTab.noDataText);if(b[c].attributes.hasOwnProperty(g.name)){var l=b[c].attributes[g.name];void 0===l||""===l||null===l?b[c].attributes[g.name]=this.nls.reportsTab.noDataText:""===k.trim(l.toString())&&(b[c].attributes[g.name]=this.nls.reportsTab.noDataText)}}));if(e&&"esriGeometryPolygon"===this.featureLayer.geometryType)this._squareFeetUnitData.push(0),
this._acresUnitData.push(0),this._squareMetersUnitData.push(0),this._squareKilometersUnitData.push(0),this._squareMilesUnitData.push(0),this._hectaresUnitData.push(0);else if(e&&"esriGeometryPolyline"===this.featureLayer.geometryType)this._feetUnitData.push(0),this._milesUnitData.push(0),this._metersUnitData.push(0),this._kilometersUnitData.push(0);else switch(this.featureLayer.geometryType){case "esriGeometryPolygon":a=H.getAreaOfGeometry(a.geometry);this._squareFeetUnitData.push(a.squareFeet);this._acresUnitData.push(a.acres);
this._squareMetersUnitData.push(a.squareMeters);this._squareKilometersUnitData.push(a.squareKilometer);this._squareMilesUnitData.push(a.squareMiles);this._hectaresUnitData.push(a.hectares);break;case "esriGeometryPolyline":a=H.getLengthOfGeometry(a.geometry),this._feetUnitData.push(a.feet),this._milesUnitData.push(a.miles),this._metersUnitData.push(a.meters),this._kilometersUnitData.push(a.kilometers)}}));return b},_getFieldText:function(b,a){return b.label?b.label:b.alias?b.alias:a},_createLayerDetails:function(b,
a){var c,e;var f=Object.keys(this.configuredField).length;b=this._updateFormattedAttribute(b);this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null);for(e in this.configuredField){var d=this.configuredField[e];d=this._getFieldText(d,e);this._printCompleteData.cols.push(d);for(d=0;d<b.length;d++)switch((c=b[d].attributes[e])||0===c?this._pushDataInPrintDataObj(null,d,c):this._pushDataInPrintDataObj(null,d,""),a){case "esriGeometryPolyline":this._printCompleteData.cols.length===f&&(this._feetUnitInfo.push(this._feetUnitData[d]),
this._milesUnitInfo.push(this._milesUnitData[d]),this._metersUnitInfo.push(this._metersUnitData[d]),this._kilometersUnitInfo.push(this._kilometersUnitData[d]));break;case "esriGeometryPolygon":this._printCompleteData.cols.length===f&&(this._squareFeetUnitInfo.push(this._squareFeetUnitData[d]),this._acresUnitInfo.push(this._acresUnitData[d]),this._squareMetersUnitInfo.push(this._squareMetersUnitData[d]),this._squareKilometersUnitInfo.push(this._squareKilometersUnitData[d]),this._squareMilesUnitInfo.push(this._squareMilesUnitData[d]),
this._hectaresUnitInfo.push(this._hectaresUnitData[d]));break;case "esriGeometryPoint":this._printCompleteData.cols.length===f&&this._countUnitInfo.push(1)}}},_pushDataInPrintDataObj:function(b,a,c){b?(this._printCompleteData={},this._feetUnitInfo=[],this._squareFeetUnitInfo=[],this._countUnitInfo=[],this._milesUnitInfo=[],this._acresUnitInfo=[],this._metersUnitInfo=[],this._squareMetersUnitInfo=[],this._kilometersUnitInfo=[],this.squareKilometersUnitInfo=[],this.squareMilesUnitInfo=[],this._hectaresUnitInfo=
[],this._printCompleteData.title=b,this._printCompleteData.rows=[],this._printCompleteData.cols=[]):(c===this.nls.reportsTab.noDataText&&(c="\x3ci\x3e"+c+"\x3c/i\x3e"),this._printCompleteData.rows[a]||this._printCompleteData.rows.push([]),this._printCompleteData.rows[a].push(c))},_filterPrintDataObjAccToConfiguredFields:function(b){var a,c;this._printData={};this._printData=k.clone(this._printCompleteData);for(a=this._printData.cols.length-1;0<=a;--a){var e=!1;for(c in b)switch(this._printData.cols[a]){case b[c].label:e=
!0;break;case b[c].alias:e=!0;break;case c:e=!0}if(!e)for(this._printData.cols.splice(a,1),e=0;e<this._printData.rows.length;e++)this._printData.rows[e].splice(a,1)}},_getFormatedAttrs:function(b,a,c){function e(g){if(c&&T.isDefined(c.fieldInfos))for(var l=0,q=c.fieldInfos.length;l<q;l++){var n=c.fieldInfos[l];if(n.fieldName===g)return n.format}return null}var f=[null,void 0,""],d={};t.forEach(a,k.hitch(this,function(g,l){if(-1===f.indexOf(b[g.name])){var q="esriFieldTypeDate"===g.type,n=g.name;if("esriFieldTypeDate"===
a[l].type)d[n]=w.fieldFormatter.getFormattedDate(b[g.name],e(g.name));else if("esriFieldTypeDouble"===a[l].type||"esriFieldTypeSingle"===a[l].type||"esriFieldTypeInteger"===a[l].type||"esriFieldTypeSmallInteger"===a[l].type)d[n]=this._getFormattedNumber(b[g.name],e(g.name));q||(d[n]=n in d?d[n]:b[g.name],(g=w.getDisplayValueForCodedValueOrSubtype(this._layerDefinition,g.name,b))&&g.isCodedValueOrSubtype&&g.hasOwnProperty("displayValue")&&-1===f.indexOf(g.displayValue)&&(g=g.displayValue,d[n]=g||isFinite(g)?
g:""))}}));return d},_getFormattedNumber:function(b,a){if("number"===typeof b){var c=(b.toString().split(".")[1]||"").length;return(b=w.localizeNumberByFieldInfo(b,{format:{places:a&&"number"===typeof a.places?parseInt(a.places,10):c,digitSeparator:a&&a.digitSeparator}}))||""}return b},_getArrayIndex:function(b,a){var c,e,f=[];for(c=0;c<b.length;++c)if(a.length===b[c].length){var d=b[c];for(e=0;e<a.length&&a[e]===d[e];)++e;e===a.length&&f.push(c)}return f},getSum:function(b,a){b=(a&&0<a.length?t.filter(b,
function(c,e){return-1<a.indexOf(e)}):b).reduce(function(c,e){return c+e},0);return.01<b?Q.honourPopupRounding(2,b):b},_getAggregatedColTitle:function(b){switch(b){case "esriGeometryPoint":var a=this.nls.reportsTab.featureCountText;break;case "esriGeometryPolyline":a=this.nls.reportsTab.featureLengthText;break;case "esriGeometryPolygon":a=this.nls.reportsTab.featureAreaText}return a},_getUnitsForGeometry:function(b,a){switch(b){case "esriGeometryPoint":var c="";break;case "esriGeometryPolyline":c=
this._getAnalysisUnitForGeometry(a,b);break;case "esriGeometryPolygon":c=this._getAnalysisUnitForGeometry(a,b)}return c},_getAnalysisUnitForGeometry:function(b,a){switch(b){case "Feet":case "SquareFeet":var c="esriGeometryPolygon"===a?this.nls.units.feetAbbr+"\x26sup2":this.nls.units.feetAbbr;break;case "Miles":case "Acres":c="esriGeometryPolygon"===a?this.nls.units.acresAbbr:this.nls.units.milesAbbr;break;case "Meters":case "SquareMeters":c="esriGeometryPolygon"===a?this.nls.units.metersAbbr+"\x26sup2":
this.nls.units.metersAbbr;break;case "Kilometers":case "SquareKilometers":c="esriGeometryPolygon"===a?this.nls.units.kilometersAbbr+"\x26sup2":this.nls.units.kilometersAbbr;break;case "Hectares":c="esriGeometryPolygon"===a?this.nls.reportsTab.hectaresAbbr:this.nls.units.kilometersAbbr;break;case "SquareMiles":c="esriGeometryPolygon"===a?this.nls.units.milesAbbr+"\x26sup2":this.nls.units.milesAbbr}return c},_showMessage:function(b){x.empty(this.impactSummaryLayerDetails);m.set(this.impactSummaryLayerDetailsMsg,
"innerHTML",b);h.add(this.impactSummaryLayerDetailsMsg,"esriCTLayerDetailCenterText")},_showReport:function(){var b,a,c=[];var e=this._printData;x.empty(this.impactSummaryLayerDetails);if(!e.cols.length&&0<e.rows.length)this._showMessage(this.nls.reportsTab.noFieldsSelected);else if(e.rows&&0<e.rows.length){m.set(this.impactSummaryLayerDetailsMsg,"innerHTML","");h.remove(this.impactSummaryLayerDetailsMsg,"esriCTLayerDetailCenterText");var f=[];var d={};for(a=0;a<e.rows.length;a++)if(this.groupbyfieldCheckBoxStatus){if(0>
f.indexOf(a)){var g=this._getArrayIndex(e.rows,e.rows[a]);d[a]=g;f=f.concat(g)}if(f.length===e.rows.length)break}else g=[],g.push(a),d[a]=g;f={rows:[],cols:k.clone(e.cols)};a=this._getAggregatedColTitle(this.featureLayer.geometryType);"esriGeometryPoint"===this.featureLayer.geometryType?f.cols.push(a):"esriGeometryPolyline"===this.featureLayer.geometryType?(f.cols.push(a),f.cols.push(a),f.cols.push(a),f.cols.push(a)):"esriGeometryPolygon"===this.featureLayer.geometryType&&(f.cols.push(a),f.cols.push(a),
f.cols.push(a),f.cols.push(a),f.cols.push(a),f.cols.push(a));for(b in d){a=k.clone(e.rows[parseInt(b,10)]);if("esriGeometryPolyline"===this.featureLayer.geometryType){a.push(this.getSum(this._feetUnitInfo,d[parseInt(b,10)]));a.push(this.getSum(this._milesUnitInfo,d[parseInt(b,10)]));a.push(this.getSum(this._metersUnitInfo,d[parseInt(b,10)]));var l=this.getSum(this._kilometersUnitInfo,d[parseInt(b,10)]);a.push(l)}else if("esriGeometryPolygon"===this.featureLayer.geometryType){a.push(this.getSum(this._squareFeetUnitInfo,
d[parseInt(b,10)]));a.push(this.getSum(this._acresUnitInfo,d[parseInt(b,10)]));a.push(this.getSum(this._squareMetersUnitInfo,d[parseInt(b,10)]));a.push(this.getSum(this._squareKilometersUnitInfo,d[parseInt(b,10)]));var q=this.getSum(this._hectaresUnitInfo,d[parseInt(b,10)]);a.push(q);a.push(this.getSum(this._squareMilesUnitInfo,d[parseInt(b,10)]))}else if("esriGeometryPoint"===this.featureLayer.geometryType){var n=this.getSum(this._countUnitInfo,d[parseInt(b,10)]);a.push(n)}f.rows.push(a);this._featureIntersectResultArr&&
("esriGeometryPolyline"===this.featureLayer.geometryType?c.push({features:this._getAggregatedFeatures(d[b]),sortValue:l}):"esriGeometryPolygon"===this.featureLayer.geometryType?c.push({features:this._getAggregatedFeatures(d[b]),sortValue:q}):"esriGeometryPoint"===this.featureLayer.geometryType&&c.push({features:this._getAggregatedFeatures(d[b]),sortValue:n}))}this._renderReport(f,c)}},_getAggregatedFeatures:function(b){var a=[];t.forEach(b,k.hitch(this,function(c){a.push(this._featureIntersectResultArr[c])}));
return a},_sortFeatureArray:function(b,a){var c=b.length-1;return b[c]<a[c]?1:b[c]>a[c]?-1:0},_sortArrayByKey:function(b,a){return b.sortValue<a.sortValue?1:b.sortValue>a.sortValue?-1:0},_createTemplateNode:function(){var b=x.create("div",{"class":"esriCTImpactSummaryLayerDetailMainNode",tabindex:0,role:"presentation"},this.impactSummaryLayerDetails);var a=x.create("table",{"class":"esriCTAttrTable esriCTCursorPointer",cellpadding:"0px",cellspacing:"0px"},b);x.create("div",{"class":"esriCTInfoDataSeparator"},
this.impactSummaryLayerDetails);this.own(v(a,"click",k.hitch(this,function(c){this._highlightSelection(c.currentTarget)})));this.own(v(b,"keydown",k.hitch(this,function(c){c.keyCode!==u.ENTER&&c.keyCode!==u.SPACE||this._highlightSelection(c.currentTarget.children[0])})));return a},_renderReport:function(b,a){b.rows&&0<b.rows.length&&(b.rows=b.rows.sort(this._sortFeatureArray),this._aggregatedFeatureGeometries=a=a.sort(this._sortArrayByKey),t.forEach(b.rows,k.hitch(this,function(c,e){var f;var d=this._createTemplateNode();
m.set(d,"esriCTTableIndex",e);m.set(d,"esriCTLayerId",this.featureLayer.id);t.forEach(c,k.hitch(this,function(g,l){f=x.create("tr",{valign:"top"},d);var q=x.create("td",{"class":"esriCTAttrName"},f);var n=x.create("td",{"class":"esriCTAttrValue"},f);var p=w.fieldFormatter.getFormattedUrl(g);g=b.cols[l]+": ";var r=p;switch(this.featureLayer.geometryType){case "esriGeometryPoint":var A=1;break;case "esriGeometryPolyline":A=4;break;case "esriGeometryPolygon":A=6}if(l>=c.length-A){l-=c.length-A;.01<=
p?(p="esriGeometryPoint"!==this.featureLayer.geometryType?B.format(p,{places:2}):B.format(p),"esriGeometryPolyline"===this.featureLayer.geometryType?r=g+p+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._lengthAnalysisUnitsArray[l]):"esriGeometryPolygon"===this.featureLayer.geometryType?r=g+p+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._areaAnalysisUnitsArray[l]):"esriGeometryPoint"===this.featureLayer.geometryType&&(r=g+p+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,
null))):.01>p&&0!==p?"esriGeometryPolyline"===this.featureLayer.geometryType?r=g+"  \x3c "+B.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._lengthAnalysisUnitsArray[l]):"esriGeometryPolygon"===this.featureLayer.geometryType?r=g+"  \x3c "+B.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._areaAnalysisUnitsArray[l]):"esriGeometryPoint"===this.featureLayer.geometryType&&(r=g+"  \x3c "+B.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,
null)):r=g+" "+this.nls.reportsTab.notApplicableText;g="";h.add(q,"esriCTReportsTabInfoData");p="esriGeometryPolyline"===this.featureLayer.geometryType?"esriCTFieldDistinct"+this._lengthAnalysisUnitsArray[l]+"UnitData":"esriCTFieldDistinct"+this._areaAnalysisUnitsArray[l]+"UnitData";h.add(n,"esriCTInfoDataMeasurement esriCTReportsTabInfoData");if("esriGeometryPolyline"===this.featureLayer.geometryType){switch(this._lengthAnalysisUnitsArray[l]){case "Feet":case "Miles":case "Meters":case "Kilometers":h.add(n,
p),h.add(n,"esriCTEsriGeometryPolyline")}this.config.lengthUnits!==this._lengthAnalysisUnitsArray[l]&&h.add(n,"esriCTHidden")}if("esriGeometryPolygon"===this.featureLayer.geometryType){switch(this._areaAnalysisUnitsArray[l]){case "SquareFeet":case "Acres":case "SquareMeters":case "SquareKilometers":case "Hectares":case "SquareMiles":h.add(n,p),h.add(n,"esriCTEsriGeometryPolygon")}this.config.areaUnits!==this._areaAnalysisUnitsArray[l]&&h.add(n,"esriCTHidden")}}m.set(q,"innerHTML",g);m.set(n,"innerHTML",
r)}))})))},_getUniqueIds:function(b,a){if(0===b.length)return a;if(0===a.length)return b;t.forEach(b,k.hitch(this,function(c){c=a.indexOf(c);-1!==c&&a.splice(c,1)}));return b.concat(a)},_highlightSelection:function(b){var a;h.contains(b,"esriCTAttrTableHighlighted")?(h.remove(b,"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear()):((a=I(".esriCTAttrTableHighlighted",this.domNode.parentElement))&&0<a.length&&h.remove(a[0],"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear(),
h.add(b,"esriCTAttrTableHighlighted"),b=m.get(b,"esriCTTableIndex"),b=this._aggregatedFeatureGeometries[parseInt(b,10)].features,t.forEach(b,k.hitch(this,function(c){c=R.getHighLightSymbol(c,this.featureLayer);this.highlightGraphicsLayer.add(c)})))},_attachEventToNodes:function(){var b=this.own(v.pausable(this.layerTitleAndFieldParentContainer,"keydown",k.hitch(this,function(a){if(a.keyCode===u.ENTER||a.keyCode===u.SPACE)z.stop(a),this._setFocus(),b[0].pause()})));this.own(v(this.layerSectionIcon,
"keydown",k.hitch(this,function(a){if(a.keyCode===u.ENTER||a.keyCode===u.SPACE)z.stop(a),h.contains(this.layerTitleAndFieldParentContainer,"esriCTImpactSummaryLayerFieldIcon")?h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget():h.contains(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled")||this._showOrHideLayerDetailsContainer();a.keyCode===u.ESCAPE&&(z.stop(a),this._removeFocus(),b[0].resume())})));this.own(v(this.impactSummaryLayerField,
"keydown",k.hitch(this,function(a){if(a.keyCode===u.ENTER||a.keyCode===u.SPACE)z.stop(a),h.contains(a.target,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget();a.keyCode===u.ESCAPE&&(z.stop(a),this._removeFocus(),b[0].resume())})));this.own(v(this.impactSummaryLayerMaxRecordHint,"keydown",k.hitch(this,function(a){if(a.keyCode===u.ENTER||a.keyCode===u.SPACE)z.stop(a),this.isExceedingMaxRecordCount?this.emit("showMessage",this.nls.reportsTab.unableToAnalyzeText):this.emit("showMessage",
this.nls.reportsTab.layerNotVisibleText);a.keyCode===u.ESCAPE&&(z.stop(a),this._removeFocus(),b[0].resume())})))},_removeFocus:function(){this._restrictFocus();this.emit("initializeAccessibility");this._focusOutCurrentNode();D.focus(this.layerTitleAndFieldParentContainer)},_setFocus:function(){this._allowFocus();this._setFirstFocusNode();this._setLastFocusNode();this._setFocusOnFirstNode()},_restrictFocus:function(){m.set(this.layerSectionIcon,"tabindex","-1");m.set(this.impactSummaryLayerMaxRecordHint,
"tabindex","-1");m.set(this.impactSummaryLayerField,"tabindex","-1")},_allowFocus:function(){m.set(this.layerSectionIcon,"tabindex","1");h.contains(this.impactSummaryLayerMaxRecordHint,"esriCTHidden")||m.set(this.impactSummaryLayerMaxRecordHint,"tabindex","1");h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||m.set(this.impactSummaryLayerField,"tabindex","1")},_setFirstFocusNode:function(){w.initFirstFocusNode(this.domNodeObj,this.layerSectionIcon)},_setLastFocusNode:function(){h.contains(this.impactSummaryLayerField,
"esriCTImpactSummaryLayerFieldIconDisabled")?h.contains(this.impactSummaryLayerMaxRecordHint,"esriCTHidden")?w.initLastFocusNode(this.domNodeObj,this.layerSectionIcon):w.initLastFocusNode(this.domNodeObj,this.impactSummaryLayerMaxRecordHint):w.initLastFocusNode(this.domNodeObj,this.impactSummaryLayerField)},_focusOutCurrentNode:function(){D.curNode&&D.curNode.blur()},_setFocusOnFirstNode:function(){this._focusOutCurrentNode();D.focus(this.layerSectionIcon)}})});