// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang jimu/BaseWidget dojo/on esri/symbols/PictureMarkerSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/graphic esri/Color esri/geometry/Circle".split(" "),function(k,l,m,n,p,f,g,q,h,r){var d=null;var e=k([m],{constructor:function(b,a,c){this.id="widget-myLocation-compass-"+(new Date).getTime();this.map=a;this.folderUrl=b;this.config=c;this._debug=0;this.inherited(arguments)},show:function(b,a){if(this.map.spatialReference.isWebMercator()||
4326===this.map.spatialReference)!0===this.config.useCompass&&this._showDirection(a),!0===this.config.useAccCircle&&this._showAccCircle(b,a)},_showDirection:function(b){if(b.useTracking){this._destroyDirectionHandler();var a;"ondeviceorientationabsolute"in window?a="deviceorientationabsolute":"ondeviceorientation"in window&&(a="deviceorientation");this._directionHandler=n(window,a,l.hitch(this,this._watchMobileLocation,b))}},_watchMobileLocation:function(b,a){if(a){if(a.absolute&&null!==a.alpha&&
"undefined"!==typeof a.alpha)var c=a.alpha;else a.webkitCompassHeading?c=360-a.webkitCompassHeading:(console.log("Could not retrieve absolute orientation"),this._debug&&(c=0));this._debug&&(document.querySelector(".jimu-title").innerText=this._flag1+this._flag2+"_alpha\x3d"+c);"undefined"!==typeof c&&b.highlightGraphic.setSymbol(new p({url:this.folderUrl+"/images/compass.png",width:36,height:36,angle:c}))}},_showAccCircle:function(b,a){this._destroyAccCircle();if((a=a.highlightGraphic)&&a._graphicsLayer){var c=
a.geometry;b=b.position.coords.accuracy/this.map.getResolution();b=new r({center:c,radius:b});b=new q(b,new f(f.STYLE_SOLID,new g(g.STYLE_SOLID,new h([94,164,255,.2]),1),new h([16,119,255,.2])));a._graphicsLayer.add(b);this._accCircle=b;this._accCircleGraphicsLayer=a._graphicsLayer}},clean:function(){this._destroyDirectionHandler();this._destroyAccCircle()},destroy:function(){this.clean();this.inherited(arguments)},_destroyDirectionHandler:function(){this._directionHandler&&(this._directionHandler.remove&&
this._directionHandler.remove(),this._directionHandler=null)},_destroyAccCircle:function(){this._accCircleGraphicsLayer&&this._accCircleGraphicsLayer.remove&&this._accCircle&&(this._accCircleGraphicsLayer.remove(this._accCircle),this._accCircle=null)}});e.getInstance=function(b,a,c){null===d&&(d=new e(b,a,c));return d};return e});