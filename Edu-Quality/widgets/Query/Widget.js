// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Query/TaskSetting":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./TaskSetting.html dojo/on dojo/keys dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/promise/all jimu/filterUtils jimu/dijit/FilterParameters ./utils jimu/utils ./SingleQueryLoader ./SpatialFilterByDrawing jimu/dijit/SpatialFilterByFeatures esri/tasks/query esri/dijit/PopupTemplate jimu/dijit/formSelect".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r,D,u,F,x,L){return B([C,Q,H,l,m],{baseClass:"query-task-setting",templateString:w,askForValues:!1,_defaultRelationship:"SPATIAL_REL_INTERSECTS",nls:null,map:null,currentAttrs:null,layerInfosObj:null,postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0;this.nls.back=window.jimuNls.common.back},postCreate:function(){this.inherited(arguments);this._initSelf()},run:function(){var q=this._getCleanClonedCurrentAttrs(this.currentAttrs);
q.query.relationship=this._getRestRelationship();var J=this.getWhere(),v=this.getGeometry();h([J,v]).then(c.hitch(this,function(z){this.deactivate();q.query.where=z[0];q.query.geometry=z[1];if("function"===typeof this.onApply)this.onApply(q)}),c.hitch(this,function(z){console.error(z)}))},hideTempLayers:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.hideTempLayers();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.hideTempLayers()},showTempLayers:function(){this.spatialFilterByDrawing&&
this.spatialFilterByDrawing.showTempLayers();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.showTempLayers()},_getCleanClonedCurrentAttrs:function(q){var J=D.getCleanCurrentAttrsTemplate(),v=null,z;for(z in q)if("queryTr"!==z&&"query"!==z&&"layerObject"!==z)if(v=q[z],"relationshipPopupTemplates"===z){for(var b in v)v[b]=new L(v[b].toJson());J[z]=v}else J[z]=c.clone(v);J.queryTr=q.queryTr;J.query.maxRecordCount=q.query.maxRecordCount;return J},onGetQueryResponse:function(){this.deactivate();
this._tryResetSpatialFilterByDrawing();this._tryResetSpatialFilterByFeatures()},getWhere:function(){var q=new k,J=this._getWhereInfo();if(1===J.status){var v=this.currentAttrs.config.webMapLayerId;if(v){var z=null;z=I.isTable(this.currentAttrs.layerInfo)?this.layerInfosObj.getTableInfoById(v):this.layerInfosObj.getLayerInfoById(v);v="";z&&(v=z.getFilter());z=J.where;v&&(z="("+v+") AND ("+J.where+")");q.resolve(z)}else q.resolve(J.where)}else q.reject("Can't get a valid sql");return q},_getWhereInfo:function(){var q=
{status:0,where:""};if(this.askForValues){var J=this.filterParams.getFilterExpr();J&&"string"===typeof J?(q.status=1,q.where=J):(q.status=-1,q.where=null)}else q.status=1,q.where=this.currentAttrs.config.filter.expr;1!==q.status||q.where||(q.where="1\x3d1");return q},_updateExecuteButtonStatus:function(){var q=this._isValidWhereToExecute()&&this._isValidGeometryToExecute()&&this._isValidLayerNameToExecute();q?a.removeClass(this.btnExecute,"disabled"):a.addClass(this.btnExecute,"disabled");return q},
_isValidWhereToExecute:function(){return 0<this._getWhereInfo().status},_isValidLayerNameToExecute:function(){return this.layerNameTextBox.get("value")},_isValidGeometryToExecute:function(){var q=this.spatialTypeSelect.get("value");if("currentMapExtent"!==q){if("drawing"===q)return!!this.spatialFilterByDrawing.getGeometryInfo().geometry;if("useFeatures"===q)return this.spatialFilterByFeatures.isValidSearchDistance()}return!0},getGeometry:function(){var q=new k,J=this.spatialTypeSelect.get("value");
"currentMapExtent"===J?q.resolve(this.map.extent):"drawing"===J?(J=this.spatialFilterByDrawing.getGeometryInfo(),0>J.status?q.reject("Invalid search distance"):(0===J.status&&console.log("User doesn't draw anything"),q.resolve(J.geometry))):"useFeatures"===J?this.spatialFilterByFeatures.getGeometryInfo().then(c.hitch(this,function(v){-2===v.status?q.reject("Invalid search distance"):(-1===v.status?console.log("User doesn't select a layer"):0===v.status&&console.log("User doesn't select any features"),
q.resolve(v.geometry))}),c.hitch(this,function(v){q.reject(v)})):q.resolve(null);return q},deactivate:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.deactivate();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.deactivate()},clearAllGraphics:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.clearAllGraphics();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.clearAllGraphics()},canAutoRunning:function(){return this._canAttributeFilterAutoRunning()&&
this._canSpatialFilterAutoRunning()},_canAttributeFilterAutoRunning:function(){return 0<this._getWhereInfo().status&&!this.askForValues},_canSpatialFilterAutoRunning:function(){var q=this.spatialTypeSelect.getOptions()||[];return 0===q.length?!0:1===q.length?(q=this.spatialTypeSelect.get("value"),"drawing"!==q&&"useFeatures"!==q):!1},_initSelf:function(){var q=this.currentAttrs.config,J=this.currentAttrs.layerInfo,v=this.currentAttrs.layerObject||J,z=q.name||"";z=r.sanitizeHTML(z);this.taskNameDiv.innerHTML=
z;this.taskNameDiv.title=this.taskNameDiv.innerHTML;q.customResultName?this._showLayerNameContainer():this._hideLayerNameContainer();if(this.showFilterLabel){var b=this.criteiraLabel||"";b=r.sanitizeHTML(b);this.criteiraLabelDiv.innerHTML=b;this.criteiraLabelDiv.title=this.criteiraLabelDiv.innerHTML;b=this.spatialFilterLabel||"";b=r.sanitizeHTML(b);this.spatialFilterLabelDiv.innerHTML=b;this.spatialFilterLabelDiv.title=this.spatialFilterLabelDiv.innerHTML;this._showCriteiraLabelDiv();this._showSpatialFilterLabelDiv()}else this.criteiraLabelDiv.innerHTML=
"",this.criteiraLabelDiv.title="",this.spatialFilterLabelDiv.innerHTML="",this.spatialFilterLabelDiv.title="",this._hideCriteiraLabelDiv(),this._hideSpatialFilterLabelDiv();this.filterParams=new K;this.filterParams.placeAt(this.sqlDiv,"before");var n={ifDisplaySQL:!0};this.own(t(this.filterParams,"change",c.hitch(this,this._updateExecuteButtonStatus)));this.own(t(this.filterParams,"enter",c.hitch(this,this._onBtnApplyClicked)));b=c.clone(q.filter);b.wId="widgets_Query_Widget"+this.wId+"_"+this.id;
this.filterParams.build(q.url,v,b,q.webMapLayerId,this.id);v=new y;b=this.currentAttrs.config.filter;this.askForValues=v.isAskForValues(b);var p=!0;v=!1;if(this.askForValues){p=!0;b.displaySQL?this.sqlDiv.innerHTML=b.displaySQL:b.expr&&(this.sqlDiv.innerHTML=b.expr);if(b=this.filterParams.getFilterExpr(n))this.sqlDiv.innerHTML=b;this.own(t(this.filterParams,"change",c.hitch(this,function(){this.sqlDiv.innerHTML="";var T=this.filterParams.getFilterExpr(n);T&&this.currentAttrs.config.showSQL&&(this.sqlDiv.innerHTML=
T)})))}else this.currentAttrs.config.showSQL?p="1\x3d1"!==b.expr:(p=!1,v="1\x3d1"===b.expr),this.sqlDiv.innerHTML=b.displaySQL?b.displaySQL:b.expr;this.currentAttrs.config.showSQL?a.removeClass(this.sqlDiv,"not-visible"):(this.sqlDiv.innerHTML="",a.addClass(this.sqlDiv,"not-visible"));p?(a.removeClass(this.attributesSectionDiv,"not-visible"),(this.showFilterLabel&&""!==this.criteiraLabelDiv.innerHTML||this.currentAttrs.config.showSQL)&&a.setAttr(this.attributesSectionDiv,"tabindex","0")):a.addClass(this.attributesSectionDiv,
"not-visible");b=this.currentAttrs.config.spatialFilter;p=null;b||(b={});I.isTable(J)&&(b={});b.currentMapExtent&&(p={value:"currentMapExtent",label:this.nls.useCurrentExtentTip},this.spatialTypeSelect.addOption(p),b.currentMapExtent["default"]&&this.spatialTypeSelect.set("value",p.value));b.drawing&&(p={value:"drawing",label:this.nls.useDrawGraphicTip},this.spatialTypeSelect.addOption(p),b.drawing["default"]&&this.spatialTypeSelect.set("value",p.value),p=b.drawing.buffer,this.spatialFilterByDrawing=
new u({drawBoxOption:{map:this.map,geoTypes:b.drawing.geometryTypes},nls:this.nls,enableBuffer:!!p,distance:c.getObject("defaultDistance",!1,p)||0,unit:c.getObject("defaultUnit",!1,p)||""}),this.own(t(this.spatialFilterByDrawing,"change",c.hitch(this,this._updateExecuteButtonStatus))),this.spatialFilterByDrawing.placeAt(this.drawingSection));if(b.useFeatures){p={value:"useFeatures",label:this.nls.useFeaturesTip};this.spatialTypeSelect.addOption(p);b.useFeatures["default"]&&this.spatialTypeSelect.set("value",
p.value);p=b.useFeatures.buffer;var O=[];q.webMapLayerId&&O.push(q.webMapLayerId);this.spatialFilterByFeatures=new F({map:this.map,nls:this.nls,enableBuffer:!!p,distance:c.getObject("defaultDistance",!1,p)||0,unit:c.getObject("defaultUnit",!1,p)||"",showLoading:!1,ignoredFeaturelayerIds:O});this.spatialFilterByFeatures.tipNode&&a.setStyle(this.spatialFilterByFeatures.tipNode,"display","block");this.spatialFilterByFeatures.placeAt(this.featuresSection);this.own(t(this.spatialFilterByFeatures,"loading",
c.hitch(this,function(){this.domNode&&this.shelter.show()})));this.own(t(this.spatialFilterByFeatures,"unloading",c.hitch(this,function(){this.domNode&&this.shelter.hide()})));this.own(t(this.spatialFilterByFeatures,"search-distance-change",c.hitch(this,this._updateExecuteButtonStatus)));(q=b.useFeatures.relationships)&&0<q.length?e.forEach(q,c.hitch(this,function(T){this.relationshipSelect.addOption({value:T.relationship,label:T.label})})):this.relationshipSelect.addOption({value:this._defaultRelationship,
label:this._defaultRelationship})}b.fullLayerExtent&&(p={value:"fullLayerExtent",label:this.nls.noSpatialLimitTip},this.spatialTypeSelect.addOption(p),b.fullLayerExtent["default"]&&this.spatialTypeSelect.set("value",p.value));q=!0;b=this.spatialTypeSelect.getOptions()||[];0===b.length?(q=!1,this.spatialFilterTip.innerHTML=this.nls.noSpatialLimitTip):1===b.length?(q="fullLayerExtent"!==b[0].value,this.spatialFilterTip.innerHTML=b[0].label,a.addClass(this.spatialTypeSelect.domNode,"not-visible"),a.setAttr(this.spatialSectionDiv,
"tabindex","0")):q=!0;I.isTable(J)&&(q=!1);q?a.removeClass(this.spatialSectionDiv,"not-visible"):a.addClass(this.spatialSectionDiv,"not-visible");this._onSpatialTypeSelectChanged();v&&!q&&a.removeClass(this.noFilterTip,"not-visible");J=this._getBestQueryName(z);this.layerNameTextBox.set("value",J)},getQueryResultName:function(){return this.layerNameTextBox.get("value")},_getConstantRelationship:function(){var q=this._defaultRelationship;"useFeatures"===this.spatialTypeSelect.get("value")&&(q=this.relationshipSelect.get("value"));
return q},_getRestRelationship:function(){var q=this._getConstantRelationship();return x[q]},_onSpatialTypeSelectChanged:function(){var q=this.spatialTypeSelect.get("value");"drawing"===q?a.setStyle(this.drawingSection,"display","block"):(a.setStyle(this.drawingSection,"display","none"),this._tryResetSpatialFilterByDrawing());"useFeatures"===q?a.setStyle(this.featuresSection,"display","block"):(a.setStyle(this.featuresSection,"display","none"),this._tryResetSpatialFilterByFeatures());this.spatialTypeSelect.domNode.title=
"";q&&(q=this.spatialTypeSelect.getOptions(q))&&(this.spatialTypeSelect.domNode.title=q.label);this._updateExecuteButtonStatus()},_tryResetSpatialFilterByDrawing:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.reset()},_tryResetSpatialFilterByFeatures:function(){this.spatialFilterByFeatures&&this.spatialFilterByFeatures.reset()},_onBtnParamsBackClicked:function(){this._tryResetSpatialFilterByDrawing();this._tryResetSpatialFilterByFeatures();if("function"===typeof this.onBack)this.onBack()},
_onBtnParamsBackKeydown:function(q){q.keyCode!==M.ENTER&&q.keyCode!==M.SPACE||this._onBtnParamsBackClicked()},_getBestQueryName:function(q){for(var J=q=q?q+(" _"+this.nls.queryResult):q+this.nls.queryResult,v=e.map(this.map.graphicsLayerIds,c.hitch(this,function(b){return this.map.getLayer(b).name})),z=2;0<=e.indexOf(v,J);)J=q+"_"+z,z++;return J},_onLayerNameTextChanged:function(){this._updateExecuteButtonStatus()},_onBtnApplyClicked:function(){this._updateExecuteButtonStatus()&&this.run()},_onBtnApplyKeydown:function(q){q.keyCode!==
M.ENTER&&q.keyCode!==M.SPACE||this._onBtnApplyClicked()},_showLayerNameContainer:function(){a.setStyle(this.layerNameContainer,"display","block")},_hideLayerNameContainer:function(){a.setStyle(this.layerNameContainer,"display","none")},_showCriteiraLabelDiv:function(){a.setStyle(this.criteiraLabelDiv,"display","block")},_hideCriteiraLabelDiv:function(){a.setStyle(this.criteiraLabelDiv,"display","none")},_showSpatialFilterLabelDiv:function(){a.setStyle(this.spatialFilterLabelDiv,"display","block")},
_hideSpatialFilterLabelDiv:function(){a.setStyle(this.spatialFilterLabelDiv,"display","none")}})})},"widgets/Query/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred jimu/utils jimu/portalUrlUtils jimu/LayerInfos/LayerInfos esri/request esri/kernel esri/symbols/PictureMarkerSymbol esri/symbols/jsonUtils".split(" "),function(B,C,Q,H,l,m,w,t,M,k){return{getDefaultPopupInfo:function(c,a,e){var h={title:"",fieldInfos:[],description:null,showAttachments:!1,mediaInfos:[]};e=
!!e;if(c.displayField){var y=this._getRealFieldName(c.displayField,c);h.title="{"+y+"}"}else if(y=H.getObjectIdField(c))h.title="{"+y+"}";h.showAttachments=!!c.hasAttachments;y=c=c.fields;a||(y=C.filter(c,B.hitch(this,function(K){return"esriFieldTypeGeometry"!==K.type})));a=C.map(y,B.hitch(this,function(K){K=H.getDefaultPortalFieldInfo(K);K.visible=e;return K}));h.fieldInfos=a;return h},_getRealFieldName:function(c,a){c=c.toUpperCase();if(a.fields&&0<a.fields.length)for(var e=0;e<a.fields.length;e++)if(a.fields[e].name.toUpperCase()===
c)return a.fields[e].name;return""},getPortalFieldInfosWithoutShape:function(c,a){return C.filter(a,B.hitch(this,function(e){return(e=H.getFieldInfoByFieldName(c.fields,e.fieldName))?"esriFieldTypeGeometry"!==e.type:!0}))},getPopupInfoByAttributes:function(c,a){var e=this.getDefaultPopupInfo(c,!1),h=[],y={},K;for(K in a){h.push(K);var I=H.getFieldInfoByFieldName(c.fields,K).type;if("esriFieldTypeSingle"===I||"esriFieldTypeDouble"===I)I=a[K],null!==I&&void 0!==I&&(I=parseFloat(I),isNaN(I)||(I=I.toString().split("."),
2===I.length&&(y[K]=I[1].length)))}e.fieldInfos=C.filter(e.fieldInfos,B.hitch(this,function(r){var D=r.fieldName;y.hasOwnProperty(D)&&(r.format.places=y[D]);return h.indexOf(D)}));return e},upgradePopupToPopupInfo:function(c,a){var e=this.getDefaultPopupInfo(c,!1,!1);e.title=a.title||"";e.title=e.title.replace("${","{");if(a.fields){var h={};C.forEach(a.fields,B.hitch(this,function(y){h[y.name]=y}));C.forEach(e.fieldInfos,B.hitch(this,function(y){var K=y.fieldName,I=h[K];I&&(y.label=I.alias||y.label,
y.visible=!0,"image"===I.specialType&&(K="{"+K+"}",e.mediaInfos.push({title:"",type:"image",caption:y.label,value:{sourceURL:K,linkURL:K}})))}))}return e},isImageServiceLayer:function(c){return c.url&&-1<c.url.indexOf("/ImageServer")},isTable:function(c){return"Table"===c.type},getConfigWithValidDataSource:function(c){c=B.clone(c);var a=m.getInstanceSync();c.queries=C.filter(c.queries,B.hitch(this,function(e){return(e=e.webMapLayerId)?a.getLayerInfoById(e)?!0:!!a.getTableInfoById(e):!0}));return c},
removePopupInfoUnsupportFields:function(c,a){var e=C.map(c.fields,B.hitch(this,function(h){return h.name}));a.fieldInfos&&0<a.fieldInfos.length&&(a.fieldInfos=C.filter(a.fieldInfos,B.hitch(this,function(h){return 0<=e.indexOf(h.fieldName)})))},overridePopupTemplateMethodGetAttachments:function(c,a,e){c.getAttachments=function(h){var y=new Q;try{var K=h.attributes[e],I=a+"/"+K+"/attachments";h={url:I,content:{f:"json"},callbackParamName:"callback"};var r="",D=t.id.findCredential(a);D&&D.token&&(r=
"?token\x3d"+D.token);w(h).then(function(u){u=u.attachmentInfos;C.forEach(u,function(F){F.url=I+"/"+F.id+r;F.objectId=K});y.resolve(u)},function(u){y.reject(u)})}catch(u){console.error(u)}return y}},isServiceSupportsOrderBy:function(c){var a=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsOrderBy&&(a=!0);return a},isServiceSupportsPagination:function(c){var a=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsPagination&&(a=!0);return a},isSupportObjectIds:function(c){var a=
0,e=H.getObjectIdField(c);c.currentVersion&&(a=parseFloat(c.currentVersion));return!!e&&(10<=a||c.hasOwnProperty("typeIdField"))},getQueryType:function(c){var a=-1;return a=this.isServiceSupportsOrderBy(c)&&this.isServiceSupportsPagination(c)?1:this.isSupportObjectIds(c)?2:3},getWebMapPopupInfoByUrl:function(c,a){var e=null;a=a.replace(/\/*$/g,"");var h=l.removeProtocol(a);C.some(c.operationalLayers,B.hitch(this,function(y){if(y&&y.url){var K=l.removeProtocol(y.url.replace(/\/*$/g,""));if(y.popupInfo){if(K===
h)return e=y.popupInfo,!0}else if(y.layers&&0<y.layers.length)return C.some(y.layers,B.hitch(this,function(I){return K+"/"+I.id===h?(e=y.popupInfo,!0):!1}))}return!1}));return e},getPopupInfoForRelatedLayer:function(c,a,e){(c=this.getWebMapPopupInfoByUrl(c,a))||(c=this.getDefaultPopupInfo(e,!1,!0));!c.title&&(e=H.getObjectIdField(e))&&(c.title="{"+e+"}");return c},dynamicUpdateConfigIcon:function(c,a){a=window.location.protocol+"//"+window.location.hostname+a;c.icon&&"object"===typeof c.icon?c.icon=
k.fromJson(c.icon):"string"===typeof c.icon&&(a=new M({yoffset:16,type:"picturemarkersymbol",url:c.icon?c.icon:a,width:24,height:24,size:16,xoffset:0}),c.icon=a)},tryGetLayerObject:function(c){var a=new Q;if(!c)return a.resolve(),a;c=this._tryGetLayerInfo(c);if(!c)return console.error("Invalid data source"),a.resolve(),a;c.getLayerObject().then(function(e){a.resolve(e)}.bind(this),function(e){a.reject(e)});return a},_tryGetLayerInfo:function(c){var a=m.getInstanceSync(),e=a.getLayerInfoById(c);e||
(e=a.getTableInfoById(c));return e}}})},"widgets/Query/SingleQueryLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred jimu/utils esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer".split(" "),function(B,C,Q,H,l,m,w,t){function M(){return{queryTr:null,config:null,layerInfo:null,relationshipLayerInfos:null,relationshipPopupTemplates:null,queryType:-1,query:{maxRecordCount:1E3,resultLayer:null,where:"",geometry:null,relationship:null,nextIndex:0,foundedNum:0,
allCount:0,objectIds:[]}}}B=B(null,{tempResultLayer:null,map:null,currentAttrs:null,constructor:function(k,c){this.map=k;this.currentAttrs=c;0<this.currentAttrs.layerInfo.maxRecordCount&&(this.currentAttrs.query.maxRecordCount=this.currentAttrs.layerInfo.maxRecordCount)},resetCurrentAttrs:function(){this.currentAttrs=M()},getCurrentAttrs:function(){return this.currentAttrs},executeQueryForFirstTime:function(){var k=null;k=this.currentAttrs.query.where;var c=this.currentAttrs.query.geometry;return k=
1===this.currentAttrs.queryType?this.doQuery_SupportOrderByAndPagination(k,c):2===this.currentAttrs.queryType?this.doQuery_SupportObjectIds(k,c):this.doQuery_NotSupportObjectIds(k,c)},executeQueryWhenScrollToBottom:function(){var k=null;1===this.currentAttrs.queryType?k=this.onResultsScroll_SupportOrderByAndPagination():2===this.currentAttrs.queryType&&(k=this.onResultsScroll_SupportObjectIds());return k},_isServiceSupportsOrderBy:function(k){var c=!1;k.advancedQueryCapabilities&&k.advancedQueryCapabilities.supportsOrderBy&&
(c=!0);return c},_isServiceSupportsPagination:function(k){var c=!1;k.advancedQueryCapabilities&&k.advancedQueryCapabilities.supportsPagination&&(c=!0);return c},_tryLocaleNumber:function(k){var c=l.localizeNumber(k);if(null===c||void 0===c)c=k;return c},_tryLocaleDate:function(k){var c=l.localizeDate(k);c||(c=k.toLocaleDateString());return c},_getLayerIndexByLayerUrl:function(k){var c=k.lastIndexOf("/");k=k.slice(c+1,k.length);return parseInt(k,10)},_getServiceUrlByLayerUrl:function(k){var c=k.lastIndexOf("/");
return k.slice(0,c)},_isSupportObjectIds:function(k){var c=0;k.currentVersion&&(c=parseFloat(k.currentVersion));return 10<=c||k.hasOwnProperty("typeIdField")},_isImageServiceLayer:function(k){return-1<k.indexOf("/ImageServer")},_isTable:function(k){return"Table"===k.type},_getBestQueryName:function(k){for(var c=k=k?k+(" _"+this.nls.queryResult):k+this.nls.queryResult,a=Q.map(this.map.graphicsLayerIds,C.hitch(this,function(h){return this.map.getLayer(h).name})),e=2;0<=Q.indexOf(a,c);)c=k+"_"+e,e++;
return c},getObjectIdsForAllRelatedRecordsAction:function(){var k=new H;if(this.currentAttrs.query.objectIds&&0<this.currentAttrs.query.objectIds.length)k.resolve(this.currentAttrs.query.objectIds);else if(1===this.currentAttrs.queryType)k=this._queryIds(this.currentAttrs.query.where,this.currentAttrs.query.geometry,this.currentAttrs.query.relationship);else if(3===this.currentAttrs.queryType){var c=this.currentAttrs.config.objectIdField,a=Q.map(this.currentAttrs.query.resultLayer.graphics,C.hitch(this,
function(e){return parseInt(e.attributes[c],10)}));k.resolve(a)}return k},doQuery_SupportOrderByAndPagination:function(k,c){var a=new H,e=C.hitch(this,function(y){console.error(y);a.reject(y)}),h=this.currentAttrs.query.relationship;this._queryCount(k,c,h).then(C.hitch(this,function(y){this.currentAttrs.query.allCount=y;if(0===y)a.resolve([]);else{this.currentAttrs.query.nextIndex=0;this.currentAttrs.query.foundedNum=0;var K=this.currentAttrs.query.maxRecordCount;this._queryWithPaginationAndOrder(k,
c,0,K,h).then(C.hitch(this,function(I){I=I.features;this.currentAttrs.query.nextIndex+=K;this.currentAttrs.query.foundedNum+=I.length;a.resolve(I)}),e)}}),e);return a},onResultsScroll_SupportOrderByAndPagination:function(){var k=new H,c=this.currentAttrs.query.nextIndex;if(this.currentAttrs.query.foundedNum>=this.currentAttrs.query.allCount)return k.resolve([]),k;var a=C.hitch(this,function(h){console.error(h);k.reject(h)}),e=this.currentAttrs.query.maxRecordCount;this._queryWithPaginationAndOrder(this.currentAttrs.query.where,
this.currentAttrs.query.geometry,c,e,this.currentAttrs.query.relationship).then(C.hitch(this,function(h){h=h.features;this.currentAttrs.query.nextIndex+=e;this.currentAttrs.query.foundedNum+=h.length;k.resolve(h)}),a);return k},doQuery_SupportObjectIds:function(k,c){var a=new H,e=C.hitch(this,function(y){console.error(y);a.reject(y)}),h=this.currentAttrs.query.relationship;this._queryIds(k,c,h).then(C.hitch(this,function(y){if(y&&0<y.length){var K=this.currentAttrs.query.allCount=y.length;this.currentAttrs.query.objectIds=
y;this.currentAttrs.query.nextIndex=0;this.currentAttrs.query.foundedNum=0;var I=this.currentAttrs.query.maxRecordCount,r=[];r=K>I?y.slice(0,I):y;this._queryByObjectIds(r,!0,h).then(C.hitch(this,function(D){D=D.features;this.currentAttrs.query.nextIndex+=r.length;this.currentAttrs.query.foundedNum+=D.length;a.resolve(D)}),C.hitch(this,function(D){e(D)}))}else this.currentAttrs.query.allCount=0,a.resolve([])}),e);return a},onResultsScroll_SupportObjectIds:function(){var k=new H,c=this.currentAttrs.query.objectIds,
a=this.currentAttrs.query.nextIndex;if(this.currentAttrs.query.foundedNum>=this.currentAttrs.query.allCount)k.resolve([]);else{var e=c.slice(a,a+Math.min(c.length-a,this.currentAttrs.query.maxRecordCount));if(0===e.length)k.resolve([]);else return this._queryByObjectIds(e,!0,this.currentAttrs.query.relationship).then(C.hitch(this,function(h){h=h.features;this.currentAttrs.query.nextIndex+=e.length;this.currentAttrs.query.foundedNum+=h.length;k.resolve(h)}),C.hitch(this,function(h){k.reject(h)})),
k}},doQuery_NotSupportObjectIds:function(k,c){var a=new H;this._query(k,c,!0,this.currentAttrs.query.relationship).then(C.hitch(this,function(e){e=e.features;this.currentAttrs.query.allCount=e.length;a.resolve(e)}),C.hitch(this,function(e){console.error(e);a.reject(e)}));return a},getOutputFields:function(){var k=[];Q.forEach(this.currentAttrs.layerInfo.fields,C.hitch(this,function(c){c&&c.name&&"esriFieldTypeGeometry"!==c.type&&k.push(c.name)}));return k},_getObjectIdField:function(){return this.currentAttrs.config.objectIdField},
_getRequiredFieldNames:function(){var k=C.clone(this.currentAttrs.layerInfo);return(new t({layerDefinition:k,featureSet:null})).getOutFields()},_getPopupInfoFieldNames:function(){var k=[],c=[],a=Q.filter(this.currentAttrs.layerInfo.fields,C.hitch(this,function(h){return"esriFieldTypeGeometry"!==h.type})),e=this.currentAttrs.config.popupInfo;c=c.concat(this._getPlaceholderFieldNames(a,e.title));e.description?c=c.concat(this._getPlaceholderFieldNames(a,e.description)):e.fieldInfos&&0<e.fieldInfos.length&&
Q.forEach(e.fieldInfos,C.hitch(this,function(h){h.visible&&c.push(h.fieldName)}));e.mediaInfos&&0<e.mediaInfos.length&&Q.forEach(e.mediaInfos,C.hitch(this,function(h){c=c.concat(this._getPlaceholderFieldNames(a,h.title));c=c.concat(this._getPlaceholderFieldNames(a,h.caption));if(h=h.value){var y=h.fields;y&&0<y.length&&Q.forEach(y,C.hitch(this,function(K){c.push(K)}));h.normalizeField&&c.push(h.normalizeField);h.tooltipField&&c.push(h.tooltipField);h.sourceURL&&(c=c.concat(this._getPlaceholderFieldNames(a,
h.sourceURL)));h.linkURL&&(c=c.concat(this._getPlaceholderFieldNames(a,h.linkURL)))}}));Q.forEach(c,C.hitch(this,function(h){0>k.indexOf(h)&&k.push(h)}));return k},_getPlaceholderFieldNames:function(k,c){var a=[];if(c){var e=[];Q.forEach(k,C.hitch(this,function(h){h=h.name;0<=c.indexOf("{"+h+"}")&&e.push(h)}));Q.forEach(e,C.hitch(this,function(h){0>a.indexOf(h)&&a.push(h)}))}return a},_query:function(k,c,a,e){var h=new m;h.where=k;c&&(h.geometry=c);h.outSpatialReference=this.map.spatialReference;
h.returnGeometry=!!a;h.spatialRelationship=e;h.outFields=this.getOutputFields();return(new w(this.currentAttrs.config.url)).execute(h)},_queryIds:function(k,c,a){var e=new m;e.where=k;c&&(e.geometry=c);e.returnGeometry=!1;e.spatialRelationship=a;e.outSpatialReference=this.map.spatialReference;return(new w(this.currentAttrs.config.url)).executeForIds(e)},_queryByObjectIds:function(k,c,a){var e=new H,h=new m;h.returnGeometry=!!c;h.outSpatialReference=this.map.spatialReference;h.outFields=this.getOutputFields();
h.objectIds=k;h.spatialRelationship=a;(new w(this.currentAttrs.config.url)).execute(h).then(C.hitch(this,function(y){e.resolve(y)}),C.hitch(this,function(y){if(400===y.code){var K=this._getObjectIdField(),I="",r=k.length;Q.forEach(k,C.hitch(this,function(D,u){I+=K+" \x3d "+D;u!==r-1&&(I+=" OR ")}));this._query(I,null,c,a).then(C.hitch(this,function(D){e.resolve(D)}),C.hitch(this,function(D){e.reject(D)}))}else e.reject(y)}));return e},_queryCount:function(k,c,a){var e=new m;e.where=k;c&&(e.geometry=
c);e.returnGeometry=!1;e.outSpatialReference=this.map.spatialReference;e.spatialRelationship=a;return(new w(this.currentAttrs.config.url)).executeForCount(e)},_queryWithPaginationAndOrder:function(k,c,a,e,h){var y=new m;y.where=k;c&&(y.geometry=c);y.outSpatialReference=this.map.spatialReference;y.returnGeometry=!0;y.spatialRelationship=h;y.outFields=this.getOutputFields();y.start=a;y.num=e;(k=this.currentAttrs.config.orderByFields)&&0<k.length&&(y.orderByFields=k,k=Q.map(k,C.hitch(this,function(K){return K.split(" ")[0]})),
Q.forEach(k,C.hitch(this,function(K){0>y.outFields.indexOf(K)&&y.outFields.push(K)})));return(new w(this.currentAttrs.config.url)).execute(y)}});B.getCleanCurrentAttrsTemplate=M;return B})},"widgets/Query/SpatialFilterByDrawing":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/on dojo/Evented dojo/_base/html dojo/_base/lang jimu/symbolUtils jimu/dijit/DrawBox jimu/dijit/SearchDistance esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/geometry/geometryEngine".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K){return B([C,Q,H,m],{baseClass:"jimu-query-spatial-filter-drawing",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"drawBoxDiv"\x3e\x3c/div\x3e\x3cdiv style\x3d"margin-top: 15px;" data-dojo-attach-point\x3d"clearShapeCbx"data-dojo-props\x3d"checked:true" data-dojo-type\x3d"jimu/dijit/CheckBox"\x3e\x3c/div\x3e\x3cdiv class\x3d"search-distance-div" data-dojo-attach-point\x3d"searchDistanceDiv"\x3e\x3c/div\x3e\x3c/div\x3e',map:null,bufferLayer:null,
drawBoxOption:null,nls:null,enableBuffer:!0,distance:0,unit:"",postCreate:function(){this.inherited(arguments);this.clearShapeCbx.setLabel(this.nls.clearShapeTip);this.map=this.drawBoxOption.map;this.bufferLayer=new h;var I=e.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}),r=new y(I);this.bufferLayer.setRenderer(r);this.map.addLayer(this.bufferLayer);this.drawBoxOption.showClear=!0;this.drawBoxOption.keepOneGraphic=
!0;this.drawBox=new k(this.drawBoxOption);this.drawBox.setPolygonSymbol(I);I=M.getGreyPinMarkerSymbol();this.drawBox.setPointSymbol(I);this.drawBox.setLineSymbol(e.fromJson({color:[79,129,189,255],width:1.5,type:"esriSLS",style:"esriSLSDash"}));this.drawBox.placeAt(this.drawBoxDiv);this.own(l(this.drawBox,"user-clear",t.hitch(this,this._onDrawBoxClear)));this.own(l(this.drawBox,"draw-end",t.hitch(this,this._onDrawEnd)));this.drawBox.btnClear?w.removeClass(this.drawBox.btnClear,"jimu-float-trailing"):
w.addClass(this.drawBox.btnClear,"jimu-float-leading");this.searchDistance=new c({distance:this.distance,unit:this.unit});this.searchDistance.placeAt(this.searchDistanceDiv);this.enableBuffer?(this.searchDistance.enable(),this.own(l(this.searchDistance,"change",t.hitch(this,this._onSearchDistanceChange)))):(this.searchDistance.disable(),w.setStyle(this.searchDistanceDiv,"display","none"))},reset:function(I){this.clearShapeCbx.getValue()&&(this.drawBox.reset(),this.clearAllGraphics());I&&(this.searchDistance.reset(),
this.searchDistance.setDistance(this.distance),this.searchDistance.setUnit(this.unit))},clearAllGraphics:function(){this.drawBox.clear();this._clearBufferLayer()},hideTempLayers:function(){this.bufferLayer&&this.bufferLayer.hide();this.drawBox&&this.drawBox.hideLayer()},showTempLayers:function(){this.bufferLayer&&this.bufferLayer.show();this.drawBox&&this.drawBox.showLayer()},deactivate:function(){this.drawBox&&this.drawBox.deactivate()},isValidSearchDistance:function(){return 0<=this._getStatusOfSearchDistance()},
getGeometryInfo:function(){var I={status:0,geometry:null},r=this._getStatusOfSearchDistance();0>r?(I.status=-1,I.geometry=null,this.searchDistance.tryShowValidationError()):0===r?(I.geometry=this._getGeometryFromDrawBox(),I.status=I.geometry?1:0):0<r&&(0<this.bufferLayer.graphics.length&&(I.geometry=this.bufferLayer.graphics[0].geometry),I.status=I.geometry?1:0);return I},_getGeometryFromDrawBox:function(){var I=null,r=this.drawBox.getFirstGraphic();r&&(I=r.geometry);return I},_getGeometryFromBufferLayer:function(){var I=
null;0<this.bufferLayer.graphics.length&&(I=this.bufferLayer.graphics[0].geometry);return I},_getStatusOfSearchDistance:function(){return this.searchDistance.getStatus()},_onSearchDistanceChange:function(){this._updateBuffer()},_onDrawBoxClear:function(){this._clearBufferLayer()},_onDrawEnd:function(){this._updateBuffer()},_clearBufferLayer:function(){this.bufferLayer&&this.bufferLayer.clear();this.emit("change")},_updateBuffer:function(){this._clearBufferLayer();if(0<this._getStatusOfSearchDistance()){var I=
this._getGeometryFromDrawBox();if(I){var r=this.searchDistance.getData();I=K.simplify(I);var D=I.spatialReference,u=null;u=D.isWebMercator()||4326===D.wkid?K.geodesicBuffer(I,r.distance,r.bufferUnit,!0):K.buffer(I,r.distance,r.bufferUnit,!0);I=new a(u);this.bufferLayer.add(I)}}this.emit("change")},destroy:function(){this.bufferLayer&&this.map.removeLayer(this.bufferLayer);this.bufferLayer=null;this.inherited(arguments)}})})},"jimu/dijit/SearchDistance":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SearchDistance.html dojo/Evented dojo/_base/lang jimu/utils jimu/dijit/CheckBox esri/tasks/GeometryService jimu/dijit/formSelect dijit/form/NumberTextBox".split(" "),
function(B,C,Q,H,l,m,w,t,M,k){return B([C,Q,H,m],{baseClass:"jimu-dijit-searchdistance",templateString:l,lastMeters:0,tip:"",distance:0,unit:"",postMixInProperties:function(){this.inherited(arguments);this.nls=w.clone(window.jimuNls.units);this.tip||(this.tip=window.jimuNls.searchDistance.applySearchDistance)},postCreate:function(){this.inherited(arguments);this.cbx=new M({label:this.tip,onChange:w.hitch(this,this._onCbxChanged)});this.cbx.placeAt(this.cbxDiv);this.reset();this.setDistance(this.distance);
this.setUnit(this.unit);this.lastMeters=this.getMeters()},enable:function(){this.cbx.check()},disable:function(){this.cbx.uncheck()},isEnabled:function(){return this.cbx.getValue()},reset:function(){this.numberTextBox.set("value",0);this.unitSelect.set("value","MILES")},getData:function(){return{status:this.getStatus(),isEnabled:this.isEnabled(),distance:this.getDistance(),unit:this.getUnit(),bufferUnit:this.getUnitToBuffer(),meters:this.getMeters()}},getStatus:function(){if(this.isEnabled()){var c=
this.getDistance();c=0<c?1:0===c?0:-1}else c=0;return c},getMeters:function(){var c=0,a=this.getStatus();if(0<a){a=this.getDistance();var e=this.getUnit();"MILES"===e?c=1609.344*a:"KILOMETERS"===e?c=1E3*a:"FEET"===e?c=.3048*a:"METERS"===e?c=a:"YARDS"===e?c=.9144*a:"NAUTICAL_MILES"===e&&(c=1852*a);c=parseFloat(c.toFixed(3))}else 0===a?c=0:0>a&&(c=-1);return c},setDistance:function(c){"number"===typeof c&&0<=c&&this.numberTextBox.set("value",c)},setUnit:function(c){c&&"string"===typeof c&&this.unitSelect.set("value",
c)},tryShowValidationError:function(){this.numberTextBox.validate()||t.showValidationErrorTipForFormDijit(this.numberTextBox)},getDistance:function(){return this.numberTextBox.validate()?this.numberTextBox.get("value"):(t.showValidationErrorTipForFormDijit(this.numberTextBox),-1)},getUnit:function(){return this.unitSelect.get("value")},getUnitToBuffer:function(){var c="";switch(this.unitSelect.get("value")){case "MILES":c=k.UNIT_STATUTE_MILE;break;case "KILOMETERS":c=k.UNIT_KILOMETER;break;case "FEET":c=
k.UNIT_FOOT;break;case "METERS":c=k.UNIT_METER;break;case "YARDS":c=k.UNIT_INTERNATIONAL_YARD;break;case "NAUTICAL_MILES":c=k.UNIT_NAUTICAL_MILE}return c},_onCbxChanged:function(){this.cbx.getValue()?(this.numberTextBox.set("disabled",!1),this.unitSelect.set("disabled",!1)):(this.numberTextBox.set("disabled",!0),this.unitSelect.set("disabled",!0));this._emitEvent()},_onNumberTextBoxChanged:function(){this._emitEvent()},_onUnitSelectChanged:function(){this._emitEvent()},_emitEvent:function(){var c=
this.getData();c.meters!==this.lastMeters&&(this.lastMeters=c.meters,this.emit("change",c))}})})},"jimu/dijit/SpatialFilterByFeatures":function(){define("dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SpatialFilterByFeatures.html dojo/on dojo/Evented dojo/Deferred dojo/_base/html dojo/_base/lang jimu/utils jimu/Query jimu/dijit/CheckBox jimu/dijit/FeaturelayerChooserFromMap jimu/dijit/LayerChooserFromMapWithDropbox jimu/dijit/SearchDistance jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/geometry/geometryEngine jimu/dijit/FeatureSetChooserForSingleLayer".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r,D,u,F,x,L,q,J){C=C([Q,H,l,t],{baseClass:"jimu-dijit-spatial-filter-features",templateString:m,_bufferLayer:null,_defaultRelationship:"SPATIAL_REL_INTERSECTS",drawBox:null,selectionRadio:null,_selectionHandle:null,layerInfosObj:null,_layerAllFeaturesCache:null,map:null,types:null,enableBuffer:!1,distance:0,unit:"",showLoading:!1,ignoredFeaturelayerIds:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.spatialFilterByFeatures;
this.ignoredFeaturelayerIds||(this.ignoredFeaturelayerIds=[]);this._layerAllFeaturesCache={}},postCreate:function(){this.inherited(arguments);this.selectionRadio=new h({label:this.nls.selectedFeatures});this.selectionRadio.placeAt(this.selectionOptionDiv);this.selectionRadio.setStatus(!1);this.own(w(this.selectionRadio,"change",c.hitch(this,this._onRadioChanged)));k.setStyle(this.domNode,"position","relative");var v=F.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",
color:[54,93,141,255],width:1.5,type:"esriSLS"}});v=new L(v);this._bufferLayer=new x;this._bufferLayer.setRenderer(v);this.map.addLayer(this._bufferLayer);v=new y({createMapResponse:this.map.webMapResponse,types:this.types,showLayerFromFeatureSet:!0,onlyShowVisible:!1,updateWhenLayerInfosIsShowInMapChanged:!0,ignoredFeaturelayerIds:this.ignoredFeaturelayerIds});this.layerChooserFromMapWithDropbox=new K({label:this.nls.relatedLayer,layerChooser:v});this.layerChooserFromMapWithDropbox.placeAt(this.layerSelectDiv);
this.own(w(this.layerChooserFromMapWithDropbox,"selection-change",c.hitch(this,this._onLayerChanged)));this.layerInfosObj=r.getInstanceSync();this.own(w(this.layerInfosObj,"layerInfosIsShowInMapChanged",c.hitch(this,this._onLayerInfosIsShowInMapChanged)));this.searchDistance=new I({tip:window.jimuNls.searchDistance.applySearchDistanceToFeatures,distance:this.distance,unit:this.unit});this.searchDistance.placeAt(this.searchDistanceDiv);this.enableBuffer?(this.searchDistance.enable(),this.own(w(this.searchDistance,
"change",c.hitch(this,this._onSearchDistanceChange)))):(this.searchDistance.disable(),k.setStyle(this.searchDistanceDiv,"display","none"));this._onLayerChanged()},reset:function(v){v&&(this.searchDistance.reset(),this.searchDistance.setDistance(this.distance),this.searchDistance.setUnit(this.unit));this.clearAllGraphics()},hideTempLayers:function(){this._bufferLayer&&this._bufferLayer.hide();this.drawBox&&this.drawBox.hideLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.hideMiddleFeatureLayer()},
showTempLayers:function(){this._bufferLayer&&this._bufferLayer.show();this.drawBox&&this.drawBox.showLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.showMiddleFeatureLayer()},disable:function(v){v&&this._hideAllLayers()},enable:function(){this._showAllLayers()},deactivate:function(){this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.deactivate()},clearAllGraphics:function(){this._clearBufferLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.clearAllGraphics()},
setSelectedLayer:function(v){return this.layerChooserFromMapWithDropbox.setSelectedLayer(v)},getSelectedLayer:function(){return this._getSelectedLayerInfomation().layer},checkSelectedFeaturesRadio:function(){this.selectionRadio.getValue()||this.selectionRadio.check()},uncheckSelectedFeaturesRadio:function(){this.selectionRadio.getValue()&&this.selectionRadio.uncheck()},isValidSearchDistance:function(){return 0<=this.searchDistance.getStatus()},getGeometryInfo:function(v){var z=new M,b={status:null,
geometry:null};this._updateBuffer();if(0===this._getSelectedLayerInfomation().type)return b.status=-1,z.resolve(b),z;if(0>this.searchDistance.getData().status)return b.status=-2,z.resolve(b),z;this._getFeatures(v).then(c.hitch(this,function(){b.geometry=this._updateBuffer();b.status=b.geometry?1:0;z.resolve(b)}),c.hitch(this,function(n){z.reject(n)}));return z},getFeatureSet:function(v){var z=new M,b=null,n=this._getSelectedLayerInfomation().layer;n?this._getFeatures(v).then(c.hitch(this,function(p){b=
a.getFeatureSetByLayerAndFeatures(n,p);z.resolve(b)}),c.hitch(this,function(p){z.reject(p)})):z.resolve(b);return z},_getFeatures:function(){var v=new M,z=[],b=this._getSelectedLayerInfomation(),n=b.type;0===n?v.resolve(z):this.selectionRadio.getStatus()&&this.selectionRadio.getValue()?(z=b.layer.getSelectedFeatures(),v.resolve(z)):this.featureSetChooserForSingleLayer.isLoading()?v=this.featureSetChooserForSingleLayer.getFeatures():(z=this.featureSetChooserForSingleLayer.syncGetFeatures(),0<z.length?
v.resolve(z):3===n?(z=b.layer.graphics,v.resolve(z)):v=this._getAllFeaturesFromFeaturelayer(b.layer));return v},_getAllFeaturesFromFeaturelayer:function(v){var z=new M;if(this._layerAllFeaturesCache[v.id])z.resolve(this._layerAllFeaturesCache[v.id]);else{var b=a.getFeatureLayerDefinition(v);b||(b={currentVersion:v.currentVersion,fields:c.clone(v.fields)});this.emit("loading");b=new u;b.where=v.getDefinitionExpression()||"1\x3d1";b.geometry=null;b.outSpatialReference=this.map.spatialReference;b.returnGeometry=
!0;(new e({url:v.url,query:b})).getAllFeatures().then(c.hitch(this,function(n){this.emit("unloading");n?(n=n.features||[],this._layerAllFeaturesCache[v.id]=n,z.resolve(n)):z.reject("Can't get all features from featureLayer "+v.id)}),c.hitch(this,function(n){this.emit("unloading");z.reject(n)}))}return z},_syncGetFeatures:function(){var v=[],z=this._getSelectedLayerInfomation(),b=z.type;0!==b&&(this.selectionRadio.getStatus()&&this.selectionRadio.getValue()?v=z.layer.getSelectedFeatures():(v=this.featureSetChooserForSingleLayer.syncGetFeatures(),
0===v.length&&(3===b?v=z.layer.graphics:(z=this._layerAllFeaturesCache[z.layer.id])&&(v=z))));return v},isLoading:function(){return this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.isLoading()},_onLoading:function(){this.showLoading&&this.loading.show();this.emit("loading")},_onUnloading:function(){this.loading.hide();this.emit("unloading")},_showAllLayers:function(){this._bufferLayer&&this._bufferLayer.show()},_hideAllLayers:function(){this._bufferLayer&&this._bufferLayer.hide()},
_onRadioChanged:function(){this.selectionRadio.getValue()&&this.featureSetChooserForSingleLayer&&(this.featureSetChooserForSingleLayer.deactivate(),this.featureSetChooserForSingleLayer.clearAllGraphics());this._updateBuffer()},_getSelectedLayerInfomation:function(){var v=0,z=null,b=null,n=this.layerChooserFromMapWithDropbox.getSelectedItems();0<n.length&&(z=n[0]);z&&(b=z.layerInfo.layerObject,v=b.url?0<=this.map.graphicsLayerIds.indexOf(b.id)?1:2:3);return{type:v,layerItem:z,layer:b}},_onLayerChanged:function(){this.clearAllGraphics();
this._clearSelectionHandle();this._updateSelectedFeaturesCount();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.destroy();this.featureSetChooserForSingleLayer=null;var v=this._getSelectedLayerInfomation();0<v.type&&(this.featureSetChooserForSingleLayer=new J({map:this.map,featureLayer:v.layer,updateSelection:!1}),this._selectionHandle=w(v.layer,"selection-complete",c.hitch(this,function(){var z=this.selectionRadio.getStatus()&&this.selectionRadio.getValue();this._updateSelectedFeaturesCount();
z&&this._updateBuffer()})),this.own(w(this.featureSetChooserForSingleLayer,"user-clear",c.hitch(this,this._onUserClear))),this.own(w(this.featureSetChooserForSingleLayer,"loading",c.hitch(this,c.hitch(this,function(){this._clearBufferLayer();this._onLoading()})))),this.own(w(this.featureSetChooserForSingleLayer,"unloading",c.hitch(this,c.hitch(this,function(){this._onUnloading();this._updateBuffer()})))),this.featureSetChooserForSingleLayer.placeAt(this.featureSetChooserDiv),this.own(w(this.featureSetChooserForSingleLayer,
"draw-activate",c.hitch(this,function(){this.uncheckSelectedFeaturesRadio()}))));this._updateFeatureSetChooserForSingleLayerStatus();this._updateBuffer()},_onLayerInfosIsShowInMapChanged:function(){this._updateFeatureSetChooserForSingleLayerStatus()},_onSearchDistanceChange:function(){this._updateBuffer();this.emit("search-distance-change")},_updateFeatureSetChooserForSingleLayerStatus:function(){if(this.featureSetChooserForSingleLayer){var v=!1,z=this.featureSetChooserForSingleLayer.getFeatureLayer();
(z=this.layerInfosObj.getLayerInfoById(z.id))&&(v=z.isShowInMap());v?(this.featureSetChooserForSingleLayer.enable(),k.removeClass(this.featureSetChooserForSingleLayer.domNode,"not-visible")):(this.featureSetChooserForSingleLayer.disable(),this.featureSetChooserForSingleLayer.clearAllGraphics(),k.addClass(this.featureSetChooserForSingleLayer.domNode,"not-visible"),this._updateBuffer())}},_updateBuffer:function(){this._clearBufferLayer();var v=this.searchDistance.getData(),z=v.status,b=v.distance;v=
v.bufferUnit;if(0>z)return null;var n=this._syncGetFeatures(),p=null,O=[];B.forEach(n,c.hitch(this,function(T){T&&T.geometry&&O.push(T.geometry)}));0<O.length&&(p="polygon"===O[0].type?q.union(O):a.combineGeometries(O));return 0===z?p:p?(p=q.simplify(p),n=p.spatialReference,z=null,z=n.isWebMercator()||4326===n.wkid?q.geodesicBuffer(p,b,v,!0):q.buffer(p,b,v,!0),b=new D(z),this._bufferLayer.add(b),z):null},_onUserClear:function(){this.clearAllGraphics()},_clearBufferLayer:function(){this._bufferLayer&&
this._bufferLayer.clear()},_updateSelectedFeaturesCount:function(){this.selectionRadio.setStatus(!0);var v=this._getSelectedLayerInfomation(),z=0;v.layer&&(v=v.layer.getSelectedFeatures())&&(z=v.length);0===z?(this.selectionRadio.getValue()&&this.selectionRadio.uncheck(),this.selectionRadio.setStatus(!1),k.addClass(this.selectionOptionDiv,"not-visible")):k.removeClass(this.selectionOptionDiv,"not-visible");this.selectionRadio.setLabel(this.nls.selectedFeatures+(window.isRTL?"\x26rlm;":" ")+"("+z+
")")},_clearSelectionHandle:function(){this._selectionHandle&&this._selectionHandle.remove();this._selectionHandle=null},destroy:function(){this._bufferLayer&&this.map.removeLayer(this._bufferLayer);this._bufferLayer=null;this._clearSelectionHandle();this.inherited(arguments)}});C.NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES="NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES";return C})},"jimu/dijit/FeaturelayerChooserFromMap":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/html","dojo/_base/lang",
"./LayerChooserFromMap"],function(B,C,Q,H,l){return B([l],{baseClass:"jimu-featurelayer-chooser-from-map",declaredClass:"jimu.dijit.FeaturelayerChooserFromMap",types:null,showLayerFromFeatureSet:!1,showTable:!1,onlyShowVisible:!1,ignoredFeaturelayerIds:null,mustSupportStatistics:!1,ignoreVirtualLayer:!1,postMixInProperties:function(){this.inherited(arguments);this.ignoredFeaturelayerIds||(this.ignoredFeaturelayerIds=[]);this.basicFilter=H.hitch(this,this.basicFilter);this.filter=l.createFeaturelayerFilter(this.types,
this.showLayerFromFeatureSet,this.showTable,this.mustSupportStatistics);this.ignoreVirtualLayer&&(this.filter=l.andCombineFilters([this.filter,H.hitch(this,this._ignoreVirtualLayerFilter)]))},postCreate:function(){this.inherited(arguments);Q.addClass(this.domNode,"jimu-basic-layer-chooser-from-map")},_ignoreVirtualLayerFilter:function(m){return m.getLayerType().then(function(w){return!("ArcGISDynamicMapServiceLayer"===w||"ArcGISTiledMapServiceLayer"===w||"GroupLayer"===w)})},basicFilter:function(m){var w=
new C;0<=this.ignoredFeaturelayerIds.indexOf(m.id)?w.resolve(!1):this.onlyShowVisible&&"Table"!==m.getLayerType()?w.resolve(m.isShowInMap()):w.resolve(!0);return w},getHandledItem:function(m){var w=this.inherited(arguments),t=m&&m.layerInfo;t=t&&t.layerObject;w.url=t&&t.url||"";return w}})})},"jimu/dijit/LayerChooserFromMap":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/store/Memory dojo/Deferred dojo/store/Observable dijit/tree/ObjectStoreModel dojo/promise/all dojo/_base/lang dojo/_base/html dojo/_base/array jimu/utils jimu/dijit/_Tree jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r){var D=Q([H,l,m,C],{templateString:'\x3cdiv style\x3d"width:100%;"\x3e\x3cdiv data-dojo-attach-point\x3d"errorTipSection" class\x3d"error-tip-section"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text" data-dojo-attach-point\x3d"errTip"\x3e${nls.noLayersTip}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',_store:null,_id:0,_treeClass:"layer-chooser-tree",createMapResponse:null,multiple:!1,onlyShowVisible:!1,
updateWhenLayerInfosIsShowInMapChanged:!1,onlyShowWebMapLayers:!1,displayTooltipForTreeNode:!1,onlyFilterCurrentLayerWhenAddItem:!1,postMixInProperties:function(){this.nls=window.jimuNls.basicLayerChooserFromMap},postCreate:function(){this.inherited(arguments);e.addClass(this.domNode,"jimu-basic-layer-chooser-from-map");this.multiple=!!this.multiple;this.shelter=new r({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this._createTree();this.basicFilter=a.hitch(this,this.basicFilter);
this.filter=D.andCombineFilters([this.basicFilter,this.filter]);this.createMapResponse&&this.setCreateMapResponse(this.createMapResponse)},basicFilter:function(u){var F=new t;this.onlyShowVisible?F.resolve(u.isShowInMap()):F.resolve(!0);return F},filter:function(u){u=new t;u.resolve(!0);return u},getSelectedItems:function(){var u=this.tree.getSelectedItems();return h.map(u,a.hitch(this,function(F){return this.getHandledItem(F)}))},getAllItems:function(){var u=this.tree.getAllItems(),F=[];h.forEach(u,
a.hitch(this,function(x){"root"!==x.id&&(x=this.getHandledItem(x),F.push(x))}));return F},getHandledItem:function(u){return{name:u.name,layerInfo:u.layerInfo}},_isLeafItem:function(u){return u.isLeaf},setCreateMapResponse:function(u){this.createMapResponse=u;I.getInstance(this.createMapResponse.map,this.createMapResponse.itemInfo).then(a.hitch(this,function(F){this.layerInfosObj=F;this.own(B(this.layerInfosObj,"layerInfosChanged",a.hitch(this,this._onLayerInfosChanged)));this.updateWhenLayerInfosIsShowInMapChanged&&
this.own(B(this.layerInfosObj,"layerInfosIsShowInMapChanged",a.hitch(this,this._onLayerInfosIsShowInMapChanged)));this._buildTree(this.layerInfosObj)}))},_onLayerInfosChanged:function(u,F){this._buildTree(this.layerInfosObj);this.emit("update")},_onLayerInfosIsShowInMapChanged:function(u){this._buildTree(this.layerInfosObj);this.emit("update")},_buildTree:function(u){this._clear();e.setStyle(this.errorTipSection,"display","block");var F=[];this.onlyShowWebMapLayers?(F=u.getLayerInfoArrayOfWebmap(),
F=F.concat(u.getTableInfoArrayOfWebmap())):(F=u.getLayerInfoArray(),F=F.concat(u.getTableInfoArray()));0!==F.length&&(e.setStyle(this.errorTipSection,"display","none"),h.forEach(F,a.hitch(this,function(x){this._addDirectLayerInfo(x)})))},_addDirectLayerInfo:function(u){u&&u.getLayerObject().then(a.hitch(this,function(){this._addItem("root",u)}),a.hitch(this,function(F){console.error(F)}))},_clear:function(){var u=this._store.query({parent:"root"});h.forEach(u,a.hitch(this,function(F){F&&"root"!==
F.id&&this._store.remove(F.id)}))},_addItem:function(u,F){var x=null,L=F.getLayerType(),q=this.filter(F);c({layerType:L,valid:q}).then(a.hitch(this,function(J){if(J.valid){var v=a.hitch(this,function(p,O){this._id++;x={name:F.title||"",parent:u,layerInfo:F,type:J.layerType,layerClass:F.layerObject.declaredClass,id:this._id.toString(),isLeaf:p,hasChildren:O};this._store.add(x)}),z=F.getSubLayers(),b=0===z.length,n=!0;this.onlyFilterCurrentLayerWhenAddItem?(b&&(n=!1),v(b,n)):b?v(b,!1):(z=h.map(z,a.hitch(this,
function(p){return this.filter(p)})),c(z).then(a.hitch(this,function(p){(p=h.some(p,function(O){return O}))&&v(b,p)})))}}))},_getRootItem:function(){return{id:"root",name:"Map Root",type:"root",isLeaf:!1,hasChildren:!0}},_createTree:function(){var u=this._getRootItem();u=new w({data:[u],getChildren:function(F){return this.query({parent:F.id})}});this._store=new M(u);u=new k({store:this._store,query:{id:"root"},mayHaveChildren:a.hitch(this,this._mayHaveChildren)});this.tree=new K({multiple:this.multiple,
model:u,showRoot:!1,isLeafItem:a.hitch(this,this._isLeafItem),style:{width:"100%"},onOpen:a.hitch(this,function(F,x){"root"!==F.id&&this._onTreeOpen(F,x)}),onClick:a.hitch(this,function(F,x,L){this._onTreeClick(F,x,L);this.emit("tree-click",F,x,L)}),getIconStyle:a.hitch(this,function(F,x){var L=null;if(!F||"root"===F.id)return null;var q={width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundImage:""},J=window.location.protocol+"//"+window.location.host+
require.toUrl("jimu");if(F=this._getIconInfo(F,x).imageName)q.backgroundImage="url("+J+"/css/images/"+F+")",L=q;return L}),getIconClass:a.hitch(this,function(F,x){return this._getIconInfo(F,x).className}),getTooltip:a.hitch(this,function(F){return this.displayTooltipForTreeNode?F.layerInfo.title:""})});e.addClass(this.tree.domNode,this._treeClass);this.tree.placeAt(this.shelter.domNode,"before")},_mayHaveChildren:function(u){return u.hasChildren},_getIconInfo:function(u,F){var x="",L="";"ArcGISDynamicMapServiceLayer"===
u.type||"ArcGISTiledMapServiceLayer"===u.type?F?(x="mapserver_open.png",L="mapservice-layer-icon open"):(x="mapserver_close.png",L="mapservice-layer-icon close"):"GroupLayer"===u.type?F?(x="group_layer2.png",L="group-layer-icon open"):(x="group_layer1.png",L="group-layer-icon close"):"FeatureLayer"===u.type?(u=y.getTypeByGeometryType(u.layerInfo.layerObject.geometryType),"point"===u?(x="point_layer1.png",L="point-layer-icon"):"polyline"===u?(x="line_layer1.png",L="line-layer-icon"):"polygon"===u&&
(x="polygon_layer1.png",L="polygon-layer-icon")):"Table"===u.type?(x="table.png",L="table-icon"):"ArcGISImageServiceLayer"===u.type||"ArcGISImageServiceVectorLayer"===u.type?(x="image_layer.png",L="iamge-layer-icon"):F?(x="mapserver_open.png",L="mapservice-layer-icon open"):(x="mapserver_close.png",L="mapservice-layer-icon close");return{imageName:x,className:L}},_onTreeOpen:function(u,F){if("root"!==u.id){var x=[];F=[];x=u.layerInfo.getSubLayers();u.checked||(this.shelter.show(),F=h.map(x,a.hitch(this,
function(L){return L.getLayerObject()})),c(F).then(a.hitch(this,function(){this.domNode&&(h.forEach(x,a.hitch(this,function(L){this._addItem(u.id,L)})),u.checked=!0,this.shelter.hide())}),a.hitch(this,function(L){console.error(L);this.shelter.hide()})))}},_onTreeClick:function(u,F,x){},destroy:function(){this.shelter&&(this.shelter.destroy(),this.shelter=null);this.tree&&this.tree.destroy();this.inherited(arguments)}});D.createFilterByLayerType=function(u){a.isArrayLike(u)||(u=[]);return function(F){var x=
new t;if(0===u.length)x.resolve(!0);else{var L=[];F.traversal(function(q){L.push(q.getLayerType())});c(L).then(function(q){for(var J=0;J<q.length;J++)for(var v=0;v<u.length;v++)if(q[J]===u[v]){x.resolve(!0);return}x.resolve(!1)},function(q){console.error(q);x.reject(q)})}return x}};D.createFeaturelayerFilter=function(u,F,x,L){var q=["point","polyline","polygon"];u&&0<u.length?(u=h.filter(u,function(J){return 0<=q.indexOf(J)}),0===u.length&&(u=q)):u=q;return function(J){var v=J.getLayerType();J=J.getLayerObject();
return c({layerType:v,layerObject:J}).then(function(z){var b=z.layerType;z=z.layerObject;if("ArcGISDynamicMapServiceLayer"===b||"ArcGISTiledMapServiceLayer"===b||"GroupLayer"===b||"FeatureCollection"===b)return!0;if("FeatureLayer"===b){b=y.getTypeByGeometryType(z.geometryType);b=0<=h.indexOf(u,b);var n=D._shouldPassStatisticsCheck(L,z);return z.url?(z=y.isFeaturelayerUrlSupportQuery(z.url,z.capabilities),b&&z&&n):F&&b}return"Table"===b?(b=y.isFeaturelayerUrlSupportQuery(z.url,z.capabilities),z=D._shouldPassStatisticsCheck(L,
z),x&&b&&z):!1})}};D.createImageServiceLayerFilter=function(u,F){return function(x){var L=x.getLayerType();x=x.getLayerObject();return c({layerType:L,layerObject:x}).then(function(q){var J=q.layerType,v=q.layerObject;return"ArcGISImageServiceLayer"===J||"ArcGISImageServiceVectorLayer"===J?u?y.isImageServiceSupportQuery(q.layerObject.capabilities)?F?D._shouldPassStatisticsCheck(F,v):!0:!1:!0:!1})}};D._shouldPassStatisticsCheck=function(u,F){return u?(u=!1,u=F.advancedQueryCapabilities?!!F.advancedQueryCapabilities.supportsStatistics:
!!F.supportsStatistics):!0};D.createQueryableLayerFilter=function(u){var F=D.createFeaturelayerFilter(["point","polyline","polygon"],!1,!0,u);u=D.createImageServiceLayerFilter(!0,u);return D.orCombineFilters([F,u])};D.andCombineFilters=function(u){return D._combineFilters(u,!0)};D.orCombineFilters=function(u){return D._combineFilters(u,!1)};D._combineFilters=function(u,F){return function(x){var L=new t,q=h.map(u,function(J){return J(x)});c(q).then(function(J){var v=!1;v=F?h.every(J,function(z){return z}):
h.some(J,function(z){return z});L.resolve(v)},function(J){console.error(J);L.reject(J)});return L}};return D})},"dijit/tree/ObjectStoreModel":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/when ../Destroyable".split(" "),function(B,C,Q,H,l,m,w){return Q("dijit.tree.ObjectStoreModel",w,{store:null,labelAttr:"name",labelType:"text",root:null,query:null,constructor:function(t){l.mixin(this,t);this.childrenCache={}},getRoot:function(t,M){if(this.root)t(this.root);
else{var k=this.store.query(this.query);k.then&&this.own(k);m(k,l.hitch(this,function(c){if(1!=c.length)throw Error("dijit.tree.ObjectStoreModel: root query returned "+c.length+" items, but must return exactly one");this.root=c[0];t(this.root);k.observe&&k.observe(l.hitch(this,function(a){this.onChange(a)}),!0)}),M)}},mayHaveChildren:function(){return!0},getChildren:function(t,M,k){var c=this.store.getIdentity(t);if(this.childrenCache[c])m(this.childrenCache[c],M,k);else{var a=this.childrenCache[c]=
this.store.getChildren(t);a.then&&this.own(a);a.observe&&this.own(a.observe(l.hitch(this,function(e,h,y){this.onChange(e);h!=y&&m(a,l.hitch(this,"onChildrenChange",t))}),!0));m(a,M,k)}},isItem:function(){return!0},getIdentity:function(t){return this.store.getIdentity(t)},getLabel:function(t){return t[this.labelAttr]},newItem:function(t,M,k,c){return this.store.put(t,{parent:M,before:c})},pasteItem:function(t,M,k,c,a,e){var h=new H;if(M===k&&!c&&!e)return h.resolve(!0),h;M&&!c?this.getChildren(M,l.hitch(this,
function(y){y=[].concat(y);var K=B.indexOf(y,t);y.splice(K,1);this.onChildrenChange(M,y);h.resolve(this.store.put(t,{overwrite:!0,parent:k,oldParent:M,before:e,isCopy:!1}))})):h.resolve(this.store.put(t,{overwrite:!0,parent:k,oldParent:M,before:e,isCopy:!0}));return h},onChange:function(){},onChildrenChange:function(){},onDelete:function(){}})})},"jimu/dijit/_Tree":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_TreeNode.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/event dojo/query dojo/aspect dojo/on dojo/keys dojo/Evented dijit/registry dijit/Tree jimu/utils".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K){var I=B([y._TreeNode,e],{templateString:H,declaredClass:"jimu._TreeNode",isLeaf:!1,groupId:"",postCreate:function(){this.inherited(arguments);m.addClass(this.domNode,"jimu-tree-node");this.isLeaf=!!this.isLeaf;this.groupId?(this.checkNode=m.toDom('\x3cinput type\x3d"radio" /\x3e'),this.checkNode.name=this.groupId):this.checkNode=m.toDom('\x3cinput type\x3d"checkbox" /\x3e');m.addClass(this.checkNode,"jimu-tree-check-node");m.place(this.checkNode,this.contentNode,
"first");this.own(c(this.checkNode,"click",l.hitch(this,this._onClick)));this.own(c(this.rowNode,"keydown",l.hitch(this,function(r,D){D.target=r;D.keyCode!==a.ENTER&&D.keyCode!==a.SPACE||this._onClick(D)},this.checkNode)));this.isLeaf?this.groupId?m.setStyle(this.checkNode,"display","none"):m.setStyle(this.checkNode,"display","inline"):m.setStyle(this.checkNode,"display","none");this.isLeaf?m.addClass(this.domNode,"jimu-tree-leaf-node"):m.addClass(this.domNode,"jimu-tree-not-leaf-node")},select:function(){this.isLeaf&&
(this.checkNode.checked=!0,m.addClass(this.domNode,"jimu-tree-selected-leaf-node"))},unselect:function(){this.isLeaf&&(this.checkNode.checked=!1,m.removeClass(this.domNode,"jimu-tree-selected-leaf-node"))},toggleSelect:function(){this.isLeaf&&(this.checkNode.checked?this.unselect():this.select())},_onClick:function(r){(r.target||r.srcElement)===this.checkNode?this.tree._onCheckNodeClick(this,this.checkNode.checked,r):this.tree._onClick(this,r)},_onChange:function(){this.isLeaf&&setTimeout(l.hitch(this,
function(){this.checkNode.checked?this.emit("tn-select",this):this.emit("tn-unselect",this)}),100)},destroy:function(){delete this.tree;this.inherited(arguments)}});return B([y,e],{declaredClass:"jimu._Tree",openOnClick:!0,multiple:!0,uniqueId:"",showRoot:!1,postMixInProperties:function(){this.inherited(arguments);this.uniqueId="tree_"+K.getRandomString()},postCreate:function(){this.inherited(arguments);m.addClass(this.domNode,"jimu-tree");this.own(k.before(this,"onClick",l.hitch(this,this._jimuBeforeClick)));
this.rootLoadingIndicator&&m.setStyle(this.rootLoadingIndicator,"display","none");this.dndController.singular=!0;m.setAttr(this.domNode,"tabindex",0)},removeItem:function(r){this.model.store.remove(r)},getAllItems:function(){var r=this.getAllTreeNodeWidgets();return w.map(r,l.hitch(this,function(D){var u=D.item;u.selected=D.checkNode.checked;return u}))},getSelectedItems:function(){var r=this.getAllTreeNodeWidgets();r=w.filter(r,l.hitch(this,function(D){return D.checkNode.checked}));return w.map(r,
l.hitch(this,function(D){return D.item}))},getFilteredItems:function(r){var D=this.getAllTreeNodeWidgets();D=w.map(D,l.hitch(this,function(u){var F=u.item;F.selected=u.checkNode.checked;return F}));return w.filter(D,l.hitch(this,function(u){return r(u)}))},getTreeNodeByItemId:function(r){for(var D=this._getAllTreeNodeDoms(),u=0;u<D.length;u++){var F=h.byNode(D[u]);if(F.item.id.toString()===r.toString())return F}return null},selectItem:function(r){(r=this.getTreeNodeByItemId(r))&&r.isLeaf&&this.selectNodeWidget(r)},
unselectItem:function(r){(r=this.getTreeNodeByItemId(r))&&r.isLeaf&&r.unselect()},getAllLeafTreeNodeWidgets:function(){var r=this.getAllTreeNodeWidgets();return w.filter(r,l.hitch(this,function(D){return D.isLeaf}))},getAllTreeNodeWidgets:function(){var r=this._getAllTreeNodeDoms();return w.map(r,l.hitch(this,function(D){return h.byNode(D)}))},isLeafItem:function(r){return r&&r.isLeaf},_getAllTreeNodeDoms:function(){return M(".dijitTreeNode",this.domNode)},_createTreeNode:function(r){r.isLeaf=this.isLeafItem(r.item);
this.multiple||(r.groupId=this.uniqueId);return new I(r)},_onTreeNodeSelect:function(r){this.emit("item-select",{item:r.item,treeNode:r})},_onTreeNodeUnselect:function(r){this.emit("item-unselect",{item:r.item,treeNode:r})},selectNodeWidget:function(r){this.multiple||this.unselectAllLeafNodeWidgets();r.select()},_jimuBeforeClick:function(r,D,u){D.isLeaf&&(m.hasClass(u.target||u.srcElement,"jimu-tree-check-node")||(this.multiple?D.toggleSelect():this.selectNodeWidget(D)));return arguments},_onCheckNodeClick:function(r,
D,u){!this.multiple&&D&&this.unselectAllLeafNodeWidgets();t.stop(u);this.focusNode(r);setTimeout(l.hitch(this,function(){D?this.selectNodeWidget(r):r.unselect();this.onClick(r.item,r,u)}),0)},unselectAllLeafNodeWidgets:function(){var r=this.getAllLeafTreeNodeWidgets();w.forEach(r,l.hitch(this,function(D){D.unselect()}))}})})},"dijit/Tree":function(){define("dojo/_base/array dojo/aspect dojo/cookie dojo/_base/declare dojo/Deferred dojo/promise/all dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/errors/create dojo/fx dojo/has dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/topic dojo/touch dojo/when ./a11yclick ./focus ./registry ./_base/manager ./_Widget ./_TemplatedMixin ./_Container ./_Contained ./_CssStateMixin ./_KeyNavMixin dojo/text!./templates/TreeNode.html dojo/text!./templates/Tree.html ./tree/TreeStoreModel ./tree/ForestStoreModel ./tree/_dndSelector dojo/query!css2".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r,D,u,F,x,L,q,J,v,z,b,n,p,O,T,f,A,E){function N(d){return K.delegate(d.promise||d,{addCallback:function(g){this.then(g)},addErrback:function(g){this.otherwise(g)}})}var S=H("dijit._TreeNode",[J,v,z,b,n],{item:null,isTreeNode:!0,label:"",_setLabelAttr:function(d){this.labelNode["html"==this.labelType?"innerHTML":"innerText"in this.labelNode?"innerText":"textContent"]=d;this._set("label",d);e("dojo-bidi")&&this.applyTextDir(this.labelNode)},labelType:"text",
isExpandable:null,isExpanded:!1,state:"NotLoaded",templateString:O,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);this.isExpandable&&this.labelNode.setAttribute("aria-expanded",this.isExpanded);this.setSelected(!1)},_setIndentAttr:function(d){var g=Math.max(d,0)*this.tree._nodePixelIndent+"px";k.set(this.domNode,
"backgroundPosition",g+" 0px");k.set(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",g);B.forEach(this.getChildren(),function(G){G.set("indent",d+1)});this._set("indent",d)},markProcessing:function(){this.state="Loading";this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(d){var g=this.tree,G=g.model;g._v10Compat&&d===G.root&&(d=null);this._applyClassAndStyle(d,"icon","Icon");this._applyClassAndStyle(d,"label","Label");this._applyClassAndStyle(d,
"row","Row");this.tree._startPaint(!0)},_applyClassAndStyle:function(d,g,G){var P="_"+g+"Class";g+="Node";var R=this[P];this[P]=this.tree["get"+G+"Class"](d,this.isExpanded);t.replace(this[g],this[P]||"",R||"");k.set(this[g],this.tree["get"+G+"Style"](d,this.isExpanded)||{})},_updateLayout:function(){var d=this.getParent();d=!d||!d.rowNode||"none"==d.rowNode.style.display;t.toggle(this.domNode,"dijitTreeIsRoot",d);t.toggle(this.domNode,"dijitTreeIsLast",!d&&!this.getNextSibling())},_setExpando:function(d){var g=
["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"];d=d?0:this.isExpandable?this.isExpanded?1:2:3;t.replace(this.expandoNode,g[d],g);this.expandoNodeText.innerHTML=["*","-","+","*"][d]},expand:function(){if(this._expandDeferred)return N(this._expandDeferred);this._collapseDeferred&&(this._collapseDeferred.cancel(),delete this._collapseDeferred);this.isExpanded=!0;this.labelNode.setAttribute("aria-expanded","true");(this.tree.showRoot||this!==this.tree.rootNode)&&
this.containerNode.setAttribute("role","group");t.add(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","true");var d=a.wipeIn({node:this.containerNode,duration:q.defaultDuration}),g=this._expandDeferred=new l(function(){d.stop()});C.after(d,"onEnd",function(){g.resolve(!0)},!0);d.play();return N(g)},collapse:function(){if(this._collapseDeferred)return N(this._collapseDeferred);
this._expandDeferred&&(this._expandDeferred.cancel(),delete this._expandDeferred);this.isExpanded=!1;this.labelNode.setAttribute("aria-expanded","false");this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","false");t.remove(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);var d=a.wipeOut({node:this.containerNode,duration:q.defaultDuration}),g=this._collapseDeferred=new l(function(){d.stop()});C.after(d,"onEnd",
function(){g.resolve(!0)},!0);d.play();return N(g)},indent:0,setChildItems:function(d){var g=this.tree,G=g.model,P=[],R=g.focusedChild,aa=this.getChildren();B.forEach(aa,function(V){z.prototype.removeChild.call(this,V)},this);this.defer(function(){B.forEach(aa,function(V){if(!V._destroyed&&!V.getParent()){g.dndController.removeTreeNode(V);(function fa(W){var ca=G.getIdentity(W.item),da=g._itemNodesMap[ca];1==da.length?delete g._itemNodesMap[ca]:(ca=B.indexOf(da,W),-1!=ca&&da.splice(ca,1));B.forEach(W.getChildren(),
fa)})(V);if(g.persist){var X=B.map(V.getTreePath(),function(W){return g.model.getIdentity(W)}).join("/"),Y;for(Y in g._openedNodes)Y.substr(0,X.length)==X&&delete g._openedNodes[Y];g._saveExpandedNodes()}g.lastFocusedChild&&!w.isDescendant(g.lastFocusedChild.domNode,g.domNode)&&delete g.lastFocusedChild;R&&!w.isDescendant(R.domNode,g.domNode)&&g.focus();V.destroyRecursive()}})});this.state="Loaded";d&&0<d.length?(this.isExpandable=!0,B.forEach(d,function(V){var X=G.getIdentity(V),Y=g._itemNodesMap[X];
if(Y)for(var Z=0;Z<Y.length;Z++)if(Y[Z]&&!Y[Z].getParent()){var W=Y[Z];W.set("indent",this.indent+1);break}W||(W=this.tree._createTreeNode({item:V,tree:g,isExpandable:G.mayHaveChildren(V),label:g.getLabel(V),labelType:g.model&&g.model.labelType||"text",tooltip:g.getTooltip(V),ownerDocument:g.ownerDocument,dir:g.dir,lang:g.lang,textDir:g.textDir,indent:this.indent+1}),Y?Y.push(W):g._itemNodesMap[X]=[W]);this.addChild(W);(this.tree.autoExpand||this.tree._state(W))&&P.push(g._expandNode(W))},this),B.forEach(this.getChildren(),
function(V){V._updateLayout()})):this.isExpandable=!1;this._setExpando&&this._setExpando(!1);this._updateItemClasses(this.item);d=m(P);this.tree._startPaint(d);return N(d)},getTreePath:function(){for(var d=this,g=[];d&&d!==this.tree.rootNode;)g.unshift(d.item),d=d.getParent();g.unshift(this.tree.rootNode.item);return g},getIdentity:function(){return this.tree.model.getIdentity(this.item)},removeChild:function(d){this.inherited(arguments);var g=this.getChildren();0==g.length&&(this.isExpandable=!1,
this.collapse());B.forEach(g,function(G){G._updateLayout()})},makeExpandable:function(){this.isExpandable=!0;this._setExpando(!1)},setSelected:function(d){this.labelNode.setAttribute("aria-selected",d?"true":"false");t.toggle(this.rowNode,"dijitTreeRowSelected",d)},focus:function(){x.focus(this.focusNode)}});e("dojo-bidi")&&S.extend({_setTextDirAttr:function(d){!d||this.textDir==d&&this._created||(this._set("textDir",d),this.applyTextDir(this.labelNode),B.forEach(this.getChildren(),function(g){g.set("textDir",
d)},this))}});var U=H("dijit.Tree",[J,p,v,n],{baseClass:"dijitTree",store:null,model:null,query:null,label:"",showRoot:!0,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:!1,openOnDblClick:!1,templateString:T,persist:!1,autoExpand:!1,dndController:E,dndParams:"onDndDrop itemCreator onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,
dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(d,g){r.publish(this.id,K.mixin({tree:this,event:d},g||{}))},postMixInProperties:function(){this.tree=this;this.autoExpand&&(this.persist=!1);this._itemNodesMap={};!this.cookieName&&this.id&&(this.cookieName=this.id+"SaveStateCookie");this.expandChildrenDeferred=new l;this.pendingCommandsPromise=this.expandChildrenDeferred.promise;this.inherited(arguments)},postCreate:function(){this._initState();var d=this;this.own(I(this.containerNode,
I.selector(".dijitTreeNode",D.enter),function(P){d._onNodeMouseEnter(L.byNode(this),P)}),I(this.containerNode,I.selector(".dijitTreeNode",D.leave),function(P){d._onNodeMouseLeave(L.byNode(this),P)}),I(this.containerNode,I.selector(".dijitTreeRow",F.press),function(P){d._onNodePress(L.getEnclosingWidget(this),P)}),I(this.containerNode,I.selector(".dijitTreeRow",F),function(P){d._onClick(L.getEnclosingWidget(this),P)}),I(this.containerNode,I.selector(".dijitTreeRow","dblclick"),function(P){d._onDblClick(L.getEnclosingWidget(this),
P)}));this.model||this._store2model();this.own(C.after(this.model,"onChange",K.hitch(this,"_onItemChange"),!0),C.after(this.model,"onChildrenChange",K.hitch(this,"_onItemChildrenChange"),!0),C.after(this.model,"onDelete",K.hitch(this,"_onItemDelete"),!0));this.inherited(arguments);if(this.dndController){K.isString(this.dndController)&&(this.dndController=K.getObject(this.dndController));for(var g={},G=0;G<this.dndParams.length;G++)this[this.dndParams[G]]&&(g[this.dndParams[G]]=this[this.dndParams[G]]);
this.dndController=new this.dndController(this,g)}this._load();this.onLoadDeferred=N(this.pendingCommandsPromise);this.onLoadDeferred.then(K.hitch(this,"onLoad"))},_store2model:function(){this._v10Compat=!0;h.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var d={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};this.params.mayHaveChildren&&(d.mayHaveChildren=K.hitch(this,"mayHaveChildren"));this.params.getItemChildren&&
(d.getChildren=K.hitch(this,function(g,G,P){this.getItemChildren(this._v10Compat&&g===this.model.root?null:g,G,P)}));this.model=new A(d);this.showRoot=!!this.label},onLoad:function(){},_load:function(){this.model.getRoot(K.hitch(this,function(d){var g=this.rootNode=this.tree._createTreeNode({item:d,tree:this,isExpandable:!0,label:this.label||this.getLabel(d),labelType:this.model.labelType||"text",textDir:this.textDir,indent:this.showRoot?0:-1});this.showRoot?(this.domNode.setAttribute("aria-multiselectable",
!this.dndController.singular),this.rootLoadingIndicator.style.display="none"):(g.rowNode.style.display="none",this.domNode.setAttribute("role","presentation"),this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("aria-multiselectable"),this["aria-label"]?(g.containerNode.setAttribute("aria-label",this["aria-label"]),this.domNode.removeAttribute("aria-label")):this["aria-labelledby"]&&(g.containerNode.setAttribute("aria-labelledby",this["aria-labelledby"]),this.domNode.removeAttribute("aria-labelledby")),
g.labelNode.setAttribute("role","presentation"),g.labelNode.removeAttribute("aria-selected"),g.containerNode.setAttribute("role","tree"),g.containerNode.setAttribute("aria-expanded","true"),g.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular));this.containerNode.appendChild(g.domNode);d=this.model.getIdentity(d);this._itemNodesMap[d]?this._itemNodesMap[d].push(g):this._itemNodesMap[d]=[g];g._updateLayout();this._expandNode(g).then(K.hitch(this,function(){this._destroyed||
(this.rootLoadingIndicator.style.display="none",this.expandChildrenDeferred.resolve(!0))}))}),K.hitch(this,function(d){console.error(this,": error loading root: ",d)}))},getNodesByItem:function(d){if(!d)return[];d=K.isString(d)?d:this.model.getIdentity(d);return[].concat(this._itemNodesMap[d])},_setSelectedItemAttr:function(d){this.set("selectedItems",[d])},_setSelectedItemsAttr:function(d){var g=this;return this.pendingCommandsPromise=this.pendingCommandsPromise.always(K.hitch(this,function(){var G=
B.map(d,function(R){return!R||K.isString(R)?R:g.model.getIdentity(R)}),P=[];B.forEach(G,function(R){P=P.concat(g._itemNodesMap[R]||[])});this.set("selectedNodes",P)}))},_setPathAttr:function(d){return d.length?N(this.set("paths",[d]).then(function(g){return g[0]})):N(this.set("paths",[]).then(function(g){return g[0]}))},_setPathsAttr:function(d){function g(P,R){var aa=P.shift(),V=B.filter(R,function(X){return X.getIdentity()==aa})[0];if(V)return P.length?G._expandNode(V).then(function(){return g(P,
V.getChildren())}):V;throw new U.PathError("Could not expand path at "+aa);}var G=this;return N(this.pendingCommandsPromise=this.pendingCommandsPromise.always(function(){return m(B.map(d,function(P){P=B.map(P,function(R){return R&&K.isObject(R)?G.model.getIdentity(R):R});if(P.length)return g(P,[G.rootNode]);throw new U.PathError("Empty path");}))}).then(function(P){G.set("selectedNodes",P);return G.paths}))},_setSelectedNodeAttr:function(d){this.set("selectedNodes",[d])},_setSelectedNodesAttr:function(d){this.dndController.setSelection(d)},
expandAll:function(){function d(G){return g._expandNode(G).then(function(){var P=B.filter(G.getChildren()||[],function(R){return R.isExpandable});return m(B.map(P,d))})}var g=this;return N(d(this.rootNode))},collapseAll:function(){function d(G){var P=B.filter(G.getChildren()||[],function(R){return R.isExpandable});P=m(B.map(P,d));return!G.isExpanded||G==g.rootNode&&!g.showRoot?P:P.then(function(){return g._collapseNode(G)})}var g=this;return N(d(this.rootNode))},mayHaveChildren:function(){},getItemChildren:function(){},
getLabel:function(d){return this.model.getLabel(d)},getIconClass:function(d,g){return!d||this.model.mayHaveChildren(d)?g?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf"},getLabelClass:function(){},getRowClass:function(){},getIconStyle:function(){},getLabelStyle:function(){},getRowStyle:function(){},getTooltip:function(){return""},_onDownArrow:function(d,g){(d=this._getNext(g))&&d.isTreeNode&&this.focusNode(d)},_onUpArrow:function(d,g){if(d=g.getPreviousSibling())for(g=d;g.isExpandable&&g.isExpanded&&
g.hasChildren();)g=g.getChildren(),g=g[g.length-1];else if(d=g.getParent(),this.showRoot||d!==this.rootNode)g=d;g&&g.isTreeNode&&this.focusNode(g)},_onRightArrow:function(d,g){g.isExpandable&&!g.isExpanded?this._expandNode(g):g.hasChildren()&&(g=g.getChildren()[0])&&g.isTreeNode&&this.focusNode(g)},_onLeftArrow:function(d,g){g.isExpandable&&g.isExpanded?this._collapseNode(g):(d=g.getParent())&&d.isTreeNode&&(this.showRoot||d!==this.rootNode)&&this.focusNode(d)},focusLastChild:function(){var d=this._getLast();
d&&d.isTreeNode&&this.focusNode(d)},_getFirst:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0]},_getLast:function(){for(var d=this.rootNode;d.isExpanded;){var g=d.getChildren();if(!g.length)break;d=g[g.length-1]}return d},_getNext:function(d){if(d.isExpandable&&d.isExpanded&&d.hasChildren())return d.getChildren()[0];for(;d&&d.isTreeNode;){var g=d.getNextSibling();if(g)return g;d=d.getParent()}return null},childSelector:".dijitTreeRow",isExpandoNode:function(d,g){return w.isDescendant(d,
g.expandoNode)||w.isDescendant(d,g.expandoNodeText)},_onNodePress:function(d,g){this.focusNode(d)},__click:function(d,g,G,P){var R=this.isExpandoNode(g.target,d);d.isExpandable&&(G||R)?this._onExpandoClick({node:d}):(this._publish("execute",{item:d.item,node:d,evt:g}),this[P](d.item,d,g),this.focusNode(d));g.stopPropagation();g.preventDefault()},_onClick:function(d,g){this.__click(d,g,this.openOnClick,"onClick")},_onDblClick:function(d,g){this.__click(d,g,this.openOnDblClick,"onDblClick")},_onExpandoClick:function(d){d=
d.node;this.focusNode(d);d.isExpanded?this._collapseNode(d):this._expandNode(d)},onClick:function(){},onDblClick:function(){},onOpen:function(){},onClose:function(){},_getNextNode:function(d){h.deprecated(this.declaredClass+"::_getNextNode(node) is deprecated. Use _getNext(node) instead.","","2.0");return this._getNext(d)},_getRootOrFirstNode:function(){h.deprecated(this.declaredClass+"::_getRootOrFirstNode() is deprecated. Use _getFirst() instead.","","2.0");return this._getFirst()},_collapseNode:function(d){d._expandNodeDeferred&&
delete d._expandNodeDeferred;if("Loading"!=d.state&&d.isExpanded){var g=d.collapse();this.onClose(d.item,d);this._state(d,!1);this._startPaint(g);return g}},_expandNode:function(d){if(d._expandNodeDeferred)return d._expandNodeDeferred;var g=this.model,G=d.item,P=this;d._loadDeferred||(d.markProcessing(),d._loadDeferred=new l,g.getChildren(G,function(R){d.unmarkProcessing();d.setChildItems(R).then(function(){d._loadDeferred.resolve(R)})},function(R){console.error(P,": error loading "+d.label+" children: ",
R);d._loadDeferred.reject(R)}));g=d._loadDeferred.then(K.hitch(this,function(){var R=d.expand();this.onOpen(d.item,d);this._state(d,!0);return R}));this._startPaint(g);return g},focusNode:function(d){for(var g=[],G=this.domNode;G&&G.tagName&&"IFRAME"!==G.tagName.toUpperCase();G=G.parentNode)g.push({domNode:G.contentWindow||G,scrollLeft:G.scrollLeft||0,scrollTop:G.scrollTop||0});this.focusChild(d);this.defer(function(){for(var P=0,R=g.length;P<R;P++)g[P].domNode.scrollLeft=g[P].scrollLeft,g[P].domNode.scrollTop=
g[P].scrollTop},0)},_onNodeMouseEnter:function(){},_onNodeMouseLeave:function(){},_onItemChange:function(d){var g=this.model.getIdentity(d);if(g=this._itemNodesMap[g]){var G=this.getLabel(d),P=this.getTooltip(d);B.forEach(g,function(R){R.set({item:d,label:G,tooltip:P});R._updateItemClasses(d)})}},_onItemChildrenChange:function(d,g){d=this.model.getIdentity(d);(d=this._itemNodesMap[d])&&B.forEach(d,function(G){G.setChildItems(g)})},_onItemDelete:function(d){d=this.model.getIdentity(d);var g=this._itemNodesMap[d];
g&&(B.forEach(g,function(G){this.dndController.removeTreeNode(G);var P=G.getParent();P&&P.removeChild(G);this.lastFocusedChild&&!w.isDescendant(this.lastFocusedChild.domNode,this.domNode)&&delete this.lastFocusedChild;this.focusedChild&&!w.isDescendant(this.focusedChild.domNode,this.domNode)&&this.focus();G.destroyRecursive()},this),delete this._itemNodesMap[d])},_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var d=Q(this.cookieName);d&&B.forEach(d.split(","),function(g){this._openedNodes[g]=
!0},this)}},_state:function(d,g){if(!this.persist)return!1;var G=B.map(d.getTreePath(),function(P){return this.model.getIdentity(P)},this).join("/");if(1===arguments.length)return this._openedNodes[G];g?this._openedNodes[G]=!0:delete this._openedNodes[G];this._saveExpandedNodes()},_saveExpandedNodes:function(){if(this.persist&&this.cookieName){var d=[],g;for(g in this._openedNodes)d.push(g);Q(this.cookieName,d.join(","),{expires:365})}},destroy:function(){this._curSearch&&(this._curSearch.timer.remove(),
delete this._curSearch);this.rootNode&&this.rootNode.destroyRecursive();this.dndController&&!K.isString(this.dndController)&&this.dndController.destroy();this.rootNode=null;this.inherited(arguments)},destroyRecursive:function(){this.destroy()},resize:function(d){d&&M.setMarginBox(this.domNode,d);this._nodePixelIndent=M.position(this.tree.indentDetector).w||this._nodePixelIndent;this.expandChildrenDeferred.then(K.hitch(this,function(){this.rootNode.set("indent",this.showRoot?0:-1);this._adjustWidths()}))},
_outstandingPaintOperations:0,_startPaint:function(d){this._outstandingPaintOperations++;this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);var g=K.hitch(this,function(){this._outstandingPaintOperations--;0>=this._outstandingPaintOperations&&!this._adjustWidthsTimer&&this._started&&(this._adjustWidthsTimer=this.defer("_adjustWidths"))});u(d,g,g)},_adjustWidths:function(){this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);
this.containerNode.style.width="auto";this.containerNode.style.width=this.domNode.scrollWidth>this.domNode.offsetWidth?"auto":"100%"},_createTreeNode:function(d){return new S(d)},focus:function(){this.lastFocusedChild?this.focusNode(this.lastFocusedChild):this.focusFirstChild()}});e("dojo-bidi")&&U.extend({_setTextDirAttr:function(d){d&&this.textDir!=d&&(this._set("textDir",d),this.rootNode.set("textDir",d))}});U.PathError=c("TreePathError");U._TreeNode=S;return U})},"dijit/tree/TreeStoreModel":function(){define(["dojo/_base/array",
"dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(B,C,Q,H){return Q("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(l){H.mixin(this,l);this.connects=[];l=this.store;if(!l.getFeatures()["dojo.data.api.Identity"])throw Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");l.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([C.after(l,
"onNew",H.hitch(this,"onNewItem"),!0),C.after(l,"onDelete",H.hitch(this,"onDeleteItem"),!0),C.after(l,"onSet",H.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var l;l=this.connects.pop();)l.remove()},getRoot:function(l,m){this.root?l(this.root):this.store.fetch({query:this.query,onComplete:H.hitch(this,function(w){if(1!=w.length)throw Error("dijit.tree.TreeStoreModel: root query returned "+w.length+" items, but must return exactly one");this.root=w[0];l(this.root)}),onError:m})},mayHaveChildren:function(l){return B.some(this.childrenAttrs,
function(m){return this.store.hasAttribute(l,m)},this)},getChildren:function(l,m,w){var t=this.store;if(t.isItemLoaded(l)){for(var M=[],k=0;k<this.childrenAttrs.length;k++){var c=t.getValues(l,this.childrenAttrs[k]);M=M.concat(c)}var a=0;this.deferItemLoadingUntilExpand||B.forEach(M,function(h){t.isItemLoaded(h)||a++});0==a?m(M):B.forEach(M,function(h,y){t.isItemLoaded(h)||t.loadItem({item:h,onItem:function(K){M[y]=K;0==--a&&m(M)},onError:w})})}else{var e=H.hitch(this,arguments.callee);t.loadItem({item:l,
onItem:function(h){e(h,m,w)},onError:w})}},isItem:function(l){return this.store.isItem(l)},fetchItemByIdentity:function(l){this.store.fetchItemByIdentity(l)},getIdentity:function(l){return this.store.getIdentity(l)},getLabel:function(l){return this.labelAttr?this.store.getValue(l,this.labelAttr):this.store.getLabel(l)},newItem:function(l,m,w){var t={parent:m,attribute:this.childrenAttrs[0]},M;this.newItemIdAttr&&l[this.newItemIdAttr]?this.fetchItemByIdentity({identity:l[this.newItemIdAttr],scope:this,
onItem:function(k){k?this.pasteItem(k,null,m,!0,w):(M=this.store.newItem(l,t))&&void 0!=w&&this.pasteItem(M,m,m,!1,w)}}):(M=this.store.newItem(l,t))&&void 0!=w&&this.pasteItem(M,m,m,!1,w)},pasteItem:function(l,m,w,t,M){var k=this.store,c=this.childrenAttrs[0];m&&B.forEach(this.childrenAttrs,function(e){if(k.containsValue(m,e,l)){if(!t){var h=B.filter(k.getValues(m,e),function(y){return y!=l});k.setValues(m,e,h)}c=e}});if(w)if("number"==typeof M){var a=k.getValues(w,c).slice();a.splice(M,0,l);k.setValues(w,
c,a)}else k.setValues(w,c,k.getValues(w,c).concat(l))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(l,m){m&&this.getChildren(m.item,H.hitch(this,function(w){this.onChildrenChange(m.item,w)}))},onDeleteItem:function(l){this.onDelete(l)},onSetItem:function(l,m){if(-1!=B.indexOf(this.childrenAttrs,m))this.getChildren(l,H.hitch(this,function(w){this.onChildrenChange(l,w)}));else this.onChange(l)}})})},"dijit/tree/ForestStoreModel":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(B,C,Q,H,l){return C("dijit.tree.ForestStoreModel",l,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(m){this.root={store:this,root:!0,id:m.rootId,label:m.rootLabel,children:m.rootChildren}},mayHaveChildren:function(m){return m===this.root||this.inherited(arguments)},getChildren:function(m,w,t){m===this.root?this.root.children?w(this.root.children):this.store.fetch({query:this.query,onComplete:H.hitch(this,
function(M){this.root.children=M;w(M)}),onError:t}):this.inherited(arguments)},isItem:function(m){return m===this.root?!0:this.inherited(arguments)},fetchItemByIdentity:function(m){if(m.identity==this.root.id){var w=m.scope||Q.global;m.onItem&&m.onItem.call(w,this.root)}else this.inherited(arguments)},getIdentity:function(m){return m===this.root?this.root.id:this.inherited(arguments)},getLabel:function(m){return m===this.root?this.root.label:this.inherited(arguments)},newItem:function(m,w,t){return w===
this.root?(this.onNewRootItem(m),this.store.newItem(m)):this.inherited(arguments)},onNewRootItem:function(){},pasteItem:function(m,w,t,M,k){if(w===this.root&&!M)this.onLeaveRoot(m);this.inherited(arguments,[m,w===this.root?null:w,t===this.root?null:t,M,k]);if(t===this.root)this.onAddToRoot(m)},onAddToRoot:function(m){console.log(this,": item ",m," added to root")},onLeaveRoot:function(m){console.log(this,": item ",m," removed from root")},_requeryTop:function(){var m=this.root.children||[];this.store.fetch({query:this.query,
onComplete:H.hitch(this,function(w){this.root.children=w;if(m.length!=w.length||B.some(m,function(t,M){return w[M]!=t}))this.onChildrenChange(this.root,w)})})},onNewItem:function(m,w){this._requeryTop();this.inherited(arguments)},onDeleteItem:function(m){-1!=B.indexOf(this.root.children,m)&&this._requeryTop();this.inherited(arguments)},onSetItem:function(m,w,t,M){this._requeryTop();this.inherited(arguments)}})})},"dijit/tree/_dndSelector":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/dnd/common dojo/dom dojo/mouse dojo/on dojo/touch ../a11yclick ./_dndContainer".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c){return C("dijit.tree._dndSelector",c,{constructor:function(){this.selection={};this.anchor=null;this.events.push(t(this.tree.domNode,M.press,H.hitch(this,"onMouseDown")),t(this.tree.domNode,M.release,H.hitch(this,"onMouseUp")),t(this.tree.domNode,M.move,H.hitch(this,"onMouseMove")),t(this.tree.domNode,k.press,H.hitch(this,"onClickPress")),t(this.tree.domNode,k.release,H.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var a=[],e=this.selection,
h;for(h in e)a.push(e[h]);return a},selectNone:function(){this.setSelection([]);return this},destroy:function(){this.inherited(arguments);this.selection=this.anchor=null},addTreeNode:function(a,e){this.setSelection(this.getSelectedTreeNodes().concat([a]));e&&(this.anchor=a);return a},removeTreeNode:function(a){var e=B.filter(this.getSelectedTreeNodes(),function(h){return!m.isDescendant(h.domNode,a.domNode)});this.setSelection(e);return a},isTreeNodeSelected:function(a){return a.id&&!!this.selection[a.id]},
setSelection:function(a){var e=this.getSelectedTreeNodes();B.forEach(this._setDifference(e,a),H.hitch(this,function(h){h.setSelected(!1);this.anchor==h&&delete this.anchor;delete this.selection[h.id]}));B.forEach(this._setDifference(a,e),H.hitch(this,function(h){h.setSelected(!0);this.selection[h.id]=h}));this._updateSelectionProperties()},_setDifference:function(a,e){B.forEach(e,function(h){h.__exclude__=!0});a=B.filter(a,function(h){return!h.__exclude__});B.forEach(e,function(h){delete h.__exclude__});
return a},_updateSelectionProperties:function(){var a=this.getSelectedTreeNodes(),e=[],h=[];B.forEach(a,function(y){var K=y.getTreePath();h.push(y);e.push(K)},this);a=B.map(h,function(y){return y.item});this.tree._set("paths",e);this.tree._set("path",e[0]||[]);this.tree._set("selectedNodes",h);this.tree._set("selectedNode",h[0]||null);this.tree._set("selectedItems",a);this.tree._set("selectedItem",a[0]||null)},onClickPress:function(a){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(a.target,
this.current))){"mousedown"==a.type&&w.isLeft(a)&&a.preventDefault();var e="keydown"==a.type?this.tree.focusedChild:this.current;if(e){var h=l.getCopyKeyState(a),y=e.id;this.singular||a.shiftKey||!this.selection[y]?(this._doDeselect=!1,this.userSelect(e,h,a.shiftKey)):this._doDeselect=!0}}},onClickRelease:function(a){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==a.type?this.tree.focusedChild:this.current,l.getCopyKeyState(a),a.shiftKey))},onMouseMove:function(){this._doDeselect=
!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(a,e){if(a===e)return 0;if("sourceIndex"in document.documentElement)return a.sourceIndex-e.sourceIndex;if("compareDocumentPosition"in document.documentElement)return a.compareDocumentPosition(e)&2?1:-1;if(document.createRange){var h=doc.createRange();h.setStartBefore(a);a=doc.createRange();a.setStartBefore(e);return h.compareBoundaryPoints(h.END_TO_END,a)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");
},userSelect:function(a,e,h){if(this.singular)this.anchor==a&&e?this.selectNone():(this.setSelection([a]),this.anchor=a);else if(h&&this.anchor){e=this._compareNodes(this.anchor.rowNode,a.rowNode);h=this.anchor;0>e?e=h:(e=a,a=h);for(h=[];e!=a;)h.push(e),e=this.tree._getNext(e);h.push(a);this.setSelection(h)}else this.selection[a.id]&&e?this.removeTreeNode(a):e?this.addTreeNode(a,!0):(this.setSelection([a]),this.anchor=a)},getItem:function(a){return{data:this.selection[a],type:["treeNode"]}},forInSelectedItems:function(a,
e){e=e||Q.global;for(var h in this.selection)a.call(e,this.getItem(h),h,this)}})})},"dijit/tree/_dndContainer":function(){define("dojo/aspect dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/on dojo/touch".split(" "),function(B,C,Q,H,l,m){return C("dijit.tree._dndContainer",null,{constructor:function(w,t){this.tree=w;this.node=w.domNode;H.mixin(this,t);this.containerState="";Q.add(this.node,"dojoDndContainer");this.events=[l(this.node,m.enter,H.hitch(this,"onOverEvent")),l(this.node,m.leave,
H.hitch(this,"onOutEvent")),B.after(this.tree,"_onNodeMouseEnter",H.hitch(this,"onMouseOver"),!0),B.after(this.tree,"_onNodeMouseLeave",H.hitch(this,"onMouseOut"),!0),l(this.node,"dragstart, selectstart",function(M){M.preventDefault()})]},destroy:function(){for(var w;w=this.events.pop();)w.remove();this.node=this.parent=null},onMouseOver:function(w){this.current=w},onMouseOut:function(){this.current=null},_changeState:function(w,t){var M="dojoDnd"+w;w=w.toLowerCase()+"State";Q.replace(this.node,M+
t,M+this[w]);this[w]=t},_addItemClass:function(w,t){Q.add(w,"dojoDndItem"+t)},_removeItemClass:function(w,t){Q.remove(w,"dojoDndItem"+t)},onOverEvent:function(){this._changeState("Container","Over")},onOutEvent:function(){this._changeState("Container","")}})})},"jimu/dijit/LayerChooserFromMapWithDropbox":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/Deferred dijit/popup dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/LayerChooserFromMapWithDropbox.html jimu/LayerInfos/LayerInfos".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a){return B([M,k,m],{templateString:c,baseClass:"jimu-layer-chooser-from-map-withdropbox",declaredClass:"jimu.dijit.LayerChooserFromMapWithDropbox",_selectedItem:null,_isLayerChooserShow:!1,layerInfosObj:null,layerChooser:null,customClass:"",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.queryableLayerSource;this.nls.customSelectLayer=this.label?this.label:this.nls.selectLayer},postCreate:function(){this.inherited(arguments);this.layerInfosObj=
a.getInstanceSync();this.layerChooser.domNode.style.zIndex=1;this.layerChooser.tree.domNode.style.borderTop="0";this.layerChooser.tree.domNode.style.maxHeight="290px";this.own(H(this.layerChooser,"tree-click",C.hitch(this,this._onTreeClick)));this.own(H(this.layerChooser,"update",C.hitch(this,this._onLayerChooserUpdate)));this.own(H(document.body,"click",C.hitch(this,this._onBodyClicked)));this.own(H(document.body,"keydown",C.hitch(this,function(e){e.keyCode===l.ENTER&&this._onBodyClicked(e)})));
this.own(H(this.layerChooser.domNode,"keydown",C.hitch(this,function(e){e.keyCode===l.ESCAPE&&this.hideLayerChooser()})))},destroy:function(){this.hideLayerChooser();this.layerChooser&&this.layerChooser.destroy();this.layerChooser=null;this.inherited(arguments)},getLayerChooser:function(){return this.layerChooser},setSelectedLayer:function(e){var h=new w;if(e){var y=this.layerInfosObj.getLayerOrTableInfoById(e.id);y?this.layerChooser.filter(y).then(C.hitch(this,function(K){K?(this._onSelectNewItem({layerInfo:y,
name:y.title,url:e.url}),h.resolve(!0)):h.resolve(!1)}),C.hitch(this,function(){h.resolve(!1)})):h.resolve(!1)}else this._onSelectNewItem(null),h.resolve(!0);return h},getSelectedItem:function(){return this._selectedItem},getSelectedItems:function(){return[this._selectedItem]},_onBodyClicked:function(e){e=e.target||e.srcElement;e===this.domNode||Q.isDescendant(e,this.domNode)||e===this.layerChooser.domNode||Q.isDescendant(e,this.layerChooser.domNode)||this.hideLayerChooser()},_onDropDownClick:function(e){e.stopPropagation();
e.preventDefault();this._isLayerChooserShow?this.hideLayerChooser():(this.isActive=!0,this.showLayerChooser())},_onDropDownKeydown:function(e){e.keyCode===l.ENTER&&this._onDropDownClick(e)},_getSelectedItems:function(){return this.layerChooser.getSelectedItems()},showLayerChooser:function(){this.layerChooser.domNode.style.minWidth=this.domNode.clientWidth+2+"px";t.open({parent:this,popup:this.layerChooser,around:this.domNode});var e=this.layerChooser.domNode.parentNode;e&&(Q.addClass(e,"jimu-layer-chooser-from-map-withdropbox-popup"),
this.customClass&&Q.addClass(e,this.customClass),this.layerChooser.tree.domNode.focus());this._isLayerChooserShow=!0},hideLayerChooser:function(){t.close(this.layerChooser);this._isLayerChooserShow=!1;this.isActive&&(this.dropDownBtn.focus(),this.isActive=!1)},_onLayerChooserUpdate:function(){this._selectedItem&&this.layerChooser.onlyShowVisible&&!this._selectedItem.layerInfo.isShowInMap()&&(this._selectedItem=null,this.emit("selection-change",[]))},_onSelectNewItem:function(e){var h=C.getObject("layerInfo.id",
!1,this._selectedItem)||-1,y=C.getObject("layerInfo.id",!1,e)||-1;h=h!==y;this._selectedItem=e;this.hideLayerChooser();e=C.getObject("layerInfo.title",!1,this._selectedItem)||"";this.layerNameNode.innerHTML=e;Q.setAttr(this.layerNameNode,"title",e);e=C.getObject("layerInfo.layerObject",!1,this._selectedItem);h&&this.emit("selection-change",[e])},_onTreeClick:function(){var e=this._getSelectedItems();this._onSelectNewItem(0<e.length?e[0]:null)}})})},"jimu/dijit/FeatureSetChooserForSingleLayer":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin jimu/dijit/DrawBox jimu/dijit/_FeatureSetChooserCore esri/symbols/jsonUtils".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c){return l([m,w,t,C],{baseClass:"jimu-single-layer-featureset-chooser",templateString:"\x3cdiv\x3e\x3c/div\x3e",drawBox:null,map:null,featureLayer:null,updateSelection:!1,postCreate:function(){this.inherited(arguments);var a=c.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}});this.drawBox=new M({map:this.map,showClear:!0,keepOneGraphic:!0,geoTypes:["EXTENT"]});this.drawBox.setPolygonSymbol(a);
a=this.drawBox.getDrawItemIcons();H.forEach(a,Q.hitch(this,function(e){e.title=""}));this.drawBox.extentIcon.title=window.jimuNls.spatialFilterByFeatures.drawShapesTip;this.drawBox.placeAt(this.domNode);this.own(B(this.drawBox,"user-clear",Q.hitch(this,this._onDrawBoxUserClear)));this.own(B(this.drawBox,"draw-activate",Q.hitch(this,function(){this.emit("draw-activate")})));this.own(B(this.drawBox,"draw-deactivate",Q.hitch(this,function(){this.emit("draw-deactivate")})));this.own(B(this.drawBox,"draw-end",
Q.hitch(this,this._onDrawEnd)));this.featureSetChooserCore=new k({map:this.map,featureLayer:this.featureLayer,drawBox:this.drawBox,updateSelection:this.updateSelection});this.own(B(this.featureSetChooserCore,"loading",Q.hitch(this,function(){this.emit("loading")})));this.own(B(this.featureSetChooserCore,"unloading",Q.hitch(this,function(){this.emit("unloading")})));this.own(B(this.featureLayer,"visibility-change",Q.hitch(this,function(){this.featureLayer.visible?this.drawBox.enable():this.drawBox.disable()})))},
getFeatures:function(){return this.featureSetChooserCore.getFeatures()},syncGetFeatures:function(){return this.featureSetChooserCore.syncGetFeatures()},disable:function(){this.drawBox.disable()},enable:function(){this.drawBox.enable()},deactivate:function(){this.drawBox.deactivate()},clearAllGraphics:function(){this.featureSetChooserCore.clear(!1)},isLoading:function(){return this.featureSetChooserCore.isLoading()},getFeatureLayer:function(){return this.featureLayer},destroy:function(){this.featureSetChooserCore&&
this.featureSetChooserCore.destroy();this.featureSetChooserCore=null;this.inherited(arguments)},_onDrawEnd:function(){this.drawBox.clear()},_onDrawBoxUserClear:function(){this.clearAllGraphics();this.emit("user-clear")},showMiddleFeatureLayer:function(){this.featureSetChooserCore&&this.featureSetChooserCore.showMiddleFeatureLayer()},hideMiddleFeatureLayer:function(){this.featureSetChooserCore&&this.featureSetChooserCore.hideMiddleFeatureLayer()}})})},"jimu/dijit/_FeatureSetChooserCore":function(){define("dojo/on dojo/sniff dojo/Evented dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/declare jimu/utils jimu/symbolUtils jimu/SelectionManager jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/symbols/jsonUtils esri/geometry/geometryEngine".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I){return w([Q],{baseClass:"jimu-featureset-chooser-core",_middleFeatureLayer:null,_isLoading:!1,_def:null,_isDestroyed:!1,_handles:null,selectionManager:null,layerInfosObj:null,layerInfo:null,map:null,featureLayer:null,drawBox:null,updateSelection:!1,fullyWithin:!1,constructor:function(r){l.mixin(this,r);this.layerInfosObj=c.getInstanceSync();this.selectionManager=k.getInstance();this.featureLayer.getSelectionSymbol()||this.selectionManager.setSelectionSymbol(this.featureLayer);
r=t.getFeatureLayerDefinition(this.featureLayer);delete r.id;this._middleFeatureLayer=new y({layerDefinition:r,featureSet:null},{id:"featureLayer_"+t.getRandomString()});r=null;var D=this._middleFeatureLayer.geometryType;"esriGeometryPoint"===D?r=M.getDefaultMarkerSymbol():"esriGeometryPolyline"===D?r=M.getDefaultLineSymbol():"esriGeometryPolygon"===D&&(r=K.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}));
this._middleFeatureLayer.setSelectionSymbol(r);r=B(this.drawBox,"user-clear",l.hitch(this,this._onDrawBoxUserClear));D=B(this.drawBox,"draw-end",l.hitch(this,this._onDrawEnd));this._handles=[r,D];if(this.layerInfo=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))r=B(this.layerInfo,"filterChanged",l.hitch(this,this._handleFilterChange)),this._handles.push(r)},hideMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.hide();var r=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);
r&&r.hide()}},showMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.show();var r=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);r&&r.show()}},clear:function(r){this.drawBox.clear();this._clearMiddleFeatureLayer();r&&this.selectionManager.clearSelection(this.featureLayer)},getFeatures:function(){var r=new H,D=l.hitch(this,function(){var F=this.syncGetFeatures();r.resolve(F)}),u=l.hitch(this,function(F){r.reject(F)});1===this._getDeferredStatus(this._def)?
this._def.then(D,u):D();return r},syncGetFeatures:function(){return(this.updateSelection?this.featureLayer:this._middleFeatureLayer).getSelectedFeatures()},isLoading:function(){return 1===this._getDeferredStatus(this._def)},_onLoading:function(){this.drawBox.deactivate();this.emit("loading")},_onUnloading:function(){this.emit("unloading")},_getDeferredStatus:function(r){var D=0;return D=r?r.isResolved()?2:r.isRejected()?-1:1:0},_onDrawEnd:function(r,D,u,F,x,L){if(this.isLoading())throw"should not draw when loading";
if(this.featureLayer.visible){var q=new H;this._def=q;var J=y.SELECTION_NEW;F&&(J=y.SELECTION_ADD);C("mac")?L&&(J=y.SELECTION_SUBTRACT):x&&(J=y.SELECTION_SUBTRACT);this.emit("loading");this._getFeaturesByGeometry(r.geometry).then(l.hitch(this,function(v){this.selectionManager.updateSelectionByFeatures(this.updateSelection?this.featureLayer:this._middleFeatureLayer,v,J);this._onUnloading();q.resolve(v)}),l.hitch(this,function(v){console.error(v);this._onUnloading();q.reject(v)}))}},_addTolerance:function(r){var D=
2.54*this.map.getScale()/9600;return I.buffer(r,10*D,"meters")},_getFeaturesByGeometry:function(r){"point"!==r.type&&"polyline"!==r.type||"esriGeometryPoint"!==this.featureLayer.geometryType||(r=this._addTolerance(r));var D=new H,u=[];if(this.featureLayer.getMap()&&this.featureLayer.mode!==y.MODE_SELECTION)r=this.selectionManager.getClientFeaturesByGeometry(this.featureLayer,r,this.fullyWithin),0<r.length&&(u=m.map(r,l.hitch(this,function(x){return new a(x.toJson())}))),D.resolve(u);else{u=new e;
u.geometry=r;u.outSpatialReference=this.map.spatialReference;u.returnGeometry=!0;u.spatialRelationship=this.fullyWithin?e.SPATIAL_REL_CONTAINS:e.SPATIAL_REL_INTERSECTS;(r=this.featureLayer.getDefinitionExpression())||(r="1\x3d1");if(this.layerInfo){var F=this.layerInfo.getFilter();F&&(r="("+r+") AND ("+F+")")}r&&(u.where=r);u.outFields=["*"];(new h(this.featureLayer.url)).execute(u).then(l.hitch(this,function(x){D.resolve(x.features)}),l.hitch(this,function(x){D.reject(x)}))}return D},_onDrawBoxUserClear:function(){this.clear()},
_clearMiddleFeatureLayer:function(){this._middleFeatureLayer&&(this._middleFeatureLayer.clear(),this.selectionManager.clearSelection(this._middleFeatureLayer))},_handleFilterChange:function(){var r=this.layerInfo.getFilter()||"1\x3d1",D=this.featureLayer.getSelectedFeatures(),u=this.featureLayer.objectIdField;if(D&&0<D.length){var F=m.map(D,function(L){return L.attributes[u]}),x=new e;x.where=u+" in ("+F.join(",")+") AND "+r;(new h(this.featureLayer.url)).executeForIds(x).then(l.hitch(this,function(L){m.forEach(D,
function(q){0<=L.indexOf(q.attributes[u])?q.show():q.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.featureLayer)&&this.selectionManager._updateDisplayLayer(this.featureLayer,D,y.SELECTION_NEW);this.featureLayer.emit("selection-complete",{features:this.featureLayer.getSelectedFeatures()})}),l.hitch(this,function(L){console.error(L)}))}},destroy:function(){this._isDestroyed||(m.forEach(this._handles,l.hitch(this,function(r){r.remove()})),this._handles=null,this.clear());this._isDestroyed=
!0}})})},"widgets/Query/SingleQueryResult":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./SingleQueryResult.html dojo/_base/lang dojo/on dojo/keys dojo/_base/query dojo/_base/html dojo/_base/array dojo/Deferred esri/lang esri/tasks/QueryTask esri/tasks/FeatureSet esri/dijit/PopupTemplate esri/dijit/PopupRenderer esri/tasks/RelationshipQuery esri/renderers/SimpleRenderer jimu/utils jimu/symbolUtils jimu/dijit/Popup jimu/dijit/Message jimu/dijit/FeatureActionPopupMenu jimu/BaseFeatureAction jimu/dijit/SymbolChooser jimu/LayerInfos/LayerInfos jimu/FeatureActionManager ./SingleQueryLoader ./RelatedRecordsResult jimu/dijit/LoadingIndicator jimu/dijit/formSelect".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r,D,u,F,x,L,q,J,v,z,b,n,p,O,T){return B([C,Q,H,l,m],{baseClass:"single-query-result",templateString:w,singleQueryLoader:null,featureLayer:null,singleRelatedRecordsResult:null,multipleRelatedRecordsResult:null,popupMenu:null,map:null,nls:null,currentAttrs:null,queryWidget:null,_lastFeatureClass:"jimu-table-row-last",_lastFeatureArrowClass:"popup-title-icon",_lastRelatedClass:"related-table-btn-last",postMixInProperties:function(){this.inherited(arguments);
this.isRenderIdForAttrs=!0;var f=window.jimuNls.common;this.nls.back=f.back;this.nls.expand=f.expand.split(" $")[0];this.nls.collapse=f.collapse.split(" $")[0]},getCurrentAttrs:function(){return this.singleQueryLoader?this.singleQueryLoader.getCurrentAttrs():null},postCreate:function(){this.inherited(arguments);this.singleQueryLoader=new O(this.map,this.currentAttrs);this.popupMenu=v.getInstance();this.featureActionManager=p.getInstance();this.btnFeatureAction.title=window.jimuNls.featureActions.featureActions;
this._initExpandListIcon();this.own(M(this.multipleRelatedRecordsDiv,"keydown",t.hitch(this,function(f){f.keyCode===k.ESCAPE&&f.target!==this.multipleRelatedRecordsResultBackBtn&&(f.stopPropagation(),this.multipleRelatedRecordsResultBackBtn.focus())})));this.own(M(this.singleRelatedRecordsResultDiv,"keydown",t.hitch(this,function(f){f.keyCode===k.ESCAPE&&f.target!==this.singleRelatedRecordsResultBackBtn&&(f.stopPropagation(),this.singleRelatedRecordsResultBackBtn.focus())})))},_initExpandListIcon:function(){var f=
this.getCurrentAttrs();(f=f&&f.config)&&f.defaultExpand?(a.addClass(this.expandedListIcon,"expanded"),this.expandedListIcon.title=this.nls.collapseAll,a.addClass(this.resultsTbody,"expanded")):(a.addClass(this.expandedListIcon,"folded"),this.expandedListIcon.title=this.nls.expandAll,a.addClass(this.resultsTbody,"folded"))},destroy:function(){this.emit("features-update",{taskIndex:this.currentAttrs.queryTr.taskIndex});this.queryWidget=null;var f=this.getCurrentAttrs();f&&f.query&&(f.query.resultLayer&&
f.query.resultLayer.getMap()&&this.map.removeLayer(f.query.resultLayer),f.query.resultLayer=null);this.inherited(arguments)},_isValidNumber:function(f){return"number"===typeof f&&!isNaN(f)},zoomToLayer:function(){var f=this.getCurrentAttrs(),A=f.query.resultLayer;A&&!this._isTable(f.layerInfo)&&(f=e.filter(A.graphics,t.hitch(this,function(E){return(E=E.geometry)?"point"===E.type?this._isValidNumber(E.x)&&this._isValidNumber(E.y):"multipoint"===E.type?E.points&&0<E.points.length?e.every(E.points,t.hitch(this,
function(N){return N?this._isValidNumber(N[0])&&this._isValidNumber(N[1]):!1})):!1:!0:!1})),0<f.length&&(f=x.toFeatureSet(f),x.zoomToFeatureSet(this.map,f)))},_emitFeaturesUpdate:function(){this.emit("features-update",{taskIndex:this.currentAttrs.queryTr.taskIndex,features:this.currentAttrs.query.resultLayer.graphics})},executeQueryForFirstTime:function(){var f=new h;this._clearResultPage();this._hideResultsNumberDiv();var A=this.getCurrentAttrs(),E=A.query.resultLayer,N=t.hitch(this,function(U){if(this.domNode){this.shelter.hide();
var d=A.query.allCount;this._updateNumSpan(A.query.foundedNum,d);0<d&&(this._addResultItems(U,E),this._addResultLayerToMap(E),this.zoomToLayer());f.resolve(d);this._emitFeaturesUpdate()}}),S=t.hitch(this,function(U){console.error(U);this.domNode&&(this.shelter.hide(),E&&this.map.removeLayer(E),E=null,this._showQueryErrorMsg(),f.reject(U))});this.shelter.show();3!==A.queryType&&this._showResultsNumberDiv();this.singleQueryLoader.executeQueryForFirstTime().then(N,S);return f},getResultLayer:function(){var f=
this.getCurrentAttrs();return t.getObject("query.resultLayer",!1,f)},showResultLayer:function(){var f=this.getResultLayer();f&&f.show()},hideResultLayer:function(){var f=this.getResultLayer();f&&f.hide()},showLayer:function(){this.showResultLayer();this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.showLayer();this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.showLayer()},hideLayer:function(){this.hideResultLayer();this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.hideLayer();
this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.hideLayer()},_addResultLayerToMap:function(f){0>this.map.graphicsLayerIds.indexOf(f.id)&&this.map.addLayer(f)},_showResultsNumberDiv:function(){a.setStyle(this.resultsNumberDiv,"display","flex")},_hideResultsNumberDiv:function(){a.setStyle(this.resultsNumberDiv,"display","none")},_updateNumSpan:function(f,A){f>A&&(f=A);this._updateLoadMoreVisible(f<A);f=x.localizeNumber(f);A=x.localizeNumber(A);this.numSpan.innerHTML=f+"/"+A},_isTable:function(f){return"Table"===
f.type},_onResultsScroll:function(){x.isScrollToBottom(this.resultsContainer)&&this._continueQuery()},_continueQuery:function(){var f=this.getCurrentAttrs(),A=f.query.allCount,E=f.query.foundedNum;if(!(E>=A)){var N=f.query.resultLayer,S=t.hitch(this,function(d){this.domNode&&(this._updateLoadMoreState(!1),this.shelter.hide(),E=f.query.foundedNum,this._updateNumSpan(E,A),this._addResultItems(d,N),this.zoomToLayer(),this._emitFeaturesUpdate(),this.emit("features-layout-update"))}),U=t.hitch(this,function(d){console.error(d);
this.domNode&&(this._updateLoadMoreState(!1),this._showQueryErrorMsg(),this.shelter.hide())});this.shelter.show();this._updateLoadMoreState(!0);this.singleQueryLoader.executeQueryWhenScrollToBottom().then(S,U)}},_clearResultPage:function(){this._hideInfoWindow();this._unSelectResultTr();a.empty(this.resultsTbody);this._updateNumSpan(0,0)},_unSelectResultTr:function(){this.resultTr&&a.removeClass(this.resultTr,"jimu-state-active");this.resultTr=null},_selectResultTr:function(f){this._unSelectResultTr();
(this.resultTr=f)&&a.addClass(this.resultTr,"jimu-state-active")},_addResultItems:function(f,A){var E=this.getCurrentAttrs(),N=E.config.url,S=E.config.objectIdField,U=this._getCurrentRelationships(),d=t.clone(E.config.popupInfo);d.mediaInfos=[];var g=new r(d),G=!0;A.renderer||(G=!1);var P=this._isWebMapShowRelatedRecordsEnabled();this._featuresNum=f.length;e.forEach(f,t.hitch(this,function(R,aa){var V="";V=0===aa%2?"even":"odd";A.add(R);this._createQueryResultItem({resultLayer:A,feature:R,trClass:V,
popupTemplate2:g,relationships:U,objectIdField:S,url:N,relationshipPopupTemplates:E.relationshipPopupTemplates,shouldCreateSymbolNode:G,isWebMapShowRelatedRecordsEnabled:P},aa)}))},_updateLoadMoreVisible:function(f){f?a.removeClass(this.loadMoreIcon,"query-hidden"):a.addClass(this.loadMoreIcon,"query-hidden")},_updateLoadMoreState:function(f){f?a.addClass(this.loadMoreIcon,"loading"):a.removeClass(this.loadMoreIcon,"loading")},_onLoadMoreClicked:function(){this._continueQuery()},_onLoadMoreKeydown:function(f){f.keyCode!==
k.ENTER&&f.keyCode!==k.SPACE||this._onLoadMoreClicked()},_clearPopItemClass:function(){var f=c(".query-result-item-table .popup-td.expanded",this.resultsTbody),A=c(".query-result-item-table .popup-td.folded",this.resultsTbody);f&&f.length&&f.removeClass("expanded");A&&A.length&&A.removeClass("folded")},_onExpandClicked:function(){var f=this.nls.expand;this._clearPopItemClass();a.hasClass(this.resultsTbody,"expanded")?(a.addClass(this.expandedListIcon,"folded"),a.removeClass(this.resultsTbody,"expanded"),
a.addClass(this.resultsTbody,"folded"),this.expandedListIcon.title=this.nls.expandAll):(a.removeClass(this.expandedListIcon,"folded"),a.addClass(this.resultsTbody,"expanded"),a.removeClass(this.resultsTbody,"folded"),this.expandedListIcon.title=this.nls.collapseAll,f=this.nls.collapse);for(var A=c(".popup-title-icon",this.resultsTbody),E=0;E<A.length;E++)a.setAttr(A[E],"aria-label",f);this.emit("features-layout-update")},_onExpandKeydown:function(f){f.keyCode!==k.ENTER&&f.keyCode!==k.SPACE||this._onExpandClicked()},
_getPopupTitle:function(f,A){if(f)return"function"===typeof f.title?f.title(A):f.title},_createQueryResultItem:function(f,A){var E="",N="",S="";A===this._featuresNum-1&&(E=" "+this._lastFeatureClass,N=" "+this._lastRelatedClass,S='data-lastArrow\x3d"true"');var U=f.resultLayer,d=f.feature,g=f.trClass,G=f.popupTemplate2,P=f.relationships,R=f.objectIdField,aa=f.url,V=f.relationshipPopupTemplates,X=f.shouldCreateSymbolNode;f=f.isWebMapShowRelatedRecordsEnabled;if(d&&d.attributes){var Y=this._getPopupTitle(G,
d);E=a.toDom('\x3ctr role\x3d"button" tabindex\x3d"0" class\x3d"jimu-table-row jimu-table-row-separator query-result-item'+E+'"  cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctd\x3e\x3ctable class\x3d"query-result-item-table"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd class\x3d"symbol-td"\x3e\x3c/td\x3e\x3ctd class\x3d"popup-td expanded"\x3e\x3cdiv class\x3d"popup-title-container"\x3e\x3cdiv class\x3d"popup-title"\x3e'+Y+'\x3c/div\x3e\x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"'+this.nls.collapse+
'" '+S+' class\x3d"popup-title-icon"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"popup-content"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e');a.addClass(E,g);a.place(E,this.resultsTbody);E.feature=d;g=c(".symbol-td",E)[0];if(X)try{var Z=U.renderer;if(Z){var W=Z.getSymbol(d);if(W){var fa=L.createSymbolNode(W,{width:32,height:32});fa&&a.place(fa,g)}}}catch(ea){console.error(ea)}else a.destroy(g);var ca=c(".popup-td .popup-content",E)[0];U=G.title;X=G.info&&
G.info.title;G.title=null;X&&(G.info.title=null);Z=new D({template:G,graphic:d,chartTheme:G.chartTheme});a.place(Z.domNode,ca);Z.startup();G.title=U;X&&(G.info.title=X);if(R&&P&&0<P.length&&f){var da=d.attributes[R];e.forEach(P,t.hitch(this,function(ea,ba){var ia=this._getRelationshipLayerInfo(ea.relatedTableId),ja=ia.name,ka=V[ea.relatedTableId],ha="related-table-btn";A===this._featuresNum-1&&ba===P.length-1&&(ha=ha+" "+N);ba=a.create("div",{"class":ha,role:"button",tabindex:"0",innerHTML:ja},ca);
ba.queryStatus="unload";ba.url=aa;ba.layerName=ja;ba.objectId=da;ba.relationship=ea;ba.relationshipLayerInfo=ia;ba.relationshipPopupTemplate=ka}))}}},_onBtnMultipleRelatedBackClicked:function(){this._showFeaturesResultDiv()},_onBtnMultipleRelatedBackKeydown:function(f){f.keyCode===k.ENTER||f.keyCode===k.SPACE||f.keyCode===k.ESCAPE?(f.stopPropagation(),this._onBtnMultipleRelatedBackClicked(),this.btnFeatureAction.focus()):f.keyCode===k.TAB&&f.shiftKey&&(f.preventDefault(),this.multipleRelatedRecordsResult.lastFocusItem.focus())},
_onBtnSingleRelatedBackClicked:function(){this._showFeaturesResultDiv()},_onBtnSingleRelatedBackKeydown:function(f){f.keyCode===k.ENTER||f.keyCode===k.SPACE||f.keyCode===k.ESCAPE?(f.stopPropagation(),this._onBtnSingleRelatedBackClicked(),this._currentRelatedRecord.focus()):f.keyCode===k.TAB&&f.shiftKey&&f.stopPropagation()},_onBtnSingleRelatedTitleKeydown:function(f){f.keyCode===k.TAB&&f.shiftKey&&(f.preventDefault(),this.singleRelatedRecordsResult.lastFocusItem.focus())},_showFeaturesResultDiv:function(){this.multipleRelatedRecordsResult&&
this.multipleRelatedRecordsResult.destroy();this.multipleRelatedRecordsResult=null;this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.destroy();this.singleRelatedRecordsResult=null;a.addClass(this.multipleRelatedRecordsDiv,"not-visible");a.addClass(this.singleRelatedRecordsResultDiv,"not-visible");a.removeClass(this.featuresResultDiv,"not-visible");this.emit("hide-related-records")},_showMultipleRelatedRecords:function(){this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.destroy();
this.singleRelatedRecordsResult=null;a.addClass(this.featuresResultDiv,"not-visible");a.addClass(this.singleRelatedRecordsResultDiv,"not-visible");a.removeClass(this.multipleRelatedRecordsDiv,"not-visible");this.emit("show-related-records");var f=this._getCurrentRelationships();this.relatedLayersSelect.removeOption(this.relatedLayersSelect.getOptions());e.forEach(f,t.hitch(this,function(A){var E=this._getRelationshipLayerInfo(A.relatedTableId);this.relatedLayersSelect.addOption({value:A.id+"",label:E.name,
relationship:A,relationshipLayerInfo:E,relationshipPopupTemplate:this.currentAttrs.relationshipPopupTemplates[A.relatedTableId]})}));this._onRelatedLayersSelectChanged()},_onRelatedLayersSelectChanged:function(){var f=this.relatedLayersSelect.get("value"),A=this.relatedLayersSelect.getOptions(f);if(A){this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.destroy();this.multipleRelatedRecordsResult=new T({map:this.map,layerDefinition:A.relationshipLayerInfo,nls:this.nls,config:this.currentAttrs.config});
this.multipleRelatedRecordsResult.placeAt(this.multipleRelatedRecordsDiv);this.multipleRelatedRecordsResult.lastFocusItem=this.multipleRelatedRecordsResultBackBtn;this.multipleRelatedRecordsResultBackBtn.focus();this.own(M(this.multipleRelatedRecordsResult,"focus-result-header",t.hitch(this,function(){this.multipleRelatedRecordsResultBackBtn.focus()})));var E=this.currentAttrs.config.url;this.shelter.show();var N=t.hitch(this,function(S){console.error(S);this.domNode&&this.shelter.hide()});this.singleQueryLoader.getObjectIdsForAllRelatedRecordsAction().then(t.hitch(this,
function(S){this._queryRelatedRecords(E,S,A.relationship.id).then(t.hitch(this,function(U){if(this.domNode){this.shelter.hide();var d=[];e.forEach(S,t.hitch(this,function(P){(P=U[P])&&P.features&&0<P.features.length&&(d=d.concat(P.features))}));var g=A.relationshipLayerInfo,G=new I;G.fields=t.clone(g.fields);G.features=d;G.geometryType=g.geometryType;G.fieldAliases={};e.forEach(G.fields,t.hitch(this,function(P){var R=P.name;G.fieldAliases[R]=P.alias||R}));this.multipleRelatedRecordsResult.setResult(A.relationshipPopupTemplate,
G)}}),N)}),N)}},_showSingleRelatedRecordsDiv:function(){this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.destroy();this.multipleRelatedRecordsResult=null;a.addClass(this.featuresResultDiv,"not-visible");a.addClass(this.multipleRelatedRecordsDiv,"not-visible");a.removeClass(this.singleRelatedRecordsResultDiv,"not-visible");this.emit("show-related-records")},_onSingleRelatedTableButtonClicked:function(f){this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.destroy();
this.singleRelatedRecordsResult=null;var A=f.url,E=f.layerName,N=f.objectId,S=f.relationship,U=f.relationshipLayerInfo,d=f.relationshipPopupTemplate;this.singleRelatedRecordsResult=new T({map:this.map,layerDefinition:U,nls:this.nls,config:this.currentAttrs.config});this.singleRelatedRecordsResult.placeAt(this.singleRelatedRecordsResultDiv);this.singleRelatedRecordsResultTitle.lastFocusItem=this.singleRelatedRecordsResultBackBtn;this.own(M(this.singleRelatedRecordsResult,"focus-result-header",t.hitch(this,
function(){this.singleRelatedRecordsResultTitle.focus()})));this._showSingleRelatedRecordsDiv();var g=t.hitch(this,function(){var G=new I;G.fields=t.clone(U.fields);G.features=f.relatedFeatures;G.geometryType=U.geometryType;G.fieldAliases={};e.forEach(G.fields,t.hitch(this,function(P){var R=P.name;G.fieldAliases[R]=P.alias||R}));this.singleRelatedRecordsResult.setResult(d,G);this.relatedTitleDiv.innerHTML=E;this.singleRelatedRecordsResultTitle.focus();this._currentRelatedRecord=f});"unload"===f.queryStatus?
(f.queryStatus="loading",this.shelter.show(),this._queryRelatedRecords(A,[N],S.id).then(t.hitch(this,function(G){this.domNode&&(this.shelter.hide(),G=(G=(G=G&&G[N])&&G.features)||[],f.relatedFeatures=G,f.queryStatus="loaded",g())}),t.hitch(this,function(G){this.domNode&&(this.shelter.hide(),console.error(G),f.queryStatus="unload",g())}))):"loaded"===f.queryStatus&&g()},_queryRelatedRecords:function(f,A,E){f=new K(f);var N=new u;N.objectIds=A;N.relationshipId=E;N.outFields=["*"];N.returnGeometry=!0;
N.outSpatialReference=this.map.spatialReference;return f.executeRelationshipQuery(N)},_getCurrentRelationships:function(){return this.getCurrentAttrs().queryTr.layerInfo.relationships||[]},_getRelationshipInfo:function(f){for(var A=this._getCurrentRelationships(),E=0;E<A.length;E++)if(A[E].id===f)return A[E];return null},_getRelationshipLayerInfo:function(f){return this.getCurrentAttrs().relationshipLayerInfos[f]},_tryLocaleNumber:function(f){var A=f;if(y.isDefined(f)&&isFinite(f))try{var E=x.localizeNumber(f);
"string"===typeof E&&(A=E)}catch(N){console.error(N)}return A+""},_showQueryErrorMsg:function(f){new J({message:f||this.nls.queryError})},_onSinglePopupExpandIconClicked:function(f){var A=this.nls.expand,E=f.parentNode.parentNode;if(E){var N=a.hasClass(this.resultsTbody,"expanded");a.hasClass(E,"expanded")||a.hasClass(E,"folded")?a.hasClass(E,"expanded")?(a.removeClass(E,"expanded"),a.addClass(E,"folded")):(a.addClass(E,"expanded"),a.removeClass(E,"folded"),A=this.nls.collapse):N?(a.addClass(E,"folded"),
a.removeClass(E,"expanded")):(a.addClass(E,"expanded"),a.removeClass(E,"folded"),A=this.nls.collapse);a.setAttr(f,"aria-label",A);"true"===a.getAttr(f,"data-lastArrow")&&this.emit("features-layout-update")}},_onResultsTableKeydown:function(f){f.keyCode!==k.ENTER&&f.keyCode!==k.SPACE||this._onResultsTableClicked(f)},_onResultsTableClicked:function(f){f=f.target||f.srcElement;if(a.isDescendant(f,this.resultsTable))if(a.hasClass(f,"popup-title-icon"))this._onSinglePopupExpandIconClicked(f);else if(a.hasClass(f,
"related-table-btn"))this._onSingleRelatedTableButtonClicked(f);else if(f=a.hasClass(f,"query-result-item")?f:x.getAncestorDom(f,t.hitch(this,function(S){return a.hasClass(S,"query-result-item")}),this.resultsTbody)){this._selectResultTr(f);a.addClass(f,"jimu-state-active");f=f.feature;var A=f.geometry;if(A){var E=A.type;if("point"===E)var N=A;else"multipoint"===E?1===A.points.length?N=A.getPoint(0):1<A.points.length&&(N=A.getPoint(0)):"polyline"===E?(N=A.getExtent(),N=N.expand(1.4),N=N.getCenter()):
"polygon"===E?(N=A.getExtent(),N=N.expand(1.4),N=N.getCenter()):"extent"===E&&(N=A.expand(1.4),N=N.getCenter());A=x.toFeatureSet(f);x.zoomToFeatureSet(this.map,A);"function"===typeof this.map.infoWindow.setFeatures&&this.map.infoWindow.setFeatures([f]);"function"===typeof this.map.infoWindow.reposition&&this.map.infoWindow.reposition();this.map.infoWindow.show(N)}}},_hideInfoWindow:function(){this.map&&this.map.infoWindow&&(this.map.infoWindow.hide(),"function"===typeof this.map.infoWindow.setFeatures&&
this.map.infoWindow.setFeatures([]))},_getFeatureSet:function(){var f=this.currentAttrs.query.resultLayer,A=null,E=this.currentAttrs.config&&this.currentAttrs.config.popupInfo;E&&(A=E.fieldInfos);var N=new I;N.fields=t.clone(f.fields);N.features=[].concat(f.graphics);N.geometryType=f.geometryType;N.fieldAliases={};e.forEach(N.fields,t.hitch(this,function(S){var U=S.name;S=this._getFieldAliasByPopupInfo(S,A);N.fieldAliases[U]=S}));return N},_getFieldAliasByPopupInfo:function(f,A){var E=f.name;f=f.alias||
E;A&&A.length&&(A=A.filter(function(N){return N.fieldName===E})[0])&&(f=A.label);return f},_onBtnMenuClicked:function(f){var A=a.position(f.target||f.srcElement),E=this._getFeatureSet(),N=this.getCurrentAttrs();this.featureActionManager.getSupportedActions(E,N.query.resultLayer).then(t.hitch(this,function(S){e.forEach(S,t.hitch(this,function(g){g.data=E}));if(!N.config.enableExport){var U=["ExportToCSV","ExportToFeatureCollection","ExportToGeoJSON","SaveToMyContent"];S=e.filter(S,t.hitch(this,function(g){return 0>
U.indexOf(g.name)}))}S=e.filter(S,t.hitch(this,function(g){return"CreateLayer"!==g.name}));var d=new z({name:"RemoveQueryResult",iconClass:"icon-close",label:this.nls.removeThisResult,iconFormat:"svg",map:this.map,onExecute:t.hitch(this,this._removeResult)});d.name="RemoveQueryResult";d.data=E;S.push(d);(d=this._getRelatedTableAction(E))&&S.push(d);(d=this._getSymbolAction(E))&&S.push(d);this.popupMenu.setActions(S);this.popupMenu._setFocusedNodeBeforeOpen();this.popupMenu.show(A)}))},_onBtnMenuKeydown:function(f){f.keyCode!==
k.ENTER&&f.keyCode!==k.SPACE||this._onBtnMenuClicked(f)},_getObjectIdField:function(){return this.currentAttrs.config.objectIdField},_getSymbolAction:function(f){var A=null;this.currentAttrs.query.resultLayer.renderer&&this.currentAttrs.config.canModifySymbol&&(A=new z({name:"ChangeSymbol",label:this.nls.changeSymbol,data:f&&f.features,iconClass:"icon-edit-symbol",iconFormat:"svg",map:this.map,onExecute:t.hitch(this,this._showSymbolChooser)}));return A},_showSymbolChooser:function(){var f=this.currentAttrs.query.resultLayer,
A=f.renderer,E={};(A=A.defaultSymbol||A.symbol)?E.symbol=A:(f=x.getSymbolTypeByGeometryType(f.geometryType),E.type=f);var N=new b(E),S=new q({width:380,autoHeight:!0,titleLabel:this.nls.changeSymbol,content:N,onClose:t.hitch(this,function(){N.destroy();S=N=null}),buttons:[{label:window.jimuNls.common.ok,onClick:t.hitch(this,function(){var U=N.getSymbol();this._updateSymbol(U);S.close()})},{label:window.jimuNls.common.cancel,onClick:t.hitch(this,function(){S.close()})}]})},_updateSymbol:function(f){var A=
new F(f),E=this.currentAttrs.query.resultLayer;E.setRenderer(A);E.redraw();A=c(".symbol",this.resultsTable);e.forEach(A,t.hitch(this,function(N){var S=N.parentElement;a.destroy(N);(N=L.createSymbolNode(f,{width:32,height:32}))&&a.place(N,S)}))},_getRelatedTableAction:function(f){var A=null,E=f&&f.features,N=this._getCurrentRelationships();this._getObjectIdField()&&0<E.length&&N&&0<N.length&&this._isWebMapShowRelatedRecordsEnabled()&&(A=new z({iconClass:"icon-show-related-record",icon:"",data:f,label:this.nls.showAllRelatedRecords,
onExecute:t.hitch(this,function(){this._showMultipleRelatedRecords();var S=new h;S.resolve();return S}),getIcon:function(){return""}}));return A},_isWebMapShowRelatedRecordsEnabled:function(){var f=this.currentAttrs.config.popupInfo;return f.relatedRecordsInfo?!1!==f.relatedRecordsInfo.showRelatedRecords:!0},_removeResult:function(){this.queryWidget.removeSingleQueryResult(this);this._hideInfoWindow()},_getAvailableWidget:function(f){return(f=this.queryWidget.appConfig.getConfigElementsByName(f)[0])&&
f.visible?f:null},_openAttributeTable:function(){var f=this._getAvailableWidget("AttributeTable");if(f){var A=n.getInstanceSync().getLayerInfoById(this.currentAttrs.query.resultLayer.id);this.queryWidget.widgetManager.triggerWidgetOpen(f.id).then(t.hitch(this,function(){this.queryWidget.publishData({target:"AttributeTable",layer:A})}))}}})})},"widgets/Query/RelatedRecordsResult":function(){define("dojo/query dojo/keys dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./RelatedRecordsResult.html esri/dijit/PopupRenderer esri/layers/FeatureLayer esri/renderers/SimpleRenderer jimu/utils jimu/symbolUtils jimu/BaseFeatureAction jimu/dijit/Popup jimu/dijit/FeatureActionPopupMenu jimu/dijit/SymbolChooser jimu/FeatureActionManager".split(" "),
function(B,C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r,D,u,F){return w([t,M,k,Q],{baseClass:"related-records-result",templateString:c,popupMenu:null,featureActionManager:null,featureSet:null,layer:null,map:null,layerDefinition:null,nls:null,config:null,postCreate:function(){this.inherited(arguments);this.popupMenu=D.getInstance();this.featureActionManager=F.getInstance();this.btnAction.title=window.jimuNls.featureActions.featureActions;if("Table"!==this.layerDefinition.type){this.layer=new e({layerDefinition:{type:this.layerDefinition.type,
geometryType:this.layerDefinition.geometryType,fields:this.layerDefinition.fields,typeIdField:this.layerDefinition.typeIdField,types:this.layerDefinition.types}});var x=y.getTypeByGeometryType(this.layerDefinition.geometryType),L=null;"point"===x?L=K.getDefaultMarkerSymbol():"polyline"===x?L=K.getDefaultLineSymbol():"polygon"===x&&(L=K.getDefaultFillSymbol());L&&(x=new h(L),this.layer.setRenderer(x));this.map.addLayer(this.layer)}else this.layer=new e({layerDefinition:{type:this.layerDefinition.type,
fields:this.layerDefinition.fields,typeIdField:this.layerDefinition.typeIdField,types:this.layerDefinition.types}})},destroy:function(){this.layer&&this.map.removeLayer(this.layer);this.layer=null;this.inherited(arguments)},setResult:function(x,L){this.layer&&this.layer.clear();this.featureSet=L;if(0<L.features.length){m.forEach(L.features,l.hitch(this,function(J,v){this.layer&&this.layer.add(J);this._createItem(x,J,v)}));var q=B(".item-title",this.content);this.lastFocusItem=q[q.length-1];H.removeClass(this.btnAction,
"not-visible");H.addClass(this.noResultTip,"not-visible");H.removeClass(this.content,"not-visible");L.geometryType&&y.zoomToFeatureSet(this.map,L)}else H.addClass(this.btnAction,"not-visible"),H.removeClass(this.noResultTip,"not-visible"),H.addClass(this.content,"not-visible"),this.lastFocusItem=this.noResultTip},_onNoResultTipKeydown:function(x){x.keyCode!==C.TAB||x.shiftKey||(x.preventDefault(),this.emit("focus-result-header"))},getLayer:function(){return this.layer},showLayer:function(){this.layer&&
this.layer.show()},hideLayer:function(){this.layer&&this.layer.hide()},_createItem:function(x,L,q){var J=x.getTitle(L)||"",v="";q===this.featureSet.features.length-1&&(v='data-isLastItem\x3d"true"');q=H.toDom('\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"item-title" '+v+' role\x3d"button" tabindex\x3d"0"\x3e'+J+'\x3c/div\x3e\x3cdiv class\x3d"item-content" '+v+' tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e');J=B(".item-content",q)[0];x=new a({template:x,graphic:L,chartTheme:x.chartTheme});H.place(x.domNode,
J);x.startup();H.place(q,this.content)},_onContentClicked:function(x){x=x.target||x.srcElement;var L=null;if(L=H.hasClass(x,"item-title")?x:y.getAncestorDom(x,function(v){return H.hasClass(v,"item-title")},this.content)){var q=L.parentNode;H.toggleClass(q,"selected");var J=H.hasClass(q,"selected");B(".item",this.content).removeClass("selected");J&&H.addClass(q,"selected");"true"===H.getAttr(x,"data-isLastItem")&&(this.lastFocusItem=J?L.nextElementSibling:L)}},_onContentKeydown:function(x){if(x.keyCode===
C.ENTER||x.keyCode===C.SPACE)this._onContentClicked(x);else if(x.keyCode===C.TAB&&!x.shiftKey&&"true"===H.getAttr(x.target,"data-isLastItem")){var L=H.hasClass(x.target.parentNode,"selected");if(!L||L&&H.hasClass(x.target,"item-content"))x.preventDefault(),this.emit("focus-result-header")}},_onBtnBackClicked:function(){this.emit("back")},_onBtnMenuClicked:function(x){if(this.featureSet){var L=H.position(x.target||x.srcElement);this.featureActionManager.getSupportedActions(this.featureSet).then(l.hitch(this,
function(q){m.forEach(q,l.hitch(this,function(z){z.data=this.featureSet}));if(!this.config.enableExport){var J=["ExportToCSV","ExportToFeatureCollection","ExportToGeoJSON","SaveToMyContent"];q=m.filter(q,l.hitch(this,function(z){return 0>J.indexOf(z.name)}))}q=m.filter(q,l.hitch(this,function(z){return"CreateLayer"!==z.name}));var v=this._getSymbolAction();v&&q.push(v);this.popupMenu.setActions(q);this.popupMenu._setFocusedNodeBeforeOpen();this.popupMenu.show(L)}))}},_onBtnMenuKeydown:function(x){x.keyCode!==
C.ENTER&&x.keyCode!==C.SPACE||this._onBtnMenuClicked(x)},_getSymbolAction:function(){var x=null;"Table"!==this.layerDefinition.type&&this.layer&&this.layer.renderer&&this.config.canModifySymbol&&((x=this.featureSet&&this.featureSet.features)||(x=[]),x=new I({name:"ChangeSymbol",label:this.nls.changeSymbol,data:x,iconClass:"icon-edit-symbol",iconFormat:"svg",map:this.map,onExecute:l.hitch(this,this._showSymbolChooser)}));return x},_showSymbolChooser:function(){if(this.layer){var x=this.layer.renderer,
L={};(x=x.defaultSymbol||x.symbol)?L.symbol=x:(x=y.getSymbolTypeByGeometryType(this.layer.geometryType),L.type=x);var q=new u(L),J=new r({width:380,autoHeight:!0,titleLabel:this.nls.changeSymbol,content:q,onClose:l.hitch(this,function(){q.destroy();J=q=null}),buttons:[{label:window.jimuNls.common.ok,onClick:l.hitch(this,function(){var v=q.getSymbol();v=new h(v);this.layer.setRenderer(v);this.layer.redraw();J.close()})},{label:window.jimuNls.common.cancel,onClick:l.hitch(this,function(){J.close()})}]})}}})})},
"widgets/Query/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Query/TaskSetting.html":'\x3cdiv tabindex\x3d"0" data-a11y-label-by\x3d"taskSettingName"\x3e\r\n  \x3ctable class\x3d"top"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"first-td"\x3e\r\n        \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.back}" class\x3d"back-arrow feature-action icon-arrow-back" data-dojo-attach-point\x3d"backArrow" data-dojo-attach-event\x3d"onclick:_onBtnParamsBackClicked,onkeydown:_onBtnParamsBackKeydown"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd class\x3d"second-td"\x3e\r\n        \x3cdiv class\x3d"task-name jimu-ellipsis" data-dojo-attach-point\x3d"taskNameDiv" data-a11y-label-id\x3d"taskSettingName"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd class\x3d"third-td"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n  \x3cdiv class\x3d"content-container"\x3e\r\n\r\n    \x3cdiv class\x3d"params-container" data-dojo-attach-point\x3d"paramsContainer"\x3e\r\n      \x3cdiv tabindex\x3d"0" class\x3d"not-visible" data-dojo-attach-point\x3d"noFilterTip"\x3e${nls.noAttributeSpatialFilterTip}\x3c/div\x3e\r\n      \x3cdiv class\x3d"attributes-section" data-dojo-attach-point\x3d"attributesSectionDiv" data-a11y-label-by\x3d"queryCriteira-label queryCriteira-sql"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"criteiraLabelDiv" class\x3d"first-stress attribute-filter-label" data-a11y-label-id\x3d"queryCriteira-label"\x3e${nls.queryCriteira}\x3c/div\x3e\r\n        \x3cdiv class\x3d"sql-div jimu-widget-note" data-dojo-attach-point\x3d"sqlDiv" data-a11y-label-id\x3d"queryCriteira-sql"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"spatial-section" data-dojo-attach-point\x3d"spatialSectionDiv" data-a11y-label-by\x3d"spatialFilter-label spatialFilter-tip"\x3e\r\n        \x3cdiv tabindex\x3d"0" class\x3d"spearator not-visible" data-dojo-attach-point\x3d"spatialSpearator"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"spatialFilterLabelDiv" class\x3d"first-stress spatial-filter-label" data-a11y-label-id\x3d"spatialFilter-label"\x3e${nls.spatialFilter}\x3c/div\x3e\r\n        \x3cdiv class\x3d"spatial-filter-tip" data-dojo-attach-point\x3d"spatialFilterTip" data-a11y-label-id\x3d"spatialFilter-tip"\x3e\x3c/div\x3e\r\n        \x3cselect data-dojo-type\x3d"jimu/dijit/formSelect" data-a11y-label-by\x3d"spatialFilter-label spatialFilter-tip" data-dojo-attach-point\x3d"spatialTypeSelect" data-dojo-attach-event\x3d"change:_onSpatialTypeSelectChanged" class\x3d"restrict-select-width" style\x3d"width:100%;box-sizing:border-box;"\x3e\x3c/select\x3e\r\n\r\n        \x3cdiv class\x3d"spatial-filter-content" data-dojo-attach-point\x3d"spatialFilterContent"\x3e\r\n          \x3cdiv class\x3d"drawing-section" data-dojo-attach-point\x3d"drawingSection"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"features-section" data-dojo-attach-point\x3d"featuresSection"\x3e\r\n            \x3cdiv class\x3d"relationship-section"\x3e\r\n              \x3cdiv class\x3d"second-stress relationship-tip" data-a11y-label-id\x3d"spatialRelationship"\x3e${nls.spatialRelationship}\x3c/div\x3e\r\n              \x3cselect data-dojo-attach-point\x3d"relationshipSelect" data-a11y-label-by\x3d"spatialRelationship" data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"restrict-select-width relationship-select" style\x3d"width:100%;box-sizing:border-box;"\x3e\x3c/select\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"layerNameContainer" class\x3d"result-name-container"\x3e\r\n      \x3cdiv class\x3d"first-stress" data-a11y-label-id\x3d"layerName" \x3e${nls.layerName}\x3c/div\x3e\r\n      \x3cdiv class\x3d"result-name-text" data-a11y-label-by\x3d"layerName" data-dojo-attach-point\x3d"layerNameTextBox" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-attach-event\x3d"change:_onLayerNameTextChanged"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"jimu-btn btn-execute" data-dojo-attach-point\x3d"btnExecute" data-dojo-attach-event\x3d"onclick:_onBtnApplyClicked,onkeydown:_onBtnApplyKeydown"\x3e${nls.apply}\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/SearchDistance.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"cbxDiv"\x3e\x3c/div\x3e\r\n\t\x3ctable style\x3d"table-layout:fixed;width:100%;"\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"15px"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"numberTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n\t\t\t\t\t data-dojo-props\x3d\'"required":true,intermediateChanges:false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n\t\t\t\t\t style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onNumberTextBoxChanged" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cselect data-dojo-type\x3d"jimu/dijit/formSelect" data-dojo-attach-point\x3d"unitSelect"\r\n\t\t\t\t\tdata-dojo-attach-event\x3d"change:_onUnitSelectChanged" style\x3d"width:100%;"\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"MILES" selected\x3e${nls.miles}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"KILOMETERS"\x3e${nls.kilometers}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"FEET"\x3e${nls.feet}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"METERS"\x3e${nls.meters}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"YARDS"\x3e${nls.yards}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"NAUTICAL_MILES"\x3e${nls.nauticalMiles}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/SpatialFilterByFeatures.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"layer-tip second-stress" data-dojo-attach-point\x3d"tipNode"\x3e${nls.relatedLayer}\x3c/div\x3e\r\n\t\x3ctable\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"100"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"layers-select-div" data-dojo-attach-point\x3d"layerSelectDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-float-trailing" data-dojo-attach-point\x3d"featureSetChooserDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\r\n\t\x3cdiv class\x3d"selection-option not-visible" data-dojo-attach-point\x3d"selectionOptionDiv"\x3e\x3c/div\x3e\r\n\r\n\t\x3cdiv class\x3d"search-distance-div" data-dojo-attach-point\x3d"searchDistanceDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"contentNode" class\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem" tabindex\x3d"-1" aria-selected\x3d"false"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation" style\x3d"display: none;"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"contentNode"\r\n\t\t\tclass\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem"\r\n\t\t\t\t   tabindex\x3d"-1" aria-selected\x3d"false" id\x3d"${id}_label"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\r\n\t\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation"\r\n\t\t style\x3d"display: none;" aria-labelledby\x3d"${id}_label"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/Tree.html":'\x3cdiv role\x3d"tree"\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitTreeIndent" style\x3d"position: absolute; top: -9999px" data-dojo-attach-point\x3d"indentDetector"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTreeExpando dijitTreeExpandoLoading" data-dojo-attach-point\x3d"rootLoadingIndicator"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeContainer" role\x3d"presentation"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/LayerChooserFromMapWithDropbox.html":'\x3cdiv\x3e\r\n\x3ctable role\x3d"listbox" aria-haspopup\x3d"true" data-dojo-attach-point\x3d"dropDownBtn" data-dojo-attach-event\x3d"onclick: _onDropDownClick,onkeydown: _onDropDownKeydown"\r\n  tabindex\x3d"0" title\x3d"${nls.customSelectLayer}" aria-label\x3d"${nls.customSelectLayer}"\x3e\r\n    \x3ccaption class\x3d"screen-readers-only-no-position"\x3e${nls.customSelectLayer}\x3c/caption\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"30px"\x3e\x3c/col\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" data-dojo-attach-point\x3d"layerNameNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"drop-select jimu-float-trailing" data-dojo-attach-point\x3d"dropArrowNode"\x3e\r\n            \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Query/SingleQueryResult.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"features-result" data-dojo-attach-point\x3d"featuresResultDiv"\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"popup-menu-button query-result-action-button" data-dojo-attach-point\x3d"btnFeatureAction" data-dojo-attach-event\x3d"click:_onBtnMenuClicked,keydown:_onBtnMenuKeydown"\x3e\x3c/div\x3e\r\n    \x3cdiv tabindex\x3d"0" class\x3d"results-number" data-dojo-attach-point\x3d"resultsNumberDiv"\x3e\r\n      \x3cdiv class\x3d"number-container"\x3e\r\n        \x3cdiv\x3e${nls.displayedFeatures}:\x3c/div\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"numSpan"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"action-container"\x3e\r\n        \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"loadMoreIcon" class\x3d"icon load-more-button query-hidden" title\x3d"${nls.loadMore}" data-dojo-attach-event\x3d"onclick:_onLoadMoreClicked,onkeydown:_onLoadMoreKeydown"\x3e\x3c/div\x3e\r\n        \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"expandedListIcon" class\x3d"icon expand-list" data-dojo-attach-event\x3d"onclick:_onExpandClicked,onkeydown:_onExpandKeydown"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"results-container" data-dojo-attach-point\x3d"resultsContainer" data-dojo-attach-event\x3d"onscroll:_onResultsScroll" onselectstart\x3d"return false;"\x3e\r\n      \x3ctable data-dojo-attach-point\x3d"resultsTable" valign\x3d"top" class\x3d"results-table" data-dojo-attach-event\x3d"onclick:_onResultsTableClicked,onkeydown:_onResultsTableKeydown" cellpadding\x3d"0" cellspacing\x3d"0" \x3e\r\n        \x3ctbody data-dojo-attach-point\x3d"resultsTbody"\x3e\x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"multiple-related-records-section not-visible" data-dojo-attach-point\x3d"multipleRelatedRecordsDiv"\x3e\r\n    \x3ctable class\x3d"related-records-header multiple-related-records-header"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.back}" class\x3d"back-arrow feature-action icon-arrow-back"  data-dojo-attach-point\x3d"multipleRelatedRecordsResultBackBtn" data-dojo-attach-event\x3d"onclick:_onBtnMultipleRelatedBackClicked,onkeydown:_onBtnMultipleRelatedBackKeydown"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"middle-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.relatedLayer}" data-dojo-attach-point\x3d"relatedLayersSelect" data-dojo-attach-event\x3d"change:_onRelatedLayersSelectChanged" style\x3d"width:100%;"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"last-td"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"single-related-records-section not-visible" data-dojo-attach-point\x3d"singleRelatedRecordsResultDiv"\x3e\r\n    \x3ctable role\x3d"title" tabindex\x3d"0" class\x3d"related-records-header single-related-records-header" data-dojo-attach-point\x3d"singleRelatedRecordsResultTitle" data-a11y-label-by\x3d"single-related-records-title"  data-dojo-attach-event\x3d"onkeydown:_onBtnSingleRelatedTitleKeydown"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.back}" class\x3d"back-arrow feature-action icon-arrow-back" data-dojo-attach-point\x3d"singleRelatedRecordsResultBackBtn" data-dojo-attach-event\x3d"onclick:_onBtnSingleRelatedBackClicked,onkeydown:_onBtnSingleRelatedBackKeydown"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"middle-td"\x3e\r\n            \x3cdiv class\x3d"related-records-title jimu-ellipsis" data-dojo-attach-point\x3d"relatedTitleDiv" data-a11y-label-id\x3d"single-related-records-title"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"last-td"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/RelatedRecordsResult.html":'\x3cdiv\x3e\r\n  \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"popup-menu-button related-records-action-button not-visible" data-dojo-attach-point\x3d"btnAction" data-dojo-attach-event\x3d"click:_onBtnMenuClicked,keydown:_onBtnMenuKeydown"\x3e\x3c/div\x3e\r\n  \x3cdiv tabindex\x3d"0" class\x3d"noresult-tip not-visible" data-dojo-attach-point\x3d"noResultTip" data-dojo-attach-event\x3d"keydown:_onNoResultTipKeydown"\x3e${nls.noResult}\x3c/div\x3e\r\n  \x3cdiv class\x3d"content not-visible" data-dojo-attach-point\x3d"content" data-dojo-attach-event\x3d"click:_onContentClicked,keydown:_onContentKeydown"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"jimu-widget-normal query-widget-content"\x3e\r\n    \x3cdiv class\x3d"query-tab-header" data-dojo-attach-point\x3d"tabHeader" data-dojo-attach-event\x3d"onclick:_onTabHeaderClicked,onkeydown:_onTabHeaderKeydown"\x3e\r\n      \x3cdiv role\x3d"tab" tabindex\x3d"0" aria-selected\x3d"true" class\x3d"query-tab-item jimu-ellipsis jimu-float-leading selected firstFocusNode" data-dojo-attach-point\x3d"taskQueryItem" title\x3d"${labelTasks}"\x3e${labelTasks}\x3c/div\x3e\r\n      \x3cdiv role\x3d"tab" tabindex\x3d"-1" aria-selected\x3d"false" class\x3d"query-tab-item jimu-ellipsis jimu-float-trailing" data-dojo-attach-point\x3d"resultQueryItem" title\x3d"${labelResults}"\x3e${labelResults}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"query-tabs-container"\x3e\r\n      \x3cdiv class\x3d"query-tab-view task-tab-view selected" data-dojo-attach-point\x3d"taskTabView"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"taskList" class\x3d"task-list"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"tasksNode" class\x3d"tasks"\x3e\r\n              \x3cdiv class\x3d"execute-tip not-visible"\x3e${nls.executeQueryTip}\x3c/div\x3e\r\n              \x3cdiv class\x3d"tasks-table-container"\x3e\r\n                \x3ctable data-dojo-attach-event\x3d"onclick:_onTaskListClicked,onkeydown:_onTaskListKeydown"\r\n                cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"list-table tasks-table" onselectstart\x3d"return false;"\x3e\r\n                  \x3ccolgroup\x3e\r\n                    \x3ccol width\x3d"40px"\x3e\x3c/col\x3e\r\n                    \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n                  \x3c/colgroup\x3e\r\n                  \x3ctbody data-dojo-attach-point\x3d"tasksTbody"\x3e\x3c/tbody\x3e\r\n                \x3c/table\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv tabindex\x3d"0" data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"no-query-tip"\x3e${nls.noTask}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"taskSettingContainer" class\x3d"task-setting-container"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"query-tab-view result-tab-view" data-dojo-attach-point\x3d"resultTabView"\x3e\r\n        \x3cdiv class\x3d"result-section" data-dojo-attach-point\x3d"resultSection"\x3e\r\n          \x3cdiv class\x3d"resultlayers-select-div" data-dojo-attach-point\x3d"resultLayersSelectDiv"\x3e\r\n            \x3cdiv data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.layerName}" data-dojo-attach-point\x3d"resultLayersSelect" class\x3d"restrict-select-width" style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onResultLayerSelectChanged"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"single-result-details" data-dojo-attach-point\x3d"singleResultDetails"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv tabindex\x3d"0" class\x3d"no-result-section" data-dojo-attach-point\x3d"noresultSection"\x3e${nls.noResult}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--virtual last focus node--\x3e\r\n  \x3cdiv tabindex\x3d"0" class\x3d"screen-readers-only lastFocusNode" data-dojo-attach-point\x3d"lastNode_framework"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/css/style.css":'.jimu-widget-query{position: relative; width: 99%; height: 100%; min-width: 222px; min-height: 237px; overflow-x: hidden;}.jimu-widget-query .list-table tr.single-task:first-child,.jimu-widget-query .query-task-setting,.jimu-widget-query .back-arrow,.jimu-widget-query .single-query-result .query-result-action-button,.jimu-widget-query .single-query-result .query-result-item.jimu-table-row,.jimu-widget-query table.related-records-header,.jimu-widget-query .related-records-result .related-records-action-button,.jimu-widget-query .related-records-result .noresult-tip,.jimu-widget-query .related-records-result .content .item,.jimu-widget-query .related-records-result .content .item-title,.jimu-widget-query .related-records-result .content .item.selected .item-content{outline-offset: -2px !important;}.jimu-widget-query .popup-menu-button {width: 28px; height: 28px;}.jimu-widget-query .query-hidden {visibility: hidden;}.jimu-widget-query .text-ellipsis{white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.jimu-widget-query .first-stress{font-family: "Avenir Light"; font-size: 14px; color: #000; margin-bottom: 5px; font-weight: bold;}.jimu-widget-query .second-stress{font-size: 12px; color: #353535; margin-bottom: 5px;}.jimu-widget-query .jimu-table-row{color: #000;}.jimu-widget-query .jimu-table-row.jimu-state-active{font-weight: normal; background-color: #eee;}.jimu-widget-query .query-result-item.jimu-table-row:first-child{border-top: 1px solid #cbcbcb;}.jimu-widget-query .not-visible{display: none !important;}.jimu-widget-query .jimu-checkbox .label{font-size: 12px; position: relative; top: 2px;}.jimu-widget-query .query-widget-content{position: absolute; width: 100%; left: 0; right: 0; height: auto; top: 0; bottom: 0;}.jimu-widget-query .query-tab-header{position: absolute; width: 100%; height: 30px; left: 0; right: 0; top: 0; font-size: 14px; border-bottom: 2px solid #ccc;}.jimu-widget-query .query-tab-item{width: calc(50% - 4px); height: 28px; line-height: 28px; cursor: pointer; text-align: center; padding: 0 5px; margin-top: 2px;}.jimu-widget-query .query-tab-item:first-child{margin-left: 2px;}.jimu-widget-query .query-tab-item:last-child{margin-right: 2px;}.jimu-rtl .jimu-widget-query .query-tab-item:first-child{margin-left: 0; margin-right: 2px;}.jimu-rtl .jimu-widget-query .query-tab-item:last-child{margin-right: 0; margin-left: 2px;}.jimu-widget-query .query-tab-item.selected{border-bottom: 2px solid #898989; font-weight: bold; color: #000;}.jimu-widget-query .query-tabs-container{position: absolute; width: 100%; left: 0; right: 0; top: 30px; bottom: 0;}.jimu-widget-query .query-tab-view{display: none; position: relative; width: 100%; height: 100%;}.jimu-widget-query .query-tab-view.selected{display: block;}.jimu-widget-query .list-table{width: 99%; border-collapse: collapse; table-layout: fixed; margin-left: auto; margin-right: auto;}.jimu-widget-query .list-table tr.single-task{border-top: 1px solid #D7D7D7; border-bottom: 1px solid #D7D7D7;}.jimu-widget-query .list-table tr.single-task:first-child{border-top: 0;}.jimu-widget-query .list-table tr.single-task:hover, .jimu-widget-query .list-table tr.single-task.selected{background-color: #eee;}.jimu-widget-query .list-table tr.single-task \x3e td{padding-top: 13px; padding-bottom: 13px; cursor: pointer; vertical-align: top;}.jimu-widget-query .list-table tr.single-task .list-item-name{width: 100%; overflow: hidden; text-overflow: ellipsis; display: inline-block; line-height: 16px;}.jimu-widget-query .list-table tr.single-task .first-td{text-align: center;}.jimu-widget-query .list-table tr.single-task .task-icon{width: 16px; height: 16px; vertical-align: middle;}.jimu-widget-query .task-list{position: absolute; top: 10px; bottom: 0; width: 100%;}.jimu-widget-query .task-list .tasks{position: absolute; width: 100%; height: 100%; left: 0; top: 0; overflow-y: auto;}.jimu-widget-query .task-list .tasks .execute-tip{margin-top: 10px; line-height: 20px;}.jimu-widget-query .task-list .tasks .tasks-table-container{width: 100%;}.jimu-widget-query .task-list .invalid-config{display: none; position: absolute; width: 100%; height: 100%; left: 0; top: 0;}.jimu-widget-query .task-list .no-query-tip{display: none; margin: 0 2px; line-height: 20px;}.jimu-widget-query .task-setting-container{height: 100%; display: none;}.jimu-widget-query .query-task-setting{position: relative; height: 100%;}.jimu-widget-query .query-task-setting table.top{width: 100%; table-layout: fixed; padding-top: 12px;}.jimu-widget-query .query-task-setting table.top .first-td{width: 30px;}.jimu-widget-query .query-task-setting table.top .second-td{width: auto;}.jimu-widget-query .query-task-setting table.top .third-td{width: 30px;}.jimu-widget-query.only-one-task .query-task-setting table.top .first-td,.jimu-widget-query.only-one-task .query-task-setting table.top .third-td{width: 0;}.jimu-widget-query.only-one-task .query-task-setting table.top .first-td,.jimu-widget-query.only-one-task .query-task-setting table.top .third-td{display: none; overflow: hidden;}.jimu-widget-query .back-arrow{display: inline-block; width: 16px; height: 16px;}.jimu-rtl .jimu-widget-query .back-arrow{-webkit-transform: rotate(180deg); -ms-transform: rotate(180deg); transform: rotate(180deg);}.jimu-widget-query .query-task-setting .task-name{text-align: center;}.jimu-widget-query .query-task-setting .content-container {position: absolute; width: 100%; top: 50px; overflow-x: hidden; overflow-y: auto; bottom: 50px; padding: 2px;}.jimu-widget-query .query-task-setting .content-container .result-name-container {margin-top: 12px;}.jimu-widget-query .query-task-setting .content-container .result-name-container .result-name-text {width: 100%;}.jimu-widget-query .query-task-setting .spatial-section .spearator{height: 1px; margin-bottom: 12px; border-top: 1px solid #D7D7D7; display: none;}.jimu-widget-query .query-task-setting .spatial-section .relationship-section{margin-top: 10px;}.jimu-widget-query .query-task-setting .spatial-section .jimu-dijit-spatial-filter-features{margin-top: 10px;}.jimu-widget-query .query-task-setting .attributes-section{margin-bottom: 12px;}.jimu-widget-query .query-task-setting .attributes-section .jimu-filter-parameters .jimu-single-filter-parameter .hint{color:#666666;}.jimu-widget-query .query-task-setting .attributes-section .jimu-filter-parameters .jimu-single-filter-parameter .prompt{color:#000000;}.jimu-widget-query .query-task-setting .attributes-section .attribute-filter-label{margin-bottom: 5px;}.jimu-widget-query .query-task-setting .btn-execute.jimu-btn{position: absolute; width: calc(100% - 4px); margin: 0 2px; bottom: 2px; text-align: center; background-color: #59A700; border-radius: 0;}.jimu-widget-query .query-task-setting .btn-execute.jimu-btn.disabled{background-color: #ccc !important; cursor: default;}.jimu-widget-query .query-task-setting .btn-execute:hover{background-color: #417505;}.jimu-widget-query .query-task-setting .btn-execute:active{background-color: #59A700;}.jimu-query-spatial-filter-drawing \x3e .jimu-checkbox {width: 100%;}.jimu-query-spatial-filter-drawing \x3e .jimu-checkbox \x3e div.label {white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 90%;}.jimu-query-spatial-filter-drawing .search-distance-div{margin-top: 15px;}.jimu-query-spatial-filter-drawing .jimu-draw-box .drawings-clear{margin-left: 18px;}.jimu-rtl .jimu-query-spatial-filter-drawing .jimu-draw-box .drawings-clear{margin-left: 0; margin-right: 18px;}.jimu-widget-query .result-list{padding-top: 10px;}.jimu-widget-query .result-tab-view .result-section{position: absolute; left: 0; right: 0; top: 0; bottom: 0;}.jimu-widget-query .result-tab-view .no-result-section{position: absolute; top: 10px; margin: 0 2px; line-height: 20px; width: calc(100% - 4px);}.jimu-widget-query .resultlayers-select-div{position: absolute; left: 2px; right: 37px; top: 15px; text-align: center; overflow: visible;}.jimu-rtl .jimu-widget-query .resultlayers-select-div{left: 37px; right: 2px;}.jimu-widget-query .single-result-details{position: absolute; width: 100%; left: 0; right: 0; top: 45px; bottom: 5px;}.jimu-widget-query .single-query-result,.jimu-widget-query .single-query-result .features-result{position: relative; width: 100%; height: 100%;}.jimu-widget-query .single-query-result .multiple-related-records-section,.jimu-widget-query .single-query-result .single-related-records-section{position: relative; width: 100%; height: calc(100% + 45px); top: -45px;}.jimu-widget-query .single-query-result .query-result-action-button{position: absolute; top: -28px; right: 0;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-action-button{right: auto; left: 0;}.jimu-widget-query .single-query-result .results-number{position: relative; top: 13px; margin: 0 2px; display: flex; align-items: center; justify-content: space-between;}.jimu-widget-query .single-query-result .results-number .number-container {display: flex; align-items: center; justify-content: flex-start;}.jimu-widget-query .single-query-result .results-number .action-container {display: flex; align-items: center; justify-content: space-between; width: 52px;}.jimu-widget-query .single-query-result .results-number .action-container .icon {width: 16px; height: 16px; cursor: pointer; background-position: center; background-repeat: no-repeat; background-size: contain; background-clip: content-box;}.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button {background-image: url(images/load-light-hover.svg); opacity: 0.5;}.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button.loading,.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button.loading:hover {background-image: url(images/loading-light.svg); -webkit-animation: load8 1.1s infinite linear; animation: load8 1.1s infinite linear;}.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button:hover {background-image: url(images/load-light-hover.svg); opacity:1;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list {background-image: url(images/fold-list-light-hover.svg); opacity: 0.5;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list:hover {background-image: url(images/fold-list-light-hover.svg); opacity: 1;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list.folded {background-image: url(images/expand-list-light-hover.svg); opacity:0.5;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list.folded:hover {background-image: url(images/expand-list-light-hover.svg); opacity:1;}.jimu-widget-query .single-query-result .results-container{position: absolute; width: 100%; left: 0; right: 0; top: 40px; bottom: 0; overflow-x: hidden; overflow-y: auto;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-title-container {display: flex; align-items: center; justify-content: space-between;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-title-container .popup-title {font-weight: bold;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-content {margin-top: 8px;}.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td .popup-content,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.folded .popup-content,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.folded .popup-content {display: none;}.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td .popup-content,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.expanded .popup-content,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.expanded .popup-content {display: block;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-title-icon {width: 24px; height: 16px;}.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.folded .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.folded .popup-title-icon {background: url(images/expand-item-light-hover.svg) center center no-repeat content-box; opacity: 0.5;}.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.folded .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.folded .popup-title-icon:hover {background: url(images/expand-item-light-hover.svg) center center no-repeat content-box; opacity: 1;}.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.expanded .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.expanded .popup-title-icon {background: url(images/fold-item-light-hover.svg) center center no-repeat content-box; opacity: 0.5; outline-offset: -1px !important;}.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.expanded .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.expanded .popup-title-icon:hover {background: url(images/fold-item-light-hover.svg) center center no-repeat content-box; opacity: 1;}.jimu-widget-query .single-query-result .results-table{table-layout: fixed; width: 100%; border-collapse: collapse;}.jimu-widget-query .single-query-result .query-result-item.jimu-table-row{border-left: 0 !important; border-right: 0 !important;}.jimu-widget-query .single-query-result .query-result-item \x3e td{padding-top: 8px; padding-bottom: 8px; cursor: pointer;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item \x3e td{padding-left: 0; padding-right: 15px;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .header{margin-bottom: 8px;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .hzLine{display: none;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .mainSection .break{display: none;}.jimu-widget-query .single-query-result .query-result-item-table{width: 100%; table-layout: fixed; border-collapse: collapse;}.jimu-widget-query .single-query-result .query-result-item-table .symbol-td{width: 36px;}.jimu-widget-query .single-query-result .query-result-item-table .popup-td{width: auto;}.jimu-widget-query .single-query-result .query-result-item .related-table-btn{height: 30px; line-height: 30px; margin: 5px 2px; padding: 0 5px; background: url(images/arrow_right1.png) right center no-repeat content-box; overflow: hidden; text-overflow: hidden; white-space: nowrap; font-family: "Avenir Medium"; color: #000;}.jimu-widget-query .single-query-result .query-result-item .related-table-btn:hover{font-weight: bold; background: url(images/arrow_right2.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item .related-table-btn{background: url(images/arrow_left1.png) left center no-repeat content-box;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item .related-table-btn:hover{background: url(images/arrow_left2.png) left center no-repeat content-box;}.jimu-widget-query table.related-records-header{margin-top: 5px; width: 100%; min-height: 36px; border-collapse: collapse; table-layout: fixed;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3etd{height: 36px;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3e.first-td{width: 30px;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3e.middle-td{width: auto;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3e.last-td{width: 40px;}.jimu-widget-query table.related-records-header .related-records-title{text-align: center;}.jimu-widget-query .related-records-result{position: absolute; left: 0; right: 0; top: 45px; bottom: 0; width: 100%; height: calc(100% - 45px);}.jimu-widget-query .related-records-result .related-records-action-button{position: absolute; right: 0; top: -40px; z-index: 1;}.jimu-rtl .jimu-widget-query .related-records-result .related-records-action-button{position: absolute; right: auto; left: 0; top: 0;}.jimu-widget-query .related-records-result .noresult-tip{line-height: 25px; padding: 0 2px;}.jimu-widget-query .related-records-result .content{position: absolute; left: 0; right: 0; top: 0; bottom: 0; overflow: auto;}.jimu-widget-query .related-records-result .content .item{border-top: 1px solid #E2E2E2;}.jimu-widget-query .related-records-result .content .item:last-child{border-bottom: 1px solid #E2E2E2;}.jimu-widget-query .related-records-result .content .item-title{position: relative; height: 36px; line-height: 36px; cursor: pointer; background: url(images/arrow_right1.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .related-records-result .content .item-title{background: url(images/arrow_left1.png) left center no-repeat content-box;}.jimu-widget-query .related-records-result .content .item.selected .item-title{background: url(images/arrow_down.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .related-records-result .content .item.selected .item-title{background: url(images/arrow_down.png) left center no-repeat content-box;}.jimu-widget-query .related-records-result .content .item-title .esriNumericValue{position: absolute; left: 4px; right: 18px; top: 0; bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-rtl .jimu-widget-query .related-records-result .content .item-title .esriNumericValue{left: 18px; right: 4px;}.jimu-widget-query .related-records-result .content .item-content{border-top: 1px solid #E2E2E2; display: none;}.jimu-widget-query .related-records-result .content .item.selected .item-content{display: block;}.jimu-widget-query .related-records-result .esriViewPopup .header{display: none;}.jimu-widget-query .related-records-result .esriViewPopup .hzLine{display: none;}.query-resultlayer-tooltipdialog-content{cursor: default;}.query-resultlayer-tooltipdialog-content .result-item{height: 20px; line-height: 20px; cursor: pointer;}.query-operations-tooltipdialog-content{cursor: default;}.query-operations-tooltipdialog-content .operation-item{height: 20px; line-height: 20px; cursor: pointer;}',
"*now":function(B){B(['dojo/i18n!*preload*widgets/Query/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/on dojo/keys dojo/query dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/promise/all dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/utils jimu/BaseWidget jimu/MapManager jimu/filterUtils jimu/dijit/Message jimu/symbolUtils esri/lang esri/request esri/symbols/jsonUtils esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/renderers/SimpleRenderer ./TaskSetting ./SingleQueryLoader ./SingleQueryResult ./utils jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator jimu/dijit/formSelect".split(" "),function(B,
C,Q,H,l,m,w,t,M,k,c,a,e,h,y,K,I,r,D,u,F,x,L,q,J,v,z){return M([a,k],{name:"Query",baseClass:"jimu-widget-query",currentTaskSetting:null,hiddenClass:"not-visible",_resultLayerInfos:null,mapManager:null,layerInfosObj:null,labelTasks:"",labelResults:"",_focusNodes:{},miniCycleHandlers:{},postMixInProperties:function(){this.inherited(arguments);this.layerInfosObj=z.getInstanceSync();this.mapManager=e.getInstance();this._resultLayerInfos=[];var b=I.substitute({clearResults:this.nls.clearResults},this.nls.operationalTip);
this.nls.operationalTip=b;this.nls.layerName=window.apiNls.widgets.directions.layerName;this.labelTasks=this.nls.tasks;this.labelResults=this.nls.queryResults;this._setUrlForConfig();this._showFilterLabel=!0;this.config&&(this.config=v.getConfigWithValidDataSource(this.config),this._updateConfig(),this.config.labelTasks&&(this.labelTasks=this.config.labelTasks),this.config.labelResults&&(this.labelResults=this.config.labelResults),this._showFilterLabel=this.config.showFilterLabel)},_updateConfig:function(){this.config&&
this.config.queries&&0<this.config.queries.length&&w.forEach(this.config.queries,l.hitch(this,function(b){this._rebuildFilter(b.url,b.filter)}));this.config&&("undefined"===typeof this.config.showFilterLabel&&(this.config.showFilterLabel=!0),"undefined"===typeof this.config.criteiraLabel&&(this.config.criteiraLabel=this.nls.queryCriteira),"undefined"===typeof this.config.spatialFilterLabel&&(this.config.spatialFilterLabel=this.nls.spatialFilter))},_setUrlForConfig:function(){this.config&&this.config.queries&&
0<this.config.queries.length&&w.forEach(this.config.queries,l.hitch(this,function(b){if(b.webMapLayerId){var n=this.layerInfosObj.getLayerOrTableInfoById(b.webMapLayerId);n&&(b.url=n.getUrl())}}))},_rebuildFilter:function(b,n){try{if(n){delete n.expr;var p=new h;p.isHosted=c.isHostedService(b);p.getExprByFilterObj(n)}}catch(O){console.log(O)}},postCreate:function(){this.inherited(arguments);this._initSelf();this._updateResultDetailUI();var b=Q(".single-task",this.tasksTbody);1===b.length?(m.addClass(this.domNode,
"only-one-task"),this._showTaskSettingPane(!0),this._onClickTaskTr(b[0])):(this._updateFocusNodes("taskList"),this.own(B(this.taskTabView,"keydown",l.hitch(this,function(n){n.keyCode===C.ESCAPE&&(n.stopPropagation(),this.taskQueryItem.focus())}))));this.own(B(this.resultTabView,"keydown",l.hitch(this,function(n){n.keyCode===C.ESCAPE&&(n.stopPropagation(),this.resultQueryItem.focus())})));this.own(B(this.lastNode_framework,"focus",l.hitch(this,function(){("true"===m.getAttr(this.taskQueryItem,"aria-selected")?
this.taskQueryItem:this.resultQueryItem).focus()})))},_focusCurrentFirstNode:function(b){b||(b="true"===m.getAttr(this.taskQueryItem,"aria-selected")?"none"!==m.getStyle(this.taskList,"display")?this._focusNodes.taskList.first:this._focusNodes.taskSetting?this._focusNodes.taskSetting.first:null:this._focusNodes.result?this._focusNodes.result.first:null);b&&b.focus()},_updateFocusNodes:function(b){if("taskList"===b){var n=Q(".single-task",this.tasksTbody);if(0===n.length)var p=n=this.noQueryTipSection;
else p=n[0],n=n[n.length-1];this._focusNodes.taskList={first:p,last:n}}else if("taskSetting"===b)p=this.currentTaskSetting.domNode,n=this.currentTaskSetting.btnExecute,this._focusNodes.taskSetting={first:p,last:n};else if("result"===b){if(0===this._resultLayerInfos.length)n=p=this.noresultSection;else{p=Q("."+this.singleQueryResult._lastFeatureClass,this.singleQueryResult.resultsTbody);if(p[0]){p=p[p.length-1];n=Q("."+this.singleQueryResult._lastRelatedClass,p)[0];var O=Q(".popup-content",p)[0];O=
"block"===m.getStyle(O,"display");n=n&&O?n:Q("."+this.singleQueryResult._lastFeatureArrowClass,p)[0]}else n=this.singleQueryResult.expandedListIcon;p=this.resultLayersSelect.domNode}this._focusNodes.result={first:p,last:n}}this._initMiniCycle(b,p,n)},_initMiniCycle:function(b,n,p){this.miniCycleHandlers[b]?(this.miniCycleHandlers[b].first.remove(),this.miniCycleHandlers[b].last.remove()):this.miniCycleHandlers[b]={};this.miniCycleHandlers[b].first=B(n,"keydown",l.hitch(this,function(O){O.keyCode===
C.TAB&&O.shiftKey&&O.target===n&&(O.preventDefault(),p.focus())}));this.miniCycleHandlers[b].last=B(p,"keydown",l.hitch(this,function(O){O.keyCode!==C.TAB||O.shiftKey||(O.preventDefault(),n.focus())}))},_onFeaturesLayoutUpdate:function(){this._updateFocusNodes("result")},onOpen:function(){var b=this._getCurrentResultLayerInfo();(b=b&&b.singleQueryResult)&&b.showLayer();this._showTempLayers();this.inherited(arguments)},onActive:function(){this._showTempLayers()},onDeActive:function(){this.currentTaskSetting&&
this.currentTaskSetting.deactivate();this.mapManager.enableWebMapPopup();this._hideTempLayers()},onClose:function(){this.config.hideLayersAfterWidgetClosed&&this._hideAllLayers();this._hideInfoWindow();this._hideTempLayers();this.inherited(arguments)},destroy:function(){this._hideInfoWindow();this._removeResultLayerInfos(this._resultLayerInfos);this.inherited(arguments)},_hideTempLayers:function(){this.currentTaskSetting&&this.currentTaskSetting.hideTempLayers()},_showTempLayers:function(){this.currentTaskSetting&&
this.currentTaskSetting.showTempLayers()},_initSelf:function(){var b=this.config.queries;0===b.length?(m.setStyle(this.tasksNode,"display","none"),m.setStyle(this.noQueryTipSection,"display","block")):w.forEach(b,l.hitch(this,function(n,p){v.dynamicUpdateConfigIcon(n,this.folderUrl+"css/images/default_task_icon.png");var O=n.name,T=m.toDom('\x3ctr role\x3d"button" tabindex\x3d"0" class\x3d"single-task"\x3e\x3ctd class\x3d"first-td"\x3e\x3cspan class\x3d"task-icon"\x3e\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d"second-td"\x3e\x3cdiv class\x3d"list-item-name task-name-div"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e');
Q(".task-name-div",T)[0].innerHTML=O;m.place(T,this.tasksTbody);O=Q("span.task-icon",T)[0];var f=n.icon;if(f){var A=null;f.url||f.imageData?(f.setWidth(16),f.setHeight(16)):(A={width:17,height:17},f.setSize(16));f=K.createSymbolNode(f,A);m.place(f,O)}T.taskIndex=p;T.singleConfig=n;0===p%2?m.addClass(T,"even"):m.addClass(T,"odd")}))},_onTabHeaderClicked:function(b){b=b.target||b.srcElement;b===this.taskQueryItem?((b=this._getCurrentResultLayerInfo())&&(b=b.singleQueryResult)&&(b.singleRelatedRecordsResult||
b.multipleRelatedRecordsResult)&&b._showFeaturesResultDiv(),this._switchToTaskTab()):b===this.resultQueryItem&&this._switchToResultTab()},_onTabHeaderKeydown:function(b){var n=b.target||b.srcElement;b.keyCode===C.ENTER?this._onTabHeaderClicked(b):b.keyCode===C.LEFT_ARROW||b.keyCode===C.RIGHT_ARROW?(n===this.taskQueryItem?this.resultQueryItem:this.taskQueryItem).focus():b.keyCode===C.TAB&&(b.shiftKey?b.preventDefault():n===this.taskQueryItem&&"-1"===m.getAttr(this.taskQueryItem,"tabindex")&&(b.preventDefault(),
this._focusCurrentFirstNode()))},_switchToTaskTab:function(){m.removeClass(this.resultQueryItem,"selected");m.removeClass(this.resultTabView,"selected");m.addClass(this.taskQueryItem,"selected");m.addClass(this.taskTabView,"selected");m.setAttr(this.resultQueryItem,"tabindex","-1");m.setAttr(this.resultQueryItem,"aria-selected","false");m.setAttr(this.taskQueryItem,"tabindex","0");m.setAttr(this.taskQueryItem,"aria-selected","true");c.initFirstFocusNode(this.domNode,this.taskQueryItem)},_switchToResultTab:function(){this._updateResultDetailUI();
m.removeClass(this.taskQueryItem,"selected");m.removeClass(this.taskTabView,"selected");m.addClass(this.resultQueryItem,"selected");m.addClass(this.resultTabView,"selected");m.setAttr(this.taskQueryItem,"tabindex","-1");m.setAttr(this.taskQueryItem,"aria-selected","false");m.setAttr(this.resultQueryItem,"tabindex","0");m.setAttr(this.resultQueryItem,"aria-selected","true");this._updateFocusNodes("result");c.initFirstFocusNode(this.domNode,this.resultQueryItem)},_updateResultDetailUI:function(){0<
this._resultLayerInfos.length?(m.removeClass(this.resultSection,this.hiddenClass),m.addClass(this.noresultSection,this.hiddenClass)):(m.addClass(this.resultSection,this.hiddenClass),m.removeClass(this.noresultSection,this.hiddenClass),this.noresultSection.focus())},_showTaskListPane:function(){m.setStyle(this.taskList,"display","block");m.setStyle(this.taskSettingContainer,"display","none");this._switchToTaskTab()},_showTaskSettingPane:function(){m.setStyle(this.taskList,"display","none");m.setStyle(this.taskSettingContainer,
"display","block");this._switchToTaskTab()},_onTaskListClicked:function(b){(b=c.getAncestorDom(b.target||b.srcElement,l.hitch(this,function(n){return m.hasClass(n,"single-task")}),10))&&this._onClickTaskTr(b)},_onTaskListKeydown:function(b){b.keyCode!==C.ENTER&&b.keyCode!==C.SPACE||this._onClickTaskTr(b.target||b.srcElement)},_onClickTaskTr:function(b){this._getLayerInfoAndRelationshipLayerInfos(b).then(l.hitch(this,function(n){var p=n.layerInfo,O=n.layerObject,T=n.relationshipLayerInfos;n=n.relationshipPopupTemplates;
b.singleConfig.objectIdField=c.getObjectIdField(p);var f=this._getPopupInfo(p,b.singleConfig);f||console.error("can't get popupInfo");f.fieldInfos=v.getPortalFieldInfosWithoutShape(p,f.fieldInfos);delete f.readFromWebMap;var A=q.getCleanCurrentAttrsTemplate();A.queryTr=b;A.config=l.clone(b.singleConfig);A.config.popupInfo=f;A.layerInfo=p;A.layerObject=O;A.relationshipLayerInfos=T;A.relationshipPopupTemplates=n;A.query.maxRecordCount=p.maxRecordCount||1E3;A.queryType=v.getQueryType(p);this.currentTaskSetting&&
this.currentTaskSetting.destroy();this.currentTaskSetting=null;this._showTaskSettingPane();this.currentTaskSetting=new L({wId:this.id,nls:this.nls,map:this.map,showFilterLabel:this._showFilterLabel,criteiraLabel:this.config.criteiraLabel,spatialFilterLabel:this.config.spatialFilterLabel,currentAttrs:A,layerInfosObj:this.layerInfosObj,onBack:l.hitch(this,function(){this._showTaskListPane();this._focusCurrentFirstNode()}),onApply:l.hitch(this,function(E){this._onBtnApplyClicked(E)})});this.currentTaskSetting.canAutoRunning()&&
(this._switchToResultTab(),this.currentTaskSetting.run());this.currentTaskSetting.placeAt(this.taskSettingContainer);this._updateFocusNodes("taskSetting");this._focusCurrentFirstNode();this.own(B(this.currentTaskSetting.domNode,"keydown",l.hitch(this,function(E){E.keyCode===C.ESCAPE&&(E.stopPropagation(),m.hasClass(this.domNode,"only-one-task")||E.target===this.currentTaskSetting.backArrow?this.taskQueryItem.focus():this.currentTaskSetting.backArrow.focus())})))}),l.hitch(this,function(n){console.error("can't get layerInfo",
n)}))},_getLayerInfoAndServiceInfo:function(b){var n=new H,p=this._getLayerInfo(b),O=this._getServiceInfo(b);this.shelter.show();t([p,O]).then(l.hitch(this,function(T){this.domNode&&(this.shelter.hide(),b.layerInfo=T[0],b.serviceInfo=T[1],n.resolve({layerInfo:b.layerInfo,serviceInfo:b.serviceInfo}))}),l.hitch(this,function(T){console.error(T);if(this.domNode){this.shelter.hide();var f="";T&&403===T.httpCode&&(f=this.nls.noPermissionsMsg);this._showQueryErrorMsg(f);n.reject()}}));return n},_getLayerInfoAndRelationshipLayerInfos:function(b){var n=
new H;this.shelter.show();var p=this._getLayerInfo(b),O=v.tryGetLayerObject(b.singleConfig.webMapLayerId);t([p,O]).then(l.hitch(this,function(T){var f=T[0],A=T[1];b.layerInfo=f;b.layerObject=A;this._getRelationshipLayerInfos(b).then(l.hitch(this,function(E){if(this.domNode){b.relationshipLayerInfos=E;var N={},S=this.map.itemInfo.itemData,U=b.singleConfig.url.replace(/\d*\/*$/g,""),d;for(d in E){var g=v.getPopupInfoForRelatedLayer(S,U+d,E[d]);N[d]=new F(g)}this.shelter.hide();n.resolve({layerInfo:f,
layerObject:A,relationshipLayerInfos:E,relationshipPopupTemplates:N})}}),l.hitch(this,function(E){this.domNode&&(this.shelter.hide(),n.reject(E))}))}),l.hitch(this,function(T){this.domNode&&(this.shelter.hide(),n.reject(T))}));return n},_getLayerInfo:function(b){var n=new H;b.layerInfo?n.resolve(b.layerInfo):r({url:b.singleConfig.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(l.hitch(this,function(p){b.layerInfo=p;n.resolve(p)}),l.hitch(this,function(p){n.reject(p)}));
return n},_getServiceInfo:function(b){var n=new H;if(b.serviceInfo)n.resolve(b.serviceInfo);else{var p=this._getServiceUrlByLayerUrl(b.singleConfig.url);r({url:p,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(l.hitch(this,function(O){b.serviceInfo=O;n.resolve(O)}),l.hitch(this,function(O){n.reject(O)}))}return n},_getRelationshipLayerInfos:function(b){var n=new H;if(b.relationshipLayerInfos)n.resolve(b.relationshipLayerInfos);else{var p=b.layerInfo.relationships;if(p&&0<p.length){var O=
this._getServiceUrlByLayerUrl(b.singleConfig.url),T=w.map(p,l.hitch(this,function(f){return r({url:O+"/"+f.relatedTableId,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})}));t(T).then(l.hitch(this,function(f){b.relationshipLayerInfos={};w.forEach(p,l.hitch(this,function(A,E){b.relationshipLayerInfos[A.relatedTableId]=f[E]}));n.resolve(b.relationshipLayerInfos)}),l.hitch(this,function(f){b.relationshipLayerInfos=null;n.reject(f)}))}else b.relationshipLayerInfos={},n.resolve(b.relationshipLayerInfos)}return n},
_getServiceUrlByLayerUrl:function(b){var n=b.lastIndexOf("/");return b.slice(0,n)},_getPopupInfo:function(b,n){var p=null,O=v.getDefaultPopupInfo(b,!1,!1);p=O;p=null;n.popupInfo?n.popupInfo.readFromWebMap?n.webMapLayerId?(p=null,p=(p=v.isTable(b)?this.layerInfosObj.getTableInfoById(n.webMapLayerId):this.layerInfosObj.getLayerInfoById(n.webMapLayerId))?(p=p.getPopupInfo())?l.clone(p):O:O):p=O:(p=l.clone(n.popupInfo),delete p.readFromWebMap):p=n.popup?v.upgradePopupToPopupInfo(b,n.popup):O;p||(p=O);
p.showAttachments=!!b.hasAttachments;v.removePopupInfoUnsupportFields(b,p);return p},_onBtnApplyClicked:function(b){this.mapManager.enableWebMapPopup();m.addClass(this.resultTabView,this.hiddenClass);if(b.config.singleResultLayer){var n=this._getResultLayerInfosByTaskIndex(b.queryTr.taskIndex);0<n.length&&this._removeResultLayerInfos(n)}var p=this.currentTaskSetting.getQueryResultName();p=c.sanitizeHTML(p);this._createNewResultLayer(b,p);this.shelter.show();var O=new J({map:this.map,nls:this.nls,
label:p,currentAttrs:b,queryWidget:this,onBack:l.hitch(this,function(){this._switchToResultTab()})});this.own(B(O,"show-related-records",l.hitch(this,this._onShowRelatedRecords)));this.own(B(O,"hide-related-records",l.hitch(this,this._onHideRelatedRecords)));this.own(B(O,"features-update",l.hitch(this,this._onFeaturesUpdate)));this.own(B(O,"features-layout-update",l.hitch(this,this._onFeaturesLayoutUpdate)));O.executeQueryForFirstTime().then(l.hitch(this,function(){this.domNode&&(this.shelter.hide(),
m.removeClass(this.resultTabView,this.hiddenClass),this._onSingleQueryFinished(O,p),this._updateResultDetailUI(),this.singleQueryResult=O,this._updateFocusNodes("result"),this._focusCurrentFirstNode())}),l.hitch(this,function(T){console.error(T);this.domNode&&(this.shelter.hide(),m.removeClass(this.resultTabView,this.hiddenClass))}))},_createNewResultLayer:function(b,n){var p=null,O=null;O=b.queryTr.taskIndex;p=l.clone(b.layerInfo);p.name=n;p.drawingInfo||(p.drawingInfo={});p.drawingInfo.transparency=
0;p.minScale=0;p.maxScale=0;p.effectiveMinScale=0;p.effectiveMaxScale=0;p.defaultVisibility=!0;delete p.extent;var T=(new q(this.map,b)).getOutputFields();p.fields=w.filter(p.fields,l.hitch(this,function(f){return 0<=T.indexOf(f.name)}));p=new u({layerDefinition:p,featureSet:null});p._queryWidgetTaskIndex=O;n=l.clone(b.config.popupInfo);O=new F(n);n.showAttachments&&v.overridePopupTemplateMethodGetAttachments(O,b.config.url,b.config.objectIdField);p.setInfoTemplate(O);b.query.resultLayer=p;v.isTable(b.layerInfo)||
b.config.useLayerSymbol||!b.config.resultsSymbol||(b=D.fromJson(b.config.resultsSymbol),O=new x(b),p.setRenderer(O));return p},_onSingleQueryFinished:function(b,n){this.currentTaskSetting.onGetQueryResponse();b.placeAt(this.singleResultDetails);this._hideAllSingleQueryResultDijits();this._switchToResultTab();m.setStyle(b.domNode,"display","block");var p=b.getCurrentAttrs().queryTr.taskIndex;b={value:c.getRandomString(),label:n,taskIndex:p,singleQueryResult:b};this._resultLayerInfos.push(b);this.resultLayersSelect.addOption({value:b.value,
label:b.label});this.resultLayersSelect.set("value",b.value);this._showResultLayerInfo(b);this._updateResultDetailUI()},_onResultLayerSelectChanged:function(){var b=this._getCurrentResultLayerInfo();b&&this._showResultLayerInfo(b)},_getCurrentResultLayerInfo:function(){var b=null,n=this.resultLayersSelect.get("value");n&&(b=this._getResultLayerInfoByValue(n));return b},_hideAllLayers:function(b){var n=this._getAllSingleQueryResultDijits();w.forEach(n,l.hitch(this,function(p){p&&p!==b&&p.hideLayer()}))},
_removeResultLayerInfosByTaskIndex:function(b){b=this._getResultLayerInfosByTaskIndex(b);this._removeResultLayerInfos(b)},_getResultLayerInfoByValue:function(b){var n=null;w.some(this._resultLayerInfos,l.hitch(this,function(p){return p.value===b?(n=p,!0):!1}));return n},_getResultLayerInfosByTaskIndex:function(b){var n=this._resultLayerInfos;return n=w.filter(n,l.hitch(this,function(p){return p.taskIndex===b}))},_removeResultLayerInfoByValues:function(b){var n=[];w.forEach(this._resultLayerInfos,
l.hitch(this,function(O,T){0<=b.indexOf(O.value)&&(n.push(T),O.singleQueryResult&&O.singleQueryResult.domNode&&O.singleQueryResult.destroy(),O.singleQueryResult=null)}));n.reverse();w.forEach(n,l.hitch(this,function(O){this._resultLayerInfos.splice(O,1)}));this.resultLayersSelect.removeOption(b);var p=this.resultLayersSelect.getOptions();p&&0<p.length?this.resultLayersSelect.set("value",p[0].value):"function"===typeof this.resultLayersSelect._setDisplay&&this.resultLayersSelect._setDisplay("");this._updateResultDetailUI()},
_removeResultLayerInfos:function(b){b=w.map(b,l.hitch(this,function(n){return n.value}));return this._removeResultLayerInfoByValues(b)},_getAllSingleQueryResultDijits:function(){var b=[];this._resultLayerInfos&&0<this._resultLayerInfos.length&&w.forEach(this._resultLayerInfos,l.hitch(this,function(n){n&&n.singleQueryResult&&b.push(n.singleQueryResult)}));return b},_hideAllSingleQueryResultDijits:function(){var b=this._getAllSingleQueryResultDijits();w.forEach(b,l.hitch(this,function(n){m.setStyle(n.domNode,
"display","none")}))},_showResultLayerInfo:function(b){this._hideAllSingleQueryResultDijits();b=b.singleQueryResult;this._hideAllLayers(b);b&&(m.setStyle(b.domNode,"display","block"),b.showLayer(),b.zoomToLayer())},removeSingleQueryResult:function(b){var n=null;w.some(this._resultLayerInfos,l.hitch(this,function(p){return p.singleQueryResult===b?(n=p.value,!0):!1}));null!==n&&this._removeResultLayerInfoByValues([n])},_onShowRelatedRecords:function(){m.addClass(this.resultLayersSelectDiv,this.hiddenClass)},
_onHideRelatedRecords:function(){m.removeClass(this.resultLayersSelectDiv,this.hiddenClass)},_onFeaturesUpdate:function(b){var n=b.taskIndex;b=b.features;try{this.updateDataSourceData(n,{features:b})}catch(p){console.error(p)}},_isImageServiceLayer:function(b){return-1<b.indexOf("/ImageServer")},_showQueryErrorMsg:function(b){new y({message:b||this.nls.queryError})},_hideInfoWindow:function(){this.map&&this.map.infoWindow&&(this.map.infoWindow.hide(),"function"===typeof this.map.infoWindow.setFeatures&&
this.map.infoWindow.setFeatures([]))}})});