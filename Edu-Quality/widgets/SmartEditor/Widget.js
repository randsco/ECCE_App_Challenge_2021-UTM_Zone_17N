// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G,y,J,M,ba,W,E){var O=N([ba,m,l],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:E,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(H,P){H=H||{};H.items||H.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=t.version.minor;this._itemWidgets={};H.featureLayers&&H.featureLayers.length&&(this._flChanged=1);this._nls=W.widgets.templatePicker;this.emptyMessage=H.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var H=
b.getContentBox(this.domNode);H.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!H.h||1>=H.h)this.domNode.style.height=this._initialAutoHeight+"px";H=b.getContentBox(this.domNode);this._columns=Math.floor(H.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();F.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>c("ie")&&(this._repaintItems=A.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var H=this._selectedCell,P=this._selectedInfo;H&&this._rowClicked({cellNode:H,rowIndex:P.selRow,cellIndex:P.selCol})},update:function(H){H=
"auto"===this.rows&&"auto"===this.columns&&H?!0:!1;var P=this.grid;if(H){var S=this.domNode;var V=t.query("#"+S.id+".templatePicker div.item")[0];S=b.getContentBox(S);V=(V=V&&V.parentNode)?D.coords(V).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((S.w-P.views.views[0].getScrollbarWidth())/V))||1}V=this._rows;this._preprocess();var Z=this._rows;this._setGridLayout();this._setGridData();Z!==V&&P.set("autoHeight",this._rows,!1);H?(P._resize({w:S.w,h:S.h}),P.viewsHeaderNode.style.display=
"none"):P.update();this._toggleTooltip();var da=this,L=this.getSelected();L&&P.store.fetch({onComplete:function(R){var aa=(R=da._locate(L,da._selectedInfo,R))&&P.views.views[0].getCellNode(R[0],R[1]);aa&&da._rowClicked({cellNode:aa,rowIndex:R[0],cellIndex:R[1]},!0)}});9>c("ie")&&setTimeout(this._repaintItems,this._ieTimer);H=this.featureLayers;S=this.items;H&&H.length||S&&S.length||!P||!this.emptyMessage||P.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(H){var P=this.useLegend;this._started&&P===H||(H?this._flChanged=1:this._clearLegendInfo());this.useLegend=H},_setFeatureLayersAttr:function(H){var P=this.featureLayers;this._started&&P===H||(this._flChanged=1);this.featureLayers=H},_adjustRowsCols:function(H){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var P=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(P=H.length,g.forEach(H,function(S){P+=Math.ceil(S.length/this.columns)},this)):(g.forEach(H,function(S){P+=S.length},this),P=Math.ceil(P/this.columns)):P=Math.ceil(H.length/this.columns),this._rows=P):"auto"===this.columns&&(this.featureLayers?this.grouping?P=3:(g.forEach(H,function(S){P+=S.length},this),P=Math.ceil(P/this.rows)):P=Math.ceil(H.length/this.rows),this._columns=P)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),g.every(this.featureLayers,function(S){return S.loaded})){this.featureLayers=g.filter(this.featureLayers,function(S){return!(S.hasZ&&!S.enableZDefaults)});var H=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(H)}else{var P=this.featureLayers.length;g.forEach(this.featureLayers,function(S){if(S.loaded)P--;else var V=F.connect(S,"onLoad",this,function(){F.disconnect(V);V=null;P--;P||this.update()})},this)}else H=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(H)},_processSelectionLayers:function(){var H,P,S,V,Z,da,L,R={};g.forEach(this.featureLayers,function(aa,ia){aa.mode===u.MODE_SELECTION&&aa._map&&aa.url&&aa._params.drawMode&&!aa.source&&(P=A.trim(aa._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),S=R[P]=R[P]||{},V=S.featureLayers=S.featureLayers||{},da=S.indices=S.indices||[],V[ia]=aa,da.push(ia),H=aa._map)});H&&g.forEach(H.layerIds,function(aa){(aa=H.getLayer(aa))&&aa.url&&(aa.getImageUrl||aa.getTileUrl)&&aa.loaded&&10.1<=aa.version&&(P=A.trim(aa._url.path).replace(/(\/MapServer).*/ig,"$1"),Z=P.replace(/^https?:\/\//ig,"").toLowerCase(),R[Z]&&!R[Z].mapServiceUrl&&(S=R[Z],S.mapServiceUrl=P,S.mapServiceLayer=aa,this._legendIndices=this._legendIndices.concat(S.indices),
L=this._fetchLegend({pickerInstance:this,info:S},Z),L.then?(this._loadingIndices=this._loadingIndices.concat(S.indices),this._loadingLegends.push(L)):this._processLegendResponse(L,S)))},this)},_fetchLegend:function(H,P){var S=O.prototype,V=S.legendCache[P];V?V.then&&V._contexts.push(H):(V=S.legendCache[P]=M({url:H.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),V._contexts=[H],V.addBoth(function(Z){if(!V.canceled){S.legendCache[P]=Z;var da=V._contexts;V._contexts=null;
g.forEach(da,function(L){var R=L.pickerInstance;L=L.info;if(!R._destroyed){g.forEach(L.indices,function(ia){aa=g.indexOf(R._loadingIndices,ia);-1<aa&&R._loadingIndices.splice(aa,1)});var aa=g.indexOf(R._loadingLegends,V);-1<aa&&R._loadingLegends.splice(aa,1);R._processLegendResponse(Z,L)}})}}));return V},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
g.forEach(this._loadingLegends,function(H){var P=-1;g.some(H._contexts,function(S,V){S.pickerInstance===this&&(P=V);return-1<P},this);-1<P&&H._contexts.splice(P,1)},this)},_processLegendResponse:function(H,P){if(!H||H instanceof Error){var S;g.forEach(P.indices,function(Z){S=g.indexOf(this._legendIndices,Z);-1<S&&this._legendIndices.splice(S,1)},this)}else g.forEach(P.indices,function(Z){var da=P.featureLayers[Z].layerId,L,R=P.mapServiceUrl+"/"+da+"/images/",aa=P.mapServiceLayer._getToken(),ia,Q;
if(!this._legendSymbols[Z]){var T=null;g.some(H.layers,function(ea){ea.layerId==da&&(T=ea);return!!T});if(T){var Y=this._legendSymbols[Z]={};g.forEach(T.legend,function(ea){if((ia=ea.values)&&ia.length)for(L=0;L<ia.length;L++)Y[ia[L]]=ea;else Y.defaultSymbol=ea;(Q=ea.url)&&!ea._fixed&&(ea._fixed=1,-1===Q.search(/https?:/)&&(ea.url=R+Q),aa&&-1!==ea.url.search(/https?:/)&&(ea.url+=(-1<ea.url.indexOf("?")?"\x26":"?")+"token\x3d"+aa))})}}},this);var V=this;V._started&&!V._legendTimer&&(V._legendTimer=
setTimeout(function(){clearTimeout(V._legendTimer);V._legendTimer=null;V._destroyed||V.update()},0))},_applyGridPatches:function(){var H=this.grid,P=H.adaptWidth,S,V,Z;H.adaptWidth=function(){S=this.views.views;for(V=0;Z=S[V];V++)a.set(Z.headerNode,"display","block");P.apply(this,arguments);for(V=0;Z=S[V];V++)a.set(Z.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var da=F.connect(H,"_onFetchComplete",this,function(){F.disconnect(da);this.grid.set("autoHeight",
this._rows)});F.connect(H,"_onDelete",this,this._destroyItems);F.connect(H,"_clearData",this,this._destroyItems);F.connect(H,"destroy",this,this._destroyItems);(H=H.focus)&&H.findAndFocusGridCell&&(H.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var H=function(da){return function(L,R){return this._cellGet(da,L,R)}},P=A.hitch(this,this._cellFormatter),S=[],V=this._columns,Z;for(Z=0;Z<V;Z++)S.push({field:"cell"+Z,get:A.hitch(this,H(Z)),formatter:P});H={cells:[S]};this.grouping&&
(V={field:"groupName",colSpan:V,get:A.hitch(this,this._cellGetGroup),formatter:A.hitch(this,this._cellGroupFormatter)},H.cells.push([V]));V=this.grid;P=k.prototype.rowsPerPage;V.set("rowsPerPage",this._rows>P?this._rows:P);V.set("structure",H)},_setGridData:function(){var H=[];if(this.grouping){this._groupRowIndices=[];var P,S,V=this._columns;g.forEach(this._flItems,function(da,L){H.push({});L=0===L?0:P+S+1;this._groupRowIndices.push(L);P=L;S=Math.ceil(da.length/V);H=H.concat(this._getStoreItems(da))},
this)}else this.featureLayers?(g.forEach(this._flItems,function(da){H=H.concat(da)}),H=this._getStoreItems(H)):H=this._getStoreItems(this._itItems);var Z=new n({data:{items:H}});this.grid.setStore(Z)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=d.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var H=this.grid;this._mouseOverConnect=F.connect(H,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=
F.connect(H,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&(F.disconnect(this._mouseOverConnect),F.disconnect(this._mouseOutConnect),d.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(H,P){var S=H.cellNode,V=H.rowIndex;H=H.cellIndex;var Z=this._getCellInfo(S,V,H);if(Z){var da=this.grid.store;if(!da.getValue(Z,"loadingCell")&&(this._selectedCell&&e.remove(this._selectedCell,"selectedItem"),S!==this._selectedCell?(e.add(S,"selectedItem"),this._selectedCell=S,this._selectedItem=
{featureLayer:da.getValue(Z,"layer"),type:da.getValue(Z,"type"),template:da.getValue(Z,"template"),symbolInfo:da.getValue(Z,"symbolInfo"),item:this._getItem(Z)},this._selectedInfo={selRow:V,selCol:H,index1:da.getValue(Z,"index1"),index2:da.getValue(Z,"index2"),index:da.getValue(Z,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!P))this.onSelectionChange()}},_locate:function(H,P,S){var V=this.grid.store,Z=Array(this._columns),da,L=P.index1,R=P.index2,aa=P.index,ia=H.item;g.some(S,
function(Q,T){return g.some(Z,function(Y,ea){return(Y=V.getValue(Q,"cell"+ea))&&(ia?aa===V.getValue(Y,"index"):L===V.getValue(Y,"index1")&&R===V.getValue(Y,"index2"))?(da=[T,ea],!0):!1})});return da},_getCellInfo:function(H,P,S){if(H)return H=this.grid,P=H.getItem(P),H.store.getValue(P,"cell"+S)},_getItem:function(H){var P=this.items;if(P)return P[this.grid.store.getValue(H,"index")]},_cellMouseOver:function(H){var P=this.tooltip,S=H.cellNode,V=this._getCellInfo(S,H.rowIndex,H.cellIndex);if(P&&V){var Z=
this.grid.store;H=Z.getValue(V,"template");var da=Z.getValue(V,"type"),L=Z.getValue(V,"symbolInfo");Z=Z.getValue(V,"layer");H=(V=this._getItem(V))&&V.label+(V.description?": "+V.description:"")||H&&H.name+(H.description?": "+H.description:"")||da&&da.name||L&&L.label+(L.description?": "+L.description:"")||(Z&&Z.name+": ")+"Default";P.style.display="none";P.innerHTML=H;S=D.coords(S.firstChild);a.set(P,{left:S.x+"px",top:S.y+S.h+5+"px"});P.style.display=""}},_cellMouseOut:function(){var H=this.tooltip;
H&&(H.style.display="none")},_destroyItems:function(){var H=this._itemWidgets,P;for(P in H)H[P]&&(H[P].destroy(),delete H[P])},_repaintItems:function(){var H=this._itemWidgets,P;for(P in H){var S=H[P];S&&S._repaint(S._surface)}},_getStoreItems:function(H){var P=this._uniqueId;H=g.map(H,function(Q){return A.mixin({surfaceId:"tpick-surface-"+P.id++},Q)});for(var S=H.length,V=0,Z={},da=0,L,R=[],aa=!0,ia=this._columns;V<S;)aa=!0,L="cell"+da,Z[L]=H[V],V++,da++,0===da%ia&&(aa=!1,R.push(Z),Z={},da=0);aa&&
S&&R.push(Z);return R},_getItemsFromLayers:function(H){var P=[];g.forEach(H,function(S,V){P.push(this._getItemsFromLayer(S,V))},this);return P},_getItemsFromLayer:function(H,P){var S=[];if(this.useLegend&&-1<g.indexOf(this._loadingIndices,P))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:H,type:null,template:null,index1:P,index2:0,loadingCell:1}];var V=[];V=V.concat(H.templates);g.forEach(H.types,function(R){var aa=R.templates;g.forEach(aa,function(ia){ia._type_=R});V=V.concat(aa)});
V=g.filter(V,J.isDefined);var Z=H.renderer;if(Z){var da=Z.declaredClass.replace("esri.renderer.","");if(0<V.length)g.forEach(V,function(R){var aa=R.prototype;if(aa){var ia;if(ia=this._isUnclassedRenderer(Z)?Z.infos[0].symbol:Z.valueExpression?this._createSimpleSymbol(H):Z.getSymbol(aa)||this._createSimpleSymbol(H)){var Q=null,T;if(!(9>q("ie"))&&R.thumbnail&&R.thumbnail.imageData)Q=new h(R.thumbnail);else if(this.useLegend&&-1<g.indexOf(this._legendIndices,P)){if(T=this._legendSymbols&&this._legendSymbols[P])switch(da){case "SimpleRenderer":Q=
T.defaultSymbol;break;case "UniqueValueRenderer":g.some(Z.infos,function(Y){Y.symbol===ia&&(Q=T[Y.value]);return!!Q});break;case "ClassBreaksRenderer":g.some(Z.infos,function(Y){Y.symbol===ia&&(Q=T[Y.maxValue]);return!!Q})}Q&&(aa=f.fromJson(f.toJson(h.defaultProps)),aa.url=Q.url,aa.imageData=Q.imageData,aa.contentType=Q.contentType,aa.width=Q.width,aa.height=Q.height,J.isDefined(aa.width)&&J.isDefined(aa.height)||(aa.width=15,aa.height=15),Q=new h(aa))}S.push({label:this._trimLabel(R.name),symbol:Q||
ia,legendOverride:!!Q,layer:H,type:R._type_,template:R,index1:P,index2:S.length})}else switch(da){case "HeatmapRenderer":S.push({label:this._trimLabel(R.name),symbol:new B,legendOverride:!!Q,layer:H,type:R._type_,template:R,index1:P,index2:S.length})}}delete R._type_},this);else{var L=[];"TemporalRenderer"===da&&(Z=Z.observationRenderer)&&(da=Z.declaredClass.replace("esri.renderer.",""));switch(da){case "SimpleRenderer":L=[{symbol:Z.symbol,label:Z.label,description:Z.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":L=
Z.infos}S=g.map(L,function(R,aa){return{label:this._trimLabel(R.label),description:R.description,symbolInfo:A.mixin({constructor:function(){}},R),symbol:R.symbol,layer:H,index1:P,index2:aa}},this)}}return S},_isUnclassedRenderer:function(H){return!!((H.hasVisualVariables("sizeInfo",!1)||H.hasVisualVariables("colorInfo",!1)||H.hasVisualVariables("opacityInfo",!1))&&H.addBreak&&H.infos&&1===H.infos.length)},_createSimpleSymbol:function(H){switch(H.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var P=
new B;break;case "esriGeometryPolyline":P=new w;break;case "esriGeometryPolygon":P=new r;break;default:H.hasXYFootprint&&H.hasXYFootprint()&&(P=new r)}return P},_getItemsFromItems:function(H){return g.map(H,function(P,S){P=A.mixin({index:S},P);P.label=this._trimLabel(P.label);return P},this)},_trimLabel:function(H){var P=this.maxLabelLength;P&&H&&H.length>P&&(H=H.substr(0,P)+"...");return H||""},_cellGet:function(H,P,S){return S?this.grid.store.getValue(S,"cell"+H):""},_cellFormatter:function(H){if(H){var P=
this._itemWidgets,S=this.grid.store,V=S.getValue(H,"surfaceId"),Z=P[V];Z||(Z=P[V]=new G({id:V,label:S.getValue(H,"label"),symbol:S.getValue(H,"symbol"),legendOverride:S.getValue(H,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:S.getValue(H,"template")}));return Z||""}return""},_cellGetGroup:function(H,P){if(!this._groupRowIndices)return"";H=g.indexOf(this._groupRowIndices,H);return P&&-1!==H?(P=this.featureLayers[H])&&(this.groupLabelFunction?this.groupLabelFunction(P):
P.name)||"":""},_cellGroupFormatter:function(H){return H?"\x3cdiv class\x3d'groupLabel'\x3e"+H+"\x3c/div\x3e":""}});c("extend-esri")&&A.setObject("dijit.editing.TemplatePicker",O,y);return O})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(N,A,F,D,g,f,t,c,v){var q=f("dojox.grid.DataGrid",t,{store:null,query:null,
queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},
createSelection:function(){this.selection=new c(this)},get:function(e,d){if(d&&"_item"==this.field&&!this.fields)return d;if(d&&this.fields){var b=[],a=this.grid.store;A.forEach(this.fields,function(m){b=b.concat(a.getValues(d,m))});return b}return d||"string"!==typeof e?d?this.field?"_item"==this.field?d:this.grid.store.getValue(d,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var e=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),
delete this._endUpdateDelay,e=!0);this.updating||(this.beginUpdate(),e=!0);if(e){var d=this;this._endUpdateDelay=setTimeout(function(){delete d._endUpdateDelay;d.endUpdate()},this.updateDelay)}}},_onSet:function(e,d,b,a){this._checkUpdateStatus();e=this.getItemIndex(e);-1<e&&this.updateRow(e)},_createItem:function(e,d){d=this._hasIdentity?this.store.getIdentity(e):D.toJson(this.query)+":idx:"+d+":sort:"+D.toJson(this.getSortProps());return this._by_idty[d]={idty:d,item:e}},_addItem:function(e,d,b){this._by_idx[d]=
this._createItem(e,d);b||this.updateRow(d)},_onNew:function(e,d){this._checkUpdateStatus();d=this.get("rowCount");this._addingItem=!0;this.updateRowCount(d+1);this._addingItem=!1;this._addItem(e,d);this.showMessage()},_onDelete:function(e){this._checkUpdateStatus();e=this._getItemIndex(e,!0);if(0<=e){this._pages=[];this._eop=this._bop=-1;var d=this._by_idx[e];this._by_idx.splice(e,1);delete this._by_idty[d.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(e)&&
(this.selection.deselect(e),this.selection.selected.splice(e,1))},_onRevert:function(){this._refresh()},setStore:function(e,d,b){this._requestsPending(0)||(this._setQuery(d,b),this._setStore(e),this._refresh(!0))},setQuery:function(e,d){this._requestsPending(0)||(this._setQuery(e,d),this._refresh(!0))},setItems:function(e){this.items=e;this._setStore(this.store);this._refresh(!0)},_setQuery:function(e,d){this.query=e;this.queryOptions=d||this.queryOptions},_setStore:function(e){this.store&&this._store_connects&&
A.forEach(this._store_connects,this.disconnect,this);if(this.store=e){e=this.store.getFeatures();var d=[];this._canEdit=!!e["dojo.data.api.Write"]&&!!e["dojo.data.api.Identity"];this._hasIdentity=!!e["dojo.data.api.Identity"];e["dojo.data.api.Notification"]&&!this.items&&(d.push(this.connect(this.store,"onSet","_onSet")),d.push(this.connect(this.store,"onNew","_onNew")),d.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&d.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=
d}},_onFetchBegin:function(e,d){this.scroller&&(this.rowCount!=e&&(d.isRender?(this.scroller.init(e,this.keepRows,this.rowsPerPage),this.rowCount=e,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(e)),e?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(e,d){this.scroller&&(e&&0<e.length&&(A.forEach(e,function(b,a){this._addItem(b,
d.start+a,!0)},this),this.updateRows(d.start,e.length),d.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),g("ie")&&v.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[d.start]=!1)},_onFetchError:function(e,d){console.log(e);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));
this._pending_requests[d.start]=!1;this.onFetchError(e,d)},onFetchError:function(e,d){},_fetch:function(e,d){e=e||0;if(this.store&&!this._pending_requests[e]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[e]=!0;try{if(this.items){var b=this.items,a=this.store;this.rowsPerPage=b.length;var m={start:e,count:this.rowsPerPage,isRender:d};this._onFetchBegin(b.length,m);var l=0;A.forEach(b,function(k){a.isItemLoaded(k)||l++});if(0===l)this._onFetchComplete(b,
m);else{var n=function(k){l--;0===l&&this._onFetchComplete(b,m)};A.forEach(b,function(k){a.isItemLoaded(k)||a.loadItem({item:k,onItem:n,scope:this})},this)}}else this.store.fetch({start:e,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:d,onBegin:F.hitch(this,"_onFetchBegin"),onComplete:F.hitch(this,"_onFetchComplete"),onError:F.hitch(this,"_onFetchError")})}catch(k){this._onFetchError(k,{start:e,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(e){var d=this._by_idx[e];return!d||d&&!d.item?(this._preparePage(e),null):d.item},getItemIndex:function(e){return this._getItemIndex(e,!1)},_getItemIndex:function(e,d){if(!d&&!this.store.isItem(e))return-1;d=this._hasIdentity?this.store.getIdentity(e):null;for(var b=0,a=this._by_idx.length;b<a;b++){var m=this._by_idx[b];if(m&&(d&&m.idty==d||m.item===e))return b}return-1},filter:function(e,
d){this.query=e;d&&this._clearData();this._fetch()},_getItemAttr:function(e,d){return(e=this.getItem(e))?this.store.getValue(e,d):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(e){return this._pending_requests[e]},_rowToPage:function(e){return this.rowsPerPage?Math.floor(e/this.rowsPerPage):e},_pageToRow:function(e){return this.rowsPerPage?this.rowsPerPage*
e:e},_preparePage:function(e){(e<this._bop||e>=this._eop)&&!this._addingItem&&(e=this._rowToPage(e),this._needPage(e),this._bop=e*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(e){this._pages[e]||(this._pages[e]=!0,this._requestPage(e))},_requestPage:function(e){e=this._pageToRow(e);0<Math.min(this.rowsPerPage,this.get("rowCount")-e)&&(this._requests++,this._requestsPending(e)||setTimeout(F.hitch(this,"_fetch",e,!1),1))},getCellName:function(e){return e.field},
_refresh:function(e){this._clearData();this._fetch(0,e)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var e=this.getCell(this.getSortIndex());if(e){var d=e.sortDesc,b=!(0<this.sortInfo);return[{attribute:e.field,descending:"undefined"==typeof d?b:b?!d:d}]}return this.sortFields?this.sortFields:null},styleRowState:function(e){if(this.store&&this.store.getState){for(var d=this.store.getState(e.index),
b="",a=0,m=["inflight","error","inserting"],l;l=m[a];a++)if(d[l]){b=" dojoxGridRow-"+l;break}e.customClasses+=b}},onStyleRow:function(e){this.styleRowState(e);this.inherited(arguments)},canEdit:function(e,d){return this._canEdit},_copyAttr:function(e,d){e=this.getItem(e);return this.store.getValue(e,d)},doStartEdit:function(e,d){this._cache[d]||(this._cache[d]=this._copyAttr(d,e.field));this.onStartEdit(e,d)},doApplyCellEdit:function(e,d,b){this.store.fetchItemByIdentity({identity:this._by_idx[d].idty,
onItem:F.hitch(this,function(a){var m=this.store.getValue(a,b);"number"==typeof m?e=isNaN(e)?e:parseFloat(e):"boolean"==typeof m?e="true"==e?!0:"false"==e?!1:e:m instanceof Date&&(m=new Date(e),e=isNaN(m.getTime())?e:m);this.store.setValue(a,b,e);this.onApplyCellEdit(e,d,b)})})},doCancelEdit:function(e){this._cache[e]&&(this.updateRow(e),delete this._cache[e]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(e,d){this.onApplyEdit(e)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var e=F.hitch(this,function(d){d.length&&(A.forEach(d,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:e}):e(this.selection.getSelected())}}});q.cell_markupFactory=function(e,d,b){var a=F.trim(v.attr(d,"field")||"");a&&(b.field=a);b.field=b.field||b.name;if(a=F.trim(v.attr(d,"fields")||""))b.fields=a.split(",");e&&e(d,b)};q.markupFactory=function(e,d,b,a){return t.markupFactory(e,d,b,F.partial(q.cell_markupFactory,
a))};return q})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(N,A,
F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G){N.isCopyKey||(N.isCopyKey=N.dnd.getCopyKeyState);F=F("dojox.grid._Grid",[m,l,D],{templateString:k,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:f,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");r.initOnFontResize();this.connect(r,"onFontResize","textSizeChanged");a.funnelEvents(this.domNode,this,"doKeyEvent",a.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");w.addClass(this.domNode,this.classTag);this.isLeftToRight()||w.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&w.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var y=N.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=x.substitute(this.loadingMessage,y);this.errorMessage=x.substitute(this.errorMessage,y);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&w.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(u.forEach(this._placeholders,function(y){y.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(y,J){"string"==typeof y&&(y=y&&"false"!=y?"true"==y?!0:window.parseInt(y,10):!1);"number"==typeof y&&(isNaN(y)&&(y=!1),0>y?y=!0:0===y&&(y=!1));this.autoHeight=y;this._autoHeight="boolean"==typeof y?y:"number"==typeof y?y>=this.get("rowCount"):!1;this._started&&!J&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new v(this);this.focus=new q(this);this.edit=new e(this)},createSelection:function(){this.selection=new d(this)},createScroller:function(){this.scroller=new g;this.scroller.grid=this;this.scroller.renderRow=B.hitch(this,"renderRow");this.scroller.removeRow=
B.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(y){},createViews:function(){this.views=new c(this);this.views.createView=B.hitch(this,"createView")},createView:function(y,J){y=new (B.getObject(y))({grid:this,index:J});this.viewsNode.appendChild(y.domNode);this.viewsHeaderNode.appendChild(y.headerNode);this.views.addView(y);w.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return y},buildViews:function(){for(var y=0,J;J=this.layout.structure[y];y++)this.createView(J.type||A._scopeName+".grid._View",y).setStructure(J);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(y){y&&B.isString(y)&&(N.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),y=B.getObject(y));this.structure=y;if(!y)if(this.layout.structure)y=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;y!==this.layout.structure&&this.layout.setStructure(y);this._structureChanged()},setStructure:function(y){N.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(y)},getColumnTogglingItems:function(){var y=[];var J=u.map(this.layout.cells,function(M){M.menuItems||(M.menuItems=[]);var ba=this,W=new n({label:M.name,checked:!M.hidden,_gridCell:M,onChange:function(E){if(ba.layout.setColumnVisibility(this._gridCell.index,
E)){var O=this._gridCell.menuItems;1<O.length&&u.forEach(O,function(H){H!==this&&H.setAttribute("checked",E)},this);E=u.filter(ba.layout.cells,function(H){1<H.menuItems.length?u.forEach(H.menuItems,"item.set('disabled', false);"):H.menuItems[0].set("disabled",!1);return!H.hidden});1==E.length&&u.forEach(E[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var E=u.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(E,1);delete this._gridCell;n.prototype.destroy.apply(this,
arguments)}});M.menuItems.push(W);M.hidden||y.push(W);return W},this);1==y.length&&y[0].set("disabled",!0);return J},_setHeaderMenuAttr:function(y){this._placeholders&&this._placeholders.length&&(u.forEach(this._placeholders,function(J){J.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=y)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(y){N.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(y)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&u.forEach(this._placeholders,function(y){y._replaced&&y.unReplace(!0);y.replace(this.getColumnTogglingItems())},this)},_fetch:function(y){this.setScrollTop(0)},getItem:function(y){return null},showMessage:function(y){y?(this.messagesNode.innerHTML=y,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(y,J){this._pendingChangeSize=y;this._pendingResultSize=J;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||w._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var y=this.viewsHeaderNode.style,J="none"==y.display?
0:this.views.measureHeader();y.height=J+"px";this.views.normalizeHeaderNodeHeight();return J},_resize:function(y,J){y=y||this._pendingChangeSize;J=J||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var M=this.domNode.parentNode;if(M&&1==M.nodeType&&this.hasLayout()&&"hidden"!=M.style.visibility&&"none"!=M.style.display){var ba=this._getPadBorder(),W=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var E=
W=this._getHeaderHeight();E+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=E+"px"}else this.domNode.clientHeight<=ba.h&&(M==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");J&&(y=J);!this._autoHeight&&y?(w.marginBox(this.domNode,y),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(E=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
w._getContentBox(M).h,this.domNode.style.height=Math.max(0,E)+"px");y=u.some(this.views.views,function(O){return O.flexCells});this._autoHeight||0!==(E||w._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",y||void 0!==W||(W=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";y&&(W=void 0);this.adaptWidth();this.adaptHeight(W);this.postresize()}}},adaptWidth:function(){var y=!this.initialWidth&&this.autoWidth,J=y?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;J=this.views.arrange(1,J);this.views.onEach("adaptWidth");y&&(this.domNode.style.width=J+"px")},adaptHeight:function(y){y=void 0===y?this._getHeaderHeight():y;var J=this._autoHeight?-1:Math.max(this.domNode.clientHeight-y,0)||0;this.views.onEach("setSize",[0,J]);this.views.onEach("adaptHeight");if(!this._autoHeight){var M=0,ba=0,W=u.filter(this.views.views,function(E){(E=E.hasHScrollbar())?M++:ba++;return!E});0<M&&0<ba&&u.forEach(W,function(E){E.adaptHeight(!0)})}!0===this.autoHeight||
-1!=J||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=J:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-y,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();w.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var y=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=y}},renderRow:function(y,J){this.views.renderRow(y,
J,this._skipRowRenormalize)},rowRemoved:function(y){this.views.rowRemoved(y)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var y=this.invalidated,J;if(y.all)this.update();else if(void 0!=y.rowCount)this.updateRowCount(y.rowCount);else for(J in y)this.updateRow(Number(J));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(y){y=Number(y);this.updating?this.invalidated[y]=!0:(this.views.updateRow(y),this.scroller.rowHeightChanged(y))},updateRows:function(y,J){y=Number(y);J=Number(J);var M;if(this.updating)for(M=0;M<J;M++)this.invalidated[M+y]=!0;else{for(M=0;M<J;M++)this.views.updateRow(M+y,this._skipRowRenormalize);this.scroller.rowHeightChanged(y)}},updateRowCount:function(y){this.updating?
this.invalidated.rowCount=y:(this.rowCount=y,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(y),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(y){this.views.updateRowStyles(y)},getRowNode:function(y){if(!this.focus.focusView||this.focus.focusView instanceof b)for(var J=0,M;M=this.views.views[J];J++){if(!(M instanceof b))return M.rowNodes[y]}else return this.focus.focusView.rowNodes[y];return null},
rowHeightChanged:function(y){this.views.renormalizeRow(y);this.scroller.rowHeightChanged(y)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:h("ie")?100:50,scrollTo:function(y){if(this.fastScroll){var J=Math.abs(this.lastScrollTop-y);this.lastScrollTop=y;if(J>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=y;this.views.setScrollTop(y);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var M=this;this._pendingScroll=window.setTimeout(function(){delete M._pendingScroll;
M.finishScrollJob()},200)}else this.setScrollTop(y)}else this.setScrollTop(y)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(y){this.scroller.scroll(this.views.setScrollTop(y))},scrollToRow:function(y){this.setScrollTop(this.scroller.findScrollTop(y)+1)},styleRowNode:function(y,J){J&&this.rows.styleRowNode(y,J)},_mouseOut:function(y){this.rows.setOverRow(-2)},getCell:function(y){return this.layout.cells[y]},setCellWidth:function(y,J){this.getCell(y).unitWidth=
J},getCellName:function(y){return"Cell "+y.index},canSort:function(y){},sort:function(){},getSortAsc:function(y){y=void 0==y?this.sortInfo:y;return 0<y},getSortIndex:function(y){y=void 0==y?this.sortInfo:y;return Math.abs(y)-1},setSortIndex:function(y,J){var M=y+1;void 0!=J?M*=J?1:-1:this.getSortIndex()==y&&(M=-this.sortInfo);this.setSortInfo(M)},setSortInfo:function(y){this.canSort(y)&&(this.sortInfo=y,this.sort(),this.update())},doKeyEvent:function(y){y.dispatch="do"+y.type;this.onKeyEvent(y)},
_dispatch:function(y,J){return y in this?this[y](J):!1},dispatchKeyEvent:function(y){this._dispatch(y.dispatch,y)},dispatchContentEvent:function(y){this.edit.dispatchEvent(y)||y.sourceView.dispatchContentEvent(y)||this._dispatch(y.dispatch,y)},dispatchHeaderEvent:function(y){y.sourceView.dispatchHeaderEvent(y)||this._dispatch("doheader"+y.type,y)},dokeydown:function(y){this.onKeyDown(y)},doclick:function(y){if(y.cellNode)this.onCellClick(y);else this.onRowClick(y)},dodblclick:function(y){if(y.cellNode)this.onCellDblClick(y);
else this.onRowDblClick(y)},docontextmenu:function(y){if(y.cellNode)this.onCellContextMenu(y);else this.onRowContextMenu(y)},doheaderclick:function(y){if(y.cellNode)this.onHeaderCellClick(y);else this.onHeaderClick(y)},doheaderdblclick:function(y){if(y.cellNode)this.onHeaderCellDblClick(y);else this.onHeaderDblClick(y)},doheadercontextmenu:function(y){if(y.cellNode)this.onHeaderCellContextMenu(y);else this.onHeaderContextMenu(y)},doStartEdit:function(y,J){this.onStartEdit(y,J)},doApplyCellEdit:function(y,
J,M){this.onApplyCellEdit(y,J,M)},doCancelEdit:function(y){this.onCancelEdit(y)},doApplyEdit:function(y){this.onApplyEdit(y)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});F.markupFactory=function(y,J,M,ba){var W=function(E){E=w.attr(E,"width")||"auto";"auto"!=E&&"em"!=E.slice(-2)&&"%"!=E.slice(-1)&&
(E=parseInt(E,10)+"px");return E};y.structure||"table"!=J.nodeName.toLowerCase()||(y.structure=G("\x3e colgroup",J).map(function(E){var O=w.attr(E,"span");O={noscroll:"true"==w.attr(E,"noscroll")?!0:!1,__span:O?parseInt(O,10):1,cells:[]};w.hasAttr(E,"width")&&(O.width=W(E));return O}),y.structure.length||y.structure.push({__span:Infinity,cells:[]}),G("thead \x3e tr",J).forEach(function(E,O){var H=0,P=0,S,V=null;G("\x3e th",E).map(function(Z){V?H>=S+V.__span&&(P++,S+=V.__span,V=y.structure[P]):(S=
0,V=y.structure[0]);var da={name:B.trim(w.attr(Z,"name")||Z.innerHTML),colSpan:parseInt(w.attr(Z,"colspan")||1,10),type:B.trim(w.attr(Z,"cellType")||""),id:B.trim(w.attr(Z,"id")||"")};H+=da.colSpan;var L=w.attr(Z,"rowspan");L&&(da.rowSpan=L);w.hasAttr(Z,"width")&&(da.width=W(Z));w.hasAttr(Z,"relWidth")&&(da.relWidth=window.parseInt(w.attr(Z,"relWidth"),10));w.hasAttr(Z,"hidden")&&(da.hidden="true"==w.attr(Z,"hidden")||!0===w.attr(Z,"hidden"));ba&&ba(Z,da);da.type=da.type?B.getObject(da.type):A.grid.cells.Cell;
da.type&&da.type.markupFactory&&da.type.markupFactory(Z,da);V.cells[O]||(V.cells[O]=[]);V.cells[O].push(da)})}));return new M(y,J)};return F})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(N,A,F,D,g){return F("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(f){this.dispatchKeyEvent(f)},onContentEvent:function(f){this.dispatchContentEvent(f)},onHeaderEvent:function(f){this.dispatchHeaderEvent(f)},
onStyleRow:function(f){f.customClasses+=(f.odd?" dojoxGridRowOdd":"")+(f.selected?" dojoxGridRowSelected":"")+(f.over?" dojoxGridRowOver":"");this.focus.styleRow(f);this.edit.styleRow(f)},onKeyDown:function(f){if(!f.altKey&&!f.metaKey)switch(f.keyCode){case N.ESCAPE:this.edit.cancel();break;case N.ENTER:if(!this.edit.isEditing()){var t=this.focus.getHeaderIndex();if(0<=t){this.setSortIndex(t);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(f),f.shiftKey);D.stop(f)}f.shiftKey||
(t=this.edit.isEditing(),this.edit.apply(),t||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(f),this.onRowClick(f),D.stop(f));break;case N.SPACE:this.edit.isEditing()||(t=this.focus.getHeaderIndex(),0<=t?this.setSortIndex(t):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(f),f.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),D.stop(f)));
break;case N.TAB:this.focus[f.shiftKey?"previousKey":"nextKey"](f);break;case N.LEFT_ARROW:case N.RIGHT_ARROW:if(!this.edit.isEditing()){var c=f.keyCode;D.stop(f);t=this.focus.getHeaderIndex();0<=t&&f.shiftKey&&f.ctrlKey?this.focus.colSizeAdjust(f,t,5*(c==N.LEFT_ARROW?-1:1)):(f=c==N.LEFT_ARROW?1:-1,this.isLeftToRight()&&(f*=-1),this.focus.move(0,f))}break;case N.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(D.stop(f),this.focus.move(-1,0));break;case N.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(D.stop(f),this.focus.move(1,0));break;case N.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(D.stop(f),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case N.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(D.stop(f),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(f){-1==f.rowIndex?this.onHeaderCellMouseOver(f):this.onCellMouseOver(f)},onMouseOut:function(f){-1==f.rowIndex?this.onHeaderCellMouseOut(f):this.onCellMouseOut(f)},onMouseDown:function(f){-1==
f.rowIndex?this.onHeaderCellMouseDown(f):this.onCellMouseDown(f)},onMouseOverRow:function(f){this.rows.isOver(f.rowIndex)||(this.rows.setOverRow(f.rowIndex),-1==f.rowIndex?this.onHeaderMouseOver(f):this.onRowMouseOver(f))},onMouseOutRow:function(f){if(this.rows.isOver(-1))this.onHeaderMouseOut(f);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(f))},onMouseDownRow:function(f){if(-1!=f.rowIndex)this.onRowMouseDown(f)},onCellMouseOver:function(f){f.cellNode&&A.add(f.cellNode,
this.cellOverClass)},onCellMouseOut:function(f){f.cellNode&&A.remove(f.cellNode,this.cellOverClass)},onCellMouseDown:function(f){},onCellClick:function(f){this._click[0]=this._click[1];this._click[1]=f;this.edit.isEditCell(f.rowIndex,f.cellIndex)||this.focus.setFocusCell(f.cell,f.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(f)},onCellDblClick:function(f){var t=1<this._click.length&&g("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:f;this.focus.setFocusCell(t.cell,t.rowIndex);this.edit.setEditCell(t.cell,t.rowIndex);this.onRowDblClick(f)},onCellContextMenu:function(f){this.onRowContextMenu(f)},onCellFocus:function(f,t){this.edit.cellFocus(f,t)},onRowClick:function(f){this.edit.rowClick(f);this.selection.clickSelectEvent(f)},onRowDblClick:function(f){},onRowMouseOver:function(f){},onRowMouseOut:function(f){},onRowMouseDown:function(f){},onRowContextMenu:function(f){D.stop(f)},onHeaderMouseOver:function(f){},onHeaderMouseOut:function(f){},
onHeaderCellMouseOver:function(f){f.cellNode&&A.add(f.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(f){f.cellNode&&A.remove(f.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(f){},onHeaderClick:function(f){},onHeaderCellClick:function(f){this.setSortIndex(f.cell.index);this.onHeaderClick(f)},onHeaderDblClick:function(f){},onHeaderCellDblClick:function(f){this.onHeaderDblClick(f)},onHeaderCellContextMenu:function(f){this.onHeaderContextMenu(f)},onHeaderContextMenu:function(f){this.headerMenu||
D.stop(f)},onStartEdit:function(f,t){},onApplyCellEdit:function(f,t,c){},onCancelEdit:function(f){},onApplyEdit:function(f){},onCanSelect:function(f){return!0},onCanDeselect:function(f){return!0},onSelected:function(f){this.updateRowStyles(f)},onDeselected:function(f){this.updateRowStyles(f)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(N,A,F,D,g){var f=function(c){c&&dojo.forEach(N.toArray(),
function(v){v.domNode&&g.isDescendant(v.domNode,c,!0)&&v.destroy()})},t=function(c,v){for(var q=[],e=0,d;d=c.childNodes[e];){e++;var b=g.byId(d);(b&&b.tagName?b.tagName.toLowerCase():"")==v&&q.push(d)}return q};return A("dojox.grid._Scroller",null,{constructor:function(c){this.setContentNodes(c);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(c,v,q){switch(arguments.length){case 3:this.rowsPerPage=q;case 2:this.keepRows=v;case 1:this.rowCount=c}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=F.hitch(this,
"onscroll"))},_getPageCount:function(c,v){return c?Math.ceil(c/v)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(c){this.keepPages=(this.keepRows=c)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(c){this.colCount=(this.contentNodes=c)?this.contentNodes.length:0;this.pageNodes=[];for(c=0;c<this.colCount;c++)this.pageNodes[c]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(c){this.invalidateNodes();this.rowCount=c;c=this.pageCount;0===c&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<c)for(--c;c>=this.pageCount;c--)this.height-=this.getPageHeight(c),delete this.pageHeights[c];
else this.pageCount>c&&(this.height+=this.defaultPageHeight*(this.pageCount-c-1)+this.calcLastPageHeight());this.resize()},pageExists:function(c){return!!this.getDefaultPageNode(c)},measurePage:function(c){return this.grid.rowHeight?((c+1)*this.rowsPerPage>this.rowCount?this.rowCount-c*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(c=this.getDefaultPageNode(c))&&c.innerHTML?c.offsetHeight:void 0},positionPage:function(c,v){for(var q=0;q<this.colCount;q++)this.pageNodes[q][c].style.top=v+
"px"},repositionPages:function(c){for(var v=this.getDefaultNodes(),q=0,e=0;e<this.stack.length;e++)q=Math.max(this.stack[e],q);var d=(e=v[c])?this.getPageNodePosition(e)+this.getPageHeight(c):0;for(c+=1;c<=q;c++){if(e=v[c]){if(this.getPageNodePosition(e)==d)break;this.positionPage(c,d)}d+=this.getPageHeight(c)}},installPage:function(c){for(var v=0;v<this.colCount;v++)this.contentNodes[v].appendChild(this.pageNodes[v][c])},preparePage:function(c,v){v=v?this.popPage():null;for(var q=0;q<this.colCount;q++){var e=
this.pageNodes[q],d=null===v?this.createPageNode():this.invalidatePageNode(v,e);d.pageIndex=c;e[c]=d}},renderPage:function(c){var v=[],q;for(q=0;q<this.colCount;q++)v[q]=this.pageNodes[q][c];q=0;for(c*=this.rowsPerPage;q<this.rowsPerPage&&c<this.rowCount;q++,c++)this.renderRow(c,v)},removePage:function(c){var v=0;for(c*=this.rowsPerPage;v<this.rowsPerPage;v++,c++)this.removeRow(c)},destroyPage:function(c){for(var v=0;v<this.colCount;v++){var q=this.invalidatePageNode(c,this.pageNodes[v]);q&&g.destroy(q)}},
pacify:function(c){},pacifying:!1,pacifyTicks:200,setPacifying:function(c){this.pacifying!=c&&(this.pacifying=c,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var c=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return c},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var c=0;c<this.colCount;c++)D.setStyleHeightPx(this.contentNodes[c],
Math.max(1,this.height));c=!this._invalidating;if(!c){var v=this.grid.get("autoHeight");"number"==typeof v&&v<=Math.min(this.rowsPerPage,this.rowCount)&&(c=!0)}c&&this.needPage(this.page,this.pageTop);c=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;v=this.getPageHeight(this.page);this.averageRowHeight=0<v&&0<c?v/c:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var c=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=c},updateContentHeight:function(c){this.height+=c;this.resize()},updatePageHeight:function(c,v,q){if(this.pageExists(c)){var e=this.getPageHeight(c),d=this.measurePage(c);void 0===d&&(d=e);this.pageHeights[c]=d;if(e!=d){this.updateContentHeight(d-e);var b=this.grid.get("autoHeight");"number"==typeof b&&b>this.rowCount||!0===b&&!v?q?(v=this.grid.viewsNode.style,v.height=parseInt(v.height)+d-e+"px",this.repositionPages(c)):this.grid.sizeChange():this.repositionPages(c)}return d}return 0},
rowHeightChanged:function(c,v){this.updatePageHeight(Math.floor(c/this.rowsPerPage),!1,v)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var c=document.createElement("div");g.attr(c,"role","presentation");c.style.position="absolute";c.style[this.grid.isLeftToRight()?"left":"right"]="0";return c},getPageHeight:function(c){c=this.pageHeights[c];return void 0!==c?c:this.defaultPageHeight},pushPage:function(c){return this.stack.push(c)},
popPage:function(){return this.stack.shift()},findPage:function(c){for(var v=0,q=0,e=0;v<this.pageCount&&!(e=this.getPageHeight(v),q+e>=c);v++,q+=e);this.page=v;this.pageTop=q},buildPage:function(c,v,q){this.preparePage(c,v);this.positionPage(c,q);this.installPage(c);this.renderPage(c);this.pushPage(c)},needPage:function(c,v){var q=this.getPageHeight(c);this.pageExists(c)?this.positionPage(c,v):(this.buildPage(c,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,v),q=this.updatePageHeight(c,
!0));return q},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(c){this.grid.scrollTop=c;if(this.colCount){this.startPacify();this.findPage(c);for(var v=this.height,q=this.getScrollBottom(c),e=this.page,d=this.pageTop;e<this.pageCount&&(0>q||d<q);e++)d+=this.needPage(e,d);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,c);this.lastVisibleRow=this.getLastVisibleRow(e-1,d,q);v!=this.height&&this.repositionPages(e-1);this.endPacify()}},getScrollBottom:function(c){return 0<=
this.windowHeight?c+this.windowHeight:-1},processNodeEvent:function(c,v){for(var q=c.target;q&&q!=v&&q.parentNode&&q.parentNode.parentNode!=v;)q=q.parentNode;if(!q||!q.parentNode||q.parentNode.parentNode!=v)return!1;c.topRowIndex=q.parentNode.pageIndex*this.rowsPerPage;v=c.topRowIndex;a:{var e=0;for(var d,b=q.parentNode;d=b.childNodes[e++];)if(d==q){--e;break a}e=-1}c.rowIndex=v+e;c.rowTarget=q;return!0},processEvent:function(c){return this.processNodeEvent(c,this.contentNode)},renderRow:function(c,
v){},removeRow:function(c){},getDefaultPageNode:function(c){return this.getDefaultNodes()[c]},positionPageNode:function(c,v){},getPageNodePosition:function(c){return c.offsetTop},invalidatePageNode:function(c,v){var q=v[c];q&&(delete v[c],this.removePage(c,q),f(q),q.innerHTML="");return q},getPageRow:function(c){return c*this.rowsPerPage},getLastPageRow:function(c){return Math.min(this.rowCount,this.getPageRow(c+1))-1},getFirstVisibleRow:function(c,v,q){if(!this.pageExists(c))return 0;var e=this.getPageRow(c),
d=this.getDefaultNodes();c=t(d[c],"div");d=0;for(var b=c.length;d<b&&v<q;d++,e++)v+=c[d].offsetHeight;return e?e-1:e},getLastVisibleRow:function(c,v,q){if(!this.pageExists(c))return 0;var e=this.getDefaultNodes(),d=this.getLastPageRow(c);c=t(e[c],"div");for(e=c.length-1;0<=e&&v>q;e--,d--)v-=c[e].offsetHeight;return d+1},findTopRow:function(c){var v=this.getDefaultNodes();v=t(v[this.page],"div");for(var q=0,e=v.length,d=this.pageTop,b;q<e;q++)if(b=v[q].offsetHeight,d+=b,d>=c)return this.offset=b-(d-
c),q+this.page*this.rowsPerPage;return-1},findScrollTop:function(c){var v=Math.floor(c/this.rowsPerPage),q=0,e;for(e=0;e<v;e++)q+=this.getPageHeight(e);this.pageTop=q;this.page=v;this.needPage(v,this.pageTop);e=this.getDefaultNodes();var d=t(e[v],"div");v=c-this.rowsPerPage*v;e=0;for(c=d.length;e<c&&e<v;e++)q+=d[e].offsetHeight;return q},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(N,A,F,D){var g=A.getObject("grid.util",!0,N);
g.na="...";g.rowIndexTag="gridRowIndex";g.gridViewTag="gridView";g.fire=function(f,t,c){function v(m,l){if(null==m)return null;var n=l?"Width":"Height";return m["scroll"+n]>m["client"+n]?m:v(m.parentNode,l)}var q;if(D("webkit")&&"focus"==t){var e=f.domNode?f.domNode:f;if(q=v(e,!1))var d=q.scrollTop;if(e=v(e,!0))var b=e.scrollLeft}var a=f&&t&&f[t];f=a&&(c?a.apply(f,c):f[t]());D("webkit")&&"focus"==t&&(q&&(q.scrollTop=d),e&&(e.scrollLeft=b));return f};g.setStyleHeightPx=function(f,t){if(0<=t){var c=
f.style;t+="px";f&&c.height!=t&&(c.height=t)}};g.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");g.keyEvents=["keyup","keydown","keypress"];g.funnelEvents=function(f,t,c,v){v=v?v:g.mouseEvents.concat(g.keyEvents);for(var q=0,e=v.length;q<e;q++)t.connect(f,"on"+v[q],c)};g.removeNode=function(f){(f=F.byId(f))&&f.parentNode&&f.parentNode.removeChild(f);return f};g.arrayCompare=function(f,t){for(var c=0,v=f.length;c<v;c++)if(f[c]!=t[c])return!1;return f.length==
t.length};g.arrayInsert=function(f,t,c){f.length<=t?f[t]=c:f.splice(t,0,c)};g.arrayRemove=function(f,t){f.splice(t,1)};g.arraySwap=function(f,t,c){var v=f[t];f[t]=f[c];f[c]=v};return g})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(N,A,F,D,g,f){return F("dojox.grid._Layout",null,{constructor:function(t){this.grid=t},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(t,
c,v,q,e){var d=this.structure[t].cells[0],b=this.structure[c].cells[0],a=null,m=a=0;t=0;for(var l;l=d[t];t++)if(l.index==v){a=t;break}a=d.splice(a,1)[0];a.view=this.grid.views.views[c];t=0;for(l=null;l=b[t];t++)if(l.index==q){m=t;break}e||(m+=1);b.splice(m,0,a);if(v=this.grid.getCell(this.grid.getSortIndex()))v._currentlySorted=this.grid.getSortAsc();this.cells=[];for(t=v=0;c=this.structure[t];t++)for(q=0;e=c.cells[q];q++)for(d=0;l=e[d];d++)l.index=v,this.cells.push(l),"_currentlySorted"in l&&(b=
v+1,b*=l._currentlySorted?1:-1,this.grid.sortInfo=b,delete l._currentlySorted),v++;D.forEach(this.cells,function(n){var k=n.markup[2].split(" ");parseInt(k[1].substring(5))!=n.index&&(k[1]='idx\x3d"'+n.index+'"',n.markup[2]=k.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(t,c){t=this.cells[t];if(t.hidden==c){t.hidden=!c;c=t.view;var v=c.viewWidth;v&&"auto"!=v&&(c._togglingColumn=f.getMarginBox(t.getHeaderNode()).w||0);c.update();return!0}return!1},addCellDef:function(t,c,v){var q=
this,e=function(d){var b=0;1<d.colSpan?b=0:(b=d.width||q._defaultCellProps.width||q.defaultWidth,isNaN(b)||(b+="em"));return b};t={grid:this.grid,subrow:t,layoutIndex:c,index:this.cells.length};if(v&&v instanceof A.grid.cells._Base)return c=g.clone(v),t.unitWidth=e(c._props),c=g.mixin(c,this._defaultCellProps,v._props,t);c=v.type||v.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||A.grid.cells.Cell;g.isString(c)&&(c=g.getObject(c));t.unitWidth=e(v);return new c(g.mixin({},this._defaultCellProps,
v,t))},addRowDef:function(t,c){for(var v=[],q=0,e=0,d=!0,b=0,a;a=c[b];b++)a=this.addCellDef(t,b,a),v.push(a),this.cells.push(a),d&&a.relWidth?q+=a.relWidth:a.width&&(a=a.width,"string"==typeof a&&"%"==a.slice(-1)?e+=window.parseInt(a,10):"auto"==a&&(d=!1));q&&d&&D.forEach(v,function(m){m.relWidth&&(m.width=m.unitWidth=m.relWidth/q*(100-e)+"%")});return v},addRowsDef:function(t){var c=[];if(g.isArray(t))if(g.isArrayLike(t[0]))for(var v=0,q;t&&(q=t[v]);v++)c.push(this.addRowDef(v,q));else c.push(this.addRowDef(0,
t));return c},addViewDef:function(t){this._defaultCellProps=t.defaultCell||{};t.width&&"auto"==t.width&&delete t.width;return g.mixin({},t,{cells:this.addRowsDef(t.rows||t.cells)})},setStructure:function(t){this.fieldIndex=0;this.cells=[];var c=this.structure=[];if(this.grid.rowSelector){var v={type:A._scopeName+".grid._RowSelector"};if(g.isString(this.grid.rowSelector)){var q=this.grid.rowSelector;"false"==q?v=null:"true"!=q&&(v.width=q)}else this.grid.rowSelector||(v=null);v&&c.push(this.addViewDef(v))}var e=
function(m){return"name"in m||"field"in m||"get"in m};v=function(m){return g.isArray(m)&&(g.isArray(m[0])||e(m[0]))?!0:!1};q=function(m){return null!==m&&g.isObject(m)&&("cells"in m||"rows"in m||"type"in m&&!e(m))};if(g.isArrayLike(t)){for(var d=!1,b=0,a;a=t[b];b++)if(q(a)){d=!0;break}if(d)for(b=0;a=t[b];b++)v(a)?c.push(this.addViewDef({cells:a})):q(a)&&c.push(this.addViewDef(a));else c.push(this.addViewDef({cells:t}))}else q(t)&&c.push(this.addViewDef(t));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(N){return N.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d){var b=A("dojox.grid._DeferredTextWidget",e,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(F.hitch(this,
function(k){this.domNode&&(this.domNode.innerHTML=k)}))}}),a=function(){setTimeout(F.hitch.apply(N,arguments),0)},m=A("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(k){this._props=k||{};F.mixin(this,k);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(k,x){var u=this.grid.formatterScope||this,B=this.formatter;
B&&u&&"string"==typeof B&&(B=this.formatter=u[B]);k=k!=this.defaultValue&&B?B.apply(u,x):k;if("undefined"==typeof k)return this.defaultValue;k&&k.addBoth&&(k=new b({deferred:k},q.create("span",{innerHTML:this.defaultValue})));return k&&k.declaredClass&&k.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+k.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":k},format:function(k,x){var u=this.grid.edit.info;(x=this.get?this.get(k,x):this.value||this.defaultValue)&&x.replace&&
this.grid.escapeHTMLInData&&(x=x.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||u.rowIndex==k&&u.cell==this)?this.formatEditing(u.value?u.value:x,k):this._defaultFormat(x,[x,k,this])},formatEditing:function(k,x){},getNode:function(k){return this.view.getCellNode(k,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(k){return(this.getNode(k)||0).firstChild||0},canResize:function(){var k=
this.unitWidth;return k&&"auto"!==k},isFlex:function(){var k=this.unitWidth;return k&&F.isString(k)&&("auto"==k||"%"==k.slice(-1))},applyEdit:function(k,x){this.getNode(x)&&this.grid.edit.applyCellEdit(k,this,x)},cancelEdit:function(k){this.grid.doCancelEdit(k)},_onEditBlur:function(k){this.grid.edit.isEditCell(k,this.index)&&this.grid.edit.apply()},registerOnBlur:function(k,x){this.commitOnBlur&&g.connect(k,"onblur",function(u){setTimeout(F.hitch(this,"_onEditBlur",x),250)})},needFormatNode:function(k,
x){this._formatPending=!0;a(this,"_formatNode",k,x)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(k,x){this._formatPending&&(this._formatPending=!1,t("ie")||c.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(x),k,x))},formatNode:function(k,x,u){t("ie")?a(this,"focus",u,k):this.focus(u,k)},dispatchEvent:function(k,x){if(k in this)return this[k](x)},getValue:function(k){return this.getEditNode(k)[this._valueProp]},setValue:function(k,x){(k=this.getEditNode(k))&&
(k[this._valueProp]=x)},focus:function(k,x){k=x||this.getEditNode(k);try{d.fire(k,"focus"),d.fire(k,"select")}catch(u){}},save:function(k){this.value=this.value||this.getValue(k)},restore:function(k){this.setValue(k,this.value)},_finish:function(k){c.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(k){this.applyEdit(this.getValue(k),k);this._finish(k)},cancel:function(k){this.cancelEdit(k);this._finish(k)}});m.markupFactory=function(k,x){var u=F.trim(v.get(k,"formatter")||
"");u&&(x.formatter=F.getObject(u)||u);if(u=F.trim(v.get(k,"get")||""))x.get=F.getObject(u);u=function(B,h,r){var w=F.trim(v.get(k,B)||"");w&&(h[r||B]="false"!=w.toLowerCase())};u("sortDesc",x);u("editable",x);u("alwaysEditing",x);u("noresize",x);u("draggable",x);if(u=F.trim(v.get(k,"loadingText")||v.get(k,"defaultValue")||""))x.defaultValue=u;u=function(B,h,r){var w=F.trim(v.get(k,B)||"")||void 0;w&&(h[r||B]=w)};u("styles",x);u("headerStyles",x);u("cellStyles",x);u("classes",x);u("headerClasses",
x);u("cellClasses",x)};var l=m.Cell=A("dojox.grid.cells.Cell",m,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(k,x){this.needFormatNode(k,x);k&&k.replace&&(k=k.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+k+'"\x3e'},formatNode:function(k,x,u){this.inherited(arguments);this.registerOnBlur(k,u)},doKey:function(k){this.keyFilter&&-1==String.fromCharCode(k.charCode).search(this.keyFilter)&&D.stop(k)},_finish:function(k){this.inherited(arguments);
var x=this.getEditNode(k);try{d.fire(x,"blur")}catch(u){}}});l.markupFactory=function(k,x){m.markupFactory(k,x);if(k=F.trim(v.get(k,"keyFilter")||""))x.keyFilter=new RegExp(k)};(m.RowIndex=A("dojox.grid.cells.RowIndex",l,{name:"Row",postscript:function(){this.editable=!1},get:function(k){return k+1}})).markupFactory=function(k,x){l.markupFactory(k,x)};(m.Select=A("dojox.grid.cells.Select",l,{options:null,values:null,returnIndex:-1,constructor:function(k){this.values=this.values||this.options},formatEditing:function(k,
x){this.needFormatNode(k,x);x=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var u=0,B,h;void 0!==(B=this.options[u])&&void 0!==(h=this.values[u]);u++)h=h.replace?h.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):h,B=B.replace?B.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):B,x.push("\x3coption",k==h?" selected":"",' value\x3d"'+h+'"',"\x3e",B,"\x3c/option\x3e");x.push("\x3c/select\x3e");return x.join("")},_defaultFormat:function(k,x){var u=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var B=f.indexOf(this.values,u);0<=B&&(u=this.options[B])}return u},getValue:function(k){var x=this.getEditNode(k);if(x)return k=x.selectedIndex,x=x.options[k],-1<this.returnIndex?k:x.value||x.innerHTML}})).markupFactory=function(k,x){l.markupFactory(k,x);var u=F.trim(v.get(k,"options")||"");if(u){var B=u.split(",");B[0]!=u&&(x.options=B)}if(k=F.trim(v.get(k,"values")||""))u=k.split(","),u[0]!=k&&(x.values=u)};var n=m.AlwaysEdit=A("dojox.grid.cells.AlwaysEdit",l,{alwaysEditing:!0,_formatNode:function(k,
x){this.formatNode(this.getEditNode(x),k,x)},applyStaticValue:function(k){var x=this.grid.edit;x.applyCellEdit(this.getValue(k),this,k);x.start(this,k,!0)}});n.markupFactory=function(k,x){l.markupFactory(k,x)};(m.Bool=A("dojox.grid.cells.Bool",n,{_valueProp:"checked",formatEditing:function(k,x){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(k?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(k){"INPUT"==k.target.tagName&&this.applyStaticValue(k.rowIndex)}})).markupFactory=
function(k,x){n.markupFactory(k,x)};return m})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(N,A){return N("dojox.grid._RowSelector",A,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(F,D){D.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(F,D){var g=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(F)&&g.push("dojoxGridRowbarOver");this.grid.selection.isSelected(F)&&g.push("dojoxGridRowbarSelected");D.className=g.join(" ")},domouseover:function(F){this.grid.onMouseOverRow(F)},domouseout:function(F){if(!this.isIntraRowEvent(F))this.grid.onMouseOutRow(F)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u){e=D("dojox.grid._View",[b,a],{defaultWidth:"18em",viewWidth:"",templateString:e,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:k._HeaderBuilder,_contentBuilderClass:k._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");l.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
l.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){n.destroy(this.headerNode);delete this.headerNode;for(var r in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[r]),n.destroy(this.rowNodes[r]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){c("ie")||c("webkit")||c("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(r){r=this.structure=r;r.width&&!isNaN(r.width)?this.viewWidth=r.width+"em":this.viewWidth=r.width||(r.noscroll?"auto":this.viewWidth);this._onBeforeRow=r.onBeforeRow||function(){};this._onAfterRow=r.onAfterRow||function(){};if(this.noscroll=r.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==r.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(r){r&&g.forEach(v("[widgetId]",r).map(A.byNode),function(w){w._destroyOnRemove?(w.destroy(),delete w):w.domNode&&w.domNode.parentNode&&w.domNode.parentNode.removeChild(w.domNode)})},onBeforeRow:function(r,w){this._onBeforeRow(r,w);0<=r&&this._cleanupRowWidgets(this.getRowNode(r))},onAfterRow:function(r,w,G){this._onAfterRow(r,w,G);var y=this.grid;g.forEach(v(".dojoxGridStubNode",G),function(J){if(J&&J.parentNode){var M=J.getAttribute("linkWidget"),
ba=window.parseInt(n.attr(J,"cellIdx"),10);y.getCell(ba);(M=A.byId(M))?(J.parentNode.replaceChild(M.domNode,J),M._started||M.startup(),N.destroy(J)):J.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var r=0,w;w=this.structure.cells[r];r++)for(var G=0,y;y=w[G];G++)y.view=this,this.flexCells=this.flexCells||y.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var r=this.hasVScrollbar(),w=n.style(this.scrollboxNode,
"overflow");this.noscroll||!w||"hidden"==w?r=!1:"scroll"==w&&(r=!0);return r?m.getScrollbar().w:0},getColumnsWidth:function(){var r=this.headerContentNode;return r&&r.firstChild?r.firstChild.offsetWidth||n.style(r.firstChild,"width"):0},setColumnsWidth:function(r){this.headerContentNode.firstChild.style.width=r+"px";this.viewWidth&&(this.viewWidth=r+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
n._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var r=this.grid.layout.cells,w=f.hitch(this,function(y,J){!this.grid.isLeftToRight()&&(J=!J);J=J?-1:1;y=this.header.getCellNodeIndex(y)+J;for(var M=r[y];M&&M.getHeaderNode()&&"none"==M.getHeaderNode().style.display;)y+=J,M=r[y];return M?M.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&n.destroy(this.bottomMarker);this.bottomMarker=n.byId("dojoxGrid_bottomMarker");this.topMarker&&n.destroy(this.topMarker);this.topMarker=n.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=n.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},q.body()),this._hide(this.bottomMarker),this.topMarker=n.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
q.body()),this._hide(this.topMarker));this.arrowDim=n.contentBox(this.bottomMarker);var G=n.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new d(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:f.hitch(this,function(y){this.header.decorateEvent(y);if((this.header.overRightResizeArea(y)||this.header.overLeftResizeArea(y))&&this.header.canResize(y)&&!this.header.moveable)this.header.beginColumnResize(y);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);y.button===(9>c("ie")?1:0)&&d.prototype.onMouseDown.call(this.source,y)}}),onMouseOver:f.hitch(this,function(y){var J=this.source;J._getChildByEvent(y)&&d.prototype.onMouseOver.apply(J,arguments)}),_markTargetAnchor:f.hitch(this,function(y){var J=this.source;if(J.current!=J.targetAnchor||J.before!=y){J.targetAnchor&&w(J.targetAnchor,J.before)&&J._removeItemClass(w(J.targetAnchor,J.before),J.before?"After":"Before");d.prototype._markTargetAnchor.call(J,
y);var M=y?J.targetAnchor:w(J.targetAnchor,J.before);y=0;M||(M=J.targetAnchor,y=n.contentBox(M).w+this.arrowDim.w/2+2);M=n.position(M,!0);y=Math.floor(M.x-this.arrowDim.w/2+y);n.style(this.bottomMarker,"visibility","visible");n.style(this.topMarker,"visibility","visible");n.style(this.bottomMarker,{left:y+"px",top:G+M.y+"px"});n.style(this.topMarker,{left:y+"px",top:M.y-this.arrowDim.h+"px"});J.targetAnchor&&w(J.targetAnchor,J.before)&&J._addItemClass(w(J.targetAnchor,J.before),J.before?"After":"Before")}}),
_unmarkTargetAnchor:f.hitch(this,function(){var y=this.source;y.targetAnchor&&(y.targetAnchor&&w(y.targetAnchor,y.before)&&y._removeItemClass(w(y.targetAnchor,y.before),y.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),d.prototype._unmarkTargetAnchor.call(y))}),destroy:f.hitch(this,function(){t.disconnect(this._source_conn);t.unsubscribe(this._source_sub);d.prototype.destroy.call(this.source);this.bottomMarker&&(n.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(n.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:f.hitch(this,function(){d.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=t.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=t.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(r){n.style(r,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(r,w,G){u.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,w=this.grid.views.views,r=w[r.viewIndex],w=w[this.index],w!=r&&(r.convertColPctToFixed(),w.convertColPctToFixed()))},_onDndDrop:function(r,w,G){if(u.manager().target!==this.source)u.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);G=function(W){return W?n.attr(W,"idx"):null};var y=n.marginBox(w[0]).w;if(r.viewIndex!==this.index){var J=
this.grid.views.views,M=J[r.viewIndex];J=J[this.index];M.viewWidth&&"auto"!=M.viewWidth&&M.setColumnsWidth(M.getColumnsWidth()-y);J.viewWidth&&"auto"!=J.viewWidth&&J.setColumnsWidth(J.getColumnsWidth())}y=this.source._targetNode;M=this.source._beforeTarget;!this.grid.isLeftToRight()&&(M=!M);J=this.grid.layout;var ba=this.index;delete this.source._targetNode;delete this.source._beforeTarget;J.moveColumn(r.viewIndex,ba,G(w[0]),G(y),M)}},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);l.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(r){var w=r.name||r.grid.getCellName(r);/^\s+$/.test(w)&&(w="\x26nbsp;");var G=['\x3cdiv class\x3d"dojoxGridSortNode'];r.index!=r.grid.getSortIndex()?G.push('"\x3e'):G=G.concat([" ",0<r.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',
0<r.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);G=G.concat([w,"\x3c/div\x3e\x3c/div\x3e"]);return G.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(r){var w=this._hasHScroll||!1;if(void 0==this._hasHScroll||r)this.noscroll?this._hasHScroll=!1:(r=n.style(this.scrollboxNode,"overflow"),this._hasHScroll="hidden"==r?!1:"scroll"==
r?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);w!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(r){var w=this._hasVScroll||!1;if(void 0==this._hasVScroll||r)this.noscroll?this._hasVScroll=!1:(r=n.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==r?!1:"scroll"==r?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);w!==this._hasVScroll&&this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var r=
!1;this.grid.initialWidth="";var w=v("th",this.headerContentNode),G=g.map(w,function(y,J){var M=y.style.width;n.attr(y,"vIdx",J);if(M&&"%"==M.slice(-1))r=!0;else if(M&&"px"==M.slice(-2))return window.parseInt(M,10);return n.contentBox(y).w});return r?(g.forEach(this.grid.layout.cells,function(y,J){if(y.view==this&&(y=y.view.getHeaderCellNode(y.index))&&n.hasAttr(y,"vIdx")){var M=window.parseInt(n.attr(y,"vIdx"));this.setColWidth(J,G[M]);n.removeAttr(y,"vIdx")}},this),!0):!1},adaptHeight:function(r){if(!this.grid._autoHeight){var w=
this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!r&&(r=this.noscroll))a:{for(var G=0;G<this.grid.views.views.length;++G)if(r=this.grid.views.views[G],r!==this&&r.hasHScrollbar()){r=!0;break a}r=!1}r&&(w-=m.getScrollbar().h);l.setStyleHeightPx(this.scrollboxNode,w)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var r=
this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(r=Math.min(r,this.getColumnsWidth())+"px",this._removingColumn=!1):r=Math.max(r,this.getColumnsWidth())+"px";this.contentNode.style.width=r;this.hasHScrollbar(!0)},setSize:function(r,w){var G=this.domNode.style,y=this.headerNode.style;r&&(G.width=r,y.width=r);G.height=0<=w?w+"px":""},renderRow:function(r){var w=this.createRowNode(r);this.buildRow(r,w);return w},createRowNode:function(r){var w=document.createElement("div");
w.className=this.classTag+"Row";this instanceof F.grid._RowSelector?n.attr(w,"role","presentation"):(n.attr(w,"role","row"),"none"!=this.grid.selectionMode&&w.setAttribute("aria-selected","false"));w[l.gridViewTag]=this.id;w[l.rowIndexTag]=r;return this.rowNodes[r]=w},buildRow:function(r,w){this.buildRowContent(r,w);this.styleRow(r,w)},buildRowContent:function(r,w){w.innerHTML=this.content.generateHtml(r,r);this.flexCells&&this.contentWidth&&(w.firstChild.style.width=this.contentWidth);l.fire(this,
"onAfterRow",[r,this.structure.cells,w])},rowRemoved:function(r){0<=r&&this._cleanupRowWidgets(this.getRowNode(r));this.grid.edit.save(this,r);delete this.rowNodes[r]},getRowNode:function(r){return this.rowNodes[r]},getCellNode:function(r,w){if(r=this.getRowNode(r))return this.content.getCellNode(r,w)},getHeaderCellNode:function(r){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,r)},styleRow:function(r,w){var G=void 0==w.style.cssText?w.getAttribute("style"):w.style.cssText;
w._style=G;this.styleRowNode(r,w)},styleRowNode:function(r,w){w&&this.doStyleRowNode(r,w)},doStyleRowNode:function(r,w){this.grid.styleRowNode(r,w)},updateRow:function(r){var w=this.getRowNode(r);w&&(w.style.height="",this.buildRow(r,w));return w},updateRowStyles:function(r){this.styleRowNode(r,this.getRowNode(r))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(r){if(13<=c("ff")||c("chrome"))this._nativeScroll=!0;r=this.grid.isLeftToRight();if(2>this.firstScroll){if(!r&&1==this.firstScroll||
r&&0===this.firstScroll){var w=n.marginBox(this.headerNodeContainer);c("ie")?this.headerNodeContainer.style.width=w.w+this.getScrollbarWidth()+"px":c("mozilla")&&(this.headerNodeContainer.style.width=w.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=r?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;r=this.scrollboxNode.scrollTop;r!==
this.lastTop&&this.grid.scrollTo(r);this._nativeScroll=!1},setScrollTop:function(r){this.lastTop=r;this._nativeScroll||(this.scrollboxNode.scrollTop=r);return this.scrollboxNode.scrollTop},doContentEvent:function(r){if(this.content.decorateEvent(r))this.grid.onContentEvent(r)},doHeaderEvent:function(r){if(this.header.decorateEvent(r))this.grid.onHeaderEvent(r)},dispatchContentEvent:function(r){return this.content.dispatchEvent(r)},dispatchHeaderEvent:function(r){return this.header.dispatchEvent(r)},
setColWidth:function(r,w){this.grid.setCellWidth(r,w+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var r=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=r;this.headerNode.scrollLeft=r}}});var B=D("dojox.grid._GridAvatar",x,{construct:function(){var r=q.doc,w=r.createElement("table");w.cellPadding=w.cellSpacing="0";w.className="dojoxGridDndAvatar";w.style.position="absolute";w.style.zIndex=1999;w.style.margin="0px";var G=r.createElement("tbody"),y=r.createElement("tr"),
J=r.createElement("td"),M=r.createElement("td");y.className="dojoxGridDndAvatarItem";M.className="dojoxGridDndAvatarItemImage";M.style.width="16px";var ba=this.manager.source;if(ba.creator)ba=ba._normalizedCreator(ba.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(ba=this.manager.nodes[0].cloneNode(!0),"tr"==ba.tagName.toLowerCase()){var W=r.createElement("table");var E=r.createElement("tbody");E.appendChild(ba);W.appendChild(E);ba=W}else"th"==ba.tagName.toLowerCase()&&(W=r.createElement("table"),
E=r.createElement("tbody"),r=r.createElement("tr"),W.cellPadding=W.cellSpacing="0",r.appendChild(ba),E.appendChild(r),W.appendChild(E),ba=W);ba.id="";J.appendChild(ba);y.appendChild(M);y.appendChild(J);n.style(y,"opacity",.9);G.appendChild(y);w.appendChild(G);this.node=w;w=u.manager();this.oldOffsetY=w.OFFSET_Y;w.OFFSET_Y=1},destroy:function(){u.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),h=u.manager().makeAvatar;u.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
n.hasClass(q.body(),"dijit_a11y")?h.call(u.manager()):new B(this)};return e})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(N,A,F,D,g,f,t){var c=A.getObject("dojox.html.metrics",!0),v=A.getObject("dojox");c.getFontMeasurements=function(){var m={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(F("ie")){var l=
f.doc.documentElement.style.fontSize||"";l||(f.doc.documentElement.style.fontSize="100%")}var n=f.doc.createElement("div"),k=n.style;k.position="absolute";k.left="-100px";k.top="0";k.width="30px";k.height="1000em";k.borderWidth="0";k.margin="0";k.padding="0";k.outline="0";k.lineHeight="1";k.overflow="hidden";f.body().appendChild(n);for(var x in m)k.fontSize=x,m[x]=16*Math.round(12*n.offsetHeight/16)/12/1E3;F("ie")&&(f.doc.documentElement.style.fontSize=l);f.body().removeChild(n);n=null;return m};
var q=null;c.getCachedFontMeasurements=function(m){if(m||!q)q=c.getFontMeasurements();return q};var e=null,d={};c.getTextBox=function(m,l,n){if(e)var k=e;else{k=e=f.doc.createElement("div");k.style.whiteSpace="nowrap";var x=f.doc.createElement("div");x.appendChild(k);var u=x.style;u.overflow="scroll";u.position="absolute";u.left="0px";u.top="-10000px";u.width="1px";u.height="1px";u.visibility="hidden";u.borderWidth="0";u.margin="0";u.padding="0";u.outline="0";f.body().appendChild(x)}k.className="";
u=k.style;u.borderWidth="0";u.margin="0";u.padding="0";u.outline="0";if(1<arguments.length&&l)for(var B in l)B in d||(u[B]=l[B]);2<arguments.length&&n&&(k.className=n);k.innerHTML=m;u=t.position(k);u.w=k.parentNode.scrollWidth;return u};var b=16,a=16;c.getScrollbar=function(){return{w:b,h:a}};c._fontResizeNode=null;c.initOnFontResize=function(m){var l=c._fontResizeNode=f.doc.createElement("iframe");m=l.style;m.position="absolute";m.width="5em";m.height="10em";m.top="-10000px";m.display="none";F("ie")?
l.onreadystatechange=function(){"complete"==l.contentWindow.document.readyState&&(l.onresize=l.contentWindow.parent[v._scopeName].html.metrics._fontresize)}:l.onload=function(){l.contentWindow.onresize=l.contentWindow.parent[v._scopeName].html.metrics._fontresize};l.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");f.body().appendChild(l);c.initOnFontResize=
function(){}};c.onFontResize=function(){};c._fontresize=function(){c.onFontResize()};g.addOnUnload(function(){var m=c._fontResizeNode;m&&(F("ie")&&m.onresize?m.onresize=null:m.contentWindow&&m.contentWindow.onresize&&(m.contentWindow.onresize=null),c._fontResizeNode=null)});D(function(){try{var m=f.doc.createElement("div");m.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";f.body().appendChild(m);b=m.offsetWidth-m.clientWidth;a=m.offsetHeight-
m.clientHeight;f.body().removeChild(m);delete m}catch(l){}"fontSizeWatch"in N.config&&N.config.fontSizeWatch&&c.initOnFontResize()});return c})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d){var b=N.grid,a=function(h){return 0<=h.rowIndex?h.rowIndex:A.indexOf(h.parentNode.childNodes,
h)},m=function(h,r){return h&&((h.rows||0)[r]||h.childNodes[r])},l=function(h){for(;h&&"TABLE"!=h.tagName;h=h.parentNode);return h},n=function(h){var r=h.toUpperCase();return function(w){return w.tagName!=r}},k=q.rowIndexTag,x=q.gridViewTag,u=b._Builder=F.extend(function(h){h&&(this.view=h,this.grid=h.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var h=[this._table];this.view.viewWidth&&
h.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));h.push("\x3e");return h},generateCellMarkup:function(h,r,w,G){var y=[];if(G){var J=h.index!=h.grid.getSortIndex()?"":0<h.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';h.id||(h.id=this.grid.id+"Hdr"+h.index);J=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',J,' id\x3d"',h.id,'"']}else J=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&!h.editable?'aria-readonly\x3d"true"':
""];h.colSpan&&J.push(' colspan\x3d"',h.colSpan,'"');h.rowSpan&&J.push(' rowspan\x3d"',h.rowSpan,'"');J.push(' class\x3d"dojoxGridCell ');h.classes&&J.push(h.classes," ");w&&J.push(w," ");y.push(J.join(""));y.push("");J=['" idx\x3d"',h.index,'" style\x3d"'];r&&";"!=r[r.length-1]&&(r+=";");J.push(h.styles,r||"",h.hidden?"display:none;":"");h.unitWidth&&J.push("width:",h.unitWidth,";");y.push(J.join(""));y.push("");J=['"'];h.attrs&&J.push(" ",h.attrs);J.push("\x3e");y.push(J.join(""));y.push("");y.push(G?
"\x3c/th\x3e":"\x3c/td\x3e");return y},isCellNode:function(h){return!(!h||h==D.doc||!e.attr(h,"idx"))},getCellNodeIndex:function(h){return h?Number(e.attr(h,"idx")):-1},getCellNode:function(h,r){for(var w=0,G;(G=m(h.firstChild,w))&&G.cells;w++)for(var y=0,J;J=G.cells[y];y++)if(this.getCellNodeIndex(J)==r)return J;return null},findCellTarget:function(h,r){for(;h&&(!this.isCellNode(h)||h.offsetParent&&x in h.offsetParent.parentNode&&h.offsetParent.parentNode[x]!=this.view.id)&&h!=r;)h=h.parentNode;
return h!=r?h:null},baseDecorateEvent:function(h){h.dispatch="do"+h.type;h.grid=this.grid;h.sourceView=this.view;h.cellNode=this.findCellTarget(h.target,h.rowNode);h.cellIndex=this.getCellNodeIndex(h.cellNode);h.cell=0<=h.cellIndex?this.grid.getCell(h.cellIndex):null},findTarget:function(h,r){for(;h&&h!=this.domNode&&(!(r in h)||x in h&&h[x]!=this.view.id);)h=h.parentNode;return h!=this.domNode?h:null},findRowTarget:function(h){return this.findTarget(h,k)},isIntraNodeEvent:function(h){try{return h.cellNode&&
h.relatedTarget&&e.isDescendant(h.relatedTarget,h.cellNode)}catch(r){return!1}},isIntraRowEvent:function(h){try{var r=h.relatedTarget&&this.findRowTarget(h.relatedTarget);return!r&&-1==h.rowIndex||r&&h.rowIndex==r.gridRowIndex}catch(w){return!1}},dispatchEvent:function(h){return h.dispatch in this?this[h.dispatch](h):!1},domouseover:function(h){h.cellNode&&h.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=h.cellNode,this.grid.onMouseOver(h));this.grid.onMouseOverRow(h)},domouseout:function(h){if(h.cellNode&&
h.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(h,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(h),!this.isIntraRowEvent(h)))this.grid.onMouseOutRow(h)},domousedown:function(h){if(h.cellNode)this.grid.onMouseDown(h);this.grid.onMouseDownRow(h)},_getTextDirStyle:function(h,r,w){return""}});N=b._ContentBuilder=F.extend(function(h){u.call(this,h)},u.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var h=this.grid.get,r=this.view.structure.cells,
w=0,G;G=r[w];w++)for(var y=0,J;J=G[y];y++)J.get=J.get||void 0==J.value&&h,J.markup=this.generateCellMarkup(J,J.cellStyles,J.cellClasses,!1),!this.grid.editable&&J.editable&&(this.grid.editable=!0)},generateHtml:function(h,r){h=this.getTableArray();var w=this.view.structure.cells,G=this.grid.getItem(r);q.fire(this.view,"onBeforeRow",[r,w]);for(var y=0,J;J=w[y];y++)if(!J.hidden&&!J.header){h.push(J.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var M=0,ba,W,E;ba=J[M];M++){W=
ba.markup;var O=ba.customClasses=[];E=ba.customStyles=[];W[5]=ba.format(r,G);W[1]=O.join(" ");W[3]=E.join(";");(O=ba.textDir||this.grid.textDir)&&(W[3]+=this._getTextDirStyle(O,ba,r));h.push.apply(h,W)}h.push("\x3c/tr\x3e")}h.push("\x3c/table\x3e");return h.join("")},decorateEvent:function(h){h.rowNode=this.findRowTarget(h.target);if(!h.rowNode)return!1;h.rowIndex=h.rowNode[k];this.baseDecorateEvent(h);h.cell=this.grid.getCell(h.cellIndex);return!0}});var B=b._HeaderBuilder=F.extend(function(h){this.moveable=
null;u.call(this,h)},u.prototype,{_skipBogusClicks:!1,overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new b._TableMap(this.view.structure.cells)},generateHtml:function(h,r){var w,G=this.getTableArray(),y=this.view.structure.cells;q.fire(this.view,"onBeforeRow",[-1,y]);for(var J=0,M;M=y[J];J++)if(!M.hidden){G.push(M.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var ba=0,W,E;W=M[ba];ba++)W.customClasses=
[],W.customStyles=[],this.view.simpleStructure&&(W.draggable&&(W.headerClasses?-1==W.headerClasses.indexOf("dojoDndItem")&&(W.headerClasses+=" dojoDndItem"):W.headerClasses="dojoDndItem"),W.attrs?-1==W.attrs.indexOf("dndType\x3d'gridColumn_")&&(W.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):W.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),E=this.generateCellMarkup(W,W.headerStyles,W.headerClasses,!0),E[5]=void 0!=r?r:h(W),E[3]=W.customStyles.join(";"),(w=W.textDir||this.grid.textDir)&&(E[3]+=
this._getTextDirStyle(w,W,r)),E[1]=W.customClasses.join(" "),G.push(E.join(""));G.push("\x3c/tr\x3e")}G.push("\x3c/table\x3e");return G.join("")},getCellX:function(h){var r=n("th");for(var w=h.target;w&&r(w);w=w.parentNode);(r=w)?(r=d.position(r),h=h.clientX-r.x):h=h.layerX;return h},decorateEvent:function(h){this.baseDecorateEvent(h);h.rowIndex=-1;h.cellX=this.getCellX(h);return!0},prepareResize:function(h,r){do{var w=h.cellIndex;h.cellNode=w?h.cellNode.parentNode.cells[w+r]:null;h.cellIndex=h.cellNode?
this.getCellNodeIndex(h.cellNode):-1}while(h.cellNode&&"none"==h.cellNode.style.display);return!!h.cellNode},canResize:function(h){if(!h.cellNode||1<h.cellNode.colSpan)return!1;h=this.grid.getCell(h.cellIndex);return!h.noresize&&h.canResize()},overLeftResizeArea:function(h){if(e.hasClass(D.body(),"dojoDndMove"))return!1;if(f("ie")){var r=h.target;if(e.hasClass(r,"dojoxGridArrowButtonNode")||e.hasClass(r,"dojoxGridArrowButtonChar")||e.hasClass(r,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?
0<h.cellIndex&&0<h.cellX&&h.cellX<this.overResizeWidth&&this.prepareResize(h,-1):h.cellNode&&0<h.cellX&&h.cellX<this.overResizeWidth},overRightResizeArea:function(h){if(e.hasClass(D.body(),"dojoDndMove"))return!1;if(f("ie")){var r=h.target;if(e.hasClass(r,"dojoxGridArrowButtonNode")||e.hasClass(r,"dojoxGridArrowButtonChar")||e.hasClass(r,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?h.cellNode&&h.cellX>=h.cellNode.offsetWidth-this.overResizeWidth:0<h.cellIndex&&h.cellX>=h.cellNode.offsetWidth-
this.overResizeWidth&&this.prepareResize(h,-1)},domousemove:function(h){if(!this.moveable){var r=this.overRightResizeArea(h)?"dojoxGridColResize":this.overLeftResizeArea(h)?"dojoxGridColResize":"";r&&!this.canResize(h)&&(r="dojoxGridColNoResize");e.toggleClass(h.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==r);e.toggleClass(h.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==r);r&&g.stop(h)}},domousedown:function(h){this.moveable||((this.overRightResizeArea(h)||
this.overLeftResizeArea(h))&&this.canResize(h)?this.beginColumnResize(h):(this.grid.onMouseDown(h),this.grid.onMouseOverRow(h)))},doclick:function(h){return this._skipBogusClicks?(g.stop(h),!0):!1},colResizeSetup:function(h,r){var w=e.contentBox(h.sourceView.headerNode);if(r){this.lineDiv=document.createElement("div");r=e.position(h.sourceView.headerNode,!0);var G=e.contentBox(h.sourceView.domNode),y=h.pageX;!this.grid.isLeftToRight()&&8>f("ie")&&(y-=v.getScrollbar().w);e.style(this.lineDiv,{top:r.y+
"px",left:y+"px",height:G.h+w.h+"px"});e.addClass(this.lineDiv,"dojoxGridResizeColLine");this.lineDiv._origLeft=y;D.body().appendChild(this.lineDiv)}r=[];G=this.tableMap.findOverlappingNodes(h.cellNode);y=0;for(var J;J=G[y];y++)r.push({node:J,index:this.getCellNodeIndex(J),width:J.offsetWidth});G=h.sourceView;J=this.grid.isLeftToRight()?1:-1;var M=h.grid.views.views;y=[];for(var ba=G.idx+J,W;W=M[ba];ba+=J)y.push({node:W.headerNode,left:window.parseInt(W.headerNode.style.left)});J=G.headerContentNode.firstChild;
return{scrollLeft:h.sourceView.headerNode.scrollLeft,view:G,node:h.cellNode,index:h.cellIndex,w:e.contentBox(h.cellNode).w,vw:w.w,table:J,tw:e.contentBox(J).w,spanners:r,followers:y}},beginColumnResize:function(h){this.moverDiv=document.createElement("div");e.style(this.moverDiv,{position:"absolute",left:0});D.body().appendChild(this.moverDiv);e.addClass(this.grid.domNode,"dojoxGridColumnResizing");var r=this.moveable=new c(this.moverDiv),w=this.colResizeSetup(h,!0);r.onMove=F.hitch(this,"doResizeColumn",
w);t.connect(r,"onMoveStop",F.hitch(this,function(){this.endResizeColumn(w);w.node.releaseCapture&&w.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;e.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));h.cellNode.setCapture&&h.cellNode.setCapture();r.onMouseDown(h)},doResizeColumn:function(h,r,w){var G=w.l;G={deltaX:G,w:h.w+(this.grid.isLeftToRight()?G:-G),vw:h.vw+G,tw:h.tw+G};this.dragRecord={inDrag:h,mover:r,leftTop:w};G.w>=this.minColWidth&&(r?e.style(this.lineDiv,
"left",this.lineDiv._origLeft+G.deltaX+"px"):this.doResizeNow(h,G))},endResizeColumn:function(h){if(this.dragRecord){var r=this.dragRecord.leftTop;r=this.grid.isLeftToRight()?r.l:-r.l;r+=Math.max(h.w+r,this.minColWidth)-(h.w+r);f("webkit")&&h.spanners.length&&(r+=e._getPadBorderExtents(h.spanners[0].node).w);this.doResizeNow(h,{deltaX:r,w:h.w+r,vw:h.vw+r,tw:h.tw+r});delete this.dragRecord}e.destroy(this.lineDiv);e.destroy(this.moverDiv);e.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=
!0;h.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(h.index)},doResizeNow:function(h,r){h.view.convertColPctToFixed();if(h.view.flexCells&&!h.view.testFlexCells()){var w=l(h.node);w&&(w.style.width="")}var G;for(w=0;G=h.spanners[w];w++){var y=G.width+r.deltaX;0<y&&(G.node.style.width=y+"px",h.view.setColWidth(G.index,y))}if(this.grid.isLeftToRight()||!f("ie"))for(w=0;G=h.followers[w];w++)y=G.left+r.deltaX,G.node.style.left=y+"px";h.node.style.width=r.w+"px";h.view.setColWidth(h.index,
r.w);h.view.headerNode.style.width=r.vw+"px";h.view.setColumnsWidth(r.tw);this.grid.isLeftToRight()||(h.view.headerNode.scrollLeft=h.scrollLeft+r.deltaX)}});b._TableMap=F.extend(function(h){this.mapRows(h)},{map:null,mapRows:function(h){if(h.length){this.map=[];for(var r,w=0;r=h[w];w++)this.map[w]=[];for(w=0;r=h[w];w++)for(var G=0,y=0,J,M;J=r[G];G++){for(;this.map[w][y];)y++;this.map[w][y]={c:G,r:w};M=J.rowSpan||1;J=J.colSpan||1;for(var ba=0;ba<M;ba++)for(var W=0;W<J;W++)this.map[w+ba][y+W]=this.map[w][y];
y+=J}}},dumpMap:function(){for(var h=0,r;r=this.map[h];h++)for(var w=0;r[w];w++);},getMapCoords:function(h,r){for(var w=0,G;G=this.map[w];w++)for(var y=0,J;J=G[y];y++)if(J.c==r&&J.r==h)return{j:w,i:y};return{j:-1,i:-1}},getNode:function(h,r,w){return(h=h&&h.rows[r])&&h.cells[w]},_findOverlappingNodes:function(h,r,w){var G=[];r=this.getMapCoords(r,w);w=0;for(var y;y=this.map[w];w++)w!=r.j&&(y=(y=y[r.i])?this.getNode(h,y.r,y.c):null)&&G.push(y);return G},findOverlappingNodes:function(h){return this._findOverlappingNodes(l(h),
a(h.parentNode),0<=h.cellIndex?h.cellIndex:A.indexOf(h.parentNode.cells,h))}});return{_Builder:u,_HeaderBuilder:B,_ContentBuilder:N}})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(N,A,F){return N("dojox.grid._ViewManager",null,{constructor:function(D){this.grid=D},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(D){D.idx=this.views.length;this.views.push(D)},
destroyViews:function(){for(var D=0,g;g=this.views[D];D++)g.destroy();this.views=[]},getContentNodes:function(){for(var D=[],g=0,f;f=this.views[g];g++)D.push(f.contentNode);return D},forEach:function(D){for(var g=0,f;f=this.views[g];g++)D(f,g)},onEach:function(D,g){g=g||[];for(var f=0,t;t=this.views[f];f++)D in t&&t[D].apply(t,g)},normalizeHeaderNodeHeight:function(){for(var D=[],g=0,f;f=this.views[g];g++)f.headerContentNode.firstChild&&D.push(f.headerContentNode);this.normalizeRowNodeHeights(D)},
normalizeRowNodeHeights:function(D){var g=0,f=[];if(this.grid.rowHeight)g=this.grid.rowHeight;else{if(1>=D.length)return;for(var t=0,c;c=D[t];t++)F.contains(c,"dojoxGridNonNormalizedCell")||(f[t]=c.firstChild.offsetHeight,g=Math.max(g,f[t]));g=0<=g?g:0;(A("mozilla")||8<A("ie"))&&g&&g++}for(t=0;c=D[t];t++)f[t]!=g&&(c.firstChild.style.height=g+"px")},resetHeaderNodeHeight:function(){for(var D=0,g;g=this.views[D];D++)if(g=g.headerContentNode.firstChild)g.style.height=""},renormalizeRow:function(D){for(var g=
[],f=0,t,c;(t=this.views[f])&&(c=t.getRowNode(D));f++)c.firstChild.style.height="",g.push(c);this.normalizeRowNodeHeights(g)},getViewWidth:function(D){return this.views[D].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();this.forEach(function(g){g.headerContentNode.style.height=""});var D=0;this.forEach(function(g){D=Math.max(g.headerNode.offsetHeight,D)});return D},measureContent:function(){var D=0;this.forEach(function(g){D=Math.max(g.domNode.offsetHeight,D)});
return D},findClient:function(D){D=this.grid.elasticView||-1;if(0>D)for(var g=1,f;f=this.views[g];g++)if(f.viewWidth){for(g=1;f=this.views[g];g++)if(!f.viewWidth){D=g;break}break}0>D&&(D=Math.floor(this.views.length/2));return D},arrange:function(D,g){var f,t,c=this.views.length,v=this,q=0>=g?c:this.findClient(),e=function(a,m){var l=a.domNode.style,n=a.headerNode.style;v.grid.isLeftToRight()?(l.left=m+"px",n.left=m+"px"):(l.right=m+"px",4>A("ff")?n.right=m+a.getScrollbarWidth()+"px":n.right=m+"px",
A("webkit")||"auto"==n.width||(n.width=parseInt(n.width,10)-a.getScrollbarWidth()+"px"));l.top="0px";n.top=0};for(f=0;(t=this.views[f])&&f<q;f++){var d=this.getViewWidth(f);t.setSize(d,0);e(t,D);d=t.headerContentNode&&t.headerContentNode.firstChild?t.getColumnsWidth()+t.getScrollbarWidth():t.domNode.offsetWidth;D+=d}f++;for(var b=c-1;(t=this.views[b])&&f<=b;b--)d=this.getViewWidth(b),t.setSize(d,0),d=t.domNode.offsetWidth,g-=d,e(t,g);q<c&&(t=this.views[q],d=Math.max(1,g-D),t.setSize(d+"px",0),e(t,
D));return D},renderRow:function(D,g,f){for(var t=[],c=0,v,q;(v=this.views[c])&&(q=g[c]);c++)v=v.renderRow(D),q.appendChild(v),t.push(v);f||this.normalizeRowNodeHeights(t)},rowRemoved:function(D){this.onEach("rowRemoved",[D])},updateRow:function(D,g){for(var f=0,t;t=this.views[f];f++)t.updateRow(D);g||this.renormalizeRow(D)},updateRowStyles:function(D){this.onEach("updateRowStyles",[D])},setScrollTop:function(D){for(var g=D,f=0,t;t=this.views[f];f++)g=t.setScrollTop(D),A("ie")&&t.headerNode&&t.scrollboxNode&&
(t.headerNode.scrollLeft=t.scrollboxNode.scrollLeft);return g},getFirstScrollingView:function(){for(var D=0,g;g=this.views[D];D++)if(g.hasHScrollbar()||g.hasVScrollbar())return g;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(N,A,F){return N("dojox.grid._RowManager",null,{constructor:function(D){this.grid=D},linesToEms:2,overRow:-2,prepareStylingRow:function(D,g){return{index:D,node:g,odd:!!(D&1),selected:!!this.grid.selection.isSelected(D),
over:this.isOver(D),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(D,g){D=this.prepareStylingRow(D,g);this.grid.onStyleRow(D);this.applyStyles(D)},applyStyles:function(D){D.node.className=D.customClasses;var g=D.node.style.height,f=D.node,t=D.customStyles+";"+(D.node._style||"");void 0==f.style.cssText?f.setAttribute("style",t):f.style.cssText=t;D.node.style.height=g},updateStyles:function(D){this.grid.updateRowStyles(D)},setOverRow:function(D){var g=this.overRow;this.overRow=
D;g!=this.overRow&&(A.isString(g)||0<=g)&&this.updateStyles(g);this.updateStyles(this.overRow)},isOver:function(D){return this.overRow==D&&!F.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),function(N,A,F,D,g,f,t,c,v){return F("dojox.grid._FocusManager",null,{constructor:function(q){this.grid=
q;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(D.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(D.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(D.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(D.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));this._connects.push(D.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(D.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(D.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(D.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(D.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){N.forEach(this._connects,D.disconnect);N.forEach(this._headerConnects,D.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,
_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(q,e){return this.cell==q&&this.rowIndex==e},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===
this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?N.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(q){var e=this.cell&&this.cell.getNode(this.rowIndex);if(e&&(v.toggleClass(e,this.focusClass,q),q)){q=this.scrollIntoView();try{if(f("webkit")||!this.grid.edit.isEditing())c.fire(e,"focus"),q&&(this.cell.view.scrollboxNode.scrollLeft=
q)}catch(d){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var q=this.cell&&this.cell.getNode(this.rowIndex);if(q)try{this.grid.edit.isEditing()||(v.toggleClass(q,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),c.fire(q,"focus"))}catch(e){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){N.forEach(this._headerConnects,D.disconnect);this._headerConnects=[];for(var q=this._findHeaderCells(),e=0;e<q.length;e++)this._headerConnects.push(D.connect(q[e],
"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(D.connect(q[e],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var q=t("th",this.grid.viewsHeaderNode),e=[],d=0;d<q.length;d++){var b=q[d],a=v.hasAttr(b,"tabIndex"),m=v.attr(b,"tabIndex");a&&0>m&&e.push(b)}return e},_setActiveColHeader:function(q,e,d){this.grid.domNode.setAttribute("aria-activedescendant",q.id);null!=d&&0<=d&&d!=e&&v.toggleClass(this._findHeaderCells()[d],this.focusClass,!1);v.toggleClass(q,this.focusClass,
!0);this._colHeadNode=q;this._colHeadFocusIdx=e;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var q=this.cell?this._scrollInfo(this.cell):null;if(!q||!q.s)return null;var e=this.grid.scroller.findScrollTop(this.rowIndex);q.n&&q.sr&&(q.n.offsetLeft+q.n.offsetWidth>q.sr.l+q.sr.w?q.s.scrollLeft=q.n.offsetLeft+q.n.offsetWidth-q.sr.w:q.n.offsetLeft<q.sr.l&&(q.s.scrollLeft=q.n.offsetLeft));q.r&&q.sr&&(e+q.r.offsetHeight>q.sr.t+q.sr.h?this.grid.setScrollTop(e+q.r.offsetHeight-q.sr.h):
e<q.sr.t&&this.grid.setScrollTop(e));return q.s.scrollLeft},_scrollInfo:function(q,e){if(q){var d=q.view.scrollboxNode,b={w:d.clientWidth,l:d.scrollLeft,t:d.scrollTop,h:d.clientHeight},a=q.view.getRowNode(this.rowIndex);return{c:q,s:d,sr:b,n:e?e:q.getNode(this.rowIndex),r:a}}return null},_scrollHeader:function(q){var e=null;if(this._colHeadNode){var d=this.grid.getCell(q);if(!d)return;e=this._scrollInfo(d,d.getNode(0))}e&&e.s&&e.sr&&e.n&&(e.n.offsetLeft+e.n.offsetWidth>e.sr.l+e.sr.w?e.s.scrollLeft=
e.n.offsetLeft+e.n.offsetWidth-e.sr.w:e.n.offsetLeft<e.sr.l?e.s.scrollLeft=e.n.offsetLeft:7>=f("ie")&&d&&d.view.headerNode&&(d.view.headerNode.scrollLeft=e.s.scrollLeft))},_isHeaderHidden:function(){var q=this.focusView;if(!q)for(var e=0,d;d=this.grid.views.views[e];e++)if(d.headerNode){q=d;break}return q&&"none"==v.getComputedStyle(q.headerNode).display},colSizeAdjust:function(q,e,d){var b=this._findHeaderCells(),a=this.focusView;if(!a||!a.header.tableMap.map)for(var m=0,l;l=this.grid.views.views[m];m++)if(l.header.tableMap.map){a=
l;break}m=b[e];!a||e==b.length-1&&0===e||(a.content.baseDecorateEvent(q),q.cellNode=m,q.cellIndex=a.content.getCellNodeIndex(q.cellNode),q.cell=0<=q.cellIndex?this.grid.getCell(q.cellIndex):null,a.header.canResize(q)&&(e={l:d},q=a.header.colResizeSetup(q,!1),a.header.doResizeColumn(q,null,e),a.update()))},styleRow:function(q){},setFocusIndex:function(q,e){this.setFocusCell(this.grid.getCell(e),q)},setFocusCell:function(q,e){q&&!this.isFocusCell(q,e)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),
this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=q,this.rowIndex=e,this._focusifyCellNode(!0));if(f("opera"))setTimeout(A.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var q=this.rowIndex,e=this.cell.index+1,d=this.grid.layout.cellCount-1,b=this.grid.rowCount-1;e>d&&(e=0,q++);q>b&&(e=d,q=b);if(this.grid.edit.isEditing()&&(d=this.grid.getCell(e),!this.isLastFocusCell()&&
(!d.editable||this.grid.canEdit&&!this.grid.canEdit(d,q)))){this.cell=d;this.rowIndex=q;this.next();return}this.setFocusIndex(q,e)}},previous:function(){if(this.cell){var q=this.rowIndex||0,e=(this.cell.index||0)-1;0>e&&(e=this.grid.layout.cellCount-1,q--);0>q&&(e=q=0);if(this.grid.edit.isEditing()){var d=this.grid.getCell(e);if(!this.isFirstFocusCell()&&!d.editable){this.cell=d;this.rowIndex=q;this.previous();return}}this.setFocusIndex(q,e)}},move:function(q,e){var d=0>e?-1:1;if(this.isNavHeader()){q=
this._findHeaderCells();var b=currentIdx=N.indexOf(q,this._colHeadNode);for(currentIdx+=e;0<=currentIdx&&currentIdx<q.length&&"none"==q[currentIdx].style.display;)currentIdx+=d;0<=currentIdx&&currentIdx<q.length&&this._setActiveColHeader(q[currentIdx],currentIdx,b)}else if(this.cell){var a=this.grid.scroller;b=this.rowIndex;var m=this.grid.rowCount-1,l=Math.min(m,Math.max(0,b+q));q&&(0<q?l>a.getLastPageRow(a.page)&&this.grid.setScrollTop(this.grid.scrollTop+a.findScrollTop(l)-a.findScrollTop(b)):
0>q&&l<=a.getPageRow(a.page)&&this.grid.setScrollTop(this.grid.scrollTop-a.findScrollTop(b)-a.findScrollTop(l)));a=this.grid.layout.cellCount-1;for(var n=this.cell.index,k=Math.min(a,Math.max(0,n+e)),x=this.grid.getCell(k);0<=k&&k<a&&x&&!0===x.hidden;)k+=d,x=this.grid.getCell(k);x&&!0!==x.hidden||(k=n);d=x.getNode(l);!d&&q?0<=l+q&&l+q<=m&&this.move(0<q?++q:--q,e):d&&"none"!==v.style(d,"display")||!e?(this.setFocusIndex(l,k),q&&this.grid.updateRow(b)):0<=k+e&&k+e<=a&&this.move(q,0<e?++e:--e)}},previousKey:function(q){this.grid.edit.isEditing()?
(g.stop(q),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(v.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),g.stop(q))},nextKey:function(q){q.target===this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),g.stop(q)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),
this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(g.stop(q),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(q){this.tabbingOut=!0;q.focus()},focusGridView:function(){c.fire(this.focusView,"focus")},focusGrid:function(q){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var q=!0,e=0===this.grid.rowCount;this.isNoFocusCell()&&!e?(e=0,this.grid.getCell(e).hidden&&(e=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,
e)):this.cell&&!e?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):q=!1;this._colHeadNode=this._colHeadFocusIdx=null;return q},focusHeader:function(){var q=this._findHeaderCells(),e=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=q[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&
this._colHeadFocusIdx<q.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=q[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,e),this._scrollHeader(this._colHeadFocusIdx),
this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){v.removeClass(this._colHeadNode,this.focusClass);v.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var q=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(q);this._contextMenuBindNode=q}},doFocus:function(q){q&&q.target!=q.currentTarget?g.stop(q):this._clickFocus||(this.tabbingOut||this.focusHeader(),
this.tabbingOut=!1,g.stop(q))},doBlur:function(q){g.stop(q)},doContextMenu:function(q){this.headerMenu||g.stop(q)},doLastNodeFocus:function(q){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;g.stop(q)},doLastNodeBlur:function(q){g.stop(q)},doColHeaderFocus:function(q){this._setActiveColHeader(q.target,v.attr(q.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());
g.stop(q)},doColHeaderBlur:function(q){v.toggleClass(q.target,this.focusClass,!1)},_mouseDown:function(q){this._clickFocus=dojo.some(this.grid.views.views,function(e){return e.scrollboxNode===q.target})},_mouseUp:function(q){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),function(N,A,F,D,g,f){return F("dojox.grid._EditManager",null,{constructor:function(t){this.grid=t;
this.connections=g("ie")?[D.connect(document.body,"onfocus",N.hitch(this,"_boomerangFocus"))]:[];this.connections.push(D.connect(this.grid,"onBlur",this,"apply"));this.connections.push(D.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){A.forEach(this.connections,D.disconnect)},cellFocus:function(t,c){this.grid.singleClickEdit||this.isEditRow(c)?this.setEditCell(t,c):this.apply();(this.isEditing()||t&&t.editable&&t.alwaysEditing)&&this._focusEditor(t,c)},rowClick:function(t){this.isEditing()&&
!this.isEditRow(t.rowIndex)&&this.apply()},styleRow:function(t){t.index==this.info.rowIndex&&(t.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(t){var c=t.cell;return(c=c&&c.editable?c:0)&&c.dispatchEvent(t.dispatch,t)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(t,c){return this.info.rowIndex===t&&this.info.cell.index==c},isEditRow:function(t){return this.info.rowIndex===t},setEditCell:function(t,c){!this.isEditCell(c,t.index)&&this.grid.canEdit&&this.grid.canEdit(t,
c)&&this.start(t,c,this.isEditRow(c)||t.editable)},_focusEditor:function(t,c){f.fire(t,"focus",[c])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){g("ie")&&(this._catchBoomerang=(new Date).getTime()+
this._boomerangWindow)},start:function(t,c,v){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(c)&&(this.applyRowEdit(),this.grid.updateRow(c)),v?(this.info={cell:t,rowIndex:c},this.grid.doStartEdit(t,c),this.grid.updateRow(c)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(t,c),this._doCatchBoomerang())},_editorDo:function(t){var c=this.info.cell;if(c&&c.editable)c[t](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},
editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(t,c,v){this.grid.canEdit(c,v)&&this.grid.doApplyCellEdit(t,v,c.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),
this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(t,c){var v=this.info.cell;!this.isEditRow(t)||c&&v.view!=c||!v.editable||v.save(v,this.info.rowIndex)},restore:function(t,c){var v=this.info.cell;this.isEditRow(c)&&v.view==t&&v.editable&&v.restore(this.info.rowIndex)},_isValidInput:function(){var t=(this.info.cell||{}).widget;if(!t||!t.isValid)return!0;t.focused=!0;return t.isValid(!0)},_onPreRender:function(){this.isEditing()&&
(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(N,A,F,D){return N("dojox.grid.Selection",null,{constructor:function(g){this.grid=g;this.selected=[];this.setMode(g.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(g){this.selected.length&&this.deselectAll();this.mode="extended"!=g&&"multiple"!=g&&"single"!=g&&"none"!=
g?"extended":g},onCanSelect:function(g){return this.grid.onCanSelect(g)},onCanDeselect:function(g){return this.grid.onCanDeselect(g)},onSelected:function(g){},onDeselected:function(g){},onChanging:function(){},onChanged:function(){},isSelected:function(g){return"none"==this.mode?!1:this.selected[g]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var g=0,f=this.selected.length;g<f;g++)if(this.selected[g])return g;return-1},getNextSelected:function(g){if("none"==
this.mode)return-1;g+=1;for(var f=this.selected.length;g<f;g++)if(this.selected[g])return g;return-1},getSelected:function(){for(var g=[],f=0,t=this.selected.length;f<t;f++)this.selected[f]&&g.push(f);return g},getSelectedCount:function(){for(var g=0,f=0;f<this.selected.length;f++)this.selected[f]&&g++;return g},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},select:function(g){"none"!=this.mode&&
("multiple"!=this.mode?(this.deselectAll(g),this.addToSelection(g)):this.toggleSelect(g))},addToSelection:function(g){if("none"!=this.mode)if(F.isArray(g))A.forEach(g,this.addToSelection,this);else if(g=Number(g),this.selected[g])this.selectedIndex=g;else if(!1!==this.onCanSelect(g)){this.selectedIndex=g;var f=this.grid.getRowNode(g);f&&D.set(f,"aria-selected","true");this._beginUpdate();this.selected[g]=!0;this.onSelected(g);this._endUpdate()}},deselect:function(g){if("none"!=this.mode)if(F.isArray(g))A.forEach(g,
this.deselect,this);else if(g=Number(g),this.selectedIndex==g&&(this.selectedIndex=-1),this.selected[g]&&!1!==this.onCanDeselect(g)){var f=this.grid.getRowNode(g);f&&D.set(f,"aria-selected","false");this._beginUpdate();delete this.selected[g];this.onDeselected(g);this._endUpdate()}},setSelected:function(g,f){this[f?"addToSelection":"deselect"](g)},toggleSelect:function(g){F.isArray(g)?A.forEach(g,this.toggleSelect,this):this.setSelected(g,!this.selected[g])},_range:function(g,f,t){var c=0<=g?g:f;
g=f;c>g&&(g=c,c=f);for(f=c;f<=g;f++)t(f)},selectRange:function(g,f){this._range(g,f,F.hitch(this,"addToSelection"))},deselectRange:function(g,f){this._range(g,f,F.hitch(this,"deselect"))},insert:function(g){this.selected.splice(g,0,!1);this.selectedIndex>=g&&this.selectedIndex++},remove:function(g){this.selected.splice(g,1);this.selectedIndex>=g&&this.selectedIndex--},deselectAll:function(g){for(var f in this.selected)f!=g&&!0===this.selected[f]&&this.deselect(f)},clickSelect:function(g,f,t){if("none"!=
this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(g);else{if(!t||0>this.rangeStartIndex)this.rangeStartIndex=g;f||this.deselectAll(g);t?this.selectRange(this.rangeStartIndex,g):f?this.toggleSelect(g):this.addToSelection(g)}this._endUpdate()}},clickSelectEvent:function(g){this.clickSelect(g.rowIndex,dojo.isCopyKey(g),g.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver",
"./Selection"],function(N,A,F){return N("dojox.grid.DataSelection",F,{constructor:function(D){D.keepSelection&&(this.preserver=new A(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var D=F.prototype.getFirstSelected.call(this);return-1==D?null:this.grid.getItem(D)},getNextSelected:function(D){D=this.grid.getItemIndex(D);D=F.prototype.getNextSelected.call(this,D);return-1==D?null:this.grid.getItem(D)},getSelected:function(){for(var D=[],g=0,f=this.selected.length;g<
f;g++)this.selected[g]&&D.push(this.grid.getItem(g));return D},addToSelection:function(D){if("none"!=this.mode){var g=null;g="number"==typeof D||"string"==typeof D?D:this.grid.getItemIndex(D);F.prototype.addToSelection.call(this,g)}},deselect:function(D){if("none"!=this.mode){var g=null;g="number"==typeof D||"string"==typeof D?D:this.grid.getItemIndex(D);F.prototype.deselect.call(this,g)}},deselectAll:function(D){var g=null;D||"number"==typeof D?(g="number"==typeof D||"string"==typeof D?D:this.grid.getItemIndex(D),
F.prototype.deselectAll.call(this,g)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(N,A,F,D){return N("dojox.grid._SelectionPreserver",null,{constructor:function(g){this.selection=g;var f=this.grid=g.grid;this.reset();this._connects=[A.connect(f,"_setStore",this,"reset"),A.connect(f,"_addItem",this,"_reSelectById"),A.connect(g,"onSelected",F.hitch(this,"_selectById",!0)),
A.connect(g,"onDeselected",F.hitch(this,"_selectById",!1)),A.connect(g,"deselectAll",this,"reset")]},destroy:function(){this.reset();D.forEach(this._connects,A.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(g,f){g&&this.grid._hasIdentity&&(this.selection.selected[f]=this._selectedById[this.grid.store.getIdentity(g)])},_selectById:function(g,f){if("none"!=this.selection.mode&&this.grid._hasIdentity){var t=f,c=this.grid;if("number"==typeof f||"string"==
typeof f)t=(f=c._by_idx[f])&&f.item;t&&(this._selectedById[c.store.getIdentity(t)]=!!g);return t}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(N,A,F,D,g,f,t,c,v,q,e){N=N([t,c],{declaredClass:"esri.dijit.editing.TemplatePickerItem",templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",
startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(d,b,a,m,l){if(b&&"textsymbol"!==b.type){d=v.createSurface(d,a,m);if(9>D("ie")){var n=d.getEventSource();f.set(n,"position","relative");f.set(n.parentNode,"position","relative")}b=!this.legendOverride&&this._getDrawingToolShape(b,l)||q.getShapeDescriptors(b);try{var k=d.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke)}catch(B){d.clear();
d.destroy();return}var x=k.getBoundingBox();b=x.width;l=x.height;n=-(x.x+b/2);x=-(x.y+l/2);var u=d.getDimensions();n={dx:n+u.width/2,dy:x+u.height/2};if(b>a||l>m)x=b/a>l/m,a=((x?a:m)-5)/(x?b:l),A.mixin(n,{xx:a,yy:a});k.applyTransform(n);return d}},_getDrawingToolShape:function(d,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":b={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};
break;case "esriFeatureEditToolRightArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":b={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};break;case "esriFeatureEditToolDownArrow":b={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":b=
{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":b="simplelinesymbol"===d.type||"cartographiclinesymbol"===d.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:
{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:b,fill:d.getFill(),stroke:d.getStroke()}},_repaint:function(d){d?(d.getStroke&&d.setStroke&&d.setStroke(d.getStroke()),d.getFill&&d.setFill&&d.setFill(d.getFill()),d.children&&A.isArray(d.children)&&F.forEach(d.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
D("extend-esri")&&A.setObject("dijit.editing.TemplatePickerItem",N,e);return N})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G,y,J,M,ba,W,E,O,H,P,S,V,Z,da,L,R,aa){var ia=N([r,k,x],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:aa,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(Q,T){A.mixin(this,m.widgets.attributeInspector);Q=Q||{};Q.featureLayer||Q.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(Q);this._layerInfos=Q.layerInfos||[{featureLayer:Q.featureLayer,options:Q.options||[]}];this._layerInfos=F.filter(this._layerInfos,function(Y){return!Y.disableAttributeUpdate});this._hideNavButtons=Q.hideNavButtons||!1},postCreate:function(){if(F.every(this._layerInfos,
function(T){return T.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var Q=this._layerInfos.length;F.forEach(this._layerInfos,function(T){T=T.featureLayer;if(T.loaded)Q--;else var Y=D.connect(T,"onLoad",this,function(ea){D.disconnect(Y);Y=null;Q--;Q||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();F.forEach(this._aiConnects,D.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(Q,T){T&&(this._createOnlyFirstTime=!0);
this._updateSelection([Q],T);this._updateUI()},onLayerSelectionChange:function(Q,T,Y){this._createOnlyFirstTime=!1;this._featureIdx=Y===a.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(Q,T,Y,ea){},onLayerError:function(Q,T,Y,ea){},onLayerEditsError:function(Q,
T,Y,ea){},onLayerEditsComplete:function(Q,T,Y,ea){ea=ea||[];if(ea.length){var la=this._selection,qa=Q.featureLayer.objectIdField;F.forEach(ea,A.hitch(this,function(ra){F.some(la,A.hitch(this,function(oa,sa){if(oa.attributes[qa]!==ra.objectId)return!1;this._selection.splice(sa,1);return!0}))}))}T=T||[];T.length&&(this._selection=G.findFeatures(T,Q.featureLayer),this._featureIdx=0);ea=this._numFeatures=(this._selection=G.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(T.length){if(T=
ea?this._selection[this._featureIdx]:null)ea=T.getLayer().getEditCapabilities(),ea.canCreate&&!ea.canUpdate||this._showFeature(T);this._updateUI()}Y=Y||[];if(Y.length){var na=this._rollbackInfo;F.forEach(Y,function(ra){var oa=G.findFeatures(Y,Q.featureLayer)[0];if(!ra.success&&oa.attributes[Q.featureLayer.objectIdField]===ra.objectId&&na){var sa=na.field;ra=na.graphic.attributes[sa.name];var ua=F.filter(this._currentLInfo.fieldInfos,function(Ba){return Ba.fieldName===sa.name},this)[0].dijit;oa.attributes[sa.name]=
ra;"esriFieldTypeDate"===sa.type&&(ra=new Date(ra));this._setValue(ua,ra)}},this)}this._rollbackInfo=null},onFieldValueChange:function(Q,T){var Y=Q.field,ea=Q.dijit,la=this._currentFeature,qa=this._currentLInfo,na=Y.name;Q=this._isFieldRequired(Y,Q);if(""===ea.displayedValue||"dijit.form.ValidationTextBox"!==ea.declaredClass||ea.isValid())if(""!==ea.displayedValue&&ea.displayedValue!==T&&ea.isValid&&!ea.isValid())this._setValue(ea,la.attributes[Y.name]);else{var ra=!("esriFieldTypeInteger"!==Y.type&&
"esriFieldTypeSmallInteger"!==Y.type&&"esriFieldTypeSingle"!==Y.type&&"esriFieldTypeDouble"!==Y.type);if(Q&&(null===T||""===T||"undefined"===typeof T||ra&&isNaN(T))){na=la.attributes[Y.name];if("esriFieldTypeDate"===Y.type&&(na=new Date(na),ea instanceof Array)){this._setValue(ea[0],na);this._setValue(ea[1],na);return}this._setValue(ea,na)}else{if(ra){if(isNaN(T)||""===T)T=null;ra&&null!==T&&(T=Number(T))}"esriFieldTypeDate"===Y.type&&(ea instanceof Array?(T=ea[0].getValue(),ea=ea[1].getValue(),T=
T&&ea?new Date(T.getFullYear(),T.getMonth(),T.getDate(),ea.getHours(),ea.getMinutes(),ea.getSeconds(),ea.getMilliseconds()):T||ea||null):(T=ea.getValue(),Y.domain&&(T=Number(T))),T=T&&T.getTime?T.getTime():T&&T.toGregorian?T.toGregorian().getTime():T);if(this._currentFeature.attributes[Y.name]!==T){if(na===qa.typeIdField){var oa=this._findFirst(qa.types,"id",T);F.forEach(qa.fieldInfos,function(sa){(Y=sa.field)&&Y.name!==qa.typeIdField&&(sa=sa.dijit,this._setFieldDomain(sa,oa,Y)&&sa&&(this._setValue(sa,
la.attributes[Y.name]+""),!1===sa.isValid()&&this._setValue(sa,null)))},this)}this.onAttributeChange(la,na,T)}}}else this._setValue(ea,la.attributes[Y.name])},onDeleteBtn:function(Q){this._deleteFeature()},onNextFeature:function(Q){this._onNextFeature(1)},onPreviousFeature:function(Q){this._onNextFeature(-1)},onFirstFeature:function(Q){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(Q){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var Q=this._layerInfos;
this._editorTrackingInfos={};F.forEach(Q,this._initLayerInfo,this)},_initLayerInfo:function(Q){var T=Q.featureLayer,Y;this._userIds={};var ea=T.id;T.credential&&(this._userIds[ea]=T.credential.userId);Q.userId&&(this._userIds[ea]=Q.userId);this._connect(T,"onSelectionComplete",A.hitch(this,"onLayerSelectionChange",Q));this._connect(T,"onSelectionClear",A.hitch(this,"onLayerSelectionClear",Q));this._connect(T,"onEditsComplete",A.hitch(this,"onLayerEditsComplete",Q));this._connect(T,"error",A.hitch(this,
"onLayerError",Q));this._connect(T,"onUpdateEnd",A.hitch(this,"onLayerUpdateEnd",Q));Q.showAttachments=T.hasAttachments?e.isDefined(Q.showAttachments)?Q.showAttachments:!0:!1;Q.hideFields=Q.hideFields||[];Q.htmlFields=Q.htmlFields||[];Q.isEditable=T.isEditable()?e.isDefined(Q.isEditable)?Q.isEditable:!0:!1;Q.typeIdField=T.typeIdField;Q.layerId=T.id;Q.types=T.types;T.globalIdField&&((Y=this._findFirst(Q.fieldInfos,"fieldName",T.globalIdField))||Q.showGlobalID||Q.hideFields.push(T.globalIdField));(ea=
this._findFirst(Q.fieldInfos,"fieldName",T.objectIdField))||Q.showObjectID||Q.hideFields.push(T.objectIdField);var la=this._getFields(Q.featureLayer);if(la){var qa=Q.fieldInfos||[];qa=F.map(qa,function(na){return A.mixin({},na)});qa.length?Q.fieldInfos=F.filter(F.map(qa,A.hitch(this,function(na){var ra=na.stringFieldOption||(this._isInFields(na.fieldName,Q.htmlFields)?ia.STRING_FIELD_OPTION_RICHTEXT:ia.STRING_FIELD_OPTION_TEXTBOX);return A.mixin(na,{field:this._findFirst(la,"name",na.fieldName),stringFieldOption:ra})})),
"return item.field;"):(la=F.filter(la,A.hitch(this,function(na){return!this._isInFields(na.name,Q.hideFields)})),Q.fieldInfos=F.map(la,A.hitch(this,function(na){var ra=this._isInFields(na.name,Q.htmlFields)?ia.STRING_FIELD_OPTION_RICHTEXT:ia.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:na.name,field:na,stringFieldOption:ra}})));Q.showGlobalID&&!Y&&qa.push(this._findFirst(la,"name",T.globalIdField));Q.showObjectID&&!ea&&qa.push(this._findFirst(la,"name",T.objectIdField));Y=[];T.editFieldsInfo&&(T.editFieldsInfo.creatorField&&
Y.push(T.editFieldsInfo.creatorField),T.editFieldsInfo.creationDateField&&Y.push(T.editFieldsInfo.creationDateField),T.editFieldsInfo.editorField&&Y.push(T.editFieldsInfo.editorField),T.editFieldsInfo.editDateField&&Y.push(T.editFieldsInfo.editDateField));this._editorTrackingInfos[T.id]=Y}},_createAttachmentEditor:function(){this._attachmentEditor=null;var Q=F.filter(this._layerInfos,function(T){return T.showAttachments});Q&&Q.length&&(this._attachmentEditor=new w({"class":this.css.attachmentEditor},
this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(Q){var T=this._currentLInfo?this._currentLInfo.featureLayer:null,Y=Q.featureLayer;if(T&&T.id===Y.id&&!T.ownershipBasedAccessControlForFeatures&&(T=Y.getEditCapabilities(),!T.canCreate||T.canUpdate))return;this._currentLInfo=Q;this._createTable()},_updateSelection:function(Q,T){this._selection=Q||[];F.forEach(this._layerInfos,this._getSelection,this);this._selection=G.sortFeaturesById(this._layerInfos,this._selection);
this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?this._selection[this._featureIdx]:null,T)},_getSelection:function(Q){Q=Q.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(Q)},_updateUI:function(){var Q=this._numFeatures,T=this._currentLInfo;this.layerName.innerHTML=T&&0!==Q?T.featureLayer?T.featureLayer.name:"":this.NLS_noFeaturesSelected;c.set(this.attributeTable,"display",Q?"":"none");c.set(this.editButtons,"display",Q?"":"none");c.set(this.navButtons,
"display",!this._hideNavButtons&&1<Q?"":"none");this.navMessage.innerHTML=e.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&c.set(this._attachmentEditor.domNode,"display",T&&T.showAttachments&&Q?"":"none");c.set(this.deleteBtn.domNode,"display",T&&!1===T.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(Q){this._featureIdx+=
Q;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);Q=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(Q);this._updateUI();this.onNext(Q)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(Q,T){if(Q){this._currentFeature=Q;T=T?T:Q.getLayer();var Y=T.getEditCapabilities({feature:Q,userId:this._userIds[T.id]});this._canUpdate=Y.canUpdate;this._canDelete=Y.canDelete;if(Y=
this._getLInfoFromFeatureLayer(T)){this._setCurrentLInfo(Y);var ea=Q.attributes,la=this._findFirst(Y.types,"id",ea[Y.typeIdField]),qa=null;F.forEach(Y.fieldInfos,function(na){qa=na.field;var ra=[];na.dijit&&1<na.dijit.length?F.forEach(na.dijit,function(oa){ra.push(oa)}):ra.push(na.dijit);F.forEach(ra,A.hitch(this,function(oa){if(oa){var sa=this._setFieldDomain(oa,la,qa),ua=ea[qa.name];ua=ua&&sa&&sa.codedValues&&sa.codedValues.length?sa.codedValues[ua]?sa.codedValues[ua].name:ua:ua;e.isDefined(ua)||
(ua="");"dijit.form.DateTextBox"===oa.declaredClass||"dijit.form.TimeTextBox"===oa.declaredClass?ua=""===ua?null:new Date(ua):"dijit.form.FilteringSelect"===oa.declaredClass&&(oa._lastValueReported=null,ua=ea[qa.name]+"");try{this._setValue(oa,ua),"dijit.form.FilteringSelect"===oa.declaredClass&&!1===oa.isValid()&&this._setValue(oa,null)}catch(Ba){oa.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&Y.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,
T);(Q=T.getEditSummary(Q))?(this.editorTrackingInfoDiv.innerHTML=Q,d.show(this.editorTrackingInfoDiv)):d.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(Q,T,Y){if(!Q)return null;var ea=Y.domain;T&&T.domains&&T.domains[Y.name]&&!1===T.domains[Y.name]instanceof b&&(ea=T.domains[Y.name]);if(!ea)return null;ea.codedValues&&0<ea.codedValues.length?(Q.set("store",this._toStore(F.map(ea.codedValues,function(la){return{id:la.code+="",name:la.name}}))),this._setValue(Q,ea.codedValues[0].code)):
(Q.constraints={min:e.isDefined(ea.minValue)?ea.minValue:Number.MIN_VALUE,max:e.isDefined(ea.maxValue)?ea.maxValue:Number.MAX_VALUE},this._setValue(Q,Q.constraints.min));return ea},_setValue:function(Q,T){Q.set&&(Q._onChangeActive=!1,Q.set("value",T,!0),Q._onChangeActive=!0)},_getFields:function(Q){var T=Q._getOutFields();if(!T)return null;Q=Q.fields;return"*"==T?Q:F.filter(F.map(T,A.hitch(this,"_findFirst",Q,"name")),e.isDefined)},_isInFields:function(Q,T){return Q&&(T||T.length)?F.some(T,function(Y){return Y.toLowerCase()===
Q.toLowerCase()}):!1},_isFieldNullable:function(Q,T){return!(!1===Q.nullable||T.field&&!1===T.field.nullable)},_isFieldRequired:function(Q,T){return!1!==Q.editable&&!1!==T.isEditable&&!this._isFieldNullable(Q,T)},_findFirst:function(Q,T,Y){return(Q=F.filter(Q,function(ea){return ea.hasOwnProperty(T)&&ea[T]===Y}))&&Q.length?Q[0]:null},_getLInfoFromFeatureLayer:function(Q){return this._findFirst(this._layerInfos,"layerId",Q?Q.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML=
"";this._attributes=v.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var Q=v.create("tbody",null,this._attributes),T=this._currentLInfo,Y=this._findFirst(T.types,"id",this._currentFeature.attributes[T.typeIdField]);F.forEach(T.fieldInfos,A.hitch(this,"_createField",Y,Q),this);this._createOnlyFirstTime=!1},_createField:function(Q,T,Y){var ea=this._currentLInfo,la=Y.field;if(!this._isInFields(la.name,ea.hideFields)&&!this._isInFields(la.name,this._editorTrackingInfos[ea.featureLayer.id])){var qa=
!1,na;T=v.create("tr",null,T);var ra=v.create("td",{innerHTML:Y.label||la.alias||la.name,"class":this.css.label,"data-fieldname":la.name},T);this._isFieldRequired(la,Y)&&v.create("span",{"class":this.css.red,innerHTML:" *"},ra);T=v.create("td",null,T);if(Y.customField){v.place(Y.customField.domNode||Y.customField,v.create("div",null,T),"first");var oa=Y.customField}else if(!1===ea.isEditable||!1===la.editable||!1===Y.isEditable||"esriFieldTypeOID"===la.type||"esriFieldTypeGlobalID"===la.type||!this._canUpdate&&
!this._createOnlyFirstTime)qa=!0;ea=ea.typeIdField&&la.name.toLowerCase()==ea.typeIdField.toLowerCase();ra=!!this._getDomainForField(la,Q);!oa&&ea?oa=this._createTypeField(la,Y,T):!oa&&ra&&(oa=this._createDomainField(la,Y,Q,T));if(!oa)switch(la.type){case "esriFieldTypeString":oa=this._createStringField(la,Y,T);break;case "esriFieldTypeDate":oa=this._createDateField(la,Y,T);Y.format&&Y.format.time&&(na=this._createTimeField(la,Y,T));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":oa=
this._createIntField(la,Y,T);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":oa=this._createFltField(la,Y,T);break;default:oa=this._createStringField(la,Y,T)}Y.tooltip&&Y.tooltip.length&&this._toolTips.push(new V({connectId:[oa.id],label:Y.tooltip}));oa.onChange=A.hitch(this,"onFieldValueChange",Y);oa.set("disabled",qa);na?(Y.dijit=[oa,na],na.onChange=A.hitch(this,"onFieldValueChange",Y),na.set("disabled",qa)):Y.dijit=oa}},_createTypeField:function(Q,T,Y){Y=v.create("div",null,Y);var ea=
Q.domain;return ea&&"range"===ea.type&&ea.minValue===ea.maxValue?new P({"class":this.css.field,trim:!0,maxLength:Q.length,name:Q.alias||Q.name,required:this._isFieldRequired(Q,T)},Y):new W({"class":this.css.field,name:Q.alias||Q.name,required:this._isFieldRequired(Q,T),store:this._toStore(F.map(this._currentLInfo.types,function(la){return{id:la.id,name:la.name}})),searchAttr:"name"},Y)},_getDomainForField:function(Q,T){var Y=Q.domain;(Q=Q.name)&&T&&T.domains&&T.domains[Q]&&!1===T.domains[Q]instanceof
b&&(Y=T.domains[Q]);return Y||null},_createDomainField:function(Q,T,Y,ea){Y=this._getDomainForField(Q,Y);ea=v.create("div",null,ea);return Y.codedValues?new W({"class":this.css.field,name:Q.alias||Q.name,searchAttr:"name",required:this._isFieldRequired(Q,T)},ea):new E({"class":this.css.field},ea)},_createStringField:function(Q,T,Y){Y=v.create("div",null,Y);var ea={trim:!0,maxLength:Q.length,required:this._isFieldRequired(Q,T)};if(T.stringFieldOption===ia.STRING_FIELD_OPTION_TEXTAREA)return ea["class"]=
this.css.field+" "+this.css.textArea,new H(ea,Y);if(T.stringFieldOption===ia.STRING_FIELD_OPTION_RICHTEXT)return ea["class"]=this.css.field+" "+this.css.richText,ea.height="100%",ea.width="100%",ea.plugins=T.richTextPlugins||this._defaultRichTextPlugins,Y=new u(ea,Y),Y.startup(),Y;var la=this;ea.validator=function(qa,na){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return la._isFieldNullable(Q,T)||!(""===qa||null===qa)};return new P(ea,Y)},_createTimeField:function(Q,T,Y){Y=v.create("div",
null,Y);Q={"class":this.css.field,trim:!0,required:this._isFieldRequired(Q,T),constraints:{formatLength:"medium"}};this._datePackage&&(Q.datePackage=this._datePackage);return new S(Q,Y)},_createDateField:function(Q,T,Y){Y=v.create("div",null,Y);Q={"class":this.css.field,trim:!0,required:this._isFieldRequired(Q,T)};this._datePackage&&(Q.datePackage=this._datePackage);return new J(Q,Y)},_createIntField:function(Q,T,Y){Y=v.create("div",null,Y);return new ba({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===
Q.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(Q,T)},Y)},_createFltField:function(Q,T,Y){Y=v.create("div",null,Y);return new ba({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(Q,T)},Y)},_toStore:function(Q){return new Z({data:{identifier:"id",label:"name",items:Q}})},_connect:function(Q,T,Y){this._aiConnects.push(D.connect(Q,
T,Y))},_getDatePackage:function(Q){return null===Q.datePackage?null:Q.datePackage?Q.datePackage:"ar"===f.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){F.forEach(this._layerInfos,function(Q){F.forEach(Q.fieldInfos,function(T){var Y=T.dijit;if(Y){Y._onChangeHandle=null;if(T.customField)return;Y instanceof Array?F.forEach(Y,A.hitch(this,function(ea){ea.destroyRecursive?ea.destroyRecursive():ea.destroy&&ea.destroy();ea._onChangeHandle=null})):Y.destroyRecursive?Y.destroyRecursive():
Y.destroy&&Y.destroy()}T.dijit=null},this)},this);F.forEach(this._toolTips,function(Q){Q.destroy()});this._toolTips=[];this._attributes&&v.destroy(this._attributes)}});A.mixin(ia,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});t("extend-esri")&&A.setObject("dijit.AttributeInspector",ia,q);return ia})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G){function y(M){return new u({command:M.name})}function J(M){return new u({buttonClass:x,command:M.name})}F=F("dijit.Editor",w,{plugins:null,extraPlugins:null,constructor:function(){e.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",B]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(d("ie")||d("trident")||d("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new D;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);e.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=g.getLocalization("dijit._editor",
"commands",this.lang);d("webkit")&&v.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new l({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));A.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);t.add(this.iframe.parentNode,"dijitEditorIFrameContainer");t.add(this.iframe,"dijitEditorIFrame");f.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){A.forEach(this._plugins,function(M){M&&M.destroy&&M.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(M,ba){var W=e.isString(M)?{name:M}:e.isFunction(M)?{ctor:M}:M;if(!W.setEditor){var E={args:W,plugin:null,editor:this};W.name&&(u.registry[W.name]?E.plugin=u.registry[W.name](W):a.publish(G._scopeName+".Editor.getPlugin",E));if(!E.plugin)try{var O=
W.ctor||e.getObject(W.name)||N(W.name);O&&(E.plugin=new O(W))}catch(H){throw Error(this.id+": cannot find plugin ["+W.name+"]");}if(!E.plugin)throw Error(this.id+": cannot find plugin ["+W.name+"]");M=E.plugin}1<arguments.length?this._plugins[ba]=M:this._plugins.push(M);M.setEditor(this);e.isFunction(M.setToolbar)&&M.setToolbar(this.toolbar)},resize:function(M){M&&k.prototype.resize.apply(this,arguments)},layout:function(){var M=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+c.getPadBorderExtents(this.iframe.parentNode).h+
c.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=M+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(M){var ba,W=this.document.body,E=W.clientWidth,O=W.clientHeight,H=W.clientLeft,P=W.offsetWidth,S=W.offsetHeight,V=W.offsetLeft;/^rtl$/i.test(W.dir||"")?E<P&&M.x>E&&M.x<P&&(ba=!0):M.x<H&&M.x>V&&(ba=!0);ba||O<S&&M.y>O&&M.y<S&&(ba=!0);ba||(delete this._cursorToStart,delete this._savedSelection,"BODY"==M.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(M){this.customUndo&&this.endEditing(!0);"BODY"!=M.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(M){this._inEditing||(this._inEditing=!0,this._beginEditing(M));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(M){if(!this.customUndo||
"undo"!=M&&"redo"!=M){this.customUndo&&(this.endEditing(),this._beginEditing());var ba=this.inherited(arguments);this.customUndo&&this._endEditing();return ba}return this[M]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(M){try{var ba=this.document.execCommand(M,!1,null);if(d("webkit")&&!ba)throw{};}catch(W){ba=b.substitute,alert(ba(this.commands.systemShortcut,
[this.commands[M],ba(this.commands[d("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[M]])])),ba=!1}return ba},queryCommandEnabled:function(M){return!this.customUndo||"undo"!=M&&"redo"!=M?this.inherited(arguments):"undo"==M?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(M){var ba=M.mark,W=M.mark;M=M.isCollapsed;var E;if(W)if(9>d("ie")||9===d("ie")&&d("quirks"))if(e.isArray(W))ba=[],A.forEach(W,function(P){ba.push(r.getNode(P,this.editNode))},this),this.selection.moveToBookmark({mark:ba,
isCollapsed:M});else{if(W.startContainer&&W.endContainer&&(E=r.getSelection(this.window))&&E.removeAllRanges){E.removeAllRanges();M=r.create(this.window);var O=r.getNode(W.startContainer,this.editNode);var H=r.getNode(W.endContainer,this.editNode);O&&H&&(M.setStart(O,W.startOffset),M.setEnd(H,W.endOffset),E.addRange(M))}}else(E=r.getSelection(this.window))&&E.removeAllRanges&&(E.removeAllRanges(),M=r.create(this.window),O=r.getNode(W.startContainer,this.editNode),H=r.getNode(W.endContainer,this.editNode),
O&&H&&(M.setStart(O,W.startOffset),M.setEnd(H,W.endOffset),E.addRange(M)))},_changeToStep:function(M,ba){this.setValue(ba.text);(M=ba.bookmark)&&this._moveToBookmark(M)},undo:function(){var M=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var ba=this._steps.pop();ba&&0<this._steps.length&&(this.focus(),this._changeToStep(ba,this._steps[this._steps.length-1]),this._undoedSteps.push(ba),this.onDisplayChanged(),delete this._undoRedoActive,M=!0);delete this._undoRedoActive}return M},
redo:function(){var M=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var ba=this._undoedSteps.pop();ba&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],ba),this._steps.push(ba),this.onDisplayChanged(),M=!0);delete this._undoRedoActive}return M},endEditing:function(M){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(M),this._inEditing=!1)},_getBookmark:function(){var M=this.selection.getBookmark(),
ba=[];if(M&&M.mark){var W=M.mark;if(9>d("ie")||9===d("ie")&&d("quirks")){var E=r.getSelection(this.window);if(e.isArray(W))A.forEach(M.mark,function(H){ba.push(r.getIndex(H,this.editNode).o)},this),M.mark=ba;else if(E){var O;E.rangeCount&&(O=E.getRangeAt(0));M.mark=O?O.cloneRange():this.selection.getBookmark()}}try{M.mark&&M.mark.startContainer&&(ba=r.getIndex(M.mark.startContainer,this.editNode).o,M.mark={startContainer:ba,startOffset:M.mark.startOffset,endContainer:M.mark.endContainer===M.mark.startContainer?
ba:r.getIndex(M.mark.endContainer,this.editNode).o,endOffset:M.mark.endOffset})}catch(H){M.mark=null}}return M},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:h.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var M=h.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:M,bookmark:this._getBookmark()})},onKeyDown:function(M){d("ie")||this.iframe||M.keyCode!=q.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var ba=
M.keyCode;if(M.ctrlKey&&!M.shiftKey&&!M.altKey){if(90==ba||122==ba){M.stopPropagation();M.preventDefault();this.undo();return}if(89==ba||121==ba){M.stopPropagation();M.preventDefault();this.redo();return}}this.inherited(arguments);switch(ba){case q.ENTER:case q.BACKSPACE:case q.DELETE:this.beginEditing();break;case 88:case 86:if(M.ctrlKey&&!M.altKey&&!M.metaKey){this.endEditing();88==M.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!M.ctrlKey&&
!M.altKey&&!M.metaKey&&(M.keyCode<q.F1||M.keyCode>q.F15)){this.beginEditing();break}case q.ALT:this.endEditing();break;case q.UP_ARROW:case q.DOWN_ARROW:case q.LEFT_ARROW:case q.RIGHT_ARROW:case q.HOME:case q.END:case q.PAGE_UP:case q.PAGE_DOWN:this.endEditing(!0);case q.CTRL:case q.SHIFT:case q.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(M){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(M){this.customUndo?this.isClosed?this.setValue(M):(this.beginEditing(),M||(M="\x26#160;"),this.setValue(M),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(M){this.setValueDeferred.then(e.hitch(this,function(){!this.disabled&&M||!this._buttonEnabledPlugins&&M?
A.forEach(this._plugins,function(ba){ba.set("disabled",!0)}):this.disabled&&!M&&A.forEach(this._plugins,function(ba){ba.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(v.set(this.document.body,"color",v.get(this.iframe,"color")),v.set(this.document.body,"background-color",v.get(this.iframe,"background-color")))}catch(M){}}});e.mixin(u.registry,{undo:y,redo:y,cut:y,copy:y,paste:y,insertOrderedList:y,insertUnorderedList:y,
indent:y,outdent:y,justifyCenter:y,justifyFull:y,justifyLeft:y,justifyRight:y,"delete":y,selectAll:y,removeFormat:y,unlink:y,insertHorizontalRule:y,bold:J,italic:J,underline:J,strikethrough:J,subscript:J,superscript:J,"|":function(){return new u({setEditor:function(M){this.editor=M;this.button=new n({ownerDocument:M.ownerDocument})}})}});return F})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(N,A,F,D,g,f,t,c){F("dijit-legacy-requires")&&g(0,function(){N(["dijit/ToolbarSeparator"])});return A("dijit.Toolbar",[f,c,t],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(N,A,F,D){return N("dijit.ToolbarSeparator",[F,D],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);A.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(N,A,F,D,g){A=A("dijit._editor._Plugin",D,{constructor:function(f){this.params=
f||{};F.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:g,disabled:!1,getLabel:function(f){return this.editor.commands[f]},_initButton:function(){if(this.command.length){var f=this.getLabel(this.command),t=this.editor,c=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(f=F.mixin({label:f,ownerDocument:t.ownerDocument,dir:t.dir,
lang:t.lang,showLabel:!1,iconClass:c,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete f.name,this.button=new this.buttonClass(f))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(f,t,c){this.own(N.connect(f,t,this,c))},updateState:function(){var f=this.editor,t=this.command;if(f&&f.isLoaded&&t.length){var c=this.get("disabled");if(this.button)try{var v=
f._implCommand(t);var q=!c&&(this[v]?this[v](t):f.queryCommandEnabled(t));this.enabled!==q&&(this.enabled=q,this.button.set("disabled",!q));if(q&&"boolean"==typeof this.button.checked){var e=f.queryCommandState(t);this.checked!==e&&(this.checked=e,this.button.set("checked",f.queryCommandState(t)))}}catch(d){console.log(d)}}},setEditor:function(f){this.editor=f;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",F.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",F.hitch(this,"updateState")))},setToolbar:function(f){this.button&&f.addChild(this.button)},set:function(f,t){if("object"===typeof f){for(var c in f)this.set(c,f[c]);return this}c=this._getAttrNames(f);if(this[c.s])var v=this[c.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(f,t);return v||this},get:function(f){var t=this._getAttrNames(f);
return this[t.g]?this[t.g]():this[f]},_setDisabledAttr:function(f){this._set("disabled",f);this.updateState()},_getAttrNames:function(f){var t=this._attrPairNames;if(t[f])return t[f];var c=f.charAt(0).toUpperCase()+f.substr(1);return t[f]={s:"_set"+c+"Attr",g:"_get"+c+"Attr"}},_set:function(f,t){this[f]=t}});A.registry={};return A})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e){return N("dijit._editor.plugins.EnterKeyHandling",v,{blockNodeForEnter:"BR",constructor:function(d){d&&("blockNodeForEnter"in d&&(d.blockNodeForEnter=d.blockNodeForEnter.toUpperCase()),D.mixin(this,d))},setEditor:function(d){if(this.editor!==d)if(this.editor=d,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,d.onLoadDeferred.then(D.hitch(this,function(a){this.own(g(d.document,"keydown",D.hitch(this,function(m){if(m.keyCode==F.ENTER){var l=D.mixin({},m);l.shiftKey=
!0;this.handleEnterKey(l)||(m.stopPropagation(),m.preventDefault())}})));9<=f("ie")&&10>=f("ie")&&this.own(g(d.document,"paste",D.hitch(this,function(m){setTimeout(D.hitch(this,function(){var l=this.editor.document.selection.createRange();l.move("character",-1);l.select();l.move("character",1);l.select()}),0)})));return a}));else if(this.blockNodeForEnter){var b=D.hitch(this,"handleEnterKey");d.addKeyHandler(13,0,0,b);d.addKeyHandler(13,0,1,b);this.own(this.editor.on("KeyPressed",D.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var d=this.editor.selection.getAncestorElement("LI");if(d){f("mozilla")&&"LI"==d.parentNode.parentNode.nodeName&&(d=d.parentNode.parentNode);var b=d.firstChild;!b||1!=b.nodeType||"UL"!=b.nodeName&&"OL"!=b.nodeName||(d.insertBefore(b.ownerDocument.createTextNode("\u00a0"),b),b=e.create(this.editor.window),b.setStart(d.firstChild,0),d=e.getSelection(this.editor.window,!0),d.removeAllRanges(),d.addRange(b))}else q.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(d=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(d.innerHTML=this.bogusHtmlContent,9>=f("ie")&&(d=this.editor.document.selection.createRange(),d.move("character",-1),d.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(d){var b,a=this.editor.document,m;if(d.shiftKey){d=this.editor.selection.getParentElement();if(b=e.getAncestor(d,this.blockNodes)){if("LI"==b.tagName)return!0;d=e.getSelection(this.editor.window);var l=d.getRangeAt(0);l.collapsed||(l.deleteContents(),d=e.getSelection(this.editor.window),l=d.getRangeAt(0));if(e.atBeginningOfContainer(b,l.startContainer,l.startOffset)){var n=a.createElement("br");l=e.create(this.editor.window);b.insertBefore(n,
b.firstChild);l.setStartAfter(n);d.removeAllRanges();d.addRange(l)}else if(e.atEndOfContainer(b,l.startContainer,l.startOffset))l=e.create(this.editor.window),n=a.createElement("br"),b.appendChild(n),b.appendChild(a.createTextNode("\u00a0")),l.setStart(b.lastChild,0),d.removeAllRanges(),d.addRange(l);else{if((m=l.startContainer)&&3==m.nodeType){var k=m.nodeValue;var x=a.createTextNode(k.substring(0,l.startOffset));var u=a.createTextNode(k.substring(l.startOffset));b=a.createElement("br");""==u.nodeValue&&
f("webkit")&&(u=a.createTextNode("\u00a0"));A.place(x,m,"after");A.place(b,x,"after");A.place(u,b,"after");A.destroy(m);l=e.create(this.editor.window);l.setStart(u,0);d.removeAllRanges();d.addRange(l);return!1}return!0}}else d=e.getSelection(this.editor.window),d.rangeCount?(l=d.getRangeAt(0))&&l.startContainer&&(l.collapsed||(l.deleteContents(),d=e.getSelection(this.editor.window),l=d.getRangeAt(0)),(m=l.startContainer)&&3==m.nodeType?(b=l.startOffset,m.length<b&&(u=this._adjustNodeAndOffset(m,b),
m=u.node,b=u.offset),k=m.nodeValue,x=a.createTextNode(k.substring(0,b)),u=a.createTextNode(k.substring(b)),b=a.createElement("br"),u.length||(u=a.createTextNode("\u00a0")),x.length?A.place(x,m,"after"):x=m,A.place(b,x,"after"),A.place(u,b,"after"),A.destroy(m)):(0<=l.startOffset&&(n=m.childNodes[l.startOffset]),b=a.createElement("br"),u=a.createTextNode("\u00a0"),n?(A.place(b,n,"before"),A.place(u,b,"after")):(m.appendChild(b),m.appendChild(u))),l=e.create(this.editor.window),l.setStart(u,0),l.setEnd(u,
u.length),d.removeAllRanges(),d.addRange(l),this.editor.selection.collapse(!0)):q.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var B=!0;d=e.getSelection(this.editor.window);l=d.getRangeAt(0);l.collapsed||(l.deleteContents(),d=e.getSelection(this.editor.window),l=d.getRangeAt(0));n=e.getBlockAncestor(l.endContainer,null,this.editor.editNode);var h=n.blockNode;if(this._checkListLater=h&&("LI"==h.nodeName||"LI"==h.parentNode.nodeName))return f("mozilla")&&(this._pressedEnterInBlock=
h),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(h.innerHTML)&&(h.innerHTML="",f("webkit")&&(l=e.create(this.editor.window),l.setStart(h,0),d.removeAllRanges(),d.addRange(l)),this._checkListLater=!1),!0;if(!n.blockNode||n.blockNode===this.editor.editNode){try{q.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(r){}n={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(n.blockNode){if(n.blockNode!=this.editor.editNode&&!(n.blockNode.textContent||n.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(n.blockNode),!1}else n.blockNode=this.editor.editNode;d=e.getSelection(this.editor.window);l=d.getRangeAt(0)}h=a.createElement(this.blockNodeForEnter);h.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(n.blockNode);u=l.endOffset;B=l.endContainer;B.length<u&&(u=this._adjustNodeAndOffset(B,u),B=
u.node,u=u.offset);if(e.atEndOfContainer(n.blockNode,B,u))n.blockNode===n.blockContainer?n.blockNode.appendChild(h):A.place(h,n.blockNode,"after"),B=!1,l=e.create(this.editor.window),l.setStart(h,0),d.removeAllRanges(),d.addRange(l),this.editor.height&&c.scrollIntoView(h);else if(e.atBeginningOfContainer(n.blockNode,l.startContainer,l.startOffset))A.place(h,n.blockNode,n.blockNode===n.blockContainer?"first":"before"),h.nextSibling&&this.editor.height&&(l=e.create(this.editor.window),l.setStart(h.nextSibling,
0),d.removeAllRanges(),d.addRange(l),c.scrollIntoView(h.nextSibling)),B=!1;else{n.blockNode===n.blockContainer?n.blockNode.appendChild(h):A.place(h,n.blockNode,"after");B=!1;n.blockNode.style&&h.style&&n.blockNode.style.cssText&&(h.style.cssText=n.blockNode.style.cssText);if((m=l.startContainer)&&3==m.nodeType){u=l.endOffset;m.length<u&&(u=this._adjustNodeAndOffset(m,u),m=u.node,u=u.offset);k=m.nodeValue;x=a.createTextNode(k.substring(0,u));u=a.createTextNode(k.substring(u,k.length));A.place(x,m,
"before");A.place(u,m,"after");A.destroy(m);for(l=x.parentNode;l!==n.blockNode;){k=a.createElement(l.tagName);l.style&&k.style&&l.style.cssText&&(k.style.cssText=l.style.cssText);"FONT"===l.tagName&&(l.color&&(k.color=l.color),l.face&&(k.face=l.face),l.size&&(k.size=l.size));for(;u;)m=u.nextSibling,k.appendChild(u),u=m;A.place(k,l,"after");x=l;u=k;l=l.parentNode}if(1==u.nodeType||3==u.nodeType&&u.nodeValue)h.innerHTML="";for(x=u;u;)m=u.nextSibling,h.appendChild(u),u=m}l=e.create(this.editor.window);
a=x;if("BR"!==this.blockNodeForEnter){for(;a;)b=a,a=m=a.firstChild;b&&b.parentNode?(h=b.parentNode,l.setStart(h,0),d.removeAllRanges(),d.addRange(l),this.editor.height&&c.scrollIntoView(h),f("mozilla")&&(this._pressedEnterInBlock=n.blockNode)):B=!0}else l.setStart(h,0),d.removeAllRanges(),d.addRange(l),this.editor.height&&c.scrollIntoView(h),f("mozilla")&&(this._pressedEnterInBlock=n.blockNode)}return B},_adjustNodeAndOffset:function(d,b){for(;d.length<b&&d.nextSibling&&3==d.nextSibling.nodeType;)b-=
d.length,d=d.nextSibling;return{node:d,offset:b}},removeTrailingBr:function(d){if(d=/P|DIV|LI/i.test(d.tagName)?d:this.editor.selection.getParentOfType(d,["P","DIV","LI"]))d.lastChild&&(1<d.childNodes.length&&3==d.lastChild.nodeType&&/^[\s\xAD]*$/.test(d.lastChild.nodeValue)||"BR"==d.lastChild.tagName)&&A.destroy(d.lastChild),d.childNodes.length||(d.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G,y,J,M,ba){var W=F("dijit._editor.RichText",[r,w],{constructor:function(E){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};E&&b.isString(E.value)&&(this.value=E.value);this.onLoadDeferred=new D},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[b.trim,b.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);n("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));n("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(n("ie")||n("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[b.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[b.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);x.publish(ba._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var E=b.hitch(this,function(P,S){return function(){return!this.execCommand(P,S)}}),O={b:E("bold"),i:E("italic"),u:E("underline"),a:E("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:E("formatblock",
"h1"),2:E("formatblock","h2"),3:E("formatblock","h3"),4:E("formatblock","h4"),"\\":E("insertunorderedlist")};n("ie")||(O.Z=E("redo"));for(var H in O)this.addKeyHandler(H,!0,!1,O[H])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(W._editorCommandsLocalized)this._local2NativeFormatNames=W._local2NativeFormatNames,this._native2LocalFormatNames=W._native2LocalFormatNames;else{W._editorCommandsLocalized=!0;W._local2NativeFormatNames={};
W._native2LocalFormatNames={};this._local2NativeFormatNames=W._local2NativeFormatNames;this._native2LocalFormatNames=W._native2LocalFormatNames;for(var E="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),O="",H,P=0;H=E[P++];)O="l"!==H.charAt(1)?O+("\x3c"+H+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+H+"\x3e\x3cbr/\x3e"):O+("\x3c"+H+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+H+"\x3e\x3cbr/\x3e");var S=c.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:O});this.ownerDocumentBody.appendChild(S);
E=b.hitch(this,function(){for(var V=S.firstChild;V;)try{this.selection.selectElement(V.firstChild);var Z=V.tagName.toLowerCase();this._local2NativeFormatNames[Z]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[Z]]=Z;V=V.nextSibling.nextSibling}catch(da){}c.destroy(S)});this.defer(E)}},open:function(E){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new D;this.isClosed||this.close();x.publish(ba._scopeName+"._editor.RichText::open",
this);1===arguments.length&&E.nodeName&&(this.domNode=E);var O=this.domNode;if(b.isString(this.value)){var H=this.value;O.innerHTML=""}else if(O.nodeName&&"textarea"==O.nodeName.toLowerCase()){var P=this.textarea=O;this.name=P.name;H=P.value;O=this.domNode=this.ownerDocument.createElement("div");O.setAttribute("widgetId",this.id);P.removeAttribute("widgetId");O.cssText=P.cssText;O.className+=" "+P.className;c.place(O,P,"before");var S=b.hitch(this,function(){q.set(P,{display:"block",position:"absolute",
top:"-1000px"});if(n("ie")){var L=P.style;this.__overflow=L.overflow;L.overflow="hidden"}});n("ie")?this.defer(S,10):S();if(P.form){var V=P.value;this.reset=function(){this.getValue()!==V&&this.replaceValue(V)};a(P.form,"submit",b.hitch(this,function(){f.set(P,"disabled",this.disabled);P.value=this.getValue()}))}}else H=J.getChildrenHtml(O),O.innerHTML="";this.value=H;O.nodeName&&"LI"===O.nodeName&&(O.innerHTML=" \x3cbr\x3e");this.header=O.ownerDocument.createElement("div");O.appendChild(this.header);
this.editingArea=O.ownerDocument.createElement("div");O.appendChild(this.editingArea);this.footer=O.ownerDocument.createElement("div");O.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!A.useXDomain||A.allowXdRichTextSave)){if((H=g.byId(ba._scopeName+"._editor.RichText.value"))&&""!==H.value){S=H.value.split(this._SEPARATOR);for(var Z=0,da;da=S[Z++];)if(da=da.split(this._NAME_CONTENT_SEP),da[0]===this.name){this.value=da[1];S=S.splice(Z,1);H.value=S.join(this._SEPARATOR);
break}}W._globalSaveHandler||(W._globalSaveHandler={},u.addOnUnload(function(){for(var L in W._globalSaveHandler){var R=W._globalSaveHandler[L];b.isFunction(R)&&R()}}));W._globalSaveHandler[this.id]=b.hitch(this,"_saveContent")}this.isClosed=!1;H=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");H.id=this.id+"_iframe";H.style.border="none";H.style.width="100%";this._layoutMode?H.style.height="100%":7<=n("ie")?(this.height&&(H.style.height=this.height),this.minHeight&&(H.style.minHeight=
this.minHeight)):H.style.height=this.height?this.height:this.minHeight;H.frameBorder=0;H._loadFunc=b.hitch(this,function(L){this.window=L;this.document=L.document;this.selection=new G.SelectionManager(L);n("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});S=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");S=11>n("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+S+"');document.close()":"javascript: '"+
S+"'";this.editingArea.appendChild(H);H.src=S;"LI"===O.nodeName&&(O.lastChild.style.marginTop="-1.2em");t.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var E=q.getComputedStyle(this.domNode);if(this["aria-label"])var O=this["aria-label"];else{var H=m('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||g.byId(this["aria-labelledby"],this.ownerDocument);H&&(O=H.textContent||H.innerHTML||"")}H="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(O?" aria-label\x3d'"+k.escape(O)+"'":"")+"\x3e\x3c/div\x3e";var P=[E.fontWeight,E.fontSize,E.fontFamily].join(" "),S=E.lineHeight;S=0<=S.indexOf("px")?parseFloat(S)/parseFloat(E.fontSize):0<=S.indexOf("em")?parseFloat(S):"normal";var V="",Z=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(da){da=da.replace(/^;/ig,"")+";";var L=da.split(":")[0];if(L){L=b.trim(L);L=L.toLowerCase();var R,aa="";for(R=0;R<L.length;R++){var ia=L.charAt(R);switch(ia){case "-":R++,ia=L.charAt(R).toUpperCase();
default:aa+=ia}}q.set(Z.domNode,aa,"")}V+=da+";"});this.iframe.setAttribute("title",O);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||e.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",O?"\x3ctitle\x3e"+k.escape(O)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",P,";\n",this.height||n("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",S,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",n("ie")||n("trident")||n("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",O?" aria-label\x3d'"+k.escape(O)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+V+"'\x3e",H,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var E=[];this.styleSheets&&(E=this.styleSheets.split(";"),this.styleSheets=
"");E=E.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var O="",H=0,P,S=h.get(this.ownerDocument);P=E[H++];)P=(new B(S.location,P)).toString(),this.editingAreaStyleSheets.push(P),O+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+P+'"/\x3e';return O},addStyleSheet:function(E){var O=E.toString(),H=h.get(this.ownerDocument);if("."===O.charAt(0)||"/"!==O.charAt(0)&&!E.host)O=(new B(H.location,O)).toString();-1<N.indexOf(this.editingAreaStyleSheets,O)||(this.editingAreaStyleSheets.push(O),
this.onLoadDeferred.then(b.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(O);else{var P=this.document.getElementsByTagName("head")[0],S=this.document.createElement("link");S.rel="stylesheet";S.type="text/css";S.href=O;P.appendChild(S)}})))},removeStyleSheet:function(E){var O=E.toString(),H=h.get(this.ownerDocument);if("."===O.charAt(0)||"/"!==O.charAt(0)&&!E.host)O=(new B(H.location,O)).toString();E=N.indexOf(this.editingAreaStyleSheets,O);-1!==E&&(delete this.editingAreaStyleSheets[E],
m('link[href\x3d"'+O+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(E){E=!!E;this._set("disabled",E);if(this.isLoaded){var O=n("ie")&&(this.isLoaded||!this.focusOnLoad);O&&(this.editNode.unselectable="on");this.editNode.contentEditable=!E;this.editNode.tabIndex=E?"-1":this.tabIndex;O&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(n("mozilla")&&!E&&this._mozSettingProps){E=this._mozSettingProps;for(var H in E)if(E.hasOwnProperty(H))try{this.document.execCommand(H,
!1,E[H])}catch(P){}}this._disabledOK=!0}},onLoad:function(E){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=M.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var O=this;this.beforeIframeNode=c.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=c.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){O.editNode.focus()};this.focusNode=
this.editNode;var H=this.events.concat(this.captureEvents),P=this.iframe?this.document:this.editNode;this.own.apply(this,N.map(H,function(S){var V=S.toLowerCase().replace(/^on/,"");return a(P,V,b.hitch(this,S))},this));this.own(a(P,"mouseup",b.hitch(this,"onClick")));n("ie")&&(this.own(a(this.document,"mousedown",b.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);n("webkit")&&(this._webkitListener=this.own(a(this.document,"mouseup",b.hitch(this,"onDisplayChanged")))[0],this.own(a(this.document,
"mousedown",b.hitch(this,function(S){S=S.target;!S||S!==this.document.body&&S!==this.document||this.defer("placeCursorAtEnd")}))));if(n("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(S){}this.isLoaded=!0;this.set("disabled",this.disabled);H=b.hitch(this,function(){this.setValue(E);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&l(b.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(H):H()},onKeyDown:function(E){if(E.keyCode===d.SHIFT||E.keyCode===d.ALT||E.keyCode===d.META||E.keyCode===d.CTRL)return!0;E.keyCode===d.TAB&&this.isTabIndent&&(E.stopPropagation(),E.preventDefault(),this.queryCommandEnabled(E.shiftKey?"outdent":"indent")&&this.execCommand(E.shiftKey?"outdent":"indent"));if(E.keyCode==d.TAB&&!this.isTabIndent&&!E.ctrlKey&&!E.altKey)return E.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>n("ie")&&E.keyCode===d.BACKSPACE&&"Control"===this.document.selection.type&&(E.stopPropagation(),E.preventDefault(),this.execCommand("delete"));n("ff")&&(E.keyCode===d.PAGE_UP||E.keyCode===d.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&E.preventDefault();var O=this._keyHandlers[E.keyCode],H=arguments;O&&!E.altKey&&N.some(O,function(P){if(!(P.shift^E.shiftKey||P.ctrl^(E.ctrlKey||E.metaKey)))return P.handler.apply(this,H)||E.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(E){e.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",E)},_setValueAttr:function(E){this.setValue(E)},_setDisableSpellCheckAttr:function(E){this.document?f.set(this.document.body,"spellcheck",!E):this.onLoadDeferred.then(b.hitch(this,function(){f.set(this.document.body,"spellcheck",!E)}));this._set("disableSpellCheck",E)},addKeyHandler:function(E,O,H,P){"string"==
typeof E&&(E=E.toUpperCase().charCodeAt(0));b.isArray(this._keyHandlers[E])||(this._keyHandlers[E]=[]);this._keyHandlers[E].push({shift:H||!1,ctrl:O||!1,handler:P})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(E){this.onDisplayChanged(E)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(E){(n("ie")||n("trident"))&&this.defer(function(){M.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var O=this.getValue(!0);if(O!==this.value)this.onChange(O);
this._set("value",O)},_onFocus:function(E){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!n("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>n("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(E,O){E=E.toLowerCase();"formatblock"===E?n("safari")&&void 0===O&&(E="heading"):"hilitecolor"!==E||n("mozilla")||(E="backcolor");return E},_implCommand:function(E){return"_"+this._normalizeCommand(E)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(E){var O=this._qcaCache[E];return void 0!==O?O:this._qcaCache[E]=this._queryCommandAvailable(E)},_queryCommandAvailable:function(E){switch(E.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return n("ie")||n("trident")||n("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!n("webkit");default:return!1}},execCommand:function(E,O){this.focused&&this.focus();E=this._normalizeCommand(E,O);if(void 0!==O){if("heading"===E)throw Error("unimplemented");"formatblock"===
E&&(n("ie")||n("trident"))&&(O="\x3c"+O+"\x3e")}var H="_"+E+"Impl";if(this[H])var P=this[H](O);else if((O=1<arguments.length?O:null)||"createlink"!==E)P=this.document.execCommand(E,!1,O);this.onDisplayChanged();return P},queryCommandEnabled:function(E){if(this.disabled||!this._disabledOK)return!1;E=this._normalizeCommand(E);var O=this._implCommand(E);return this[O]?this[O](E):this._browserQueryCommandEnabled(E)},queryCommandState:function(E){if(this.disabled||!this._disabledOK)return!1;E=this._normalizeCommand(E);
try{return this.document.queryCommandState(E)}catch(O){return!1}},queryCommandValue:function(E){if(this.disabled||!this._disabledOK)return!1;E=this._normalizeCommand(E);if(n("ie")&&"formatblock"===E)E=this._native2LocalFormatNames[this.document.queryCommandValue(E)];else if(n("mozilla")&&"hilitecolor"===E){try{var O=this.document.queryCommandValue("styleWithCSS")}catch(H){O=!1}this.document.execCommand("styleWithCSS",!1,!0);E=this.document.queryCommandValue(E);this.document.execCommand("styleWithCSS",
!1,O)}else E=this.document.queryCommandValue(E);return E},_sCall:function(E,O){return this.selection[E].apply(this.selection,O)},placeCursorAtStart:function(){this.focus();var E=!1;if(n("mozilla"))for(var O=this.editNode.firstChild;O;){if(3===O.nodeType){if(0<O.nodeValue.replace(/^\s+|\s+$/g,"").length){E=!0;this.selection.selectElement(O);break}}else if(1===O.nodeType){E=!0;var H=O.tagName?O.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(H)?this.selection.selectElement(O):
this.selection.selectElementChildren(O);break}O=O.nextSibling}else E=!0,this.selection.selectElementChildren(this.editNode);E&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var E=!1;if(n("mozilla"))for(var O=this.editNode.lastChild;O;){if(3===O.nodeType){if(0<O.nodeValue.replace(/^\s+|\s+$/g,"").length){E=!0;this.selection.selectElement(O);break}}else if(1===O.nodeType){E=!0;this.selection.selectElement(O.lastChild||O);break}O=O.previousSibling}else E=!0,this.selection.selectElementChildren(this.editNode);
E&&this.selection.collapse(!1)},getValue:function(E){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,E):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(E){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){E=this._preFilterContent(E);var O=this.isClosed?this.domNode:this.editNode;O.innerHTML=E;this._preDomFilterContent(O)}else this.textarea.value=E;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(b.hitch(this,function(){this.setValue(E)}))},replaceValue:function(E){this.isClosed?this.setValue(E):this.window&&this.window.getSelection&&!n("mozilla")?this.setValue(E):this.window&&this.window.getSelection?(E=this._preFilterContent(E),this.execCommand("selectall"),this.execCommand("inserthtml",E),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(E);this._set("value",this.getValue(!0))},_preFilterContent:function(E){var O=
E;N.forEach(this.contentPreFilters,function(H){H&&(O=H(O))});return O},_preDomFilterContent:function(E){E=E||this.editNode;N.forEach(this.contentDomPreFilters,function(O){O&&b.isFunction(O)&&O(E)},this)},_postFilterContent:function(E,O){if(b.isString(E))var H=E;else E=E||this.editNode,this.contentDomPostFilters.length&&(O&&(E=b.clone(E)),N.forEach(this.contentDomPostFilters,function(P){E=P(E)})),H=J.getChildrenHtml(E);b.trim(H.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(H="");N.forEach(this.contentPostFilters,
function(P){H=P(H)});return H},_saveContent:function(){var E=g.byId(ba._scopeName+"._editor.RichText.value");E&&(E.value&&(E.value+=this._SEPARATOR),E.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(E,O){E=E.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");O||(E=E.replace(/'/gm,"\x26#39;"));return E},getNodeHtml:function(E){e.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return J.getNodeHtml(E)},getNodeChildrenHtml:function(E){e.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return J.getChildrenHtml(E)},close:function(E){if(!this.isClosed){arguments.length||(E=!0);E&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);n("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var O=this.textarea.style;O.position="";O.left=O.top="";n("ie")&&(O.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;c.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;t.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);W._globalSaveHandler&&delete W._globalSaveHandler[this.id]},_removeMozBogus:function(E){return E.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(E){E=E.replace(/\sclass="webkit-block-placeholder"/gi,"");E=E.replace(/\sclass="apple-style-span"/gi,
"");return E=E.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(E){return E.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(E){return E.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(E){if(!E)return!1;
if(n("ie")||n("trident")||n("edge"))return this.focused&&!this.disabled;var O=9>n("ie")?this.document.selection.createRange():this.document;try{return O.queryCommandEnabled(E)}catch(H){return!1}},_createlinkEnabledImpl:function(){var E=!0;return E=n("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var E=!0;return E=n("mozilla")||n("webkit")||n("ie")||n("trident")||n("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var E=!0;return E=n("mozilla")||n("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var E=!0;n("webkit")?((E=this.window.getSelection())&&(E=E.toString()),E=!!E):E=this._browserQueryCommandEnabled("cut");return E},_copyEnabledImpl:function(){var E=!0;n("webkit")?((E=this.window.getSelection())&&(E=E.toString()),E=!!E):E=this._browserQueryCommandEnabled("copy");
return E},_pasteEnabledImpl:function(){var E=!0;return n("webkit")?!0:E=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(E){return n("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,E)},_unlinkImpl:function(E){return this.queryCommandEnabled("unlink")&&(n("mozilla")||n("webkit"))?(E=this.selection.getAncestorElement("a"),this.selection.selectElement(E),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,E)},_hilitecolorImpl:function(E){if(!this._handleTextColorOrProperties("hilitecolor",E))if(n("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);console.log("Executing color command.");var O=this.document.execCommand("hilitecolor",!1,E);this.document.execCommand("styleWithCSS",!1,!1)}else O=this.document.execCommand("hilitecolor",!1,E);return O},_backcolorImpl:function(E){n("ie")&&(E=E?E:null);var O=this._handleTextColorOrProperties("backcolor",E);O||(O=this.document.execCommand("backcolor",
!1,E));return O},_forecolorImpl:function(E){n("ie")&&(E=E?E:null);var O=!1;(O=this._handleTextColorOrProperties("forecolor",E))||(O=this.document.execCommand("forecolor",!1,E));return O},_inserthtmlImpl:function(E){E=this._preFilterContent(E);var O=!0;if(9>n("ie")){var H=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var P=H.item(0);H.length;)H.remove(H.item(0));P.outerHTML=E}else H.pasteHTML(E);H.select()}else if(8>n("trident")){var S=y.getSelection(this.window);
if(S&&S.rangeCount&&S.getRangeAt){H=S.getRangeAt(0);H.deleteContents();var V=c.create("div");V.innerHTML=E;for(P=this.document.createDocumentFragment();E=V.firstChild;)var Z=P.appendChild(E);H.insertNode(P);Z&&(H=H.cloneRange(),H.setStartAfter(Z),H.collapse(!1),S.removeAllRanges(),S.addRange(H))}}else n("mozilla")&&!E.length?this.selection.remove():O=this.document.execCommand("inserthtml",!1,E);return O},_boldImpl:function(E){var O=!1;if(n("ie")||n("trident"))this._adaptIESelection(),O=this._adaptIEFormatAreaAndExec("bold");
O||(O=this.document.execCommand("bold",!1,E));return O},_italicImpl:function(E){var O=!1;if(n("ie")||n("trident"))this._adaptIESelection(),O=this._adaptIEFormatAreaAndExec("italic");O||(O=this.document.execCommand("italic",!1,E));return O},_underlineImpl:function(E){var O=!1;if(n("ie")||n("trident"))this._adaptIESelection(),O=this._adaptIEFormatAreaAndExec("underline");O||(O=this.document.execCommand("underline",!1,E));return O},_strikethroughImpl:function(E){var O=!1;if(n("ie")||n("trident"))this._adaptIESelection(),
O=this._adaptIEFormatAreaAndExec("strikethrough");O||(O=this.document.execCommand("strikethrough",!1,E));return O},_superscriptImpl:function(E){var O=!1;if(n("ie")||n("trident"))this._adaptIESelection(),O=this._adaptIEFormatAreaAndExec("superscript");O||(O=this.document.execCommand("superscript",!1,E));return O},_subscriptImpl:function(E){var O=!1;if(n("ie")||n("trident"))this._adaptIESelection(),O=this._adaptIEFormatAreaAndExec("subscript");O||(O=this.document.execCommand("subscript",!1,E));return O},
_fontnameImpl:function(E){if(n("ie")||n("trident"))var O=this._handleTextColorOrProperties("fontname",E);O||(O=this.document.execCommand("fontname",!1,E));return O},_fontsizeImpl:function(E){if(n("ie")||n("trident"))var O=this._handleTextColorOrProperties("fontsize",E);O||(O=this.document.execCommand("fontsize",!1,E));return O},_insertorderedlistImpl:function(E){var O=!1;if(n("ie")||n("trident")||n("edge"))O=this._adaptIEList("insertorderedlist",E);O||(O=this.document.execCommand("insertorderedlist",
!1,E));return O},_insertunorderedlistImpl:function(E){var O=!1;if(n("ie")||n("trident")||n("edge"))O=this._adaptIEList("insertunorderedlist",E);O||(O=this.document.execCommand("insertunorderedlist",!1,E));return O},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(E){var O=0;if(E&&E.childNodes){var H;for(H=0;H<E.childNodes.length;H++){var P=v.position(E.childNodes[H]);
O+=P.h}}return O},_isNodeEmpty:function(E,O){return 1===E.nodeType?0<E.childNodes.length?this._isNodeEmpty(E.childNodes[0],O):!0:3===E.nodeType?""===E.nodeValue.substring(O):!1},_removeStartingRangeFromRange:function(E,O){if(E.nextSibling)O.setStart(E.nextSibling,0);else{for(E=E.parentNode;E&&null==E.nextSibling;)E=E.parentNode;E&&O.setStart(E.nextSibling,0)}return O},_adaptIESelection:function(){var E=y.getSelection(this.window);if(E&&E.rangeCount&&!E.isCollapsed){for(var O=E.getRangeAt(0),H=O.startContainer,
P=O.startOffset;3===H.nodeType&&P>=H.length&&H.nextSibling;)P-=H.length,H=H.nextSibling;for(var S=null;this._isNodeEmpty(H,P)&&H!==S;)S=H,O=this._removeStartingRangeFromRange(H,O),H=O.startContainer,P=0;E.removeAllRanges();E.addRange(O)}},_adaptIEFormatAreaAndExec:function(E){var O=y.getSelection(this.window),H=this.document,P;if(E&&O&&O.isCollapsed){if(this.queryCommandValue(E)){E=this._tagNamesForCommand(E);var S=O.getRangeAt(0);var V=S.startContainer;if(3===V.nodeType){var Z=S.endOffset;V.length<
Z&&(Z=this._adjustNodeAndOffset(da,Z),V=Z.node,Z=Z.offset)}for(;V&&V!==this.editNode;){var da=V.tagName?V.tagName.toLowerCase():"";if(-1<N.indexOf(E,da)){var L=V;break}V=V.parentNode}if(L&&(da=S.startContainer,E=H.createElement(L.tagName),c.place(E,L,"after"),da&&3===da.nodeType)){Z=S.endOffset;da.length<Z&&(Z=this._adjustNodeAndOffset(da,Z),da=Z.node,Z=Z.offset);V=da.nodeValue;S=H.createTextNode(V.substring(0,Z));var R=V.substring(Z,V.length);R&&(P=H.createTextNode(R));c.place(S,da,"before");if(P){var aa=
H.createElement("span");aa.className="ieFormatBreakerSpan";c.place(aa,da,"after");c.place(P,aa,"after");P=aa}c.destroy(da);Z=S.parentNode;for(da=[];Z!==L;){V=Z.tagName;S={tagName:V};da.push(S);V=H.createElement(V);Z.style&&V.style&&Z.style.cssText&&(V.style.cssText=Z.style.cssText,S.cssText=Z.style.cssText);"FONT"===Z.tagName&&(Z.color&&(V.color=Z.color,S.color=Z.color),Z.face&&(V.face=Z.face,S.face=Z.face),Z.size&&(V.size=Z.size,S.size=Z.size));Z.className&&(V.className=Z.className,S.className=Z.className);
if(P)for(;P;)S=P.nextSibling,V.appendChild(P),P=S;V.tagName==Z.tagName?(aa=H.createElement("span"),aa.className="ieFormatBreakerSpan",c.place(aa,Z,"after"),c.place(V,aa,"after")):c.place(V,Z,"after");S=Z;P=V;Z=Z.parentNode}if(P){if(1===P.nodeType||3===P.nodeType&&P.nodeValue)E.innerHTML="";for(;P;)S=P.nextSibling,E.appendChild(P),P=S}if(da.length){S=da.pop();P=H.createElement(S.tagName);S.cssText&&P.style&&(P.style.cssText=S.cssText);S.className&&(P.className=S.className);"FONT"===S.tagName&&(S.color&&
(P.color=S.color),S.face&&(P.face=S.face),S.size&&(P.size=S.size));for(c.place(P,E,"before");da.length;)S=da.pop(),L=H.createElement(S.tagName),S.cssText&&L.style&&(L.style.cssText=S.cssText),S.className&&(L.className=S.className),"FONT"===S.tagName&&(S.color&&(L.color=S.color),S.face&&(L.face=S.face),S.size&&(L.size=S.size)),P.appendChild(L),P=L;L=H.createTextNode(".");aa.appendChild(L);P.appendChild(L)}else aa=H.createElement("span"),aa.className="ieFormatBreakerSpan",L=H.createTextNode("."),aa.appendChild(L),
c.place(aa,E,"before");P=y.create(this.window);P.setStart(L,0);P.setEnd(L,L.length);O.removeAllRanges();O.addRange(P);this.selection.collapse(!1);L.parentNode.innerHTML="";E.firstChild||c.destroy(E);return!0}return!1}S=O.getRangeAt(0);if((da=S.startContainer)&&3===da.nodeType)return Z=S.startOffset,da.length<Z&&(Z=this._adjustNodeAndOffset(da,Z),da=Z.node,Z=Z.offset),V=da.nodeValue,S=H.createTextNode(V.substring(0,Z)),R=V.substring(Z),""!==R&&(P=H.createTextNode(V.substring(Z))),aa=H.createElement("span"),
L=H.createTextNode("."),aa.appendChild(L),S.length?c.place(S,da,"after"):S=da,c.place(aa,S,"after"),P&&c.place(P,aa,"after"),c.destroy(da),P=y.create(this.window),P.setStart(L,0),P.setEnd(L,L.length),O.removeAllRanges(),O.addRange(P),H.execCommand(E),c.place(aa.firstChild,aa,"before"),c.destroy(aa),P.setStart(L,0),P.setEnd(L,L.length),O.removeAllRanges(),O.addRange(P),this.selection.collapse(!1),L.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(E){var O=y.getSelection(this.window);
if(O.isCollapsed&&O.rangeCount&&!this.queryCommandValue(E)){var H=O.getRangeAt(0),P=H.startContainer;if(P&&3==P.nodeType&&!H.startOffset)return H="ul","insertorderedlist"===E&&(H="ol"),E=this.document.createElement(H),H=c.create("li",null,E),c.place(E,P,"before"),H.appendChild(P),c.create("br",null,E,"after"),E=y.create(this.window),E.setStart(P,0),E.setEnd(P,P.length),O.removeAllRanges(),O.addRange(E),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(E,O){var H=y.getSelection(this.window),
P=this.document,S,V;O=O||null;if(E&&H&&H.isCollapsed&&H.rangeCount){var Z=H.getRangeAt(0);if((S=Z.startContainer)&&3===S.nodeType){var da=Z.startOffset;S.length<da&&(Z=this._adjustNodeAndOffset(S,da),S=Z.node,da=Z.offset);var L=S.nodeValue;Z=P.createTextNode(L.substring(0,da));""!==L.substring(da)&&(V=P.createTextNode(L.substring(da)));L=P.createElement("span");da=P.createTextNode(".");L.appendChild(da);P=P.createElement("span");L.appendChild(P);Z.length?c.place(Z,S,"after"):Z=S;c.place(L,Z,"after");
V&&c.place(V,L,"after");c.destroy(S);S=y.create(this.window);S.setStart(da,0);S.setEnd(da,da.length);H.removeAllRanges();H.addRange(S);if(n("webkit")){H="color";if("hilitecolor"===E||"backcolor"===E)H="backgroundColor";q.set(L,H,O);this.selection.remove();c.destroy(P);L.innerHTML="\x26#160;";this.selection.selectElement(L);this.focus()}else this.execCommand(E,O),c.place(L.firstChild,L,"before"),c.destroy(L),S.setStart(da,0),S.setEnd(da,da.length),H.removeAllRanges(),H.addRange(S),this.selection.collapse(!1),
da.parentNode.removeChild(da);return!0}}return!1},_adjustNodeAndOffset:function(E,O){for(;E.length<O&&E.nextSibling&&3===E.nextSibling.nodeType;)O-=E.length,E=E.nextSibling;return{node:E,offset:O}},_tagNamesForCommand:function(E){return"bold"===E?["b","strong"]:"italic"===E?["i","em"]:"strikethrough"===E?["s","strike"]:"superscript"===E?["sup"]:"subscript"===E?["sub"]:"underline"===E?["u"]:[]},_stripBreakerNodes:function(E){if(this.isLoaded)return m(".ieFormatBreakerSpan",E).forEach(function(O){for(;O.firstChild;)c.place(O.firstChild,
O,"before");c.destroy(O)}),E},_stripTrailingEmptyNodes:function(E){function O(H){return/^(p|div|br)$/i.test(H.nodeName)&&0==H.children.length&&/^[\s\xA0]*$/.test(H.textContent||H.innerText||"")||3===H.nodeType&&/^[\s\xA0]*$/.test(H.nodeValue)}for(;E.lastChild&&O(E.lastChild);)c.destroy(E.lastChild);return E},_setTextDirAttr:function(E){this._set("textDir",E);this.onLoadDeferred.then(b.hitch(this,function(){this.editNode.dir=E}))}});return W})},"dijit/_editor/range":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/_base/lang"],function(N,A,F){var D={getIndex:function(t,c){for(var v=[],q=[],e=t,d,b;t!=c;){var a=0;for(d=t.parentNode;b=d.childNodes[a++];)if(b===t){--a;break}v.unshift(a);q.unshift(a-d.childNodes.length);t=d}if(0<v.length&&3==e.nodeType){for(b=e.previousSibling;b&&3==b.nodeType;)v[v.length-1]--,b=b.previousSibling;for(b=e.nextSibling;b&&3==b.nodeType;)q[q.length-1]++,b=b.nextSibling}return{o:v,r:q}},getNode:function(t,c){if(!F.isArray(t)||0==t.length)return c;var v=c;
N.every(t,function(q){if(0<=q&&q<v.childNodes.length)v=v.childNodes[q];else return v=null,!1;return!0});return v},getCommonAncestor:function(t,c,v){v=v||t.ownerDocument.body;var q=function(b){for(var a=[];b;)if(a.unshift(b),b!==v)b=b.parentNode;else break;return a};t=q(t);c=q(c);q=Math.min(t.length,c.length);for(var e=t[0],d=1;d<q;d++)if(t[d]===c[d])e=t[d];else break;return e},getAncestor:function(t,c,v){for(v=v||t.ownerDocument.body;t&&t!==v;){var q=t.nodeName.toUpperCase();if(c.test(q))return t;
t=t.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(t,c,v){v=v||t.ownerDocument.body;c=c||D.BlockTagNames;for(var q=null,e;t&&t!==v;){var d=t.nodeName.toUpperCase();!q&&c.test(d)&&(q=t);!e&&/^(?:BODY|TD|TH|CAPTION)$/.test(d)&&(e=t);t=t.parentNode}return{blockNode:q,blockContainer:e||t.ownerDocument.body}},atBeginningOfContainer:function(t,c,v){var q=!1,e=0==v;e||3!=c.nodeType||/^[\s\xA0]+$/.test(c.nodeValue.substr(0,v))&&(e=
!0);if(e)for(q=!0;c&&c!==t;){if(c.previousSibling){q=!1;break}c=c.parentNode}return q},atEndOfContainer:function(t,c,v){var q=!1,e=v==(c.length||c.childNodes.length);e||3!=c.nodeType||/^[\s\xA0]+$/.test(c.nodeValue.substr(v))&&(e=!0);if(e)for(q=!0;c&&c!==t;){if(c.nextSibling){q=!1;break}c=c.parentNode}return q},adjacentNoneTextNode:function(t,c){var v=t;t=0-t.length||0;for(c=c?"nextSibling":"previousSibling";v&&3==v.nodeType;)t+=v.length,v=v[c];return[v,t]},create:function(t){t=t||window;return t.getSelection?
t.document.createRange():new f},getSelection:function(t,c){if(t.getSelection)return t.getSelection();t=new g.selection(t);c||t._getCurrentSelection();return t}};if(!window.getSelection)var g=D.ie={cachedSelection:{},selection:function(t){this._ranges=[];this.addRange=function(c,v){this._ranges.push(c);v||c._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(c){return this._ranges[c]};this._getCurrentSelection=function(){this.removeAllRanges();
var c=t.document.selection.createRange();c="CONTROL"==t.document.selection.type.toUpperCase()?new f(g.decomposeControlRange(c)):new f(g.decomposeTextRange(c));this.addRange(c,!0),this.isCollapsed=c.collapsed}},decomposeControlRange:function(t){var c=t.item(0),v=t.item(t.length-1);t=c.parentNode;var q=v.parentNode;c=D.getIndex(c,t).o[0];v=D.getIndex(v,q).o[0]+1;return[t,c,q,v]},getEndPoint:function(t,c){var v=t.duplicate();v.collapse(!c);var q="EndTo"+(c?"End":"Start"),e=v.parentElement(),d;if(0<e.childNodes.length)N.every(e.childNodes,
function(m,l){if(3!=m.nodeType)if(v.moveToElementText(m),0<v.compareEndPoints(q,t))if(d&&3==d.nodeType){b=d;var n=!0}else return b=e,a=l,!1;else{if(l==e.childNodes.length-1)return b=e,a=e.childNodes.length,!1}else l==e.childNodes.length-1&&(b=m,n=!0);if(n&&b)return b=(m=D.adjacentNoneTextNode(b)[0])?m.nextSibling:e.firstChild,l=D.adjacentNoneTextNode(b),m=l[0],l=l[1],m?(v.moveToElementText(m),v.collapse(!1)):v.moveToElementText(e),v.setEndPoint(q,t),a=v.text.length-l,!1;d=m;return!0});else{var b=
e;var a=0}c||1!=b.nodeType||a!=b.childNodes.length||(c=b.nextSibling)&&3==c.nodeType&&(b=c,a=0);return[b,a]},setEndPoint:function(t,c,v){t=t.duplicate();var q;if(3!=c.nodeType)if(0<v){if(q=c.childNodes[v-1])if(3==q.nodeType)c=q,v=q.length;else if(q.nextSibling&&3==q.nextSibling.nodeType)c=q.nextSibling,v=0;else{t.moveToElementText(q.nextSibling?q:c);var e=q.parentNode;q=e.insertBefore(q.ownerDocument.createTextNode(" "),q.nextSibling);t.collapse(!1);e.removeChild(q)}}else t.moveToElementText(c),t.collapse(!0);
3==c.nodeType&&(q=D.adjacentNoneTextNode(c),e=q[0],q=q[1],e?(t.moveToElementText(e),t.collapse(!1),"inherit"!=e.contentEditable&&q++):(t.moveToElementText(c.parentNode),t.collapse(!0),t.move("character",1),t.move("character",-1)),v+=q,0<v&&t.move("character",v)!=v&&console.error("Error when moving!"));return t},decomposeTextRange:function(t){var c=g.getEndPoint(t),v=c[0],q=c[1],e=c[0];c=c[1];t.htmlText.length&&(t.htmlText==t.text?c=q+t.text.length:(c=g.getEndPoint(t,!0),e=c[0],c=c[1]));return[v,q,
e,c]},setRange:function(t,c,v,q,e,d){c=g.setEndPoint(t,c,v);t.setEndPoint("StartToStart",c);if(!d)var b=g.setEndPoint(t,q,e);t.setEndPoint("EndToEnd",b||c);return t}},f=D.W3CRange=A(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=
this.startContainer!==this.endContainer?D.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(t,c){c=parseInt(c);if(this.startContainer!==t||this.startOffset!=c)delete this._cachedBookmark,this.startContainer=t,this.startOffset=c,this.endContainer?this._updateInternal():this.setEnd(t,c)},setEnd:function(t,c){c=parseInt(c);if(this.endContainer!==t||this.endOffset!=c)delete this._cachedBookmark,
this.endContainer=t,this.endOffset=c,this.startContainer?this._updateInternal():this.setStart(t,c)},setStartAfter:function(t,c){this._setPoint("setStart",t,c,1)},setStartBefore:function(t,c){this._setPoint("setStart",t,c,0)},setEndAfter:function(t,c){this._setPoint("setEnd",t,c,1)},setEndBefore:function(t,c){this._setPoint("setEnd",t,c,0)},_setPoint:function(t,c,v,q){v=D.getIndex(c,c.parentNode).o;this[t](c.parentNode,v.pop()+q)},_getIERange:function(){var t=(this._body||this.endContainer.ownerDocument.body).createTextRange();
g.setRange(t,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return t},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var t=this.startContainer,c=this._getIERange();3!==t.nodeType||this.startOffset||this.setStartBefore(t);c.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var t=new f([this.startContainer,
this.startOffset,this.endContainer,this.endOffset]);t._body=this._body;return t},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});F.setObject("dijit.range",D);return D})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(N,A,F){var D={};A.setObject("dijit._editor.html",D);var g=D.escapeXml=function(f,t){f=f.replace(/&/gm,"\x26amp;").replace(/</gm,
"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");t||(f=f.replace(/'/gm,"\x26#39;"));return f};D.getNodeHtml=function(f){var t=[];D.getNodeHtmlHelper(f,t);return t.join("")};D.getNodeHtmlHelper=function(f,t){switch(f.nodeType){case 1:var c=f.nodeName.toLowerCase();if(!c||"/"==c.charAt(0))return"";t.push("\x3c",c);var v=[],q={},e;if(F("dom-attributes-explicit")||F("dom-attributes-specified-flag"))for(var d=0;e=f.attributes[d++];){var b=e.name;"_dj"===b.substr(0,3)||F("dom-attributes-specified-flag")&&
!e.specified||b in q||(e=e.value,("src"==b||"href"==b)&&f.getAttribute("_djrealurl")&&(e=f.getAttribute("_djrealurl")),8===F("ie")&&"style"===b&&(e=e.replace("HEIGHT:","height:").replace("WIDTH:","width:")),v.push([b,e]),q[b]=e)}else{var a=(/^input$|^img$/i.test(f.nodeName)?f:f.cloneNode(!1)).outerHTML;q=a.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);a=a.substr(0,a.indexOf("\x3e"));N.forEach(q,function(m){if(m){var l=m.indexOf("\x3d");if(0<l&&(m=m.substring(0,l),"_dj"!=m.substr(0,3)))if("src"!=m&&"href"!=
m||!f.getAttribute("_djrealurl")){switch(m){case "style":var n=f.style.cssText.toLowerCase();break;case "class":n=f.className;break;case "width":if("img"===c){(l=/width=(\S+)/i.exec(a))&&(n=l[1]);break}case "height":if("img"===c){(l=/height=(\S+)/i.exec(a))&&(n=l[1]);break}default:n=f.getAttribute(m)}null!=n&&v.push([m,n.toString()])}else v.push([m,f.getAttribute("_djrealurl")])}},this)}v.sort(function(m,l){return m[0]<l[0]?-1:m[0]==l[0]?0:1});for(q=0;e=v[q++];)t.push(" ",e[0],'\x3d"',"string"===
typeof e[1]?g(e[1],!0):e[1],'"');switch(c){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":t.push(" /\x3e");break;case "script":t.push("\x3e",f.innerHTML,"\x3c/",c,"\x3e");break;default:t.push("\x3e"),f.hasChildNodes()&&D.getChildrenHtmlHelper(f,t),t.push("\x3c/",c,"\x3e")}break;case 4:case 3:t.push(g(f.nodeValue,!0));break;case 8:t.push("\x3c!--",g(f.nodeValue,!0),"--\x3e");break;default:t.push("\x3c!-- Element not recognized - Type: ",f.nodeType," Name: ",
f.nodeName,"--\x3e")}};D.getChildrenHtml=function(f){var t=[];D.getChildrenHtmlHelper(f,t);return t.join("")};D.getChildrenHtmlHelper=function(f,t){if(f)for(var c=f.childNodes||f,v=!F("ie")||c!==f,q,e=0;q=c[e++];)v&&q.parentNode!=f||D.getNodeHtmlHelper(q,t)};return D})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b){var a=F("dijit._editor.plugins.LinkDialog",e,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:d,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=f.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(l){N("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),f.hitch(this,function(n,k,x){var u=this;this.tag="insertImage"==this.command?"img":"a";n=f.delegate(n.getLocalization("dijit","common",this.lang),n.getLocalization("dijit._editor",
"LinkDialog",this.lang));var B=this.dropDown=this.button.dropDown=new k({title:n[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:f.hitch(this,"setValue"),onOpen:function(){u._onOpenDialog();k.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(f.hitch(u,"_onCloseDialog"),0)}});n.urlRegExp=this.urlRegExp;n.id=x.getUniqueId(this.editor.id);this._uniqueId=n.id;this._setContent(B.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
q.substitute(this.linkDialogTemplate,n));B.startup();this._urlInput=x.byId(this._uniqueId+"_urlInput");this._textInput=x.byId(this._uniqueId+"_textInput");this._setButton=x.byId(this._uniqueId+"_setButton");this.own(x.byId(this._uniqueId+"_cancelButton").on("click",f.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",f.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",f.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=f.hitch(this,function(){var h=this._urlInput.get("value");return this._urlRegExp.test(h)||this._emailRegExp.test(h)});this.own(t(B.domNode,"keydown",f.hitch(this,f.hitch(this,function(h){!h||h.keyCode!=g.ENTER||h.shiftKey||h.metaKey||h.ctrlKey||h.altKey||this._setButton.get("disabled")||(B.onExecute(),B.execute(B.get("value")))}))));l()}))},_checkAndFixInput:function(){var l=this,n=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var k=n,x=!1,u=!1;k&&1<k.length&&(k=f.trim(k),0!==k.indexOf("mailto:")&&(0<k.indexOf("/")?-1===k.indexOf("://")&&"/"!==k.charAt(0)&&k.indexOf("./")&&0!==k.indexOf("../")&&l._hostRxp.test(k)&&(x=!0):l._userAtRxp.test(k)&&(u=!0)));x&&l._urlInput.set("value","http://"+k);u&&l._urlInput.set("value","mailto:"+k);l._setButton.set("disabled",!l._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(f.hitch(this,
function(){this.own(t(this.editor.editNode,"mouseup",f.hitch(this,"_onMouseUp")));this.own(t(this.editor.editNode,"dblclick",f.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(l){this.dropDown.set({parserScope:"dojo",content:l})},_checkValues:function(l){l&&l.urlInput&&(l.urlInput=l.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&l&&l.textInput&&("function"===typeof this.linkFilter?l.textInput=this.linkFilter(l.textInput):
A.forEach(this.linkFilter,function(n){l.textInput=l.textInput.replace(n[0],n[1])}));return l},_createlinkEnabledImpl:function(){return!0},setValue:function(l){this._onCloseDialog();if(9>c("ie")){var n=b.getSelection(this.editor.window).getRangeAt(0).endContainer;3===n.nodeType&&(n=n.parentNode);n&&n.nodeName&&n.nodeName.toLowerCase()!==this.tag&&(n=this.editor.selection.getSelectedElement(this.tag));n&&n.nodeName&&n.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(n),
this.editor.execCommand("unlink"))}l=this._checkValues(l);this.editor.execCommand("inserthtml",q.substitute(this.htmlTemplate,l));v("a",this.editor.document).forEach(function(k){k.innerHTML||D.has(k,"name")||k.parentNode.removeChild(k)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(l){if(l&&l.tagName.toLowerCase()===this.tag){var n=l.getAttribute("_djrealurl")||l.getAttribute("href");var k=l.getAttribute("target")||"_self";var x=l.textContent||
l.innerText;this.editor.selection.selectElement(l,!0)}else x=this.editor.selection.getSelectedText();return{urlInput:n||"",textInput:x||"",targetSelect:k||""}},_onOpenDialog:function(){if(c("ie")){var l=b.getSelection(this.editor.window);if(l.rangeCount){var n=l.getRangeAt(0);var k=n.endContainer;3===k.nodeType&&(k=k.parentNode);k&&k.nodeName&&k.nodeName.toLowerCase()!==this.tag&&(k=this.editor.selection.getSelectedElement(this.tag));if(!k||k.nodeName&&k.nodeName.toLowerCase()!==this.tag)(l=this.editor.selection.getAncestorElement(this.tag))&&
l.nodeName&&l.nodeName.toLowerCase()==this.tag?(k=l,this.editor.selection.selectElement(k)):n.startContainer===n.endContainer&&(l=n.startContainer.firstChild)&&l.nodeName&&l.nodeName.toLowerCase()==this.tag&&(k=l,this.editor.selection.selectElement(k))}}else k=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(k))},_onDblClick:function(l){if(l&&l.target&&(l=l.target,(l.tagName?l.tagName.toLowerCase():
"")===this.tag&&D.get(l,"href"))){var n=this.editor;this.editor.selection.selectElement(l);n.onDisplayChanged();n._updateTimer&&(n._updateTimer.remove(),delete n._updateTimer);n.onNormalizedDisplayChanged();var k=this.button;setTimeout(function(){k.set("disabled",!1);k.loadAndOpenDropDown().then(function(){k.dropDown.focus&&k.dropDown.focus()})},10)}},_onMouseUp:function(){if(c("ff")){var l=this.editor.selection.getAncestorElement(this.tag);if(l){var n=b.getSelection(this.editor.window).getRangeAt(0);
if(n.collapsed&&l.childNodes.length){var k=n.cloneRange();k.selectNodeContents(l.childNodes[l.childNodes.length-1]);k.setStart(l.childNodes[0],0);1!==n.compareBoundaryPoints(k.START_TO_START,k)?n.setStartBefore(l):-1!==n.compareBoundaryPoints(k.END_TO_START,k)&&n.setStartAfter(l)}}}}}),m=F("dijit._editor.plugins.ImgLinkDialog",[a],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(l){if(l&&l.tagName.toLowerCase()===this.tag){var n=l.getAttribute("_djrealurl")||l.getAttribute("src");var k=l.getAttribute("alt");this.editor.selection.selectElement(l,!0)}else k=this.editor.selection.getSelectedText();return{urlInput:n||"",textInput:k||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(f.hitch(this,function(){this.own(t(this.editor.editNode,"mousedown",f.hitch(this,"_selectTag")))}))},_selectTag:function(l){l&&l.target&&(l=l.target,(l.tagName?l.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(l))},_checkValues:function(l){l&&l.urlInput&&(l.urlInput=l.urlInput.replace(/"/g,"\x26quot;"));l&&l.textInput&&(l.textInput=l.textInput.replace(/"/g,"\x26quot;"));return l},_onDblClick:function(l){if(l&&l.target&&(l=l.target,(l.tagName?
l.tagName.toLowerCase():"")===this.tag&&D.get(l,"src"))){var n=this.editor;this.editor.selection.selectElement(l);n.onDisplayChanged();n._updateTimer&&(n._updateTimer.remove(),delete n._updateTimer);n.onNormalizedDisplayChanged();var k=this.button;setTimeout(function(){k.set("disabled",!1);k.loadAndOpenDropDown().then(function(){k.dropDown.focus&&k.dropDown.focus()})},10)}}});e.registry.createLink=function(l){var n={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in l?l.allowUnsafeHtml:!1};
"linkFilter"in l&&(n.linkFilter=l.linkFilter);return new a(n)};e.registry.insertImage=function(){return new m({command:"insertImage"})};a.ImgLinkDialog=m;return a})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(N,A,F,D,g,f){var t=F("dijit._editor.plugins.TextColor",g,{buttonClass:f,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var c=this;this.button.loadDropDown=function(v){function q(e){c.button.dropDown=new e({dir:c.editor.dir,ownerDocument:c.editor.ownerDocument,value:c.value,onChange:function(d){c.editor.execCommand(c.command,d)},onExecute:function(){c.editor.execCommand(c.command,this.get("value"))}});v()}"string"==typeof c.colorPicker?N([c.colorPicker],q):q(c.colorPicker)}},updateState:function(){var c=this.editor,v=this.command;if(c&&c.isLoaded&&v.length){if(this.button){var q=this.get("disabled");
this.button.set("disabled",q);if(q)return;try{var e=c.queryCommandValue(v)||""}catch(d){e=""}}""==e&&(e="#000000");"transparent"==e&&(e="#ffffff");"string"==typeof e?-1<e.indexOf("rgb")&&(e=A.fromRgb(e).toHex()):(e=((e&255)<<16|e&65280|(e&16711680)>>>16).toString(16),e="#000000".slice(0,7-e.length)+e);this.value=e;(c=this.button.dropDown)&&c.get&&e!==c.get("value")&&c.set("value",e,!1)}}});g.registry.foreColor=function(c){return new t(c)};g.registry.hiliteColor=function(c){return new t(c)};return t})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n){N=N([q,e],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:l,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(k,x){A.mixin(this,n.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=F.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=F.connect(this._uploadField,"onfocus",A.hitch(this,function(k){m.hide(this._attachmentError)}))},destroy:function(){D.forEach(this._aeConnects,F.disconnect);F.disconnect(this._uploadField_connect);F.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(k,x){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";D.forEach(this.domNode.children,function(u,B){m.show(u)});m.hide(this._attachmentError);k&&(this._featureLayer=k.getLayer()||x)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:k}).canUpdate,this._oid=k.attributes[this._featureLayer.objectIdField],this._getAttachments(k)):x&&x.getEditCapabilities()||(m.hide(this._uploadForm),D.forEach(this.domNode.children,function(u,B){m.hide(u)})))},_getAttachments:function(k){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,A.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){m.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(m.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,A.hitch(this,"_onAddAttachmentComplete"),A.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(k,x){this._tempUpload&&(m.show(this._attachmentProgress),x.addAttachment(k,this._tempUpload,A.hitch(this,"_onAddAttachmentComplete"),A.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(k,
x){m.show(this._attachmentProgress);this._featureLayer.deleteAttachments(k,[x],A.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(k){var x=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(x=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(x=this._listHtml+this._endHtml);var u=this._attachmentList;k=D.map(k,A.hitch(this,function(B){return a.substitute({href:B.url,name:B.name,oid:B.objectId,attid:B.id},x)}));u.innerHTML=k.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(k){m.hide(this._attachmentProgress.domNode);var x=this._attachmentList,u=this._uploadField,B=u.value,h=B.lastIndexOf("\\");
-1<h&&(B=B.substring(h+1,B.length));B=B.replace(/ /g,"_");h=c.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var r=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(r=this._listHtml+this._endHtml);k=a.substitute({href:this._featureLayer._url.path+"/"+k.objectId+"/attachments/"+k.attachmentId+(h?"?"+h:""),name:B,oid:k.objectId,attid:k.attachmentId},
r);x.innerHTML=x.innerHTML==this.NLS_none?k:x.innerHTML+k;this._updateConnects();u.value=""},_onAddAttachmentError:function(k){m.hide(this._attachmentProgress.domNode);if(k&&a.isDefined(k.code)){var x=this._attachmentError;v.set(x,"innerHTML",(400===k.code?this.NLS_fileNotSupported:k.message||k.details&&k.details.length&&k.details[0])||this.NLS_error);m.show(x)}},_onDeleteAttachmentComplete:function(k){m.hide(this._attachmentProgress.domNode);var x=this._attachmentList;D.every(k,function(u){return u.success})&&
(g.query("#node_"+k[0].objectId+"_"+k[0].attachmentId).orphan(),x.children&&x.children.length||(x.innerHTML=this.NLS_none))},_updateConnects:function(){D.forEach(this._aeConnects,F.disconnect);g.query(".deleteAttachment").forEach(function(k){this._aeConnects.push(F.connect(k,"onclick",A.hitch(this,"_deleteAttachment",this._oid,k.id)))},this)}});f("extend-esri")&&A.setObject("dijit.editing.AttachmentEditor",N,b);return N})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(N,A,F,D,g,f,t,c){return A("dijit.ProgressBar",[f,t],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:c,_indeterminateHighContrastImagePath:N.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(v){var q="rtl"==v.toLowerCase();F.toggle(this.domNode,"dijitProgressBarRtl",q);F.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&q);this.inherited(arguments)},update:function(v){D.mixin(this,v||{});v=this.internalProgress;var q=this.domNode,e=1;this.indeterminate?q.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(e=Math.min(parseFloat(this.progress)/100,1),this.progress=e*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),e=this.maximum?this.progress/this.maximum:0),q.setAttribute("aria-valuenow",this.progress));q.setAttribute("aria-labelledby",this.labelNode.id);q.setAttribute("aria-valuemin",0);q.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(e);F.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);F.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());v.style.width=100*e+"%";this.onChange()},_setValueAttr:function(v){this._set("value",
v);Infinity==v?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:v})},_setLabelAttr:function(v){this._set("label",v);this.update()},_setIndeterminateAttr:function(v){this._set("indeterminate",v);this.update()},report:function(v){return this.label?this.label:this.indeterminate?"\x26#160;":g.format(v,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(N,A,F,D){var g={};g={findFeatures:function(f,t,c){var v=t.objectIdField;t=A.filter(t.graphics,function(q){return A.some(f,function(e){return q.attributes[v]===e.objectId})});if(c)c(t);else return t},getSelection:function(f){var t=[];A.forEach(f,function(c){c=c.getSelectedFeatures();A.forEach(c,function(v){t.push(v)})});return t},sortFeaturesById:function(f,t){var c=A.map(f,function(v){return v.featureLayer});t.sort(function(v,q){var e=v.getLayer(),d=q.getLayer();if(!e)return-1;if(!d)return 1;
var b=A.indexOf(c,e);d=A.indexOf(c,d);b-=d;b||(e=e.objectIdField,b=v.attributes[e]-q.attributes[e]);return b});return t}};F("extend-esri")&&N.setObject("dijit.editing.Util.LayerHelper",g,D);return g})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(N,A,F,D){var g=A.getObject("date.islamic",!0,N);g.getDaysInMonth=function(f){return f.getDaysInIslamicMonth(f.getMonth(),f.getFullYear())};g.compare=function(f,t,c){f instanceof D&&(f=f.toGregorian());
t instanceof D&&(t=t.toGregorian());return F.compare.apply(null,arguments)};g.add=function(f,t,c){var v=new D(f);switch(t){case "day":v.setDate(f.getDate()+c);break;case "weekday":var q=f.getDay();if(5>q+c&&0<q+c)v.setDate(f.getDate()+c);else{var e=t=0;5==q?(q=4,e=0<c?-1:1):6==q&&(q=4,e=0<c?-2:2);q=0<c?5-q-1:-q;var d=c-q,b=parseInt(d/5);0!=d%5&&(t=0<c?2:-2);t=t+7*b+d%5+q;v.setDate(f.getDate()+t+e)}break;case "year":v.setFullYear(f.getFullYear()+c);break;case "week":c*=7;v.setDate(f.getDate()+c);break;
case "month":f=f.getMonth();v.setMonth(f+c);break;case "hour":v.setHours(f.getHours()+c);break;case "minute":v._addMinutes(c);break;case "second":v._addSeconds(c);break;case "millisecond":v._addMilliseconds(c)}return v};g.difference=function(f,t,c){t=t||new D;c=c||"day";var v=t.getFullYear()-f.getFullYear(),q=1;switch(c){case "weekday":v=Math.round(g.difference(f,t,"day"));q=parseInt(g.difference(f,t,"week"));if(0==v%7)v=5*q;else{c=0;var e=f.getDay(),d=t.getDay();q=parseInt(v/7);t=v%7;f=new D(f);
f.setDate(f.getDate()+7*q);f=f.getDay();if(0<v)switch(!0){case 5==e:c=-1;break;case 6==e:c=0;break;case 5==d:c=-1;break;case 6==d:c=-2;break;case 5<f+t:c=-2}else if(0>v)switch(!0){case 5==e:c=0;break;case 6==e:c=1;break;case 5==d:c=2;break;case 6==d:c=1;break;case 0>f+t:c=2}v=v+c-2*q}q=v;break;case "year":q=v;break;case "month":c=t.toGregorian()>f.toGregorian()?t:f;e=t.toGregorian()>f.toGregorian()?f:t;q=c.getMonth();d=e.getMonth();if(0==v)q=c.getMonth()-e.getMonth();else for(q=12-d+q,v=e.getFullYear()+
1,c=c.getFullYear(),v;v<c;v++)q+=12;t.toGregorian()<f.toGregorian()&&(q=-q);break;case "week":q=parseInt(g.difference(f,t,"day")/7);break;case "day":q/=24;case "hour":q/=60;case "minute":q/=60;case "second":q/=1E3;case "millisecond":q*=t.toGregorian().getTime()-f.toGregorian().getTime()}return Math.round(q)};return g})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(N,A,F){var D=A("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var g=arguments.length;g?1==g?(g=arguments[0],"number"==typeof g&&(g=new Date(g)),g instanceof Date?this.fromGregorian(g):""==g?this._date=new Date(""):(this._year=g._year,this._month=g._month,this._date=g._date,this._hours=g._hours,this._minutes=g._minutes,this._seconds=g._seconds,this._milliseconds=g._milliseconds)):3<=g&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(g){g=parseInt(g);if(!(0<g&&g<=this.getDaysInIslamicMonth(this._month,this._year))){var f;if(0<g)for(f=this.getDaysInIslamicMonth(this._month,this._year);g>f;g-=f,f=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(f=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=g;f=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),g+=f}this._date=g;return this},setFullYear:function(g){this._year=+g},setMonth:function(g){this._year+=Math.floor(g/12);this._month=0<g?Math.floor(g%12):Math.floor((g%12+12)%12)},setHours:function(){var g=arguments.length,f=0;1<=g&&(f=parseInt(arguments[0]));2<=g&&(this._minutes=parseInt(arguments[1]));3<=g&&(this._seconds=parseInt(arguments[2]));4==g&&(this._milliseconds=parseInt(arguments[3]));for(;24<=f;)this._date++,g=this.getDaysInIslamicMonth(this._month,
this._year),this._date>g&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=g),f-=24;this._hours=f},_addMinutes:function(g){g+=this._minutes;this.setMinutes(g);this.setHours(this._hours+parseInt(g/60));return this},_addSeconds:function(g){g+=this._seconds;this.setSeconds(g);this._addMinutes(parseInt(g/60));return this},_addMilliseconds:function(g){g+=this._milliseconds;this.setMilliseconds(g);this._addSeconds(parseInt(g/1E3));return this},setMinutes:function(g){this._minutes=
g%60;return this},setSeconds:function(g){this._seconds=g%60;return this},setMilliseconds:function(g){this._milliseconds=g%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var g=new Date;g.setHours(this._hours);g.setMinutes(this._minutes);g.setSeconds(this._seconds);g.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+g.toTimeString()},toGregorian:function(){var g=this._year;g=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(g-1)+Math.floor((3+11*g)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var f=g-this._GREGORIAN_EPOCH,t=Math.floor(f/146097),c=this._mod(f,146097);f=Math.floor(c/36524);var v=this._mod(c,36524);c=Math.floor(v/1461);v=this._mod(v,1461);v=Math.floor(v/365);t=400*t+100*f+4*c+v;4!=f&&4!=v&&t++;f=g-(this._GREGORIAN_EPOCH+365*(t-1)+Math.floor((t-1)/4)-Math.floor((t-1)/100)+Math.floor((t-1)/400));c=this._GREGORIAN_EPOCH-1+365*(t-1)+Math.floor((t-1)/4)-Math.floor((t-1)/100)+Math.floor((t-1)/400)+Math.floor(739/12+(F.isLeapYear(new Date(t,
3,1))?-1:-2)+1);c=g<c?0:F.isLeapYear(new Date(t,3,1))?1:2;f=Math.floor((12*(f+c)+373)/367);c=this._GREGORIAN_EPOCH-1+365*(t-1)+Math.floor((t-1)/4)-Math.floor((t-1)/100)+Math.floor((t-1)/400)+Math.floor((367*f-362)/12+(2>=f?0:F.isLeapYear(new Date(t,f-1,1))?-1:-2)+1);return new Date(t,f-1,g-c+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(g){g=new Date(g);var f=g.getFullYear(),t=g.getMonth(),c=g.getDate();f=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)+
-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor((367*(t+1)-362)/12+(2>=t+1?0:F.isLeapYear(g)?-1:-2)+c);f=Math.floor(f)+.5;f-=this._ISLAMIC_EPOCH;t=Math.floor((30*f+10646)/10631);c=Math.ceil((f-29-this._yearStart(t))/29.5);c=Math.min(c,11);this._date=Math.ceil(f-this._monthStart(t,c))+1;this._month=c;this._year=t;this._hours=g.getHours();this._minutes=g.getMinutes();this._seconds=g.getSeconds();this._milliseconds=g.getMilliseconds();this._day=g.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(g){return 354*(g-1)+Math.floor((3+11*g)/30)},_monthStart:function(g,f){return Math.ceil(29.5*f)+354*(g-1)+Math.floor((3+11*g)/30)},_civilLeapYear:function(g){return 11>(14+11*g)%30},getDaysInIslamicMonth:function(g,f){var t=0;t=29+(g+1)%2;11==g&&this._civilLeapYear(f)&&t++;return t},_mod:function(g,f){return g-f*Math.floor(g/f)}});D.getDaysInIslamicMonth=function(g){return(new D).getDaysInIslamicMonth(g.getMonth(),g.getFullYear())};return D})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(N,A,F,D,g,f,t,c,v){function q(m,l,n,k,x){return x.replace(/([a-z])\1*/ig,function(u){var B=u.charAt(0);u=u.length;var h=["abbr","wide","narrow"];switch(B){case "G":var r=l.eraAbbr[0];break;case "y":r=String(m.getFullYear());break;case "M":r=m.getMonth();if(3>u){r+=1;var w=!0}else B=["months-format",h[u-3]].join("-"),r=l[B][r];break;case "d":r=m.getDate(!0);w=!0;break;case "E":r=m.getDay();3>u?(r+=1,w=!0):(B=["days-format",h[u-3]].join("-"),r=l[B][r]);break;case "a":r=12>m.getHours()?"am":
"pm";r=l["dayPeriods-format-wide-"+r];break;case "h":case "H":case "K":case "k":w=m.getHours();switch(B){case "h":r=w%12||12;break;case "H":r=w;break;case "K":r=w%12;break;case "k":r=w||24}w=!0;break;case "m":r=m.getMinutes();w=!0;break;case "s":r=m.getSeconds();w=!0;break;case "S":r=Math.round(m.getMilliseconds()*Math.pow(10,u-3));w=!0;break;case "z":if(r=D.getTimezoneName(m.toGregorian()))break;u=4;case "Z":r=m.toGregorian().getTimezoneOffset();r=[0>=r?"+":"-",t.pad(Math.floor(Math.abs(r)/60),2),
t.pad(Math.abs(r)%60,2)];4==u&&(r.splice(0,0,"GMT"),r.splice(3,0,":"));r=r.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+x);}w&&(r=t.pad(r,u));return r})}function e(m,l,n,k){var x=function(h){return h};l=l||x;n=n||x;k=k||x;var u=m.match(/(''|[^'])+/g),B="'"==m.charAt(0);F.forEach(u,function(h,r){h?(u[r]=(B?n:l)(h),B=!B):u[r]=""});return k(u.join(""))}function d(m,l,n,k){k=f.escapeString(k);g.normalizeLocale(n.locale);return k.replace(/([a-z])\1*/ig,
function(x){var u=x.charAt(0);var B=x.length,h="";n.strict?1<B&&(h="0{"+(B-1)+"}"):h="0?";switch(u){case "y":u="\\d+";break;case "M":u=2<B?"\\S+ ?\\S+":h+"[1-9]|1[0-2]";break;case "d":u="[12]\\d|"+h+"[1-9]|3[01]";break;case "E":u="\\S+";break;case "h":u=h+"[1-9]|1[0-2]";break;case "k":u=h+"\\d|1[01]";break;case "H":u=h+"\\d|1\\d|2[0-3]";break;case "K":u=h+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":u=h+"\\d|[0-5]\\d";break;case "S":u="\\d{"+B+"}";break;case "a":B=n.am||l["dayPeriods-format-wide-am"];
h=n.pm||l["dayPeriods-format-wide-pm"];n.strict?u=B+"|"+h:(u=B+"|"+h,B!=B.toLowerCase()&&(u+="|"+B.toLowerCase()),h!=h.toLowerCase()&&(u+="|"+h.toLowerCase()));break;default:u=".*"}m&&m.push(x);return"("+u+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var b=A.getObject("date.islamic.locale",!0,N);b.format=function(m,l){l=l||{};var n=g.normalizeLocale(l.locale),k=l.formatLength||"short",x=b._getIslamicBundle(n),u=[];n=A.hitch(this,q,m,x,n,l.fullYear);if("year"==l.selector)return m.getFullYear();"time"!=l.selector&&
(m=l.datePattern||x["dateFormat-"+k])&&u.push(e(m,n));"date"!=l.selector&&(l=l.timePattern||x["timeFormat-"+k])&&u.push(e(l,n));return u.join(" ")};b.regexp=function(m){return b._parseInfo(m).regexp};b._parseInfo=function(m){m=m||{};var l=g.normalizeLocale(m.locale);l=b._getIslamicBundle(l);var n=m.formatLength||"short",k=m.datePattern||l["dateFormat-"+n];n=m.timePattern||l["timeFormat-"+n];var x=[];return{regexp:e("date"==m.selector?k:"time"==m.selector?n:"undefined"==typeof n?k:k+" "+n,A.hitch(this,
d,x,l,m)),tokens:x,bundle:l}};b.parse=function(m,l){m=m.replace(/[\u200E\u200F\u202A\u202E]/g,"");l||(l={});var n=b._parseInfo(l),k=n.tokens,x=n.bundle;n=n.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");m=(new RegExp("^"+n+"$")).exec(m);g.normalizeLocale(l.locale);if(!m)return null;var u=[1389,0,1,0,0,0,0],B="",h=["abbr","wide","narrow"];F.every(m,function(r,w){if(!w)return!0;w=k[w-1];var G=w.length;switch(w.charAt(0)){case "y":u[0]=Number(r);break;case "M":if(2<G){if(w=x["months-format-"+h[G-3]].concat(),
l.strict||(r=r.replace(".","").toLowerCase(),w=F.map(w,function(J){return J?J.replace(".","").toLowerCase():J})),r=F.indexOf(w,r),-1==r)return!1}else r--;u[1]=Number(r);break;case "D":u[1]=0;case "d":u[2]=Number(r);break;case "a":w=l.am||x["dayPeriods-format-wide-am"];G=l.pm||x["dayPeriods-format-wide-pm"];if(!l.strict){var y=/\./g;r=r.replace(y,"").toLowerCase();w=w.replace(y,"").toLowerCase();G=G.replace(y,"").toLowerCase()}if(l.strict&&r!=w&&r!=G)return!1;B=r==G?"p":r==w?"a":"";break;case "K":24==
r&&(r=0);case "h":case "H":case "k":u[3]=Number(r);break;case "m":u[4]=Number(r);break;case "s":u[5]=Number(r);break;case "S":u[6]=Number(r)}return!0});m=+u[3];"p"===B&&12>m?u[3]=m+12:"a"===B&&12==m&&(u[3]=0);return new c(u[0],u[1],u[2],u[3],u[4],u[5],u[6])};var a=[];b.addCustomFormats=function(m,l){a.push({pkg:m,name:l})};b._getIslamicBundle=function(m){var l={};F.forEach(a,function(n){n=g.getLocalization(n.pkg,n.name,m);l=A.mixin(l,n)},this);return l};b.addCustomFormats("dojo.cldr","islamic");b.getNames=
function(m,l,n,k,x){k=b._getIslamicBundle(k);m=[m,n,l];if("standAlone"==n){n=m.join("-");var u=k[n];1==u[0]&&(u=void 0)}m[1]="format";return(u||k[m.join("-")]).concat()};b.weekDays=b.getNames("days","wide","format");b.months=b.getNames("months","wide","format");return b})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B){var h=A(b,{declaredClass:"esri.toolbars.Edit",constructor:function(r,w){this._map=r;this._tool=0;if(this._map.loaded)this._scratchGL=r.graphics;else var G=D.connect(this._map,"onLoad",this,function(){D.disconnect(G);G=null;this._scratchGL=this._map.graphics});r=t("esri-mobile");this._defaultOptions=F.mixin({vertexSymbol:new k(k.STYLE_CIRCLE,r?20:12,new x(x.STYLE_SOLID,new f([0,0,0,.5]),1),new f([128,128,128])),ghostVertexSymbol:new k(k.STYLE_CIRCLE,
r?18:10,new x(x.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),ghostLineSymbol:new x(x.STYLE_DOT,new f([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:r?24:16,boxLineSymbol:new x(x.STYLE_DASH,new f([64,64,64]),1),boxHandleSymbol:new k(k.STYLE_SQUARE,r?16:9,new x(x.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),textAnchorSymbol:new k(k.STYLE_CIRCLE,10,null,new f([255,0,0]))},w||{})},activate:function(r,w,G){this.deactivate();this._graphic=w;this._options=
F.mixin(F.mixin({},this._defaultOptions),G||{});var y=h.MOVE;G=h.EDIT_VERTICES;var J=h.SCALE,M=h.ROTATE,ba=h.EDIT_TEXT,W=!1,E=!1,O=!1,H=this._map,P=H.spatialReference,S=w.geometry.spatialReference;this._geo=!(!P||!S||P.equals(S)||!P.isWebMercator()||4326!==S.wkid);this._isTextPoint=this._prepareTextSymbolEditing(w,r);(r&y)===y&&(W=this._enableMove(w));y=(r&J)===J;M=(r&M)===M;if(y||M)O=this._enableBoxEditing(w,y,M);(r&G)===G&&(E=this._enableVertexEditing(w));(r&ba)===ba&&this._enableTextEditing(w);
if(!(W||E||O))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=r)this._mapPanEndHandle=D.connect(H,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=D.connect(H,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,w);H.snappingManager&&(W||E)&&H.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var r=this._tool,w=this._graphic;
if(r){var G=!!this._modified;this._clear();D.disconnect(this._mapPanEndHandle);D.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(r,w,{isModified:G});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(r,w){},onDeactivate:function(r,
w,G){},onGraphicMoveStart:function(r){},onGraphicFirstMove:function(r){this._modified=!0},onGraphicMove:function(r,w){},onGraphicMoveStop:function(r,w){},onGraphicClick:function(r,w){},onVertexMoveStart:function(r,w){},onVertexFirstMove:function(r,w){this._modified=!0},onVertexMove:function(r,w,G){},onVertexMoveStop:function(r,w,G){},onVertexAdd:function(r,w){this._modified=!0},onVertexClick:function(r,w){},onVertexMouseOver:function(r,w){},onVertexMouseOut:function(r,w){},onVertexDelete:function(r,
w){this._modified=!0},onTextEditStart:function(r,w){},onTextEditEnd:function(r){},onScaleStart:function(r){},onScaleFirstMove:function(r){this._modified=!0},onScale:function(r,w){},onScaleStop:function(r,w){},onRotateStart:function(r){},onRotateFirstMove:function(r){this._modified=!0},onRotate:function(r,w){},onRotateStop:function(r,w){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(r,w){if("point"===r.geometry.type||"multipoint"===r.geometry.type){var G=r.getLayer(),y=G.renderer;G=r.symbol||G._getSymbol(r);!G&&(y.hasVisualVariables("sizeInfo",!1)||y.hasVisualVariables("colorInfo",!1)||y.hasVisualVariables("opacityInfo",!1))&&y.addBreak&&
y.infos&&1===y.infos.length&&(G=y.infos[0].symbol||y.defaultSymbol);if(G&&"textsymbol"===G.type){if((w&h.SCALE)===h.SCALE||(w&h.ROTATE)===h.ROTATE||(w&h.EDIT_TEXT)===h.EDIT_TEXT){r.setSymbol(new u(G.toJson()));var J=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(r),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){J._boxEditor&&J._boxEditor.refresh()})):
N(["../dijit/SymbolEditor"],function(M){if(!J._textSymbolEditor){var ba=J._options.textSymbolEditorHolder?c.create("div",null,J._options.textSymbolEditorHolder):c.create("div",null,J._map.root);J._textSymbolEditor=new M({graphic:r},ba);M=J._textSymbolEditor.domNode.parentNode.id;v.set(J._textSymbolEditor.domNode,{position:"map_root"===M?"absolute":"relative",left:"map_root"===M?J._map.width/2-100+"px":"5px",top:"20px","z-index":50});J._textSymbolEditor.startup();J._textSymbolEditor.createForm(r);
J._textSymbolEditor.show();J._textSymbolEditor.on("symbol-change",function(){J._boxEditor&&J._boxEditor.refresh()})}})}if((w&h.MOVE)===h.MOVE||(w&h.ROTATE)===h.ROTATE||(w&h.SCALE)===h.SCALE)this._textAnchor=new B(r.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(r){var w=this._map;switch(r.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new m(r,w,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(r){var w=
this._map;switch(r.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=l.create(r,w,this),!0}return!1},_enableBoxEditing:function(r,w,G){var y=this._map,J=r.geometry.type;return"polyline"===J||"polygon"===J||this._isTextPoint?(this._boxEditor=new a(r,y,this,w,G,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(r){return this._isTextPoint?(this._textEditor=new n(r,this._map,this),D.connect(this._textEditor,"onEditStart",F.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var r=this._graphicMover;r&&(r.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var r=this._vertexEditor;r&&(r.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var r=this._boxEditor;r&&(r.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(r,w,G){G&&this._refreshMoveables()},_refreshMoveables:function(r){var w=g.filter([this._graphicMover,this._vertexEditor,this._boxEditor],e.isDefined);g.forEach(w,function(G){G.refresh(r)})},_beginOperation:function(r){g.forEach(this._getAffectedTools(r),function(w){w.suspend()})},_endOperation:function(r){g.forEach(this._getAffectedTools(r),function(w){w.resume()})},_getAffectedTools:function(r){var w=[];switch(r){case "MOVE":w=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":w=[this._boxEditor];break;case "BOX":w=[this._vertexEditor]}return w=g.filter(w,e.isDefined)}});F.mixin(h,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});t("extend-esri")&&F.setObject("toolbars.Edit",h,q);return h})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n){N=N(null,{declaredClass:"esri.toolbars._Box",constructor:function(k,x,u,B,h,r,w){this._graphic=k;this._map=x;this._toolbar=u;this._scale=B;this._rotate=h;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=r;k=u._options;this._markerSymbol=k.boxHandleSymbol;this._lineSymbol=k.boxLineSymbol;this._moveStartHandler=A.hitch(this,this._moveStartHandler);this._firstMoveHandler=A.hitch(this,this._firstMoveHandler);
this._moveStopHandler=A.hitch(this,this._moveStopHandler);this._moveHandler=A.hitch(this,this._moveHandler);this._isTextPoint=w;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){F.forEach(this._getAllGraphics(),function(k){k.hide()})},resume:function(){F.forEach(this._getAllGraphics(),function(k){k.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
F.forEach(this._connects,D.disconnect);var k=this._toolbar._scratchGL;this._anchors&&F.forEach(this._anchors,function(x){k.remove(x.graphic);(x=x.moveable)&&x.destroy()});this._box&&k.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var k=this._map,x=this._toolbar._scratchGL,u=this._getBoxCoords(),B=new b(k.spatialReference),h=A.clone(F.filter(u,function(r,w){return 8!==w&&0===w%2}));h[0]&&h.push([h[0][0],h[0][1]]);B.addPath(h);this._rotate&&
B.addPath([u[1],u[8]]);this._box?this._box.setGeometry(B):(this._box=new n(B,this._lineSymbol),x.add(this._box));this._anchors?F.forEach(this._anchors,function(r,w){this._scale||(w=8);var G=new d(u[w],k.spatialReference);r.graphic.setGeometry(G);G=r.moveable;var y=r.graphic.getDojoShape();y&&(G?y!==G.shape&&(G.destroy(),r.moveable=this._getMoveable(r.graphic,w)):r.moveable=this._getMoveable(r.graphic,w))},this):(this._anchors=[],this._connects=[],F.forEach(u,function(r,w){!this._scale&&8>w||(r=new d(r,
k.spatialReference),r=new n(r,this._markerSymbol),this._isTextPoint&&1===w%2&&r.hide(),x.add(r),this._anchors.push({graphic:r,moveable:this._getMoveable(r,w)}))},this))}else this._cleanUp()},_getBoxCoords:function(k){var x=this._map,u=[],B,h,r;if(this._isTextPoint){var w=this._graphic.getNode().getBoundingClientRect();var G=x.__container.getBoundingClientRect();w=[{x:w.left-G.left,y:w.top-G.top},{x:w.right-G.left,y:w.top-G.top},{x:w.right-G.left,y:w.bottom-G.top},{x:w.left-G.left,y:w.bottom-G.top}]}else w=
this._getTransformedBoundingBox(this._graphic);F.forEach(w,function(y,J,M){B=y;(h=M[J+1])||(h=M[0]);r={x:(B.x+h.x)/2,y:(B.y+h.y)/2};k||(B=x.toMap(B),r=x.toMap(r));u.push([B.x,B.y]);u.push([r.x,r.y])});this._rotate&&(w=A.clone(u[1]),w=k?{x:w[0],y:w[1]}:x.toScreen({x:w[0],y:w[1],spatialReference:x.spatialReference}),w.y-=this._toolbar._options.rotateHandleOffset,k||(w=x.toMap(w)),u.push([w.x,w.y]));return u},_getTransformedBoundingBox:function(k){var x=this._map,u=k.geometry.getExtent(),B=k.geometry.spatialReference;
k=new d(u.xmin,u.ymax,B);u=new d(u.xmax,u.ymin,B);k=x.toScreen(k);u=x.toScreen(u);return[{x:k.x,y:k.y},{x:u.x,y:k.y},{x:u.x,y:u.y},{x:k.x,y:u.y}]},_getAllGraphics:function(){var k=[this._box];this._anchors&&F.forEach(this._anchors,function(x){k.push(x.graphic)});return k=F.filter(k,e.isDefined)},_getMoveable:function(k,x){var u=k.getDojoShape();if(u)return k=new c(u),k._index=x,this._connects.push(D.connect(k,"onMoveStart",this._moveStartHandler)),this._connects.push(D.connect(k,"onFirstMove",this._firstMoveHandler)),
this._connects.push(D.connect(k,"onMoveStop",this._moveStopHandler)),k.onMove=this._moveHandler,(u=u.getEventSource())&&t.set(u,"cursor",this._toolbar._cursors["box"+x]),k},_moveStartHandler:function(k){this._toolbar["on"+(8===k.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(k){this._toolbar._deactivateScrollWheel();var x=k.host._index,u=this._wrapOffset=k.host.shape._wrapOffsets[0]||0,B=this._graphic.getLayer().getNavigationTransform();k=F.map(this._getBoxCoords(!0),
function(r){return{x:r[0]+u,y:r[1]}});var h=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:k[1].x,y:k[3].y};this._centerCoord=v.multiplyPoint(v.invert(B),h);if(8===x)h=v.multiplyPoint(v.invert(B),k[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,h)),this._startLine=[this._centerCoord,h],this._moveLine=A.clone(this._startLine);else if(h=v.multiplyPoint(v.invert(B),k[x]),B=v.multiplyPoint(v.invert(B),k[(x+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,h)),this._firstMoverToAnchor=Math.sqrt((h.x-this._centerCoord.x)*(h.x-this._centerCoord.x)+(h.y-this._centerCoord.y)*(h.y-this._centerCoord.y)),this._startBox=B,this._startBox.width=k[4].x-k[0].x,this._startBox.height=k[4].y-k[0].y,this._moveBox=A.clone(this._startBox),this._xfactor=h.x>B.x?1:-1,this._yfactor=h.y>B.y?1:-1,1===x||5===x)this._xfactor=0;else if(3===x||7===x)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===x?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(k,x){k=k.host._index;var u=this._defaultEventArgs;u.angle=0;u.scaleX=1;u.scaleY=1;if(8===k){var B=this._startLine;var h=this._moveLine;var r=h[1];r.x+=x.dx;r.y+=x.dy;x=this._getAngle(B,h);this._isTextPoint&&(x+=this._graphic.symbol.angle);h=v.rotategAt(x,B[0]);this._graphic.getDojoShape().setTransform(h);u.transform=h;u.angle=x;u.around=B[0]}else{B=this._startBox;h=this._moveBox;h.width+=x.dx*this._xfactor;h.height+=x.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(B=h.x+this._xfactor*h.width,h=h.y+this._yfactor*h.height,B=Math.sqrt((B-this._centerCoord.x)*(B-this._centerCoord.x)+(h-this._centerCoord.y)*(h-this._centerCoord.y)),this._scaleRatio=x=r=B/this._firstMoverToAnchor,B=this._centerCoord):(x=h.width/B.width,r=h.height/B.height,B={x:B.x,y:B.y});if(isNaN(x)||Infinity===x||-Infinity===x)x=1;if(isNaN(r)||Infinity===r||-Infinity===r)r=1;h=v.scaleAt(x,r,B);if(this._isTextPoint){var w=v.rotategAt(this._graphic.symbol.angle,
B);this._graphic.getDojoShape().setTransform([w,h])}else this._graphic.getDojoShape().setTransform(h);u.transform=h;u.scaleX=x;u.scaleY=r;u.around=B}this._toolbar["on"+(8===k?this._rotateEvent:this._scaleEvent)](this._graphic,u)},_moveStopHandler:function(k){this._toolbar._activateScrollWheel();var x=this._graphic,u=this._toolbar,B=u._geo?m.geographicToWebMercator(x.geometry):x.geometry,h=B.spatialReference,r=x.getDojoShape(),w=r.getTransform(),G=x.getLayer().getNavigationTransform();this._isTextPoint?
(x=this._graphic.symbol,8===k.host._index?x.angle+=this._getAngle(this._startLine,this._moveLine):x.font.setSize(Math.round(x.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(x)):(B=B.toJson(),this._updateSegments(B.paths||B.rings,w,G,h),r.setTransform(null),B=l.fromJson(B),x.setGeometry(u._geo?m.webMercatorToGeographic(B,!0):B));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;u._endOperation("BOX");this._defaultEventArgs.transform=
w;u["on"+(8===k.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(k,x,u,B){var h=this._map,r=this._wrapOffset||0;F.forEach(k,function(w){F.forEach(w,function(G){this._updatePoint(G,B,r,v,h,u,x)},this)},this)},_updatePoint:function(k,x,u,B,h,r,w){x=h.toScreen({x:k[0],y:k[1],spatialReference:x},!0);x.x+=u;x=B.multiplyPoint([r,w,B.invert(r)],x);x.x-=u;u=h.toMap(x);k[0]=u.x;k[1]=u.y},_getAngle:function(k,x){return 180*Math.atan2(x[0].y-
x[1].y,x[0].x-x[1].x)/Math.PI-180*Math.atan2(k[0].y-k[1].y,k[0].x-k[1].x)/Math.PI},_deNormalizePoint:function(k,x){var u=this._map._getFrameWidth();if(-1===u)return k;for(k={x:k.x,y:k.y};Math.abs(k.x-x.x)>=u;)k.x=k.x<x.x?k.x+u:k.x-u;var B=Math.abs(k.x-x.x);Math.abs(k.x-x.x+u)<B?k.x+=u:Math.abs(k.x-x.x-u)<B&&(k.x-=u);return k}});f("extend-esri")&&A.setObject("toolbars._Box",N,q);return N})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(N,A,F,D,g,f,t,c,v,q){return A("dojox.gfx.Moveable",null,{constructor:function(e,d){this.shape=e;this.delay=d&&0<d.delay?d.delay:0;this.mover=d&&d.mover?d.mover:v;this.leftButtonOnly=d&&d.leftButtonOnly;this.events=[this.shape.on(f.press,N.hitch(this,"onMouseDown"))]},destroy:function(){F.forEach(this.events,function(e){e.remove()});this.events=this.shape=null},onMouseDown:function(e){this.delay?(this.events.push(this.shape.on(f.move,N.hitch(this,"onMouseMove")),this.shape.on(f.release,N.hitch(this,
"onMouseUp"))),this._lastX=e.clientX,this._lastY=e.clientY):this.leftButtonOnly&&!q.isLeft(e)||new this.mover(this.shape,e,this);D.stop(e)},onMouseMove:function(e){var d=e.clientY;if(Math.abs(e.clientX-this._lastX)>this.delay||Math.abs(d-this._lastY)>this.delay)this.onMouseUp(e),new this.mover(this.shape,e,this);D.stop(e)},onMouseUp:function(e){this.events.pop().remove()},onMoveStart:function(e){g.publish("/gfx/move/start",e);t.add(c.body(),"dojoMove")},onMoveStop:function(e){g.publish("/gfx/move/stop",
e);t.remove(c.body(),"dojoMove")},onFirstMove:function(e){},onMove:function(e,d,b){this.onMoving(e,d,b);this.shape.applyLeftTransform(d);this.onMoved(e,d)},onMoving:function(e,d){},onMoved:function(e,d){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(N,A,F,D,g,f){return F("dojox.gfx.Mover",null,{constructor:function(t,c,v){this.shape=t;this.lastX=c.clientX;this.lastY=c.clientY;t=this.host=v;c=
document;v=D(c,g.move,N.hitch(this,"onFirstMove"));this.events=[D(c,g.move,N.hitch(this,"onMouseMove")),D(c,g.release,N.hitch(this,"destroy")),D(c,"dragstart",N.hitch(f,"stop")),D(c,"selectstart",N.hitch(f,"stop")),v];if(t&&t.onMoveStart)t.onMoveStart(this)},onMouseMove:function(t){var c=t.clientX,v=t.clientY;this.host.onMove(this,{dx:c-this.lastX,dy:v-this.lastY},t);this.lastX=c;this.lastY=v;f.stop(t)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){A.forEach(this.events,
function(c){c.remove()});var t=this.host;if(t&&t.onMoveStop)t.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d,b,a){var m=N(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(l,n,k,x){this.graphic=l;this.map=n;this.toolbar=k;this.tempPt=x;this._enableGraphicMover();this._moved=!1},refresh:function(l){var n=this.graphic.getDojoShape();!n||!l&&n._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var l=this.graphic,n=l.getDojoShape();n&&(n._hostGraphic=l,this._moveable=new f(n,{mover:m.Mover}),this._moveStartHandle=
F.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=F.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=F.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=F.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(l=n.getEventSource())&&g.set(l,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var l=this._moveable;if(l){F.disconnect(this._moveStartHandle);F.disconnect(this._firstMoveHandle);
F.disconnect(this._movingHandle);F.disconnect(this._moveStopHandle);var n=l.shape;n&&(n._hostGraphic=null,(n=n.getEventSource())&&g.set(n,"cursor","inherit"));l.destroy()}this._moveable=null},_moveStartHandler:function(){var l=this.graphic,n=this.map;this._startTx=l.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&n.snappingManager&&n.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(l)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(l,n,k){l=l.shape.getTransform();n=this.map;var x;e("esri-pointer")?x=n.navigationManager.pointerEvents._processTouchEvent(k,k):k&&"pointermove"===k.type&&(x=q.prototype._processTouchEvent.call({map:n},k,k));x&&n.snappingManager&&n.snappingManager._onSnappingMouseMoveHandler(x);this.tempPt&&this.tempPt.getDojoShape().setTransform(l);this.toolbar.onGraphicMove(this.graphic,l)},_moveStopHandler:function(l){var n=this.graphic,k=this.toolbar,x=this.map,u=k._geo?d.geographicToWebMercator(n.geometry):
n.geometry,B=u.type,h=n.getDojoShape(),r=h.getTransform();if(D.toJson(r)!==D.toJson(this._startTx)){this._moved=!0;switch(B){case "point":B=[r,c.invert(this._startTx)];if(x.snappingManager)var w=x.snappingManager._snappingPoint;u=w||x.toMap(c.multiplyPoint(B,x.toScreen(u,!0)));x.snappingManager&&x.snappingManager._killOffSnapping();break;case "polyline":u=this._updatePolyGeometry(u,u.paths,r);break;case "polygon":u=this._updatePolyGeometry(u,u.rings,r)}h.setTransform(null);n.setGeometry(k._geo?d.webMercatorToGeographic(u,
!0):u);this.tempPt&&this.tempPt.setGeometry(new a(n.geometry.toJson()))}else this._moved=!1;k._endOperation("MOVE");k.onGraphicMoveStop(n,r);this._moved||(l=l.__e,x=this.map.position,l=new b(l.pageX-x.x,l.pageY-x.y),k.onGraphicClick(n,{screenPoint:l,mapPoint:this.map.toMap(l)}))},_updatePolyGeometry:function(l,n,k){var x=this.map,u=l.getPoint(0,0);x=x.toMap(x.toScreen(u).offset(k.dx,k.dy));k=x.x-u.x;u=x.y-u.y;var B;for(x=0;x<n.length;x++){var h=n[x];for(B=0;B<h.length;B++){var r=l.getPoint(x,B);l.setPoint(x,
B,r.offset(k,u))}}return l}});m.Mover=N(t,{declaredClass:"esri.toolbars._Mover",constructor:function(l,n,k){this.__e=n}});e("extend-esri")&&(A.setObject("toolbars._GraphicMover",m,v),A.setObject("toolbars._Mover",m.Mover,v));return m})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(N,
A,F,D,g,f,t,c,v,q,e,d){var b=N(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,m,l){this.graphic=a;this.map=m;this.toolbar=l;a=l._options;this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;m=a.ghostLineSymbol;this._lineStroke={style:m.style,width:m.width,color:m.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=F.connect(v,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=F.connect(v,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=F.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=F.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new f({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new t({label:d.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
F.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){F.disconnect(this._firstMoveHandle);F.disconnect(this._moveStopHandle);F.disconnect(this._mouseOverHandle);F.disconnect(this._mouseOutHandle);F.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(a,m,l){var n,k,x=this.graphic,u=[];for(n=0;n<a.length;n++){var B=a[n],h=[];for(k=0;k<B.length;k++)h.push(new v(B[k],m,x,n,k,B.length,this,l));u.push(h)}return u},_remove:function(a){a&&D.forEach(a,function(m){D.forEach(m,function(l){l.destroy()})})},_refresh:function(a){a&&D.forEach(a,function(m){D.forEach(m,function(l){l.refresh()})})},_isNew:function(a){return-1===D.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var m=this._findMover(a);m&&(this.toolbar.onVertexMouseOver(this.graphic,m._getInfo()),m._placeholder||(this._selectedMover=m,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=
this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var m=[];var l=this._mpVertexMovers;D.forEach(this._vertexMovers,function(k){m=m.concat(k)});l&&D.forEach(l,function(k){m=m.concat(k)});
for(l=0;l<m.length;l++){var n=m[l];if(n.graphic===a)return n}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(a,m){var l=this._isNew(a);m&&(m.dx||m.dy)?(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,l),this._canAdd&&(l?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES")):
!l&&this._canAdd&&this._showRelatedMidpoints(a)},_showRelatedMidpoints:function(a){var m=this._getAdjacentMidpoints(a.ptIndex,a.segLength),l=this._mpVertexMovers[a.segIndex];for(a=0;a<m.length;a++){var n=l[m[a]];n.graphic.show();n.refresh()}},_hideRelatedMidpoints:function(a){var m=this._getAdjacentMidpoints(a.ptIndex,a.segLength),l=this._mpVertexMovers[a.segIndex];for(a=0;a<m.length;a++)l[m[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var m,l=this._getAdjacentMidpoints(a.ptIndex,a.segLength),
n=this._mpVertexMovers[a.segIndex];for(m=0;m<l.length;m++){var k=this._getAdjacentVertices(l[m],a.segLength),x=a.relatedGraphic.geometry.getPoint(a.segIndex,k[0]);k=a.relatedGraphic.geometry.getPoint(a.segIndex,k[1]);x=new q({x:(x.x+k.x)/2,y:(x.y+k.y)/2,spatialReference:x.spatialReference.toJson()});n[l[m]].graphic.setGeometry(x)}},_addMidpoints:function(a){var m=a.segIndex,l=a.ptIndex,n=a.segLength,k=l+1,x,u=n+1;this._mpVertexMovers[m].splice(l,1);var B=this._vertexMovers[m];for(x=0;x<k;x++)B[x].segLength+=
1;for(x=k;x<B.length;x++)B[x].ptIndex+=1,B[x].segLength+=1;a.ptIndex=k;a.segLength=B.length+1;B.splice(k,0,a);a.graphic.setSymbol(this._symbol1);B=this._mpVertexMovers[m];for(x=0;x<l;x++)B[x].segLength+=1;for(x=l;x<n-1;x++)B[x].ptIndex+=1,B[x].segLength+=1;k=this._getAdjacentVertices(l,u);m=this._getAdjacentVertices(l+1,u);n=a.relatedGraphic.geometry.getPoint(a.segIndex,k[0]);x=a.relatedGraphic.geometry.getPoint(a.segIndex,k[1]);k=new q({x:(n.x+x.x)/2,y:(n.y+x.y)/2,spatialReference:n.spatialReference.toJson()});
n=a.relatedGraphic.geometry.getPoint(a.segIndex,m[0]);x=a.relatedGraphic.geometry.getPoint(a.segIndex,m[1]);m=new q({x:(n.x+x.x)/2,y:(n.y+x.y)/2,spatialReference:n.spatialReference.toJson()});n=new v(k,this._symbol2,this.graphic,a.segIndex,l,u,this,!0);a=new v(m,this._symbol2,this.graphic,a.segIndex,l+1,u,this,!0);B.splice(l,0,n,a)},_deleteVertex:function(a){var m,l=a.ptIndex,n=this._vertexMovers[a.segIndex];for(m=0;m<l;m++)--n[m].segLength;for(m=l+1;m<n.length;m++){var k=n[m];--k.ptIndex;--k.segLength}n.splice(l,
1);m=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,m)}});A.mixin(b,{create:function(a,m,l){switch(a.geometry.type){case "multipoint":return new b.MultipointVertexEditor(a,m,l);case "polyline":return new b.PolylineVertexEditor(a,m,l);case "polygon":return new b.PolygonVertexEditor(a,m,l)}}});b.MultipointVertexEditor=N(b,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=F.connect(v,"onMoveStart",this,this._moveStartHandler);
F.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);F.disconnect(this._moveStartHandle)},_getSegments:function(a){var m=a.points,l=[],n=a.spatialReference;for(a=0;a<m.length;a++){var k=m[a];l.push(new q({x:k[0],y:k[1],spatialReference:n.toJson()}))}return[l]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,m,l,n,k){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var m=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(m,
a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var m=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(m,a._getInfo())},_findMover:function(a){var m=[].concat(this._vertexMovers[0]),l=a.target;for(a=0;a<m.length;a++){var n=m[a];if(n.graphic.getDojoShape().getNode()===l)return n}},_moveStartHandler:function(a){var m=a.ptIndex,l=a.segLength-1,n=a.relatedGraphic.geometry.points;a=n.splice(m,1);n.push(a[0]);
n=this._vertexMovers[0];for(a=l;a>m;a--)--n[a].ptIndex;a=n.splice(m,1);n.push(a[0]);a[0].ptIndex=l},_moveStopHandler:function(a){this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,m,l,n,k,x,u,B){a=m.geometry;B?a.removePoint(k):a.setPoint(k,l);m.setGeometry(a)},_deleteMidpoints:function(a){}});b.PolylineVertexEditor=N(b,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(a){var m,l,n=a.paths,k=[];for(m=0;m<n.length;m++){var x=n[m],u=[];for(l=0;l<x.length;l++)u.push(a.getPoint(m,l));k.push(u)}return k},_getMidpointSegments:function(a){var m,l,n=a.paths,k=[],x=a.spatialReference;for(m=0;m<n.length;m++){var u=n[m],B=[];for(l=0;l<u.length-1;l++){var h=a.getPoint(m,l),r=a.getPoint(m,l+1);h=new q({x:(h.x+r.x)/2,y:(h.y+r.y)/2,spatialReference:x.toJson()});B.push(h)}k.push(B)}return k},_getControlPoints:function(a,m,l,n,k){var x=this.map,u,B;this._isNew(a)?
(a=n,n+=1,0<=a&&(u=x.toScreen(m.getPoint(l,a))),n<=k&&(B=x.toScreen(m.getPoint(l,n)))):(a=n-1,n+=1,0<=a&&(u=x.toScreen(m.getPoint(l,a))),n<k&&(B=x.toScreen(m.getPoint(l,n))));return[u,B]},_getAdjacentMidpoints:function(a,m){var l=[],n=a-1;0<=n&&l.push(n);a<m-1&&l.push(a);return l},_getAdjacentVertices:function(a,m){return[a,a+1]},_deleteMidpoints:function(a){var m=this._mpVertexMovers[a.segIndex],l=m.length-1,n=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),k,x=n[0];for(k=0;k<x;k++)--m[k].segLength;
for(k=x+1;k<m.length;k++){var u=m[k];--u.ptIndex;--u.segLength}if(1===n.length)m.splice(x,1)[0].destroy();else for(u=this._getAdjacentVertices(x,l),k=a.relatedGraphic.geometry.getPoint(a.segIndex,u[0]),u=a.relatedGraphic.geometry.getPoint(a.segIndex,u[1]),k=new q({x:(k.x+u.x)/2,y:(k.y+u.y)/2,spatialReference:k.spatialReference.toJson()}),a=new v(k,this._symbol2,this.graphic,a.segIndex,x,l,this,!0),m=m.splice(x,n.length,a),k=0;k<m.length;k++)m[k].destroy()},_updateRelatedGraphic:function(a,m,l,n,k,
x,u,B){a=m.geometry;u?a.insertPoint(n,k+1,e.fromJson(l.toJson())):B?a.removePoint(n,k):a.setPoint(n,k,e.fromJson(l.toJson()));m.setGeometry(a)}});b.PolygonVertexEditor=N(b,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(a){var m,l,n=a.rings,k=[];for(m=0;m<n.length;m++){var x=n[m],u=[];for(l=0;l<x.length-1;l++)u.push(a.getPoint(m,l));k.push(u)}return k},_getMidpointSegments:function(a){var m,l,n=a.rings,k=[],x=a.spatialReference;for(m=0;m<n.length;m++){var u=n[m],
B=[];for(l=0;l<u.length-1;l++){var h=a.getPoint(m,l),r=a.getPoint(m,l+1);h=new q({x:(h.x+r.x)/2,y:(h.y+r.y)/2,spatialReference:x.toJson()});B.push(h)}k.push(B)}return k},_getControlPoints:function(a,m,l,n,k){var x=this.map;this._isNew(a)?a=n:(a=n-1,a=0>a?(k+a)%k:a);n=(n+1)%k;k=x.toScreen(m.getPoint(l,a));m=x.toScreen(m.getPoint(l,n));return[k,m]},_getAdjacentMidpoints:function(a,m){var l=a-1;return[0>l?(m+l)%m:l,a]},_getAdjacentVertices:function(a,m){return[a,(a+1)%m]},_deleteMidpoints:function(a){var m=
a.ptIndex,l=this._mpVertexMovers[a.segIndex],n=l.length-1,k=this._getAdjacentMidpoints(m,a.segLength).sort();var x=k[0];var u=k[k.length-1];if(0===m){var B=this._getAdjacentVertices(n-1,n);m=a.relatedGraphic.geometry.getPoint(a.segIndex,B[0]);B=a.relatedGraphic.geometry.getPoint(a.segIndex,B[1]);m=new q({x:(m.x+B.x)/2,y:(m.y+B.y)/2,spatialReference:m.spatialReference.toJson()});a=new v(m,this._symbol2,this.graphic,a.segIndex,n-1,n,this,!0);l.splice(u,1,a)[0].destroy();l.splice(x,1)[0].destroy();for(k=
0;k<l.length-1;k++)x=l[k],--x.ptIndex,--x.segLength}else{B=this._getAdjacentVertices(x,n);m=a.relatedGraphic.geometry.getPoint(a.segIndex,B[0]);B=a.relatedGraphic.geometry.getPoint(a.segIndex,B[1]);m=new q({x:(m.x+B.x)/2,y:(m.y+B.y)/2,spatialReference:m.spatialReference.toJson()});a=new v(m,this._symbol2,this.graphic,a.segIndex,x,n,this,!0);u=l.splice(x,k.length,a);for(k=0;k<u.length;k++)u[k].destroy();for(k=0;k<x;k++)--l[k].segLength;for(k=x+1;k<l.length;k++)x=l[k],--x.ptIndex,--x.segLength}},_updateRelatedGraphic:function(a,
m,l,n,k,x,u,B){a=m.geometry;u?a.insertPoint(n,k+1,e.fromJson(l.toJson())):B?(a.removePoint(n,k),0===k&&a.setPoint(n,x-1,e.fromJson(a.getPoint(n,0).toJson()))):(a.setPoint(n,k,e.fromJson(l.toJson())),0===k&&a.setPoint(n,x,e.fromJson(l.toJson())));m.setGeometry(a)}});g("extend-esri")&&(A.setObject("toolbars._GraphicVertexEditor",b,c),A.setObject("toolbars._MultipointVertexEditor",b.MultipointVertexEditor,c),A.setObject("toolbars._PolylineVertexEditor",b.PolylineVertexEditor,c),A.setObject("toolbars._PolygonVertexEditor",
b.PolygonVertexEditor,c));return b})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d,b){N=N(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(a,m,l,n,k,x,u,B){this.point=a;this.symbol=m;this.relatedGraphic=l;this.segIndex=n;this.ptIndex=
k;this.segLength=x;this.editor=u;this.map=u.map;this._scratchGL=u.toolbar._scratchGL;this._placeholder=B||!1;this._type=l.geometry.type;this._init();this._enable()},refresh:function(a){if(a||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var a=new e(this.point.toJson());
a=new d(a,this.symbol);switch(this._type){case "multipoint":a._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(a)}this.graphic=a},_enable:function(){var a=this.graphic.getDojoShape();a&&(a._hasMover=!0,this._moveable=this._getMoveable(a),(a=a.getEventSource())&&g.set(a,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var a=this._moveable;if(a){F.disconnect(this._startHandle);
F.disconnect(this._firstHandle);F.disconnect(this._movingHandle);F.disconnect(this._stopHandle);var m=a.shape;m&&(m=m.getEventSource())&&g.set(m,"cursor","inherit");a.destroy();this._moveable=null}},_needRefresh:function(){var a=this.graphic.getDojoShape(),m=!1;if(a)switch(this._type){case "multipoint":var l=this.relatedGraphic.getDojoShape();l&&(l=l.children[this.ptIndex],a!==l&&(this.graphic._shape=l,m=!0));break;case "polyline":case "polygon":m=!a._hasMover}return m},_getMoveable:function(a){a=
new f(a,D("mac")&&D("ff")&&!q("esri-touch")&&{leftButtonOnly:!0});this._startHandle=F.connect(a,"onMoveStart",this,this._moveStartHandler);this._firstHandle=F.connect(a,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=F.connect(a,"onMoving",this,this._movingHandler);this._stopHandle=F.connect(a,"onMoveStop",this,this._moveStopHandler);return a},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(a){var m=this.map;m.snappingManager&&m.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();a.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(a){var m=a.shape,l=this._getControlEdges(),n=this._scratchGL._div,k,x=[],u=a.host.shape._wrapOffsets[0]||
0;for(k=0;k<l.length;k++){var B=l[k];B.x1+=u;B.x2+=u;x.push([n.createLine({x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2}).setStroke(this.editor._lineStroke),B.x1,B.y1,B.x2,B.y2])}m._lines=x;a.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(a,m,l){m=this.map;var n;q("esri-pointer")?n=m.navigationManager.pointerEvents._processTouchEvent(l,l):l&&"pointermove"===l.type&&(n=v.prototype._processTouchEvent.call({map:m},
l,l));n&&m.snappingManager&&m.snappingManager._onSnappingMouseMoveHandler(n);l=a.shape;a=l.getTransform();l=l._lines;for(n=0;n<l.length;n++)m=l[n],m[0].setShape({x1:m[1]+a.dx,y1:m[2]+a.dy,x2:m[3],y2:m[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),a)},_moveStopHandler:function(a){a=a.shape;var m=this.editor.toolbar,l=a.getTransform(),n=this.map,k=this.graphic,x=m._geo?b.geographicToWebMercator(k.geometry):k.geometry;m._activateScrollWheel();var u,B=a._lines;if(B){for(u=
0;u<B.length;u++)B[u][0].removeShape();a._lines=null}u=!1;B=!0;var h=this._getInfo();l&&(l.dx||l.dy)?this._placeholder&&(this._placeholder=!1,u=!0):B=!1;if(n.snappingManager)var r=n.snappingManager._snappingPoint;var w=[l,t.invert(this._startTx)];r=r||n.toMap(t.multiplyPoint(w,n.toScreen(x,!0)));n.snappingManager&&n.snappingManager._killOffSnapping();a.setTransform(null);k.setGeometry(m._geo?b.webMercatorToGeographic(r,!0):r);this.constructor.onMoveStop(this,l);m.onVertexMoveStop(this.relatedGraphic,
h,l);if(!B)m.onVertexClick(this.relatedGraphic,h);if(u)m.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var a=this.map,m=this.relatedGraphic.geometry,l=this.segIndex,n=this.ptIndex,k=this.segLength,x=this._scratchGL.getNavigationTransform(),u=x.dx;x=x.dy;var B=a.toScreen(this.graphic.geometry);a=B.x-u;B=B.y-x;var h=[];m=this.editor._getControlPoints(this,m,l,n,k);m[0]&&h.push({x1:a,y1:B,x2:m[0].x-u,y2:m[0].y-x});m[1]&&h.push({x1:a,y1:B,x2:m[1].x-u,y2:m[1].y-x});return h}});
q("extend-esri")&&A.setObject("toolbars.VertexMover",N,c);A.mixin(N,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return N})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(N,A,F,D,g,f,t,c,v,q){N=N(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(e,d,b){this._graphic=e;this._map=d;
this._toolbar=b;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(e){this._editBox?(F.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=F.connect(e.getLayer(),"onDblClick",this,function(d){this._map.navigationManager.setImmediateClick(!1);d.graphic==e&&(D.stop(d),F.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(e))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(F.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(e,d){if(!this._editBox){if(!e.symbol.text){e.symbol.text="Tempt text";e.setSymbol(e.symbol);var b=""}var a=this._createInputTextStyle(e,this._map);""!==b&&(b=d||e.symbol.text);this._editBox=f.create("input",{type:"text",value:b});
c.set(this._editBox,a);t.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=F.connect(this._editBox,"onkeyup",A.hitch(this,function(l){l.keyCode!=v.ENTER&&l.keyCode!==v.TAB||this._disable()}));this._editBoxBlurHandler=F.connect(this._editBox,"onblur",A.hitch(this,function(l){this._disable()}));e.symbol.text="";e.setSymbol(e.symbol);e.hide();var m=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
A.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(l){c.set(m,{left:this._editBoxLeft+l.delta.x+"px",top:this._editBoxTop+l.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(c.get(m,"left"));this._editBoxTop=parseFloat(c.get(m,"top"))});this.onEditStart(e,this._editBox);this._toolbar.onTextEditStart(e,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(F.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(F.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(e,
d){d=e.getDojoShape().getTransformedBoundingBox();var b=e.getLayer();b=b.hasLocalNavigationTransform()?{dx:0,dy:0}:b.getNavigationTransform();var a=e.symbol.font;return{"font-family":a.family,"font-size":a.size+"px","font-style":a.style,"font-variant":a.variant,"font-weight":a.weight,left:d[0].x+b.dx+"px",top:d[0].y+b.dy+"px",width:Math.abs(d[0].x-d[1].x)/Math.cos(e.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var e=this._graphic.symbol;
e.text=this._editBox.value;this._graphic.setSymbol(e)}else this._graphic.getLayer().remove(this._graphic)}});g("extend-esri")&&A.setObject("toolbars.TextEditor",N,q);return N})},"widgets/SmartEditor/PresetAllFields":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/on dojo/keys dojo/string dojo/dom-attr dojo/mouse ./presetUtils ./RelativeDates dijit/_TemplatedMixin jimu/BaseWidgetSetting dijit/form/FilteringSelect dojo/store/Memory dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/SimpleTextarea esri/urlUtils jimu/dijit/Message jimu/utils".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r){return N([m,A,a],{baseClass:"jimu-widget-smartEditor-setting-preset",tooltipContents:{},hasAtLeastOneGroupInDisplay:!1,enableUsePresetValueCheckBox:!1,postCreate:function(){this.inherited(arguments);this.enableUsePresetValueCheckBox=this.hasAtLeastOneGroupInDisplay=!1;this.tooltipContents={};this.presetContainer=g.create("div",{"class":"esriCTPresetContent"},this.parentNode);this._createPresetContents()},_fetchUrlParameters:function(){var w=
B.urlToObject(document.location.href);if(w.query)var G=w.query;return G},_createPresetContents:function(){var w=this._fetchUrlParameters();for(var G=0;G<this.presetOrder.length;G++){var y=this.presetOrder[G];var J=this._isGroupNameFound(w,y);J=w&&J.isConfiguredGroupName?this._createPresetContentDOM(this._configuredPresetInfos[y],w[J.urlParamKey]):this._createPresetContentDOM(this._configuredPresetInfos[y]);this._configuredPresetInfos[y].hideInPresetDisplay?f.add(J,"esriCTHidden"):this.hasAtLeastOneGroupInDisplay=
!0;this._createTooltipContent(this._configuredPresetInfos[y])}},_hasFieldsInPresetGroup:function(w){var G=!1,y;for(y in w.appliedOn)if(0<w.appliedOn[y].length){G=!0;break}return G},_isGroupNameFound:function(w,G){var y=!1,J;w&&D.forEach(Object.keys(w),F.hitch(this,function(M){if(M.toLowerCase()===G.toLowerCase())return y=!0,J=M,!0}));return{isConfiguredGroupName:y,urlParamKey:J}},_createPresetContentDOM:function(w,G){var y=g.create("tr"),J=g.create("td"),M=g.create("div",{"class":"esriCTGroupInfoIcon",
"aria-label":v.substitute(this.nls.groupInfoLabel,{groupName:w.name}),tabindex:"0",role:"button"},J),ba=g.create("span",{innerHTML:w.name,"class":"ee-atiLabel"},J);q.set(ba,"groupName",w.name);q.set(M,"groupName",w.name);this.own(t(M,"click",F.hitch(this,function(W){W=q.get(W.currentTarget,"groupName");h({message:this.tooltipContents[W].innerHTML})})));this.own(t(M,"keydown",F.hitch(this,function(W){if(W.keyCode===c.ENTER||W.keyCode===c.SPACE)W=q.get(W.currentTarget,"groupName"),h({message:this.tooltipContents[W].innerHTML})})));
g.place(J,y);J=g.create("td",{"class":"preset-value-editable"},y);if(w.showOnlyDomainFields)w=this._createDomainContentNode(w,J),void 0!==G&&w.set("value",G);else switch(w.dataType){case "esriFieldTypeInteger":void 0===G||isNaN(G)||(w.presetValue=G);this._createNumberTypeDOM(w,J);break;case "esriFieldTypeDate":void 0!==G&&(w.presetValue={dateType:"fixed",dateTime:isNaN(G)?null:Number(G)});this._createDateTypeDOM(w,J);break;case "esriFieldTypeString":void 0!==G&&(w.presetValue=G);this._createStringTypeDOM(w,
J);break;case "esriFieldTypeGUID":void 0!==G&&(w.presetValue=G),this._createGUIDTypeDOM(w,J)}this.parentNode.appendChild(y);return y},_createTooltipContent:function(w){var G,y=!1,J=g.create("div");var M=g.create("div",{"class":"presetMessageContentDiv",style:{"max-height":"200px",overflow:"auto"},tabindex:"0"},J);var ba=v.substitute(this.nls.presetGroupFieldsLabel,{groupName:"\x3cb\x3e"+w.name+"\x3c/b\x3e"});var W=v.substitute(this.nls.presetGroupNoFieldsLabel,{groupName:"\x3cb\x3e"+w.name+"\x3c/b\x3e"});
ba=g.create("div",{innerHTML:ba},M);M=g.create("ul",{style:"margin: 0px; padding: 0 20px;"},M);for(G in w.appliedOn)if(0<w.appliedOn[G].length){y=!0;var E=this._jimuLayerInfos.getLayerOrTableInfoById(G);if(E&&E.title&&E.layerObject&&E.layerObject.fields){g.create("li",{innerHTML:E.title+": "},M);var O=g.create("ul",{style:"margin: 0px;"},M);D.forEach(E.layerObject.fields,F.hitch(this,function(H){H=r.getDefaultPortalFieldInfo(H);0<=w.appliedOn[G].indexOf(H.fieldName)&&g.create("li",{innerHTML:H.label||
H.fieldName},O)}))}}y||q.set(ba,"innerHTML",W);this.tooltipContents[w.name]=J},_enableUsePresetValueCB:function(w){null!==w&&""!==w&&void 0!==w&&(this.enableUsePresetValueCheckBox=!0)},_createNumberTypeDOM:function(w,G){G=new x({"class":"ee-inputField",name:w.name,value:w.presetValue,"aria-label":w.name},g.create("div",{},G));this.own(t(G,"change",F.hitch(this,function(y){w.presetValue=y;this.emit("presetValueChanged")})));this._enableUsePresetValueCB(w.presetValue)},_createDateTypeDOM:function(w,
G){var y=new k({"class":"ee-inputField",name:w.name,disabled:!0,"aria-label":w.name,style:"width: calc(100% - 30px)",value:this.nls.relativeDates[w.presetValue.dateType]},g.create("div",{},G));"fixed"===w.presetValue.dateType&&(w.presetValue.dateTime?y.set("value",d.getDateFromRelativeInfo(w.presetValue,!0)):y.set("value",""));q.set(y.focusNode,"disabled",!1);q.set(y.focusNode,"readonly",!0);q.set(y.focusNode,"tabindex",0);y.esriCTisDateGroup=!0;y.esriCTPresetGroup=w;var J=v.substitute(this.nls.editGroupInfoIcon,
{groupName:w.name});G=g.create("div",{"class":"jimu-icon jimu-icon-edit",tabindex:"0",role:"button","aria-label":J},g.create("div",{"class":"editRelativeDateIcon"},G));this.own(t(G,"click",F.hitch(this,function(){var M=new b({nls:this.nls,relativeDates:w.presetValue,map:this.map,layerInfos:this._jimuLayerInfos,selectedPresetValue:w.presetValue&&w.presetValue.chooseFromLayerInfo?w.presetValue.chooseFromLayerInfo.selectedValue:""});this.own(t(M,"updatePresetValue",F.hitch(this,function(ba){w.presetValue=
ba;"fixed"===w.presetValue.dateType?w.presetValue.dateTime?y.set("value",d.getDateFromRelativeInfo(w.presetValue,!0)):y.set("value",""):y.set("value",this.nls.relativeDates[ba.dateType]);this.emit("presetValueChanged")})))})));this.own(t(G,"keydown",F.hitch(this,function(M){if(M.keyCode===c.ENTER||M.keyCode===c.SPACE)M=new b({nls:this.nls,relativeDates:w.presetValue,map:this.map,layerInfos:this._jimuLayerInfos,selectedPresetValue:w.presetValue&&w.presetValue.chooseFromLayerInfo?w.presetValue.chooseFromLayerInfo.selectedValue:
""}),this.own(t(M,"updatePresetValue",F.hitch(this,function(ba){w.presetValue=ba;"fixed"===w.presetValue.dateType?w.presetValue.dateTime?y.set("value",d.getDateFromRelativeInfo(w.presetValue,!0)):y.set("value",""):y.set("value",this.nls.relativeDates[ba.dateType]);this.emit("presetValueChanged")})))})));this.own(t(y.domNode,e.enter,F.hitch(this,function(){var M=d.getDateFromRelativeInfo(w.presetValue,!0);""===M&&(M=this.nls.relativeDates.noDateDefinedTooltip);y.set("title",M)})));this._enableUsePresetValueCB(w.presetValue)},
_createStringTypeDOM:function(w,G){G=new u({row:1,style:{resize:"vertical"},"class":"ee-inputField",name:w.name,"aria-label":w.name,value:w.presetValue},g.create("div",{},G));this.own(t(G,"change",F.hitch(this,function(y){w.presetValue!==y&&(w.presetValue=y,this.emit("presetValueChanged"))})));this._enableUsePresetValueCB(w.presetValue)},_createGUIDTypeDOM:function(w,G){G=new k({"class":"ee-inputField","aria-label":w.name,name:w.name,value:w.presetValue},g.create("div",{},G));this.own(t(G,"change",
F.hitch(this,function(y){w.presetValue=y;this.emit("presetValueChanged")})));this._enableUsePresetValueCB(w.presetValue)},_createDomainContentNode:function(w,G){var y=this._populateDomains(w);var J=new l({"class":"ee-inputField",name:w.name,"aria-label":w.name,style:{width:"99%"},required:!1,store:new n({data:y.options})},g.create("div",{},G));J.esriCTDomainList=!0;this.own(t(J,"change",F.hitch(this,function(){w.selectedDomainValue=J.get("value");this.emit("presetValueChanged")})));J.set("value",
y.defaultValue);this._enableUsePresetValueCB(w.presetValue);return J},_populateDomains:function(w){var G=[],y;D.forEach(w.presetValue,F.hitch(this,function(J){J.showInList&&(G.push({name:J.label,id:J.value}),J.isDefault&&(y=J.value,w.selectedDomainValue=J.value))}));return{options:G,defaultValue:y}}})})},"widgets/SmartEditor/presetUtils":function(){define("dojo/_base/lang jimu/utils dojo/date dojo/_base/array dojo/dom-construct dijit/form/DateTextBox dijit/form/NumberSpinner dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Editor dijit/form/SimpleTextarea dojo/store/Memory dojo/query dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor jimu/dijit/EditorTextColor jimu/dijit/EditorBackgroundColor".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l){return{integerFields:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],getFieldInfoByFieldName:function(n,k){var x={};D.some(n,function(u){if(u.name===k)return N.mixin(x,u),!0});return x},getDateFromRelativeInfo:function(n,k){var x=new Date;"fixed"===n.dateType?x=n.dateTime?new Date(n.dateTime):"":"future"===n.dateType?(x=F.add(x,"year",n.year),x=F.add(x,"month",n.month),x=F.add(x,"day",n.day),x=F.add(x,"hour",
n.hour),x=F.add(x,"minute",n.minute),x=F.add(x,"second",n.second)):"past"===n.dateType&&(n.year&&(x=F.add(x,"year",-1*n.year)),n.month&&(x=F.add(x,"month",-1*n.month)),n.day&&(x=F.add(x,"day",-1*n.day)),n.hour&&(x=F.add(x,"hour",-1*n.hour)),n.minute&&(x=F.add(x,"minute",-1*n.minute)),n.second&&(x=F.add(x,"second",-1*n.second)));return k&&""!==x?A.localizeDate(x):x},getDateFieldValue:function(n,k){if("esriFieldTypeDate"===n.type){if(k instanceof Array){var x,u;0<k.length&&k[0]&&(x=k[0].getValue());
1<k.length&&k[1]&&(u=k[1].getValue());var B=x&&u?new Date(x.getFullYear(),x.getMonth(),x.getDate(),u.getHours(),u.getMinutes(),u.getSeconds(),u.getMilliseconds()):x||u||null}else B=k.getValue(),n.domain&&(B=Number(B));B=B&&B.getTime?B.getTime():B&&B.toGregorian?B.toGregorian().getTime():B}return B},isGuid:function(n){"{"===n[0]&&(n=n.substring(1,n.length-1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(n)},validateGUID:function(n,
k){return this.isGuid(n)},isValidPresetValue:function(n){var k=!0;D.some(n,function(x){if(x.isValid&&!x.isValid())return k=!1,!0});return k},createPresetFieldContentNode:function(n){var k=[];if(n.domain){if("codedValue"===n.domain.type){var x=[];D.forEach(n.domain.codedValues,function(r){x.push({name:r.name,id:r.code})});var u=new v({"class":"ee-inputField",name:n.fieldName,store:new m({data:x}),searchAttr:"name",required:!0},g.create("div"))}else{u=null;switch(n.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":u=
{min:n.domain.minValue,max:n.domain.maxValue,places:0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":u={min:n.domain.minValue,max:n.domain.maxValue}}u=new t({"class":"ee-inputField",name:n.fieldName,smallDelta:1,constraints:u,required:!0},g.create("div"))}k.push(u)}else switch(n.type){case "esriFieldTypeGUID":u=new e({"class":"ee-inputField",name:n.fieldName,required:!0,trim:!0},g.create("div"));u.validator=N.hitch(this,this.validateGUID);k.push(u);break;case "esriFieldTypeDate":u=new f({"class":"ee-inputField",
name:n.fieldName,required:!0,fieldType:"date"},g.create("div"));k.push(u);n.format&&n.format.time&&!0===n.format.time&&(n=new d({"class":"ee-inputField",style:"margin-top:2px;",required:!0},g.create("div")),k.push(n));break;case "esriFieldTypeString":u=null;n.length&&Number(n.length)&&0<Number(n.length)&&(u=n.length);if(n.hasOwnProperty("stringFieldOption"))if("richtext"===n.stringFieldOption){var B=document.getElementsByTagName("head")[0];var h=window.apiUrl+"dojox/editor/plugins/resources/css/TextColor.css";
l('link[href\x3d"'+h+'"]',B)[0]||A.loadStyleLink("editor_plugins_resources_TextColor",h);h=window.apiUrl+"dojox/editor/plugins/resources/editorPlugins.css";l('link[href\x3d"'+h+'"]',B)[0]||A.loadStyleLink("editor_plugins_resources_editorPlugins",h);h=window.apiUrl+"dojox/editor/plugins/resources/css/PasteFromWord.css";l('link[href\x3d"'+h+'"]',B)[0]||A.loadStyleLink("editor_plugins_resources_PasteFromWord",h);u={"class":"ee-inputField ee-inputFieldRichText",trim:!0,maxLength:u,fieldType:"richtext",
required:!0};u["class"]+=" atiRichTextField";u.height="100%";u.width="100%";u.name=n.fieldName;u.plugins=["bold","italic","underline",A.getEditorTextColor("smartEditor"),A.getEditorBackgroundColor("smartEditor"),"|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","insertOrderedList","insertUnorderedList","indent","outdent","|","createLink"];u=new b(u,g.create("div"))}else u="textarea"===n.stringFieldOption?new a({"class":"ee-inputField ee-inputFieldTextArea",name:n.fieldName,maxlength:u,
fieldType:"textarea",required:!0},g.create("div")):new e({"class":"ee-inputField",name:n.fieldName,maxlength:u,required:!0,trim:!0},g.create("div"));else u=new e({"class":"ee-inputField",name:n.fieldName,maxlength:u,required:!0,trim:!0},g.create("div"));k.push(u);break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":u=new c({"class":"ee-inputField",name:n.fieldName,required:!0,constraints:{places:0}},g.create("div"));k.push(u);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":u=
new c({"class":"ee-inputField",name:n.fieldName,required:!0},g.create("div"));k.push(u);break;default:u=new q({"class":"ee-unsupportField",name:n.fieldName,value:"N/A",readOnly:!0},g.create("div")),k.push(u)}return k},changeFieldToMostRestrictive:function(n,k){if(!n.hasOwnProperty("type")&&k.hasOwnProperty("type"))return k;k.length&&Number(k.length)&&0<Number(k.length)&&(n.length&&Number(n.length)?k.length<n.length&&(n.length=k.length):n.length=k.length);if(n.type===k.type)switch(k.type){case "esriFieldTypeString":n.hasOwnProperty("stringFieldOption")&&
k.hasOwnProperty("stringFieldOption")&&("richtext"===n.stringFieldOption&&"richtext"!==k.stringFieldOption?n.stringFieldOption=k.stringFieldOption:"textarea"===n.stringFieldOption&&"textbox"===k.stringFieldOption&&(n.stringFieldOption=k.stringFieldOption))}return n}}})},"jimu/dijit/EditorTextColor":function(){define("require dojo dijit dojo/_base/declare dijit/_editor/_Plugin dijit/form/DropDownButton".split(" "),function(N,A,F,D,g,f){A.experimental("dijit.editor.plugins.EditorTextColor");var t=D("dijit.editor.plugins.EditorTextColor",
g,{buttonClass:f,colorPicker:"jimu/dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command="editorTextColor";this.hackCommand="foreColor";this.inherited(arguments);var c="",v=!1;this.params.custom&&(this.params.custom.recordUID&&(c=this.params.custom.recordUID),this.params.custom.forceAttr&&(v=this.params.custom.forceAttr));var q=this;this.button.set("iconClass",this.iconClassPrefix+" "+this.iconClassPrefix+"ForeColor");this.button.set("title",this.getLabel(this.hackCommand));
this.button.loadDropDown=function(e){function d(b){q.button.dropDown=new b({dir:q.editor.dir,ownerDocument:q.editor.ownerDocument,value:q.value,appearance:{showTransparent:!1,showColorPalette:!0,showCoustom:!0,showColorPickerApply:!1,showCoustomRecord:!0},recordUID:c,onChange:function(a){q.editor.execCommand("useCSS",v);q.editor.execCommand("styleWithCSS",!v);q.editor.execCommand(q.hackCommand,a)},onClose:function(){q.button.closeDropDown()}});e()}"string"===typeof q.colorPicker?N([q.colorPicker],
d):d(q.colorPicker)}},updateState:function(){var c=this.editor,v=this.hackCommand;if(c&&c.isLoaded&&v.length){if(this.button){var q=this.get("disabled");this.button.set("disabled",q);if(q)return;try{var e=c.queryCommandValue(v)||""}catch(d){e=""}}""===e?e="#000000":"transparent"===e&&(e="rgba(0, 0, 0, 0)");this.value=e;(c=this.button.dropDown)&&c.getColor&&e!==c.getColor()&&(c.refreshRecords(),c.setColor(e))}}});A.subscribe(F._scopeName+".Editor.getPlugin",null,function(c){if(!c.plugin)switch(c.args.name){case "editorTextColor":c.plugin=
new t}});return t})},"jimu/dijit/EditorBackgroundColor":function(){define("require dojo dijit dojo/_base/declare dijit/_editor/_Plugin dijit/form/DropDownButton".split(" "),function(N,A,F,D,g,f){A.experimental("dijit.editor.plugins.EditorBackgroundColor");var t=D("dijit.editor.plugins.EditorBackgroundColor",g,{buttonClass:f,colorPicker:"jimu/dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command="editorBackgroundColor";this.hackCommand="hiliteColor";this.inherited(arguments);
var c="";this.params.custom&&this.params.custom.recordUID&&(c=this.params.custom.recordUID);var v=this;this.button.set("iconClass",this.iconClassPrefix+" "+this.iconClassPrefix+"HiliteColor");this.button.set("title",this.getLabel(this.hackCommand));this.button.loadDropDown=function(q){function e(d){v.button.dropDown=new d({dir:v.editor.dir,ownerDocument:v.editor.ownerDocument,value:v.value,appearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!0,showColorPickerApply:!1,
showCoustomRecord:!0},recordUID:c,onChange:function(b){v.editor.execCommand("useCSS",!1);v.editor.execCommand("styleWithCSS",!0);v.editor.execCommand(v.hackCommand,b)},onExecute:function(){v.editor.execCommand(v.hackCommand,this.get("value"))},onClose:function(){v.button.closeDropDown()}});q()}"string"===typeof v.colorPicker?N([v.colorPicker],e):e(v.colorPicker)}},updateState:function(){var c=this.editor,v=this.hackCommand;if(c&&c.isLoaded&&v.length){if(this.button){var q=this.get("disabled");this.button.set("disabled",
q);if(q)return;try{var e=c.queryCommandValue(v)||""}catch(d){e=""}}""===e?e="#000000":"transparent"===e&&(e="rgba(0, 0, 0, 0)");this.value=e;(c=this.button.dropDown)&&c.getColor&&e!==c.getColor()&&(c.refreshRecords(),c.setColor(e))}}});A.subscribe(F._scopeName+".Editor.getPlugin",null,function(c){if(!c.plugin)switch(c.args.name){case "editorBackgroundColor":c.plugin=new t}});return t})},"widgets/SmartEditor/RelativeDates":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/on dojo/text!./RelativeDates.html dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/dijit/Popup dojo/dom-class jimu/utils dojo/query dijit/focus ./presetUtils dijit/form/Select jimu/dijit/LayerChooserFromMap jimu/dijit/LayerChooserFromMapWithDropbox jimu/dijit/_filter/ValueProviderFactory dojo/_base/array dojo/dom-style dojo/string dojo/dom-attr dijit/form/DateTextBox dijit/form/TimeTextBox dijit/form/NumberTextBox jimu/dijit/RadioBtn".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B){return N([t,A,f],{baseClass:"jimu-widget-smartEditor-setting-relativeDates",templateString:g,selectValuePopup:null,_isFirsTime:!0,initialValue:null,postCreate:function(){this._eventListener();this._createSelectValuePopUp();this._addLayerSelectors();this._support508ForSelectValuePopUp();D(window,"resize",F.hitch(this,function(){setTimeout(F.hitch(this,function(){this._setFieldPopupDimensions()}),1E3)}))},_eventListener:function(){this.fixedRadioButton.onStateChange=
F.hitch(this,function(){this.dateTypeChanged()});this.currentRadioButton.onStateChange=F.hitch(this,function(){this.dateTypeChanged()});this.PastRadioButton.onStateChange=F.hitch(this,function(){this.dateTypeChanged()});this.futureRadioButton.onStateChange=F.hitch(this,function(){this.dateTypeChanged()});this.own(D(this.yearsTextBox,"change",F.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(D(this.monthsTextBox,"change",F.hitch(this,function(){this._showOrHideWarningContainer()})));
this.own(D(this.daysTextBox,"change",F.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(D(this.minutesTextBox,"change",F.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(D(this.hoursTextBox,"change",F.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(D(this.secondsTextBox,"change",F.hitch(this,function(){this._showOrHideWarningContainer()})));this.customRadioButton.onStateChange=F.hitch(this,function(){this._dateValueOptionChange()});this.selectValueRadioButton.onStateChange=
F.hitch(this,function(){this._dateValueOptionChange()})},dateTypeChanged:function(){v.add(this.fixedDateContent,"esriCTHidden");v.add(this.currentDateContent,"esriCTHidden");v.add(this.pastOrFutureDateContent,"esriCTHidden");v.remove(this.valueLabel,"esriCTHidden");v.add(this.relativeDateWarningContainer,"esriCTHidden");this.fixedRadioButton.checked?(v.remove(this.fixedDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=this.nls.relativeDates.hintForFixedDateType):this.currentRadioButton.checked?
(v.add(this.valueLabel,"esriCTHidden"),v.remove(this.currentDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=this.nls.relativeDates.hintForCurrentDateType):this.PastRadioButton.checked?(v.remove(this.pastOrFutureDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=this.nls.relativeDates.hintForPastDateType):this.futureRadioButton.checked&&(v.remove(this.pastOrFutureDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=this.nls.relativeDates.hintForFutureDateType)},_createSelectValuePopUp:function(){this.selectValuePopup=
new c({titleLabel:this.nls.relativeDates.popupTitle,width:500,maxHeight:450,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,onClick:F.hitch(this,function(){var h=this._getValues();h&&(!v.contains(this.pastOrFutureDateContent,"esriCTHidden")&&this._checkTextboxesWithZeroValue()?v.remove(this.relativeDateWarningContainer,"esriCTHidden"):(v.add(this.relativeDateWarningContainer,"esriCTHidden"),this.emit("updatePresetValue",h),this.selectValuePopup.close()))})},{label:this.nls.cancel,
classNames:["jimu-btn-vacation"],onClick:F.hitch(this,function(){this.selectValuePopup.close()})}]});this.relativeDates&&this._setValue()},_setFieldPopupDimensions:function(){this.selectValuePopup&&(window.appInfo.isRunInMobile&&600>window.innerWidth?this.selectValuePopup.set("width",window.innerWidth-100):this.selectValuePopup.set("width",750))},_validateFixedDate:function(){return this.dateTextBox.isValid()?this.timeTextBox.isValid()?!0:(this.timeTextBox.focus(),!1):(this.dateTextBox.focus(),!1)},
_validatePastOrFutureDate:function(){return this.yearsTextBox.isValid()?this.monthsTextBox.isValid()?this.daysTextBox.isValid()?this.hoursTextBox.isValid()?this.minutesTextBox.isValid()?this.secondsTextBox.isValid()?!0:(this.secondsTextBox.focus(),!1):(this.minutesTextBox.focus(),!1):(this.hoursTextBox.focus(),!1):(this.daysTextBox.focus(),!1):(this.monthsTextBox.focus(),!1):(this.yearsTextBox.focus(),!1)},_getValues:function(){var h=!0,r={value:{}};if(this.fixedRadioButton.checked){if(this.customRadioButton.checked&&
(h=this._validateFixedDate())&&(r.dateType="fixed",r.dateTime=b.getDateFieldValue({type:"esriFieldTypeDate"},[this.dateTextBox,this.timeTextBox])),this.selectValueRadioButton.checked&&(r.dateType="fixed",this._getChooseFromLayerInfo()?r.chooseFromLayerInfo=this._getChooseFromLayerInfo():r.chooseFromLayerInfo=null,r.chooseFromLayerInfo&&r.chooseFromLayerInfo.selectedValue)){var w=r.chooseFromLayerInfo.selectedValue;r.dateTime="Invalid Date"!=new Date(w)?this._convertToEpoch(new Date(w)):parseInt(w)}}else if(this.currentRadioButton.checked)r.dateType=
"current";else if(this.PastRadioButton.checked){if(h=this._validatePastOrFutureDate())r=this._getValuesOfPastOrFutureDijits(),r.dateType="past"}else this.futureRadioButton.checked&&(h=this._validatePastOrFutureDate())&&(r=this._getValuesOfPastOrFutureDijits(),r.dateType="future");return h?r:h},_support508ForSelectValuePopUp:function(){var h=e(".jimu-btn-vacation",this.selectValuePopup.domNode)[0];q.initFirstFocusNode(this.selectValuePopup.domNode,this.selectValuePopup.closeBtnNode);d.focus(this.selectValuePopup.closeBtnNode);
q.initLastFocusNode(this.selectValuePopup.domNode,h)},_setValue:function(){if("fixed"===this.relativeDates.dateType)if(this.fixedRadioButton.domNode.click(),this.relativeDates.hasOwnProperty("chooseFromLayerInfo"))this.selectValueRadioButton.domNode.click();else{this.customRadioButton.domNode.click();var h=new Date(parseInt(this.relativeDates.dateTime,10));this.dateTextBox.set("value",h);this.timeTextBox.set("value",h)}"current"===this.relativeDates.dateType&&this.currentRadioButton.domNode.click();
"past"===this.relativeDates.dateType&&(this.PastRadioButton.domNode.click(),this._setValuesOfPastOrFutureDijits());"future"===this.relativeDates.dateType&&(this.futureRadioButton.domNode.click(),this._setValuesOfPastOrFutureDijits())},_setValuesOfPastOrFutureDijits:function(){this.yearsTextBox.set("value",this.relativeDates.year);this.monthsTextBox.set("value",this.relativeDates.month);this.daysTextBox.set("value",this.relativeDates.day);this.hoursTextBox.set("value",this.relativeDates.hour);this.minutesTextBox.set("value",
this.relativeDates.minute);this.secondsTextBox.set("value",this.relativeDates.second)},_getValuesOfPastOrFutureDijits:function(){var h={};h.year=this.yearsTextBox.value;h.month=this.monthsTextBox.value;h.day=this.daysTextBox.value;h.hour=this.hoursTextBox.value;h.minute=this.minutesTextBox.value;h.second=this.secondsTextBox.value;return h},_checkTextboxesWithZeroValue:function(){return 0!==this.yearsTextBox.value||0!==this.monthsTextBox.value||0!==this.daysTextBox.value||0!==this.hoursTextBox.value||
0!==this.minutesTextBox.value||0!==this.secondsTextBox.value?!1:!0},_showOrHideWarningContainer:function(){this._checkTextboxesWithZeroValue()?v.remove(this.relativeDateWarningContainer,"esriCTHidden"):v.add(this.relativeDateWarningContainer,"esriCTHidden")},_addLayerSelectors:function(){var h=this._createLayerChooserMapArgs();h=new m(h);h.startup();this.layerSelector=new l({layerChooser:h});this.layerSelector.placeAt(this.layerSelectorDiv);this.layerSelector.startup();if(0<this.layerSelector.layerChooser.getAllItems().length)var r=
this.layerSelector.layerChooser.getAllItems()[0].layerInfo.layerObject;this.relativeDates&&this.relativeDates.chooseFromLayerInfo&&this.relativeDates.chooseFromLayerInfo.layerId&&this._isFirsTime&&(h=this.layerInfos.getLayerInfoById(this.relativeDates.chooseFromLayerInfo.layerId))&&(r=h.layerObject);this.layerSelector.setSelectedLayer(r);this._addLayerFieldsOptions()},_createLayerChooserMapArgs:function(){return{multiple:!1,createMapResponse:this.map.webMapResponse,filter:this._createFiltersForLayerSelector()}},
_createFiltersForLayerSelector:function(){var h=m.createFeaturelayerFilter(["point","polyline","polygon"],!1,!1);var r=m.createImageServiceLayerFilter(!0);h=m.orCombineFilters([h,r]);dateLayerfilter=this._createDateLayerfilter();return m.andCombineFilters([h,dateLayerfilter])},_createDateLayerfilter:function(){return function(h){var r=!1;h.getLayerObject().then(function(w){w&&w.fields&&k.some(w.fields,function(G){if("esriFieldTypeDate"===G.type)return r=!0})});return r}},_addLayerFieldsOptions:function(){this.fieldsDropdown&&
this.fieldsDropdown.destroy();this.valueProviderFactory&&(this.valueProviderFactory=null);this.valueProvider&&this.valueProvider.destroy();this.fieldsDropdown=new a({style:{width:"100%"}});this.fieldsDropdown.placeAt(this.fieldsDropdownDiv);this.fieldsDropdown.startup();this.fieldsDropdown.set("options",this._createFieldsDropDownOpt());this.fieldsDropdown.options&&0<this.fieldsDropdown.options.length&&this.fieldsDropdown.set("value",this.fieldsDropdown.options[0]);this.relativeDates&&this.relativeDates.chooseFromLayerInfo&&
this.relativeDates.chooseFromLayerInfo.field&&this._isFirsTime&&this.fieldsDropdown.set("value",this.relativeDates.chooseFromLayerInfo.field);this._updateLabelForDomainField(this.selectedPresetValue);this.own(D(this.layerSelector,"selection-change",F.hitch(this,function(){this._addLayerFieldsOptions()})));this.own(D(this.fieldsDropdown,"change",F.hitch(this,function(){x.set(this.domainFieldHint,"display","none");this._createValueProvider();this._updateLabelForDomainField("")})))},_createFieldsDropDownOpt:function(){var h=
[];validFieldSet=[];if(this.layerSelector.getSelectedItem()){var r=this.layerSelector.getSelectedItem().layerInfo.layerObject;k.forEach(r.fields,F.hitch(this,function(w){"esriFieldTypeDate"===w.type&&h.push({label:w.alias||w.name,value:w.name})}))}return h},_createValueProvider:function(){var h;this.layerSelector&&(h=this.layerSelector.getSelectedItem());if(h&&h.layerInfo&&h.layerInfo.layerObject){h=h.layerInfo;var r=h.layerObject;this.valueProviderFactory&&(this.valueProviderFactory=null);this.valueProvider&&
this.valueProvider.destroy();this.valueProviderFactory=new n({url:r.url,layerDefinition:r,featureLayerId:h.id});var w;var G=this.fieldsDropdown.getValue();k.some(r.fields,F.hitch(this,function(M){if(M.name===G)return w=M,!0}));if(G&&w){if("esriFieldTypeDate"===w.type){var y="date";var J="dateOperatorIsOn"}y={fieldObj:{name:G,label:G,dateFormat:"",shortType:y,type:w.type},operator:J,interactiveObj:"",caseSensitive:!1,valueObj:{type:"unique"}};this.valueProvider=this.valueProviderFactory.getValueProvider(y,
!1);this.own(D(this.valueProvider,"change",F.hitch(this,function(){var M=this.valueProvider.getPartObject()&&this.valueProvider.getPartObject().valueObj.value;this._updateLabelForDomainField(M)})));this.valueProvider&&(this.valueProvider.promptLabel&&v.add(this.valueProvider.promptLabel,"esriCTHidden"),this.valueProvider.placeAt(this.valueProviderContainer),this.relativeDates&&this.relativeDates.chooseFromLayerInfo&&this.relativeDates.chooseFromLayerInfo.selectedValue&&this._isFirsTime&&(y.valueObj.value=
this.relativeDates.chooseFromLayerInfo.selectedValue,this._isFirsTime=!1),this.valueProvider.setValueObject(y.valueObj),this.initialValue=y.valueObj.value?y.valueObj.value:"")}}},_dateValueOptionChange:function(){this.customRadioButton.checked&&(v.remove(this.customOptionContentNode,"esriCTHidden"),v.add(this.selectValueOptionContentNode,"esriCTHidden"));this.selectValueRadioButton.checked&&(v.remove(this.selectValueOptionContentNode,"esriCTHidden"),v.add(this.customOptionContentNode,"esriCTHidden"))},
_getChooseFromLayerInfo:function(){if(this.valueProvider&&this.valueProvider.checkedNameDiv){var h=this.valueProvider.getPartObject()?this.valueProvider.getPartObject().valueObj.value:"- empty -"!==this.valueProvider.checkedNameDiv.innerHTML&&this.initialValue?this.initialValue:"";return{layerId:this.layerSelector.getSelectedItem().layerInfo.layerObject.id,field:this.fieldsDropdown.getValue(),selectedValue:h}}},_convertToEpoch:function(h){return h=(h=h?new Date(h.getFullYear(),h.getMonth(),h.getDate(),
h.getHours(),h.getMinutes(),h.getSeconds(),h.getMilliseconds()):h||null)&&h.getTime?h.getTime():h&&h.toGregorian?h.toGregorian().getTime():h},_updateLabelForDomainField:function(h){var r,w,G={dateType:"fixed",dateTime:""};(w=this.layerSelector?this.layerSelector.getSelectedItem():null)&&w.layerInfo&&w.layerInfo.layerObject&&(w=w.layerInfo.layerObject,w=w.getField(this.fieldsDropdown.getValue()),w.domain&&"esriFieldTypeDate"===w.type&&k.some(w.domain.codedValues,F.hitch(this,function(y){if(h==y.code)return y=
new Date(h),G.dateTime="Invalid Date"!=y?this._convertToEpoch(y):parseInt(h),r=u.substitute(this.nls.relativeDates.domainFieldHintLabel,{domainValue:b.getDateFromRelativeInfo(G,!0)}),!0})));r?(B.set(this.domainFieldHint,"innerHTML",r),x.set(this.domainFieldHint,"display","block")):x.set(this.domainFieldHint,"display","none")}})})},"jimu/dijit/LayerChooserFromMap":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/store/Memory dojo/Deferred dojo/store/Observable dijit/tree/ObjectStoreModel dojo/promise/all dojo/_base/lang dojo/_base/html dojo/_base/array jimu/utils jimu/dijit/_Tree jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k){var x=F([D,g,f,A],{templateString:'\x3cdiv style\x3d"width:100%;"\x3e\x3cdiv data-dojo-attach-point\x3d"errorTipSection" class\x3d"error-tip-section"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text" data-dojo-attach-point\x3d"errTip"\x3e${nls.noLayersTip}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',_store:null,_id:0,_treeClass:"layer-chooser-tree",createMapResponse:null,multiple:!1,onlyShowVisible:!1,
updateWhenLayerInfosIsShowInMapChanged:!1,onlyShowWebMapLayers:!1,displayTooltipForTreeNode:!1,onlyFilterCurrentLayerWhenAddItem:!1,postMixInProperties:function(){this.nls=window.jimuNls.basicLayerChooserFromMap},postCreate:function(){this.inherited(arguments);b.addClass(this.domNode,"jimu-basic-layer-chooser-from-map");this.multiple=!!this.multiple;this.shelter=new k({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this._createTree();this.basicFilter=d.hitch(this,this.basicFilter);
this.filter=x.andCombineFilters([this.basicFilter,this.filter]);this.createMapResponse&&this.setCreateMapResponse(this.createMapResponse)},basicFilter:function(u){var B=new c;this.onlyShowVisible?B.resolve(u.isShowInMap()):B.resolve(!0);return B},filter:function(u){u=new c;u.resolve(!0);return u},getSelectedItems:function(){var u=this.tree.getSelectedItems();return a.map(u,d.hitch(this,function(B){return this.getHandledItem(B)}))},getAllItems:function(){var u=this.tree.getAllItems(),B=[];a.forEach(u,
d.hitch(this,function(h){"root"!==h.id&&(h=this.getHandledItem(h),B.push(h))}));return B},getHandledItem:function(u){return{name:u.name,layerInfo:u.layerInfo}},_isLeafItem:function(u){return u.isLeaf},setCreateMapResponse:function(u){this.createMapResponse=u;n.getInstance(this.createMapResponse.map,this.createMapResponse.itemInfo).then(d.hitch(this,function(B){this.layerInfosObj=B;this.own(N(this.layerInfosObj,"layerInfosChanged",d.hitch(this,this._onLayerInfosChanged)));this.updateWhenLayerInfosIsShowInMapChanged&&
this.own(N(this.layerInfosObj,"layerInfosIsShowInMapChanged",d.hitch(this,this._onLayerInfosIsShowInMapChanged)));this._buildTree(this.layerInfosObj)}))},_onLayerInfosChanged:function(u,B){this._buildTree(this.layerInfosObj);this.emit("update")},_onLayerInfosIsShowInMapChanged:function(u){this._buildTree(this.layerInfosObj);this.emit("update")},_buildTree:function(u){this._clear();b.setStyle(this.errorTipSection,"display","block");var B=[];this.onlyShowWebMapLayers?(B=u.getLayerInfoArrayOfWebmap(),
B=B.concat(u.getTableInfoArrayOfWebmap())):(B=u.getLayerInfoArray(),B=B.concat(u.getTableInfoArray()));0!==B.length&&(b.setStyle(this.errorTipSection,"display","none"),a.forEach(B,d.hitch(this,function(h){this._addDirectLayerInfo(h)})))},_addDirectLayerInfo:function(u){u&&u.getLayerObject().then(d.hitch(this,function(){this._addItem("root",u)}),d.hitch(this,function(B){console.error(B)}))},_clear:function(){var u=this._store.query({parent:"root"});a.forEach(u,d.hitch(this,function(B){B&&"root"!==
B.id&&this._store.remove(B.id)}))},_addItem:function(u,B){var h=null,r=B.getLayerType(),w=this.filter(B);e({layerType:r,valid:w}).then(d.hitch(this,function(G){if(G.valid){var y=d.hitch(this,function(W,E){this._id++;h={name:B.title||"",parent:u,layerInfo:B,type:G.layerType,layerClass:B.layerObject.declaredClass,id:this._id.toString(),isLeaf:W,hasChildren:E};this._store.add(h)}),J=B.getSubLayers(),M=0===J.length,ba=!0;this.onlyFilterCurrentLayerWhenAddItem?(M&&(ba=!1),y(M,ba)):M?y(M,!1):(J=a.map(J,
d.hitch(this,function(W){return this.filter(W)})),e(J).then(d.hitch(this,function(W){(W=a.some(W,function(E){return E}))&&y(M,W)})))}}))},_getRootItem:function(){return{id:"root",name:"Map Root",type:"root",isLeaf:!1,hasChildren:!0}},_createTree:function(){var u=this._getRootItem();u=new t({data:[u],getChildren:function(B){return this.query({parent:B.id})}});this._store=new v(u);u=new q({store:this._store,query:{id:"root"},mayHaveChildren:d.hitch(this,this._mayHaveChildren)});this.tree=new l({multiple:this.multiple,
model:u,showRoot:!1,isLeafItem:d.hitch(this,this._isLeafItem),style:{width:"100%"},onOpen:d.hitch(this,function(B,h){"root"!==B.id&&this._onTreeOpen(B,h)}),onClick:d.hitch(this,function(B,h,r){this._onTreeClick(B,h,r);this.emit("tree-click",B,h,r)}),getIconStyle:d.hitch(this,function(B,h){var r=null;if(!B||"root"===B.id)return null;var w={width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundImage:""},G=window.location.protocol+"//"+window.location.host+
require.toUrl("jimu");if(B=this._getIconInfo(B,h).imageName)w.backgroundImage="url("+G+"/css/images/"+B+")",r=w;return r}),getIconClass:d.hitch(this,function(B,h){return this._getIconInfo(B,h).className}),getTooltip:d.hitch(this,function(B){return this.displayTooltipForTreeNode?B.layerInfo.title:""})});b.addClass(this.tree.domNode,this._treeClass);this.tree.placeAt(this.shelter.domNode,"before")},_mayHaveChildren:function(u){return u.hasChildren},_getIconInfo:function(u,B){var h="",r="";"ArcGISDynamicMapServiceLayer"===
u.type||"ArcGISTiledMapServiceLayer"===u.type?B?(h="mapserver_open.png",r="mapservice-layer-icon open"):(h="mapserver_close.png",r="mapservice-layer-icon close"):"GroupLayer"===u.type?B?(h="group_layer2.png",r="group-layer-icon open"):(h="group_layer1.png",r="group-layer-icon close"):"FeatureLayer"===u.type?(u=m.getTypeByGeometryType(u.layerInfo.layerObject.geometryType),"point"===u?(h="point_layer1.png",r="point-layer-icon"):"polyline"===u?(h="line_layer1.png",r="line-layer-icon"):"polygon"===u&&
(h="polygon_layer1.png",r="polygon-layer-icon")):"Table"===u.type?(h="table.png",r="table-icon"):"ArcGISImageServiceLayer"===u.type||"ArcGISImageServiceVectorLayer"===u.type?(h="image_layer.png",r="iamge-layer-icon"):B?(h="mapserver_open.png",r="mapservice-layer-icon open"):(h="mapserver_close.png",r="mapservice-layer-icon close");return{imageName:h,className:r}},_onTreeOpen:function(u,B){if("root"!==u.id){var h=[];B=[];h=u.layerInfo.getSubLayers();u.checked||(this.shelter.show(),B=a.map(h,d.hitch(this,
function(r){return r.getLayerObject()})),e(B).then(d.hitch(this,function(){this.domNode&&(a.forEach(h,d.hitch(this,function(r){this._addItem(u.id,r)})),u.checked=!0,this.shelter.hide())}),d.hitch(this,function(r){console.error(r);this.shelter.hide()})))}},_onTreeClick:function(u,B,h){},destroy:function(){this.shelter&&(this.shelter.destroy(),this.shelter=null);this.tree&&this.tree.destroy();this.inherited(arguments)}});x.createFilterByLayerType=function(u){d.isArrayLike(u)||(u=[]);return function(B){var h=
new c;if(0===u.length)h.resolve(!0);else{var r=[];B.traversal(function(w){r.push(w.getLayerType())});e(r).then(function(w){for(var G=0;G<w.length;G++)for(var y=0;y<u.length;y++)if(w[G]===u[y]){h.resolve(!0);return}h.resolve(!1)},function(w){console.error(w);h.reject(w)})}return h}};x.createFeaturelayerFilter=function(u,B,h,r){var w=["point","polyline","polygon"];u&&0<u.length?(u=a.filter(u,function(G){return 0<=w.indexOf(G)}),0===u.length&&(u=w)):u=w;return function(G){var y=G.getLayerType();G=G.getLayerObject();
return e({layerType:y,layerObject:G}).then(function(J){var M=J.layerType;J=J.layerObject;if("ArcGISDynamicMapServiceLayer"===M||"ArcGISTiledMapServiceLayer"===M||"GroupLayer"===M||"FeatureCollection"===M)return!0;if("FeatureLayer"===M){M=m.getTypeByGeometryType(J.geometryType);M=0<=a.indexOf(u,M);var ba=x._shouldPassStatisticsCheck(r,J);return J.url?(J=m.isFeaturelayerUrlSupportQuery(J.url,J.capabilities),M&&J&&ba):B&&M}return"Table"===M?(M=m.isFeaturelayerUrlSupportQuery(J.url,J.capabilities),J=
x._shouldPassStatisticsCheck(r,J),h&&M&&J):!1})}};x.createImageServiceLayerFilter=function(u,B){return function(h){var r=h.getLayerType();h=h.getLayerObject();return e({layerType:r,layerObject:h}).then(function(w){var G=w.layerType,y=w.layerObject;return"ArcGISImageServiceLayer"===G||"ArcGISImageServiceVectorLayer"===G?u?m.isImageServiceSupportQuery(w.layerObject.capabilities)?B?x._shouldPassStatisticsCheck(B,y):!0:!1:!0:!1})}};x._shouldPassStatisticsCheck=function(u,B){return u?(u=!1,u=B.advancedQueryCapabilities?
!!B.advancedQueryCapabilities.supportsStatistics:!!B.supportsStatistics):!0};x.createQueryableLayerFilter=function(u){var B=x.createFeaturelayerFilter(["point","polyline","polygon"],!1,!0,u);u=x.createImageServiceLayerFilter(!0,u);return x.orCombineFilters([B,u])};x.andCombineFilters=function(u){return x._combineFilters(u,!0)};x.orCombineFilters=function(u){return x._combineFilters(u,!1)};x._combineFilters=function(u,B){return function(h){var r=new c,w=a.map(u,function(G){return G(h)});e(w).then(function(G){var y=
!1;y=B?a.every(G,function(J){return J}):a.some(G,function(J){return J});r.resolve(y)},function(G){console.error(G);r.reject(G)});return r}};return x})},"dijit/tree/ObjectStoreModel":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/when ../Destroyable".split(" "),function(N,A,F,D,g,f,t){return F("dijit.tree.ObjectStoreModel",t,{store:null,labelAttr:"name",labelType:"text",root:null,query:null,constructor:function(c){g.mixin(this,c);this.childrenCache=
{}},getRoot:function(c,v){if(this.root)c(this.root);else{var q=this.store.query(this.query);q.then&&this.own(q);f(q,g.hitch(this,function(e){if(1!=e.length)throw Error("dijit.tree.ObjectStoreModel: root query returned "+e.length+" items, but must return exactly one");this.root=e[0];c(this.root);q.observe&&q.observe(g.hitch(this,function(d){this.onChange(d)}),!0)}),v)}},mayHaveChildren:function(){return!0},getChildren:function(c,v,q){var e=this.store.getIdentity(c);if(this.childrenCache[e])f(this.childrenCache[e],
v,q);else{var d=this.childrenCache[e]=this.store.getChildren(c);d.then&&this.own(d);d.observe&&this.own(d.observe(g.hitch(this,function(b,a,m){this.onChange(b);a!=m&&f(d,g.hitch(this,"onChildrenChange",c))}),!0));f(d,v,q)}},isItem:function(){return!0},getIdentity:function(c){return this.store.getIdentity(c)},getLabel:function(c){return c[this.labelAttr]},newItem:function(c,v,q,e){return this.store.put(c,{parent:v,before:e})},pasteItem:function(c,v,q,e,d,b){var a=new D;if(v===q&&!e&&!b)return a.resolve(!0),
a;v&&!e?this.getChildren(v,g.hitch(this,function(m){m=[].concat(m);var l=N.indexOf(m,c);m.splice(l,1);this.onChildrenChange(v,m);a.resolve(this.store.put(c,{overwrite:!0,parent:q,oldParent:v,before:b,isCopy:!1}))})):a.resolve(this.store.put(c,{overwrite:!0,parent:q,oldParent:v,before:b,isCopy:!0}));return a},onChange:function(){},onChildrenChange:function(){},onDelete:function(){}})})},"jimu/dijit/_Tree":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_TreeNode.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/event dojo/query dojo/aspect dojo/on dojo/keys dojo/Evented dijit/registry dijit/Tree jimu/utils".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l){var n=N([m._TreeNode,b],{templateString:D,declaredClass:"jimu._TreeNode",isLeaf:!1,groupId:"",postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-tree-node");this.isLeaf=!!this.isLeaf;this.groupId?(this.checkNode=f.toDom('\x3cinput type\x3d"radio" /\x3e'),this.checkNode.name=this.groupId):this.checkNode=f.toDom('\x3cinput type\x3d"checkbox" /\x3e');f.addClass(this.checkNode,"jimu-tree-check-node");f.place(this.checkNode,this.contentNode,
"first");this.own(e(this.checkNode,"click",g.hitch(this,this._onClick)));this.own(e(this.rowNode,"keydown",g.hitch(this,function(k,x){x.target=k;x.keyCode!==d.ENTER&&x.keyCode!==d.SPACE||this._onClick(x)},this.checkNode)));this.isLeaf?this.groupId?f.setStyle(this.checkNode,"display","none"):f.setStyle(this.checkNode,"display","inline"):f.setStyle(this.checkNode,"display","none");this.isLeaf?f.addClass(this.domNode,"jimu-tree-leaf-node"):f.addClass(this.domNode,"jimu-tree-not-leaf-node")},select:function(){this.isLeaf&&
(this.checkNode.checked=!0,f.addClass(this.domNode,"jimu-tree-selected-leaf-node"))},unselect:function(){this.isLeaf&&(this.checkNode.checked=!1,f.removeClass(this.domNode,"jimu-tree-selected-leaf-node"))},toggleSelect:function(){this.isLeaf&&(this.checkNode.checked?this.unselect():this.select())},_onClick:function(k){(k.target||k.srcElement)===this.checkNode?this.tree._onCheckNodeClick(this,this.checkNode.checked,k):this.tree._onClick(this,k)},_onChange:function(){this.isLeaf&&setTimeout(g.hitch(this,
function(){this.checkNode.checked?this.emit("tn-select",this):this.emit("tn-unselect",this)}),100)},destroy:function(){delete this.tree;this.inherited(arguments)}});return N([m,b],{declaredClass:"jimu._Tree",openOnClick:!0,multiple:!0,uniqueId:"",showRoot:!1,postMixInProperties:function(){this.inherited(arguments);this.uniqueId="tree_"+l.getRandomString()},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-tree");this.own(q.before(this,"onClick",g.hitch(this,this._jimuBeforeClick)));
this.rootLoadingIndicator&&f.setStyle(this.rootLoadingIndicator,"display","none");this.dndController.singular=!0;f.setAttr(this.domNode,"tabindex",0)},removeItem:function(k){this.model.store.remove(k)},getAllItems:function(){var k=this.getAllTreeNodeWidgets();return t.map(k,g.hitch(this,function(x){var u=x.item;u.selected=x.checkNode.checked;return u}))},getSelectedItems:function(){var k=this.getAllTreeNodeWidgets();k=t.filter(k,g.hitch(this,function(x){return x.checkNode.checked}));return t.map(k,
g.hitch(this,function(x){return x.item}))},getFilteredItems:function(k){var x=this.getAllTreeNodeWidgets();x=t.map(x,g.hitch(this,function(u){var B=u.item;B.selected=u.checkNode.checked;return B}));return t.filter(x,g.hitch(this,function(u){return k(u)}))},getTreeNodeByItemId:function(k){for(var x=this._getAllTreeNodeDoms(),u=0;u<x.length;u++){var B=a.byNode(x[u]);if(B.item.id.toString()===k.toString())return B}return null},selectItem:function(k){(k=this.getTreeNodeByItemId(k))&&k.isLeaf&&this.selectNodeWidget(k)},
unselectItem:function(k){(k=this.getTreeNodeByItemId(k))&&k.isLeaf&&k.unselect()},getAllLeafTreeNodeWidgets:function(){var k=this.getAllTreeNodeWidgets();return t.filter(k,g.hitch(this,function(x){return x.isLeaf}))},getAllTreeNodeWidgets:function(){var k=this._getAllTreeNodeDoms();return t.map(k,g.hitch(this,function(x){return a.byNode(x)}))},isLeafItem:function(k){return k&&k.isLeaf},_getAllTreeNodeDoms:function(){return v(".dijitTreeNode",this.domNode)},_createTreeNode:function(k){k.isLeaf=this.isLeafItem(k.item);
this.multiple||(k.groupId=this.uniqueId);return new n(k)},_onTreeNodeSelect:function(k){this.emit("item-select",{item:k.item,treeNode:k})},_onTreeNodeUnselect:function(k){this.emit("item-unselect",{item:k.item,treeNode:k})},selectNodeWidget:function(k){this.multiple||this.unselectAllLeafNodeWidgets();k.select()},_jimuBeforeClick:function(k,x,u){x.isLeaf&&(f.hasClass(u.target||u.srcElement,"jimu-tree-check-node")||(this.multiple?x.toggleSelect():this.selectNodeWidget(x)));return arguments},_onCheckNodeClick:function(k,
x,u){!this.multiple&&x&&this.unselectAllLeafNodeWidgets();c.stop(u);this.focusNode(k);setTimeout(g.hitch(this,function(){x?this.selectNodeWidget(k):k.unselect();this.onClick(k.item,k,u)}),0)},unselectAllLeafNodeWidgets:function(){var k=this.getAllLeafTreeNodeWidgets();t.forEach(k,g.hitch(this,function(x){x.unselect()}))}})})},"dijit/Tree":function(){define("dojo/_base/array dojo/aspect dojo/cookie dojo/_base/declare dojo/Deferred dojo/promise/all dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/errors/create dojo/fx dojo/has dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/topic dojo/touch dojo/when ./a11yclick ./focus ./registry ./_base/manager ./_Widget ./_TemplatedMixin ./_Container ./_Contained ./_CssStateMixin ./_KeyNavMixin dojo/text!./templates/TreeNode.html dojo/text!./templates/Tree.html ./tree/TreeStoreModel ./tree/ForestStoreModel ./tree/_dndSelector dojo/query!css2".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G,y,J,M,ba,W,E,O,H,P,S){function V(L){return l.delegate(L.promise||L,{addCallback:function(R){this.then(R)},addErrback:function(R){this.otherwise(R)}})}var Z=D("dijit._TreeNode",[G,y,J,M,ba],{item:null,isTreeNode:!0,label:"",_setLabelAttr:function(L){this.labelNode["html"==this.labelType?"innerHTML":"innerText"in this.labelNode?"innerText":"textContent"]=L;this._set("label",L);b("dojo-bidi")&&this.applyTextDir(this.labelNode)},labelType:"text",
isExpandable:null,isExpanded:!1,state:"NotLoaded",templateString:E,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);this.isExpandable&&this.labelNode.setAttribute("aria-expanded",this.isExpanded);this.setSelected(!1)},_setIndentAttr:function(L){var R=Math.max(L,0)*this.tree._nodePixelIndent+"px";q.set(this.domNode,
"backgroundPosition",R+" 0px");q.set(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",R);N.forEach(this.getChildren(),function(aa){aa.set("indent",L+1)});this._set("indent",L)},markProcessing:function(){this.state="Loading";this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(L){var R=this.tree,aa=R.model;R._v10Compat&&L===aa.root&&(L=null);this._applyClassAndStyle(L,"icon","Icon");this._applyClassAndStyle(L,"label","Label");this._applyClassAndStyle(L,
"row","Row");this.tree._startPaint(!0)},_applyClassAndStyle:function(L,R,aa){var ia="_"+R+"Class";R+="Node";var Q=this[ia];this[ia]=this.tree["get"+aa+"Class"](L,this.isExpanded);c.replace(this[R],this[ia]||"",Q||"");q.set(this[R],this.tree["get"+aa+"Style"](L,this.isExpanded)||{})},_updateLayout:function(){var L=this.getParent();L=!L||!L.rowNode||"none"==L.rowNode.style.display;c.toggle(this.domNode,"dijitTreeIsRoot",L);c.toggle(this.domNode,"dijitTreeIsLast",!L&&!this.getNextSibling())},_setExpando:function(L){var R=
["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"];L=L?0:this.isExpandable?this.isExpanded?1:2:3;c.replace(this.expandoNode,R[L],R);this.expandoNodeText.innerHTML=["*","-","+","*"][L]},expand:function(){if(this._expandDeferred)return V(this._expandDeferred);this._collapseDeferred&&(this._collapseDeferred.cancel(),delete this._collapseDeferred);this.isExpanded=!0;this.labelNode.setAttribute("aria-expanded","true");(this.tree.showRoot||this!==this.tree.rootNode)&&
this.containerNode.setAttribute("role","group");c.add(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","true");var L=d.wipeIn({node:this.containerNode,duration:w.defaultDuration}),R=this._expandDeferred=new g(function(){L.stop()});A.after(L,"onEnd",function(){R.resolve(!0)},!0);L.play();return V(R)},collapse:function(){if(this._collapseDeferred)return V(this._collapseDeferred);
this._expandDeferred&&(this._expandDeferred.cancel(),delete this._expandDeferred);this.isExpanded=!1;this.labelNode.setAttribute("aria-expanded","false");this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","false");c.remove(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);var L=d.wipeOut({node:this.containerNode,duration:w.defaultDuration}),R=this._collapseDeferred=new g(function(){L.stop()});A.after(L,"onEnd",
function(){R.resolve(!0)},!0);L.play();return V(R)},indent:0,setChildItems:function(L){var R=this.tree,aa=R.model,ia=[],Q=R.focusedChild,T=this.getChildren();N.forEach(T,function(Y){J.prototype.removeChild.call(this,Y)},this);this.defer(function(){N.forEach(T,function(Y){if(!Y._destroyed&&!Y.getParent()){R.dndController.removeTreeNode(Y);(function ra(na){var oa=aa.getIdentity(na.item),sa=R._itemNodesMap[oa];1==sa.length?delete R._itemNodesMap[oa]:(oa=N.indexOf(sa,na),-1!=oa&&sa.splice(oa,1));N.forEach(na.getChildren(),
ra)})(Y);if(R.persist){var ea=N.map(Y.getTreePath(),function(na){return R.model.getIdentity(na)}).join("/"),la;for(la in R._openedNodes)la.substr(0,ea.length)==ea&&delete R._openedNodes[la];R._saveExpandedNodes()}R.lastFocusedChild&&!t.isDescendant(R.lastFocusedChild.domNode,R.domNode)&&delete R.lastFocusedChild;Q&&!t.isDescendant(Q.domNode,R.domNode)&&R.focus();Y.destroyRecursive()}})});this.state="Loaded";L&&0<L.length?(this.isExpandable=!0,N.forEach(L,function(Y){var ea=aa.getIdentity(Y),la=R._itemNodesMap[ea];
if(la)for(var qa=0;qa<la.length;qa++)if(la[qa]&&!la[qa].getParent()){var na=la[qa];na.set("indent",this.indent+1);break}na||(na=this.tree._createTreeNode({item:Y,tree:R,isExpandable:aa.mayHaveChildren(Y),label:R.getLabel(Y),labelType:R.model&&R.model.labelType||"text",tooltip:R.getTooltip(Y),ownerDocument:R.ownerDocument,dir:R.dir,lang:R.lang,textDir:R.textDir,indent:this.indent+1}),la?la.push(na):R._itemNodesMap[ea]=[na]);this.addChild(na);(this.tree.autoExpand||this.tree._state(na))&&ia.push(R._expandNode(na))},
this),N.forEach(this.getChildren(),function(Y){Y._updateLayout()})):this.isExpandable=!1;this._setExpando&&this._setExpando(!1);this._updateItemClasses(this.item);L=f(ia);this.tree._startPaint(L);return V(L)},getTreePath:function(){for(var L=this,R=[];L&&L!==this.tree.rootNode;)R.unshift(L.item),L=L.getParent();R.unshift(this.tree.rootNode.item);return R},getIdentity:function(){return this.tree.model.getIdentity(this.item)},removeChild:function(L){this.inherited(arguments);var R=this.getChildren();
0==R.length&&(this.isExpandable=!1,this.collapse());N.forEach(R,function(aa){aa._updateLayout()})},makeExpandable:function(){this.isExpandable=!0;this._setExpando(!1)},setSelected:function(L){this.labelNode.setAttribute("aria-selected",L?"true":"false");c.toggle(this.rowNode,"dijitTreeRowSelected",L)},focus:function(){h.focus(this.focusNode)}});b("dojo-bidi")&&Z.extend({_setTextDirAttr:function(L){!L||this.textDir==L&&this._created||(this._set("textDir",L),this.applyTextDir(this.labelNode),N.forEach(this.getChildren(),
function(R){R.set("textDir",L)},this))}});var da=D("dijit.Tree",[G,W,y,ba],{baseClass:"dijitTree",store:null,model:null,query:null,label:"",showRoot:!0,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:!1,openOnDblClick:!1,templateString:O,persist:!1,autoExpand:!1,dndController:S,dndParams:"onDndDrop itemCreator onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,
checkItemAcceptance:null,dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(L,R){k.publish(this.id,l.mixin({tree:this,event:L},R||{}))},postMixInProperties:function(){this.tree=this;this.autoExpand&&(this.persist=!1);this._itemNodesMap={};!this.cookieName&&this.id&&(this.cookieName=this.id+"SaveStateCookie");this.expandChildrenDeferred=new g;this.pendingCommandsPromise=this.expandChildrenDeferred.promise;this.inherited(arguments)},postCreate:function(){this._initState();var L=
this;this.own(n(this.containerNode,n.selector(".dijitTreeNode",x.enter),function(ia){L._onNodeMouseEnter(r.byNode(this),ia)}),n(this.containerNode,n.selector(".dijitTreeNode",x.leave),function(ia){L._onNodeMouseLeave(r.byNode(this),ia)}),n(this.containerNode,n.selector(".dijitTreeRow",B.press),function(ia){L._onNodePress(r.getEnclosingWidget(this),ia)}),n(this.containerNode,n.selector(".dijitTreeRow",B),function(ia){L._onClick(r.getEnclosingWidget(this),ia)}),n(this.containerNode,n.selector(".dijitTreeRow",
"dblclick"),function(ia){L._onDblClick(r.getEnclosingWidget(this),ia)}));this.model||this._store2model();this.own(A.after(this.model,"onChange",l.hitch(this,"_onItemChange"),!0),A.after(this.model,"onChildrenChange",l.hitch(this,"_onItemChildrenChange"),!0),A.after(this.model,"onDelete",l.hitch(this,"_onItemDelete"),!0));this.inherited(arguments);if(this.dndController){l.isString(this.dndController)&&(this.dndController=l.getObject(this.dndController));for(var R={},aa=0;aa<this.dndParams.length;aa++)this[this.dndParams[aa]]&&
(R[this.dndParams[aa]]=this[this.dndParams[aa]]);this.dndController=new this.dndController(this,R)}this._load();this.onLoadDeferred=V(this.pendingCommandsPromise);this.onLoadDeferred.then(l.hitch(this,"onLoad"))},_store2model:function(){this._v10Compat=!0;a.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var L={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};this.params.mayHaveChildren&&(L.mayHaveChildren=
l.hitch(this,"mayHaveChildren"));this.params.getItemChildren&&(L.getChildren=l.hitch(this,function(R,aa,ia){this.getItemChildren(this._v10Compat&&R===this.model.root?null:R,aa,ia)}));this.model=new P(L);this.showRoot=!!this.label},onLoad:function(){},_load:function(){this.model.getRoot(l.hitch(this,function(L){var R=this.rootNode=this.tree._createTreeNode({item:L,tree:this,isExpandable:!0,label:this.label||this.getLabel(L),labelType:this.model.labelType||"text",textDir:this.textDir,indent:this.showRoot?
0:-1});this.showRoot?(this.domNode.setAttribute("aria-multiselectable",!this.dndController.singular),this.rootLoadingIndicator.style.display="none"):(R.rowNode.style.display="none",this.domNode.setAttribute("role","presentation"),this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("aria-multiselectable"),this["aria-label"]?(R.containerNode.setAttribute("aria-label",this["aria-label"]),this.domNode.removeAttribute("aria-label")):this["aria-labelledby"]&&(R.containerNode.setAttribute("aria-labelledby",
this["aria-labelledby"]),this.domNode.removeAttribute("aria-labelledby")),R.labelNode.setAttribute("role","presentation"),R.labelNode.removeAttribute("aria-selected"),R.containerNode.setAttribute("role","tree"),R.containerNode.setAttribute("aria-expanded","true"),R.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular));this.containerNode.appendChild(R.domNode);L=this.model.getIdentity(L);this._itemNodesMap[L]?this._itemNodesMap[L].push(R):this._itemNodesMap[L]=[R];R._updateLayout();
this._expandNode(R).then(l.hitch(this,function(){this._destroyed||(this.rootLoadingIndicator.style.display="none",this.expandChildrenDeferred.resolve(!0))}))}),l.hitch(this,function(L){console.error(this,": error loading root: ",L)}))},getNodesByItem:function(L){if(!L)return[];L=l.isString(L)?L:this.model.getIdentity(L);return[].concat(this._itemNodesMap[L])},_setSelectedItemAttr:function(L){this.set("selectedItems",[L])},_setSelectedItemsAttr:function(L){var R=this;return this.pendingCommandsPromise=
this.pendingCommandsPromise.always(l.hitch(this,function(){var aa=N.map(L,function(Q){return!Q||l.isString(Q)?Q:R.model.getIdentity(Q)}),ia=[];N.forEach(aa,function(Q){ia=ia.concat(R._itemNodesMap[Q]||[])});this.set("selectedNodes",ia)}))},_setPathAttr:function(L){return L.length?V(this.set("paths",[L]).then(function(R){return R[0]})):V(this.set("paths",[]).then(function(R){return R[0]}))},_setPathsAttr:function(L){function R(ia,Q){var T=ia.shift(),Y=N.filter(Q,function(ea){return ea.getIdentity()==
T})[0];if(Y)return ia.length?aa._expandNode(Y).then(function(){return R(ia,Y.getChildren())}):Y;throw new da.PathError("Could not expand path at "+T);}var aa=this;return V(this.pendingCommandsPromise=this.pendingCommandsPromise.always(function(){return f(N.map(L,function(ia){ia=N.map(ia,function(Q){return Q&&l.isObject(Q)?aa.model.getIdentity(Q):Q});if(ia.length)return R(ia,[aa.rootNode]);throw new da.PathError("Empty path");}))}).then(function(ia){aa.set("selectedNodes",ia);return aa.paths}))},_setSelectedNodeAttr:function(L){this.set("selectedNodes",
[L])},_setSelectedNodesAttr:function(L){this.dndController.setSelection(L)},expandAll:function(){function L(aa){return R._expandNode(aa).then(function(){var ia=N.filter(aa.getChildren()||[],function(Q){return Q.isExpandable});return f(N.map(ia,L))})}var R=this;return V(L(this.rootNode))},collapseAll:function(){function L(aa){var ia=N.filter(aa.getChildren()||[],function(Q){return Q.isExpandable});ia=f(N.map(ia,L));return!aa.isExpanded||aa==R.rootNode&&!R.showRoot?ia:ia.then(function(){return R._collapseNode(aa)})}
var R=this;return V(L(this.rootNode))},mayHaveChildren:function(){},getItemChildren:function(){},getLabel:function(L){return this.model.getLabel(L)},getIconClass:function(L,R){return!L||this.model.mayHaveChildren(L)?R?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf"},getLabelClass:function(){},getRowClass:function(){},getIconStyle:function(){},getLabelStyle:function(){},getRowStyle:function(){},getTooltip:function(){return""},_onDownArrow:function(L,R){(L=this._getNext(R))&&L.isTreeNode&&this.focusNode(L)},
_onUpArrow:function(L,R){if(L=R.getPreviousSibling())for(R=L;R.isExpandable&&R.isExpanded&&R.hasChildren();)R=R.getChildren(),R=R[R.length-1];else if(L=R.getParent(),this.showRoot||L!==this.rootNode)R=L;R&&R.isTreeNode&&this.focusNode(R)},_onRightArrow:function(L,R){R.isExpandable&&!R.isExpanded?this._expandNode(R):R.hasChildren()&&(R=R.getChildren()[0])&&R.isTreeNode&&this.focusNode(R)},_onLeftArrow:function(L,R){R.isExpandable&&R.isExpanded?this._collapseNode(R):(L=R.getParent())&&L.isTreeNode&&
(this.showRoot||L!==this.rootNode)&&this.focusNode(L)},focusLastChild:function(){var L=this._getLast();L&&L.isTreeNode&&this.focusNode(L)},_getFirst:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0]},_getLast:function(){for(var L=this.rootNode;L.isExpanded;){var R=L.getChildren();if(!R.length)break;L=R[R.length-1]}return L},_getNext:function(L){if(L.isExpandable&&L.isExpanded&&L.hasChildren())return L.getChildren()[0];for(;L&&L.isTreeNode;){var R=L.getNextSibling();if(R)return R;
L=L.getParent()}return null},childSelector:".dijitTreeRow",isExpandoNode:function(L,R){return t.isDescendant(L,R.expandoNode)||t.isDescendant(L,R.expandoNodeText)},_onNodePress:function(L,R){this.focusNode(L)},__click:function(L,R,aa,ia){var Q=this.isExpandoNode(R.target,L);L.isExpandable&&(aa||Q)?this._onExpandoClick({node:L}):(this._publish("execute",{item:L.item,node:L,evt:R}),this[ia](L.item,L,R),this.focusNode(L));R.stopPropagation();R.preventDefault()},_onClick:function(L,R){this.__click(L,
R,this.openOnClick,"onClick")},_onDblClick:function(L,R){this.__click(L,R,this.openOnDblClick,"onDblClick")},_onExpandoClick:function(L){L=L.node;this.focusNode(L);L.isExpanded?this._collapseNode(L):this._expandNode(L)},onClick:function(){},onDblClick:function(){},onOpen:function(){},onClose:function(){},_getNextNode:function(L){a.deprecated(this.declaredClass+"::_getNextNode(node) is deprecated. Use _getNext(node) instead.","","2.0");return this._getNext(L)},_getRootOrFirstNode:function(){a.deprecated(this.declaredClass+
"::_getRootOrFirstNode() is deprecated. Use _getFirst() instead.","","2.0");return this._getFirst()},_collapseNode:function(L){L._expandNodeDeferred&&delete L._expandNodeDeferred;if("Loading"!=L.state&&L.isExpanded){var R=L.collapse();this.onClose(L.item,L);this._state(L,!1);this._startPaint(R);return R}},_expandNode:function(L){if(L._expandNodeDeferred)return L._expandNodeDeferred;var R=this.model,aa=L.item,ia=this;L._loadDeferred||(L.markProcessing(),L._loadDeferred=new g,R.getChildren(aa,function(Q){L.unmarkProcessing();
L.setChildItems(Q).then(function(){L._loadDeferred.resolve(Q)})},function(Q){console.error(ia,": error loading "+L.label+" children: ",Q);L._loadDeferred.reject(Q)}));R=L._loadDeferred.then(l.hitch(this,function(){var Q=L.expand();this.onOpen(L.item,L);this._state(L,!0);return Q}));this._startPaint(R);return R},focusNode:function(L){for(var R=[],aa=this.domNode;aa&&aa.tagName&&"IFRAME"!==aa.tagName.toUpperCase();aa=aa.parentNode)R.push({domNode:aa.contentWindow||aa,scrollLeft:aa.scrollLeft||0,scrollTop:aa.scrollTop||
0});this.focusChild(L);this.defer(function(){for(var ia=0,Q=R.length;ia<Q;ia++)R[ia].domNode.scrollLeft=R[ia].scrollLeft,R[ia].domNode.scrollTop=R[ia].scrollTop},0)},_onNodeMouseEnter:function(){},_onNodeMouseLeave:function(){},_onItemChange:function(L){var R=this.model.getIdentity(L);if(R=this._itemNodesMap[R]){var aa=this.getLabel(L),ia=this.getTooltip(L);N.forEach(R,function(Q){Q.set({item:L,label:aa,tooltip:ia});Q._updateItemClasses(L)})}},_onItemChildrenChange:function(L,R){L=this.model.getIdentity(L);
(L=this._itemNodesMap[L])&&N.forEach(L,function(aa){aa.setChildItems(R)})},_onItemDelete:function(L){L=this.model.getIdentity(L);var R=this._itemNodesMap[L];R&&(N.forEach(R,function(aa){this.dndController.removeTreeNode(aa);var ia=aa.getParent();ia&&ia.removeChild(aa);this.lastFocusedChild&&!t.isDescendant(this.lastFocusedChild.domNode,this.domNode)&&delete this.lastFocusedChild;this.focusedChild&&!t.isDescendant(this.focusedChild.domNode,this.domNode)&&this.focus();aa.destroyRecursive()},this),delete this._itemNodesMap[L])},
_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var L=F(this.cookieName);L&&N.forEach(L.split(","),function(R){this._openedNodes[R]=!0},this)}},_state:function(L,R){if(!this.persist)return!1;var aa=N.map(L.getTreePath(),function(ia){return this.model.getIdentity(ia)},this).join("/");if(1===arguments.length)return this._openedNodes[aa];R?this._openedNodes[aa]=!0:delete this._openedNodes[aa];this._saveExpandedNodes()},_saveExpandedNodes:function(){if(this.persist&&this.cookieName){var L=
[],R;for(R in this._openedNodes)L.push(R);F(this.cookieName,L.join(","),{expires:365})}},destroy:function(){this._curSearch&&(this._curSearch.timer.remove(),delete this._curSearch);this.rootNode&&this.rootNode.destroyRecursive();this.dndController&&!l.isString(this.dndController)&&this.dndController.destroy();this.rootNode=null;this.inherited(arguments)},destroyRecursive:function(){this.destroy()},resize:function(L){L&&v.setMarginBox(this.domNode,L);this._nodePixelIndent=v.position(this.tree.indentDetector).w||
this._nodePixelIndent;this.expandChildrenDeferred.then(l.hitch(this,function(){this.rootNode.set("indent",this.showRoot?0:-1);this._adjustWidths()}))},_outstandingPaintOperations:0,_startPaint:function(L){this._outstandingPaintOperations++;this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);var R=l.hitch(this,function(){this._outstandingPaintOperations--;0>=this._outstandingPaintOperations&&!this._adjustWidthsTimer&&this._started&&(this._adjustWidthsTimer=this.defer("_adjustWidths"))});
u(L,R,R)},_adjustWidths:function(){this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);this.containerNode.style.width="auto";this.containerNode.style.width=this.domNode.scrollWidth>this.domNode.offsetWidth?"auto":"100%"},_createTreeNode:function(L){return new Z(L)},focus:function(){this.lastFocusedChild?this.focusNode(this.lastFocusedChild):this.focusFirstChild()}});b("dojo-bidi")&&da.extend({_setTextDirAttr:function(L){L&&this.textDir!=L&&(this._set("textDir",
L),this.rootNode.set("textDir",L))}});da.PathError=e("TreePathError");da._TreeNode=Z;return da})},"dijit/tree/TreeStoreModel":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(N,A,F,D){return F("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(g){D.mixin(this,g);this.connects=[];g=this.store;if(!g.getFeatures()["dojo.data.api.Identity"])throw Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");
g.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([A.after(g,"onNew",D.hitch(this,"onNewItem"),!0),A.after(g,"onDelete",D.hitch(this,"onDeleteItem"),!0),A.after(g,"onSet",D.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var g;g=this.connects.pop();)g.remove()},getRoot:function(g,f){this.root?g(this.root):this.store.fetch({query:this.query,onComplete:D.hitch(this,function(t){if(1!=t.length)throw Error("dijit.tree.TreeStoreModel: root query returned "+t.length+
" items, but must return exactly one");this.root=t[0];g(this.root)}),onError:f})},mayHaveChildren:function(g){return N.some(this.childrenAttrs,function(f){return this.store.hasAttribute(g,f)},this)},getChildren:function(g,f,t){var c=this.store;if(c.isItemLoaded(g)){for(var v=[],q=0;q<this.childrenAttrs.length;q++){var e=c.getValues(g,this.childrenAttrs[q]);v=v.concat(e)}var d=0;this.deferItemLoadingUntilExpand||N.forEach(v,function(a){c.isItemLoaded(a)||d++});0==d?f(v):N.forEach(v,function(a,m){c.isItemLoaded(a)||
c.loadItem({item:a,onItem:function(l){v[m]=l;0==--d&&f(v)},onError:t})})}else{var b=D.hitch(this,arguments.callee);c.loadItem({item:g,onItem:function(a){b(a,f,t)},onError:t})}},isItem:function(g){return this.store.isItem(g)},fetchItemByIdentity:function(g){this.store.fetchItemByIdentity(g)},getIdentity:function(g){return this.store.getIdentity(g)},getLabel:function(g){return this.labelAttr?this.store.getValue(g,this.labelAttr):this.store.getLabel(g)},newItem:function(g,f,t){var c={parent:f,attribute:this.childrenAttrs[0]},
v;this.newItemIdAttr&&g[this.newItemIdAttr]?this.fetchItemByIdentity({identity:g[this.newItemIdAttr],scope:this,onItem:function(q){q?this.pasteItem(q,null,f,!0,t):(v=this.store.newItem(g,c))&&void 0!=t&&this.pasteItem(v,f,f,!1,t)}}):(v=this.store.newItem(g,c))&&void 0!=t&&this.pasteItem(v,f,f,!1,t)},pasteItem:function(g,f,t,c,v){var q=this.store,e=this.childrenAttrs[0];f&&N.forEach(this.childrenAttrs,function(b){if(q.containsValue(f,b,g)){if(!c){var a=N.filter(q.getValues(f,b),function(m){return m!=
g});q.setValues(f,b,a)}e=b}});if(t)if("number"==typeof v){var d=q.getValues(t,e).slice();d.splice(v,0,g);q.setValues(t,e,d)}else q.setValues(t,e,q.getValues(t,e).concat(g))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(g,f){f&&this.getChildren(f.item,D.hitch(this,function(t){this.onChildrenChange(f.item,t)}))},onDeleteItem:function(g){this.onDelete(g)},onSetItem:function(g,f){if(-1!=N.indexOf(this.childrenAttrs,f))this.getChildren(g,D.hitch(this,function(t){this.onChildrenChange(g,
t)}));else this.onChange(g)}})})},"dijit/tree/ForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(N,A,F,D,g){return A("dijit.tree.ForestStoreModel",g,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(f){this.root={store:this,root:!0,id:f.rootId,label:f.rootLabel,children:f.rootChildren}},mayHaveChildren:function(f){return f===this.root||this.inherited(arguments)},getChildren:function(f,t,c){f===
this.root?this.root.children?t(this.root.children):this.store.fetch({query:this.query,onComplete:D.hitch(this,function(v){this.root.children=v;t(v)}),onError:c}):this.inherited(arguments)},isItem:function(f){return f===this.root?!0:this.inherited(arguments)},fetchItemByIdentity:function(f){if(f.identity==this.root.id){var t=f.scope||F.global;f.onItem&&f.onItem.call(t,this.root)}else this.inherited(arguments)},getIdentity:function(f){return f===this.root?this.root.id:this.inherited(arguments)},getLabel:function(f){return f===
this.root?this.root.label:this.inherited(arguments)},newItem:function(f,t,c){return t===this.root?(this.onNewRootItem(f),this.store.newItem(f)):this.inherited(arguments)},onNewRootItem:function(){},pasteItem:function(f,t,c,v,q){if(t===this.root&&!v)this.onLeaveRoot(f);this.inherited(arguments,[f,t===this.root?null:t,c===this.root?null:c,v,q]);if(c===this.root)this.onAddToRoot(f)},onAddToRoot:function(f){console.log(this,": item ",f," added to root")},onLeaveRoot:function(f){console.log(this,": item ",
f," removed from root")},_requeryTop:function(){var f=this.root.children||[];this.store.fetch({query:this.query,onComplete:D.hitch(this,function(t){this.root.children=t;if(f.length!=t.length||N.some(f,function(c,v){return t[v]!=c}))this.onChildrenChange(this.root,t)})})},onNewItem:function(f,t){this._requeryTop();this.inherited(arguments)},onDeleteItem:function(f){-1!=N.indexOf(this.root.children,f)&&this._requeryTop();this.inherited(arguments)},onSetItem:function(f,t,c,v){this._requeryTop();this.inherited(arguments)}})})},
"dijit/tree/_dndSelector":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/dnd/common dojo/dom dojo/mouse dojo/on dojo/touch ../a11yclick ./_dndContainer".split(" "),function(N,A,F,D,g,f,t,c,v,q,e){return A("dijit.tree._dndSelector",e,{constructor:function(){this.selection={};this.anchor=null;this.events.push(c(this.tree.domNode,v.press,D.hitch(this,"onMouseDown")),c(this.tree.domNode,v.release,D.hitch(this,"onMouseUp")),c(this.tree.domNode,v.move,D.hitch(this,
"onMouseMove")),c(this.tree.domNode,q.press,D.hitch(this,"onClickPress")),c(this.tree.domNode,q.release,D.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var d=[],b=this.selection,a;for(a in b)d.push(b[a]);return d},selectNone:function(){this.setSelection([]);return this},destroy:function(){this.inherited(arguments);this.selection=this.anchor=null},addTreeNode:function(d,b){this.setSelection(this.getSelectedTreeNodes().concat([d]));b&&(this.anchor=d);return d},removeTreeNode:function(d){var b=
N.filter(this.getSelectedTreeNodes(),function(a){return!f.isDescendant(a.domNode,d.domNode)});this.setSelection(b);return d},isTreeNodeSelected:function(d){return d.id&&!!this.selection[d.id]},setSelection:function(d){var b=this.getSelectedTreeNodes();N.forEach(this._setDifference(b,d),D.hitch(this,function(a){a.setSelected(!1);this.anchor==a&&delete this.anchor;delete this.selection[a.id]}));N.forEach(this._setDifference(d,b),D.hitch(this,function(a){a.setSelected(!0);this.selection[a.id]=a}));this._updateSelectionProperties()},
_setDifference:function(d,b){N.forEach(b,function(a){a.__exclude__=!0});d=N.filter(d,function(a){return!a.__exclude__});N.forEach(b,function(a){delete a.__exclude__});return d},_updateSelectionProperties:function(){var d=this.getSelectedTreeNodes(),b=[],a=[];N.forEach(d,function(m){var l=m.getTreePath();a.push(m);b.push(l)},this);d=N.map(a,function(m){return m.item});this.tree._set("paths",b);this.tree._set("path",b[0]||[]);this.tree._set("selectedNodes",a);this.tree._set("selectedNode",a[0]||null);
this.tree._set("selectedItems",d);this.tree._set("selectedItem",d[0]||null)},onClickPress:function(d){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(d.target,this.current))){"mousedown"==d.type&&t.isLeft(d)&&d.preventDefault();var b="keydown"==d.type?this.tree.focusedChild:this.current;if(b){var a=g.getCopyKeyState(d),m=b.id;this.singular||d.shiftKey||!this.selection[m]?(this._doDeselect=!1,this.userSelect(b,a,d.shiftKey)):this._doDeselect=!0}}},onClickRelease:function(d){this._doDeselect&&
(this._doDeselect=!1,this.userSelect("keyup"==d.type?this.tree.focusedChild:this.current,g.getCopyKeyState(d),d.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(d,b){if(d===b)return 0;if("sourceIndex"in document.documentElement)return d.sourceIndex-b.sourceIndex;if("compareDocumentPosition"in document.documentElement)return d.compareDocumentPosition(b)&2?1:-1;if(document.createRange){var a=doc.createRange();a.setStartBefore(d);
d=doc.createRange();d.setStartBefore(b);return a.compareBoundaryPoints(a.END_TO_END,d)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");},userSelect:function(d,b,a){if(this.singular)this.anchor==d&&b?this.selectNone():(this.setSelection([d]),this.anchor=d);else if(a&&this.anchor){b=this._compareNodes(this.anchor.rowNode,d.rowNode);a=this.anchor;0>b?b=a:(b=d,d=a);for(a=[];b!=d;)a.push(b),b=this.tree._getNext(b);a.push(d);this.setSelection(a)}else this.selection[d.id]&&
b?this.removeTreeNode(d):b?this.addTreeNode(d,!0):(this.setSelection([d]),this.anchor=d)},getItem:function(d){return{data:this.selection[d],type:["treeNode"]}},forInSelectedItems:function(d,b){b=b||F.global;for(var a in this.selection)d.call(b,this.getItem(a),a,this)}})})},"dijit/tree/_dndContainer":function(){define("dojo/aspect dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/on dojo/touch".split(" "),function(N,A,F,D,g,f){return A("dijit.tree._dndContainer",null,{constructor:function(t,c){this.tree=
t;this.node=t.domNode;D.mixin(this,c);this.containerState="";F.add(this.node,"dojoDndContainer");this.events=[g(this.node,f.enter,D.hitch(this,"onOverEvent")),g(this.node,f.leave,D.hitch(this,"onOutEvent")),N.after(this.tree,"_onNodeMouseEnter",D.hitch(this,"onMouseOver"),!0),N.after(this.tree,"_onNodeMouseLeave",D.hitch(this,"onMouseOut"),!0),g(this.node,"dragstart, selectstart",function(v){v.preventDefault()})]},destroy:function(){for(var t;t=this.events.pop();)t.remove();this.node=this.parent=
null},onMouseOver:function(t){this.current=t},onMouseOut:function(){this.current=null},_changeState:function(t,c){var v="dojoDnd"+t;t=t.toLowerCase()+"State";F.replace(this.node,v+c,v+this[t]);this[t]=c},_addItemClass:function(t,c){F.add(t,"dojoDndItem"+c)},_removeItemClass:function(t,c){F.remove(t,"dojoDndItem"+c)},onOverEvent:function(){this._changeState("Container","Over")},onOutEvent:function(){this._changeState("Container","")}})})},"jimu/dijit/LayerChooserFromMapWithDropbox":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/Deferred dijit/popup dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/LayerChooserFromMapWithDropbox.html jimu/LayerInfos/LayerInfos".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d){return N([v,q,f],{templateString:e,baseClass:"jimu-layer-chooser-from-map-withdropbox",declaredClass:"jimu.dijit.LayerChooserFromMapWithDropbox",_selectedItem:null,_isLayerChooserShow:!1,layerInfosObj:null,layerChooser:null,customClass:"",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.queryableLayerSource;this.nls.customSelectLayer=this.label?this.label:this.nls.selectLayer},postCreate:function(){this.inherited(arguments);this.layerInfosObj=
d.getInstanceSync();this.layerChooser.domNode.style.zIndex=1;this.layerChooser.tree.domNode.style.borderTop="0";this.layerChooser.tree.domNode.style.maxHeight="290px";this.own(D(this.layerChooser,"tree-click",A.hitch(this,this._onTreeClick)));this.own(D(this.layerChooser,"update",A.hitch(this,this._onLayerChooserUpdate)));this.own(D(document.body,"click",A.hitch(this,this._onBodyClicked)));this.own(D(document.body,"keydown",A.hitch(this,function(b){b.keyCode===g.ENTER&&this._onBodyClicked(b)})));
this.own(D(this.layerChooser.domNode,"keydown",A.hitch(this,function(b){b.keyCode===g.ESCAPE&&this.hideLayerChooser()})))},destroy:function(){this.hideLayerChooser();this.layerChooser&&this.layerChooser.destroy();this.layerChooser=null;this.inherited(arguments)},getLayerChooser:function(){return this.layerChooser},setSelectedLayer:function(b){var a=new t;if(b){var m=this.layerInfosObj.getLayerOrTableInfoById(b.id);m?this.layerChooser.filter(m).then(A.hitch(this,function(l){l?(this._onSelectNewItem({layerInfo:m,
name:m.title,url:b.url}),a.resolve(!0)):a.resolve(!1)}),A.hitch(this,function(){a.resolve(!1)})):a.resolve(!1)}else this._onSelectNewItem(null),a.resolve(!0);return a},getSelectedItem:function(){return this._selectedItem},getSelectedItems:function(){return[this._selectedItem]},_onBodyClicked:function(b){b=b.target||b.srcElement;b===this.domNode||F.isDescendant(b,this.domNode)||b===this.layerChooser.domNode||F.isDescendant(b,this.layerChooser.domNode)||this.hideLayerChooser()},_onDropDownClick:function(b){b.stopPropagation();
b.preventDefault();this._isLayerChooserShow?this.hideLayerChooser():(this.isActive=!0,this.showLayerChooser())},_onDropDownKeydown:function(b){b.keyCode===g.ENTER&&this._onDropDownClick(b)},_getSelectedItems:function(){return this.layerChooser.getSelectedItems()},showLayerChooser:function(){this.layerChooser.domNode.style.minWidth=this.domNode.clientWidth+2+"px";c.open({parent:this,popup:this.layerChooser,around:this.domNode});var b=this.layerChooser.domNode.parentNode;b&&(F.addClass(b,"jimu-layer-chooser-from-map-withdropbox-popup"),
this.customClass&&F.addClass(b,this.customClass),this.layerChooser.tree.domNode.focus());this._isLayerChooserShow=!0},hideLayerChooser:function(){c.close(this.layerChooser);this._isLayerChooserShow=!1;this.isActive&&(this.dropDownBtn.focus(),this.isActive=!1)},_onLayerChooserUpdate:function(){this._selectedItem&&this.layerChooser.onlyShowVisible&&!this._selectedItem.layerInfo.isShowInMap()&&(this._selectedItem=null,this.emit("selection-change",[]))},_onSelectNewItem:function(b){var a=A.getObject("layerInfo.id",
!1,this._selectedItem)||-1,m=A.getObject("layerInfo.id",!1,b)||-1;a=a!==m;this._selectedItem=b;this.hideLayerChooser();b=A.getObject("layerInfo.title",!1,this._selectedItem)||"";this.layerNameNode.innerHTML=b;F.setAttr(this.layerNameNode,"title",b);b=A.getObject("layerInfo.layerObject",!1,this._selectedItem);a&&this.emit("selection-change",[b])},_onTreeClick:function(){var b=this._getSelectedItems();this._onSelectNewItem(0<b.length?b[0]:null)}})})},"widgets/SmartEditor/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/geometry/Extent jimu/utils esri/dijit/AttributeInspector".split(" "),
function(N,A,F,D,g,f){var t={};t.ATI=N([f],{constructor:function(){this._aiConnects=[];this._selection=[];this._toolTips=[]}});t.checkIfFieldAliasAlreadyExists=function(c,v){return 0<=c.split(",").indexOf(v)};t.pointToExtent=function(c,v,q){var e=c.extent.getWidth()/c.width;q*=e;return new D(v.x-q,v.y-q,v.x+q,v.y+q,c.spatialReference)};t.filterOnlyUpdatedAttributes=function(c,v,q){if(null===v||void 0===v)return c;var e={},d;for(d in c)c.hasOwnProperty(d)&&(d===q.objectIdField||d===q.globalIdField?
e[d]=c[d]:(null!==c[d]||""!==v[d])&&c[d]!==v[d]&&(e[d]=c[d]));return e};t.mergeFieldInfosWithConfiguration=function(c,v){var q=[],e=this.getDefaultEditableFieldInfos(c,!1);v&&v.fieldInfos?(F.forEach(v.fieldInfos,function(a){F.some(e,function(m){if(a.fieldName===m.fieldName)return q.push(this.mergeLastToFirst(m,a)),!0},this)},this),F.forEach(e,function(a){0===F.filter(q,function(m){return m.fieldName===a.fieldName},this).length&&q.push(a)},this)):q=e;var d=[];c.layerObject.hasOwnProperty("globalIdField")&&
void 0!==c.layerObject.globalIdField&&null!==c.layerObject.globalIdField&&d.push(c.layerObject.globalIdField);c.layerObject.hasOwnProperty("objectIdField")&&void 0!==c.layerObject.objectIdField&&null!==c.layerObject.objectIdField&&d.push(c.layerObject.objectIdField);if(c.layerObject.hasOwnProperty("editFieldsInfo")&&void 0!==c.layerObject.editFieldsInfo&&null!==c.layerObject.editFieldsInfo)for(var b in c.layerObject.editFieldsInfo)c.layerObject.editFieldsInfo.hasOwnProperty(b)&&d.push(c.layerObject.editFieldsInfo[b]);
return q=q.filter(function(a){return-1!==F.indexOf(d,a.fieldName)?!1:a.isEditableOnLayer})};t.getDefaultEditableFieldInfos=function(c,v){var q=[],e=this.getFieldInfosFromWebmap(c);c=this.getFieldInfosLayer(c);if(void 0===e||null===e)e=c;else{var d=[];F.forEach(c,function(b){0===F.filter(e,function(a){return a.name===b.fieldName}).length&&(b.isEditableOnLayer=b.editable,d.push(b))});0<d.length&&(e=e.concat(d))}F.forEach(e,function(b){!1===b.hasOwnProperty("isEditableOnLayer")&&(b.isEditableOnLayer=
b.editable);!1===b.editable&&(b.isEditable=b.editable);!1===b.isEditable&&(b.editable=b.isEditable);!0===b.editable&&(b.visible=!0);b.fieldName=b.name;!0===b.editable&&!0===v?q.push(A.clone(b)):!1===v&&q.push(A.clone(b))});return q};t.updatePopupDateFormat=function(c){var v={shortDate:{datePattern:"M/d/y"},shortDateLE:{datePattern:"d/M/y"},longMonthDayYear:{datePattern:"MMMM d, y"},dayShortMonthYear:{datePattern:"d MMM y"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",
timePattern:"h:mm a",timeEnabled:!0},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",timeEnabled:!0},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",timeEnabled:!0},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",timeEnabled:!0},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",timeEnabled:!0},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",timeEnabled:!0},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",timeEnabled:!0},
shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",timeEnabled:!0},longMonthYear:{datePattern:"MMMM y"},shortMonthYear:{datePattern:"MMM y"},year:{datePattern:"y"}},q="",e;for(e in v)if(g.isEqual(c,v[e])){q=e;break}return q};t.getFieldInfosFromWebmap=function(c){var v=null,q=c.getPopupInfo();q&&q.fieldInfos&&(v=[],F.forEach(q.fieldInfos,function(e){F.some(c.layerObject.fields,function(d){if(d.name===e.fieldName)return d=this.mergeFirstToLast(e,d),d.format&&d.format.dateFormat&&(d.format.dateFormat.hasOwnProperty("datePattern")||
d.format.dateFormat.hasOwnProperty("timePattern"))&&(d.format.dateFormat=this.updatePopupDateFormat(d.format.dateFormat)),d.format&&d.format.dateFormat&&d.format.dateFormat.toLowerCase()&&0<=d.format.dateFormat.toLowerCase().indexOf("time")&&(d.format.time=!0),v.push(d),!0},this)},this));return v};t.getFieldInfosLayer=function(c){var v=[];c&&c.layerObject&&F.forEach(c.layerObject.fields,function(q){var e=g.getDefaultPortalFieldInfo(q);e=this.mergeFirstToLast(e,q);e.format&&e.format.dateFormat&&(e.format.dateFormat.hasOwnProperty("datePattern")||
e.format.dateFormat.hasOwnProperty("timePattern"))&&(e.format.dateFormat=this.updatePopupDateFormat(e.format.dateFormat));e.format&&e.format.dateFormat&&e.format.dateFormat.toLowerCase()&&0<=e.format.dateFormat.toLowerCase().indexOf("time")&&(e.format.time=!0);e.visible=!0;v.push(e)},this);return v};t.getConfigInfos=function(c,v,q,e,d){var b=[],a=c.getLayerInfoArrayOfWebmap(),m=[];d&&(m=c.getTableInfoArrayOfWebmap(),a=a.concat(m));F.forEach(a,function(l){var n=!1;"Table"!==l.layerObject.type&&"Feature Layer"!==
l.layerObject.type||!l.layerObject.url||(l.layerObject.isEditable&&l.layerObject.isEditable()&&q?n=!0:void 0!==q&&!1===q&&(n=!0));if(!0===n){var k=this.getConfigInfo(l,v);k.layerInfo=l;!0===k.featureLayer.layerAllowsDelete&&!1===k.featureLayer.layerAllowsCreate&&!1===k.featureLayer.layerAllowsUpdate?console.warn(k.layerInfo.title+" delete only not supported"):e&&!0===e?!0===F.some(v,function(x){return x.featureLayer.id===k.featureLayer.id})&&b.push(k):b.push(k)}},this);return b};t.getConfigInfo=function(c,
v){var q=null,e=this.createDefaultConfigInfo(c);!1===F.some(v,function(d){return d.featureLayer&&d.featureLayer.id===c.layerObject.id?(q=A.clone(d),q.fieldInfos=this.mergeFieldInfosWithConfiguration(c,q),q=this.mergeDefaultWithConfig(q,e),!0):!1},this)&&(q=e);return q};t.mergeDefaultWithConfig=function(c,v){c.featureLayer=v.featureLayer;!0===c.allowDelete&&!1===c.featureLayer.layerAllowsDelete&&(c.allowDelete=!1);!1===c.disableGeometryUpdate&&!1===c.featureLayer.layerAllowGeometryUpdates&&(c.disableGeometryUpdate=
!0);!1===c.featureLayer.layerAllowsCreate&&!0===c.featureLayer.layerAllowsUpdate&&(c.allowUpdateOnly=!0);return c};t.createDefaultConfigInfo=function(c){var v=!1,q=!1,e=!1,d=!1;try{var b=c.layerObject.getEditCapabilities();b.canCreate&&(v=!0);b.canUpdate&&(d=q=!0);b.canDelete&&(e=!0)}catch(a){c.layerObject.hasOwnProperty("capabilities")&&(-1===String(c.layerObject.capabilities).indexOf("Update")&&-1===String(c.layerObject.capabilities).indexOf("Delete")&&-1===String(c.layerObject.capabilities).indexOf("Create")&&
-1!==String(c.layerObject.capabilities).indexOf("Editing")?v=e=q=!0:(-1!==String(c.layerObject.capabilities).indexOf("Update")&&(d=q=!0),-1!==String(c.layerObject.capabilities).indexOf("Delete")&&(e=!0),-1!==String(c.layerObject.capabilities).indexOf("Create")&&(v=!0)))}c.layerObject.hasOwnProperty("allowGeometryUpdates")&&(d=c.layerObject.allowGeometryUpdates);"Table"===c.layerObject.type&&c.layerObject.url&&c.getCapabilitiesOfWebMap()&&(q=c.getCapabilitiesOfWebMap(),c.layerObject.isEditable&&c.layerObject.isEditable()&&
q&&-1<q.toLowerCase().indexOf("editing")?q=!0:e=q=v=!1,d=!1);d=d&&q;return{featureLayer:{id:c.layerObject.id,layerAllowsCreate:v,layerAllowsUpdate:q,layerAllowsDelete:e,layerAllowGeometryUpdates:d},disableGeometryUpdate:!d,allowUpdateOnly:!v,allowDelete:!1,fieldInfos:this.mergeFieldInfosWithConfiguration(c,null),_editFlag:v||q?!0:!1}};t.mergeLastToFirst=function(){for(var c={},v=0,q=arguments.length,e;v<q;v++)for(e in arguments[v])arguments[v].hasOwnProperty(e)&&(c[e]=arguments[v][e]);return c};t.mergeFirstToLast=
function(){for(var c={},v=arguments.length-1,q;0<=v;v--)for(q in arguments[v])arguments[v].hasOwnProperty(q)&&(c[q]=arguments[v][q]);return c};t.isObjectEmpty=function(c){if(c)for(var v in c)if(c.hasOwnProperty(v))return!1;return!0};t.addDateTimeFormat=function(c){c&&c.format&&null!==c.format&&c.format.dateFormat&&null!==c.format.dateFormat&&0<=c.format.dateFormat.toString().toUpperCase().indexOf("TIME")&&(c.format.time=!0)};t.isDuplicateGroupName=function(c,v){var q=!1;F.some(v,A.hitch(this,function(e){if(c.toLowerCase()===
e.toLowerCase())return q=!0}));return q};return t})},"widgets/SmartEditor/presetBuilderBackwardCompatibility":function(){define(["dojo/_base/lang","dojo/_base/array","jimu/utils","./presetUtils"],function(N,A,F,D){var g={createPresetGroups:function(f,t){g.config=f;g._jimuLayerInfos=t;if(f.editor.presetInfos&&0<Object.keys(f.editor.presetInfos).length&&(f.attributeActionGroups?f.attributeActionGroups&&!f.attributeActionGroups.hasOwnProperty("Preset")&&(f.attributeActionGroups.Preset={}):f.attributeActionGroups=
{Intersection:{},Address:{},Coordinates:{},Preset:{}},!(f.attributeActionGroups&&f.attributeActionGroups.Preset&&0<Object.keys(f.attributeActionGroups.Preset).length)))for(var c in f.editor.presetInfos)g._addPresetGroupForField(f.editor.configInfos||f.editor.layerInfos,c)},_getDomainListForPresetGroup:function(f,t,c){var v=[];A.forEach(t.domain.codedValues,N.hitch(this,function(q){var e={showInList:!0,value:q.code,label:q.name,isDefault:!1};f.showOnlyDomainFields=!0;var d=g.config.editor.presetInfos[c][0];
"esriFieldTypeInteger"===f.dataType&&(d=Number(d));0<g.config.editor.presetInfos[c].length?q.code===d&&(e.isDefault=!0):0===v.length&&(e.isDefault=!0);v.push(e)}));return v},_addPresetGroupForField:function(f,t){var c;A.some(f,N.hitch(this,function(v){if(c)return!0;if(v.fieldValues&&v.fieldValues[t])for(var q=v.fieldValues[t],e=0;e<q.length;e++)if("Preset"===q[e].actionName&&q[e].enabled){q[e].attributeActionGroupName=t;var d=g._jimuLayerInfos.getLayerOrTableInfoById(v.featureLayer.id);if(d&&d.layerObject&&
d.layerObject.fields){e=D.getFieldInfoByFieldName(d.layerObject.fields,t);d=F.getDefaultPortalFieldInfo(e).label+" ("+t+")";q={};q.name=d;0<["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type)?q.dataType="esriFieldTypeInteger":q.dataType=e.type;q.showOnlyDomainFields=!1;q.hideInPresetDisplay=!1;q.appliedOn=g._getPresetFieldsForAppliedOn(e,q);if(e.domain&&"range"!==e.domain.type)q.presetValue=g._getDomainListForPresetGroup(q,
e,t);else if("esriFieldTypeDate"===e.type){var b,a;0<g.config.editor.presetInfos[t].length?(isNaN(g.config.editor.presetInfos[t][0])||""===g.config.editor.presetInfos[t][0]||(a=new Date(g.config.editor.presetInfos[t][0])),g.config.editor.presetInfos[t][1]&&!isNaN(g.config.editor.presetInfos[t][1])&&(b=new Date(g.config.editor.presetInfos[t][1])),b=a&&b?new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds()):a,q.presetValue=b?{dateType:"fixed",
dateTime:b.getTime()}:{dateType:"fixed",dateTime:""}):q.presetValue={dateType:"fixed",dateTime:""}}else q.presetValue=0<g.config.editor.presetInfos[t].length?g.config.editor.presetInfos[t][0]:null;g.config.attributeActionGroups.Preset[q.name]=q;c=!0;break}}!c&&v.relationshipInfos&&0<v.relationshipInfos.length&&(c=g._addPresetGroupForField(v.relationshipInfos,t))}));return c},_isPresetEnabledForLayer:function(f,t,c,v){if(f.fieldValues[t.name])for(var q=f.fieldValues[t.name],e=0;e<q.length;e++)if("Preset"===
q[e].actionName&&q[e].enabled){var d=g._jimuLayerInfos.getLayerOrTableInfoById(f.featureLayer.id).layerObject.fields;D.getFieldInfoByFieldName(d,t.name).type===t.type&&(q[e].attributeActionGroupName=v.name,c.hasOwnProperty(f.featureLayer.id)?c[f.featureLayer.id].push(t.name):c[f.featureLayer.id]=[t.name])}return c},_getPresetFieldsForAppliedOn:function(f,t){var c={};A.forEach(g.config.editor.configInfos||g.config.editor.layerInfos,N.hitch(this,function(v){v.fieldValues&&v.fieldValues[f.name]&&(c=
g._isPresetEnabledForLayer(v,f,c,t));v.relationshipInfos&&0<v.relationshipInfos.length&&A.forEach(v.relationshipInfos,N.hitch(this,function(q){q.fieldValues&&q.fieldValues[f.name]&&(c=g._isPresetEnabledForLayer(q,f,c,t))}))}));return c}};return g})},"widgets/SmartEditor/smartAttributes":function(){define("dojo/Evented dojo dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dojo/on dojo/query dijit/registry jimu/filterUtils jimu/dijit/Filter jimu/BaseWidgetSetting".split(" "),function(N,
A,F,D,g,f,t,c,v,q,e,d){return F([d,N],{_attrInspector:null,_fieldValidation:null,_feature:null,_fieldInfo:null,_gdbRequiredFields:null,_notEditableFields:null,_fieldNameToAlias:null,_fieldsWithRules:null,_attTable:null,_filterUtils:null,_mapLayer:null,OPERATORS:null,constructor:function(){this.inherited(arguments);D.mixin(this,arguments[0]);String.prototype.endsWith||(String.prototype.endsWith=function(a,m){if(void 0===m||m>this.length)m=this.length;return this.substring(m-a.length,m)===a});this.useFieldName=
!1;this._mapLayer=this._feature.getLayer();this._attTable=c("td.atiLabel",this._attrInspector.domNode);if(0<this._attTable.length){var b=this._attTable[0];b&&b.hasAttribute("data-fieldname")&&(this.useFieldName=!0)}this._processLayer();this._filterUtils=new q;this.OPERATORS=D.clone(this._filterUtils.OPERATORS);void 0!==this._attTable&&null!==this._attTable&&this._bindEvents()},_processLayer:function(){this._gdbRequiredFields=[];this._notEditableFields=[];this._fieldsWithRules=[];g.forEach(this._fieldInfo,
function(b){if(!0===this.useFieldName||!1===b.hasOwnProperty("label"))var a=b.fieldName;else a=b.label,0<=a.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')&&(a=a.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',""));!1===b.nullable&&!0===b.isEditable&&this._gdbRequiredFields.push(a);!1!==b.isEditable&&!1!==b.isEditableSettingInWebmap||this._notEditableFields.push(a);this._fieldValidation&&this._fieldValidation.hasOwnProperty(b.fieldName)&&this._fieldsWithRules.push(a)},this)},
toggleFields:function(b){b="undefined"!==typeof b&&null!==b?b:!0;if(void 0!==this._attTable&&null!==this._attTable&&void 0!==this._fieldValidation&&null!==this._fieldValidation&&void 0!==this._feature&&null!==this._feature){var a=null,m=[],l;g.forEach(this._fieldInfo,D.hitch(this,function(n){if(!0===this.useFieldName||!1===n.hasOwnProperty("label"))var k=n.fieldName;else k=n.label,0<=k.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')&&(k=k.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',
""));a=null;l=this.validateField(n.fieldName);a=l[1];if("Required"===a&&"esriFieldTypeDate"===n.type){var x=this._getDijitForField(n.fieldName);x&&1<x.length&&null===x[1].get("value")&&(l[2]=!1)}l[2]&&"esriFieldTypeDate"===n.type&&(x=this._getDijitForField(n.fieldName))&&1<x.length&&null===x[0].get("value")&&(l[2]=!1);!1===l[2]&&m.push({fieldName:n.fieldName});!0===l[0]&&this.toggleFieldOnAttributeInspector(k,a,l[2],b)}));return m}},_getDijitForField:function(b){var a;g.some(this._attrInspector._currentLInfo.fieldInfos,
D.hitch(this,function(m){if(m.fieldName===b)return a=m.dijit,!0}));return a},validateField:function(b){var a=null;if(this._fieldValidation.hasOwnProperty(b)){if(0===this._fieldValidation[b].length)return[!1,null,!0];var m=[!1,null,null];g.some(this._fieldValidation[b],function(l){if(void 0!==l.filter&&null!==l.filter&&(a=l.filter,m=[!0,null,null],this.processFilter(a,this._feature)))return"Required"===l.actionName?!1===this._feature.attributes.hasOwnProperty(b)?(m=[!0,l.actionName,!1],!0):null===
this._feature.attributes[b]||""===this._feature.attributes[b]?(m=[!0,l.actionName,!1],!0):this.myIsNaN(this._feature.attributes[b])?(m=[!0,l.actionName,!1],!0):(m=[!0,l.actionName,!0],!0):(m=[!0,l.actionName,null,l.submitWhenHidden],!0)},this);return m}return[!1,null,null]},_bindEvents:function(){void 0!==this._attTable&&null!==this._attTable&&0<this._attTable.length&&g.forEach(this._attTable,function(b){b=this._getRowInfo(b);-1!==this._fieldsWithRules.indexOf(b[3])&&"dijit.form.FilteringSelect"===
b[2].declaredClass&&t(b[2],"change",D.hitch(this,this._smartComboValidate()))},this)},process_relative_date:function(b,a,m){var l=new Date,n=this._isNumeric(a);if(void 0===b||null===b||""===b)return a;if(b==this.OPERATORS.dateOperatorMinutes&&!0===n)return l.setMinutes(l.getMinutes()-a);if(b==this.OPERATORS.dateOperatorHours&&!0===n)return l.setHours(l.getHours()-a);if(b==this.OPERATORS.dateOperatorDays&&!0===n)return l.setDate(l.getDate()-a);if(b==this.OPERATORS.dateOperatorWeeks&&!0===n)return l.setDate(l.getDate()-
7*a);if(b==this.OPERATORS.dateOperatorMonths&&!0===n)return l.setMonth(l.getMonth()-a);if(b==this.OPERATORS.dateOperatorYears&&!0===n)return l.setFullYear(l.getFullYear()-a);if("today"==b.toLowerCase())return(new Date(l.setDate(l.getDate()))).setHours(23,59,59,999);if("tomorrow"==b.toLowerCase())return(new Date(l.setDate(l.getDate()+1))).setHours(23,59,59,999);if("yesterday"==b.toLowerCase())return(new Date(l.setDate(l.getDate()-1))).setHours(23,59,59,999);if("thisweek"==b.toLowerCase()){var k=(new Date(l.setDate(l.getDate()-
l.getDay()))).setHours(0,0,0,0),x=(new Date(l.setDate(l.getDate()-l.getDay()+6))).setHours(23,59,59,999);return!0===m?k:x}if("thismonth"==b.toLowerCase())return k=(new Date(l.getFullYear(),l.getMonth(),1)).getTime(),x=(new Date(l.getFullYear(),l.getMonth()+1,0)).setHours(23,59,59,999),!0===m?k:x;if("thisquarter"==b.toLowerCase()){b=new Date(l.getTime());var u=b.getFullYear();b.setHours(0,0,0,0);a=(new Date(u,2,31)).setHours(23,59,59,999);n=(new Date(u,5,30)).setHours(23,59,59,999);var B=(new Date(u,
8,30)).setHours(23,59,59,999);u=(new Date(u,11,31)).setHours(23,59,59,999);b<=a&&(k=(new Date(l.getFullYear(),0,1)).getTime(),x=n);b<=n&&(k=a,x=n);b<=B&&(k=n,x=B);b<=u&&(k=B,x=u);return!0===m?k:x}return"thisyear"==b.toLowerCase()?(x=(new Date(l.getFullYear(),11,31)).setHours(23,59,59,999),k=(new Date(l.getFullYear(),0,1)).getTime(),!0===m?k:x):a},process_part:function(b){var a=null,m=null,l=null,n=null,k=null,x=null;b.valueObj.hasOwnProperty("value")&&(a=void 0===b.valueObj.virtualDate||null===b.valueObj.virtualDate?
null:b.valueObj.virtualDate,k=void 0===b.valueObj.range||null===b.valueObj.range?null:b.valueObj.range,m=b.valueObj.value);b.valueObj.hasOwnProperty("value1")&&(a=void 0===b.valueObj.virtualDate1||null===b.valueObj.virtualDate1?null:b.valueObj.virtualDate1,null===a&&(a=void 0===b.valueObj.virtualDate||null===b.valueObj.virtualDate?null:b.valueObj.virtualDate),k=void 0===b.valueObj.range1||null===b.valueObj.range1?null:b.valueObj.range1,m=b.valueObj.value1);b.valueObj.hasOwnProperty("value2")&&(l=
void 0===b.valueObj.virtualDate2||null===b.valueObj.virtualDate2?null:b.valueObj.virtualDate2,null===l&&(l=void 0===b.valueObj.virtualDate||null===b.valueObj.virtualDate?null:b.valueObj.virtualDate),x=void 0===b.valueObj.range2||null===b.valueObj.range2?null:b.valueObj.range2,n=b.valueObj.value2);"esriFieldTypeDate"==b.fieldObj.type&&(b.operator==this.OPERATORS.dateOperatorInTheLast?(null!==k&&(m=this.process_relative_date(k,m)),null!==x&&(n=this.process_relative_date(x,n))):b.operator==this.OPERATORS.dateOperatorNotInTheLast?
(null!==k&&(m=this.process_relative_date(k,m)),null!==x&&(n=this.process_relative_date(x,n))):b.operator==this.OPERATORS.dateOperatorIsIn?(m=this.process_relative_date(a,m,!0),n=this.process_relative_date(l,n,!1)):b.operator==this.OPERATORS.dateOperatorIsNotIn?(m=this.process_relative_date(a,m,!0),n=this.process_relative_date(l,n,!1)):(null!==a&&(m=this.process_relative_date(a,m,!1)),null!==l&&(n=this.process_relative_date(l,n,!1))));return[m,n]},processFilter:function(b){var a=[];g.forEach(b.parts,
function(m){if(m.hasOwnProperty("parts"))a.push(this.processFilter(m,this._feature));else{var l=this.process_part(m),n=l[0];l=l[1];switch(m.valueObj.type){case "value":a.push(this.validatePart(m.operator,this._feature.attributes[m.fieldObj.name],n,l,m.caseSensitive));break;case "unique":a.push(this.validatePart(m.operator,this._feature.attributes[m.fieldObj.name],n,l,m.caseSensitive));break;case "field":this._feature.attributes.hasOwnProperty(n)&&(n=this._feature.attributes[n]),a.push(this.validatePart(m.operator,
this._feature.attributes[m.fieldObj.name],n,l,m.caseSensitive))}}},this);return this.ruleValid(a,b.logicalOperator)},ruleValid:function(b,a){var m=!1;if(void 0===a||null===a)a="OR";g.some(b,function(l){if("OR"===a){if(!0===l)return m=!0;m=!1}else{if(!1===l)return m=!1,!0;m=!0}});return m},myIsNaN:function(b){return b!==b},_isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},validatePart:function(b,a,m,l,n){var k=null;if(void 0===b||null===b)return!1;0===b.lastIndexOf("string",0)?!1===
n&&(void 0!==a&&null!==a&&(a=String(a).toUpperCase()),void 0!==m&&null!==m&&(m=String(m).toUpperCase()),void 0!==l&&null!==l&&(l=String(l).toUpperCase())):0===b.lastIndexOf("date",0)&&(void 0!==m&&null!==m&&(m=new Date(m)),void 0!==l&&null!==l&&(l=new Date(l)));switch(b){case this.OPERATORS.stringOperatorIs:if(a===m)return!0;break;case this.OPERATORS.stringOperatorIsNot:if(a!==m)return!0;break;case this.OPERATORS.stringOperatorStartsWith:if(null===a&&null===m)return!0;if(null===a&&null!==m)break;
if(null!==a&&null===m)break;if(0===a.lastIndexOf(m,0))return!0;break;case this.OPERATORS.stringOperatorEndsWith:if(null===a&&null===m)return!0;if(null===a&&null!==m)break;if(null!==a&&null===m)break;return a.endsWith(m);case this.OPERATORS.stringOperatorContains:if(null===a&&null===m)return!0;if(null===a&&null!==m)break;if(null!==a&&null===m)break;if(0<=String(a).toUpperCase().indexOf(m.toUpperCase()))return!0;break;case this.OPERATORS.stringOperatorDoesNotContain:if(null===a&&null===m)break;if(null===
a&&null!==m||null!==a&&null===m||!(0<=String(a).toUpperCase().indexOf(m.toUpperCase())))return!0;break;case this.OPERATORS.stringOperatorIsBlank:return void 0===a||null===a||""===a;case this.OPERATORS.stringOperatorIsNotBlank:return void 0!==a&&null!==a&&""!==a;case this.OPERATORS.numberOperatorIs:if(this._isNumeric(a))return String(a)===String(m);break;case this.OPERATORS.numberOperatorIsNot:if(this._isNumeric(a))return String(a)!==String(m);break;case this.OPERATORS.numberOperatorIsAtLeast:if(this._isNumeric(a)&&
this._isNumeric(m))return Number(a)>=Number(m);break;case this.OPERATORS.numberOperatorIsLessThan:if(this._isNumeric(a)&&this._isNumeric(m))return Number(a)<Number(m);break;case this.OPERATORS.numberOperatorIsAtMost:if(this._isNumeric(a)&&this._isNumeric(m))return Number(a)<=Number(m);break;case this.OPERATORS.numberOperatorIsGreaterThan:if(this._isNumeric(a)&&this._isNumeric(m))return Number(a)>Number(m);break;case this.OPERATORS.numberOperatorIsBetween:if(this._isNumeric(a)&&this._isNumeric(m)&&
this._isNumeric(l))return Number(a)>Number(m)&&Number(a)<Number(l);break;case this.OPERATORS.numberOperatorIsNotBetween:if(this._isNumeric(a)&&this._isNumeric(m)&&this._isNumeric(l))return Number(a)<=Number(m)||Number(a)>=Number(l);break;case this.OPERATORS.numberOperatorIsBlank:if(null===a||void 0===a||!1===this._isNumeric(a))return!0;break;case this.OPERATORS.numberOperatorIsNotBlank:if(null!==a&&void 0!==a&&!0===this._isNumeric(a))return!0;break;case this.OPERATORS.dateOperatorIsOn:if(void 0===
a||null===a)break;if(void 0===m||null===m)break;k=new Date(a);return m.toDateString()===k.toDateString();case this.OPERATORS.dateOperatorIsNotOn:if(void 0===a||null===a)break;if(void 0===m||null===m)break;k=new Date(a);return m.toDateString()!==k.toDateString();case this.OPERATORS.dateOperatorIsBefore:if(null===a||void 0===a)break;if(void 0===m||null===m)break;return a<m.getTime();case this.OPERATORS.dateOperatorIsAfter:if(null===a||void 0===a)break;if(void 0===m||null===m)break;return a>m.getTime();
case this.OPERATORS.dateOperatorIsOnOrBefore:if(null===a||void 0===a)break;if(void 0===m||null===m)break;return a<=m.getTime();case this.OPERATORS.dateOperatorIsOnOrAfter:if(null===a||void 0===a)break;if(void 0===m||null===m)break;return a>=m.getTime();case this.OPERATORS.dateOperatorInTheLast:if(null===a||void 0===a)break;if(void 0===m||null===m)break;return a>m.getTime()&&a<=(new Date).getTime();case this.OPERATORS.dateOperatorNotInTheLast:if(null===a||void 0===a)break;if(void 0===m||null===m)break;
return a<=m.getTime()||a>=(new Date).getTime();case this.OPERATORS.dateOperatorIsIn:if(null===a||void 0===a)break;if(void 0===m||null===m)break;if(void 0===l||null===l)break;return a>=m.getTime()&&a<=l.getTime();case this.OPERATORS.dateOperatorIsNotIn:if(null===a||void 0===a)break;if(void 0===m||null===m)break;if(void 0===l||null===l)break;return a<m.getTime()||a>l.getTime();case this.OPERATORS.dateOperatorIsBetween:if(null===a||void 0===a)break;if(void 0===m||null===m)break;if(void 0===l||null===
l)break;return a>=m.getTime()&&a<=l.getTime();case this.OPERATORS.dateOperatorIsNotBetween:if(null===a||void 0===a)break;if(void 0===m||null===m)break;if(void 0===l||null===l)break;return a<m.getTime()||a>l.getTime();case this.OPERATORS.dateOperatorIsBlank:if(null===a||void 0===a)return!0;break;case this.OPERATORS.dateOperatorIsNotBlank:if(null!==a&&void 0!==a)return!0}return!1},_processChildNodes:function(b,a){b.disabled=a;!0===a?b.style&&(b.style.pointerEvents="none"):b.style&&(b.style.pointerEvents=
"auto");g.forEach(b.childNodes,function(m){m.disabled=a;!0===a?m.style&&(m.style.pointerEvents="none"):m.style&&(m.style.pointerEvents="auto");0<m.childNodes.length&&this._processChildNodes(m,a)},this)},_smartComboValidate:function(){this.toggleFields()},_getRowInfo:function(b){var a=b.parentNode.childNodes[1].childNodes[0],m=null,l=null;1<b.parentNode.childNodes[1].childNodes.length&&(m=b.parentNode.childNodes[1].childNodes[1],f.contains(m,"esriCTValuePickerButton")&&(l=b.parentNode.childNodes[1].childNodes[1],
m=null),3===b.parentNode.childNodes[1].childNodes.length&&(l=b.parentNode.childNodes[1].childNodes[2]));var n=!0===this.useFieldName?b.hasAttribute("data-fieldname")?b.getAttribute("data-fieldname"):b.childNodes[0].data:b.childNodes[0].data;b=b.parentNode;var k=v.getEnclosingWidget(a);return[a,b,k,n,m,l]},_removeRequireFieldMarkings:function(b,a,m){var l=null;void 0===m||null===m?(f.contains(b,"dijitComboBoxError")&&f.remove(b,"dijitComboBoxError"),f.contains(b,"dijitTextBoxError")&&f.remove(b,"dijitTextBoxError"),
f.contains(b,"dijitValidationTextBox")&&f.remove(b,"dijitValidationTextBox"),f.contains(b,"dijitValidationTextBoxError")&&f.remove(b,"dijitValidationTextBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError"),l=c(".dijitValidationContainer",a),g.forEach(l,function(n){n.parentNode.removeChild(n)})):(l=D.isFunction(m.isValid)?m.isValid():!0,"dijit.form.TextBox"===m.declaredClass&&!0===l?(f.contains(b,"dijitTextBoxError")&&f.remove(b,"dijitTextBoxError"),f.contains(b,"dijitValidationTextBox")&&
f.remove(b,"dijitValidationTextBox"),f.contains(b,"dijitValidationTextBoxError")&&f.remove(b,"dijitValidationTextBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError"),l=c(".dijitValidationContainer",a),g.forEach(l,function(n){n.parentNode.removeChild(n)})):"dijit.form.ValidationTextBox"===m.declaredClass&&!0===l?(f.contains(b,"dijitTextBoxError")&&f.remove(b,"dijitTextBoxError"),f.contains(b,"dijitTextBoxDisabled")&&f.remove(b,"dijitTextBoxDisabled"),f.contains(b,"dijitValidationTextBoxError")&&
f.remove(b,"dijitValidationTextBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError")):"dijit.form.DateTextBox"===m.declaredClass&&!0===l?(f.contains(b,"dijitTextBoxError")&&f.remove(b,"dijitTextBoxError"),f.contains(b,"dijitValidationTextBox")&&f.remove(b,"dijitValidationTextBox"),f.contains(b,"dijitValidationTextBoxError")&&f.remove(b,"dijitValidationTextBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError"),l=c(".dijitValidationContainer",a),g.forEach(l,function(n){n.parentNode.removeChild(n)})):
"dijit.form.TimeTextBox"===m.declaredClass&&!0===l?(f.contains(b,"dijitTextBoxError")&&f.remove(b,"dijitTextBoxError"),f.contains(b,"dijitValidationTextBox")&&f.remove(b,"dijitValidationTextBox"),f.contains(b,"dijitValidationTextBoxError")&&f.remove(b,"dijitValidationTextBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError"),l=c(".dijitValidationContainer",a),g.forEach(l,function(n){n.parentNode.removeChild(n)})):"dijit.form.FilteringSelect"===m.declaredClass&&!0===l?(f.contains(b,"dijitTextBoxError")&&
f.remove(b,"dijitTextBoxError"),f.contains(b,"dijitComboBoxError")&&f.remove(b,"dijitComboBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError"),f.contains(b,"dijitValidationTextBoxError")&&f.remove(b,"dijitValidationTextBoxError")):!0===l&&(f.contains(b,"dijitComboBoxError")&&f.remove(b,"dijitComboBoxError"),f.contains(b,"dijitTextBoxError")&&f.remove(b,"dijitTextBoxError"),f.contains(b,"dijitValidationTextBox")&&f.remove(b,"dijitValidationTextBox"),f.contains(b,"dijitValidationTextBoxError")&&
f.remove(b,"dijitValidationTextBoxError"),f.contains(b,"dijitError")&&f.remove(b,"dijitError"),l=c(".dijitValidationContainer",a),g.forEach(l,function(n){n.parentNode.removeChild(n)})))},_removeRedAst:function(b,a){-1===this._gdbRequiredFields.indexOf(a)&&(b=c("a.asteriskIndicator",b),0<b.length&&g.forEach(b,function(m){m.parentNode.removeChild(m)}))},_removeHideRule:function(b){f.contains(b,"hideField")&&f.remove(b,"hideField")},_removeDisableRule:function(b,a){-1===this._notEditableFields.indexOf(b)&&
(f.contains(a,"dijitTextBoxDisabled")&&f.remove(a,"dijitTextBoxDisabled"),f.contains(a,"dijitComboBoxDisabled")&&f.remove(a,"dijitComboBoxDisabled"),f.contains(a,"dijitValidationTextBoxDisabled")&&f.remove(a,"dijitValidationTextBoxDisabled"),f.contains(a,"dijitDisabled")&&f.remove(a,"dijitDisabled"));this._processChildNodes(a,!1)},_remove:function(b,a,m,l,n){this._removeRequireFieldMarkings(m,l,n);this._removeRedAst(b[0],a);this._removeDisableRule(a,m);this._removeHideRule(l)},toggleFieldOnAttributeInspector:function(b,
a,m,l){l="undefined"!==typeof l&&null!==l?l:!0;if(void 0===this._gdbRequiredFields||null===this._gdbRequiredFields)this._gdbRequiredFields=[];if(void 0===this._notEditableFields||null===this._notEditableFields)this._notEditableFields=[];if(void 0!==this._attTable&&null!==this._attTable){if(0<this._attTable.length){var n=A.filter(this._attTable,D.hitch(this,function(r){return r.childNodes&&0<r.childNodes.length?!0===this.useFieldName?r.hasAttribute("data-fieldname")?r.getAttribute("data-fieldname")===
b:r.childNodes[0].data===b:r.childNodes[0].data===b:!1})),k=null;if(null!==n&&0<n.length){var x=this._getRowInfo(n[0]),u=x[0];k=x[4];var B=x[5],h=x[1];x=x[2];if(void 0!==x&&null!==x)switch(a){case "Hide":this._removeRequireFieldMarkings(u,h,x);this._removeRedAst(n[0],b);this._removeDisableRule(b,u);k&&this._removeDisableRule(b,k);B&&f.remove(B,"disabled");f.add(h,"hideField");break;case "Disabled":this._removeRedAst(n[0],b);this._removeHideRule(h);this._removeRequireFieldMarkings(u,h,x);f.add(u,["dijitValidationTextBox",
"dijitTextBoxDisabled","dijitComboBoxDisabled","dijitValidationTextBoxDisabled","dijitDisabled"]);this._processChildNodes(u,!0);null!==k&&(this._removeRequireFieldMarkings(k,h,x),f.add(k,["dijitValidationTextBox","dijitTextBoxDisabled","dijitComboBoxDisabled","dijitValidationTextBoxDisabled","dijitDisabled"]),this._processChildNodes(k,!0));B&&f.add(B,"disabled");break;case "Required":this._removeDisableRule(b,u);k&&this._removeDisableRule(b,k);B&&f.remove(B,"disabled");this._removeHideRule(h);!0===
m?(this._removeRequireFieldMarkings(u,h,x),k&&f.contains(k,"dijitTextBoxError","dijitError")&&f.remove(k,"dijitTextBoxError","dijitError")):"dijit.form.TextBox"===x.declaredClass?(k=c(".dijitValidationContainer",h),0===k.length&&(a=document.createElement("div"),a.setAttribute("class","dijitReset dijitValidationContainer"),m=document.createElement("input"),m.setAttribute("class","dijitReset dijitInputField dijitValidationIcon dijitValidationInner"),m.setAttribute("value","x"),m.setAttribute("type",
"text"),m.setAttribute("tabindex","-1"),m.setAttribute("readonly","readonly"),m.setAttribute("role","presentation"),a.appendChild(m),u.insertBefore(a,u.childNodes[0])),f.add(u,["dijitTextBoxError","dijitValidationTextBox","dijitValidationTextBoxError","dijitError"])):"dijit.form.ValidationTextBox"===x.declaredClass?(k=c(".dijitValidationContainer",h),f.add(u,["dijitTextBoxError","dijitValidationTextBox","dijitValidationTextBoxError","dijitError"])):"dijit.form.FilteringSelect"===x.declaredClass?f.add(u,
["dijitTextBoxError","dijitComboBoxError","dijitError","dijitValidationTextBoxError"]):x.get("value")?(f.remove(u,"dijitTextBoxError","dijitError"),k&&f.add(k,["dijitTextBoxError","dijitError"])):f.add(u,["dijitTextBoxError","dijitError"]);u=c("a.asteriskIndicator",n[0]);a=c("span.atiRequiredField",n[0]);-1===this._gdbRequiredFields.indexOf(b)&&0===u.length&&0===a.length&&(u=document.createElement("a"),u.setAttribute("class","asteriskIndicator"),u.innerHTML=" *",n[0].appendChild(u));break;case "Value":break;
default:l&&(this._remove(n,b,u,h,x),B&&f.remove(B,"disabled"),k&&this._removeDisableRule(b,k))}}}this.emit("onFieldToggle")}}})})},"widgets/SmartEditor/attributeInspectorTools":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/query dojo/on dojo/dom-class dojo/topic dijit/registry jimu/BaseWidgetSetting".split(" "),function(N,A,F,D,g,f,t,c,v){return N([v],{_attrInspector:null,_feature:null,_fieldInfo:null,_guidFields:null,_guidFieldNames:null,_intFieldNames:null,_dblFieldNames:null,
_dateFieldNames:null,_stringFields:null,_requiredNonDomainIntFields:null,_requiredNonDomainDecFields:null,_fieldNameToAlias:null,_attTable:null,_mapLayer:null,constructor:function(){this.inherited(arguments);A.mixin(this,arguments[0]);this._mapLayer=this._feature.getLayer();this._processLayer();this._fieldInfo=F.filter(this._fieldInfo,function(q){return q.label?!0:!1});this._attTable=D("td.atiLabel",this._attrInspector.domNode);void 0!==this._attTable&&null!==this._attTable&&this._addValidation()},
_checkFeatureData:function(q){F.forEach(this._fieldInfo,function(e){if(q.hasOwnProperty(e.fieldName))switch(e.type){case "esriFieldTypeString":0<e.length&&null!==q[e.fieldName]&&q[e.fieldName].length>e.length&&(q[e.fieldName]=q[e.fieldName].substring(0,e.length));break;case "esriFieldTypeGUID":this._isGuid(q[e.fieldName],!1)&&("{"!==q[e.fieldName][0]&&(q[e.fieldName]="{"+q[e.fieldName]),"}"!==q[e.fieldName][q[e.fieldName].length-1]&&(q[e.fieldName]+="}"));break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":this.isNumeric(q[e.fieldName])&&
(q[e.fieldName]=parseFloat(q[e.fieldName]));break;case "esriFieldTypeDate":this.isNumeric(q[e.fieldName])&&(q[e.fieldName]=parseInt(q[e.fieldName],10));break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":this.isNumeric(q[e.fieldName])&&(q[e.fieldName]=parseInt(q[e.fieldName],10))}},this);return q},_processLayer:function(){this._guidFields=[];this._guidFieldNames=[];this._dateFieldNames=[];this._intFieldNames=[];this._dblFieldNames=[];this._stringFields=[];this._requiredNonDomainIntFields=
[];this._requiredNonDomainDecFields=[];F.forEach(this._fieldInfo,function(q){if(q.hasOwnProperty("label")&&q.hasOwnProperty("type")){var e=q.label;0<=e.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')&&(e=e.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',""));switch(q.type){case "esriFieldTypeString":this._stringFields.push(q.fieldName);break;case "esriFieldTypeGUID":this._guidFields.push(e);this._guidFieldNames.push(q.fieldName);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":!1!==
q.nullable||void 0!==q.domain&&null!==q.domain||this._requiredNonDomainDecFields.push(e);this._dblFieldNames.push(q.fieldName);break;case "esriFieldTypeDate":this._dateFieldNames.push(q.fieldName);break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":!1!==q.nullable||void 0!==q.domain&&null!==q.domain||this._requiredNonDomainIntFields.push(e),this._intFieldNames.push(q.fieldName)}}},this)},formValid:function(){var q=!0;if(void 0===this._attTable||null===this._attTable)return q;0<this._attTable.length&&
F.some(this._attTable,function(e){if(e=this._getRowInfo(e)){if(void 0===e[0]||null===e[0])return!1;q=A.isFunction(e[0].isValid)?e[0].isValid():!f.contains(e[2],"dijitError");return!q}return!0},this);return q},triggerFormValidation:function(){if(void 0!==this._attTable&&null!==this._attTable&&0<this._attTable.length){var q=null;F.forEach(this._attTable,function(e){if((e=this._getRowInfo(e))&&void 0!==e[0]&&null!==e[0]){null===q&&(q=e[0]);var d=!0;A.isFunction(e[0].isValid)?d=e[0].isValid():g.emit(e[0],
"change",{bubbles:!0,cancelable:!0});!1===d&&e[0].set("state","Error")}},this)}},_addValidation:function(){void 0!==this._attTable&&null!==this._attTable&&(0!==this._guidFields.length||0!==this._requiredNonDomainIntFields.length||0!==this._requiredNonDomainDecFields.length)&&0<this._attTable.length&&F.forEach(this._attTable,function(q){var e=this._getRowInfo(q);e&&(-1!==this._guidFields.indexOf(e[1])?"dijit.form.ValidationTextBox"===e[0].declaredClass?e[0].validator=A.hitch(this,this._validateGUID):
"dijit.form.TextBox"===e[0].declaredClass&&(e[0].isValid=A.hitch(this,this._validateGUID_IsValid(e[0])),g(e[0],"change",A.hitch(this,function(){!1===this._isGuid(e[0].get("value"),!0)?f.add(e[2],["dijitTextBoxError","dijitValidationTextBox","dijitValidationTextBoxError","dijitError"]):(f.contains(e[2],"dijitTextBoxError")&&f.remove(e[2],"dijitTextBoxError"),f.contains(e[2],"dijitValidationTextBox")&&f.remove(e[2],"dijitValidationTextBox"),f.contains(e[2],"dijitValidationTextBoxError")&&f.remove(e[2],
"dijitValidationTextBoxError"),f.contains(e[2],"dijitError")&&f.remove(e[2],"dijitError"));t.publish("smartEditor/validate",null)})),e[0].validator=A.hitch(this,this._validateGUID)):-1===this._requiredNonDomainIntFields.indexOf(e[1])&&this._requiredNonDomainDecFields.indexOf(e[1]))},this)},_isGuid:function(q,e){if(!0===e&&(""===q||null===q))return!0;if(""===q||null===q)return!1;"{"===q[0]&&(q=q.substring(1,q.length-1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(q)},
_validateGUID_IsValid:function(q){return function(){return this._isGuid(q.get("value"),!0)}},_validateGUID:function(q,e){return this._isGuid(q,!0)},isNumeric:function(q){return!isNaN(parseFloat(q))&&isFinite(q)},isInt:function(q){var e;if(e=!isNaN(q))q=parseFloat(q),e=(q|0)===q;return e},_validateInt:function(q,e){return this.isInt(q)},_validateDec:function(q,e){return this.isNumeric(q)},_getRowInfo:function(q){try{if(q&&q.parentNode){var e=q.parentNode.childNodes[1].childNodes[0];return[c.getEnclosingWidget(e),
q.childNodes[0].data,e]}return null}catch(d){return console.log(d),null}}})})},"widgets/SmartEditor/relatedTables":function(){define("dojo/_base/declare dojo/Evented dojo/on dojo/string dojo/keys dojo/string dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/_base/array dojo/dom-construct esri/graphic jimu/dijit/Message dijit/_WidgetBase ./presetUtils dojo/query esri/tasks/RelationshipQuery dojo/dom-geometry dojo/dom-class".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x){return N([a,A],
{newRelatedFeature:{},_validRelations:[],isSaveEnable:!1,postCreate:function(){this._validRelations=[]},startup:function(){this._createTable()},_createTable:function(){var u=e.create("div",{"class":"relatedTablesContainer"},this.domNode);q.forEach(this.relationshipInfo,v.hitch(this,function(B,h){B.featureLayer&&B.hasOwnProperty("relationshipId")&&this._createRelatedTableItem(B,u,h)}));0<l(".relatedTableTitleContainer",this.domNode).length?this.emit("addRelatedItemContent",!0):this.emit("addRelatedItemContent",
!1)},_getKeyField:function(u){var B;var h=u;u=u.toLowerCase();for(B in this.parentFeature.attributes)if(u===B.toLowerCase()){h=B;break}return h},_createRelatedTableItem:function(u,B,h){var r,w={};if(r=this.layerInfosObj.getLayerOrTableInfoById(u.featureLayer.id)){var G=e.create("div",{"class":"relatedTableTitleContainer"},B);t.set(G,"layerId",r.id);t.set(G,"relationshipId",u.relationshipId);t.set(G,"parentFeatureOID",this.parentFeature.attributes[this.parentFeature._layer.objectIdField]);F(G,"click",
v.hitch(this,function(y){y=t.get(y.currentTarget,"relatedRecordCount");(null===y||y&&0!==parseInt(y,10))&&this.emit("titleClicked",r.id,u.relationshipId,!1,this.parentFeatureIndexInAI,this.parentFeature.attributes[this.parentFeature._layer.objectIdField],this.newRelatedFeature[u.relationshipId].foreignKeyField)}));B=e.create("div",{"class":"relatedTableTitle esriCTEllipsis relatedTableFields",innerHTML:r.title,tabindex:"-1",title:r.title,"aria-label":r.title,role:"button"},G);F(B,"keydown",v.hitch(this,
function(y){y.keyCode!==g.ENTER&&y.keyCode!==g.SPACE||G.click()}));e.create("div",{"class":"esriCTLoadingIcon hidden"},G);e.create("div",{"class":"esriCTRelatedTableRecordsCount"},G);w=this._checkRelationShip(r,u.relationshipId);w.isValidRelation?(this._createNewGraphics(u.relationshipId,r.id,w.primaryKeyField,w.foreignKeyField),this._validRelations.push(u)):e.destroy(G);this._canAddFeatures(u,r)&&"Table"===r.layerObject.type?(B=D.substitute(this.nls.createNewFeatureLabel,{layerTitle:r.title}),B=
e.create("div",{"class":"relatedTableIcons itemTitleCreateNew relatedTableFields",title:this.nls.addNewFeature,"aria-label":B,role:"button",tabindex:"-1"},G),t.set(B,"tableId",r.id),F(B,"click",v.hitch(this,function(y){this._createNewButtonClick(y,u,r,G)})),F(B,"keydown",v.hitch(this,function(y){y.keyCode!==g.ENTER&&y.keyCode!==g.SPACE||this._createNewButtonClick(y,u,r,G)})),this.relationshipInfo.length-1===h&&x.add(B,"esriCTLastRelatedItem")):this.relationshipInfo.length-1===h&&x.add(B,"esriCTLastRelatedItem");
w.isValidRelation&&this.getRelatedRecordsCount(u.relationshipId,r.id)}},_createNewButtonClick:function(u,B,h,r){u.stopPropagation();u=this.newRelatedFeature[B.relationshipId];this.isSaveEnable?b({message:this.nls.pendingFeatureSaveMsg}):(this.parentFeature.attributes.hasOwnProperty(u.primaryKeyField)||(u.primaryKeyField=this._getKeyField(u.primaryKeyField)),void 0===this.parentFeature.attributes[u.primaryKeyField]||null===this.parentFeature.attributes[u.primaryKeyField]?(B=m.getFieldInfoByFieldName(this.parentFieldInfos,
u.primaryKeyField).label||u.primaryKeyField,B=f.substitute(this.nls.invalidRelationShipMsg,{parentKeyField:B}),b({message:B})):(this.newRelatedFeature[B.relationshipId].attributes[this.newRelatedFeature[B.relationshipId].foreignKeyField]=this.parentFeature.attributes[this.newRelatedFeature[B.relationshipId].primaryKeyField],this.emit("addRelatedRecord",this.newRelatedFeature[B.relationshipId],r,h.id,this.parentFeatureIndexInAI,this.newRelatedFeature[B.relationshipId].foreignKeyField)))},_canAddFeatures:function(u,
B){B=B.layerObject.getEditCapabilities();return!u.allowUpdateOnly&&u._editFlag&&B.canCreate?!0:!1},_checkRelationShip:function(u,B){var h=!0;var r=this._getRelationShipById(this.parentFeature._layer,B);u=this._getRelationShipById(u.layerObject,B);if(r&&r.keyField&&u&&u.keyField){var w=r.keyField;var G=u.keyField}else h=!1;return{isValidRelation:h,foreignKeyField:G,primaryKeyField:w}},_createNewGraphics:function(u,B,h,r){var w={};B=this.layerInfosObj.getLayerOrTableInfoById(B);0<B.layerObject.templates.length?
w=B.layerObject.templates[0].prototype.attributes:0<B.layerObject.types.length&&(w=B.layerObject.types[0].templates[0].prototype.attributes);w=new d(null,null,v.clone(w));w.attributes.hasOwnProperty(r)&&(w.attributes[r]=this.parentFeature.attributes[h]);this.newRelatedFeature[u]=w;this.newRelatedFeature[u].primaryKeyField=h;this.newRelatedFeature[u].foreignKeyField=r;this.newRelatedFeature[u].featureLayer=B;return!0},_getRelationShipById:function(u,B){var h;q.some(u.relationships,v.hitch(this,function(r){if(r.id===
B)return h=r,!0}));return h},updateFeatureInstance:function(u){this.parentFeature&&(this.parentFeature.attributes=v.clone(u))},displayRelatedRecordCount:function(u,B){B=l("[relationshipid \x3d "+B+"]",this.domNode);var h=l(".relatedTableIcons.itemTitleCreateNew",this.domNode);var r=l(".esriCTLoadingIcon",B[0])[0];x.add(r,"hidden");var w=l(".esriCTRelatedTableRecordsCount",B[0])[0];x.remove(w,"hidden");r=l(".relatedTableTitle",B[0])[0];t.set(w,"innerHTML","("+u+")");var G=D.substitute(this.nls.relatedFeatureCount,
{layerTitle:r.innerHTML,featureCount:u});t.set(r,"aria-label",G);t.set(B[0],"relatedRecordCount",u);w=k.position(w).w;if("auto"===w||void 0===w||""===w||0===w)w=8+7*u.toString().length;w=0<h.length?w+35:w+10;c.set(r,"width","calc(100% - "+w+"px)");0===u?x.add(B[0],"esriCTRelatedTableTitleDefaultCursor"):x.remove(B[0],"esriCTRelatedTableTitleDefaultCursor")},updateRelatedRecordsCount:function(){q.forEach(this._validRelations,v.hitch(this,function(u){this.getRelatedRecordsCount(u.relationshipId,u.featureLayer.id)}))},
_showLoadingIndicator:function(u){var B=l("[relationshipid \x3d "+u+"]",this.domNode);u=l(".relatedTableIcons.itemTitleCreateNew",this.domNode);var h=l(".esriCTLoadingIcon",B[0])[0];var r=l(".esriCTRelatedTableRecordsCount",B[0])[0];B=l(".relatedTableTitle",B[0])[0];x.remove(h,"hidden");x.add(r,"hidden");r=20;r=0<u.length?r+35:r+10;c.set(B,"width","calc(100% - "+r+"px)")},getRelatedRecordsCount:function(u,B){var h=this.parentFeature._layer;var r=this.parentFeature.attributes[this.parentFeature._layer.objectIdField];
var w=new n;B=this.layerInfosObj.getLayerOrTableInfoById(B).layerObject.objectIdField;w.returnGeometry=!1;w.outSpatialReference=this.mapSpatialReference;w.relationshipId=u;w.objectIds=[r];w.outFields=[B];this._showLoadingIndicator(u);h.queryRelatedFeatures(w,v.hitch(this,function(G){(G=G[r]&&G[r].features)?this.displayRelatedRecordCount(G.length,u):this.displayRelatedRecordCount(0,u)}),v.hitch(this,function(){this.displayRelatedRecordCount(0,u)}))}})})},"widgets/SmartEditor/AttachmentUploader":function(){define("dojo/Evented dojo dojo/_base/declare dojo/_base/lang dojo/on dojo/keys dojo/dom-construct dojo/dom-style dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./AttachmentUploader.html dojo/i18n!esri/nls/jsapi".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d){return F([v,N,q],{declaredClass:"jimu-widget-smartEditor-attachmentuploader",templateString:e,widgetsInTemplate:!0,_inputCount:0,_inputIndex:1,currentAction:null,constructor:function(){this.nls=D.mixin(this.nls,d.widgets.attachmentEditor)},_fileSelected:function(b){b=b.target||b.srcElement;0<b.value.length&&(A.style(b.parentNode.childNodes[0],"display","inline-block"),this._addInput(),"block"===c.get(this.attachmentsRequiredMsg,"display")&&c.set(this.attachmentsRequiredMsg,
"display","none"));this.emit("attachmentAdded")},clear:function(){if(void 0!==this._attachmentList&&null!==this._attachmentList){for(;this._attachmentList.firstChild;)this._attachmentList.removeChild(this._attachmentList.firstChild);this._addInput()}},_deleteAttachment:function(b){b=b.target||b.srcElement;b.parentNode.parentNode.removeChild(b.parentNode);this._hasAddedAnyAttachments()||"Required"!==this.currentAction||"none"===c.get(this.attachmentsRequiredMsg,"display")&&c.set(this.attachmentsRequiredMsg,
"display","block");this.emit("attachmentDeleted")},_reflect:function(b){return b.then(function(a){return{state:"fulfilled",value:a}},function(a){return{state:"rejected",error:a}})},_addInput:function(){for(var b=0;b<this._attachmentList.childNodes.length;b++)if(this._attachmentList.childNodes[b].childNodes[this._inputIndex].value){if(0===this._attachmentList.childNodes[b].childNodes[this._inputIndex].value.length)return}else return;b=t.create("div",{id:"delInput"+String(this._inputCount),"class":"deleteAttachment",
tabindex:"0","aria-label":this.nls.deleteAttachment||this.deleteAttachmentText||"",role:"button"});b.innerHTML="X";A.style(b,"display","none");this.own(g(b,"click",D.hitch(this,this._deleteAttachment)));this.own(g(b,"keydown",D.hitch(this,function(l){l.keyCode!==f.ENTER&&l.keyCode!==f.SPACE||this._deleteAttachment(l)})));var a=t.create("form",{id:"formInput"+String(this._inputCount)}),m=t.create("input",{id:"fileInput"+String(this._inputCount),type:"file","class":"attInput",name:"attachment"});a.appendChild(b);
a.appendChild(m);this._attachmentList.appendChild(a);this.own(g(m,"change",D.hitch(this,this._fileSelected)));this._inputCount+=1},startup:function(){this._addInput()},destroy:function(){this.inherited(arguments)},postAttachments:function(b,a){if(b&&"esri.layers.FeatureLayer"===b.declaredClass&&b.getEditCapabilities&&b.addAttachment){for(var m=[],l=0;l<this._attachmentList.childNodes.length;l++)0<this._attachmentList.childNodes[l].childNodes[this._inputIndex].value.length&&m.push(b.addAttachment(a,
this._attachmentList.childNodes[l]));return 0===m.length?null:m.map(this._reflect)}},_hasAddedAnyAttachments:function(){for(var b=!1,a=0;a<this._attachmentList.childNodes.length;a++)if(this._attachmentList.childNodes[a].childNodes[this._inputIndex].value&&0<this._attachmentList.childNodes[a].childNodes[this._inputIndex].value.length){b=!0;break}return b}})})},"jimu/dijit/EditorXssFilter":function(){define("dojo/_base/declare dojo/_base/array dijit/_WidgetBase dojo/_base/lang dojo/Evented libs/arcgis-html-sanitizer/arcgis-html-sanitizer".split(" "),
function(N,A,F,D,g,f){var t=null,c=N([F,g],{baseClass:"jimu-editor-xss-filter",declaredClass:"jimu.dijit.EditorXssFilter",sanitizer:null,xss:null,whiteList:{},graphicsWhiteList:{},postCreate:function(){this.whiteList=this._getWhiteList();this.sanitizer=new f({whiteList:this.whiteList,safeAttrValue:D.hitch(this,function(v,q,e,d){return"style"===q?this.xss.friendlyAttrValue(e).replace(/"/g,"'"):"img"===v&&"src"===q?this.xss.escapeAttrValue(e):this.xss.safeAttrValue(v,q,e,d)}),onTag:D.hitch(this,function(v,
q,e){if(e.isWhite&&this._isInWhiteList(v,this.graphicsWhiteList))return q}),onIgnoreTagAttr:D.hitch(this,function(v,q,e,d){if("data-"===q.substr(0,5))return q+'\x3d"'+this.xss.escapeAttrValue(e)+'"'}),onIgnoreTag:D.hitch(this,function(v,q,e){if("o:"===v.substr(0,2)||"!--[if"===v||"!--[endif]--"===v)return q})},!0);this.xss=this.sanitizer.xss},sanitize:function(v){return this.sanitizer.sanitize(v)},_getWhiteList:function(){var v="title height width class style font-family id align text-align".split(" "),
q={div:v,h1:v,h2:v,h3:v,h4:v,h5:v,h6:v,span:v,p:v,s:v,strong:v,em:v,u:v,ol:v,ul:v,li:v,a:["href","target"].concat(v),img:["src","alt","border"].concat(v),blockquote:v,font:["face","size","color"].concat(v),pre:v,code:v,b:v,i:v,wbr:v,video:"autoplay controls loop muted poster preload".split(" ").concat(v),audio:["autoplay","controls","loop","muted","preload"].concat(v),source:["media","src","type"].concat(v),table:["cellpadding","cellspacing","border"].concat(v),tbody:[].concat(v),tr:["valign"].concat(v),
td:["valign","colspan","rowspan","nowrap"].concat(v),th:["valign","colspan","rowspan","nowrap"].concat(v),hr:v,html:v,title:v,link:["rel","href"],style:["type"].concat(v),body:v};this.graphicsWhiteList={animate:[],animateMotion:[],animateTransform:[],circle:[],clipPath:[],"color-profile":[],defs:[],desc:[],discard:[],ellipse:[],feBlend:[],feColorMatrix:[],feComponentTransfer:[],feComposite:[],feConvolveMatrix:[],feDiffuseLighting:[],feDisplacementMap:[],feDistantLight:[],feDropShadow:[],feFlood:[],
feFuncA:[],feFuncB:[],feFuncG:[],feFuncR:[],feGaussianBlur:[],feImage:[],feMerge:[],feMergeNode:[],feMorphology:[],feOffset:[],fePointLight:[],feSpecularLighting:[],feSpotLight:[],feTile:[],feTurbulence:[],filter:[],foreignObject:[],g:[],hatch:[],hatchpath:[],line:[],linearGradient:[],marker:[],mask:[],mesh:[],meshgradient:[],meshpatch:[],meshrow:[],metadata:[],mpath:[],path:[],pattern:[],polygon:[],polyline:[],radialGradient:[],rect:[],set:[],solidcolor:[],stop:[],svg:[],switch:[],symbol:[],text:[],
textPath:[],title:[],tspan:[],use:[],view:[],object:[],canvas:v};return this._extendObjectOfArrays([q,{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],
em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align",
"valign"],tt:[],u:[],ul:[],video:"autoplay controls loop preload src height width".split(" ")},this.graphicsWhiteList])},_extendObjectOfArrays:function(v){var q={};A.forEach(v,function(e){var d=Object.keys(e);A.forEach(d,function(b){Array.isArray(e[b])&&Array.isArray(q[b])?q[b]=q[b].concat(e[b]):q[b]=e[b]},this)},this);return q},_isInWhiteList:function(v,q){q=Object.keys(q);var e=!1;A.forEach(q,function(d){v===d&&(e=!0)},this);return e}});c.getInstance=function(){null===t&&(t=new c);return t};return c})},
"widgets/SmartEditor/SEFilterEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dijit/_TemplatedMixin dijit/_WidgetBase".split(" "),function(N,A,F,D,g,f){return N([f,g],{name:"SEFilterEditor",baseClass:"jimu-widget-sefilterEditor",declaredClass:"jimu.dijit.SEFilterEditor",templateString:"\x3cdiv style\x3d'width:100%'\x3e\x3cdiv data-dojo-attach-point\x3d'filterEditorDiv'\x3e\x3c/div\x3e\x3c/div\x3e",_templatePicker:null,_layers:null,map:null,nls:null,
_origGetItemsFromLayerFunc:null,postCreate:function(){this._createFilterTool()},_createFilterTool:function(){this._createLayerFilter();this._createTemplateFilter();this._loadTemplates()},_createLayerFilter:function(){this.selectDropDown=D.create("select",{"class":"flDropDown templatePicker",tabindex:"0","aria-label":this.nls.filterEditor.filterLayerLabel});D.place(this.selectDropDown,this.filterEditorDiv);this.selectDropDown.onchange=A.hitch(this,function(){this._onLayerFilterChanged()})},removeOptions:function(t){var c;
for(c=t.options.length-1;0<=c;c--)t.remove(c)},_loadTemplates:function(){var t=this.selectDropDown.value===this.nls.filterEditor.all||""===this.selectDropDown.value?null:this.selectDropDown.value,c=this.filterTextBox.value,v=!1;this.removeOptions(this.selectDropDown);var q=D.create("option",{value:this.nls.filterEditor.all,innerHTML:this.nls.filterEditor.all});D.place(q,this.selectDropDown);for(q=0;q<this._layers.length;q++){var e=this._layers[q];!0===e.visible&&!0===e.visibleAtMapScale&&(null!==
t&&e.id===t&&(v=!0),e=D.create("option",{value:e.id,innerHTML:e.name}),D.place(e,this.selectDropDown))}!0===v&&(this.selectDropDown.value=t,this._onLayerFilterChanged());null!==c&&""!==c&&(this.filterTextBox.value=c,this._onTemplateFilterChanged())},setTemplatePicker:function(t,c){this._layers=c;this._templatePicker=t;this._overrideTemplatePicker();this._loadTemplates()},_createTemplateFilter:function(){this.filterTextBox=D.create("input",{"class":"searchtextbox templatePicker",type:"text",placeholder:this.nls.filterEditor.searchTemplates},
this.filterEditorDiv);this.filterTextBox.onkeyup=A.hitch(this,function(){this._onTemplateFilterChanged()});this._overrideTemplatePicker()},_overrideTemplatePicker:function(){this._origGetItemsFromLayerFunc=this._templatePicker._getItemsFromLayer;this._templatePicker._getItemsFromLayer=A.hitch(this,function(){var t=this._origGetItemsFromLayerFunc.apply(this._templatePicker,arguments);var c=this.filterTextBox.value;c&&(t=F.filter(t,function(v){var q=!1,e=new RegExp(c,"ig");v.hasOwnProperty("label")&&
v.label.match(e)&&0<v.label.match(e).length&&(q=!0);v.hasOwnProperty("template")&&v.template.hasOwnProperty("name")&&v.template.name.match(e)&&0<v.template.name.match(e).length&&(q=!0);return q}));0===t.length&&(this._templatePicker.grid.noDataMessage=this.nls.filterEditor.noAvailableTempaltes);return t})},_onLayerFilterChanged:function(){this._templatePicker.clearSelection();var t=this.selectDropDown.options[this.selectDropDown.selectedIndex].text;""!==t&&(t===this.nls.filterEditor.all?(t=F.filter(this._layers,
function(c){return!0===c.visible&&!0===c.visibleAtMapScale}),this._templatePicker.attr("featureLayers",t),""===this.filterTextBox.value?this._templatePicker.attr("grouping",!0):this._templatePicker.attr("grouping",!1)):(t=this.map.getLayer(this.selectDropDown.value),this._templatePicker.attr("featureLayers",[t]),this._templatePicker.attr("grouping",!1)),this._templatePicker.update())},_onTemplateFilterChanged:function(){var t=this.filterTextBox.value;this.selectDropDown.options[this.selectDropDown.selectedIndex].text===
this.nls.filterEditor.all&&""===t?this._templatePicker.attr("grouping",!0):this._templatePicker.attr("grouping",!1);this._templatePicker.update()}})})},"widgets/SmartEditor/SEDrawingOptions":function(){define(["esri/toolbars/draw"],function(N){return{select:[{id:"seNewSelection",iconClass:"seToolbarIcon seNewSelectionIcon",label:window.apiNls.widgets.editor.tools.NLS_selectionNewLbl}],esriGeometryPoint:[{id:"sePointTool",iconClass:"seToolbarIcon sePointIcon",_disabledIcon:"seToolbarIcon sePointIconDisabled",
_drawType:N.POINT,label:window.apiNls.widgets.editor.tools.NLS_pointLbl},{id:"seSelectFeaturesToCopyPoint",iconClass:"seToolbarIcon seNewSelectionIcon",label:"",_drawType:"SELECT"}],esriGeometryPolyline:[{id:"seDrawPolyline",iconClass:"seToolbarIcon sePolylineIcon",_disabledIcon:"seToolbarIcon sePolylineIconDisabled",_drawType:N.POLYLINE,label:window.apiNls.widgets.editor.tools.NLS_polylineLbl},{id:"seDrawFreehandPolyline",iconClass:"seToolbarIcon seFreehandPolylineIcon",_disabledIcon:"seToolbarIcon seFreehandPolylineIcon",
_drawType:N.FREEHAND_POLYLINE,label:window.apiNls.widgets.editor.tools.NLS_freehandPolylineLbl},{id:"seDrawRectPolyline",iconClass:"seToolbarIcon seRectangleIcon",_disabledIcon:"seToolbarIcon seRectangleIcon",_drawType:N.RECTANGLE,label:window.apiNls.widgets.editor.tools.NLS_rectangleLbl},{id:"seDrawArrowPolyline",iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:N.ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLbl},{id:"seDrawArrowUpPolyline",iconClass:"seToolbarIcon seArrowUpIcon",
_disabledIcon:"seToolbarIcon seArrowUpIcon",_drawType:N.UP_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowUpLbl},{id:"seDrawDownArrowPolyline",iconClass:"seToolbarIcon seArrowDownIcon",_disabledIcon:"seToolbarIcon seArrowDownIcon",_drawType:N.DOWN_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowDownLbl},{id:"seDrawLeftArrowPolyline",iconClass:"seToolbarIcon seArrowLeftIcon",_disabledIcon:"seToolbarIcon arrowLeftIcon",_drawType:N.LEFT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLeftLbl},
{id:"seDrawRightArrowPolyline",iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:N.RIGHT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowRightLbl},{id:"seDrawCirclePolyline",iconClass:"seToolbarIcon seCircleIcon",_disabledIcon:"seToolbarIcon seCircleIcon",_drawType:N.CIRCLE,label:window.apiNls.widgets.editor.tools.NLS_circleLbl},{id:"seDrawEllipsePolyline",iconClass:"seToolbarIcon seEllipseIcon",_disabledIcon:"seToolbarIcon seEllipseIcon",_drawType:N.ELLIPSE,
label:window.apiNls.widgets.editor.tools.NLS_ellipseLbl},{id:"seDrawTrianglePolyline",iconClass:"seToolbarIcon seTriangleIcon",_disabledIcon:"seToolbarIcon seTriangleIcon",_drawType:N.TRIANGLE,label:window.apiNls.widgets.editor.tools.NLS_triangleLbl},{id:"seSelectFeaturesToCopyPolyline",iconClass:"seToolbarIcon seNewSelectionIcon",label:"",_drawType:"SELECT"}],esriGeometryPolygon:[{id:"seDrawPolygon",iconClass:"seToolbarIcon sePolygonIcon",_disabledIcon:"seToolbarIcon sePolygonIconDisabled",_drawType:N.POLYGON,
label:window.apiNls.widgets.editor.tools.NLS_polygonLbl},{id:"seDrawFreehandPolygon",iconClass:"seToolbarIcon seFreehandPolygonIcon",_disabledIcon:"seToolbarIcon seFreehandPolygonIconDisabled",_drawType:N.FREEHAND_POLYGON,label:window.apiNls.widgets.editor.tools.NLS_freehandPolygonLbl},{id:"seDrawRect",iconClass:"seToolbarIcon seRectangleIcon",_disabledIcon:"seToolbarIcon seRectangleIcon",_drawType:N.RECTANGLE,label:window.apiNls.widgets.editor.tools.NLS_rectangleLbl},{id:"seDrawArrow",iconClass:"seToolbarIcon seArrowIcon",
_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:N.ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLbl},{id:"seDrawArrowUp",iconClass:"seToolbarIcon seArrowUpIcon",_disabledIcon:"seToolbarIcon seArrowUpIcon",_drawType:N.UP_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowUpLbl},{id:"seDrawDownArrow",iconClass:"seToolbarIcon seArrowDownIcon",_disabledIcon:"seToolbarIcon seArrowDownIcon",_drawType:N.DOWN_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowDownLbl},{id:"seDrawLeftArrow",
iconClass:"seToolbarIcon seArrowLeftIcon",_disabledIcon:"seToolbarIcon arrowLeftIcon",_drawType:N.LEFT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLeftLbl},{id:"seDrawRightArrow",iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:N.RIGHT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowRightLbl},{id:"seDrawCircle",iconClass:"seToolbarIcon seCircleIcon",_disabledIcon:"seToolbarIcon seCircleIcon",_drawType:N.CIRCLE,label:window.apiNls.widgets.editor.tools.NLS_circleLbl},
{id:"seDrawEllipse",iconClass:"seToolbarIcon seEllipseIcon",_disabledIcon:"seToolbarIcon seEllipseIcon",_drawType:N.ELLIPSE,label:window.apiNls.widgets.editor.tools.NLS_ellipseLbl},{id:"seDrawTriangle",iconClass:"seToolbarIcon seTriangleIcon",_disabledIcon:"seToolbarIcon seTriangleIcon",_drawType:N.TRIANGLE,label:window.apiNls.widgets.editor.tools.NLS_triangleLbl},{id:"seSelectFeaturesToCopyPolygon",iconClass:"seToolbarIcon seNewSelectionIcon",label:"",_drawType:"SELECT"}]}})},"widgets/SmartEditor/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/kernel ./PortalAnalysis".split(" "),
function(N,A,F,D,g,f,t,c){var v=null,q=N([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,constructor:function(e){this.portalUrl=e},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.portalAnalysis=this.userPortalUrl=this.userRole=null},loadPrivileges:function(e){e&&this.portalUrl!==e&&(this._clearLoadedInfo(),this.portalUrl=e);if(this._privilegeLoaded())return e=new F,e.resolve(!0),e;e=D.getPortal(this.portalUrl);return e.haveSignIn()?this._loadUserInfo(e):
this._signIn(e)},_signIn:function(e){return e.loadSelfInfo().then(A.hitch(this,function(d){var b=D.getPortal(d.portalHostname);return null===b?!1:null===b.credential?this._loadUserInfo(b):b.signIn().then(A.hitch(this,function(a){return this._loadUserInfo(b,a)}),function(){return!1})}),function(){return!1})},_registerOrgCredential:function(e,d){d=g.getStandardPortalUrl(d);e=A.clone(e.toJson());d+="/sharing/rest";e.server=d;e.resources=[d];t.id.registerToken(e)},_loadUserInfo:function(e,d){return e.loadSelfInfo().then(A.hitch(this,
function(b){this.userPortalUrl=b.urlKey?b.urlKey+"."+b.customBaseUrl:this.portalUrl;return b&&b.user?(this.userRole=new f({id:b.user.roleId?b.user.roleId:b.user.role,role:b.user.role}),b.user.privileges&&this.userRole.setPrivileges(b.user.privileges),this.portalSelf=b,d&&this._registerOrgCredential(d,this.userPortalUrl),this.portalAnalysis=new c(this.userRole,this.portalSelf),!0):!1}),function(){return!1})},_privilegeLoaded:function(){return null!==this.portalSelf},getUser:function(){return this._privilegeLoaded()?
this.portalSelf.user:null},isAdmin:function(){return this._privilegeLoaded()?this.userRole.isAdmin():!1},getUserPortal:function(){return this._privilegeLoaded()?this.userPortalUrl:null},isPortal:function(){return null!==this.portalSelf&&!0===this.portalSelf.isPortal},canPerformAnalysis:function(){return null!==this.portalAnalysis&&this.portalAnalysis.canPerformAnalysis()},hasPrivileges:function(e){return null!==this.portalAnalysis&&this.portalAnalysis.hasPrivileges(e)}});q.getInstance=function(e){null===
v&&(v=new q(e));return v};return q})},"widgets/SmartEditor/PortalAnalysis":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","esri/lang"],function(N,A,F,D){return N([],{userRole:null,portalSelf:null,constructor:function(g,f){this.userRole=g;this.portalSelf=f},canPerformAnalysis:function(){var g=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?g=!0:this.userRole&&this.userRole.isCustom()&&(g=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&
this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(g=g&&D.isDefined(this.portalSelf.helperServices.analysis)&&D.isDefined(this.portalSelf.helperServices.analysis.url));return g},hasPrivileges:function(g){return A.isArray(g)?F.every(g,function(f){return"networkanalysis"===f?this._canPerformNetworkAnalysis():"geoenrichment"===f?this._canPerformGeoEnrichment():"elevation"===f?this._canPerformElevationAnalysis():"drivetimearea"===f?this._canPerformDriveAnalysis():"planroutes"===
f?this._canPerformPlanRoutesAnalysis():"od"===f?this._canPerformODAnalysis():!1},this):!0},_canPerformNetworkAnalysis:function(){var g=D.isDefined(this.portalSelf.helperServices.asyncClosestFacility)&&D.isDefined(this.portalSelf.helperServices.asyncServiceArea)&&D.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&g&&this.userRole.canUseNetworkAnalysis()},_canPerformGeoEnrichment:function(){var g=D.isDefined(this.portalSelf.helperServices.geoenrichment);return this.canPerformAnalysis()&&
g&&this.userRole.canUseGeoenrichment()},_canPerformElevationAnalysis:function(){var g=D.isDefined(this.portalSelf.helperServices.elevation);return this.canPerformAnalysis()&&g&&this.userRole.canUseElevation()},_canPerformPlanRoutesAnalysis:function(){var g=D.isDefined(this.portalSelf.helperServices.routingUtilities)&&D.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&g&&this.userRole.canUseNetworkAnalysis()},_canPerformODAnalysis:function(){var g=D.isDefined(this.portalSelf.helperServices.routingUtilities)&&
D.isDefined(this.portalSelf.helperServices.asyncRoute);return this.canPerformAnalysis()&&g&&this.userRole.canUseNetworkAnalysis()},_canPerformDriveAnalysis:function(){var g=D.isDefined(this.portalSelf.helperServices.routingUtilities)&&D.isDefined(this.portalSelf.helperServices.asyncServiceArea);return this.canPerformAnalysis()&&g&&this.userRole.canUseNetworkAnalysis()},_canPerformNearestAnalysis:function(){var g=D.isDefined(this.portalSelf.helperServices.routingUtilities)&&D.isDefined(this.portalSelf.helperServices.asyncClosestFacility);
return this.canPerformAnalysis()&&g&&this.userRole.canUseNetworkAnalysis()}})})},"widgets/SmartEditor/XYCoordinates":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/on dojo/text!./XYCoordinates.html dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/Popup dojo/dom-attr dojo/dom-class esri/geometry/coordinateFormatter esri/SpatialReference dijit/form/ValidationTextBox".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d){return N([t,A,f],{baseClass:"jimu-widget-smartEditor-XYCoordinates",
templateString:g,fieldsPopup:null,postCreate:function(){this._createPopUp();this._eventListener();e.load()},_eventListener:function(){this.own(D(this.coordinatesDropDown,"change",F.hitch(this,this._onChangeDropDown)));this.own(D(this.xAttributeTextBox,"change",F.hitch(this,this._onTextBoxValueChanged)));this.own(D(this.yAttributeTextBox,"change",F.hitch(this,this._onTextBoxValueChanged)));this.mgrsTextBox.validator=F.hitch(this,this._mgrsValidator)},_onChangeDropDown:function(){q.add(this.xyOptions,
"esriCTHidden");q.add(this.mgrsOptions,"esriCTHidden");"Map Spatial Reference"===this.coordinatesDropDown.value?(q.remove(this.xyOptions,"esriCTHidden"),v.set(this.xAttributeTextBoxLabel,"innerHTML",this.nls.xAttributeTextBoxLabel),v.set(this.yAttributeTextBoxLabel,"innerHTML",this.nls.yAttributeTextBoxLabel),this.xAttributeTextBox.set("value",""),this.yAttributeTextBox.set("value",""),v.set(this.xAttributeTextBox,"aria-label",this.nls.xAttributeTextBoxLabel),v.set(this.yAttributeTextBox,"aria-label",
this.nls.yAttributeTextBoxLabel)):"MGRS"===this.coordinatesDropDown.value?q.remove(this.mgrsOptions,"esriCTHidden"):(q.remove(this.xyOptions,"esriCTHidden"),v.set(this.xAttributeTextBoxLabel,"innerHTML",this.nls.latitudeTextBoxLabel),v.set(this.yAttributeTextBoxLabel,"innerHTML",this.nls.longitudeTextBoxLabel),this.xAttributeTextBox.set("value",""),this.yAttributeTextBox.set("value",""),v.set(this.xAttributeTextBox,"aria-label",this.nls.latitudeTextBoxLabel),v.set(this.yAttributeTextBox,"aria-label",
this.nls.longitudeTextBoxLabel))},_createPopUp:function(){this.fieldsPopup=new c({titleLabel:this.nls.coordinatePopupTitle,width:400,maxHeight:300,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,id:"okButton",onClick:F.hitch(this,function(){this._getData();this.mgrsTextBox.set("value","");this.xAttributeTextBox.set("value","");this.yAttributeTextBox.set("value","");this.fieldsPopup.close()})},{label:this.nls.cancel,id:"cancelButton",classNames:["jimu-btn-vacation"],onClick:F.hitch(this,
function(){this.xAttributeTextBox.set("value","");this.yAttributeTextBox.set("value","");this.fieldsPopup.close()})}]});this.fieldsPopup.disableButton(0);v.set(this.fieldsPopup.disabledButtons[0],"tabindex","-1")},_getData:function(){if("MGRS"===this.coordinatesDropDown.value){var b=e.fromMgrs(this.mgrsTextBox.get("value"),new d(4326),"automatic");b&&this.emit("gotoSelectedLocation",{coordinateSystem:"Latitude/Longitude",firstPoint:b.y,secondPoint:b.x})}else this.emit("gotoSelectedLocation",{coordinateSystem:this.coordinatesDropDown.getValue(),
firstPoint:this.xAttributeTextBox.getValue(),secondPoint:this.yAttributeTextBox.getValue()})},_mgrsValidator:function(){var b=null;""!==this.mgrsTextBox.get("value")&&(b=e.fromMgrs(this.mgrsTextBox.get("value"),new d(4326),"automatic"));if(null===b)return this.fieldsPopup.disableButton(0),v.set(this.fieldsPopup.disabledButtons[0],"tabindex","-1"),!1;this.fieldsPopup.enableButton(0);v.set(this.fieldsPopup.enabledButtons[0],"tabindex","0");return!0},_onTextBoxValueChanged:function(){isNaN(this.xAttributeTextBox.value)||
isNaN(this.yAttributeTextBox.value)?(this.fieldsPopup.disableButton(0),v.set(this.fieldsPopup.disabledButtons[0],"tabindex","-1")):(this.fieldsPopup.enableButton(0),v.set(this.fieldsPopup.enabledButtons[0],"tabindex","0"))}})})},"esri/geometry/coordinateFormatter":function(){define("require exports ../layers/vectorTiles/core/Error ./pe ./Point ../SpatialReference".split(" "),function(N,A,F,D,g,f){function t(q){var e=null;q||(q=new f(4326));if(q.wkid){if(e=D.PeFactory.geogcs(q.wkid),!e)throw new F("coordinate-formatter:invalid-spatial-reference",
"wkid is not valid");}else if(q.wkt){if(e=D.PeFactory.fromString(D.PeDefs.PE_TYPE_GEOGCS,q.wkt),!e)throw new F("coordinate-formatter:invalid-spatial-reference","wkt is not valid");}else throw new F("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");return e}function c(q){var e=-1;switch(q){case "automatic":e=D.PeNotationMgrs.PE_MGRS_STYLE_AUTO;break;case "new-180-in-zone-01":e=D.PeNotationMgrs.PE_MGRS_STYLE_NEW|D.PeNotationMgrs.PE_MGRS_180_ZONE_1_PLUS;break;case "new-180-in-zone-60":e=
D.PeNotationMgrs.PE_MGRS_STYLE_NEW;break;case "old-180-in-zone-01":e=D.PeNotationMgrs.PE_MGRS_STYLE_OLD|D.PeNotationMgrs.PE_MGRS_180_ZONE_1_PLUS;break;case "old-180-in-zone-60":e=D.PeNotationMgrs.PE_MGRS_STYLE_OLD}return e}function v(q){var e=-1;switch(q){case "latitude-band-indicators":e=D.PeNotationUtm.PE_UTM_OPTS_NONE;break;case "north-south-indicators":e=D.PeNotationUtm.PE_UTM_OPTS_NS}return e}Object.defineProperty(A,"__esModule",{value:!0});A.isLoaded=function(){return D.isLoaded()};A.isSupported=
function(){return D.isSupported()};A.load=function(){return D.load()};A.fromLatitudeLongitude=function(q,e){var d=[];q=q.replace(/\u2032/g,"'");var b=t(e);return D.PeNotationDms.dms_to_geog(b,1,[q],d)?new g(d[0][0],d[0][1],e||new f(4326)):null};A.fromMgrs=function(q,e,d){var b=[],a=c(d);if(-1===a)return console.warn("invalid conversionMode: "+d),null;d=t(e);return D.PeNotationMgrs.mgrs_to_geog_extended(d,1,[q],a,b)?new g(b[0][0],b[0][1],e||new f(4326)):null};A.fromUsng=function(q,e){var d=[];!e&&
/\(.+27/.test(q)&&(e=new f(4267));var b=t(e);return D.PeNotationUsng.usng_to_geog(b,1,[q],d)?new g(d[0][0],d[0][1],e||new f(4326)):null};A.fromUtm=function(q,e,d){var b=[],a=v(d);if(-1===a)return console.warn("invalid conversionMode: "+d),null;d=t(e);return D.PeNotationUtm.utm_to_geog(d,1,[q],a,b)?new g(b[0][0],b[0][1],e||new f(4326)):null};A.toLatitudeLongitude=function(q,e,d){void 0===d&&(d=0);var b=[[q.x,q.y]],a=[];q=t(q.spatialReference);var m=0;switch(e){case "dd":m=D.PeNotationDms.geog_to_dd(q,
1,b,d,a);break;case "ddm":m=D.PeNotationDms.geog_to_ddm(q,1,b,d,a);break;case "dms":m=D.PeNotationDms.geog_to_dms(q,1,b,d,a);break;default:return console.warn("invalid format: "+e),null}return m?a[0]:null};A.toMgrs=function(q,e,d,b){void 0===d&&(d=0);void 0===b&&(b=!1);var a=[[q.x,q.y]],m=[];q=t(q.spatialReference);var l=c(e);if(-1===l)return console.warn("invalid conversionMode: "+e),null;b&&(l|=D.PeNotationMgrs.PE_MGRS_ADD_SPACES);return D.PeNotationMgrs.geog_to_mgrs_extended(q,1,a,d,!1,l,m)?m[0]:
null};A.toUsng=function(q,e,d){void 0===e&&(e=0);void 0===d&&(d=!1);var b=[[q.x,q.y]],a=[];q=t(q.spatialReference);return D.PeNotationUsng.geog_to_usng(q,1,b,e,!1,d,a)?a[0]:null};A.toUtm=function(q,e,d){void 0===d&&(d=!1);var b=[[q.x,q.y]],a=[];q=t(q.spatialReference);var m=v(e);if(-1===m)return console.warn("invalid conversionMode: "+e),null;d&&(m|=D.PeNotationUtm.PE_UTM_OPTS_ADD_SPACES);return D.PeNotationUtm.geog_to_utm(q,1,b,m,a)?a[0]:null}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(N,A,F,D,g){N=function(f){function t(c,v,q){var e=f.call(this,c,v,q)||this;return e instanceof t?e:new t(c,v,q)}F(t,f);t.prototype.toJSON=function(){return{name:this.name,message:this.message,details:D.clone(this.details),dojoType:this.dojoType}};t.fromJSON=function(c){var v=new t(c.name,c.message,c.details);null!=c.dojoType&&(v.dojoType=c.dojoType);return v};return t}(g);N.prototype.type="error";return N})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,F){A.__proto__=F}||function(A,F){for(var D in F)F.hasOwnProperty(D)&&(A[D]=F[D])};return function(A,F){function D(){this.constructor=A}N(A,F);A.prototype=null===F?Object.create(F):(D.prototype=F.prototype,new D)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(N,A,F,D,
g,f){function t(a){return void 0!==a&&null!==a}function c(a){return t(a)?a:""}function v(a,m,l){var n=l.match(/([^\(]+)(\([^\)]+\))?/i),k=A.trim(n[1]);l=m[a];n=JSON.parse((n[2]?A.trim(n[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var x=n.utcOffset;if(-1===d.indexOf(k))k=A.getObject(k),A.isFunction(k)&&(l=k(l,a,m,n));else if("number"===typeof l||"string"===typeof l&&l&&!isNaN(Number(l)))switch(l=
Number(l),k){case "NumberFormat":a=A.mixin({},n);m=parseFloat(a.places);if(isNaN(m)||0>m)a.places=Infinity;return D.format(l,a);case "DateString":l=new Date(l);if(n.local||n.systemLocale)return n.systemLocale?l.toLocaleDateString()+(n.hideTime?"":" "+l.toLocaleTimeString()):l.toDateString()+(n.hideTime?"":" "+l.toTimeString());l=l.toUTCString();n.hideTime&&(l=l.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return l;case "DateFormat":return l=new Date(l),t(x)&&(l=F.add(l,"minute",l.getTimezoneOffset()-
x)),g.format(l,n)}return c(l)}function q(a,m){var l;if(m)for(l in a)a.hasOwnProperty(l)&&(void 0===a[l]?delete a[l]:a[l]instanceof Object&&q(a[l],!0));else for(l in a)a.hasOwnProperty(l)&&void 0===a[l]&&delete a[l];return a}function e(a){if(!a||"object"!=typeof a||A.isFunction(a))return a;if(a instanceof Int8Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||
a instanceof Float64Array||a instanceof Date)return new a.constructor(a);if(a instanceof ArrayBuffer)return a.slice(0,a.byteLength);if("function"===typeof a.clone)a=a.clone();else if("function"===typeof a.map&&"function"===typeof a.forEach)a=a.map(e);else if("function"===typeof a.notifyChange&&"function"===typeof a.watch)a=a.clone();else{var m={},l,n={};for(l in a){var k=a[l];var x=!(l in n)||n[l]!==k;if(!(l in m)||m[l]!==k&&x)m[l]=e?e(k):k}a=m}return a}var d=["NumberFormat","DateString","DateFormat"],
b=/<\/?[^>]+>/g;return{equals:function(a,m){return a===m||"number"===typeof a&&isNaN(a)&&"number"===typeof m&&isNaN(m)||A.isFunction((a||{}).getTime)&&A.isFunction((m||{}).getTime)&&a.getTime()==m.getTime()||A.isFunction((a||{}).equals)&&a.equals(m)||A.isFunction((m||{}).equals)&&m.equals(a)||!1},mixin:A.mixin,valueOf:function(a,m){for(var l in a)if(a[l]==m)return l;return null},stripTags:function(a){if(a){var m=typeof a;if("string"===m)a=a.replace(b,"");else if("object"===m)for(var l in a)(m=a[l])&&
"string"===typeof m&&(m=m.replace(b,"")),a[l]=m}return a},substitute:function(a,m,l){if(t(l))if(A.isObject(l)){var n=l.first;var k=l.dateFormat;var x=l.numberFormat}else n=l;if(m&&"{*}"!==m)return A.replace(m,A.hitch({obj:a},function(B,h){B=h.split(":");return 1<B.length?(h=B[0],B.shift(),v(h,this.obj,B.join(":"))):k&&-1!==(k.properties||[]).indexOf(h)?v(h,this.obj,k.formatter||"DateString"):x&&-1!==(x.properties||[]).indexOf(h)?v(h,this.obj,x.formatter||"NumberFormat"):c(this.obj[h])}));m=[];var u;
m.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+f.fieldsSummary+'"\x3e\x3ctbody\x3e');for(u in a)if(l=a[u],k&&-1!==(k.properties||[]).indexOf(u)?l=v(u,a,k.formatter||"DateString"):x&&-1!==(x.properties||[]).indexOf(u)&&(l=v(u,a,x.formatter||"NumberFormat")),m.push("\x3ctr\x3e\x3cth\x3e"+u+"\x3c/th\x3e\x3ctd\x3e"+c(l)+"\x3c/td\x3e\x3c/tr\x3e"),n)break;m.push("\x3c/tbody\x3e\x3c/table\x3e");return m.join("")},filter:function(a,m,l){m=[A.isString(a)?a.split(""):a,l||N.global,A.isString(m)?
new Function("item","index","array",m):m];l={};var n;a=m[0];for(n in a)m[2].call(m[n],a[n],n,a)&&(l[n]=a[n]);return l},startsWith:function(a,m,l){l=l||0;return a.indexOf(m,l)===l},endsWith:function(a,m,l){if("number"!==typeof l||!isFinite(l)||Math.floor(l)!==l||l>a.length)l=a.length;l-=m.length;a=a.indexOf(m,l);return-1!==a&&a===l},isDefined:t,fixJson:q,clone:e}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(N,A,F){return function(){function D(g,
f,t){this instanceof D&&(this.name=g,this.message=f&&F.substitute(f,t,function(c){return null==c?"":c})||"",this.details=t)}D.prototype.toString=function(){return"["+this.name+"]: "+this.message};return D}()})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(N,A,F,D,g){function f(n){function k(h,r,w){h[r]=w(h[r])}A._pe=n;d.init();b.init();a.init();m.init();l.init();A.PeGCSExtent=function(h){function r(){return null!==
h&&h.apply(this,arguments)||this}F(r,h);r.prototype.destroy=function(){A._pe.destroy(this)};return r}(A._pe.PeGCSExtent);for(var x=0,u=[A._pe.PeDatum,A._pe.PeGeogcs,A._pe.PeGeogtran,A._pe.PeObject,A._pe.PeParameter,A._pe.PePrimem,A._pe.PeProjcs,A._pe.PeSpheroid,A._pe.PeUnit];x<u.length;x++)n=u[x],k(n.prototype,"getName",function(h){return function(){return h.call(this,Array(d.PE_NAME_MAX))}});x=0;for(u=[A._pe.PeGeogtran,A._pe.PeProjcs];x<u.length;x++)n=u[x],k(n.prototype,"getParameters",function(h){return function(){for(var r=
Array(d.PE_PARM_MAX),w=h.call(this),G=0;G<r.length;G++){var y=A._pe.getValue(w,"*");r[G]=y?A._pe.wrapPointer(y,A._pe.PeParameter):null;w+=Int32Array.BYTES_PER_ELEMENT}return r}});k(A._pe.PeHorizon.prototype,"getCoord",function(h){return function(){var r=this.getSize();if(!r)return null;var w=[],G=h.call(this);q(w,r,G);return w}});k(A._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(h){var r=A._pe._pe_getPeGTlistExtendedGTsSize();return function(){var w=null,G=h.call(this);if(!A._pe.compare(G,
A._pe.NULL)){w=[G];var y=this.getSteps();if(1<y){G=A._pe.getPointer(G);for(var J=1;J<y;J++)w.push(A._pe.wrapPointer(G+r*J,A._pe.PeGTlistExtendedGTs))}}return w}});var B=A._pe._pe_getPeHorizonSize();n=function(h){return function(){var r=this._cache;r||(this._cache=r=new Map);if(r.has(h))return r.get(h);var w=null,G=h.call(this);if(!A._pe.compare(G,A._pe.NULL)){w=[G];var y=G.getNump();if(1<y){G=A._pe.getPointer(G);for(var J=1;J<y;J++)w.push(A._pe.wrapPointer(G+B*J,A._pe.PeHorizon))}}r.set(h,w);return w}};
k(A._pe.PeProjcs.prototype,"horizonGcsGenerate",n);k(A._pe.PeProjcs.prototype,"horizonPcsGenerate",n);A._pe.PeObject.prototype.toString=function(h){void 0===h&&(h=d.PE_STR_OPTS_NONE);A._pe.ensureCache.prepare();var r=A._pe.getPointer(this),w=A._pe.ensureInt8(Array(d.PE_BUFFER_MAX));return A._pe.UTF8ToString(A._pe._pe_object_to_string_ext(r,h,w))}}function t(n){if(n){var k=A._pe.getClass(n);k&&(k=A._pe.getCache(k))&&(n=A._pe.getPointer(n))&&delete k[n]}}function c(n,k){var x=[];k=Array(k);for(var u=
0;u<n;u++)x.push(A._pe.ensureInt8(k));return x}function v(n){if(Array.isArray(n[0])){var k=[];n.forEach(function(x){k.push(x[0],x[1])})}else k=n;return k}function q(n,k,x,u){void 0===u&&(u=!1);if(u)for(u=0;u<2*k;u++)n[u]=A._pe.getValue(x+u*Float64Array.BYTES_PER_ELEMENT,"double");else{var B=0===n.length;for(u=0;u<k;u++)B&&(n[u]=Array(2)),n[u][0]=A._pe.getValue(x,"double"),n[u][1]=A._pe.getValue(x+Float64Array.BYTES_PER_ELEMENT,"double"),x+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(A,
"__esModule",{value:!0});var e;A._pe=null;A.isLoaded=function(){return!!A._pe};A.isSupported=function(){return!!g("esri-wasm")};A.load=function(){if(e)return e.promise;e=new D;N(["./support/pe-wasm"],function(n){n({locateFile:function(k){return N.toUrl("./support/"+k)},onAbort:function(k){e.reject(Error(k))}}).then(function(k){f(k);e.resolve()})});return e.promise};(function(n){function k(B,h,r){A._pe.ensureCache.prepare();var w=v(r),G=r===w;w=A._pe.ensureFloat64(w);(B=A._pe._pe_geog_to_proj(A._pe.getPointer(B),
h,w))&&q(r,h,w,G);return B}function x(B,h,r){return u(B,h,r,0)}function u(B,h,r,w){A._pe.ensureCache.prepare();var G=v(r),y=r===G;G=A._pe.ensureFloat64(G);(B=A._pe._pe_proj_to_geog_center(A._pe.getPointer(B),h,G,w))&&q(r,h,G,y);return B}n.geogToProj=k;n.projGeog=function(B,h,r,w){switch(w){case d.PE_TRANSFORM_P_TO_G:return x(B,h,r);case d.PE_TRANSFORM_G_TO_P:return k(B,h,r)}return 0};n.projToGeog=x;n.projToGeogCenter=u})(A.PeCSTransformations||(A.PeCSTransformations={}));var d;(function(n){n.init=
function(){n.PE_BUFFER_MAX=A._pe.PeDefs.prototype.PE_BUFFER_MAX;n.PE_NAME_MAX=A._pe.PeDefs.prototype.PE_NAME_MAX;n.PE_MGRS_MAX=A._pe.PeDefs.prototype.PE_MGRS_MAX;n.PE_USNG_MAX=A._pe.PeDefs.prototype.PE_USNG_MAX;n.PE_DD_MAX=A._pe.PeDefs.prototype.PE_DD_MAX;n.PE_DDM_MAX=A._pe.PeDefs.prototype.PE_DDM_MAX;n.PE_DMS_MAX=A._pe.PeDefs.prototype.PE_DMS_MAX;n.PE_UTM_MAX=A._pe.PeDefs.prototype.PE_UTM_MAX;n.PE_PARM_MAX=A._pe.PeDefs.prototype.PE_PARM_MAX;n.PE_TYPE_NONE=A._pe.PeDefs.prototype.PE_TYPE_NONE;n.PE_TYPE_GEOGCS=
A._pe.PeDefs.prototype.PE_TYPE_GEOGCS;n.PE_TYPE_PROJCS=A._pe.PeDefs.prototype.PE_TYPE_PROJCS;n.PE_TYPE_GEOGTRAN=A._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;n.PE_TYPE_COORDSYS=A._pe.PeDefs.prototype.PE_TYPE_COORDSYS;n.PE_TYPE_UNIT=A._pe.PeDefs.prototype.PE_TYPE_UNIT;n.PE_STR_OPTS_NONE=A._pe.PeDefs.prototype.PE_STR_OPTS_NONE;n.PE_STR_AUTH_NONE=A._pe.PeDefs.prototype.PE_STR_AUTH_NONE;n.PE_STR_AUTH_TOP=A._pe.PeDefs.prototype.PE_STR_AUTH_TOP;n.PE_STR_NAME_CANON=A._pe.PeDefs.prototype.PE_STR_NAME_CANON;n.PE_PARM_X0=
A._pe.PeDefs.prototype.PE_PARM_X0;n.PE_PARM_ND=A._pe.PeDefs.prototype.PE_PARM_ND;n.PE_TRANSFORM_1_TO_2=A._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;n.PE_TRANSFORM_2_TO_1=A._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;n.PE_TRANSFORM_P_TO_G=A._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;n.PE_TRANSFORM_G_TO_P=A._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;n.PE_HORIZON_RECT=A._pe.PeDefs.prototype.PE_HORIZON_RECT;n.PE_HORIZON_POLY=A._pe.PeDefs.prototype.PE_HORIZON_POLY;n.PE_HORIZON_LINE=A._pe.PeDefs.prototype.PE_HORIZON_LINE;
n.PE_HORIZON_DELTA=A._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(d=A.PeDefs||(A.PeDefs={}));(function(n){function k(h,r){var w=null,G=u[h];G||(G={},u[h]=G);G.hasOwnProperty(String(r))?w=G[r]:(h=A._pe.PeFactory.prototype.factoryByType(h,r),A._pe.compare(h,A._pe.NULL)||(w=h,G[r]=w));return w=x(w)}function x(h){if(h){var r=h.getType();switch(r){case d.PE_TYPE_GEOGCS:h=A._pe.castObject(h,A._pe.PeGeogcs);break;case d.PE_TYPE_PROJCS:h=A._pe.castObject(h,A._pe.PeProjcs);break;case d.PE_TYPE_GEOGTRAN:h=A._pe.castObject(h,
A._pe.PeGeogtran);break;default:r&d.PE_TYPE_UNIT&&(h=A._pe.castObject(h,A._pe.PeUnit))}}return h}var u={},B={};n.initialize=function(){A._pe.PeFactory.prototype.initialize(null)};n.coordsys=function(h){return k(d.PE_TYPE_COORDSYS,h)};n.factoryByType=k;n.fromString=function(h,r){var w=null,G=B[h];G||(G={},B[h]=G);G.hasOwnProperty(r)?w=G[r]:(h=A._pe.PeFactory.prototype.fromString(h,r),A._pe.compare(h,A._pe.NULL)||(w=h,G[r]=w));return w=x(w)};n.geogcs=function(h){return k(d.PE_TYPE_GEOGCS,h)};n.geogtran=
function(h){return k(d.PE_TYPE_GEOGTRAN,h)};n.getCode=function(h){return A._pe.PeFactory.prototype.getCode(h)};n.projcs=function(h){return k(d.PE_TYPE_PROJCS,h)};n.unit=function(h){return k(d.PE_TYPE_UNIT,h)}})(A.PeFactory||(A.PeFactory={}));A.PeGCSExtent=null;var b;(function(n){var k;n.init=function(){n.PE_GTLIST_OPTS_COMMON=A._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;k=A._pe._pe_getPeGTlistExtendedEntrySize()};n.getGTlist=function(x,u,B,h,r,w){var G=null,y=new A._pe.PeInteger(w);try{var J=
A._pe.PeGTlistExtended.prototype.getGTlist(x,u,B,h,r,y);if(w=y.val)if(G=[J],1<w){var M=A._pe.getPointer(J);for(x=1;x<w;x++)G.push(A._pe.wrapPointer(M+k*x,A._pe.PeGTlistExtendedEntry))}}finally{A._pe.destroy(y)}return G}})(b=A.PeGTlistExtended||(A.PeGTlistExtended={}));(function(n){n.destroy=function(k){if(k&&k.length){for(var x=0;x<k.length;x++){var u=k[x];t(u);u.getEntries().forEach(function(B){t(B);B=B.getGeogtran();t(B);B.getParameters().forEach(t);[B.getGeogcs1(),B.getGeogcs2()].forEach(function(h){t(h);
var r=h.getDatum();t(r);t(r.getSpheroid());t(h.getPrimem());t(h.getUnit())})})}A._pe.PeGTlistExtendedEntry.prototype.Delete(k[0])}}})(A.PeGTlistExtendedEntry||(A.PeGTlistExtendedEntry={}));(function(n){n.geogToGeog=function(k,x,u,B,h){A._pe.ensureCache.prepare();var r=v(u),w=u===r;r=A._pe.ensureFloat64(r);var G=0;B&&(G=A._pe.ensureFloat64(B));(k=A._pe._pe_geog_to_geog(A._pe.getPointer(k),x,r,G,h))&&q(u,x,r,w);return k}})(A.PeGTTransformations||(A.PeGTTransformations={}));(function(n){function k(u,
B,h,r,w,G){A._pe.ensureCache.prepare();switch(u){case "dd":var y=A._pe._pe_geog_to_dd;var J=d.PE_DD_MAX;break;case "ddm":y=A._pe._pe_geog_to_ddm;J=d.PE_DDM_MAX;break;case "dms":y=A._pe._pe_geog_to_dms,J=d.PE_DMS_MAX}u=0;B&&(u=A._pe.getPointer(B));B=v(r);B=A._pe.ensureFloat64(B);J=c(h,J);r=A._pe.ensureInt32(J);if(w=y(u,h,B,w,r))for(y=0;y<h;y++)G[y]=A._pe.UTF8ToString(J[y]);return w}function x(u,B,h,r,w){A._pe.ensureCache.prepare();switch(u){case "dd":var G=A._pe._pe_dd_to_geog;break;case "ddm":G=A._pe._pe_ddm_to_geog;
break;case "dms":G=A._pe._pe_dms_to_geog}u=0;B&&(u=A._pe.getPointer(B));B=r.map(function(y){return A._pe.ensureString(y)});r=A._pe.ensureInt32(B);B=A._pe.ensureFloat64(Array(2*h));(G=G(u,h,r,B))&&q(w,h,B);return G}n.geog_to_dms=function(u,B,h,r,w){return k("dms",u,B,h,r,w)};n.dms_to_geog=function(u,B,h,r){return x("dms",u,B,h,r)};n.geog_to_ddm=function(u,B,h,r,w){return k("ddm",u,B,h,r,w)};n.ddm_to_geog=function(u,B,h,r){return x("ddm",u,B,h,r)};n.geog_to_dd=function(u,B,h,r,w){return k("dd",u,B,
h,r,w)};n.dd_to_geog=function(u,B,h,r){return x("dd",u,B,h,r)}})(A.PeNotationDms||(A.PeNotationDms={}));var a;(function(n){n.init=function(){n.PE_MGRS_STYLE_NEW=A._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;n.PE_MGRS_STYLE_OLD=A._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;n.PE_MGRS_STYLE_AUTO=A._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;n.PE_MGRS_180_ZONE_1_PLUS=A._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;n.PE_MGRS_ADD_SPACES=A._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
n.geog_to_mgrs_extended=function(k,x,u,B,h,r,w){A._pe.ensureCache.prepare();var G=0;k&&(G=A._pe.getPointer(k));k=v(u);u=A._pe.ensureFloat64(k);k=c(x,d.PE_MGRS_MAX);var y=A._pe.ensureInt32(k);if(B=A._pe._pe_geog_to_mgrs_extended(G,x,u,B,h,r,y))for(h=0;h<x;h++)w[h]=A._pe.UTF8ToString(k[h]);return B};n.mgrs_to_geog_extended=function(k,x,u,B,h){A._pe.ensureCache.prepare();var r=0;k&&(r=A._pe.getPointer(k));k=u.map(function(w){return A._pe.ensureString(w)});u=A._pe.ensureInt32(k);k=A._pe.ensureFloat64(Array(2*
x));(B=A._pe._pe_mgrs_to_geog_extended(r,x,u,B,k))&&q(h,x,k);return B}})(a=A.PeNotationMgrs||(A.PeNotationMgrs={}));(function(n){n.geog_to_usng=function(k,x,u,B,h,r,w){A._pe.ensureCache.prepare();var G=0;k&&(G=A._pe.getPointer(k));k=v(u);u=A._pe.ensureFloat64(k);k=c(x,d.PE_MGRS_MAX);var y=A._pe.ensureInt32(k);if(B=A._pe._pe_geog_to_usng(G,x,u,B,h,r,y))for(h=0;h<x;h++)w[h]=A._pe.UTF8ToString(k[h]);return B};n.usng_to_geog=function(k,x,u,B){A._pe.ensureCache.prepare();var h=0;k&&(h=A._pe.getPointer(k));
k=u.map(function(r){return A._pe.ensureString(r)});u=A._pe.ensureInt32(k);k=A._pe.ensureFloat64(Array(2*x));(h=A._pe._pe_usng_to_geog(h,x,u,k))&&q(B,x,k);return h}})(A.PeNotationUsng||(A.PeNotationUsng={}));var m;(function(n){n.init=function(){n.PE_UTM_OPTS_NONE=A._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;n.PE_UTM_OPTS_ADD_SPACES=A._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;n.PE_UTM_OPTS_NS=A._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};n.geog_to_utm=function(k,x,u,B,h){A._pe.ensureCache.prepare();
var r=0;k&&(r=A._pe.getPointer(k));k=v(u);u=A._pe.ensureFloat64(k);k=c(x,d.PE_UTM_MAX);var w=A._pe.ensureInt32(k);if(B=A._pe._pe_geog_to_utm(r,x,u,B,w))for(r=0;r<x;r++)h[r]=A._pe.UTF8ToString(k[r]);return B};n.utm_to_geog=function(k,x,u,B,h){A._pe.ensureCache.prepare();var r=0;k&&(r=A._pe.getPointer(k));k=u.map(function(w){return A._pe.ensureString(w)});u=A._pe.ensureInt32(k);k=A._pe.ensureFloat64(Array(2*x));(B=A._pe._pe_utm_to_geog(r,x,u,B,k))&&q(h,x,k);return B}})(m=A.PeNotationUtm||(A.PeNotationUtm=
{}));var l;(function(n){var k=new Map;n.init=function(){n.PE_PCSINFO_OPTION_NONE=A._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;n.PE_PCSINFO_OPTION_DOMAIN=A._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;n.PE_POLE_OUTSIDE_BOUNDARY=A._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;n.PE_POLE_POINT=A._pe.PePCSInfo.prototype.PE_POLE_POINT};n.generate=function(x,u){void 0===u&&(u=n.PE_PCSINFO_OPTION_DOMAIN);var B;if(k.has(x)){var h=k.get(x);h[u]&&(B=h[u])}B||(B=A._pe.PePCSInfo.prototype.generate(x,
u),h||(h=[],k.set(x,h)),h[u]=B);return B}})(l=A.PePCSInfo||(A.PePCSInfo={}));(function(n){n.version_string=function(){return A._pe.PeVersion.prototype.version_string()}})(A.PeVersion||(A.PeVersion={}));A._init=f})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,F){A.__proto__=F}||function(A,F){for(var D in F)F.hasOwnProperty(D)&&(A[D]=F[D])};return function(A,F){function D(){this.constructor=
A}N(A,F);A.prototype=null===F?Object.create(F):(D.prototype=F.prototype,new D)}}()})},"widgets/SmartEditor/coordinateUtils":function(){define("dojo/_base/lang dojo/Deferred esri/geometry/webMercatorUtils esri/SpatialReference esri/geometry/coordinateFormatter esri/geometry/Point".split(" "),function(N,A,F,D,g,f){var t={};g.load();t.getProjectedGeometry=function(c,v,q){var e=new A;if(F.canProject(c,v)){var d=F.project(c,v);e.resolve(d)}else q.project([c],v,function(b){d=b[0];e.resolve(d)},function(){e.reject(null)});
return e.promise};t.getMapCoordinates=function(c){switch(c.type){case "polygon":var v=c.getCentroid();break;case "polyline":v=c.getPoint(0,0);break;case "point":v=c}return v};t.getCoordinatesData=function(c,v){var q={};var e=new A;var d=new D(4326);q.MapSpatialReference=t.getMapCoordinates(c);t.getProjectedGeometry(q.MapSpatialReference,d,v).then(N.hitch(this,function(b){q.LatLong=b;this._getMGRSCoordinatesData(e,q)}),N.hitch(this,function(){q.LatLong={x:"",y:""};q.MGRS={MGRS:""};e.resolve(q)}));
return e.promise};t._getMGRSCoordinatesData=function(c,v){var q="";q=new f(v.LatLong.x,v.LatLong.y,new D({wkid:4326}));q=g.toMgrs(q,"automatic",5);v.MGRS={MGRS:q};c.resolve(v)};t.getCoordinatesDataWhenXYEmpty=function(c){var v={},q=new A;v.MapSpatialReference={x:"",y:""};v.LatLong=c;this._getMGRSCoordinatesData(q,v);return q.promise};return t})},"widgets/SmartEditor/addressUtils":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","esri/tasks/locator","dijit/_WidgetBase"],function(N,
A,F,D,g){return N([g],{_locatorInstance:null,postCreate:function(){this._initReverseGeocoder()},_initReverseGeocoder:function(){this.config.geocoderSettings&&this.config.geocoderSettings.url&&(this._locatorInstance=new D(this.config.geocoderSettings.url))},locateAddress:function(f){var t=new F;this._locatorInstance?this._locatorInstance.locationToAddress(f,100,A.hitch(this,function(c){c&&c.address&&(c=c.address);t&&t.resolve(c)}),A.hitch(this,function(){t.resolve({})})):t.resolve({});return t.promise}})})},
"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(N,A,F,D,g,f,t,c,v,q,e){N=N(q,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(d){this._geocodeHandler=
A.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=A.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=A.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(d){this.outSpatialReference=d},_geocodeHandler:function(d,b,a,m,l){try{var n=d.candidates;b=[];var k,x=n.length,u=d.spatialReference,B;for(k=0;k<x;k++){var h=n[k];if(B=h.location)B.spatialReference=u;b[k]=new e(h)}this._successHandler([b],
"onAddressToLocationsComplete",a,l)}catch(r){this._errorHandler(r,m,l)}},_geocodeAddressesHandler:function(d,b,a,m,l){try{var n=d.locations;b=[];var k,x=n.length,u=d.spatialReference,B;for(k=0;k<x;k++){if(B=n[k].location)B.spatialReference=u;b[k]=new e(n[k])}this._successHandler([b],"onAddressesToLocationsComplete",a,l)}catch(h){this._errorHandler(h,m,l)}},addressToLocations:function(d,b,a,m,l){var n;if(d.address){m=a;a=b;b=d.outFields;l=d.searchExtent;var k=d.countryCode;var x=d.magicKey;var u=d.distance;
var B=d.categories;d.location&&this.normalization&&(n=d.location.normalize());var h=d.locationType;var r=d.maxLocations;var w=d.forStorage;d=d.address}l&&(l=l.shiftCentralMeridian());var G=this.outSpatialReference;d=this._encode(A.mixin({},this._url.query,d,{f:"json",outSR:G&&g.toJson(G.toJson()),outFields:b&&b.join(",")||null,searchExtent:l&&g.toJson(l.toJson()),category:B&&B.join(",")||null,countryCode:k||null,magicKey:x||null,distance:u||null,location:n||null,locationType:h||null,maxLocations:r||
null,forStorage:w||null}));var y=this._geocodeHandler,J=this._errorHandler,M=new D(v._dfdCanceller);M._pendingDfd=c({url:this._url.path+"/findAddressCandidates",content:d,callbackParamName:"callback",load:function(ba,W){y(ba,W,a,m,M)},error:function(ba){J(ba,m,M)}});return M},suggestLocations:function(d){var b=new D(v._dfdCanceller);d.hasOwnProperty("location")&&this.normalization&&(d.location=d.location.normalize());d.searchExtent&&(d.searchExtent=d.searchExtent.shiftCentralMeridian());d=this._encode(A.mixin({},
this._url.query,{f:"json",text:d.text,maxSuggestions:d.maxSuggestions,searchExtent:d.searchExtent&&g.toJson(d.searchExtent.toJson()),category:d.categories&&d.categories.join(",")||null,countryCode:d.countryCode||null,location:d.location||null,distance:d.distance||null},{f:"json"}));d=c({url:this._url.path+"/suggest",content:d,callbackParamName:"callback"});b._pendingDfd=d;d.then(A.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);b.resolve(a)}),A.hitch(this,function(a){this._errorHandler(a);
b.reject(a)}));return b},addressesToLocations:function(d,b,a){var m=this.outSpatialReference,l=[],n=d.categories,k=d.locationType,x=d.countryCode;F.forEach(d.addresses,function(r,w){l.push({attributes:r})});d=this._encode(A.mixin({},this._url.query,{category:n&&n.join(",")||null,locationType:k||null,sourceCountry:x||null},{addresses:g.toJson({records:l})},{f:"json",outSR:m&&g.toJson(m.toJson())}));var u=this._geocodeAddressesHandler,B=this._errorHandler,h=new D(v._dfdCanceller);h._pendingDfd=c({url:this._url.path+
"/geocodeAddresses",content:d,callbackParamName:"callback",load:function(r,w){u(r,w,b,a,h)},error:function(r){B(r,a,h)}});return h},_reverseGeocodeHandler:function(d,b,a,m,l){try{var n=new e({address:d.address,location:d.location,score:100});this._successHandler([n],"onLocationToAddressComplete",a,l)}catch(k){this._errorHandler(k,m,l)}},locationToAddress:function(d,b,a,m){d&&this.normalization&&(d=d.normalize());var l=this.outSpatialReference;d=this._encode(A.mixin({},this._url.query,{outSR:l&&g.toJson(l.toJson()),
location:d&&g.toJson(d.toJson()),distance:b,f:"json"}));var n=this._reverseGeocodeHandler,k=this._errorHandler,x=new D(v._dfdCanceller);x._pendingDfd=c({url:this._url.path+"/reverseGeocode",content:d,callbackParamName:"callback",load:function(u,B){n(u,B,a,m,x)},error:function(u){k(u,m,x)}});return x},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});f("extend-esri")&&A.setObject("tasks.Locator",
N,t);return N})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(N,A,F,D,g){N=N(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(f){A.mixin(this,f);this.location=new g(this.location)}});F("extend-esri")&&A.setObject("tasks.AddressCandidate",N,D);return N})},"widgets/SmartEditor/Intersection":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/BaseWidgetSetting esri/tasks/query esri/tasks/QueryTask esri/geometry/Extent esri/geometry/geometryEngine esri/SpatialReference esri/geometry/webMercatorUtils dojo/_base/array".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e){return N([D],{baseClass:"jimu-widget-smartEditor-widgets-intersection",layerFieldsObj:{},queriedLayers:[],layersInvolvedInIgnoreLayerRanking:[],maxToleranceForlayer:{},maxToleranceForlayerInPx:{},completeFeatures:{},postCreate:function(){this.startup();this.layerFieldsObj={};this.queriedLayers=[];this.maxToleranceForlayer={};this.maxToleranceForlayerInPx={};this.layersInvolvedInIgnoreLayerRanking=[];this.completeFeatures=[]},startup:function(){},_canGetGeodesicBuffers:function(d){var b=
new v(4326);return d&&q.canProject(d,b)?!0:!1},_getbufferedGeometry:function(d,b){return(d=this._canGetGeodesicBuffers(d)?c.geodesicBuffer([d],[b],"meters",!0):c.buffer([d],[b],"meters",!0))&&0<d.length?d[0]:null},getToleranceValueInMeters:function(d){var b=0;d&&(d.useDefault?(b=this.defaultToleranceSettings.value,d=this.defaultToleranceSettings.unit):(b=d.value,d=d.unit),b=this.convertToMeters(b,d));return b},setMaxToleranceForLayer:function(d,b){var a=this.getToleranceValueInMeters(b);if(b&&"px"===
b.unit&&!b.useDefault){if(b=b.value,!this.maxToleranceForlayerInPx.hasOwnProperty(d)||this.maxToleranceForlayerInPx[d]<b)this.maxToleranceForlayerInPx[d]=b}else 0<a&&(!this.maxToleranceForlayer.hasOwnProperty(d)||this.maxToleranceForlayer[d]<a)?this.maxToleranceForlayer[d]=a:0===a&&(b=this.defaultPixelsTolerance,!this.maxToleranceForlayerInPx.hasOwnProperty(d)||this.maxToleranceForlayerInPx[d]<b)&&(this.maxToleranceForlayerInPx[d]=b)},convertToMeters:function(d,b){var a=d;switch(b){case "meters":a=
d;break;case "feet":a=.3048*d;break;case "kilometers":a=1E3*d;break;case "miles":a=1609.34*d}return a},getDistinctLayers:function(d,b){var a=new F;var m=new F;var l={};this.layerFieldsObj={};this.queriedLayers=[];this.ignoreLayerRanking=!1;this.drawnGeometry=b;if(d.fieldValues){for(var n in d.fieldValues){l[n]=[];for(var k=0;k<d.fieldValues[n].length;k++){var x=d.fieldValues[n][k];if("Intersection"===x.actionName&&x.enabled){x.ignoreLayerRanking&&(this.ignoreLayerRanking=!0);for(var u=0;u<x.fields.length;u++){var B=
x.fields[u];-1===l[n].indexOf(B.layerId)&&l[n].push(B.layerId);-1===this.layersInvolvedInIgnoreLayerRanking.indexOf(B.layerId)&&x.ignoreLayerRanking&&this.layersInvolvedInIgnoreLayerRanking.push(B.layerId);this.setMaxToleranceForLayer(B.layerId,B.toleranceSettings)}}}}this._getIntersectionsForEachField(l,b,m)}else m.resolve({});m.then(A.hitch(this,function(){var h={},r;if(d.fieldValues)for(var w in d.fieldValues){h[w]={};for(var G=0;G<d.fieldValues[w].length;G++){var y=d.fieldValues[w][G];if("Intersection"===
y.actionName&&y.enabled)if(y.ignoreLayerRanking){var J=this._getClosestFeature(y.fields);h[w]=J.attr;for(var M={},ba=0;ba<y.fields.length;ba++){var W=y.fields[ba];M.hasOwnProperty(W.layerId)||(M[W.layerId]=[]);-1===M[W.layerId].indexOf(W.field)&&M[W.layerId].push(W.field)}if(J.intersectingFeatures&&1<J.intersectingFeatures.length){var E=[];e.forEach(J.intersectingFeatures,function(H){for(var P=M[H.layerId],S=0;S<P.length;S++)if(H.attributes&&H.attributes.hasOwnProperty(P[S])){var V=H.attributes[P[S]];
null!==V&&""!==V&&0>E.indexOf(V)&&E.push(V)}});1<E.length&&(r||(r={}),r[w]=E)}}else for(W=0;W<y.fields.length;W++){var O=y.fields[W];ba=O.layerId;if(!h[w].hasOwnProperty(ba)&&(J=this._getProcessedFeature(ba,O.toleranceSettings))&&J.attributes){y=J.attributes;W={};W[O.field]=y[O.field];h[w][ba]=W;J.intersectingFeatures&&1<J.intersectingFeatures.length&&"esriCTUseLayerName"!==O.field&&(E=[],e.forEach(J.intersectingFeatures,function(H){H=H.attributes[O.field];null!==H&&""!==H&&0>E.indexOf(H)&&E.push(H)}),
1<E.length&&(r||(r={}),r[w]=E));break}}}}a.resolve({result:h,multipleValues:r})}));return a.promise},_getIntersectingFeatures:function(d,b){var a;var m=[];var l=0;var n=this._jimuLayerInfos.getLayerOrTableInfoById(d).layerObject;if(this.completeFeatures.hasOwnProperty(d)){var k=this.completeFeatures[d];b&&"px"!==b.unit&&(l=this.getToleranceValueInMeters(b));if(0<k.length&&(l?a=this._getbufferedGeometry(this.drawnGeometry,l):this.maxToleranceForlayer.hasOwnProperty(d)&&this.maxToleranceForlayer[d]||
this.maxToleranceForlayerInPx.hasOwnProperty(d)&&this.maxToleranceForlayerInPx[d]?a="point"===this.drawnGeometry.type?this.maxToleranceForlayerInPx.hasOwnProperty(d)?this.pointToExtent(this.map,this.drawnGeometry,this.maxToleranceForlayerInPx[d]):this.pointToExtent(this.map,this.drawnGeometry,this.defaultPixelsTolerance):this.drawnGeometry:m=k,a))for(d=0;d<k.length;d++)b=k[d],b.geometry&&c.intersects(a,b.geometry)&&(b.attributes.esriCTUseLayerName=n.name,m.push(b))}return m},_getClosestFeature:function(d){var b,
a,m=[];var l={};d=this._resetFieldsWithMapLayerOrder(d);for(b=0;b<d.length;b++){var n=[];var k=d[b].layerId;n=this._getIntersectingFeatures(k,d[b].toleranceSettings);for(a=0;a<n.length;a++)this.drawnGeometry&&n[a].geometry&&(n[a].distanceToLocation=c.distance(this.drawnGeometry,n[a].geometry,"meters")),n[a].layerId=k,n[a].fields?n[a].fields.push(d[b].field):n[a].fields=[d[b].field];m=m.concat(n)}if(0<m.length){m.sort(function(B,h){return B.distanceToLocation<h.distanceToLocation?-1:B.distanceToLocation>
h.distanceToLocation?1:0});var x=m[0].attributes;d=this._jimuLayerInfos.getLayerOrTableInfoById(m[0].layerId).layerObject;x.esriCTUseLayerName=d.name;var u={};e.forEach(m[0].fields,function(B){u[B]=x[B]});l[m[0].layerId]=u}return{attr:l,intersectingFeatures:m}},_resetFieldsWithMapLayerOrder:function(d){var b=[];var a=this._jimuLayerInfos.getLayerInfoArray();e.forEach(a,A.hitch(this,function(m){e.forEach(d,A.hitch(this,function(l){m.id===l.layerId&&b.push(l)}))}));return b},_getProcessedFeature:function(d,
b){var a=[];a=this._getIntersectingFeatures(d,b);if(0<a.length){var m=a[0].attributes;d=this._jimuLayerInfos.getLayerOrTableInfoById(d).layerObject;m.esriCTUseLayerName=d.name}return{attributes:m,intersectingFeatures:a}},_getIntersectionsForEachField:function(d,b,a){var m=Object.keys(d);var l=0;this.maxToleranceForlayer&&(l=Object.keys(this.maxToleranceForlayer).length);if(0<m.length){var n=m[0];(this.ignoreLayerRanking||0<l?this._asyncIntersectionRequests(d[n],b):this._syncIntersectionRequests(d[n],
b)).then(A.hitch(this,function(){this.ignoreLayerRanking||0<l?d[n]&&0===d[n].length&&delete d[n]:delete d[n];this._getIntersectionsForEachField(d,b,a)}))}else a.resolve()},_filterQueriedLayers:function(d){for(var b in this.layerFieldsObj){var a=d.indexOf(b);-1<a&&d.splice(a,1)}return d},_asyncIntersectionRequests:function(d,b,a){a||(a=new F);d=this._filterQueriedLayers(d);0<d.length?this._getIntersectedFeatures(d[0],b).then(A.hitch(this,function(m){d.splice(0,1);0<d.length?(this._asyncIntersectionRequests(d,
b,a),this._intersectionResult(m)):this._intersectionResult(m,a)})):a.resolve();return a.promise},_syncIntersectionRequests:function(d,b,a){a||(a=new F);d=this._filterQueriedLayers(d);0<d.length?this._getIntersectedFeatures(d[0],b).then(A.hitch(this,function(m){0<m.features.length?this._intersectionResult(m,a):(d.splice(0,1),0<d.length?this._syncIntersectionRequests(d,b,a):this._intersectionResult(m,a))})):a.resolve();return a.promise},_intersectionResult:function(d,b){d.layerId&&(this.layerFieldsObj[d.layerId]=
{},d.features&&0<d.features.length&&(this.layerFieldsObj[d.layerId]=d.featuresAttributes));b&&b.resolve()},pointToExtent:function(d,b,a){if(0===a)return b;var m=d.extent.getWidth()/d.width;a*=m;return new t(b.x-a,b.y-a,b.x+a,b.y+a,d.spatialReference)},_getAppropriateGeometryForQuery:function(d,b){if(this.maxToleranceForlayer.hasOwnProperty(d))var a=this._getbufferedGeometry(b,this.maxToleranceForlayer[d]);else a=b,"point"===b.type&&(a=this.maxToleranceForlayerInPx.hasOwnProperty(d)?this.pointToExtent(this.map,
b,this.maxToleranceForlayerInPx[d]):this.pointToExtent(this.map,b,this.defaultPixelsTolerance));return a},_getIntersectedFeatures:function(d,b){var a;var m=new F;if(this._jimuLayerInfos.getLayerOrTableInfoById(d))var l=this._jimuLayerInfos.getLayerOrTableInfoById(d).layerObject;else return m.resolve({layerId:d,features:[],featuresAttributes:{}}),m.promise;var n=l.objectIdField;var k=new g;var x=new f(l.url);k.geometry=this._getAppropriateGeometryForQuery(d,b);k.outFields=["*"];if(l=l.getDefinitionExpression())k.where=
l;-1<this.layersInvolvedInIgnoreLayerRanking.indexOf(d)||this.maxToleranceForlayer.hasOwnProperty(d)||this.maxToleranceForlayerInPx.hasOwnProperty(d)?(k.returnGeometry=!0,k.outSpatialReference=new v(b.spatialReference.toJson())):k.returnGeometry=!1;x.execute(k,A.hitch(this,function(u){u&&u.features&&0<u.features.length?(u.features.sort(function(B,h){B=parseInt(B.attributes[n],10);h=parseInt(h.attributes[n],10);return B>h?-1:1}),a=u.features[0].attributes):(u={features:[]},a={});this.completeFeatures[d]=
u.features;m.resolve({layerId:d,features:u.features,featuresAttributes:a})}),A.hitch(this,function(){this.completeFeatures[d]=[];m.resolve({layerId:d,features:[],featuresAttributes:{}})}));return m.promise}})})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r){N=F("esri.dijit.LocateButton",[c,q,A],{templateString:b,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new h(N.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(w,G){w=D.mixin({},this.options,w);this.domNode=
G;this._i18n=a;G=navigator.geolocation;var y=window.hasOwnProperty("isSecureContext");y=y&&window.isSecureContext||!y&&"https:"===window.location.protocol;y&&G||(w.visible=!1);G||console.log("LocateButton::navigator.geolocation unsupported.");y||console.log("LocateButton::navigator.geolocation requires a secure origin.");this.set("map",w.map);this.set("theme",w.theme);this.set("visible",w.visible);this.set("scale",w.scale);this.set("highlightLocation",w.highlightLocation);this.set("symbol",w.symbol);
this.set("infoTemplate",w.infoTemplate);this.set("geolocationOptions",w.geolocationOptions);this.set("useTracking",w.useTracking);this.set("setScale",w.setScale);this.set("centerAt",w.centerAt);this.set("timeout",w.timeout);this.set("graphicsLayer",w.graphicsLayer);this.set("clearOnTrackingStop",w.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",D.hitch(this,function(){this.get("tracking")&&
!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(e(this._locateNode,v,D.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||(this.set("visible",!1),console.log("LocateButton::map required"));if(this.get("map").loaded)this._init();else e.once(this.get("map"),"load",D.hitch(this,function(){this._init()}))},
destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var w=this.get("highlightGraphic"),G=this.get("graphicsLayer");w&&(G?G.remove(w):this.get("map").graphics.remove(w),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?
this.get("tracking")?n.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):n.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):n.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){m.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();
this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(w){return w?{coords:D.mixin({},w.coords),timestamp:w.timestamp}:{}},_startTracking:function(){m.add(this._locateNode,this._css.tracking);this._removeWatchPosition();var w=navigator.geolocation.watchPosition(D.hitch(this,function(G){G=this._positionToObject(G);this._setPosition(G).then(D.hitch(this,function(y){this._locateEvent(y)}),D.hitch(this,function(y){y||(y=Error("LocateButton::Error setting the position."));
this._locateError(y)}))}),D.hitch(this,function(G){this.set("tracking",!1);G||(G=Error("LocateButton::Could not get tracking position."));this._locateError(G)}),this.get("geolocationOptions"));this.set("watchId",w)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var w=new d;this._removePrivateVars();var G=setTimeout(D.hitch(this,function(){clearTimeout(G);w.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));
navigator.geolocation.getCurrentPosition(D.hitch(this,function(y){y=this._positionToObject(y);clearTimeout(G);this._setPosition(y).then(D.hitch(this,function(J){w.resolve(J)}),D.hitch(this,function(J){J||(J=Error("LocateButton::Error setting map position."));w.reject(J)}))}),D.hitch(this,function(y){y||(y=Error("LocateButton::Could not get current position."));w.reject(y)}),this.get("geolocationOptions"));return w.promise},_locate:function(){var w=new d;this._showLoading();if(navigator.geolocation)this.get("useTracking")?
this.get("tracking")?(this._startTracking(),w.resolve({tracking:!0})):(this._stopTracking(),w.resolve({tracking:!1})):this._getCurrentPosition().then(D.hitch(this,function(y){this._locateEvent(y);w.resolve(y)}),D.hitch(this,function(y){y||(y=Error("LocateButton::Could not get current position."));this._locateError(y);w.reject(y)}));else{var G=Error("LocateButton::geolocation unsupported");this._locateError(G);w.reject(G)}this._setTitle();return w.promise},_projectPoint:function(w){var G=new d,y=this.get("map").spatialReference,
J=y.wkid;y.isWebMercator()?(w=k.geographicToWebMercator(w),G.resolve(w)):t.defaults.geometryService&&4326!==J?(J=new r,J.geometries=[w],J.outSR=y,t.defaults.geometryService.project(J).then(D.hitch(this,function(M){M&&M.length?G.resolve(M[0]):G.reject(Error("LocateButton::Point was not projected."))}),function(M){M||(M=Error("LocateButton::please specify a geometry service on esri/config to project."));G.reject(M)})):G.resolve(w);return G.promise},_getScale:function(w){var G=this.get("scale");return w&&
w.coords?G||w.coords.accuracy||5E4:G||5E4},_createPoint:function(w){var G;w&&w.coords&&(G=new x([w.coords.longitude,w.coords.latitude],new u({wkid:4326})));return G},_setPosition:function(w){var G=new d,y,J;this._removePrivateVars();if((this._position=w)&&w.coords){if(y=this._createPoint(w))this._graphic=J=this._createGraphic(y,w);var M=this._getScale(w);this._scale=M;y?this._projectPoint(y).then(D.hitch(this,function(ba){this._graphic=J=this._createGraphic(ba,w);var W={graphic:J,scale:M,position:w};
this.get("setScale")&&this.get("map").setScale(M);this.get("centerAt")?this.get("map").centerAt(ba).then(D.hitch(this,function(){G.resolve(W)}),D.hitch(this,function(E){E||(E=Error("LocateButton::Could not center map."));G.reject(E)})):G.resolve(W)}),D.hitch(this,function(ba){ba||(ba=Error("LocateButton::Error projecting point."));G.reject(ba)})):(y=Error("LocateButton::Invalid point"),G.reject(y))}else y=Error("LocateButton::Invalid position"),G.reject(y);return G.promise},_createGraphic:function(w,
G){if(w){G={position:G};var y=new B(w,this.get("symbol"),G,this.get("infoTemplate"))}return y},_locateEvent:function(w){if(w.graphic){var G=this.get("highlightGraphic"),y=this.get("graphicsLayer");G?(G.setGeometry(w.graphic.geometry),G.setAttributes(w.graphic.attributes),G.setInfoTemplate(w.graphic.infoTemplate),G.setSymbol(w.graphic.symbol)):(G=w.graphic,this.get("highlightLocation")&&(y?y.add(G):this.get("map").graphics.add(G)));this.set("highlightGraphic",G)}this._hideLoading();this.emit("locate",
w)},_locateError:function(w){w={graphic:this._graphic,scale:this._scale,position:this._position,error:w};this._hideLoading();this.emit("locate",w)},_showLoading:function(){this.get("useTracking")||m.add(this._locateNode,this._css.loading)},_hideLoading:function(){this.get("useTracking")||m.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(w,
G,y){m.remove(this.domNode,G);m.add(this.domNode,y)},_visible:function(){this.get("visible")?l.set(this.domNode,"display","block"):l.set(this.domNode,"display","none")}});g("extend-esri")&&D.setObject("dijit.LocateButton",N,f);return N})},"jimu/dijit/FeatureSetChooserForMultipleLayers":function(){define("dojo/on dojo/sniff dojo/mouse dojo/query dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/FeatureSetChooserForMultipleLayers.html dijit/popup dijit/TooltipDialog jimu/utils jimu/dijit/DrawBox jimu/dijit/_FeatureSetChooserCore jimu/SelectionManager jimu/dijit/FeatureActionPopupMenu".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B){return q([e,d,b,g],{baseClass:"jimu-multiple-layers-featureset-chooser",declaredClass:"jimu.dijit.FeatureSetChooserForMultipleLayers",templateString:a,drawBox:null,_instances:null,_tooltipDialogTimeoutId1:-1,_tooltipDialogClientX1:-1,_tooltipDialogTimeoutId2:-1,_tooltipDialogClientX2:-1,_tooltipTimeout:1E3,_currentGeoTypeInfo:null,_geoTypeInfos:null,map:null,updateSelection:!1,fullyWithin:!1,geoTypes:null,actions:null,postMixInProperties:function(){this.inherited(arguments);
this.nls=window.jimuNls.featureSetChooser;var h="POINT EXTENT POLYGON CIRCLE POLYLINE FREEHAND_POLYGON".split(" ");this.geoTypes&&0<this.geoTypes.length&&(this.geoTypes=c.filter(this.geoTypes,t.hitch(this,function(r){return 0<=h.indexOf(r)})));this.geoTypes&&0!==this.geoTypes.length||(this.geoTypes=["EXTENT"])},postCreate:function(){this.inherited(arguments);this._instances=[];this.popupMenu=B.getInstance();D(".select-text",this.domNode)[0].innerHTML=this.nls.select;D(".clear-text",this.domNode)[0].innerHTML=
window.jimuNls.common.clear;this._initTooltipDialogs();this._initDrawBox();this._geoTypeInfos=[];this.actions=[];0===this.geoTypes.length&&this.geoTypes.push("EXTENT");1===this.geoTypes.length?f.addClass(this.domNode,"single-geotype"):f.addClass(this.domNode,"multiple-geotypes");var h={POINT:["icon-select-by-point",this.nls.selectByPoint,this.drawBox.pointIcon],EXTENT:["icon-select-by-rect",this.nls.selectByRectangle,this.drawBox.extentIcon],POLYGON:["icon-select-by-polygon",this.nls.selectByPolygon,
this.drawBox.polygonIcon],CIRCLE:["icon-select-by-circle",this.nls.selectByCircle,this.drawBox.circleIcon],POLYLINE:["icon-select-by-line",this.nls.selectByLine,this.drawBox.polylineIcon],FREEHAND_POLYGON:["icon-select-by-freehand-polygon",this.nls.selectByFreehandPolygon,this.drawBox.freehandPolygonIcon]},r=-1;c.forEach("POINT EXTENT POLYGON CIRCLE POLYLINE FREEHAND_POLYGON".split(" "),t.hitch(this,function(w){var G=h[w];if(0<=this.geoTypes.indexOf(w)){var y={geoType:w,action:{iconClass:G[0],label:G[1],
data:{}},dom:G[2]};G={iconClass:G[0],label:G[1],data:{},onExecute:t.hitch(this,this._onDrawItemClicked,y)};this._geoTypeInfos.push(y);this.actions.push(G);"EXTENT"===w&&(r=this._geoTypeInfos.length-1)}}));this.own(N(this.btnSelect,"click",t.hitch(this,function(){n.simulateClickEvent(this._currentGeoTypeInfo.dom);this._hideDrawItems()})));0<=r?(this._setCurrentGeoInfo(this._geoTypeInfos[r]),f.addClass(this.geoTypeIcon,"icon-select-by-rect")):(this._setCurrentGeoInfo(this._geoTypeInfos[0]),f.addClass(this.geoTypeIcon,
this._geoTypeInfos[0].action.iconClass));this.deactivate()},_initTooltipDialogs:function(){var h=A("mac")?"\u2318":"Ctrl",r="- "+this.nls.newSelectionTip+" ("+this.nls.dragMouse+")",w="- "+this.nls.addSelectionTip+" (Shift+"+this.nls.dragBox+")",G="- "+this.nls.removeSelectionTip+" ("+h+"+"+this.nls.dragBox+")",y="- "+this.nls.newSelectionTip+" ("+this.nls.drawShap+")",J="- "+this.nls.addSelectionTip+" (Shift+"+this.nls.darw+")",M="- "+this.nls.removeSelectionTip+" ("+h+"+"+this.nls.darw+")";h=f.create("div",
{innerHTML:'\x3cdiv class\x3d"title"\x3e\x3c/div\x3e\x3cdiv class\x3d"item new-selection-item"\x3e\x3c/div\x3e\x3cdiv class\x3d"item add-selection-item"\x3e\x3c/div\x3e\x3cdiv class\x3d"item remove-selection-item"\x3e\x3c/div\x3e',"class":"dialog-content"});var ba=D(".title",h)[0],W=D(".new-selection-item",h)[0],E=D(".add-selection-item",h)[0],O=D(".remove-selection-item",h)[0];this.tooltipDialog1=new l({content:h});f.addClass(this.tooltipDialog1.domNode,"jimu-multiple-layers-featureset-chooser-tooltipdialog");
this.own(N(this.btnSelect,"mousemove",t.hitch(this,function(H){this._tooltipDialogClientX1=H.clientX})));this.own(N(this.btnSelect,F.enter,t.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId1);this._tooltipDialogTimeoutId1=-1;this._tooltipDialogTimeoutId1=setTimeout(t.hitch(this,function(){if(this.tooltipDialog1){var H=this._currentGeoTypeInfo.geoType;"EXTENT"===H?(W.innerHTML=r,E.innerHTML=w,O.innerHTML=G,ba.innerHTML=this.nls.selectByRectangle):(W.innerHTML=y,E.innerHTML=J,O.innerHTML=
M,"POLYGON"===H?ba.innerHTML=this.nls.selectByPolygon:"CIRCLE"===H?ba.innerHTML=this.nls.selectByCircle:"POLYLINE"===H?ba.innerHTML=this.nls.selectByLine:"FREEHAND_POLYGON"===H?ba.innerHTML=this.nls.selectByFreehandPolygon:"POINT"===H&&(ba.innerHTML=this.nls.selectByPoint));m.open({parent:this.getParent(),popup:this.tooltipDialog1,around:this.btnSelect,position:["below"]});0<=this._tooltipDialogClientX1&&(this.tooltipDialog1.domNode.parentNode.style.left=this._tooltipDialogClientX1+"px")}}),this._tooltipTimeout)})));
this.own(N(this.btnSelect,F.leave,t.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId1);this._tooltipDialogTimeoutId1=-1;this._hideTooltipDialog(this.tooltipDialog1)})));h=f.create("div",{innerHTML:this.nls.unselectAllSelectionTip,"class":"dialog-content"});this.tooltipDialog2=new l({content:h});f.addClass(this.tooltipDialog2.domNode,"jimu-multiple-layers-featureset-chooser-tooltipdialog");this.own(N(this.btnClear,"mousemove",t.hitch(this,function(H){this._tooltipDialogClientX2=H.clientX})));
this.own(N(this.btnClear,F.enter,t.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId2);this._tooltipDialogTimeoutId2=-1;this._tooltipDialogTimeoutId2=setTimeout(t.hitch(this,function(){this.tooltipDialog2&&(m.open({parent:this.getParent(),popup:this.tooltipDialog2,around:this.btnClear,position:["below"]}),0<=this._tooltipDialogClientX2&&(this.tooltipDialog2.domNode.parentNode.style.left=this._tooltipDialogClientX2+"px"))}),this._tooltipTimeout)})));this.own(N(this.btnClear,F.leave,t.hitch(this,
function(){clearTimeout(this._tooltipDialogTimeoutId2);this._tooltipDialogTimeoutId2=-1;this._hideTooltipDialog(this.tooltipDialog2)})))},_onArrowClicked:function(h){h.stopPropagation();h=f.position(h.target);this._showDrawItems(h)},_setCurrentGeoInfo:function(h){var r=this._currentGeoTypeInfo&&this._currentGeoTypeInfo.geoType;this._currentGeoTypeInfo&&f.removeClass(this.currentDrawItem,this._currentGeoTypeInfo.geoType);this._currentGeoTypeInfo=h;f.addClass(this.currentDrawItem,this._currentGeoTypeInfo.geoType);
this.isActive()?r!==this._currentGeoTypeInfo.geoType&&n.simulateClickEvent(this._currentGeoTypeInfo.dom):n.simulateClickEvent(this._currentGeoTypeInfo.dom)},_showDrawItems:function(h){this.popupMenu.setActions(this.actions);this.popupMenu.markAsSelected(this._currentGeoTypeInfo.action);this.popupMenu.show(h)},_hideDrawItems:function(){this.popupMenu.hide()},_onDrawItemClicked:function(h){this._hideDrawItems();this._setCurrentGeoInfo(h);f.removeClass(this.geoTypeIcon,"icon-select-by-point icon-select-by-circle icon-select-by-rect icon-select-by-polygon icon-select-by-line icon-select-by-freehand-polygon".split(" "));
switch(h.geoType){case "POLYGON":f.addClass(this.geoTypeIcon,"icon-select-by-polygon");break;case "CIRCLE":f.addClass(this.geoTypeIcon,"icon-select-by-circle");break;case "POLYLINE":f.addClass(this.geoTypeIcon,"icon-select-by-line");break;case "FREEHAND_POLYGON":f.addClass(this.geoTypeIcon,"icon-select-by-freehand-polygon");break;case "POINT":f.addClass(this.geoTypeIcon,"icon-select-by-point");break;default:f.addClass(this.geoTypeIcon,"icon-select-by-rect")}},_initDrawBox:function(){this.drawBox=
new k({map:this.map,showClear:!0,keepOneGraphic:!0,deactivateAfterDrawing:!1,geoTypes:this.geoTypes});this.own(N(this.drawBox,"user-clear",t.hitch(this,this._onDrawBoxUserClear)));this.own(N(this.drawBox,"draw-end",t.hitch(this,this._onDrawEnd)));this.own(N(this.drawBox,"draw-activate",t.hitch(this,function(){this.map.infoWindow.hide();f.addClass(this.currentDrawItem,"pressed");f.addClass(this.btnSelect,"selected")})));this.own(N(this.drawBox,"draw-deactivate",t.hitch(this,function(){f.removeClass(this.currentDrawItem,
"pressed");f.removeClass(this.btnSelect,"selected")})));this.own(N(this.btnClear,"click",t.hitch(this,function(){n.simulateClickEvent(this.drawBox.btnClear)})))},disable:function(){this.drawBox.disable();f.addClass(this.domNode,"disabled")},enable:function(){this.drawBox.enable();f.removeClass(this.domNode,"disabled")},isActive:function(){return this.drawBox.isActive()},activate:function(){if(!this.isActive()){var h=this._currentGeoTypeInfo;h||(h=this._geoTypeInfos[0]);this._setCurrentGeoInfo(h)}},
deactivate:function(){this.drawBox.deactivate()},setFeatureLayers:function(h){var r=c.filter(this._instances,t.hitch(this,function(G){return 0>h.indexOf(G.featureLayer)}));c.forEach(r,t.hitch(this,function(G){this._removeInstance(G)}));var w=c.map(this._instances,t.hitch(this,function(G){return G.featureLayer}));c.forEach(h,t.hitch(this,function(G){0>w.indexOf(G)&&this.addFeatureLayer(G)}))},addFeatureLayer:function(h){"esri.layers.FeatureLayer"!==h.declaredClass||this._findInstanceByLayer(h)||(h=
new x({map:this.map,featureLayer:h,drawBox:this.drawBox,updateSelection:this.updateSelection,fullyWithin:this.fullyWithin}),this._instances.push(h))},removeFeatureLayer:function(h){"esri.layers.FeatureLayer"===h.declaredClass&&(h=this._findInstanceByLayer(h))&&this._removeInstance(h)},setDisplayLayerVisibility:function(h,r){(h=u.getInstance().getDisplayLayer(h.id))&&(r?h.show():h.hide())},_removeInstance:function(h){if(h){var r=this._instances.indexOf(h);0<=r&&(h.destroy(),this._instances.splice(r,
1))}},_findInstanceByLayer:function(h){var r=null;c.some(this._instances,t.hitch(this,function(w){return w.featureLayer===h?(r=w,!0):!1}));return r},clear:function(h){c.forEach(this._instances,t.hitch(this,function(r){r.clear(h)}))},destroy:function(){this._hideTooltipDialog(this.tooltipDialog1);this._hideTooltipDialog(this.tooltipDialog2);c.forEach(this._instances,t.hitch(this,function(h){h.destroy()}));this._instances=[];this.drawBox&&this.drawBox.destroy();this.drawBox=null;this.inherited(arguments)},
_hideTooltipDialog:function(h){h&&m.close(h)},_onDrawBoxUserClear:function(){this.clear(!0);this.emit("user-clear")},_onDrawEnd:function(h,r,w,G,y,J){this.drawBox.clear();0<this._instances.length&&setTimeout(t.hitch(this,function(){if(0<this._instances.length){this.emit("loading");this.disable();var M=c.map(this._instances,t.hitch(this,function(ba){return ba.getFeatures()}));v(M).always(t.hitch(this,function(){this.enable();this._currentGeoTypeInfo&&n.simulateClickEvent(this._currentGeoTypeInfo.dom);
this.emit("unloading",h,r,w,G,y,J)}))}}),50)}})})},"jimu/dijit/_FeatureSetChooserCore":function(){define("dojo/on dojo/sniff dojo/Evented dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/declare jimu/utils jimu/symbolUtils jimu/SelectionManager jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/symbols/jsonUtils esri/geometry/geometryEngine".split(" "),function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n){return t([F],{baseClass:"jimu-featureset-chooser-core",
_middleFeatureLayer:null,_isLoading:!1,_def:null,_isDestroyed:!1,_handles:null,selectionManager:null,layerInfosObj:null,layerInfo:null,map:null,featureLayer:null,drawBox:null,updateSelection:!1,fullyWithin:!1,constructor:function(k){g.mixin(this,k);this.layerInfosObj=e.getInstanceSync();this.selectionManager=q.getInstance();this.featureLayer.getSelectionSymbol()||this.selectionManager.setSelectionSymbol(this.featureLayer);k=c.getFeatureLayerDefinition(this.featureLayer);delete k.id;this._middleFeatureLayer=
new m({layerDefinition:k,featureSet:null},{id:"featureLayer_"+c.getRandomString()});k=null;var x=this._middleFeatureLayer.geometryType;"esriGeometryPoint"===x?k=v.getDefaultMarkerSymbol():"esriGeometryPolyline"===x?k=v.getDefaultLineSymbol():"esriGeometryPolygon"===x&&(k=l.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}));this._middleFeatureLayer.setSelectionSymbol(k);k=N(this.drawBox,"user-clear",g.hitch(this,
this._onDrawBoxUserClear));x=N(this.drawBox,"draw-end",g.hitch(this,this._onDrawEnd));this._handles=[k,x];if(this.layerInfo=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))k=N(this.layerInfo,"filterChanged",g.hitch(this,this._handleFilterChange)),this._handles.push(k)},hideMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.hide();var k=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);k&&k.hide()}},showMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.show();
var k=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);k&&k.show()}},clear:function(k){this.drawBox.clear();this._clearMiddleFeatureLayer();k&&this.selectionManager.clearSelection(this.featureLayer)},getFeatures:function(){var k=new D,x=g.hitch(this,function(){var B=this.syncGetFeatures();k.resolve(B)}),u=g.hitch(this,function(B){k.reject(B)});1===this._getDeferredStatus(this._def)?this._def.then(x,u):x();return k},syncGetFeatures:function(){return(this.updateSelection?this.featureLayer:
this._middleFeatureLayer).getSelectedFeatures()},isLoading:function(){return 1===this._getDeferredStatus(this._def)},_onLoading:function(){this.drawBox.deactivate();this.emit("loading")},_onUnloading:function(){this.emit("unloading")},_getDeferredStatus:function(k){var x=0;return x=k?k.isResolved()?2:k.isRejected()?-1:1:0},_onDrawEnd:function(k,x,u,B,h,r){if(this.isLoading())throw"should not draw when loading";if(this.featureLayer.visible){var w=new D;this._def=w;var G=m.SELECTION_NEW;B&&(G=m.SELECTION_ADD);
A("mac")?r&&(G=m.SELECTION_SUBTRACT):h&&(G=m.SELECTION_SUBTRACT);this.emit("loading");this._getFeaturesByGeometry(k.geometry).then(g.hitch(this,function(y){this.selectionManager.updateSelectionByFeatures(this.updateSelection?this.featureLayer:this._middleFeatureLayer,y,G);this._onUnloading();w.resolve(y)}),g.hitch(this,function(y){console.error(y);this._onUnloading();w.reject(y)}))}},_addTolerance:function(k){var x=2.54*this.map.getScale()/9600;return n.buffer(k,10*x,"meters")},_getFeaturesByGeometry:function(k){"point"!==
k.type&&"polyline"!==k.type||"esriGeometryPoint"!==this.featureLayer.geometryType||(k=this._addTolerance(k));var x=new D,u=[];if(this.featureLayer.getMap()&&this.featureLayer.mode!==m.MODE_SELECTION)k=this.selectionManager.getClientFeaturesByGeometry(this.featureLayer,k,this.fullyWithin),0<k.length&&(u=f.map(k,g.hitch(this,function(h){return new d(h.toJson())}))),x.resolve(u);else{u=new b;u.geometry=k;u.outSpatialReference=this.map.spatialReference;u.returnGeometry=!0;u.spatialRelationship=this.fullyWithin?
b.SPATIAL_REL_CONTAINS:b.SPATIAL_REL_INTERSECTS;(k=this.featureLayer.getDefinitionExpression())||(k="1\x3d1");if(this.layerInfo){var B=this.layerInfo.getFilter();B&&(k="("+k+") AND ("+B+")")}k&&(u.where=k);u.outFields=["*"];(new a(this.featureLayer.url)).execute(u).then(g.hitch(this,function(h){x.resolve(h.features)}),g.hitch(this,function(h){x.reject(h)}))}return x},_onDrawBoxUserClear:function(){this.clear()},_clearMiddleFeatureLayer:function(){this._middleFeatureLayer&&(this._middleFeatureLayer.clear(),
this.selectionManager.clearSelection(this._middleFeatureLayer))},_handleFilterChange:function(){var k=this.layerInfo.getFilter()||"1\x3d1",x=this.featureLayer.getSelectedFeatures(),u=this.featureLayer.objectIdField;if(x&&0<x.length){var B=f.map(x,function(r){return r.attributes[u]}),h=new b;h.where=u+" in ("+B.join(",")+") AND "+k;(new a(this.featureLayer.url)).executeForIds(h).then(g.hitch(this,function(r){f.forEach(x,function(w){0<=r.indexOf(w.attributes[u])?w.show():w.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.featureLayer)&&
this.selectionManager._updateDisplayLayer(this.featureLayer,x,m.SELECTION_NEW);this.featureLayer.emit("selection-complete",{features:this.featureLayer.getSelectedFeatures()})}),g.hitch(this,function(r){console.error(r)}))}},destroy:function(){this._isDestroyed||(f.forEach(this._handles,g.hitch(this,function(k){k.remove()})),this._handles=null,this.clear());this._isDestroyed=!0}})})},"widgets/SmartEditor/copy-features":function(){define("dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/keys jimu/dijit/CheckBox dojo/dom-class dojo/dom-attr ./highlightSymbolUtils esri/layers/GraphicsLayer dojo/text!./copy-features.html jimu/dijit/Message esri/tasks/query esri/tasks/QueryTask dojo/Deferred dojo/promise/all jimu/dijit/LoadingIndicator".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B){return F([N,D,A],{templateString:m,layerLabel:null,featuresList:null,checkBoxNodes:{},layerCheckBoxNodes:{},featuresByLayerId:{},featureTitlesByLayerId:{},highlightGraphicsLayer:null,allChildCheckboxes:[],loading:null,startup:function(){this.inherited(arguments);this.highlightGraphicsLayer=this._createNewGraphicsLayer("highlightGraphicsLayer");this.loading=new B({hidden:!0});this.loading.placeAt(this.domNode)},postCreate:function(){this.checkBoxNodes=
{};this.layerCheckBoxNodes={};this.featuresByLayerId={};this.featureTitlesByLayerId={};this.highlightGraphicsLayer=null;this.own(c(this.cancelBtn,"click",g.hitch(this,function(){this.cancelBtnClicked()})));this.own(c(this.cancelBtn,"keydown",g.hitch(this,function(h){h.keyCode!==v.ENTER&&h.keyCode!==v.SPACE||this.cancelBtnClicked()})));this.own(c(this.createMultipleFeaturesBtn,"click",g.hitch(this,this._createMultipleFeaturesBtnClicked)));this.own(c(this.createMultipleFeaturesBtn,"keydown",g.hitch(this,
function(h){h.keyCode!==v.ENTER&&h.keyCode!==v.SPACE||this._createMultipleFeaturesBtnClicked()})));this.own(c(this.createSingleFeatureBtn,"click",g.hitch(this,this._createSingleFeatureBtnClicked)));this.own(c(this.createSingleFeatureBtn,"keydown",g.hitch(this,function(h){h.keyCode!==v.ENTER&&h.keyCode!==v.SPACE||this._createSingleFeatureBtnClicked()})))},selectFeaturesToCopy:function(h){this.allChildCheckboxes=[];if(h&&0<h.length){this.checkBoxNodes={};this.layerCheckBoxNodes={};this.featuresByLayerId=
{};this.featureTitlesByLayerId={};this._changeWarningNote(h[0]._layer.geometryType);this._showHideSingleFeatureButton(h[0]._layer.geometryType);this._showHideMultipleFeatureButton(h[0]._layer.geometryType);e.remove(this.mainNode,"esriCTHidden");var r=new x;this._processSelectedFeatures(h,r).then(g.hitch(this,function(){t.empty(this.layerListTable);for(var w in this.featureTitlesByLayerId){var G=this.layerInfosObj.getLayerInfoById(w);G=G.title?G.title:G.name;var y=t.create("div",{},this.layerListTable);
this.layerCheckBoxNodes[w]=this._createListNode(G,y,!1,w,h[0]._layer.geometryType);this.checkBoxNodes[w]||(this.checkBoxNodes[w]=[]);0<this.featureTitlesByLayerId[w].length&&this._createFeatureEntries(w,y,h[0]._layer.geometryType)}this._highlightFeatures()}))}},_processSelectedFeatures:function(h,r){var w={},G,y;this.featuresByLayerId={};this.featureTitlesByLayerId={};f.forEach(h,g.hitch(this,function(J){this.featuresByLayerId[J._layer.id]||(this.featuresByLayerId[J._layer.id]=[],this.featureTitlesByLayerId[J._layer.id]=
[]);this.featuresByLayerId[J._layer.id].push(J);var M=this.layerInfosObj.getLayerInfoById(J._layer.id).layerObject.objectIdField;M=J.getTitle()?J.getTitle():J.attributes[M];this.featureTitlesByLayerId[J._layer.id].push(M)}));this.loading.show();for(y in this.featuresByLayerId)y&&(h=this._getObjectIdFieldOfLayer(y),h=this._getSelectedFeatureObjectIds(this.featuresByLayerId[y],h),w[y]=this._getSelectedFeatureGeometry(y,h));u(w).then(g.hitch(this,function(J){for(G in J)G&&this._updateGeometryForSelectedFeature(G,
J);this.loading.hide()}),g.hitch(this,function(){this.loading.hide();l({message:this.nls.copyFeatures.copyFeatureUpdateGeometryError})}));return r.resolve(null)},_getObjectIdFieldOfLayer:function(h){return this.layerInfosObj.getLayerInfoById(h).layerObject.objectIdField},_updateGeometryForSelectedFeature:function(h,r){var w=this._getObjectIdFieldOfLayer(h);f.forEach(this.featuresByLayerId[h],g.hitch(this,function(G){f.forEach(r[h].features,g.hitch(this,function(y){y.attributes[w]===G.attributes[w]&&
(G.geometry=y.geometry)}))}))},_getSelectedFeatureObjectIds:function(h,r){var w=[];f.forEach(h,g.hitch(this,function(G){w.push(G.attributes[r])}));return w},_getSelectedFeatureGeometry:function(h,r){var w=this.layerInfosObj.getLayerInfoById(h);h=new k(w.getUrl());var G=new n;G.outFields=[w.layerObject.objectIdField];G.objectIds=r;G.returnGeometry=!0;G.outSpatialReference=this.map.spatialReference;return(null===w.layerObject.url||""===w.layerObject.url?w.layerObject.queryFeatures(G):h.execute(G)).promise},
_createFeatureEntries:function(h,r,w){f.forEach(this.featureTitlesByLayerId[h],g.hitch(this,function(G){G=this._createListNode(G,r,!0,h,w);this.checkBoxNodes[h].push(G);this.allChildCheckboxes.push(G)}))},_createListNode:function(h,r,w,G,y){r=t.create("div",{"class":"jimu-widget-row esriCTCopyFeaturesNode"},r);var J=t.create("div",{"class":"jimu-float-leading checkBoxNode"},r);y="esriGeometryPoint"===y&&this.hideMultipleFeatureButton?!1:!0;h=new q({label:h,checked:y},J);w?(e.add(r,"esriCTCopyFeaturesChildNode"),
d.set(h.domNode,"parentLayerId",G),c(h.domNode,"click",g.hitch(this,this._childNodeStateChanged))):(d.set(h.domNode,"layerId",G),y||h.setStatus(!1),c(h.domNode,"click",g.hitch(this,this._parentNodeStateChanged)));return h},_parentNodeStateChanged:function(h){var r=d.get(h.currentTarget,"layerId");h=this.layerCheckBoxNodes[r];if(h.getStatus()){r=this.checkBoxNodes[r];var w=h.getValue();f.forEach(r,g.hitch(this,function(G){w?G.setValue(!0):G.setValue(!1)}));this._highlightFeatures()}},_childNodeStateChanged:function(h){var r=
d.get(h.currentTarget,"parentLayerId"),w=this.layerCheckBoxNodes[r];r=this.checkBoxNodes[r];var G=!0;w.getStatus()||f.forEach(this.allChildCheckboxes,g.hitch(this,function(y){y.getValue()&&y.domNode!==h.currentTarget&&y.setValue(!1)}));this._highlightFeatures();f.some(r,g.hitch(this,function(y){if(!y.getValue())return G=!1,!0}));w.setValue(G)},cancelBtnClicked:function(){e.add(this.mainNode,"esriCTHidden");this.highlightGraphicsLayer.clear();this.emit("cancelBtnClicked")},_createMultipleFeaturesBtnClicked:function(){var h=
[],r;(r=this._getSelectedFeaturesForCopy())&&0<r.length&&(f.forEach(r,g.hitch(this,function(w){w&&w.geometry&&h.push(w)})),this.emit("createMultipleFeatures",h))},_createSingleFeatureBtnClicked:function(){var h;(h=this._getSelectedFeaturesForCopy())&&0<h.length&&this.emit("createSingleFeature",h)},_validateSelectedFeature:function(h){(!h||0>=h.length)&&l({message:this.nls.copyFeatures.selectFeatureToCopyMessage})},_getSelectedFeaturesForCopy:function(){var h,r=[];for(h in this.featuresByLayerId){var w=
this._getSelectedFeaturesByLayerId(h);0<w.length&&(r=r.concat(w))}this._validateSelectedFeature(r);return r},_getSelectedFeaturesByLayerId:function(h){var r=[];f.forEach(this.checkBoxNodes[h],g.hitch(this,function(w,G){w.getValue()&&r.push(this.featuresByLayerId[h][G])}));return r},_showHideSingleFeatureButton:function(h){"esriGeometryPoint"===h?e.add(this.createSingleFeatureBtn,"esriCTHidden"):e.remove(this.createSingleFeatureBtn,"esriCTHidden")},_showHideMultipleFeatureButton:function(h){"esriGeometryPoint"!==
h&&this.hideMultipleFeatureButton?e.add(this.createMultipleFeaturesBtn,"esriCTHidden"):e.remove(this.createMultipleFeaturesBtn,"esriCTHidden")},_createNewGraphicsLayer:function(h){var r={};if(h+=this.widgetId)this.map._layers[h]&&this.map.removeLayer(this.map._layers[h]),r={id:h};h=new a(r);this.map.addLayer(h);return h},_highlightFeatures:function(){this.highlightGraphicsLayer.clear();for(var h in this.featureTitlesByLayerId)this._highlightSingleLayerFeatures(h)},_highlightSingleLayerFeatures:function(h){var r=
this.map.getLayer(h);h=this._getSelectedFeaturesByLayerId(h);f.forEach(h,g.hitch(this,function(w){w=b.getHighLightSymbol(w,r);this.highlightGraphicsLayer.add(w)}))},_changeWarningNote:function(h){h="esriGeometryPoint"===h&&this.hideMultipleFeatureButton?this.nls.copyFeatures.canNotSaveMultipleFeatureWarning:"esriGeometryPoint"!==h&&this.hideMultipleFeatureButton?this.nls.copyFeatures.createOnlyOneMultipartFeatureWarning:this.nls.copyFeatures.multipleFeatureSaveWarning;d.set(this.warningMessage,"innerHTML",
h);d.set(this.warningMessage,"aria-label",h)}})})},"widgets/SmartEditor/highlightSymbolUtils":function(){define("dojo/_base/lang dojo/_base/array esri/geometry/Point esri/geometry/Polygon esri/geometry/Polyline esri/graphic esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color".split(" "),function(N,A,F,D,g,f,t,c,v,q){var e={getHighLightSymbol:function(d,b){switch(d.geometry.type){case "point":return e._getPointSymbol(d,b);case "polyline":return e._getPolyLineSymbol(d,
b);case "polygon":return e._getPolygonSymbol(d,b)}},_getSizeInfo:function(d){var b=null;d.renderer.visualVariables&&A.forEach(d.renderer.visualVariables,N.hitch(this,function(a){"sizeInfo"===a.type&&(b=a)}));return b},_getPointSymbol:function(d,b){var a,m;var l=!1;var n=new t(t.STYLE_SQUARE,null,new c(c.STYLE_SOLID,new q([0,255,255,1]),3));n.setColor(null);n.size=30;if(b&&b.renderer)if(b.renderer.symbol)l=!0,n=e._updatePointSymbolProperties(n,b.renderer.symbol);else if(b.renderer.infos&&0<b.renderer.infos.length){for(m=
0;m<b.renderer.infos.length;m++){b.typeIdField?a=d.attributes[b.typeIdField]:b.renderer.attributeField&&(a=d.attributes[b.renderer.attributeField]);var k=b.renderer.infos[m].value;void 0!==a&&null!==a&&""!==a&&void 0!==k&&null!==k&&""!==k&&a.toString()===k.toString()&&(l=!0,n=e._updatePointSymbolProperties(n,b.renderer.infos[m].symbol))}!l&&b.renderer.defaultSymbol&&(l=!0,n=e._updatePointSymbolProperties(n,b.renderer.defaultSymbol))}b&&b.graphics&&0<b.graphics.length&&b._getSymbol(d)&&((a=d.getShape())&&
a.shape?a.shape.hasOwnProperty("r")?(l=!0,n.size=2*a.shape.r+10):a.shape.hasOwnProperty("width")&&(l=!0,b.renderer&&b.renderer.infos&&0<b.renderer.infos.length&&(n=e._updatePointSymbolProperties(n,b.renderer.infos[0].symbol)),n.size=a.shape.width+10):b.renderer.visualVariables&&(l=b._getRenderer(d),a=e._getSizeInfo(b))&&(b=l.getSize(d,{sizeInfo:a,shape:b._getSymbol(d),resolution:b&&b.getResolutionInMeters&&b.getResolutionInMeters()}),null!==b&&(n.size=b+10)));b=new F(d.geometry.x,d.geometry.y,d.geometry.spatialReference);
return new f(b,n,d.attributes)},_updatePointSymbolProperties:function(d,b){if(b.hasOwnProperty("height")&&b.hasOwnProperty("width")){var a=b.height;var m=b.width;a=(a>m?a:m)+10;d.size=a}b.hasOwnProperty("size")&&(!a||a<b.size)&&(d.size=b.size+10);b.hasOwnProperty("xoffset")&&(d.xoffset=b.xoffset);b.hasOwnProperty("yoffset")&&(d.yoffset=b.yoffset);return d},_getPolyLineSymbol:function(d,b){var a,m;var l=5;if(b&&b.renderer)if(b.renderer.symbol&&b.renderer.symbol.hasOwnProperty("width"))l=b.renderer.symbol.width;
else if(b.renderer.infos&&0<b.renderer.infos.length)for(m=0;m<b.renderer.infos.length;m++){b.typeIdField?a=d.attributes[b.typeIdField]:b.renderer.attributeField&&(a=d.attributes[b.renderer.attributeField]);var n=b.renderer.infos[m].value;void 0!==a&&null!==a&&""!==a&&void 0!==n&&null!==n&&""!==n&&a.toString()===n.toString()&&b.renderer.infos[m].symbol.hasOwnProperty("width")&&(l=b.renderer.infos[m].symbol.width)}else b.renderer.defaultSymbol&&b.renderer.defaultSymbol.hasOwnProperty("width")&&(l=b.renderer.defaultSymbol.width);
b=new c(c.STYLE_SOLID,new q([0,255,255,1]),l);var k=new g(d.geometry.spatialReference);d.geometry.paths&&0<d.geometry.paths.length&&A.forEach(d.geometry.paths,function(x){k.addPath(x)});return new f(k,b,d.attributes)},_getPolygonSymbol:function(d){var b=new v(v.STYLE_SOLID,new c(c.STYLE_SOLID,new q([0,255,255,1]),4),new q([0,0,0,0]));var a=new D(d.geometry.spatialReference);d.geometry.rings&&(a.rings=N.clone(d.geometry.rings));return new f(a,b,d.attributes)}};return e})},"widgets/SmartEditor/ValuePicker":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/text!./ValuePicker.html dijit/_TemplatedMixin jimu/BaseWidgetSetting jimu/dijit/Popup jimu/dijit/formSelect jimu/utils".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d){return N([v,A,c],{baseClass:"jimu-widget-smartEditor-multiple-value-picker",templateString:t,allFields:{},isOpen:!0,postCreate:function(){this.inherited(arguments);this.allFields={};this._initControls();this.showDialog()},_isFieldDisabled:function(b){return this.disabledFields&&0!==this.disabledFields.length&&this.disabledFields&&-1<this.disabledFields.indexOf(b)?!0:!1},_initControls:function(){if(this.showForField)f.add(this.valuePickerHint,"esriCTHidden"),this.addField(this.showForField);
else if(this.multipleValues)for(var b in this.multipleValues)this._isFieldDisabled(b)||this.addField(b)},addField:function(b){var a=this.multipleValues[b],m=g.create("div",{class:"esriCTFieldContainer"},this.fieldsContainer);g.create("div",{innerHTML:this.fieldLabels[b],class:"esriCTFieldName"},m);a=this._getFieldsOptionsObj(b,a);this.allFields[b]=new e({style:{width:"270px"},options:a,"aria-label":this.fieldLabels[b]},g.create("div",{},m))},showDialog:function(){this.isOpen=!0;this.fieldsPopup=new q({titleLabel:this.nls.valuePicker.popupTitle,
width:310,maxHeight:500,autoHeight:!0,content:this,class:this.baseClass,buttons:[{label:this.nls.ok,onClick:F.hitch(this,function(){var b={};if(this.showForField)b[this.showForField]=this.allFields[this.showForField].get("value");else for(var a in this.allFields)b[a]=this.allFields[a].get("value");this.emit("value-selected",b);this.fieldsPopup.close()})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:F.hitch(this,function(){this.isOpen=!1;this.fieldsPopup.close()})}],onClose:F.hitch(this,
function(){this.isOpen=!1})})},hideDialog:function(){this.fieldsPopup&&this.isOpen&&(this.isOpen=!1,this.fieldsPopup.close())},_getFieldsOptionsObj:function(b,a){var m=this._getPopupFieldInfo(b);b=d._getValues(this.layerInfo.layerInfo.layerObject,m,b,a);return b=D.map(b,function(l){return{value:l.value,label:l.label+""}})},_getPopupFieldInfo:function(b){var a;if(a=this.layerInfo.layerInfo.getPopupInfo())a=a.fieldInfos,D.some(a,function(l){if(l.fieldName===b)return m=l,!0});else var m=d.getPopupFieldFromLayerField(this.layerInfo.layerInfo.layerObject.getField(b));
return m},setValue:function(b,a){a&&(1<a.length?this.allFields[b].set("value",this.getSelectedValueForDateField(b,a)):this.allFields[b].set("value",a.getValue()))},getSelectedValueForDateField:function(b,a){var m="";var l=this._getPopupFieldInfo(b);var n=d._getValues(this.layerInfo.layerInfo.layerObject,l,b,[a[0].value?a[0].value.getTime():""]);D.some(this.allFields[b].options,F.hitch(this,function(k){if(k.value===n[0].value)return m=k.value,!0}));return m}})})},"widgets/SmartEditor/requiredFields":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/text!./requiredFields.html dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/Popup dojo/dom-construct dojo/_base/array dojo/string dojo/dom-style dojo/on dojo/dom-class dojo/dom-attr".split(" "),
function(N,A,F,D,g,f,t,c,v,q,e,d,b,a){return N([f,A,g],{baseClass:"jimu-widget-smartEditor-requiredFields",templateString:D,fieldsPopup:null,nodes:[],postCreate:function(){this.nodes=[];this._createPopupContent();this._createPopUp()},_createPopupContent:function(){v.forEach(this.requiredFieldsInfos,F.hitch(this,function(m){var l=m.alias?m.alias:m.name,n=c.create("div",{class:"esriCTFieldContainer esriCTMarginLeft15"},this.fieldsDijitContainer),k=q.substitute(this.nls.requiredFields.foundNullRecordCount,
{fieldName:l,count:this.AttributesCount[m.name]});c.create("div",{innerHTML:k,class:"esriCTFieldName"},n);var x=this.presetUtils.createPresetFieldContentNode(m);this.nodes.push(x);0<x.length&&v.forEach(x,F.hitch(this,function(u){e.set(u,"width","100%");a.set(u,"aria-label",l);u.placeAt(c.create("div",{style:"width:90%"},n));u.startup()}));x[0].hasOwnProperty("fieldType")&&-1!==["richtext","textarea"].indexOf(x[0].fieldType)&&d(x[0],"change",F.hitch(this,function(u){""===u||null===u||void 0===u?(b.add(x[0].domNode,
"ee-error"),x[0].focusNode.focus()):b.remove(x[0].domNode,"ee-error")}))}))},_createPopUp:function(){this.fieldsPopup=new t({titleLabel:this.nls.requiredFields.popupTittle,width:400,maxHeight:300,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,id:"okButton",onClick:F.hitch(this,function(){this._validateFieldsDijits()&&(this._getRequiredFieldsEnteredvalues(),this.fieldsPopup.close())})},{label:this.nls.cancel,id:"cancelButton",classNames:["jimu-btn-vacation"],onClick:F.hitch(this,
function(){this.emit("cancelButtonClicked");this.fieldsPopup.close()})}]})},_getRequiredFieldsEnteredvalues:function(){var m={};v.forEach(this.nodes,F.hitch(this,function(l){var n=l[0].name;if(l[0].hasOwnProperty("fieldType")&&"date"===l[0].fieldType)if(1===l.length)m[n]=(new Date(l[0].getValue())).getTime();else{var k=l[0].getValue().toDateString();l=l[1].getValue().toTimeString();m[n]=(new Date(k+" "+l)).getTime()}else l[0].hasOwnProperty("fieldType")&&-1!==["richtext","textarea"].indexOf(l[0].fieldType)?
(k=this.presetUtils.getFieldInfoByFieldName(this.requiredFieldsInfos,l[0].name).length,l=l[0].getValue(),l.length>k&&(l=l.slice(0,k)),m[n]=l):m[n]=l[0].getValue()}));this.emit("providedValuesToRequiredFields",m)},_validateFieldsDijits:function(){var m=!0;v.some(this.nodes,F.hitch(this,function(l){if(l[0].hasOwnProperty("fieldType")&&-1!==["richtext","textarea"].indexOf(l[0].fieldType)){if(""===l[0].getValue()||null===l[0].getValue()||void 0===l[0].getValue())return b.add(l[0].domNode,"ee-error"),
m=!1,l[0].focusNode.focus(),!0}else{if(!l[0].isValid())return m=!1,l[0].focus(),!0;if(1<l.length&&!l[1].isValid())return m=!1,l[1].focus(),!0}}));return m}})})},"widgets/SmartEditor/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SmartEditor/RelativeDates.html":'\x3cdiv\x3e\r\n    \x3cdiv\x3e\r\n        \x3cdiv class\x3d"esriCTLabel"\x3e${nls.relativeDates.dateTypeLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTRadioButtonContainer"\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"fixedRadioButton" checked\r\n                    data-dojo-attach-point\x3d"fixedRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.fixed}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"fixedRadioButton"\x3e\r\n                    ${nls.relativeDates.fixed}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"currentRadioButton"  data-dojo-attach-point\x3d"currentRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.current}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"currentRadioButton"\x3e\r\n                    ${nls.relativeDates.current}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"PastRadioButton"  data-dojo-attach-point\x3d"PastRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.past}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"PastRadioButton"\x3e\r\n                    ${nls.relativeDates.past}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"futureRadioButton"  data-dojo-attach-point\x3d"futureRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.future}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"futureRadioButton"\x3e\r\n                    ${nls.relativeDates.future}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTRelativeDatesHint" data-dojo-attach-point\x3d"hintForDateType"\x3e${nls.relativeDates.hintForFixedDateType}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTLabel" style\x3d"margin-top:10px;" data-dojo-attach-point\x3d"valueLabel"\x3e${nls.relativeDates.valueLabel}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTFixedDateContent" data-dojo-attach-point\x3d"fixedDateContent"\x3e\r\n        \x3cdiv class\x3d"esriCTFixedContentWrappper"\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTselectValueLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g2\'" type\x3d"radio" name\x3d"jimuradiobtn2" id\x3d"customRadioButton" checked\r\n                data-dojo-attach-point\x3d"customRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.customLabel}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"customRadioButton"\x3e\r\n                    ${nls.relativeDates.customLabel}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTselectValueLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g2\'" type\x3d"radio" name\x3d"jimuradiobtn2" id\x3d"selectValueRadioButton"\r\n                data-dojo-attach-point\x3d"selectValueRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.popupTitle}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"selectValueRadioButton"\x3e\r\n                    ${nls.relativeDates.popupTitle}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"customOptionContentNode"\x3e\r\n        \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n            \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.date}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                \x3cdiv style\x3d"width:95%" data-dojo-type\x3d"dijit/form/DateTextBox" required\x3d"false" data-dojo-attach-point\x3d"dateTextBox" tabindex\x3d"0" aria-label\x3d"${nls.date}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n            \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.time}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                \x3cdiv style\x3d"width: 95%" data-dojo-type\x3d"dijit/form/TimeTextBox" required\x3d"false" data-dojo-attach-point\x3d"timeTextBox" tabindex\x3d"0" aria-label\x3d"${nls.time}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTHidden"  data-dojo-attach-point\x3d"selectValueOptionContentNode"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"layerSelectorWrapper" class\x3d"esriCTWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.relativeDates.layerLabel}\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                    \x3cdiv class\x3d"esriCTLayerSelect" style\x3d"width: 95%" data-dojo-attach-point\x3d"layerSelectorDiv"\r\n                    aria-label\x3d"${nls.relativeDates.layerLabel}"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.presetFieldAlias}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                    \x3cdiv class\x3d"esriCTlayerField" style\x3d"width: 95%" data-dojo-attach-point\x3d"fieldsDropdownDiv"\r\n                    aria-label\x3d"${nls.presetFieldAlias}"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.relativeDates.valueLabel}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                    \x3cdiv class\x3d"esriCTlayerFieldvalue" style\x3d"width: 95%" data-dojo-attach-point\x3d"valueProviderContainer"\r\n                    aria-label\x3d"${nls.relativeDates.valueLabel}"\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"esriCTDomainFieldHint esriCTHidden" data-dojo-attach-point\x3d"domainFieldHint"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden" style\x3d"width:100%" data-dojo-attach-point\x3d"currentDateContent"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden esriCTPastOrFutureDateContent" data-dojo-attach-point\x3d"pastOrFutureDateContent"\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel"\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.years}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"yearsTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.years}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.months}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"monthsTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.months}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.days}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"daysTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.days}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel" style\x3d"margin-top: 5px;"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel"\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.hours}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"hoursTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.hours}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.minutes}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"minutesTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.minutes}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.seconds}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"secondsTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.seconds}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden esriCTDatesWarningContainer" data-dojo-attach-point\x3d"relativeDateWarningContainer"\x3e${nls.relativeDates.relativeDateWarning}\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"contentNode" class\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem" tabindex\x3d"-1" aria-selected\x3d"false"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation" style\x3d"display: none;"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"contentNode"\r\n\t\t\tclass\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem"\r\n\t\t\t\t   tabindex\x3d"-1" aria-selected\x3d"false" id\x3d"${id}_label"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\r\n\t\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation"\r\n\t\t style\x3d"display: none;" aria-labelledby\x3d"${id}_label"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/Tree.html":'\x3cdiv role\x3d"tree"\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitTreeIndent" style\x3d"position: absolute; top: -9999px" data-dojo-attach-point\x3d"indentDetector"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTreeExpando dijitTreeExpandoLoading" data-dojo-attach-point\x3d"rootLoadingIndicator"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeContainer" role\x3d"presentation"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/LayerChooserFromMapWithDropbox.html":'\x3cdiv\x3e\r\n\x3ctable role\x3d"listbox" aria-haspopup\x3d"true" data-dojo-attach-point\x3d"dropDownBtn" data-dojo-attach-event\x3d"onclick: _onDropDownClick,onkeydown: _onDropDownKeydown"\r\n  tabindex\x3d"0" title\x3d"${nls.customSelectLayer}" aria-label\x3d"${nls.customSelectLayer}"\x3e\r\n    \x3ccaption class\x3d"screen-readers-only-no-position"\x3e${nls.customSelectLayer}\x3c/caption\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"30px"\x3e\x3c/col\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" data-dojo-attach-point\x3d"layerNameNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"drop-select jimu-float-trailing" data-dojo-attach-point\x3d"dropArrowNode"\x3e\r\n            \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SmartEditor/AttachmentUploader.html":"\x3cdiv class\x3d\"attachmentUploader\" dojoattachpoint\x3d\"attachmentUploader\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${nls.NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n\r\n        \x3cdiv dojoattachpoint\x3d'_attachmentList' style\x3d'white-space:nowrap'\x3e\x3c/div\x3e\r\n\r\n\r\n\r\n    \x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/SmartEditor/XYCoordinates.html":'\x3cdiv class\x3d"esriCTPopupContainer" data-dojo-attach-point\x3d"coordinatesPopup"\x3e\r\n    \x3cdiv class\x3d"esriCTFieldDropdownContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTSelectTitle" title\x3d"${nls.coordinatesSelectTitle}"\x3e${nls.coordinatesSelectTitle}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTFieldInput" style\x3d"width: 100%;"\x3e\r\n            \x3cselect aria-label\x3d"${nls.coordinatesSelectTitle}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"coordinatesDropDown" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n                \x3coption value\x3d"Map Spatial Reference"\x3e${nls.mapSpecialReferenceDropdownOption}\x3c/option\x3e\r\n                \x3coption value\x3d"Latitude/Longitude"\x3e${nls.latLongDropdownOption}\x3c/option\x3e\r\n                \x3coption value\x3d"MGRS"\x3e${nls.mgrsDropdownOption}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"xyOptions"\x3e\r\n    \x3cdiv class\x3d"esriCTControlWidth"\x3e\r\n        \x3cdiv class\x3d"esriCTSelectTitle" data-dojo-attach-point\x3d"xAttributeTextBoxLabel"\x3e${nls.xAttributeTextBoxLabel}\x3c/div\x3e\r\n        \x3cdiv\x3e\r\n            \x3cdiv aria-label\x3d"${nls.xAttributeTextBoxLabel}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"xAttributeTextBox"  constraints\x3d"{places:\'0,10\', round:-1}" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                data-dojo-props\x3d"intermediateChanges:true" trim\x3d"true"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"padding-bottom: 5px;"\x3e\r\n        \x3cdiv for\x3d"yAttributeTextBox" class\x3d"esriCTSelectTitle" data-dojo-attach-point\x3d"yAttributeTextBoxLabel"\x3e${nls.yAttributeTextBoxLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTControlWidth"\x3e\r\n            \x3cdiv aria-label\x3d"${nls.yAttributeTextBoxLabel}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"yAttributeTextBox" constraints\x3d"{places:\'0,10\', round:-1}" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                data-dojo-props\x3d"intermediateChanges:true" trim\x3d"true"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"mgrsOptions" class\x3d"esriCTHidden"\x3e\r\n        \x3cdiv class\x3d"esriCTControlWidth"\x3e\r\n            \x3cdiv class\x3d"esriCTSelectTitle"\x3e${nls.mgrsTextBoxLabel}\x3c/div\x3e\r\n            \x3cdiv\x3e\r\n                \x3cdiv aria-label\x3d"${nls.mgrsTextBoxLabel}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"mgrsTextBox"\r\n                    data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"intermediateChanges:false" trim\x3d"true"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/FeatureSetChooserForMultipleLayers.html":'\x3cdiv class\x3d"jimu-not-selectable"\x3e\r\n  \x3cdiv class\x3d"draw-item-btn" tabindex\x3d"0"\x3e\r\n    \x3cdiv class\x3d"current-draw-item" data-dojo-attach-point\x3d"currentDrawItem"\x3e\r\n      \x3cdiv class\x3d"btn-select" data-dojo-attach-point\x3d"btnSelect"\x3e\r\n        \x3cdiv class\x3d"labels"\x3e\r\n            \x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"geoTypeIcon"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"select-text"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"arrow feature-action icon-drop-down" data-dojo-attach-event\x3d"click:_onArrowClicked"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"btn-clear" data-dojo-attach-point\x3d"btnClear" tabindex\x3d"0"\x3e\r\n    \x3cdiv class\x3d"feature-action icon-clear-selection"\x3e\x3c/div\x3e\x3cdiv class\x3d"clear-text"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/copy-features.html":'\x3cdiv class\x3d"esriCTSelectFeaturesContainer"\x3e\r\n  \x3cdiv style\x3d"height: 100%; width: 100%;"\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListTitle"\x3e${nls.copyFeatures.title}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesHint" data-dojo-attach-point\x3d"warningMessage" tabindex\x3d"0" role\x3d"presentation" aria-label\x3d"${nls.copyFeatures.multipleFeatureSaveWarning}"\x3e${nls.copyFeatures.multipleFeatureSaveWarning}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListContent" data-dojo-attach-point\x3d"layerListTable"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesBtnContainer"\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"createMultipleFeaturesBtn" aria-label\x3d"${nls.copyFeatures.createFeatures}" title\x3d"${nls.copyFeatures.createFeatures}"\x3e${nls.copyFeatures.createFeatures}\x3c/div\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"createSingleFeatureBtn" aria-label\x3d"${nls.copyFeatures.createSingleFeature}"  title\x3d"${nls.copyFeatures.createSingleFeature}"\x3e${nls.copyFeatures.createSingleFeature}\x3c/div\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"cancelBtn" aria-label\x3d"${nls.cancel}" title\x3d"${nls.cancel}"\x3e${nls.cancel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/ValuePicker.html":'\x3cdiv class\x3d"jimu-widget-smartEditor" style\x3d"max-height: 445px;padding: 0 5px;"\x3e\r\n  \x3cdiv class\x3d"esriCTValuePickerHint" data-dojo-attach-point\x3d"valuePickerHint" tabindex\x3d"0"\r\n    aria-label\x3d"${nls.valuePicker.popupHint}" role\x3d"presentation"\x3e\r\n    ${nls.valuePicker.popupHint}\r\n  \x3c/div\x3e\r\n  \x3cdiv style\x3d"width:100%" data-dojo-attach-point\x3d"fieldsContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/SmartEditor/requiredFields.html":'\x3cdiv style\x3d"max-height: 445px;padding: 0 5px;"\x3e\r\n    \x3cdiv class\x3d"esriCTValuePickerHint"\x3e\r\n        ${nls.requiredFields.displayMsg}\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"width: 100%;" data-dojo-attach-point\x3d"fieldsDijitContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/Widget.html":'\x3cdiv style\x3d"width:100%; height:100%; min-width:280px;min-width:240px;"\x3e\r\n    \x3c!--\x3cdiv class\x3d"widgetActive widgetIndicator" id\x3d"widgetActiveIndicator" data-dojo-attach-point\x3d"widgetActiveIndicator"\x3e\x3c/div\x3e--\x3e\r\n    \x3cdiv class\x3d"templatePickerMainDiv"\x3e\r\n\r\n        \x3cdiv id\x3d"templatePickerDiv" class\x3d"templatePickerDiv" data-dojo-attach-point\x3d"templatePickerDiv" tabindex\x3d"-1"\x3e\r\n            \x3c!-- aria-label and tabindex set at runtime --\x3e\r\n            \x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"templateTitle"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"spacer"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"drawingOptionsDiv"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"drawingOptionsDiv"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr /\x3e\r\n\r\n        \x3cdiv class\x3d"autoSaveOptionDiv"\x3e\r\n            \x3cdiv\x3e\r\n                \x3cdiv id\x3d"autoSaveSwitch" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-event\x3d"change:_toggleRunTimeAutoSave"\r\n                aria-label\x3d"${nls.autoSaveEdits}" tabindex\x3d"0" checked\x3d"true" label\x3d"${nls.autoSaveEdits}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"presetFieldsTableDiv" class\x3d"presetFieldsTableDiv" data-dojo-attach-point\x3d"presetFieldsTableDiv"\x3e\r\n            \x3cdiv class\x3d" spacer"\x3e\x3c/div\x3e\r\n            \x3cdiv\x3e\r\n                \x3cdiv id\x3d"savePresetValueSwitch" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-event\x3d"change:_setPresetValue"\r\n                aria-label\x3d"${nls.usePresetValues}" tabindex\x3d"0" label\x3d"${nls.usePresetValues}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"spacer"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"presetFieldsTable" data-dojo-attach-point\x3d"presetFieldsTableNode"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"spacer"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"attributeInspectorMainDiv" style\x3d"display:none"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"buttonWrapper" class\x3d"buttonWrapper"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" class\x3d"cancelButton jimu-btn"\x3e${nls.back}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"mainContainer" style\x3d"max-height : calc(100% - 65px); overflow:auto;"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesMainDiv esriCTHidden" data-dojo-attach-point\x3d"copyFeaturesMainNode"\x3e\r\n    \x3c/div\x3e\r\n',
"url:widgets/SmartEditor/css/style.css":'.jimu-widget-sefilterEditor {}.jimu-widget-sefilterEditor .flDropDown {height: 30px!important; width: 100%; margin-top: 2px; margin-bottom: 10px;}.jimu-widget-sefilterEditor .searchtextbox {height: 30px!important; width: 100%; padding: 5px; margin-bottom: 5px;}.seToolbarIcon {background-image: url("../images/toolbar_icons.png"); width: 16px; height: 16px;}.sePointIcon {background-position: 0px 0px;}.sePointIconDisabled {background-position: -16px 0px;}.sePolylineIcon {background-position: -34px 0px;}.sePolylineIconDisabled {background-position: -50px 0px;}.sePolygonIcon {background-position: -69px 0px;}.sePolygonIconDisabled {background-position: -84px 0px;}.seFreehandPolylineIcon {background-position: -101px 0px;}.seFreehandPolylineIconDisabled {background-position: -118px 0px;}.seFreehandPolygonIcon {background-position: -135px 0px;}.seFreehandPolygonIconDisabled {background-position: -152px 0px;}.seRectangleIcon {background-position: -339px 0px;}.seTriangleIcon {background-position: -356px 0px;}.seEllipseIcon {background-position: -373px 0px;}.seCircleIcon {background-position: -390px 0px;}.seArrowIcon {background-position: -407px 0px;}.seArrowDownIcon {background-position: -424px 0px;}.seArrowLeftIcon {background-position: -441px 0px;}.seArrowUpIcon {background-position: -458px 0px;}.seNewSelectionIcon {background-position: -237px 0px;}.seAddToSelectionIcon {background-position: -254px 0px;}.seRemoveFromSelectionIcon {background-position: -271px 0px;}.seClearSelectionIcon {background-position: -288px 0px;}.drawingOptionsDiv .dijitDropDownButton {margin: 0; width: 100%; text-align: left;} .drawingOptionsDiv .dijitDropDownButton .dijitButtonNode {background: transparent; border: 1px solid #7EABCD; padding: 4px; margin-top: 2px; font-weight: bold; box-shadow: none; border-radius: 4px; text-align: left; width: 100%;}.jimu-rtl .drawingOptionsDiv .dijitDropDownButton .dijitButtonNode {text-align: right;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode .dijitButtonContents {border-color: transparent;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode .dijitInputField {padding: 0 5px;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode .dijitArrowButton {background: transparent; border: 0;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode.dijitSelectFocused .dijitArrowButton {padding: 0;}.drawingOptionsDiv .dijitDownArrowButton {position: relative;}.drawingOptionsDiv .dijitArrowButtonInner {position: absolute; right: 8px; top: 3px; background-image: none;} .drawingOptionsDiv .dijitArrowButtonInner:after {content: "\\e681"; font-family: \'CalciteWebCoreIcons\' !important; speak: none; font-style: normal; font-weight: bold; font-variant: normal; text-transform: none; line-height: 1; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;}div[dijitpopupparent\x3d"drawingTool"] .dijitMenuItemIconCell {width: 20px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn {width: 25%; float: left; text-indent: 20px; padding: 5px 0px 5px 0px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTselectValueLabel {width: 50% !important;}.jimu-widget-smartEditor-setting-relativeDates .esriCTDateTypeLabel {min-width: fit-content;}.jimu-widget-smartEditor-setting-relativeDates .esriCTLabel,.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentWrappper {padding: 5px 0px 5px 0px; width: 100%; overflow: hidden;}.jimu-widget-smartEditor-setting-relativeDates .esriCTValueLabel {margin-bottom: 5px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTPastOrFutureDateContent {width: 100%; margin-left: 20px;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTPastOrFutureDateContent {margin-left: none; margin-right: 20px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentLabel {width: 25%; float: left;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentDijit {width: 75%; float: right;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {width: 33%; float: left;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFloatRight {width: 33%; float: right;}.jimu-widget-smartEditor-setting-relativeDates .esriCTHidden {display: none;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioButtonContainer {width: 100%; height: 30px; display: inline-table;}.jimu-widget-smartEditor-setting-relativeDates .esriCTMarginForLabel {width: 100%; padding: 2px 0px 1px 0px; overflow: hidden;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedDateContent {width:100%;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatRight,.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentDijit {float:left;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn,.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentLabel,.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {float: right;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRelativeDatesHint {font-size: 12px; color: #a0acbf; font-style: oblique; width: 100%; margin-top: 5px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTDatesWarningContainer {font-size: 12px; color: red; width: 100%; margin-top: 5px; padding: 5px 0px 5px 0px; overflow: hidden; font-style: italic;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioLabel {vertical-align: middle;}.jimu-widget-smartEditor-setting-relativeDates .esriCTPopUpLabel {width: 25%; padding: 0px 10px 0px 0px; word-break: break-word; float: left; line-height: 30px; text-indent: 20px;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTPopUpLabel {float: right}.jimu-widget-smartEditor-setting-relativeDates .esriCTWrapper {width: 100%; overflow: hidden; margin-bottom: 5px; padding-bottom: 5px;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTPopupSelect{float: left;}@media (max-width: 600px) {.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn {width: 50%;} .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {width: 50%;}}@media (max-width: 320px) {.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn {width: 100%;} .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {width:100%;}}.jimu-widget-smartEditor-setting-relativeDates .esriCTDomainFieldHint {font-size: 13px; color: #a0acbf; font-style: oblique; margin-top: 5px;}.processing-indicator-panel {display: none; width: 100%; height: 100%; z-index: 500; top: 0; left: 0; position: absolute; background-position: center center; background-image: url(../images/busy.gif); background-repeat: no-repeat;} .processing-indicator-panel.busy {display: block;}.jimu-widget-smartEditor {position: relative;}.autoSaveOptionDiv {display:none;} .widgetIndicator {height: 4px; position:absolute; top:0; z-index:1; width:100%; overflow:hidden; overflow-x: hidden;} .widgetActive {background: #73AD21;} .widgetNotActive {background: red;} .jimu-widget-smartEditor .hideField {display: none;} .jimu-widget-smartEditor .templatePicker {position: relative; height: 296px;} .jimu-widget-smartEditor .grid {height: 100% !important;} .jimu-widget-smartEditor .dojoxGridMasterHeader {height: 0 !important;} .jimu-widget-smartEditor .dojoxGridContent {width: 100% !important;} .jimu-widget-smartEditor .dojoxGridContent div[role\x3dpresentation] {right: 0;} .jimu-widget-smartEditor .dojoxGridRowTable {width: 100%;} .jimu-widget-smartEditor .dojoxGridRow {width: 100%;} .jimu-widget-smartEditor .dojoxGridView {width: 100% !important;} .jimu-widget-smartEditor .esriAttributeInspector {height: 20px; width: 100%;} .jimu-widget-smartEditor .esriAttributeInspector td {display: block; clear: both; height: auto; width: 100%; float: left;}.clearfix:after {content: "."; display: block; height: 0; clear: both; visibility: hidden;}.clearfix {display: inline-block;}* html .clearfix {height: 1%;}.clearfix {display: block;}.clear:after {clear: both; content: "."; display: block; height: 0; visibility: hidden;}.jimu-widget-smartEditor .esriAttributeInspector .atiNavButtons {position: absolute; left: 50%; margin-left: -90px;}.jimu-widget-smartEditor .esriAttributeInspector .asteriskIndicator {color: red !important;}.jimu-widget-smartEditor .esriAttributeInspector .saveButton {float: right; display: inline; margin-bottom: 5px;}.jimu-rtl .jimu-widget-smartEditor .esriAttributeInspector .saveButton {float: left; display: inline;}.jimu-widget-smartEditor .esriAttributeInspector .saveButton.hide {display: none;}.jimu-widget-smartEditor .buttonHeader {float: right;}.jimu-rtl .jimu-widget-smartEditor .buttonHeader {float: left;}.jimu-widget-smartEditor .buttonHeader .saveButton {float: right; margin-left: 5px;}.jimu-rtl .jimu-widget-smartEditor .buttonHeader .saveButton {float: left; margin-left: 0px; margin-right: 5px;}.jimu-widget-smartEditor .buttonHeader .deleteButton {float: left;}.jimu-rtl .jimu-widget-smartEditor .buttonHeader .deleteButton {float: right;}.jimu-widget-smartEditor .cancelButton {float: left;}.jimu-rtl .jimu-widget-smartEditor .cancelButton {float: right;}.jimu-widget-smartEditor .esriAttributeInspector .deleteButton {float: right; margin-right: 20px;}.jimu-rtl .jimu-widget-smartEditor .esriAttributeInspector .deleteButton {float: left; margin-left: 20px;}.jimu-widget-smartEditor .ee-presetValueTableDiv {height: 100%; width: 100%;}.jimu-widget-smartEditor .ee-presetValueHeaderTable {color: #000000; font-size: 14px; padding: 8px; background-color: #E3E3E3; vertical-align: middle; width: 100%;}.jimu-widget-smartEditor .ee-presetValueBodyTable td {display: block; clear: both; height: auto; width: 100%; float: left;}.jimu-widget-smartEditor .esriCTGroupInfoIcon {width: 16px; height: 20px; margin: 0px 2px 2px 0px;; background-repeat: no-repeat; background-size: 16px 16px; background-image: url(../images/desc.png); cursor: pointer; float: left;}.jimu-rtl .jimu-widget-smartEditor .esriCTGroupInfoIcon {float: right;}.jimu-widget-smartEditor .ee-atiLabel {width: 100%; margin-bottom: 3px; line-height: 20px;}.jimu-widget-smartEditor .editRelativeDateIcon {margin: 5px auto; height: 20px; width: 20px; float: right; cursor: pointer;}.jimu-rtl .jimu-widget-smartEditor .editRelativeDateIcon {float: left;}.jimu-widget-smartEditor .atiLabel {width: 100%; margin-top: 6px !important; margin-bottom: 3px !important;}.jimu-widget-smartEditor .ee-presetValueBody {vertical-align: top;}.jimu-widget-smartEditor .ee-presetValueBodyTable {width: 100%;}.jimu-widget-smartEditor .ee-presetValue-label-header-field,.jimu-widget-smartEditor .field-alias-label {width: 40%;}.jimu-widget-smartEditor .ee-presetValue-value-header-field,.jimu-widget-smartEditor .preset-value-editable {width: 100%; margin-bottom: 6px;}.jimu-widget-smartEditor .ee-inputField,.jimu-widget-smartEditor-requiredFields .ee-inputField {width: 100%;}.jimu-widget-smartEditor .ee-inputFieldTextArea {width: 100%!important; resize: vertical; overflow: auto; font-family: inherit; line-height: 20px !important; font-size: 14px; min-height: 70px;}.jimu-widget-smartEditor .ee-inputFieldRichText {width: 100%!important; margin: 5px auto;}.jimu-widget-smartEditor .spacer {height: 12px;}.jimu-widget-smartEditor .spacerSmall {height: 8px;}.jimu-widget-smartEditor .attributeInspectorDiv {padding-top: 8px;}.jimu-widget-smartEditor .esriAttributeInspector .atiField {width: 100%;}.jimu-widget-smartEditor .esriAttributeInspector .dijitTextBox {width: 100%!important;}.jimu-widget-smartEditor .esriAttributeInspector .dijitTextArea {width: 100%!important; min-height: 70px; resize: vertical; overflow: auto; font-family: inherit; line-height: 20px !important; font-size: 14px;}.jimu-widget-smartEditor div.atiAttributes table {width: 98%;}.jimu-widget-smartEditor .processing-indicator {display: none; float: right; width: 40px; height: 40px; background-position: center center; background-image: url(../images/busy.gif); background-repeat: no-repeat; z-index: 999;} .jimu-widget-smartEditor .processing-indicator.busy {display: inline;}.jimu-widget-smartEditor .processing-indicator-panel {display: none; width: 100%; height: 100%; z-index: 500; top: 0; left: 0; position: absolute; background-position: center center; background-image: url(../images/busy.gif); background-repeat: no-repeat;} .jimu-widget-smartEditor .processing-indicator-panel.busy {display: block;}.jimu-widget-smartEditor .updateOnlyText {vertical-align: middle; padding: 10px;}.jimu-widget-smartEditor .attInput {padding-top: 3px; padding-bottom: 3px; display: inline-block;}.jimu-widget-smartEditor .deleteAttachment {padding-right: 5px; cursor: pointer; color: red !important; font-weight: bold;}.jimu-widget-smartEditor .atiNavMessage {display: inline-block; float: none;}.jimu-widget-smartEditor .dijitButtonHover .dijitButtonNode {background-color: transparent !important; background-image: none !important; border: none !important; -webkit-box-shadow: none !important; -moz-box-shadow: none !important; box-shadow: none !important;}.jimu-widget-smartEditor .dijitButton .dijitButtonNode {background-color: transparent !important; background-image: none !important; border: none !important; -webkit-box-shadow: none !important; -moz-box-shadow: none !important; box-shadow: none !important;}.jimu-widget-smartEditor .dijitButton {background-color: transparent !important; background-image: none !important; border: none !important; -webkit-box-shadow: none !important; -moz-box-shadow: none !important; box-shadow: none !important;}.dijitCalendarDateTemplate.dijitCalendarCurrentDate .dijitCalendarDateLabel {color: red; border-color: red;}.dijitCalendarDateTemplate.dijitCalendarHoveredDate .dijitCalendarDateLabel,.dijitCalendarDateTemplate.dijitCalendarEnabledDate:hover .dijitCalendarDateLabel {background-color: greenyellow;}.dijitCalendarDateTemplate.dijitCalendarSelectedDate .dijitCalendarDateLabel,.dijitCalendarDateTemplate.dijitCalendarSelectedDate.dijitCalendarHoveredDate .dijitCalendarDateLabel {background-color: cyan;}.jimu-widget-smartEditor .dijitComboBox \x3e div.dijitArrowButton.dijitDownArrowButton {width: 25px !important;}.jimu-widget-smartEditor .dijitTextBox .dijitInputField {height: 100% !important;}.jimu-widget-smartEditor .dijitComboBox \x3e div.dijitArrowButton.dijitDownArrowButton \x3e input {width: 100%;}.jimu-widget-smartEditor .attwarning {margin-top: 2px; color: brown;}.jimu-widget-smartEditor .presetFieldsTableDiv {display: none;}.jimu-widget-smartEditor .buttonWrapper {text-align: center; margin-bottom: 5px; width: 100%; display: inline-block;}.jimu-widget-smartEditor .footerButton {text-align: center; margin-top: 5px;}.jimu-widget-smartEditor .esriAttributeInspector .atiLayerName {display:none;}.jimu-widget-smartEditor .editDescription {padding : 5px 0 5px 0; outline-offset: -1px;}.jimu-widget-smartEditor .esriCTItemListContainer {float: left; width: 100%; height: calc(100% - 30px); overflow-y: auto;} .jimu-widget-smartEditor .esriCTItemTitleContainer {background-color: #f5f5f5; color: #444; cursor: pointer; border: 1px solid #d9d9d9; width: 100%; display: inline-block; float: left;} .jimu-widget-smartEditor .esriCTItemTitleContainer:focus {outline-offset: -2px;} .jimu-widget-smartEditor .esriCTItemTitle {padding: 15px 5px 15px 5px; text-align: left; border: none; outline: none; width: calc(100% - 35px); float: left; white-space: pre-wrap;} .jimu-rtl .jimu-widget-smartEditor .esriCTItemTitle {float: right; text-align: right;} .jimu-rtl .jimu-widget-smartEditor .esriCTItemHighlighter {float: right;} .jimu-widget-smartEditor .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;} .jimu-widget-smartEditor .esriCTItemContent {height: 0px; padding: 0 5px; overflow: hidden; border-right: 1px solid #d9d9d9; border-left: 1px solid #d9d9d9;} .jimu-widget-smartEditor .esriCTRelatedItemContent {border-bottom: 1px solid #d9d9d9;} .jimu-widget-smartEditor .esriCTItemContentActive {height: auto;} .jimu-widget-smartEditor .esriCTItemListImageLogo {height: 24px; width: 24px; margin-top: 10px; float: left; background-position: center center; background-repeat: no-repeat; background-size: 24px; margin-left: 5px;} .jimu-widget-smartEditor .esriCTItemListImageLogo {float: right; margin-left: auto; margin-right: 5px;} .jimu-widget-smartEditor .esriCTBorder {border: 1px solid grey;} .jimu-widget-smartEditor .esriAttributeInspector .atiNavButtons {float: none;} .jimu-widget-smartEditor .buttonContainer {text-align: center; margin-top: 5px;} .jimu-widget-smartEditor .attributeInspectorMainDiv {height: 100%;} .jimu-widget-smartEditor .detailsContainer {height:100%;} .jimu-widget-smartEditor .esriCTItemHighlighter {height: 44px; width: 5px; float: left;} .jimu-widget-smartEditor .itemTitleArrowIcon {height: 20px; width: 20px; background-size: 20px; background-repeat: no-repeat; background-position: center; float: left; margin-top: 13px;} .jimu-rtl .jimu-widget-smartEditor .itemTitleArrowIcon {margin-left: 5px;} .jimu-widget-smartEditor .itemTitleUpArrow {background-image: url(../images/upArrow.png);} .jimu-widget-smartEditor .itemTitleDownArrow {background-image: url(../images/downArrow.png);} .jimu-widget-smartEditor .esriCTDisableToggling .esriCTItemTitleContainer {cursor: default;} .jimu-widget-smartEditor .esriCTDisableToggling .itemTitleUpArrow {background-image: none;} .jimu-widget-smartEditor .relatedTablesContainer {float: left; margin: 3px; width: 100%;} .jimu-rtl .jimu-widget-smartEditor .relatedTablesContainer {float: right;} .jimu-widget-smartEditor .relatedTableTitleContainer {padding: 7px 0px 7px 0px; width: 100%; float: left; border-bottom: 1px solid #d9d9d9; cursor: pointer; line-height: 20px;}.jimu-widget-smartEditor .esriCTRelatedTableTitleDefaultCursor {cursor: default;}.jimu-widget-smartEditor .relatedTableTitle {float: left;}.jimu-rtl .jimu-widget-smartEditor .relatedTableTitle {float: right;}.jimu-widget-smartEditor .relatedTableIcons {height: 20px; width: 20px; background-size: 20px; background-repeat: no-repeat; background-position: center; float: left; margin-left: 10px;}.jimu-widget-smartEditor .esriCTRelatedTableRecordsCount {float: left;}.jimu-widget-smartEditor .esriCTLoadingIcon {background-image: url(\'../images/loading-icon.gif\'); background-position: center center; background-repeat: no-repeat; height: 20px; width: 20px; float: left;}.jimu-rtl .jimu-widget-smartEditor .esriCTRelatedTableRecordsCount {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTLoadingIcon {float: right;}.jimu-widget-smartEditor .refreshAttributes {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/refresh.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTAutoUpdateOnMode {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/auto-update-on-mode.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTAutoUpdateOffMode {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/auto-update-off-mode.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTMapNavigationLocked {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/map-navigation-locked.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTMapNavigationUnLocked {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/map-navigation-unlocked.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTLocateButtonContainer {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/locate.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTXYCoordinates {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/xy-coordinates.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTGeometryEditor {margin-right: 5px;}.jimu-rtl .jimu-widget-smartEditor .refreshAttributes {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTAutoUpdateOnMode {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTAutoUpdateOffMode {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTMapNavigationLocked {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTMapNavigationUnLocked {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTLocateButtonContainer {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTXYCoordinates {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTGeometryEditor {margin-left: 5px; margin-right: 0px;}.jimu-widget-smartEditor .itemTitleCreateNew {background-image: url(../images/newFeature.png); cursor: pointer;}.jimu-rtl .jimu-widget-smartEditor .itemTitleCreateNew {float: right; margin-right: 5px; margin-left: 0px;}.jimu-widget-smartEditor .itemTitleNextArrow {-webkit-transform: rotate(90deg); -moz-transform: rotate(90deg); -ms-transform: rotate(90deg); -o-transform: rotate(90deg); transform: rotate(90deg); background-image: url(../images/upArrow.png);} .jimu-rtl .jimu-widget-smartEditor .itemTitleNextArrow {-webkit-transform: rotate(270deg); -moz-transform: rotate(270deg); -ms-transform: rotate(270deg); -o-transform: rotate(270deg); transform: rotate(270deg); margin-right: 5px; margin-left: 0px;} .jimu-widget-smartEditor .hidden {display: none;} .dart-panel .jimu-widget-smartEditor .esriCTItemTitleContainer:hover {background-color: #808080;} .dart-panel .jimu-widget-smartEditor .esriCTItemListContainer {border: 1px solid #808080;} .dart-panel .jimu-widget-smartEditor .esriCTItemTitleContainer {background-color: #646464; border-bottom: 1px solid #808080;} .esriCTOverridePanelStyle {height: calc(100% - 20px) !important;} .jimu-widget-smartEditor-XYCoordinates .esriCTHidden {display: none !important;} .jimu-widget-smartEditor-XYCoordinates .esriCTSelectTitle {padding-top: 5px; padding-bottom: 5px; margin-top: 2px;} .jimu-widget-smartEditor-XYCoordinates .esriCTFieldDropdownContainer .claro .dijitSelect {background-color: #f0f0f0; height: 30px;} .jimu-popup .title-label {width: calc(100% - 30px); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;} .jimu-widget-smartEditor .esriCTCopyFeaturesMainContainer {border: 1px solid #d9d9d9; position: absolute; top: 0; background-color: #fff; height: calc(100% + 5px); width: 100%;} .jimu-widget-smartEditor .esriCTSelectFeaturesContainer {padding: 5px; height: calc(100% - 10px); width: 100%;} .jimu-widget-smartEditor .esriCTCopyFeaturesListTitle {margin-bottom: 5px; font-weight: bold; font-size: 15px;} .jimu-widget-smartEditor .esriCTCopyFeaturesHint {margin-bottom: 5px; font-style: italic;} .jimu-widget-smartEditor .esriCTCopyFeaturesListContent {height: calc(100% - 114px); width: 100%; overflow: auto; border-top: 1px solid #d9d9d9; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9; padding: 5px;} .jimu-widget-smartEditor .esriCTCopyFeaturesNode {margin-bottom: 8px;} .jimu-widget-smartEditor .esriCTCopyFeaturesNode:after {content: ""; display: table; clear: both;} .jimu-widget-smartEditor .esriCTCopyFeaturesChildNode {margin-left: 16px;} .jimu-rtl .jimu-widget-smartEditor .esriCTCopyFeaturesChildNode {margin-right: 16px;} .jimu-widget-smartEditor .esriCTCopyFeaturesBtn {margin-top: 10px; margin-right: 5px; margin-left: 5px; max-width: 150px;} .jimu-widget-smartEditor .esriCTCopyFeaturesBtnContainer {text-align: center; border-bottom: 1px solid #d9d9d9; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9; padding-bottom: 5px;} .jimu-widget-smartEditor .esriCTHidden {display: none !important;} .jimu-widget-smartEditor .esriCTCopyFeaturesMainDiv {width: 100%; height: 100%; position: absolute; top: 0; left: 0; background-color: #ffffff;} .jimu-widget-smartEditor-XYCoordinates .esriCTPopupContainer {padding: 1px;} .jimu-widget-smartEditor-XYCoordinates .esriCTControlWidth {width: 100%} .jimu-popup .content .presetMessageContentDiv:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-smartEditor .esriCTValuePickerButton {height: 25px; width: 25px; float: right; background-image: url(../images/value-picker.png); background-size: 25px; background-repeat: no-repeat; cursor: pointer; margin-top: 5px;}.jimu-widget-smartEditor .esriCTValuePickerButton.disabled {opacity: 0.4;}.jimu-rtl .jimu-widget-smartEditor .esriCTValuePickerButton {float: left;}.jimu-widget-smartEditor .esriAttributeInspector .multipleValueDijit {width: calc(100% - 35px) !important;}.jimu-widget-smartEditor .esriCTValuePickerHint,.jimu-widget-smartEditor-requiredFields .esriCTValuePickerHint {font-size: 12px; color: #a0acbf; font-style: oblique; margin: 5px 0;}.jimu-widget-smartEditor .esriCTFieldContainer,.jimu-widget-smartEditor-requiredFields .esriCTFieldContainer {margin-bottom: 10px;}.jimu-widget-smartEditor .esriCTFieldName,.jimu-widget-smartEditor-requiredFields .esriCTFieldName {margin-bottom: 3px; font-size: 12px;}.jimu-widget-smartEditor .esriCTFieldName .asteriskIndicator {display: none !important;}.jimu-widget-smartEditor-multiple-value-picker .content-static {margin: 10px 10px 0;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {overflow: hidden; width: 220px; float: left;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelect .dijitInputField {overflow: hidden;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {text-align: left;}.jimu-rtl .jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {text-align: right;}.jimu-widget-smartEditor-requiredFields .ee-error {border-color: #d46464 !important; box-shadow: 0px 0px 5px #d46464;}.jimu-widget-smartEditor-requiredFields .esriCTMarginLeft15 {margin-left: 15px;}.jimu-rtl .jimu-widget-smartEditor-requiredFields .esriCTMarginLeft15 {margin-right: 15px; margin-left: 0px;}',
"*now":function(N){N(['dojo/i18n!*preload*widgets/SmartEditor/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/Stateful dojo dijit dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/aspect dojo/i18n!esri/nls/jsapi dojo/dom dojo/dom-construct dojo/dom-class dojo/dom-style dojo/on dojo/keys dojo/json dojo/topic dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/dijit/Message esri/request esri/dijit/editing/TemplatePicker esri/dijit/AttributeInspector esri/toolbars/draw esri/toolbars/edit esri/tasks/query esri/graphic esri/layers/FeatureLayer dojo/promise/all dojo/Deferred esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/geometry/jsonUtils esri/geometry/Polyline esri/geometry/Polygon esri/tasks/RelationshipQuery dijit/registry ./PresetAllFields ./utils ./presetUtils ./presetBuilderBackwardCompatibility ./smartAttributes ./attributeInspectorTools ./relatedTables jimu/dijit/CheckBox dijit/form/Button dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/form/DateTextBox dijit/form/NumberSpinner dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Editor dijit/form/SimpleTextarea dojo/store/Memory dojo/date/stamp dojo/dom-attr jimu/dijit/Popup ./AttachmentUploader esri/lang esri/renderers/jsonUtils dojox/html/entities jimu/dijit/EditorXssFilter jimu/utils jimu/portalUrlUtils jimu/SelectionManager ./SEFilterEditor ./SEDrawingOptions ./PrivilegeUtil ./XYCoordinates jimu/dijit/LoadingIndicator esri/tasks/GeometryService ./coordinateUtils ./addressUtils ./Intersection esri/dijit/LocateButton esri/geometry/Point esri/SpatialReference dijit/focus jimu/dijit/FeatureSetChooserForMultipleLayers ./copy-features ./ValuePicker dojo/string ./requiredFields".split(" "),function(N,
A,F,D,g,f,t,c,v,q,e,d,b,a,m,l,n,k,x,u,B,h,r,w,G,y,J,M,ba,W,E,O,H,P,S,V,Z,da,L,R,aa,ia,Q,T,Y,ea,la,qa,na,ra,oa,sa,ua,Ba,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,ma,Ca,Oa,Aa,Pa,Fa,Qa,va,Ga,Ha,Ra,xa,Sa,Ta,Ia,Ua,Ja,Va,Wa,Ka,Da,Ea,La,Xa,Ya,Za,Ma,$a){return D([u,x],{name:"SmartEditor",baseClass:"jimu-widget-smartEditor",_defaultStartStr:"",_defaultAddPointStr:"",_jimuLayerInfos:null,_mapClick:null,settings:null,templatePicker:null,attrInspector:null,editToolbar:null,_isDirty:!1,updateFeatures:[],currentFeature:null,
currentLayerInfo:null,_attrInspIsCurrentlyDisplayed:!1,_ignoreEditGeometryToggle:!1,_editingEnabled:!1,_usePresetValues:!1,_creationDisabledOnAll:!1,_editGeomSwitch:null,_autoSaveRuntime:!1,_userHasPrivilege:!1,_eventHandler:null,_createOverDef:null,featureReductionEnabledLayers:[],rendererDifferentLayers:[],clusterState:!0,_relatedTablesInfo:{},_traversal:[],_nodesCollection:[],_paginationNodeCollection:[],_buttonsWrapper:[],_attributeInspectorCollection:[],contentWrapper:null,viewedFeatureDetails:[],
viewedLayerDetails:[],currentAction:null,_isPresetTableCreated:!1,_layerClearSelectionHandles:[],_layerChangedOutside:!1,_refreshButton:null,_mapNavigation:null,_locateButtonDiv:null,_xyCoordinates:null,_coordinates:null,_selectTool:null,_selectTemplateIndex:0,copyMultipleFeatureGraphics:[],nullAttributeCountRecord:null,requiredFieldsArray:null,postMixInProperties:function(){this.nls=g.mixin(this.nls,window.jimuNls.common);this.nls=g.mixin(this.nls,window.jimuNls.timeUnit)},postCreate:function(){this.inherited(arguments);
this._relatedTablesInfo={};this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this.viewedFeatureDetails=[];this.viewedLayerDetails=[];this._isPresetTableCreated=!1;this._layerClearSelectionHandles=[];this._layerChangedOutside=!1;this._selectTool=null;this.editorXssFilter=Qa.getInstance();this.copyMultipleFeatureGraphics=[];this.requiredFieldsArray=this.nullAttributeCountRecord=null;this.config.editor.hasOwnProperty("expandRelatedTableOnLoad")||
(this.config.editor.expandRelatedTableOnLoad=!1);this.config.editor.hasOwnProperty("expandMainLayerOnLoad")||(this.config.editor.expandMainLayerOnLoad=!0);this.own(m(this.cancelButton,"click",g.hitch(this,function(){this._performCancelButtonOperation()})));this.own(m(this.cancelButton,"keydown",g.hitch(this,function(p){p.keyCode!==l.ENTER&&p.keyCode!==l.SPACE||this._performCancelButtonOperation()})));ma.set(aa.byId("savePresetValueSwitch").domNode,"aria-label",this.nls.usePresetValues);ma.set(aa.byId("autoSaveSwitch").domNode,
"aria-label",this.nls.autoSaveEdits);this.openAtStartAysn=!0},_performCancelButtonOperation:function(){this.config.editor.displayPromptOnSave&&this._validateFeatureChanged()?this._promptToResolvePendingEdit(1<this._traversal.length?!1:!0,null,!0).then(g.hitch(this,function(p){this._addingNewRelatedRecord&&"no"!==p?this._processBackButtonInNewRelatedRecord=!0:this._onCancelButtonClicked();this._setWidgetFirstFocusNode("templatePicker",!0)}),function(){}):this._onCancelButtonClicked()},_setCancelButtonText:function(){this._traversal&&
1<this._traversal.length?(ma.set(this.cancelButton,"innerHTML",this.nls.back),ma.set(this.cancelButton,"aria-label",this.nls.back)):(ma.set(this.cancelButton,"innerHTML",this.nls.clearSelection),ma.set(this.cancelButton,"aria-label",this.nls.clearSelection))},onConfigChanged:function(){this.inherited(arguments);this._onCancelButtonClicked()},_onCancelButtonClicked:function(){if(this.attrInspector){if(this.attrInspector.layerInfos){var p=B.getInstanceSync();f.forEach(this.attrInspector.layerInfos,
function(I){var K=I.featureLayer;K.clearSelection();K.refresh();K=I.featureLayer.url;I.featureLayer.hasOwnProperty("originalLayerId")&&(layID=I.featureLayer.originalLayerId,I.id!=layID&&(K=I.featureLayer,K.clearSelection(),K.refresh(),I=p.getLayerOrTableInfoById(layID),K=I.layerObject.url));var X=K.split("/FeatureServer")[0];f.forEach(p.getLayerInfoArray(),function(U){"undefined"!==typeof U.layerObject.url&&null!==U.layerObject.url&&U.layerObject.url.includes("/MapServer")&&U.layerObject.url.includes(X)&&
U.layerObject.refresh()},this)})}this.attrInspector.destroy()}d.destroy(this.contentWrapper);d.destroy(this.buttonHeader);this.navButtonsDiv&&d.destroy(this.navButtonsDiv);if(this._attributeInspectorCollection&&0<this._attributeInspectorCollection.length){var z=this._attributeInspectorCollection.pop();z&&(this.attrInspector=z)}this._traversal&&0<this._traversal.length&&this._traversal.pop();0<this._buttonsWrapper.length&&(this.buttonHeader=this._buttonsWrapper.pop());this._setCancelButtonText();this._unLockMapNavigation();
if(this._nodesCollection&&0<this._nodesCollection.length){z=this._nodesCollection.pop();var C=this._paginationNodeCollection.pop();if(z){b.remove(z,"hidden");b.remove(this.buttonHeader,"hidden");a.set(this.attrInspector.attributeTable,"display","block");a.set(this.attrInspector.editButtons,"display","block");void 0!==this.attrInspector._attachmentEditor&&null!==this.attrInspector._attachmentEditor&&a.set(this.attrInspector._attachmentEditor.domNode,"display","block");a.set(this.attrInspector.deleteBtn.domNode,
"display","none");this.attrInspector._featureIdx=this.attrInspector.ctStoredFeatureIndex;this.attrInspector.refresh();setTimeout(g.hitch(this,function(){a.set(this.attrInspector.navButtons,"display",!this.attrInspector._hideNavButtons&&1<this.attrInspector._numFeatures?"":"none");this.attrInspector.navMessage.innerHTML=Aa.substitute({idx:this.attrInspector._featureIdx+1,of:this.attrInspector.NLS_of,numFeatures:this.attrInspector._numFeatures},this.attrInspector._navMessage);this._toggleAttrInspectorNavButtons();
this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null;this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes));this.currentLayerInfo=this._getLayerInfoByID(this.currentFeature._layer.id);this._relatedTablesInfo&&this._relatedTablesInfo[this.currentFeature._layer.id]&&this._relatedTablesInfo[this.currentFeature._layer.id].updateRelatedRecordsCount();this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||
!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues);1>=this._traversal.length&&(c(".esriCTItemTitle",this.domNode)[0].style.opacity=this.currentFeature&&this.currentFeature.geometry&&this.currentFeature._layer.visibleAtMapScale?"1":"0.3");this.currentFeature.hasOwnProperty("allowDelete")?this._toggleDeleteButton(this.currentFeature.allowDelete&&
this.currentLayerInfo.allowDelete):this._toggleDeleteButton(this.currentLayerInfo.allowDelete);this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&2>this._traversal.length&&this._editGeomSwitch.domNode&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check());1<=this._traversal.length&&this._setWidgetFirstFocusNode("AI",!0);this.loading.show();setTimeout(g.hitch(this,function(){!this.attrInspector._attachmentEditor||
this.currentLayerInfo.isEditable&&this.currentLayerInfo._editFlag||this._disableAttachments(this.attrInspector._attachmentEditor,!0,!1);this.loading.hide()}),1E3)}),200);this.contentWrapper=z;this.navButtonsDiv=C;return}}this._attrInspIsCurrentlyDisplayed&&!0===this._attrInspIsCurrentlyDisplayed&&this.attrInspector&&0===this.attrInspector._numFeatures&&(this._showTemplate(!0),this._setWidgetFirstFocusNode("templatePicker",!0));this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this._removeLayerVisibleHandler()},
_createCoordinatesPopup:function(){this._coordinates=new Ta({map:this.map,nls:this.nls,geometryService:this.geometryService});m(this._coordinates,"gotoSelectedLocation",g.hitch(this,function(p){this._getUpdatedLocation(p).then(g.hitch(this,function(z){this.currentFeature.setGeometry(z);this.map.centerAt(z);this.geometryEdited()}),function(){})}))},_getUpdatedLocation:function(p){var z=new O;var C=parseFloat(p.firstPoint);var I=parseFloat(p.secondPoint);"Map Spatial Reference"===p.coordinateSystem?
(p=new Da(C,I,this.map.spatialReference),z.resolve(p)):(p=new Da(I,C,new Ea(4326)),Ja.getProjectedGeometry(p,this.map.spatialReference,this.geometryService).then(g.hitch(this,function(K){z.resolve(K)}),function(){}));return z.promise},_toggleAttrInspectorNavButtons:function(){var p;c(".esriAttrPaginationDiv")&&this._traversal&&(p=c(".esriAttrPaginationDiv")[this._traversal.length-1]);p&&(this.attrInspector&&1<this.attrInspector._selection.length?(a.set(p,"display","block"),p.nextElementSibling&&(a.set(p.nextElementSibling,
"max-height","calc(100% - 65px)"),a.set(p.nextElementSibling,"margin-top","5px"))):(a.set(p,"display","none"),p.nextElementSibling&&(a.set(p.nextElementSibling,"max-height","calc(100% - 40px)"),a.set(p.nextElementSibling,"margin-top","0px"))))},startup:function(){this.inherited(arguments);this._updatedDrawingOptions();if(this.appConfig.geometryService){this.geometryService=new Ua(this.appConfig.geometryService);"TabTheme"===this.appConfig.theme.name&&b.add(this.domNode.parentElement,"esriCTOverridePanelStyle");
this._createOverDef=new O;this._getSelectedThemeColor();this.config.editor.hasOwnProperty("displayPresetTop")&&!0===this.config.editor.displayPresetTop&&A.place("presetFieldsTableDiv","templatePickerDiv","before");k.subscribe("smartEditor/validate",g.hitch(this,this._validateEventHandler));this._progressDiv=d.create("div",{"class":"processing-indicator-panel"});var p=this.getParent().domNode.parentNode;p.insertBefore(this._progressDiv,p.firstChild);this.widgetActiveIndicator=d.create("div",{"class":"widgetActive widgetIndicator"});
p.insertBefore(this.widgetActiveIndicator,p.firstChild);void 0===this.config.editor.editDescription||null===this.config.editor.editDescription||"\x3cbr\x3e"===this.config.editor.editDescription?(this.config.editor.editDescription="",this.templateTitle.innerHTML=this.config.editor.editDescription,a.set(this.templateTitle,"display","none"),ma.set(this.templateTitle,"tabindex","-1")):(p=this.editorXssFilter.sanitize(this.config.editor.editDescription),this.templateTitle.innerHTML=Fa.decode(p),ma.set(this.templateTitle,
"aria-label",va.stripHTML(this.config.editor.editDescription)),a.set(this.templateTitle,"display","block"),ma.set(this.templateTitle,"tabindex","0"));this._orignls=q.widgets.attachmentEditor.NLS_attachments;this.loading=new Ia({hidden:!0});this.loading.placeAt(this.domNode);this.attachmentloading=new Ia({hidden:!0});this.loading.placeAt(this.domNode);this.editToolbar=new J(this.map);this.drawToolbar=new y(this.map);this._createDrawingToolbar();this.own(m(this.editToolbar,"graphic-move-stop, rotate-stop, scale-stop, vertex-move-stop, vertex-click",
g.hitch(this,this.geometryEdited)));this.own(m(this.drawToolbar,"draw-complete",g.hitch(this,function(z){z.geometry&&z.geometry.rings&&1===z.geometry.rings.length&&4>z.geometry.rings[0].length||(this.drawToolbar.deactivate(),this._addGraphicToLocalLayer(z))})));this.privilegeUtil=Sa.getInstance();this._setTheme();this.shelter.show();B.getInstance(this.map,this.map.itemInfo).then(g.hitch(this,function(z){var C="BoxTheme"===this.appConfig.theme.name?1050:1;setTimeout(g.hitch(this,function(){this.privilegeUtil.loadPrivileges(this._getPortalUrl()).then(g.hitch(this,
function(I){var K=!0;this._user=null;if(I){if(I=this.privilegeUtil.getUser())this._user=I.username;K=!0===this.privilegeUtil.userRole.canEditFeatures()?this._initControl(z):!0===this.privilegeUtil.userRole.canEditFeaturesFullControl?this._initControl(z):!1}else K=this._initControl(z);!1===K&&this._noPrivilegeHandler(window.jimuNls.noEditPrivileges);this.shelter.hide()}),g.hitch(this,function(){this._initControl(z)}));this.shelter.hide();this._workBeforeCreate()}),C)}))}else h({message:this.nls.geometryServiceURLNotFoundMSG})},
geometryEdited:function(){this._refreshButton&&this.config.editor.enableAttributeUpdates&&this.config.editor.enableAutomaticAttributeUpdates&&(b.remove(this._refreshButton,"hidden"),b.contains(this._refreshButton,"esriCTAutoUpdateOnMode")&&this._refreshAttributes());this.geometryChanged=!0;this._enableAttrInspectorSaveButton(this._validateAttributes())},_noPrivilegeHandler:function(p){this.templateTitle.innerHTML=p;ma.set(this.templateTitle,"aria-label",p);a.set(this.templateTitle,"display","block");
ma.set(this.templateTitle,"tabindex","0");this.templatePicker&&(A.style(this.templatePicker.domNode,"display","none"),this._mapClick&&(this._mapClick.remove(),this._mapClick=null));this.drawingTool&&A.style(this.drawingTool.domNode,"display","none");this.presetFieldsTableDiv&&A.style(this.presetFieldsTableDiv,"display","none");va.initFirstFocusNode(this.domNode,this.templateTitle);va.initLastFocusNode(this.domNode,this.templateTitle);va.focusFirstFocusNode(this.domNode);this.map.setInfoWindowOnClick(!0);
this.shelter.hide()},_getPortalUrl:function(p){return p?Ga.getStandardPortalUrl(p):Ga.getStandardPortalUrl(this.appConfig.portalUrl)},feature_action_select:function(p,z){z&&p&&0!==p.length&&("active"!==this.state&&this.widgetManager.activateWidget(this),p=p[0],this._validateFeatureChanged()&&this.currentFeature?this.config.editor.displayPromptOnSave&&!0===this.config.editor.displayPromptOnSave?this._promptToResolvePendingEdit(!1,{featureLayer:z,feature:p},!1,!0):this.load_from_featureaction(z,p):
this.load_from_featureaction(z,p))},load_from_featureaction:function(p,z){this._clearLayerSelection();this.contentWrapper&&this.contentWrapper.parentNode&&!b.contains(this.contentWrapper,"hidden")&&(this.contentWrapper.parentNode.removeChild(this.contentWrapper),c(".esriAttrPaginationDiv",this.domNode).forEach(g.hitch(this,function(C){d.destroy(C)})));this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo=
{};this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;this.map.infoWindow.hide();0<this.viewedLayerDetails.length&&(this.loading.show(),p=this._getLayerInfoByID(this.viewedLayerDetails.shift()),z=this.viewedFeatureDetails.shift(),this._traverseToSelectedFeature(p,z))},_clearLayerSelection:function(){this._attributeInspectorCollection&&0<this._attributeInspectorCollection.length&&f.forEach(this._attributeInspectorCollection,function(z){if(z){if(z.layerInfos){var C=B.getInstanceSync();
f.forEach(z.layerInfos,function(I){var K=I.featureLayer;K.clearSelection();K.refresh();K=I.featureLayer.url;I.featureLayer.hasOwnProperty("originalLayerId")&&(layID=I.featureLayer.originalLayerId,I.id!=layID&&(K=I.featureLayer,K.clearSelection(),K.refresh(),I=C.getLayerInfoById(layID),K=I.layerObject.url));var X=K.split("/FeatureServer")[0];f.forEach(C.getLayerInfoArray(),function(U){"undefined"!==typeof U.layerObject.url&&null!==U.layerObject.url&&U.layerObject.url.includes("/MapServer")&&U.layerObject.url.includes(X)&&
U.layerObject.refresh()},this)})}z.destroy()}});if(this.attrInspector){if(this.attrInspector.layerInfos){var p=B.getInstanceSync();f.forEach(this.attrInspector.layerInfos,function(z){var C=z.featureLayer;!C.isQueryable()&&0<=C.graphics.length&&C.remove(C.graphics[0]);C.clearSelection();C.refresh();C=z.featureLayer.url;z.featureLayer.hasOwnProperty("originalLayerId")&&(layID=z.featureLayer.originalLayerId,z.id!=layID&&(C=z.featureLayer,C.clearSelection(),C.refresh(),z=p.getLayerInfoById(layID),C=z.layerObject.url));
var I=C.split("/FeatureServer")[0];f.forEach(p.getLayerInfoArray(),function(K){"undefined"!==typeof K.layerObject.url&&null!==K.layerObject.url&&K.layerObject.url.includes("/MapServer")&&K.layerObject.url.includes(I)&&K.layerObject.refresh()},this)})}this.attrInspector.destroy()}},_traverseToSelectedFeature:function(p,z){var C=new O;if(0<this.viewedFeatureDetails.length){var I=this.viewedFeatureDetails[0];this.viewedLayerDetails[0]===this.viewedLayerDetails[1]&&(I=this.viewedFeatureDetails[1])}this._createAttributeInspector([p],
!1,null,C,I);z&&Ha.getInstance().setSelection(p.featureLayer,z).then(g.hitch(this,function(){this.updateFeatures=p.featureLayer.getSelectedFeatures();0<this.updateFeatures.length&&this._showTemplate(!1)}));C.then(g.hitch(this,function(){if(0<this.viewedLayerDetails.length){var K=this.viewedLayerDetails.shift();this.viewedFeatureDetails.shift();0<this.viewedLayerDetails.length&&this.viewedLayerDetails[0]===K&&(this.viewedLayerDetails.shift(),this.viewedFeatureDetails.shift());(K=c("[layerid\x3d'"+
K+"']",this.contentWrapper)[0])&&K.click()}0===this.viewedLayerDetails.length&&this.loading.hide()}))},_getFeatureIndexToSelect:function(p){var z=-1;var C=p.attributes[p._layer.objectIdField];f.some(this.attrInspector._selection,g.hitch(this,function(I,K){if(I.attributes[I._layer.objectIdField]===C)return z=K,!0}));return z},beginEditingByFeatures:function(p,z,C,I){this._copyFeaturesObj&&(this.currentDrawType=null,this._copyFeaturesObj.cancelBtnClicked());this.cacheLayer&&this.cacheLayer.clear();
this.viewedLayerDetails=C;this.viewedFeatureDetails=I;z&&p&&0!==p.length&&this._createOverDef.then(g.hitch(this,function(){this.feature_action_select(p,z)}))},onReceiveData:function(p,z,C,I){this.config.editor&&this.config.editor.hasOwnProperty("listenToGF")&&!0===this.config.editor.listenToGF&&"GroupFilter"===p&&(Array.isArray(C.message)?0<C.message.length&&f.forEach(C.message,g.hitch(this,function(K){K.hasOwnProperty("fields")&&K.hasOwnProperty("values")&&(K.hasOwnProperty("groupName")?this._setPresetValueValue(null,
K.values[0],K.groupName):f.forEach(K.fields,function(X){this._setPresetValueValue(X,K.values[0],null)},this))})):C.message.hasOwnProperty("fields")&&C.message.hasOwnProperty("values")&&(C.message.hasOwnProperty("groupName")?this._setPresetValueValue(null,C.message.values[0],C.message.groupName):f.forEach(C.message.fields,function(K){this._setPresetValueValue(K,C.message.values[0],null)},this)))},_setTheme:function(){var p;if("DartTheme"===this.appConfig.theme.name)va.loadStyleLink("dartOverrideCSS",
this.folderUrl+"/css/dartTheme.css",null);else if(p=document.getElementById("dartOverrideCSS"))p.disabled=!0;if("LaunchpadTheme"===this.appConfig.theme.name)va.loadStyleLink("launchpadOverrideCSS",this.folderUrl+"/css/launchpadTheme.css",null);else if(p=document.getElementById("launchpadOverrideCSS"))p.disabled=!0;if("DashboardTheme"===this.appConfig.theme.name)va.loadStyleLink("dashboardOverrideCSS",this.folderUrl+"/css/dashboardTheme.css",null);else if(p=document.getElementById("dashboardOverrideCSS"))p.disabled=
!0},_mapClickHandler:function(p){if(!0===p&&!1===this._attrInspIsCurrentlyDisplayed){if(this.map.setInfoWindowOnClick(!1),void 0===this._mapClick||null===this._mapClick)this._mapClick=m(this.map,"click",g.hitch(this,this._onMapClick))}else!0===p&&!0===this._attrInspIsCurrentlyDisplayed?(this._mapClick&&(this._mapClick.remove(),this._mapClick=null),this.map.setInfoWindowOnClick(!0)):(this._mapClick&&(this._mapClick.remove(),this._mapClick=null),this.map.setInfoWindowOnClick(!0),this.drawToolbar&&this.drawToolbar.deactivate())},
destroy:function(){this.inherited(arguments);this.attrInspector&&this.attrInspector.destroy();this.attrInspector=null;this.templatePicker&&this.templatePicker.destroy();this.templatePicker=null;this.currentDrawType&&(this.currentDrawType=null);if(null!==this._menus&&void 0!==this._menus){for(var p in xa)this._menus.hasOwnProperty(p)&&null!==this._menus[p]&&void 0!==this._menus[p]&&this._menus[p].destroyRecursive(!1);this._menus={}}null!==this.drawingTool&&void 0!==this.drawingTool&&(this.drawingTool.destroyRecursive(!1),
this.drawingTool=null);this._enableFeatureReduction();this.inherited(arguments)},onActive:function(){if(!0===this._userHasPrivilege&&(b.contains(this.widgetActiveIndicator,"widgetNotActive")&&b.remove(this.widgetActiveIndicator,"widgetNotActive"),b.add(this.widgetActiveIndicator,"widgetActive"),this.map&&(this._disableFeatureReduction(),this.templatePicker&&this.templatePicker.update(),this._mapClickHandler(!0),this._disconnectLayerSelectionClearedOutside(),!1===this._attrInspIsCurrentlyDisplayed))){var p=
null;this.drawingTool&&this.currentDrawType&&(p=this.currentDrawType);this._activateTemplateToolbar(p)}},_enableFeatureReduction:function(){!1===this.clusterState&&(f.forEach(this.featureReductionEnabledLayers,function(p){p.isFeatureReductionEnabled()||p.enableFeatureReduction()}),f.forEach(this.rendererDifferentLayers,function(p){p._layerRenderer&&(p.setRenderer(p._layerRenderer),p.redraw())}),this.clusterState=!0)},_disableFeatureReduction:function(){!0===this.clusterState&&(f.forEach(this.featureReductionEnabledLayers,
function(p){p.isFeatureReductionEnabled()&&p.disableFeatureReduction()}),f.forEach(this.rendererDifferentLayers,function(p){p._serviceRendererJson&&(p.setRenderer(Pa.fromJson(p._serviceRendererJson)),p.redraw())}),this.clusterState=!1)},_handleLayerSelectionClear:function(p){p&&p.layerInfos&&f.forEach(p.layerInfos,g.hitch(this,function(z){z.featureLayer&&(z=m(z.featureLayer,"selection-clear",g.hitch(this,this._onLayerSelectionCleared)),this.own(z),this._layerClearSelectionHandles.push(z))}))},_onLayerSelectionCleared:function(){this._LayerSelectionClearedTimer&&
clearTimeout(this._LayerSelectionClearedTimer);this._LayerSelectionClearedTimer=setTimeout(g.hitch(this,function(){this._layerChangedOutside||(this._layerChangedOutside=!0,this._navigateToMain())}),100)},_navigateToMain:function(){this._attrInspIsCurrentlyDisplayed=!1;this._showTemplatePicker();this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this.currentFeature=null;this.geometryChanged=
!1;this.currentLayerInfo=null},_connectLayerSelectionClearedOutside:function(){this._layerChangedOutside=!1;this._disconnectLayerSelectionClearedOutside();this._attrInspIsCurrentlyDisplayed&&(this._attributeInspectorCollection&&0<this._attributeInspectorCollection.length&&f.forEach(this._attributeInspectorCollection,g.hitch(this,function(p){p&&this._handleLayerSelectionClear(p)})),this.attrInspector&&this._handleLayerSelectionClear(this.attrInspector))},_disconnectLayerSelectionClearedOutside:function(){this._layerClearSelectionHandles&&
0<this._layerClearSelectionHandles.length&&f.forEach(this._layerClearSelectionHandles,g.hitch(this,function(p){p.remove()}));this._layerClearSelectionHandles=[]},onDeActive:function(){b.contains(this.widgetActiveIndicator,"widgetActive")&&b.remove(this.widgetActiveIndicator,"widgetActive");b.add(this.widgetActiveIndicator,"widgetNotActive");this.map&&this._mapClickHandler(!1);this._enableFeatureReduction();this._connectLayerSelectionClearedOutside()},onOpen:function(){!0===this._userHasPrivilege&&
(this._workBeforeCreate(),setTimeout(g.hitch(this,function(){this.widgetManager.activateWidget(this)}),100));if(this.templatePicker){var p;this.templatePicker.update();(p=c(".esriTemplatePicker",this.domNode))&&p[0]&&("none"===a.get(p[0],"display")?c(".presetFieldsTableDiv")[0].style.display="none":this.config.hasOwnProperty("attributeActionGroups")&&0<Object.keys(this.config.attributeActionGroups.Preset).length&&!b.contains(c(".ee-presetValueTableDiv",this.domNode)[0],"esriCTHidden")&&(c(".presetFieldsTableDiv")[0].style.display=
"block"),this._attrInspIsCurrentlyDisplayed?this._setWidgetFirstFocusNode("AI",!0):this._setWidgetFirstFocusNode("templatePicker",!0))}},_getTableInfos:function(){var p=[],z=this._jimuLayerInfos.getTableInfoArray();f.forEach(z,function(C){p.push(C.getLayerObject())},this);return E(p)},_initControl:function(p){this._userHasPrivilege=!0;this._jimuLayerInfos=p;this._getTableInfos();this.addressUtils=new Va({config:this.config});p=20;this.config.editor.hasOwnProperty("defaultPixelsTolerance")&&(p=this.config.editor.defaultPixelsTolerance);
this._intersectionUtils=new Wa({_jimuLayerInfos:this._jimuLayerInfos,map:this.map,defaultToleranceSettings:this.config.editor.defaultToleranceSettings,defaultPixelsTolerance:p});p=!1;this.config.editor&&this.config.editor.layerInfos&&(p=0<this.config.editor.layerInfos.length);this.config.editor.hasOwnProperty("honorWebMapConfiguration")&&this.config.editor.honorWebMapConfiguration&&(p=!1);this.config.editor.configInfos=Q.getConfigInfos(this._jimuLayerInfos,this.config.editor.layerInfos,!1,p);!1===
p&&f.forEach(this.config.editor.configInfos,function(z){z._editFlag=!0});this.config.editor.hasOwnProperty("honorWebMapConfiguration")&&this.config.editor.honorWebMapConfiguration&&f.forEach(this.config.editor.configInfos,g.hitch(this,function(z){this._updateConfigWithDefaultWebMapSettings(z)}));if(void 0===this.config.editor.configInfos||null===this.config.editor.configInfos||0===this.config.editor.configInfos.length)return!1;this._processConfig();f.forEach(this.config.editor.configInfos,function(z){z.featureLayer.name=
z.layerInfo.title;z=z.featureLayer;var C=z.renderer,I=C.toJson(),K=n.parse(z._json);K.hasOwnProperty("layerDefinition")&&(K=K.layerDefinition);var X=null;K.hasOwnProperty("drawingInfo")&&K.drawingInfo.hasOwnProperty("renderer")&&(X=K.drawingInfo.renderer);z._layerRenderer=C;z._serviceRendererJson=X;z.hasFeatureReduction&&z.hasFeatureReduction()?this.featureReductionEnabledLayers.push(z):I.hasOwnProperty("type")&&"heatmap"==I.type&&this.rendererDifferentLayers.push(z)},this);this._disableFeatureReduction();
this.config.editor.hasOwnProperty("autoSaveEdits")?this.config.editor.autoSaveEdits&&((this._autoSaveRuntime=this.config.editor.autoSaveEdits)?aa.byId("autoSaveSwitch").set("checked",!0):aa.byId("autoSaveSwitch").set("checked",!1)):this.config.editor.autoSaveEdits=!1;this._createEditor();this.fetchDataByName("GroupFilter");this.widgetManager.activateWidget(this);this._createOverDef.resolve();this._setWidgetFirstFocusNode("templatePicker",!0);return!0},_updateConfigWithDefaultWebMapSettings:function(p,
z){z&&(p.layerInfo=this._jimuLayerInfos.getLayerOrTableInfoById(p.featureLayer.id));var C=Q.createDefaultConfigInfo(p.layerInfo);g.mixin(p,C);p.fieldInfos=Q.getDefaultEditableFieldInfos(p.layerInfo,!1);p.fieldInfos=f.filter(p.fieldInfos,function(I){return"esriFieldTypeBlob"===I.type||"esriFieldTypeGlobalID"===I.type||"esriFieldTypeRaster"===I.type||"esriFieldTypeXML"===I.type||"esriFieldTypeOID"===I.type?!1:!0});p.allowDelete=C.featureLayer.layerAllowsDelete;z&&(p.configFeatureLayer=p.featureLayer,
p.featureLayer=p.layerInfo.layerObject,p.showDeleteButton=!1);p.relationshipInfos&&f.forEach(p.relationshipInfos,g.hitch(this,function(I){this._updateConfigWithDefaultWebMapSettings(I,!0)}))},_addFilterEditor:function(p){!0===this.config.editor.useFilterEditor&&this.templatePicker&&(this._filterEditor?this._filterEditor.setTemplatePicker(this.templatePicker,p):(this._filterEditorNode=d.create("div",{}),this.templatePickerDiv.insertBefore(this._filterEditorNode,this.templatePicker.domNode),this._filterEditor=
new Ra({_templatePicker:this.templatePicker,_layers:p,map:this.map,nls:this.nls},this._filterEditorNode)))},_activateEditToolbar:function(p){var z=p.getLayer();0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate();switch(z.geometryType){case "esriGeometryPoint":this.editToolbar.activate(J.MOVE,p);break;case "esriGeometryPolyline":case "esriGeometryPolygon":this.editToolbar.activate(J.EDIT_VERTICES|J.MOVE|J.ROTATE|J.SCALE,p)}},_polygonToPolyline:function(p){var z=new da;f.forEach(p.rings,
function(C){z.addPath(C)});z.spatialReference=p.spatialReference;return z},_addRelatedFeatureToLocalLayer:function(p,z){var C,I=null;this.attrInspector&&this.attrInspector._attachmentUploader&&null!==this.attrInspector._attachmentUploader&&this.attrInspector._attachmentUploader.clear();this._removeLocalLayers();this.cacheLayer=this._cloneLayer(p.featureLayer.layerObject);var K=m(this.cacheLayer,"load",g.hitch(this,function(){K.remove();I=this._getLayerInfoForLocalLayer(this.cacheLayer);C=[I];this._createAttributeInspector([I],
!0,p.featureLayer.layerObject,null,null,z);var X=g.clone(p.attributes);this._usePresetValues&&this._modifyAttributesWithPresetValues(X,C[0],null,z);var U=new ba(null,null,X);U.preEditAttrs=n.parse(n.stringify(U.attributes));this.cacheLayer.applyEdits([U],null,null,g.hitch(this,function(ca){var fa=new M;fa.objectIds=[ca[0].objectId];this.cacheLayer.selectFeatures(fa,W.SELECTION_NEW,g.hitch(this,function(){this.currentFeature=this.updateFeatures[0]=U;this.getConfigDefaults();this.geometryChanged=!1;
this._attributeInspectorTools&&this._attributeInspectorTools.triggerFormValidation();var ka=this.currentFeature.getLayer();this.currentLayerInfo=this._getLayerInfoByID(ka.id);this.currentLayerInfo.isCache=!0;this._toggleDeleteButton(!1);this._enableAttrInspectorSaveButton(this._validateAttributes(),!0);this._toggleAttrInspectorNavButtons()}))}));this._showTemplate(!1,!1);this.config.editor.hasOwnProperty("autoSaveEdits")&&!0===this._autoSaveRuntime&&setTimeout(g.hitch(this,function(){var ca=c(".saveButton",
this.buttonHeader)[0];ca&&m.emit(ca,"click",{cancelable:!0,bubbles:!0})}),100)}))},_getCopyAttributes:function(p,z){var C=[],I={};var K=new O;var X=new O;var U=!1,ca=!1,fa;for(fa in p.fieldValues){for(var ka=p.fieldValues[fa],ha=0;ha<ka.length;ha++)"Address"===ka[ha].actionName&&ka[ha].enabled&&(U=!0),"Intersection"===ka[ha].actionName&&ka[ha].enabled&&(ca=!0);if(U&&ca)break}ca&&C.push(this._intersectionUtils.getDistinctLayers(p,z));C.push(X);Ja.getCoordinatesData(z,this.geometryService).then(g.hitch(this,
function(ja){I.Coordinates=ja;this._getMyLocationInfo().then(g.hitch(this,function(pa){I.MyLocation=pa;U?this.addressUtils.locateAddress(ja.MapSpatialReference).then(g.hitch(this,function(ta){I.Address=ta;X.resolve(I)})):(I.Address={},X.resolve(I))}))}),g.hitch(this,function(){I.Coordinates={};I.Address={};I.MyLocation={Coordinates:{}};X.resolve(I)}));E(C).then(g.hitch(this,function(ja){ca?(I.Intersection=ja[0].result,I.multipleValues=ja[0].multipleValues):(I.Intersection={},I.multipleValues=void 0);
K.resolve(I)}));return K.promise},_getMyLocationInfo:function(){var p=new O;p.resolve({Coordinates:{}});return p},_addGraphicToLocalLayer:function(p,z){if(void 0!==this.templatePicker&&null!==this.templatePicker&&this.templatePicker.getSelected()){var C=this.templatePicker.getSelected(),I,K=null;this.attrInspector&&(this.attrInspector._attachmentUploader&&null!==this.attrInspector._attachmentUploader&&this.attrInspector._attachmentUploader.clear(),this.attrInspector.destroy(),this.attrInspector=null);
this._removeLocalLayers();this.cacheLayer=this._cloneLayer(this.templatePicker.getSelected().featureLayer);var X=m(this.cacheLayer,"load",g.hitch(this,function(){X.remove();this.cacheLayer.setSelectionSymbol(this._getSelectionSymbol(this.cacheLayer.geometryType,!0));K=this._getLayerInfoForLocalLayer(this.cacheLayer);I=[K];this._createAttributeInspector([K],!0,this.templatePicker.getSelected().featureLayer);this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&
setTimeout(g.hitch(this,function(){2>this._traversal.length&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check())}),100);var U=g.clone(C.template.prototype.attributes);"esriGeometryPolyline"===this.cacheLayer.geometryType&&"polygon"===p.geometry.type&&(p.geometry=this._polygonToPolyline(p.geometry));this.loading.show();this._getCopyAttributes(K,p.geometry).then(g.hitch(this,function(ca){if(z){var fa=g.clone(z),ka;for(ka in fa)if(!U.hasOwnProperty(ka)||null===U[ka]||this.config.editor.overrideDefaultsByCopiedFeature)U[ka]=
fa[ka]}this._modifyAttributesWithPresetValues(U,I[0],ca);this.loading.hide();var ha=new ba(p.geometry,null,U);ha.preEditAttrs=n.parse(n.stringify(ha.attributes));this.cacheLayer.applyEdits([ha],null,null,g.hitch(this,function(ja){var pa=new M;pa.objectIds=[ja[0].objectId];this.cacheLayer.selectFeatures(pa,W.SELECTION_NEW,g.hitch(this,function(){this.currentFeature=this.updateFeatures[0]=ha;this.getConfigDefaults();this.geometryChanged=!1;this._attributeInspectorTools&&this._attributeInspectorTools.triggerFormValidation();
var ta=this.currentFeature.getLayer();this.currentLayerInfo=this._getLayerInfoByID(ta.id);this.currentLayerInfo.isCache=!0;this._toggleDeleteButton(!1);this._enableAttrInspectorSaveButton(this._validateAttributes());(ta=c(".esriAttrPaginationDiv",this.domNode))&&ta[0]&&a.set(ta[0],"display","none");setTimeout(g.hitch(this,function(){this._addValuePicker(ca)}),200)}))}));this._showTemplate(!1,!1);this.config.editor.hasOwnProperty("autoSaveEdits")&&!0===this._autoSaveRuntime&&setTimeout(g.hitch(this,
function(){var ja=c(".saveButton",this.buttonHeader)[0];ja&&m.emit(ja,"click",{cancelable:!0,bubbles:!0})}),100)}))}))}},_cancelEditingFeature:function(p){this.currentFeature&&(p?this._showTemplate(!0,!1):(this.currentFeature.preEditAttrs&&(this.currentFeature.attributes=n.parse(n.stringify(this.currentFeature.preEditAttrs))),this.currentFeature.origGeom&&(this.currentFeature.geometry=Z.fromJson(this.currentFeature.origGeom)),this.currentFeature.getLayer().refresh(),this.attrInspector.refresh(),this._resetEditingVariables()))},
_addDateFormat:function(p){p&&p.format&&null!==p.format&&p.format.dateFormat&&null!==p.format.dateFormat&&0<=p.format.dateFormat.toString().toUpperCase().indexOf("TIME")&&(p.format.time=!0)},_processLayerFields:function(p){f.forEach(p,function(z){void 0!==z.domain&&null!==z.domain&&void 0!==z.domain.type&&null!==z.domain.type&&"range"===z.domain.type&&!1===z.domain.hasOwnProperty("range")&&(z.domain.range=[z.domain.minValue,z.domain.maxValue])});return p},_iterateCollection:function(p){return function(z){for(var C=
0;p[C];C++)z(p[C],C)}},_cloneLayer:function(p){var z=this._processLayerFields(p.fields);z={layerDefinition:{id:0,name:p.name+this.nls.editorCache,type:"Feature Layer",displayField:p.displayField,description:"",copyrightText:"",relationships:[],geometryType:p.geometryType,minScale:0,maxScale:0,extent:p.fullExtent,drawingInfo:{renderer:p.renderer,transparency:0,labelingInfo:null},hasAttachments:p.hasAttachments,htmlPopupType:"esriServerHTMLPopupTypeAsHTMLText",objectIdField:p.objectIdField,globalIdField:p.globalIdField,
typeIdField:p.typeIdField,fields:f.map(z,function(I){return-1<I.name.indexOf("expression/expr")?n.stringify(I):I.toJson()}),types:p.types&&f.map(p.types,function(I){return I.toJson()}),templates:p.templates&&f.map(p.templates,function(I){return I.toJson()}),capabilities:"Create,Delete,Query,Update,Uploads,Editing",editFieldsInfo:void 0===p.editFieldsInfo?null:p.editFieldsInfo}};var C=p.fields.map(function(I){return I.name});this._eventHandler=this.own(m(p,"visibility-change",g.hitch(this,function(){})));
z=new W(z,{id:p.id+"_lfl",outFields:C});z.visible=!0;z.renderer=p.renderer;z.originalLayerId=p.id;z._wabProperties={isTemporaryLayer:!0};this.map.addLayer(z);return z},_endsWith:function(p,z){return-1!==p.indexOf(z,p.length-z.length)},_validateEventHandler:function(){this._enableAttrInspectorSaveButton(this._validateAttributes())},_validateAttributes:function(p){p="undefined"!==typeof p&&null!==p?p:!0;var z=[],C=!0,I=this._validateRequiredFields(),K=this._validateFeatureChanged(),X=[],U=!0;void 0!==
this._smartAttributes&&null!==this._smartAttributes&&(X=this._smartAttributes.toggleFields(p));void 0!==this._attributeInspectorTools&&null!==this._attributeInspectorTools&&(U=this._attributeInspectorTools.formValid());K&&this.currentLayerInfo&&this.currentLayerInfo.attachmentValidations&&(f.forEach(this.currentLayerInfo.attachmentValidations.Actions,g.hitch(this,function(ca){var fa={};ca.filter&&this._smartAttributes&&(fa.actionType=ca.actionName,fa.result=this._smartAttributes.processFilter(ca.filter),
z.push(fa))})),this.attrInspector._attachmentUploader?C=this.performAction(this.attrInspector._attachmentUploader,z,!0):this.attrInspector._attachmentEditor&&(C=this.performAction(this.attrInspector._attachmentEditor,z,!1)));return Q.isObjectEmpty(I)&&0===X.length&&U&&K&&C},performAction:function(p,z,C){var I=!0;a.set(this.attrInspector.attachmentsRequiredMsg,"display","none");f.some(z,g.hitch(this,function(K){switch(K.actionType){case "Hide":if(K.result)return this.currentAction=K.actionType,p.currentAction=
K.actionType,a.set(p.domNode,"display","none"),!0;a.set(p.domNode,"display","block");break;case "Disabled":if(K.result)return this.currentAction=K.actionType,p.currentAction=K.actionType,C?a.set(p.domNode,"display","none"):this._disableAttachments(p,!0,C),!0;this._disableAttachments(p,!1,C);a.set(p.domNode,"display","block");break;case "Required":if(K.result)return this.currentAction=K.actionType,p.currentAction=K.actionType,a.set(p.domNode,"display","block"),this._hasAddedAnyAttachments(p,C)?(I=
!0,a.set(this.attrInspector.attachmentsRequiredMsg,"display","none")):(I=!1,a.set(this.attrInspector.attachmentsRequiredMsg,"display","block")),!0;this.currentAction=null;p.currentAction=null}}));this._setWidgetFirstFocusNode("AI",!1);return I},_disableAttachments:function(p,z,C){var I=z?"none":"block";C||(z=this.attrInspector._attachmentEditor.domNode,c(".attwarning",z)[0]&&a.set(c(".attwarning",z)[0],"display",I),a.set(p._uploadForm,"display",I),f.forEach(p._attachmentList.childNodes,g.hitch(this,
function(K){"#text"!==K.nodeName&&(K=c(".deleteAttachment",K)[0])&&a.set(K,"display",I)})))},_onUpdateAttachmentListAdd508Support:function(){this.attrInspector&&this.attrInspector._attachmentEditor&&v.after(this.attrInspector._attachmentEditor,"_updateConnects",g.hitch(this,function(){this._add508SupportToAttachmentsDeleteBtn()}))},_add508SupportToAttachmentsDeleteBtn:function(){this._support508ToDeleteButtonTimer&&clearInterval(this._support508ToDeleteButtonTimer);this._support508ToDeleteButtonTimer=
setInterval(g.hitch(this,function(){clearInterval(this._support508ToDeleteButtonTimer);this.attrInspector._attachmentEditor&&this.attrInspector._attachmentEditor._attachmentList&&f.forEach(this.attrInspector._attachmentEditor._attachmentList.childNodes,g.hitch(this,function(p){if("#text"!==p.nodeName){var z=c(".deleteAttachment",p)[0];z&&(ma.set(z,"role","button"),ma.set(z,"tabindex","0"),ma.set(z,"aria-label",this.nls.deleteAttachment),this.own(m(z,"keydown",g.hitch(this,function(C){C.keyCode!==
l.ENTER&&C.keyCode!==l.SPACE||z.click()}))))}}))}),300)},_hasAddedAnyAttachments:function(p,z){var C=!1;if(!z)return 0<p._attachmentList.childNodes.length&&"#text"!==p._attachmentList.childNodes[0].nodeName?!0:!1;for(z=0;z<p._attachmentList.childNodes.length;z++)if(p._attachmentList.childNodes[z].childNodes&&0<p._attachmentList.childNodes[z].childNodes.length&&p._attachmentList.childNodes[z].childNodes[1].value&&0<p._attachmentList.childNodes[z].childNodes[1].value.length){C=!0;break}return C},_toggleEditGeoSwitch:function(p){var z=
!1;void 0===this._editGeomSwitch||null===this._editGeomSwitch||1<this._traversal.length||(!1===p&&this.currentLayerInfo.featureLayer.visibleAtMapScale?this.currentLayerInfo&&this.currentLayerInfo._editFlag?(A.style(this._editGeomSwitch.domNode.parentNode,"display","block"),z=!0):(A.style(this._editGeomSwitch.domNode.parentNode,"display","none"),z=!1):(A.style(this._editGeomSwitch.domNode.parentNode,"display","none"),z=!1),this._turnEditGeometryToggleOff(),setTimeout(g.hitch(this,function(){z=z&&this._editGeomSwitch.checked;
this._toggleAttributeButtonVisibility(z);this._toggleLocateButtonVisibility(z);this._toggleXYCoordinatesButtonVisibility(z);this._toggleMapNavigationButtonVisibility(z)}),500))},_recordLoadeAttInspector:function(){this.getConfigDefaults()},editGeoCheckChange:function(){return function(){this._editGeometry(this._editGeomSwitch.checked)}},_attributeInspectorChangeRecord:function(p){this._validateFeatureChanged()&&this.currentFeature||this._postFeatureSave(p);this._recordLoadeAttInspector()},_addWarning:function(){if(0===
c(".attwarning",this.attrInspector.domNode).length){var p=d.create("div",{"class":"attwarning"});p.innerHTML=this.nls.attachmentSaveDeleteWarning;void 0!==this.attrInspector._attachmentEditor&&null!==this.attrInspector._attachmentEditor&&this.attrInspector._attachmentEditor.domNode.appendChild(p)}},_hasAnyEditableLayerInRelation:function(p){var z=!1;f.forEach(p,g.hitch(this,function(C){if(z)return!0;!0===C._editFlag?z=!0:C.relationshipInfos&&0<C.relationshipInfos.length&&(z=this._hasAnyEditableLayerInRelation(C.relationshipInfos))}));
return z},_processRelationAndShowAttrInspector:function(p,z,C,I,K,X){var U;this.contentWrapper&&this.contentWrapper.parentNode&&!b.contains(this.contentWrapper,"hidden")&&(this.contentWrapper.parentNode.removeChild(this.contentWrapper),this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv));this.contentWrapper=d.create("div",{"class":"detailsContainer"},this.mainContainer);X||(this.navButtonsDiv=d.create("div",{"class":"esriAttributeInspector esriAttrPaginationDiv"}),
d.place(this.attrInspector.navButtons,this.navButtonsDiv,"first"),d.place(this.navButtonsDiv,this.mainContainer,"before"));var ca=d.create("div",{"class":"esriCTItemListContainer"},this.contentWrapper);z&&z.feature&&(C=z.feature._layer,this.currentFeature&&C.id===this.currentFeature._layer.id&&this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!1)),this.currentFeature=z.feature,this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes)),
this.currentLayerInfo=this._getLayerInfoByID(C.id),this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!0)),this._toggleDeleteButton(this.attrInspector._currentLInfo.allowDelete),this.loading.show(),setTimeout(g.hitch(this,function(){!this.attrInspector._attachmentEditor||this.currentLayerInfo.isEditable&&this.currentLayerInfo._editFlag&&(!this.currentLayerInfo||this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate)||this._disableAttachments(this.attrInspector._attachmentEditor,
!0,!1);this.loading.hide()}),2E3),setTimeout(g.hitch(this,function(){this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&2>this._traversal.length&&this.currentFeature&&this.currentFeature.geometry&&(this.currentFeature.origGeom=this.currentFeature.geometry.toJson(),!this.currentLayerInfo.disableGeometryUpdate&&this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate&&(!this.currentLayerInfo.featureLayer.hasZ||
this.currentLayerInfo.featureLayer.hasZ&&this.currentLayerInfo.featureLayer.enableZDefaults)&&(!this.currentLayerInfo.featureLayer.hasM||this.currentLayerInfo.featureLayer.hasM&&this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues)?this._activateEditToolbar(this.currentFeature):0!==this.editToolbar.getCurrentState().tool&&(this.editToolbar.deactivate(),this._editingEnabled=!1))}),1E3));C&&(U=this.addItem(C.name,this.config.editor.expandMainLayerOnLoad,ca,C.id,X,C,!0));if(p&&z.feature){0<this._traversal.length?
this._traversal[this._traversal.length-1]=z.feature._layer.id:this._traversal.push(z.feature._layer.id);C=this._getRelationshipInfo(z.feature);p={attributes:g.clone(z.feature.attributes),_layer:z.feature._layer};if(K){var fa=[];f.forEach(K,function(ha){fa.push(ha.attributes[ha._layer.objectIdField])})}if(C&&0<C.length){var ka=[];f.forEach(C,g.hitch(this,function(ha){var ja=ha._editFlag;!ha._editFlag&&ha.relationshipInfos&&0<ha.relationshipInfos.length&&(ja=this._hasAnyEditableLayerInRelation(ha.relationshipInfos));
ja&&ha.featureLayer&&ha.hasOwnProperty("relationshipId")&&ka.push(ha)}));0<ka.length&&((K=c(".esriCTItemContent",ca))&&K[0]&&b.remove(K[0],"esriCTRelatedItemContent"),this._relatedTablesInfo[z.feature._layer.id]={},this._relatedTablesInfo[z.feature._layer.id]=new qa({relationshipInfo:ka,layerInfosObj:this._jimuLayerInfos,parentFeature:p,parentFeatureIndexInAI:this.attrInspector._featureIdx,parentFieldInfos:this.currentLayerInfo.fieldInfos,config:this.config,nls:this.nls,mapSpatialReference:this.map.spatialReference},
d.create("div")),this.own(m(this._relatedTablesInfo[z.feature._layer.id],"addRelatedRecord",g.hitch(this,function(ha,ja,pa,ta,wa){b.add(this.contentWrapper,"hidden");b.add(this.buttonHeader,"hidden");a.set(this.navButtonsDiv,"display","none");this.attrInspector.ctStoredFeatureIndex=ta;this._attributeInspectorCollection.push(this.attrInspector);this._nodesCollection.push(this.contentWrapper);this._buttonsWrapper.push(this.buttonHeader);this._paginationNodeCollection.push(this.navButtonsDiv);this._traversal.push(pa);
this.currentRelatedDom=ja;this._addRelatedFeatureToLocalLayer(ha,wa);this._addingNewRelatedRecord=!0}))),this.own(m(this._relatedTablesInfo[z.feature._layer.id],"titleClicked",g.hitch(this,function(ha,ja,pa,ta,wa,ya){this.addNewRelatedRecord&&(pa=!0,this.addNewRelatedRecord=!1);this._editGeomSwitch.set("checked",!1);!pa&&this.currentFeature&&this.config.editor.displayPromptOnSave&&this._validateFeatureChanged()?this._promptToResolvePendingEdit(!1,null,!0).then(g.hitch(this,function(){this._fetchRelatedRecords(pa,
z.feature._layer,ja,ha,wa,ta,fa,ya);fa=null}),function(){}):(this._fetchRelatedRecords(pa,z.feature._layer,ja,ha,wa,ta,fa,ya),fa=null)}))),this.own(m(this._relatedTablesInfo[z.feature._layer.id],"addRelatedItemContent",g.hitch(this,function(ha){ha?this.addItem(this.nls.relatedItemTitle,this.config.editor.expandRelatedTableOnLoad,ca,null,!1,null,!1):(ha=c(".esriCTItemContent",ca))&&ha[0]&&b.add(ha[0],"esriCTRelatedItemContent")}))),this._relatedTablesInfo[z.feature._layer.id].startup())}else this.config.editor.expandMainLayerOnLoad||
this._togglePanel(U)}I&&I.resolve()},_checkValidRelationShips:function(p,z){f.forEach(p,g.hitch(this,function(C){C.featureLayer&&C.hasOwnProperty("relationshipId")&&f.some(z.relationships,g.hitch(this,function(I){}))}))},_fetchRelatedRecords:function(p,z,C,I,K,X,U,ca){this._getRelatedRecordsByRelatedQuery(z,C,I,K).then(g.hitch(this,function(fa){if(fa&&0===fa.length)p&&(b.remove(this.contentWrapper,"hidden"),this.attrInspector.refresh(),setTimeout(g.hitch(this,function(){a.set(this.attrInspector.navButtons,
"display",!this.attrInspector._hideNavButtons&&1<this.attrInspector._numFeatures?"":"none");this.attrInspector.navMessage.innerHTML=Aa.substitute({idx:this.attrInspector._featureIdx+1,of:this.attrInspector.NLS_of,numFeatures:this.attrInspector._numFeatures},this.attrInspector._navMessage);this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null;this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes))}),200));
else if(b.add(this.contentWrapper,"hidden"),a.set(this.navButtonsDiv,"display","none"),this.attrInspector.ctStoredFeatureIndex=X,this._attributeInspectorCollection.push(this.attrInspector),this._nodesCollection.push(this.contentWrapper),this._buttonsWrapper.push(this.buttonHeader),this._paginationNodeCollection.push(this.navButtonsDiv),this._traversal.push(I),U&&(fa=[],fa=U,U=null),fa&&0<fa.length){var ka=new M;ka.objectIds=fa;if(0<this.viewedLayerDetails.length){var ha=new O;fa=this.viewedFeatureDetails[0];
this.viewedLayerDetails[0]===this.viewedLayerDetails[1]&&(fa=this.viewedFeatureDetails[1]);this._createAttributeInspector([this._getLayerInfoByID(I)],!1,null,ha,fa,ca)}else this._createAttributeInspector([this._getLayerInfoByID(I)],!1,null,null,null,ca);fa=this._jimuLayerInfos.getLayerOrTableInfoById(I).layerObject;this.loading.show();fa.selectFeatures(ka,W.SELECTION_NEW,g.hitch(this,function(ja){if(this._addingNewRelatedRecord&&this._processBackButtonInNewRelatedRecord||p)this.currentFeature=null;
this.updateFeatures=ja;p?this.attrInspector.last():this.attrInspector.first();this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null;this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes));0<this.updateFeatures.length&&this._showTemplate(!1);this._addingNewRelatedRecord&&this._processBackButtonInNewRelatedRecord&&(this._processBackButtonInNewRelatedRecord=this._addingNewRelatedRecord=!1,this._onCancelButtonClicked());
this.loading.hide()}),g.hitch(this,function(){this.loading.hide()}));ha&&ha.then(g.hitch(this,function(){if(0<this.viewedLayerDetails.length){var ja=this.viewedLayerDetails.shift();this.viewedFeatureDetails.shift();0<this.viewedLayerDetails.length&&this.viewedLayerDetails[0]===ja&&(this.viewedLayerDetails.shift(),this.viewedFeatureDetails.shift());c("[layerid\x3d'"+ja+"']",this.contentWrapper)[0].click()}0===this.viewedLayerDetails.length&&this.loading.hide()}))}}))},_createAttributeInspector:function(p,
z,C,I,K,X){if(2>this._traversal.length&&(this._editGeomSwitch&&(this._editGeomSwitch.destroy(),this._editGeomSwitch=null),this.editSwitchDiv))for(;this.editSwitchDiv.firstChild;)this.editSwitchDiv.removeChild(this.editSwitchDiv.firstChild);this._setCancelButtonText();X&&f.forEach(p[0].fieldInfos,g.hitch(this,function(ja){ja.name===X&&(ja.isEditable=!1)}));this.config.editor.hasOwnProperty("canSwitchToMultilineInput")&&this.config.editor.canSwitchToMultilineInput&&f.forEach(p,g.hitch(this,function(ja){ja.fieldInfos&&
f.forEach(ja.fieldInfos,g.hitch(this,function(pa){"esriFieldTypeString"===pa.type&&(!pa.hasOwnProperty("stringFieldOption")||"textbox"===pa.stringFieldOption)&&this.config.editor.maxLimitToMultilineTextBox<pa.length&&(pa.stringFieldOption="textarea")}))}));this.attrInspector=Q.ATI({layerInfos:p},t.create("div",{style:{width:"100%",height:"100%"}}));this.attrInspector.startup();this._onUpdateAttachmentListAdd508Support();d.place(this.attrInspector.navMessage,this.attrInspector.nextFeatureButton.domNode,
"before");if(2>this._traversal.length){this.editSwitchDiv=d.create("div");this.editSwitchDiv.appendChild(d.create("div",{"class":"spacer"}));this._editGeomSwitch=new na({id:"editGeometrySwitch_"+this.attrInspector.id,checked:!1,value:this.nls.editGeometry,tabindex:0,label:this.nls.editGeometry},null);ma.set(aa.byId("editGeometrySwitch_"+this.attrInspector.id).domNode,"aria-label",this.nls.editGeometry);this.editSwitchDiv.appendChild(this._editGeomSwitch.domNode);d.place(this.editSwitchDiv,this.attrInspector.deleteBtn.domNode,
"before");this.own(m(this._editGeomSwitch,"Change",g.hitch(this,this.editGeoCheckChange())));this._xyCoordinates=d.create("div",{"class":"esriCTActionButtons esriCTCustomButtons esriCTXYCoordinates esriCTGeometryEditor hidden",title:this.nls.moveSelectedFeatureToXY,tabindex:0,role:"button","aria-label":this.nls.moveSelectedFeatureToXY},this.attrInspector.deleteBtn.domNode,"after");this.own(m(this._xyCoordinates,"click",g.hitch(this,function(){this._createCoordinatesPopup()})));this.own(m(this._xyCoordinates,
"keydown",g.hitch(this,function(ja){ja.keyCode!==l.ENTER&&ja.keyCode!==l.SPACE||this._createCoordinatesPopup()})));this._locateButtonDiv=d.create("div",{"class":"esriCTActionButtons esriCTCustomButtons esriCTLocateButtonContainer esriCTGeometryEditor hidden",title:this.nls.moveSelectedFeatureToGPS,tabindex:0,role:"button","aria-label":this.nls.moveSelectedFeatureToGPS},this.attrInspector.deleteBtn.domNode,"after");this._locateButton=new Ka({map:this.map,highlightLocation:!1,setScale:!1,centerAt:!0,
geolocationOptions:{enableHighAccuracy:!0}},d.create("div"));this._locateButton.startup();var U=this._locateButton.domNode.style.display;"none"===U&&a.set(this._locateButtonDiv,"display",U);this.own(m(this._locateButtonDiv,"keydown",g.hitch(this,function(ja){ja.keyCode!==l.ENTER&&ja.keyCode!==l.SPACE||this._locateButton.locate()})));this.own(m(this._locateButton,"locate",g.hitch(this,function(ja){ja.error&&ja.error.message?h({message:ja.error.message}):ja&&ja.graphic&&ja.graphic.geometry&&("NaN"!==
ja.graphic.geometry.x&&"NaN"!==ja.graphic.geometry.y?(this.currentFeature.setGeometry(ja.graphic.geometry),this.geometryEdited()):h({message:this.nls.cantLocateUserLocation}))})));this.own(m(this._locateButtonDiv,"click",g.hitch(this,function(){this._locateButton.locate()})));this._mapNavigation=d.create("div",{"class":"esriCTActionButtons esriCTCustomButtons esriCTMapNavigationLocked esriCTGeometryEditor hidden",title:this.nls.mapNavigationLocked,tabindex:0,role:"button","aria-label":this.nls.mapNavigationLocked},
this.attrInspector.deleteBtn.domNode,"after");this.own(m(this._mapNavigation,"click",g.hitch(this,this._toggleMapNavigationButtonState)));this.own(m(this._mapNavigation,"keydown",g.hitch(this,function(ja){ja.keyCode!==l.ENTER&&ja.keyCode!==l.SPACE||this._toggleMapNavigationButtonState()})));if(this.config.editor.enableAttributeUpdates){var ca="refreshAttributes";var fa=this.nls.refreshAttributes}this.config.editor.enableAutomaticAttributeUpdates&&(ca="esriCTAutoUpdateOnMode",fa=this.nls.automaticAttributeUpdatesOn);
this._refreshButton=d.create("div",{"class":ca+" esriCTActionButtons esriCTCustomButtons esriCTGeometryEditor hidden",title:fa,tabindex:0,role:"button","aria-label":fa},this.attrInspector.deleteBtn.domNode,"after");this.own(m(this._refreshButton,"click",g.hitch(this,function(){this.config.editor.enableAutomaticAttributeUpdates?this._toggleAttributeButtonState():this._refreshAttributes()})));this.own(m(this._refreshButton,"keydown",g.hitch(this,function(ja){if(ja.keyCode===l.ENTER||ja.keyCode===l.SPACE)this.config.editor.enableAutomaticAttributeUpdates?
this._toggleAttributeButtonState():this._refreshAttributes()})))}d.create("div",{innerHTML:this.nls.save,"class":"esriCTCustomButtons saveButton jimu-btn jimu-state-disabled",style:"visibility: hidden"},this.attrInspector.deleteBtn.domNode,"after");this.buttonHeader&&b.add(this.buttonHeader,"hidden");this.buttonHeader=d.create("div",{"class":"buttonHeader"},this.buttonWrapper);var ka=d.create("div",{innerHTML:this.nls.save,"class":"esriCTCustomButtons saveButton jimu-btn jimu-state-disabled",tabindex:"-1",
role:"button","aria-label":this.nls.save},this.buttonHeader,"last");a.set(this.attrInspector.deleteBtn.domNode,"display","none");1>c(".deleteButton",this.buttonHeader).length&&(ca=d.create("div",{innerHTML:this.nls.deleteText,tabindex:"-1",role:"button","aria-label":this.nls.deleteText,"class":"deleteButton jimu-btn jimu-btn-vacation"},ka,"before"),m(ca,"click",g.hitch(this,function(){this._onDeleteButtonClick()})),m(ca,"keydown",g.hitch(this,function(ja){ja.keyCode!==l.ENTER&&ja.keyCode!==l.SPACE||
this._onDeleteButtonClick()})));this.config.editor.showActionButtonsAbove?a.set(this.mainContainer,"margin-top","5px"):(d.place(this.buttonWrapper,this.mainContainer,"after"),a.set(this.mainContainer,"margin-bottom","5px"),a.set(this.mainContainer,"margin-top","0px"));this.own(m(ka,"click",g.hitch(this,function(){this._validateFeatureChanged()?(this.map.infoWindow.isShowing&&this.map.infoWindow.hide(),b.contains(ka,"jimu-state-disabled")||this._saveEdit(this.currentFeature)):this._resetEditingVariables()})));
this.own(m(ka,"keydown",g.hitch(this,function(ja){if(ja.keyCode===l.ENTER||ja.keyCode===l.SPACE)this._validateFeatureChanged()?(this.map.infoWindow.isShowing&&this.map.infoWindow.hide(),b.contains(ka,"jimu-state-disabled")||this._saveEdit(this.currentFeature)):this._resetEditingVariables()})));v.after(this.attrInspector,"onLayerSelectionChange",g.hitch(this,function(){"active"!==this.state&&(this._LayerSelectionChangedTimer&&clearTimeout(this._LayerSelectionChangedTimer),this._LayerSelectionChangedTimer=
setTimeout(g.hitch(this,function(){this.attrInspector&&this.attrInspector.first()}),500))}));this.attrInspector._attachmentEditor&&(v.after(this.attrInspector._attachmentEditor,"_onDeleteAttachmentComplete",g.hitch(this,function(){this._hasAddedAnyAttachments(this.attrInspector._attachmentEditor,!1)||"Required"!==this.currentAction||a.set(this.attrInspector.attachmentsRequiredMsg,"display","block");this._enableAttrInspectorSaveButton(this._validateAttributes(),null,!0)})),v.after(this.attrInspector._attachmentEditor,
"_onAddAttachmentComplete",g.hitch(this,function(){"block"===a.get(this.attrInspector.attachmentsRequiredMsg,"display")&&a.set(this.attrInspector.attachmentsRequiredMsg,"display","none");this._enableAttrInspectorSaveButton(this._validateAttributes(),null,!0)})),v.after(this.attrInspector._attachmentEditor,"_getAttachments",g.hitch(this,function(){this.attachmentloading.show();setTimeout(g.hitch(this,function(){if(this.currentLayerInfo&&this.currentLayerInfo.attachmentValidations){if(this.currentLayerInfo.attachmentValidations){var ja=
[];f.forEach(this.currentLayerInfo.attachmentValidations.Actions,g.hitch(this,function(pa){var ta={};pa.filter&&this._smartAttributes&&(ta.actionType=pa.actionName,ta.result=this._smartAttributes.processFilter(pa.filter),ja.push(ta))}));this.attrInspector._attachmentUploader?this.performAction(this.attrInspector._attachmentUploader,ja,!0):this.performAction(this.attrInspector._attachmentEditor,ja,!1)}!this.attrInspector._attachmentEditor||this.currentLayerInfo.isEditable&&this.currentLayerInfo._editFlag||
this._disableAttachments(this.attrInspector._attachmentEditor,!0,!1)}this.attachmentloading.hide()}),1500)})));this.own(m(this.attrInspector,"attribute-change",g.hitch(this,function(ja){this.currentFeature&&(this.currentFeature.attributes[ja.fieldName]=ja.fieldValue,this._validateDateTimeField(),this._enableAttrInspectorSaveButton(this._validateAttributes()))})));this.own(m(this.attrInspector,"next",g.hitch(this,function(ja){this.currentFeature&&this.config.editor.displayPromptOnSave&&this._validateFeatureChanged()?
this._promptToResolvePendingEdit(!1,null,!1).then(g.hitch(this,function(){this._processNextButtonClicked(!0,ja,null,I,K)}),function(){}):(this.currentFeature&&(this.currentFeature.preEditAttrs&&(this.currentFeature.attributes=n.parse(n.stringify(this.currentFeature.preEditAttrs))),this.currentFeature.origGeom&&(this.currentFeature.geometry=Z.fromJson(this.currentFeature.origGeom))),this._processNextButtonClicked(!0,ja,null,I,K))})));this.attrInspector.attachmentsRequiredMsg=d.create("div",{innerHTML:this.nls.attachmentsRequiredMsg,
role:"presentation","aria-label":this.nls.attachmentsRequiredMsg.replace("(*)",""),tabindex:"0",style:"display:none;color:red;margin-top:5px"});1===p.length&&p[0].featureLayer.hasOwnProperty("originalLayerId")&&!0===this._getLayerInfoByID(p[0].featureLayer.originalLayerId).featureLayer.hasAttachments&&(p=d.create("div"),d.place(p,this.attrInspector.attributeTable,"after"),this.attrInspector._attachmentUploader=new Oa({"class":"atiAttachmentEditor",attachmentsRequiredMsg:this.attrInspector.attachmentsRequiredMsg,
currentAction:this.currentAction,deleteAttachmentText:this.nls.deleteAttachment},p),this.attrInspector._attachmentUploader.startup(),m(this.attrInspector._attachmentUploader,"attachmentAdded",g.hitch(this,function(){this._enableAttrInspectorSaveButton(this._validateAttributes())})),m(this.attrInspector._attachmentUploader,"attachmentDeleted",g.hitch(this,function(){this._enableAttrInspectorSaveButton(this._validateAttributes())})));if(this.attrInspector._attachmentUploader)var ha=this.attrInspector._attachmentUploader.domNode;
else this.attrInspector._attachmentEditor&&(ha=this.attrInspector._attachmentEditor.domNode);ha&&d.place(this.attrInspector.attachmentsRequiredMsg,ha,"before");z&&this._processRelationAndShowAttrInspector(!1,null,C,null,null,!0);setTimeout(g.hitch(this,function(){this.config.editor.removeOnSave&&0===this.attrInspector._numFeatures?this._setWidgetFirstFocusNode("templatePicker",!0):setTimeout(g.hitch(this,function(){this._setWidgetFirstFocusNode("AI",!0)}),1E3);setTimeout(g.hitch(this,function(){this._validateDateTimeField();
this.currentLayerInfo&&this.attrInspector._attachmentEditor&&!this.currentLayerInfo.isCache&&!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate&&this._disableAttachments(this.attrInspector._attachmentEditor,!0,!1);this.attrInspector&&this.attrInspector._toolTips&&f.forEach(this.attrInspector._toolTips,g.hitch(this,function(ja){f.forEach(ja.connectId,g.hitch(this,function(pa){-1<pa.indexOf("dijit_form_FilteringSelect")&&(ja.position=["above-centered"])}))}))}),1500)}),1E3)},_onDeleteButtonClick:function(){this.map.infoWindow.isShowing&&
this.map.infoWindow.hide();this.config.editor.displayPromptOnDelete?this._promptToDelete():this._deleteFeature()},_validateDateTimeField:function(){var p;this.attrInspector._currentLInfo&&this.attrInspector._currentLInfo.fieldInfos&&f.some(this.attrInspector._currentLInfo.fieldInfos,g.hitch(this,function(z){"esriFieldTypeDate"===z.type&&(p=this._getCurrentFieldDijit(z.fieldName))&&1<p.length&&(null===p[0].get("value")||void 0===p[0].get("value")?(p[1].set("value",null),p[1].set("disabled",!0)):(this.currentLayerInfo.isCache||
this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate)&&p[1].set("disabled",!1))}))},_processNextButtonClicked:function(p,z,C,I,K){this.currentMultipleValues=null;this._removePreviousValuePickerButtons();this._processRelationAndShowAttrInspector(p,z,C,I,K,!1);this._attributeInspectorChangeRecord(z);this._addWarning();this._toggleAttrInspectorNavButtons()},_toggleDeleteButton:function(p){var z=c(".deleteButton",this.buttonHeader);0<z.length&&(z=z[0],!0===p?(z.style.display="block",ma.set(z,"tabindex",
"0")):(z.style.display="none",ma.set(z,"tabindex","-1")))},_activateTemplateToolbar:function(p){p=p||null;var z=null;if(this.templatePicker){var C=this.templatePicker.getSelected();if(C&&null!==C){z=C.featureLayer.geometryType;if(void 0!==C.template&&null!==C.template&&void 0!==C.template.drawingTool&&null!==C.template.drawingTool)switch(C.template.drawingTool){case "esriFeatureEditToolNone":switch(C.featureLayer.geometryType){case "esriGeometryPoint":p=null!==p?p:y.POINT;break;case "esriGeometryPolyline":p=
null!==p?p:y.POLYLINE;break;case "esriGeometryPolygon":p=null!==p?p:y.POLYGON}break;case "esriFeatureEditToolPoint":p=null!==p?p:y.POINT;break;case "esriFeatureEditToolLine":p=null!==p?p:y.POLYLINE;break;case "esriFeatureEditToolAutoCompletePolygon":case "esriFeatureEditToolPolygon":p=null!==p?p:y.POLYGON;break;case "esriFeatureEditToolCircle":p=null!==p?p:y.CIRCLE;break;case "esriFeatureEditToolEllipse":p=null!==p?p:y.ELLIPSE;break;case "esriFeatureEditToolRectangle":p=null!==p?p:y.RECTANGLE;break;
case "esriFeatureEditToolFreehand":switch(C.featureLayer.geometryType){case "esriGeometryPoint":p=null!==p?p:y.POINT;break;case "esriGeometryPolyline":p=null!==p?p:y.FREEHAND_POLYLINE;break;case "esriGeometryPolygon":p=null!==p?p:y.FREEHAND_POLYGON}break;default:switch(C.featureLayer.geometryType){case "esriGeometryPoint":p=null!==p?p:y.POINT;break;case "esriGeometryPolyline":p=null!==p?p:y.POLYLINE;break;case "esriGeometryPolygon":p=null!==p?p:y.POLYGON}}else switch(C.featureLayer.geometryType){case "esriGeometryPoint":p=
null!==p?p:y.POINT;break;case "esriGeometryPolyline":p=null!==p?p:y.POLYLINE;break;case "esriGeometryPolygon":p=null!==p?p:y.POLYGON}this.drawToolbar.activate(p);this._setDrawingToolbar(z,p)}else this.drawToolbar&&(this._setDrawingToolbar("select",null),this.drawToolbar.deactivate())}else this.drawToolbar&&(this._setDrawingToolbar("select",null),this.drawToolbar.deactivate())},_templatePickerNeedsToBeCreated:function(){return!0},_drawingToolClick:function(p,z){return function(){z.hasOwnProperty("_drawType")&&
(this.currentDrawType=z._drawType);z.hasOwnProperty("_drawType")&&"SELECT"===z._drawType?(this.drawingTool.set("label",z.label),this.drawingTool.set("iconClass",z.iconClass),this.drawToolbar&&this.drawToolbar.deactivate(),this._selectTool&&(this._selectTool.setFeatureLayers(this._getOrClearSelectableLayers(!1)),this._selectTool.activate())):"select"!==p&&(this.drawingTool.set("label",z.label),this.drawingTool.set("iconClass",z.iconClass),this._selectTool&&this._selectTool.isActive()&&(this._selectTool.deactivate(),
this.map.setInfoWindowOnClick(!1)),z.hasOwnProperty("_drawType")&&this.drawToolbar.activate(z._drawType),this.currentShapeType=p)}},_menus:{},drawingTool:null,_setDrawingToolbar:function(p,z,C){if(null!==this.drawingTool&&void 0!==this.drawingTool){null!==this.currentShapeType&&void 0!==this.currentShapeType&&this.currentShapeType===p||this.drawingTool.set("dropDown",this._menus[p]);this.currentShapeType=p;this.currentDrawType=null;f.some(xa[p],function(I){return I.hasOwnProperty("_drawType")&&I._drawType===
z||null===z?(this.drawingTool.set("label",I.label),this.drawingTool.set("iconClass",I.iconClass),this.currentDrawType=I._drawType,!0):!1},this);if(null===this.currentDrawType||void 0===this.currentDrawType)this.drawingTool.set("label",xa[p][0].label),this.drawingTool.set("iconClass",xa[p][0].iconClass),xa[p][0].hasOwnProperty("_drawType")&&(this.currentDrawType=xa[p][0]._drawType);this._changeSelectToolState(C)}},_createDrawingToolbar:function(){if(this.config.editor.hasOwnProperty("displayShapeSelector")){if(!0===
this.config.editor.displayShapeSelector||this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting)this._menus=this._createDrawingMenus(),this.drawingTool=new oa({label:"",name:"drawingTool",id:"drawingTool"},this.drawingOptionsDiv),this.drawingTool.startup(),this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting&&this._initializeSelectToolWidget(),this._setDrawingToolbar("select",
null)}else this.config.editor.displayShapeSelector=!1,this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&(this.config.editor.createNewFeaturesFromExisting=!1)},_createMenu:function(p){var z=new sa({style:"display: none;"});f.forEach(p,function(C){if(!this.config.editor.displayShapeSelector&&this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&this.config.editor.createNewFeaturesFromExisting){var I=!1;if(C.hasOwnProperty("_drawType")&&"SELECT"===C._drawType||"seNewSelection"===
C.id||"sePointTool"===C.id||"seDrawPolyline"===C.id||"seDrawPolygon"===C.id)I=!0}else I=!0,C.hasOwnProperty("_drawType")&&"SELECT"===C._drawType&&(I=this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&this.config.editor.createNewFeaturesFromExisting?!0:!1);I&&this._addMenuItem(C,z,p)},this);z.startup();return z},_createDrawingMenus:function(){var p={},z;for(z in xa)p[z]=this._createMenu(xa[z]);return p},_createEditor:function(p){var z=null;if(void 0!==this.config.editor&&null!==this.config.editor){var C=
this._getEditableLayers(this.config.editor.configInfos,!1);if(1>C.length)this._creationDisabledOnAll=!0,this.currentLayerInfo&&!this.currentLayerInfo.isCache&&this._attrInspIsCurrentlyDisplayed&&!0===this._attrInspIsCurrentlyDisplayed&&(this.attrInspector.refresh(),this.attrInspector.first());else if(this._templatePickerNeedsToBeCreated()){if(this._attrInspIsCurrentlyDisplayed&&!0===this._attrInspIsCurrentlyDisplayed){this._recreateOnNextShow=!0;this.currentLayerInfo.isCache||(this.attrInspector.refresh(),
this.attrInspector.first());return}if(this.templatePicker&&null!==this.templatePicker){var I=this.currentDrawType;z=this.templatePicker.getSelected();null===z&&this.drawToolbar&&this.drawToolbar.deactivate();this._select_change_event.remove();this.templatePicker.destroy();this._resetEditingVariables();this.drawToolbar&&this.drawToolbar.deactivate();this.drawingTool&&this._setDrawingToolbar("select",null,p)}else this._createAutoSaveSwitch(this.config.editor.autoSaveEdits);this.templatePickerNode=d.create("div",
{"class":"eeTemplatePicker"});this.templatePickerDiv.appendChild(this.templatePickerNode);this.templatePicker=new w({featureLayers:C,"class":"esriTemplatePicker",grouping:!0,maxLabelLength:"25",showTooltip:!1},this.templatePickerNode);this.templatePicker.startup();ma.set(this.templatePicker.domNode,"tabindex","-1");v.after(this.templatePicker,"update",g.hitch(this,function(){this._handle508AccessibilityForTemplatePicker();setTimeout(g.hitch(this,function(){this._handle508AccessibilityForTemplatePicker()}),
2E3)}));this._addFilterEditor(C);if(null!==z&&this.templatePicker){var K=Object.getOwnPropertyNames(this.templatePicker._itemWidgets),X=[];f.forEach(this.templatePicker._flItems,function(U){f.forEach(U,function(ca){X.push(ca)})});X.length===K.length?!1===f.some(X,function(U,ca){if(z.featureLayer.id===U.layer.id&&U.template.name===z.template.name&&U.template.drawingTool===z.template.drawingTool&&U.template.description===z.template.description&&U.type===z.type)return U=A.byId(K[ca]),m.emit(U,"click",
{bubbles:!0,cancelable:!0}),this._activateTemplateToolbar(I),!0},this)&&(this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,p)):(this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,p))}else this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,p);this._select_change_event=m(this.templatePicker,"selection-change",g.hitch(this,this._template_change));
this.own(this._select_change_event)}(this._creationDisabledOnAll=1>C.length?!0:!1)?(this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,p),this.templatePicker&&(A.style(this.templatePicker.domNode,"display","none"),this.config.editor.autoSaveEdits&&this._createAutoSaveSwitch(!1),this._mapClickHandler(!0),this._clearTemplateSelection()),this.drawingTool&&A.style(this.drawingTool.domNode,"display","none"),this._filterEditor&&A.style(this._filterEditor.domNode,
"display","none")):(this.templatePicker&&A.style(this.templatePicker.domNode,"display","block"),this.config.editor.autoSaveEdits&&this._createAutoSaveSwitch(!0),this.drawingTool&&A.style(this.drawingTool.domNode,"display","block"),this._filterEditor&&A.style(this._filterEditor.domNode,"display","block"));this.config.editor.configInfos&&this._createPresetTable(this.config.editor.configInfos);setTimeout(g.hitch(this,function(){this._handle508AccessibilityForTemplatePicker()}),2E3)}},_handle508AccessibilityForTemplatePicker:function(){var p=
c("div[role\x3d'grid']",this.templatePickerDiv);var z=c("[type\x3d'checkbox']",this.templatePickerDiv);var C=c("[dojoattachpoint\x3d'lastFocusNode']",this.templatePickerDiv);p&&p[0]&&ma.set(p[0],"tabindex","-1");f.forEach(z,g.hitch(this,function(I){ma.set(I,"tabindex","-1")}));C&&C[0]&&ma.set(C[0],"tabindex","-1");(p=c(".dojoxGridMasterMessages",this.domNode))&&0<p.length&&ma.set(p[0],"tabindex","-1")},isGuid:function(p){"{"===p[0]&&(p=p.substring(1,p.length-1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(p)},
_template_change:function(){this._deactivateAllTools();this.currentShapeType=this.currentDrawType=null;this._activateTemplateToolbar()},validateGUID:function(p,z){return this.isGuid(p)},_createPresetTable:function(p){this._isPresetTableCreated||this._processConfigForBackwardPresetInfos(p);this.config.hasOwnProperty("attributeActionGroups")&&0<Object.keys(this.config.attributeActionGroups.Preset).length&&(this.config.attributeActionGroups.hasOwnProperty("presetOrder")||(this.config.attributeActionGroups.presetOrder=
Object.keys(this.config.attributeActionGroups.Preset)),this._isPresetTableCreated||(this._isPresetTableCreated=!0,this._initPresetFieldsTable(p)),this.templatePicker&&!b.contains(c(".ee-presetValueTableDiv",this.domNode)[0],"esriCTHidden")?c(".presetFieldsTableDiv")[0].style.display="block":c(".presetFieldsTableDiv")[0].style.display="none")},_processConfigForBackwardPresetInfos:function(p){var z=[];!this.config.editor.hasOwnProperty("presetInfos")&&p&&(f.forEach(p,g.hitch(this,function(C){C.fieldValues=
{};f.forEach(C.fieldInfos,g.hitch(this,function(I){if(I.hasOwnProperty("canPresetValue")&&I.canPresetValue){var K=[{actionName:"Intersection",enabled:!1},{actionName:"Address",enabled:!1},{actionName:"Coordinates",enabled:!1},{actionName:"Preset",enabled:!0}];C.fieldValues[I.fieldName]=g.clone(K);z[I.fieldName]=[]}}))})),this.config.editor.presetInfos=z);Y.createPresetGroups(this.config,this._jimuLayerInfos)},_presetChange:function(){this._toggleUsePresetValues(!0)},_createAutoSaveSwitch:function(p){p?
c(".autoSaveOptionDiv")[0].style.display="block":c(".autoSaveOptionDiv")[0].style.display="none"},_toggleRunTimeAutoSave:function(){this._autoSaveRuntime=!1===this._autoSaveRuntime?!0:!1;this._createAutoSaveSwitch(this.config.editor.autoSaveEdits)},_deleteFeature:function(){if(this.currentFeature){this._resetEditingVariables();var p=this.currentFeature.getLayer();if(null===p.url)p.clear(),this._showTemplate(!0);else{var z=c(".processing-indicator"),C=c(".processing-indicator-panel"),I=c(".saveButton",
this.buttonHeader)[0];f.forEach(z,function(K){b.contains(K,"busy")||b.add(K,"busy")});f.forEach(C,function(K){b.contains(K,"busy")||b.add(K,"busy")});b.contains(I,"hide")||b.add(I,"hide");p.applyEdits(null,null,[this.currentFeature],g.hitch(this,function(K,X,U){if(U&&0<U.length&&U[0].hasOwnProperty("error"))h({message:U[0].error.toString()});else if(this.updateFeatures.splice(this.updateFeatures.indexOf(this.currentFeature),1),this.updateFeatures&&0<this.updateFeatures.length)if("Table"===p.type){var ca=
[];this.loading.show();f.forEach(this.updateFeatures,function(fa){ca.push(fa.attributes[p.objectIdField])});K=new M;K.objectIds=ca;p.selectFeatures(K,W.SELECTION_NEW,g.hitch(this,function(fa){this.updateFeatures=fa;this.attrInspector.refresh();this.attrInspector.first();this.loading.hide()}),g.hitch(this,function(){this.loading.hide()}))}else this.attrInspector.refresh(),this.attrInspector.first();else 2>this._traversal.length?(this._showTemplate(!0),this._setWidgetFirstFocusNode("templatePicker",
!0)):(m.emit(this.cancelButton,"click",{cancelable:!0,bubbles:!0}),this._setWidgetFirstFocusNode("AI",!0));f.forEach(z,function(fa){b.contains(fa,"busy")&&b.remove(fa,"busy")});f.forEach(C,function(fa){b.contains(fa,"busy")&&b.remove(fa,"busy")});b.contains(I,"hide")&&b.remove(I,"hide")}),g.hitch(this,function(K){h({message:K.message.toString()+"\n"+K.details});f.forEach(z,function(X){b.contains(X,"busy")&&b.remove(X,"busy")});f.forEach(C,function(X){b.contains(X,"busy")&&b.remove(X,"busy")});b.contains(I,
"hide")&&b.remove(I,"hide")}))}}},_editGeometry:function(p){if(!p||!(this._ignoreEditGeometryToggle||this.currentLayerInfo&&!this.currentLayerInfo._editFlag)){if(!0===p){if(this.currentLayerInfo&&this.currentLayerInfo.disableGeometryUpdate&&!this.currentLayerInfo.isCache||this.currentLayerInfo&&!this.currentLayerInfo.isCache&&(!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&
!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues))return;this.map.setInfoWindowOnClick(!1);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();!1===this._editingEnabled&&this.currentFeature&&this.currentFeature.geometry?(this._editingEnabled=!0,this.currentFeature.origGeom=this.currentFeature.geometry.toJson(),setTimeout(g.hitch(this,function(){this._activateEditToolbar(this.currentFeature)}),100)):(0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate(),this._editingEnabled=
!1)}else this.map.setInfoWindowOnClick(!0),this.editToolbar.deactivate(),this._editingEnabled=!1;this._toggleAttributeButtonVisibility(p);this._toggleLocateButtonVisibility(p);this._toggleXYCoordinatesButtonVisibility(p);this._toggleMapNavigationButtonVisibility(p);this._setWidgetFirstFocusNode("AI",!1)}},_toggleAttributeButtonState:function(){this._refreshButton&&b.contains(this._refreshButton,"esriCTAutoUpdateOnMode")?(b.replace(this._refreshButton,"esriCTAutoUpdateOffMode","esriCTAutoUpdateOnMode"),
ma.set(this._refreshButton,"title",this.nls.automaticAttributeUpdatesOff)):this._refreshButton&&b.contains(this._refreshButton,"esriCTAutoUpdateOffMode")&&(b.replace(this._refreshButton,"esriCTAutoUpdateOnMode","esriCTAutoUpdateOffMode"),ma.set(this._refreshButton,"title",this.nls.automaticAttributeUpdatesOn),this._refreshAttributes())},_toggleAttributeButtonVisibility:function(p){this.config.editor.enableAttributeUpdates&&this.currentLayerInfo&&(this.currentLayerInfo.isCache||this.currentLayerInfo.isEditable)?
b.remove(this._refreshButton,"hidden"):b.add(this._refreshButton,"hidden")},_toggleLocateButtonVisibility:function(p){p&&this.config.editor.enableMovingSelectedFeatureToGPS&&this.currentFeature&&this.currentFeature.geometry&&"point"===this.currentFeature.geometry.type?b.remove(this._locateButtonDiv,"hidden"):b.add(this._locateButtonDiv,"hidden")},_toggleXYCoordinatesButtonVisibility:function(p){p&&this.config.editor.enableMovingSelectedFeatureToXY&&this.currentFeature&&this.currentFeature.geometry&&
"point"===this.currentFeature.geometry.type?b.remove(this._xyCoordinates,"hidden"):b.add(this._xyCoordinates,"hidden")},_toggleMapNavigationButtonState:function(){b.contains(this._mapNavigation,"esriCTMapNavigationUnLocked")?this._lockMapNavigation():b.contains(this._mapNavigation,"esriCTMapNavigationLocked")&&this._unLockMapNavigation()},_lockMapNavigation:function(){this._mapNavigation&&(b.replace(this._mapNavigation,"esriCTMapNavigationLocked","esriCTMapNavigationUnLocked"),ma.set(this._mapNavigation,
"title",this.nls.mapNavigationLocked),this.map.disableMapNavigation())},_unLockMapNavigation:function(){this._mapNavigation&&(b.replace(this._mapNavigation,"esriCTMapNavigationUnLocked","esriCTMapNavigationLocked"),ma.set(this._mapNavigation,"title",this.nls.mapNavigationUnLocked),this.map.enableMapNavigation())},_toggleMapNavigationButtonVisibility:function(p){p&&this.config.editor.enableLockingMapNavigation?b.remove(this._mapNavigation,"hidden"):b.add(this._mapNavigation,"hidden");this._unLockMapNavigation()},
_enableAttrInspectorSaveButton:function(p,z,C){var I=c(".saveButton",this.buttonHeader)[0],K=!1;I&&(p?(b.contains(I,"jimu-state-disabled")&&(b.remove(I,"jimu-state-disabled"),ma.set(I,"tabindex","0")),K=!0,ma.set(I,"tabindex","0"),this._setWidgetFirstFocusNode("AI",!1)):b.contains(I,"jimu-state-disabled")||(b.add(I,"jimu-state-disabled"),ma.set(I,"tabindex","-1"),this._setWidgetFirstFocusNode("AI",!1)),!z&&this.currentFeature&&this._relatedTablesInfo[this.currentFeature._layer.id]&&(this._relatedTablesInfo[this.currentFeature._layer.id].isSaveEnable=
K),this.currentLayerInfo.showAttachments&&C&&0===aa.findWidgets(this.attrInspector.attributeTable).length&&this._setWidgetFirstFocusNode("AI",!0))},_setConfiguredFieldInfos:function(p,z){var C=[];f.forEach(z,function(I){var K=T.getFieldInfoByFieldName(p,I.fieldName);I=g.mixin(g.clone(K),I);C.push(I)});return C},_getLayerInfoByID:function(p){0<p.indexOf("_lfl")&&(p=p.replace("_lfl",""));if(this._traversal&&0<this._traversal.length){var z=this.config.editor.configInfos;f.some(this._traversal,function(X,
U){f.some(z,function(ca){if(ca.featureLayer.id===X)return z=ca,!0});1<this._traversal.length&&U+1<this._traversal.length&&(z=z.relationshipInfos)},this);if(!z.layerInfo){z.layerInfo=this._jimuLayerInfos.getLayerOrTableInfoById(z.featureLayer.id);var C=Q.getConfigInfo(z.layerInfo,{}),I=z.layerInfo.layerObject;this._removeSpacesInLayerTemplates(I);z.fieldInfos=this._setConfiguredFieldInfos(C.fieldInfos,z.fieldInfos);this.processConfigForRuntime(z);z.configFeatureLayer=C.featureLayer;z.featureLayer=
I;z.showDeleteButton=!1}return z}var K=null;this.config.editor.configInfos.some(function(X){return X.featureLayer.id===p?(K=X,!0):!1});return K},_initPresetFieldsTable:function(p){var z=d.create("div",{"class":"ee-presetValueTableDiv templatePicker"},this.presetFieldsTableNode),C=d.create("div",{"class":"bodyDiv"},z);C=d.create("table",{"class":"ee-presetValueBodyTable"},C);C=d.create("tbody",{"class":"ee-presetValueBody",id:"eePresetValueBody"},C,"first");p=new ia({nls:this.nls,parentNode:C,configInfos:p,
_jimuLayerInfos:this._jimuLayerInfos,_configuredPresetInfos:this.config.attributeActionGroups.Preset,presetOrder:this.config.attributeActionGroups.presetOrder,showingInWidget:!0,map:this.map});this.own(m(p,"presetValueChanged",g.hitch(this,this._presetChange)));p.hasAtLeastOneGroupInDisplay||(b.add(z,"esriCTHidden"),a.set(aa.byId("savePresetValueSwitch").domNode,"display","none"));p.enableUsePresetValueCheckBox&&this._presetChange()},_dateClick:function(p,z){return function(){void 0!==p&&null!==p&&
p.set("value",new Date);void 0!==z&&null!==z&&z.set("value",new Date)}},_getEditableLayers:function(p,z){var C=[];f.forEach(p,function(I){!I._editFlag||I.allowUpdateOnly&&!z||(I=this.map.getLayer(I.featureLayer.id))&&I.visible&&I.isVisibleAtScale(this.map.getScale())&&I.isEditable&&I.isEditable()&&C.push(I)},this);return C},_getEditableLayersInfos:function(p,z){var C=[];f.forEach(p,function(I){if(I._editFlag&&(!I.allowUpdateOnly||z)){var K=this.map.getLayer(I.featureLayer.id);K&&K.visible&&K.isVisibleAtScale(this.map.getScale())&&
K.isEditable&&K.isEditable()&&C.push(I)}},this);return C},_getClonedRelationInfo:function(p){for(var z=[],C=0;C<p.length;C++){var I={},K;for(K in p[C])p[C].hasOwnProperty(K)&&"featureLayer"!==K&&"layerInfo"!==K&&(I[K]="relationshipInfos"===K?this._getClonedRelationInfo(p[C][K]):g.clone(p[C][K]));z.push(I)}return z},_getLayerInfoForLocalLayer:function(p){var z=this._getLayerInfoByID(p.originalLayerId);if(null!==z){var C={};for(var I in z)z.hasOwnProperty(I)&&"featureLayer"!==I&&"layerInfo"!==I&&(C[I]=
"relationshipInfos"===I?this._getClonedRelationInfo(z[I]):g.clone(z[I]));C.featureLayer=p}return C},_getSelectionSymbol:function(p,z){if(!p||""===p)return null;switch(p){case "esriGeometryPoint":var C=!0===z?new H(H.STYLE_CIRCLE,20,new P(P.STYLE_SOLID,new V([0,230,169,1]),2),new V([0,230,169,.65])):new H(H.STYLE_CIRCLE,20,new P(P.STYLE_SOLID,new V([92,92,92,1]),2),new V([255,255,0,.65]));break;case "esriGeometryPolyline":C=!0===z?new P(P.STYLE_SOLID,new V([0,255,255,.65]),2):new P(P.STYLE_SOLID,new V([255,
255,0,.65]),2);break;case "esriGeometryPolygon":C=!0===z?(new S).setColor(new V([0,230,169,.65])):(new S).setColor(new V([255,255,0,.65])),p=new P(P.STYLE_SOLID,new V([192,192,192,1]),2),C.setOutline(p)}return C},_hasPresetValueFields:function(p){return p.some(function(z){return!1===z.allowUpdateOnly?z.fieldInfos?z.fieldInfos.some(function(C){return!0===C.canPresetValue}):!1:!1},this)},_setPresetValueValue:function(p,z,C){var I=!0,K,X=c("#eePresetValueBody")[0];C&&(I=!1);X&&(X=c(".preset-value-editable .ee-inputField"),
f.forEach(X,g.hitch(this,function(U){var ca=F.byNode(U);if(void 0!==ca&&null!==ca){U=ca.get("name");ca.get("isdategroup");if(I){var fa=U.split(" ");1<fa.length&&(U=fa[1],C="("+p+")")}C&&U.toLowerCase()===C.toLowerCase()&&(ca.esriCTisDateGroup?(K={dateType:"fixed",dateTime:(new Date(z)).getTime()},ca.esriCTPresetGroup.presetValue=K,K.dateTime?ca.set("value",T.getDateFromRelativeInfo(ca.esriCTPresetGroup.presetValue,!0)):ca.set("value","")):ca.esriCTDomainList?f.some(ca.store.data,function(ka){if(ka.id===
z)return ca.set("value",z),!0}):"dijit.form.NumberTextBox"===ca.declaredClass?ca.set("value",parseFloat(z)):ca.set("value",z))}})));C&&this.config.attributeActionGroups.Preset&&this.config.attributeActionGroups.Preset[C]&&this.config.attributeActionGroups.Preset[C].hideInPresetDisplay&&(this.config.attributeActionGroups.Preset[C].presetValue=K?K:z,this._presetChange())},_modifyAttributesWithPresetValues:function(p,z,C,I){var K=[],X={},U=[],ca=[];if(z.fieldValues){for(var fa in z.fieldValues)for(var ka=
0;ka<z.fieldValues[fa].length;ka++){var ha=z.fieldValues[fa][ka],ja=!1,pa;z.fieldInfos&&(pa=T.getFieldInfoByFieldName(z.fieldInfos,fa));if(C&&"Intersection"===ha.actionName&&ha.enabled){for(var ta=0;ta<ha.fields.length;ta++){var wa=ha.fields[ta];if(C.Intersection.hasOwnProperty(fa)&&C.Intersection[fa].hasOwnProperty(wa.layerId)&&C.Intersection[fa][wa.layerId].hasOwnProperty(wa.field)){p[fa]=C.Intersection[fa][wa.layerId][wa.field];if(pa&&"esriFieldTypeString"===pa.type){if(null===p[fa]||void 0===
p[fa])p[fa]="";p[fa]=p[fa].toString()}ja=!0;C.multipleValues&&C.multipleValues.hasOwnProperty(fa)&&0>ca.indexOf(fa)&&ca.push(fa);break}}if(ja)break}if(C&&"Address"===ha.actionName&&ha.enabled&&C.Address.hasOwnProperty(ha.field)){p[fa]=C.Address[ha.field];break}if(C&&"Coordinates"===ha.actionName&&ha.enabled){ha.coordinatesSource&&"myLocation"===ha.coordinatesSource?(ka=C.MyLocation.Coordinates.hasOwnProperty(ha.coordinatesSystem),"xy"===ha.field?p[fa]=ka?C.MyLocation.Coordinates[ha.coordinatesSystem].x+
" "+C.MyLocation.Coordinates[ha.coordinatesSystem].y:"":(p[fa]=ka?C.MyLocation.Coordinates[ha.coordinatesSystem][ha.field]:"",pa&&"esriFieldTypeString"===pa.type&&(p[fa]=p[fa].toString()))):"xy"===ha.field?p[fa]=C.Coordinates[ha.coordinatesSystem].x+" "+C.Coordinates[ha.coordinatesSystem].y:(p[fa]=C.Coordinates[ha.coordinatesSystem][ha.field],pa&&"esriFieldTypeString"===pa.type&&(p[fa]=p[fa].toString()));break}if((!I||I!==fa)&&"Preset"===ha.actionName&&ha.enabled&&this._usePresetValues){K.push(fa);
ha.attributeActionGroupName&&(X[fa]=ha.attributeActionGroupName,0>U.indexOf(ha.attributeActionGroupName)&&U.push(ha.attributeActionGroupName));break}}if(C)if(C.multipleValues&&0<ca.length){var ya={};f.forEach(ca,function(Na){ya[Na]=C.multipleValues[Na]});C.multipleValues=ya}else C.multipleValues=null}if(0<K.length){z=this._getPresetValueForGroup(U);for(var za in p)p.hasOwnProperty(za)&&0<=K.indexOf(za)&&X.hasOwnProperty(za)&&(p[za]=z[X[za]])}},_getPresetValueForGroup:function(p){for(var z={},C=this.config.attributeActionGroups.Preset,
I=0;I<p.length;I++)if(C.hasOwnProperty(p[I])){var K=C[p[I]];K.showOnlyDomainFields||"esriFieldTypeString"!==K.dataType&&"esriFieldTypeInteger"!==K.dataType&&"esriFieldTypeGUID"!==K.dataType?"esriFieldTypeDate"!==K.dataType||K.showOnlyDomainFields?K.selectedDomainValue&&(z[p[I]]=K.selectedDomainValue):(K=(K=T.getDateFromRelativeInfo(K.presetValue))&&K.getTime?K.getTime():K&&K.toGregorian?K.toGregorian().getTime():K,z[p[I]]=K):z[p[I]]=K.presetValue}return z},processConfigForRuntime:function(p){var z=
[];p&&(p._editFlag||(p.isEditable=!1),z=f.filter(p.fieldInfos,function(C){return"esriFieldTypeBlob"===C.type||"esriFieldTypeGlobalID"===C.type||"esriFieldTypeRaster"===C.type||"esriFieldTypeXML"===C.type?!1:!0===C.isEditable?!0:C.visible}),this.config.editor.hasOwnProperty("honorWebMapConfiguration")&&this.config.editor.honorWebMapConfiguration&&0===z.length&&(z=f.filter(p.fieldInfos,function(C){return"esriFieldTypeBlob"===C.type||"esriFieldTypeGlobalID"===C.type||"esriFieldTypeRaster"===C.type||
"esriFieldTypeXML"===C.type?!1:!0})),p.fieldInfos=z)},_newAttrInspectorNeeded:function(){var p=!1;!this.attrInspector||1<this.attrInspector.layerInfos.length?p=!0:(p=this.attrInspector.layerInfos[0].featureLayer.id,p=0<p.indexOf("_lfl")?0>p.indexOf(this.templatePicker.getSelected().featureLayer.id):!0);p&&this.attrInspector?(this.attrInspector.destroy(),this.attrInspector=null):this._attachmentUploader&&null!==this._attachmentUploader&&this._attachmentUploader.clear();return p},_onMapClick:function(p){this._copyFeaturesObj&&
(this._copyFeaturesObj.cancelBtnClicked(),this.templatePicker&&this._clearTemplateSelection());if(this._byPass&&!0===this._byPass)this._byPass=!1;else{var z=!1;this.templatePicker&&(z=this.templatePicker.getSelected()?!0:!1);!this._attrInspIsCurrentlyDisplayed&&p.mapPoint&&!1===z&&(p.graphic&&p.graphic.geometry&&"point"===p.graphic.geometry.type&&(p.mapPoint=new Da(p.graphic.geometry.toJson())),this._processOnMapClick(p))}},_attachmentsComplete:function(p,z,C){return function(I){var K="";f.forEach(I,
function(U){U&&"rejected"===U.state&&U.error&&Aa.isDefined(U.error.code)&&(K=400===U.error.code?K+q.widgets.attachmentEditor.NLS_fileNotSupported+"\x3cbr/\x3e":K+U.error.message||(U.error.details&&U.error.details.length&&U.error.details[0])+"\x3cbr/\x3e")},this);if(""!==K)var X=new Ca({titleLabel:this.nls.attachmentLoadingError,width:400,maxHeight:200,autoHeight:!0,content:K,buttons:[{label:this.nls.back,classNames:["jimu-btn"],onClick:g.hitch(this,function(){X.close()})}],onClose:g.hitch(this,function(){})});
return this._completePost(p,z,C)}},_selectComplete:function(p,z){return function(){this._removeLocalLayers();this.currentFeature=null;this._showTemplate(!1);z.resolve("success")}},_completePost:function(p,z,C){this._createAttributeInspector([this.currentLayerInfo]);var I=new M;I.objectIds=[z];p.selectFeatures(I,W.SELECTION_NEW,g.hitch(this,this._selectComplete(p,C)),g.hitch(this,function(){C.resolve("failed")}))},_postChanges:function(p){var z=new O,C=this._changed_feature(p,!1);p=C[0];var I=C[1];
C=C[2];var K=null,X=null;null===p?z.resolve("success"):"Add"===C?(1<this._traversal.length&&(this.addNewRelatedRecord=!0),K=this._jimuLayerInfos.getLayerOrTableInfoById(I).layerObject,X=K.applyEdits([p],null,null),this.addDeferred(X,p,K,z)):(K=this._jimuLayerInfos.getLayerOrTableInfoById(I).layerObject,0===Object.keys(p.attributes).length&&null===p.geometry?z.resolve("success"):1===Object.keys(p.attributes).length&&p.attributes.hasOwnProperty(K.objectIdField)&&null===p.geometry?z.resolve("success"):
(X=K.applyEdits(null,[p],null),this.addDeferred(X,p,K,z)));return z.promise},_changed_feature:function(p,z){var C=null,I=null,K=null,X=null;z=z||!1;var U=null;if(p){C=new ba(null,null,n.parse(n.stringify(p.attributes)));if(void 0!==this._smartAttributes&&null!==this._smartAttributes)for(U in C.attributes)!0===C.attributes.hasOwnProperty(U)&&(K=this._smartAttributes.validateField(U),"Hide"===K[1]&&!0!==K[3]&&delete C.attributes[U]);for(U in C.attributes)!0===C.attributes.hasOwnProperty(U)&&""===C.attributes[U]&&
(C.attributes[U]=null);this._attributeInspectorTools?(C.attributes=this._attributeInspectorTools._checkFeatureData(C.attributes),p.preEditAttrs&&(C.preEditAttrs=this._attributeInspectorTools._checkFeatureData(n.parse(n.stringify(p.preEditAttrs))))):p.preEditAttrs&&(C.preEditAttrs=n.parse(n.stringify(p.preEditAttrs)));if(p.getLayer().originalLayerId){if(K=this._jimuLayerInfos.getLayerOrTableInfoById(p.getLayer().originalLayerId).layerObject)C.geometry=p.geometry,C.symbol=null,I="Add",z=!0}else void 0!==
this.geometryChanged&&null!==this.geometryChanged&&!0===this.geometryChanged&&(C.geometry=p.geometry),K=p.getLayer(),(p=Q.filterOnlyUpdatedAttributes(C.attributes,C.preEditAttrs,K))&&!Q.isObjectEmpty(p)?C.attributes=p:C.attributes=[],C.symbol=null,I="Update";X=K.id;C&&z&&C.attributes.hasOwnProperty(K.objectIdField)&&delete C.attributes[K.objectIdField];K.globalIdField&&C.attributes.hasOwnProperty(K.globalIdField)&&delete C.attributes[K.globalIdField];if(K.editFieldsInfo)for(U in K.editFieldsInfo)K.editFieldsInfo.hasOwnProperty(U)&&
C.attributes.hasOwnProperty(K.editFieldsInfo[U])&&delete C.attributes[K.editFieldsInfo[U]]}return[C,X,I]},getUniqueFieldErrorMsg:function(p){var z="",C="",I={};I=p.split("with unique index '");p=p.split("duplicate key value is (");2<=I.length&&(z=I[1].split(".")[0].split("_Index")[0]);2<=p.length&&(C=p[1].split(")")[0]);I=T.getFieldInfoByFieldName(this.attrInspector._currentLInfo.fieldInfos,z);"esriFieldTypeDate"===I.type&&C.indexOf(!1)&&(C=C.split(".")[0]);return Ma.substitute(this.nls.uniqueValueErrorMessage,
{fieldName:I.label||I.name})},addDeferred:function(p,z,C,I){p.then(g.hitch(this,function(K,X){X&&0<X.length&&X[0].hasOwnProperty("error")?(K=X[0].error.toString(),-1!==K.toLowerCase().indexOf("cannot insert duplicate key row")&&(K=this.getUniqueFieldErrorMsg(K)),h({message:K}),I.resolve("failed")):X&&0<X.length?(z.preEditAttrs=n.parse(n.stringify(z.attributes)),C.refresh(),this.geometryChanged=!1,I.resolve("success")):K&&0<K.length&&K[0].hasOwnProperty("error")?(K=K[0].error.toString(),-1!==K.toLowerCase().indexOf("cannot insert duplicate key row")&&
(K=this.getUniqueFieldErrorMsg(K)),h({message:K}),I.resolve("failed")):K&&0<K.length&&(z.preEditAttrs=n.parse(n.stringify(z.attributes)),X=null,this.attrInspector._attachmentUploader&&(X=this.attrInspector._attachmentUploader.postAttachments(C,K[0].objectId)),void 0===X||null===X||0===X.length?this.addNewRelatedRecord?I.resolve("success"):this._completePost(C,K[0].objectId,I):E(X).then(g.hitch(this,this._attachmentsComplete(C,K[0].objectId,I))))}),g.hitch(this,function(K){h({message:K.message.toString()+
"\n"+K.details});I.resolve("failed")}))},_processOnMapClick:function(p){var z=this.config.editor.hasOwnProperty("featuresSelectionTolerance")?this.config.editor.featuresSelectionTolerance:20;this.map.infoWindow.hide();f.forEach(this._attributeInspectorCollection,function(X){X.destroy()});this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this._createAttributeInspector(this.config.editor.configInfos);
var C=this.map.getLayersVisibleAtScale().filter(g.hitch(this,function(X){return X.type&&"Feature Layer"===X.type&&X.url?f.some(this.config.editor.configInfos,g.hitch(this,function(U){return U.layerId===X.id&&this._hasAnyEditableLayerInRelation([U])?!0:!1})):!1}));C=C.filter(g.hitch(this,function(X){try{return this.map.getLayer(X.id).visible}catch(U){return console.log(U+" Check for visible failed"),!0}}));var I=[],K=[];this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;f.forEach(C,
g.hitch(this,function(X){X.setSelectionSymbol(this._getSelectionSymbol(X.geometryType,!1));var U=new M;U.geometry=Q.pointToExtent(this.map,p.mapPoint,z);U=X.selectFeatures(U,W.SELECTION_NEW,g.hitch(this,function(ca){var fa=[],ka=[];f.forEach(ca,function(ha){ha.allowDelete=!0;X.getEditCapabilities({feature:ha}).canDelete||(ha.allowDelete=!1);ha.preEditAttrs=n.parse(n.stringify(ha.attributes));ka.push(ha)},this);0<fa.length&&(ca=new M,ca.objectIds=fa,fa=X.selectFeatures(ca,W.SELECTION_SUBTRACT,g.hitch(this,
function(ha){console.log(ha.length)})),K.push(fa));I=I.concat(ka)}));K.push(U)}));0===K.length?(this._byPass=!0,this.map.popupManager._showPopup(p),this._byPass=!1):E(K).then(g.hitch(this,function(){this.updateFeatures=I;0<this.updateFeatures.length?this._showTemplate(!1):(this._byPass=!0,this.map.popupManager._showPopup(p),this._byPass=!1)}))},_attachLayerHandler:function(){this._eventHandler=this.own(m(this.currentFeature._layer,"visibility-change",g.hitch(this,function(){})))},_removeLayerVisibleHandler:function(){null!==
this._eventHandler&&(f.forEach(this._eventHandler,g.hitch(this,function(p){"function"===typeof p.remove&&p.remove()})),this._eventHandler=null)},_postFeatureSave:function(p){this.updateFeatures&&1<this.updateFeatures.length&&f.forEach(this.updateFeatures,g.hitch(this,function(z){z.setSymbol(this._getSelectionSymbol(z.getLayer().geometryType,!1))}));p&&p.feature&&(this.geometryChanged=!1,this.currentFeature=p.feature,this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes)),
this._attachLayerHandler(),this.currentLayerInfo=this._getLayerInfoByID(this.currentFeature._layer.id),this.currentLayerInfo.isCache=!1,this._createSmartAttributes(),this._createAttributeInspectorTools(),this._attributeInspectorTools.triggerFormValidation(),this._validateAttributes(),this._enableAttrInspectorSaveButton(!1),this.currentFeature.hasOwnProperty("allowDelete")?this._toggleDeleteButton(this.currentFeature.allowDelete&&this.currentLayerInfo.allowDelete):this._toggleDeleteButton(this.currentLayerInfo.allowDelete),
this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues),this.currentFeature.setSymbol(this._getSelectionSymbol(p.feature.getLayer().geometryType,!0)))},_promptToDelete:function(){var p=new Ca({titleLabel:this.nls.deletePromptTitle,
width:400,maxHeight:200,autoHeight:!0,content:this.nls.deletePrompt,buttons:[{label:this.nls.yes,classNames:["jimu-btn"],onClick:g.hitch(this,function(){this._deleteFeature();p.close()})},{label:this.nls.no,classNames:["jimu-btn"],onClick:g.hitch(this,function(){p.close()})}],onClose:g.hitch(this,function(){})})},_promptToResolvePendingEdit:function(p,z,C,I){var K=!this._validateAttributes();I=K?-1:0;var X=new O;K=[{label:this.nls.yes,classNames:["jimu-btn"],disable:K,onClick:g.hitch(this,function(){this._saveEdit(this.currentFeature,
p,!0).then(g.hitch(this,function(){null!==z&&void 0!==z&&(z.hasOwnProperty("featureLayer")&&z.hasOwnProperty("feature")?this.load_from_featureaction(z.featureLayer,z.feature):this._postFeatureSave(z));X.resolve("yes")}));U.close()})},{label:this.nls.no,classNames:["jimu-btn"],onClick:g.hitch(this,function(){this._cancelEditingFeature(p);null!==z&&void 0!==z&&(z.hasOwnProperty("featureLayer")&&z.hasOwnProperty("feature")?this.load_from_featureaction(z.featureLayer,z.feature):this._postFeatureSave(z));
U.close();X.resolve("no")})}];C&&!0===C&&K.push({label:this.nls.back,classNames:["jimu-btn"],onClick:g.hitch(this,function(){X.reject();U.close()})});var U=new Ca({titleLabel:this.nls.savePromptTitle,width:400,maxHeight:200,autoHeight:!0,content:this.nls.savePrompt,buttons:K,onClose:g.hitch(this,function(){})});ma.set(U.disabledButtons[0],"tabindex",I);return X.promise},_removeLocalLayers:function(){this.cacheLayer&&null!==this.cacheLayer&&(this.cacheLayer.clearSelection(),this.cacheLayer.clear(),
this.map.removeLayer(this.cacheLayer),this.cacheLayer=null);this.updateFeatures=[]},_removeSpacesInLayerTemplates:function(p){if(p){var z=f.filter(p.fields,g.hitch(this,function(C){return!1===C.nullable&&!0===C.editable}));f.forEach(z,g.hitch(this,function(C){f.forEach(p.templates,function(I){" "===I.prototype.attributes[C.name]&&(I.prototype.attributes[C.name]=I.prototype.attributes[C.name].trim())})}))}},_resetEditingVariables:function(){this._editingEnabled=!1;this.editToolbar&&0!==this.editToolbar.getCurrentState().tool&&
this.editToolbar.deactivate()},_feature_removed:function(p,z){return function(){this.attrInspector._featureIdx>=z&&0!==z&&(this.currentFeature=null,this.attrInspector.previous());this.updateFeatures.splice(this.updateFeatures.indexOf(p),1);this._refreshLayerTitle()}},_saveEdit:function(p,z,C){var I=new O;this._enableAttrInspectorSaveButton(!1);this.config.editor.editGeometryDefault||this._turnEditGeometryToggleOff();if(this._validateAttributes()){var K=c(".processing-indicator"),X=c(".processing-indicator-panel"),
U=c(".saveButton",this.buttonHeader)[0];f.forEach(K,function(ca){b.contains(ca,"busy")||b.add(ca,"busy")});f.forEach(X,function(ca){b.contains(ca,"busy")||b.add(ca,"busy")});U&&!b.contains(U,"hide")&&b.add(U,"hide");this._postChanges(p).then(g.hitch(this,function(ca){var fa=!1;if("failed"===ca)I.resolve("failed"),this.addNewRelatedRecord=!1;else{this.addNewRelatedRecord&&(fa=!0,this.attrInspector.destroy(),d.destroy(this.contentWrapper),d.destroy(this.buttonHeader),this.attrInspector=this._attributeInspectorCollection.pop(),
a.set(this.attrInspector.attributeTable,"display","block"),a.set(this.attrInspector.editButtons,"display","block"),a.set(this.attrInspector.deleteBtn.domNode,"display","none"),this.attrInspector._featureIdx=this.attrInspector.ctStoredFeatureIndex,this.attrInspector.refresh(),setTimeout(g.hitch(this,function(){a.set(this.attrInspector.navButtons,"display",!this.attrInspector._hideNavButtons&&1<this.attrInspector._numFeatures?"":"none");this.attrInspector.navMessage.innerHTML=Aa.substitute({idx:this.attrInspector._featureIdx+
1,of:this.attrInspector.NLS_of,numFeatures:this.attrInspector._numFeatures},this.attrInspector._navMessage);(this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null)&&this.currentFeature.attributes&&(this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes)))}),200),this.contentWrapper=this._nodesCollection.pop(),this.buttonHeader=this._buttonsWrapper.pop(),this._traversal.pop(),this.currentRelatedDom&&(ca=ma.get(this.currentRelatedDom,
"relatedRecordCount"))&&0===parseInt(ca,10)&&ma.set(this.currentRelatedDom,"relatedRecordCount",1),this.currentRelatedDom.click());this.currentFeature&&this.currentFeature.attributes&&(this.currentFeature.preEditAttrs=n.parse(n.stringify(this.currentFeature.attributes)));this._relatedTablesInfo[p._layer.id]&&this._relatedTablesInfo[p._layer.id].updateFeatureInstance(p.attributes);this.config.editor.removeOnSave&&1>=this.updateFeatures.length&&1>=this._traversal.length&&!fa&&(z=!0);if(z&&!0===z)this._showTemplate(!0);
else if(this.config.editor.removeOnSave&&1>=this.updateFeatures.length&&1<this._traversal.length)m.emit(this.cancelButton,"click",{cancelable:!0,bubbles:!0});else if(this._resetEditingVariables(),this.map.setInfoWindowOnClick(!0),!0!==this.config.editor.removeOnSave||fa)this.currentFeature&&this.currentFeature.hasOwnProperty("allowDelete")?this._toggleDeleteButton(this.currentFeature.allowDelete&&this.currentLayerInfo.allowDelete):this._toggleDeleteButton(this.currentLayerInfo.allowDelete&&this.currentLayerInfo.configFeatureLayer.layerAllowsDelete),
this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues),this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&setTimeout(g.hitch(this,
function(){2>this._traversal.length&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check())}),100),p.setSymbol(this._getSelectionSymbol(p.getLayer().geometryType,!0));else{fa=p.getLayer();ca=new M;ca.objectIds=[p.attributes[fa.objectIdField]];var ka=this.attrInspector._selection.indexOf(p);fa.selectFeatures(ca,W.SELECTION_SUBTRACT,g.hitch(this,this._feature_removed(p,ka)))}I.resolve("success");this.config.editor.removeOnSave&&0===this.attrInspector._numFeatures||z?this._setWidgetFirstFocusNode("templatePicker",
!0):this._setWidgetFirstFocusNode("AI",!0)}f.forEach(K,function(ha){b.contains(ha,"busy")&&b.remove(ha,"busy")});f.forEach(X,function(ha){b.contains(ha,"busy")&&b.remove(ha,"busy")});b.contains(U,"hide")&&b.remove(U,"hide")}),g.hitch(this,function(){f.forEach(K,function(ca){b.contains(ca,"busy")&&b.remove(ca,"busy")});f.forEach(X,function(ca){b.contains(ca,"busy")&&b.remove(ca,"busy")});b.contains(U,"hide")&&b.remove(U,"hide")}))}return I.promise},_showTemplate:function(p){this._attrInspIsCurrentlyDisplayed=
!p;p?(this._mapClickHandler(!0),this._showTemplatePicker(),this._traversal=[],this._nodesCollection=[],this._paginationNodeCollection=[],this._buttonsWrapper=[],this._attributeInspectorCollection=[],this._relatedTablesInfo={},this.currentFeature=null,this.geometryChanged=!1,this.currentLayerInfo=null):(this._mapClickHandler(!1),c(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display="none",c(".jimu-widget-smartEditor .attributeInspectorMainDiv")[0].style.display="block",this.attrInspector&&
(!this.currentFeature&&this.attrInspector&&0<this.attrInspector._numFeatures&&this.attrInspector.first(),this.attrInspector.refresh(),this._createSmartAttributes(),this._createAttributeInspectorTools(),this._attributeInspectorTools.triggerFormValidation(),this.currentFeature&&this.currentFeature.getLayer().originalLayerId?this._enableAttrInspectorSaveButton(this._validateAttributes()):(this._validateAttributes(!1),this._enableAttrInspectorSaveButton(!1)),this.currentLayerInfo.isCache&&!0===this.currentLayerInfo.isCache?
this._toggleEditGeoSwitch(!1):this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues),this._addWarning(),this._setWidgetFirstFocusNode("AI",!0)),this._recordLoadeAttInspector())},_createAttributeInspectorTools:function(){if(void 0!==
this.currentFeature&&null!==this.currentFeature){var p=c("td.atiLabel",this.attrInspector.domNode);void 0!==p&&null!==p&&(this._attributeInspectorTools=new la({_attrInspector:this.attrInspector,_feature:this.currentFeature,_fieldInfo:this.currentLayerInfo.fieldInfos}))}},_createSmartAttributes:function(){if(void 0!==this.currentFeature&&null!==this.currentFeature){var p=c("td.atiLabel",this.attrInspector.domNode);void 0!==p&&null!==p&&(p=null,void 0!==this.currentLayerInfo&&null!==this.currentLayerInfo&&
void 0!==this.currentLayerInfo.fieldValidations&&null!==this.currentLayerInfo.fieldValidations&&(p=this.currentLayerInfo.fieldValidations),null!==p&&(this._smartAttributes=new ea({_attrInspector:this.attrInspector,_fieldValidation:p,_feature:this.currentFeature,_fieldInfo:this.currentLayerInfo.fieldInfos,_url:this.currentLayerInfo.featureLayer.url}),this.own(m(this._smartAttributes,"onFieldToggle",g.hitch(this,function(){this._add508SupportToAttachmentsDeleteBtn("AI")})))))}},_showTemplatePicker:function(){c(".jimu-widget-smartEditor .attributeInspectorMainDiv")[0].style.display=
"none";c(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display="block";if(this.templatePicker){var p=0;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(p=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow);this.config.editor.hasOwnProperty("keepTemplateSelected")?!0!==this.config.editor.keepTemplateSelected&&this._clearTemplateSelection():this._clearTemplateSelection();
if(this.templatePicker){var z=null;this.drawingTool&&this.currentDrawType&&(z=this.currentDrawType);this._activateTemplateToolbar(z);var C=p,I=null,K=null;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(I=this.templatePicker._selectedInfo,C=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow,K=this.templatePicker.getSelected(),this._selectTemplateIndex=C);this.templatePicker.update();
this.templatePicker.grid.scrollToRow(C);setTimeout(g.hitch(this,function(){null!==K&&this.templatePicker.grid.store.fetch({onComplete:g.hitch(this,function(U){var ca=(U=this.templatePicker._locate(K,I,U))&&this.templatePicker.grid.views.views[0].getCellNode(U[0],U[1]);ca&&(this._selectTemplateIndex>this.templatePicker.grid.rowsPerPage&&this.templatePicker._rowClicked({cellNode:ca,rowIndex:U[0],cellIndex:U[1]},!0),this.templatePicker.grid.scrollToRow(C))})})}),500)}}this._resetEditingVariables();var X=
[];this.updateFeatures&&f.forEach(this.updateFeatures,g.hitch(this,function(U){U=U.getLayer();X&&-1===X.indexOf(U.id)&&(X.push(U.id),U.clearSelection(),U.refresh())}));this._clearLayerSelection();this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;this._removeLocalLayers();!0===this._recreateOnNextShow&&(this._recreateOnNextShow=!1,this._createEditor());this._creationDisabledOnAll?(this.templatePicker&&A.style(this.templatePicker.domNode,"display","none"),this.drawingTool&&
A.style(this.drawingTool.domNode,"display","none")):(this.templatePicker&&A.style(this.templatePicker.domNode,"display","block"),this.drawingTool&&A.style(this.drawingTool.domNode,"display","block"));this._copyFeaturesObj&&this._copyFeaturesObj.cancelBtnClicked()},_setPresetValue:function(){this._usePresetValues=aa.byId("savePresetValueSwitch").checked},_toggleUsePresetValues:function(p){var z=aa.byId("savePresetValueSwitch");p?z.check():z.uncheck();this._usePresetValues=z.checked},_turnEditGeometryToggleOff:function(){1<
this._traversal.length||!this._editGeomSwitch||!this._editGeomSwitch.checked||(this.editToolbar&&0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate(),this._editingEnabled=!1,this._ignoreEditGeometryToggle=!0,this._editGeomSwitch.set("checked",!1),this._editGeomSwitch.uncheck(),this.map.setInfoWindowOnClick(!0),setTimeout(g.hitch(this,function(){this._ignoreEditGeometryToggle=!1}),2))},_validateFeatureChanged:function(){if(this.currentFeature){if(void 0!==this.geometryChanged&&
null!==this.geometryChanged&&!0===this.geometryChanged)return!0;var p=this._changed_feature(this.currentFeature,!0),z=p[0];p=p[2];if(null!==z&&0===Object.keys(z.attributes).length&&"Add"!==p)return!1}return!0},_validateRequiredFields:function(){var p={};if(!this.currentFeature)return p;var z=this.currentFeature.getLayer();z=f.filter(z.fields,g.hitch(this,function(C){return!1===C.nullable&&!0===C.editable}));f.forEach(z,g.hitch(this,function(C){if("esriFieldTypeDate"===C.type){var I=this._getCurrentFieldDijit(C.name);
I&&0<I.length&&(null!==I[0].get("value")&&void 0!==I[0].get("value")?I[1]&&null===I[1].get("value")?(I[1].set("required",!0),I=c("td[data-fieldname\x3d"+C.name+"]",this.attrInspector.domNode)[0].parentNode,b.add(I.childNodes[1].childNodes[1],["dijitTextBoxError","dijitError"]),p[C.alias]="null"):(I=c("td[data-fieldname\x3d"+C.name+"]",this.attrInspector.domNode)[0].parentNode,b.remove(I.childNodes[1].childNodes[1],["dijitTextBoxError","dijitError"])):p[C.alias]="null")}else if("undefined"===this.currentFeature.attributes[C.name])p[C.alias]=
"undefined";else if(null===this.currentFeature.attributes[C.name])p[C.alias]="null";else switch(C.type){case "esriFieldTypeString":if(""===this.currentFeature.attributes[C.name]||this.currentFeature.attributes[C.name]&&""===this.currentFeature.attributes[C.name].trim())p[C.alias]="Empty string"}}));return p},_worksAfterClose:function(){q.toolbars.draw.start=this._defaultStartStr;q.toolbars.draw.addPoint=this._defaultAddPointStr},_workBeforeCreate:function(){var p="\x3cbr/\x3e("+this.nls.pressStr+
"\x3cb\x3e"+this.nls.ctrlStr+"\x3c/b\x3e "+this.nls.snapStr+")";this._defaultStartStr=q.toolbars.draw.start;this._defaultAddPointStr=q.toolbars.draw.addPoint;q.toolbars.draw.start+=p;q.toolbars.draw.addPoint+=p},_getDefaultFieldInfos:function(p){var z=Q.getFieldInfosFromWebmap(p.id,this._jimuLayerInfos);if(void 0===z||null===z)z=Q.getFieldInfosLayer(p.id,this._jimuLayerInfos);z&&(z=f.filter(z,function(C){return C.visible||C.isEditable}));return z},_getDefaultLayerInfos:function(){for(var p=[],z,C=
this.map.graphicsLayerIds.length-1;0<=C;C--)if(z=this.map.getLayer(this.map.graphicsLayerIds[C]),"Feature Layer"===z.type&&z.url){var I={featureLayer:{}};I.featureLayer.id=z.id;I.disableGeometryUpdate=!1;I.allowUpdateOnly=!1;(z=this._getDefaultFieldInfos(z))&&0<z.length&&(I.fieldInfos=z);p.push(I)}return p},_converConfiguredLayerInfos:function(p){f.forEach(p,function(z){var C;if(!z.featureLayer.id&&z.featureLayer.url){if(C=this.getLayerObjectFromMapByUrl(this.map,z.featureLayer.url))z.featureLayer.id=
C.id}else C=this.map.getLayer(z.featureLayer.id);var I=z.featureLayer.id;z.featureLayer.hasOwnProperty("originalLayerId")&&(I=z.featureLayer.originalLayerId);if(C){var K=[],X=Q.getFieldInfosFromWebmap(I,this._jimuLayerInfos);if(void 0===X||null===X)X=Q.getFieldInfosLayer(I,this._jimuLayerInfos);f.forEach(X,function(U){U.fieldName!==C.globalIdField&&U.fieldName!==C.objectIdField&&"esriFieldTypeGeometry"!==U.type&&"esriFieldTypeOID"!==U.type&&"esriFieldTypeBlob"!==U.type&&"esriFieldTypeGlobalID"!==
U.type&&"esriFieldTypeRaster"!==U.type&&"esriFieldTypeXML"!==U.type&&(U=this.getFieldInfoFromWebmapFieldInfos(U,z.fieldInfos),!0===U.visible&&K.push(U))},this);0!==K.length&&(z.fieldInfos=K)}},this);return p},getLayerObjectFromMapByUrl:function(p,z){for(var C=null,I=0;I<p.graphicsLayerIds.length;I++){var K=p.getLayer(p.graphicsLayerIds[I]);if(K.url.toLowerCase()===z.toLowerCase()){C=K;break}}return C},getFieldInfoFromWebmapFieldInfos:function(p,z){var C={};(z=f.filter(z,function(K){return p.fieldName===
K.fieldName}))&&(C=1<=z.length?z[0]:p);C.label=void 0===C.label?p.label:C.label;C.visible=void 0===C.visible?p.visible:C.visible;C.isEditableSettingInWebmap=void 0===p.isEditable?!0:p.isEditable;C.isEditable=void 0===C.isEditable?p.isEditable:C.isEditable;C.canPresetValue=void 0===C.canPresetValue?!1:C.canPresetValue;C.format=void 0===p.format?null:p.format;for(var I in p)p.hasOwnProperty(I)&&!1===C.hasOwnProperty(I)&&(C[I]=p[I]);return C},getConfigDefaults:function(){this.config.editor.hasOwnProperty("editGeometryDefault")&&
!0===this.config.editor.editGeometryDefault?setTimeout(g.hitch(this,function(){2>this._traversal.length&&this._editGeomSwitch.domNode&&this._editGeomSwitch.check()}),100):this._turnEditGeometryToggleOff()},_processConfig:function(){f.forEach(this.config.editor.configInfos,function(p){p.hasOwnProperty("_editFlag")||(p._editFlag=!0);var z=p.layerInfo.layerObject;z&&(!1===p.allowUpdateOnly&&this.own(m(z,"visibility-change, scale-visibility-change",g.hitch(this,function(){this._layerScaleClearedTimer&&
clearTimeout(this._layerScaleClearedTimer);this._layerScaleClearedTimer=setTimeout(g.hitch(this,function(){this._createEditor(!1)}),200)}))),this._removeSpacesInLayerTemplates(z),this.processConfigForRuntime(p),p.configFeatureLayer=p.featureLayer,p.featureLayer=z,p.showDeleteButton=!1)},this)},onClose:function(){this._worksAfterClose();this._mapClickHandler(!1);this._removeLayerVisibleHandler();this._unLockMapNavigation();this._coordinates&&this._coordinates.fieldsPopup&&this._coordinates.fieldsPopup.domNode&&
this._coordinates.fieldsPopup.close()},_update:function(){},resize:function(){this._update()},onNormalize:function(){setTimeout(g.hitch(this,this._update),100)},onMinimize:function(){console.log("min")},onMaximize:function(){setTimeout(g.hitch(this,this._update),100)},addItem:function(p,z,C,I,K,X,U){var ca=d.create("div",{"class":"esriCTItem"},null);this._createItemTitle(p,ca,K?!0:z,K,X);this._createItemContent(ca,K?!0:z,I,U);K&&(b.add(ca,"esriCTDisableToggling"),ma.set(ca.children[0],"tabindex",
"-1"));C.appendChild(ca);return ca},_createItemTitle:function(p,z,C,I,K){var X=d.create("div",{"class":"esriCTItemTitleContainer",tabindex:"0",role:"button","aria-label":p},z);d.create("div",{"class":"esriCTItemHighlighter"},X);var U=d.create("div",{"class":"esriCTItemTitle esriCTFloatLeft",innerHTML:p,title:p},X);p===this.nls.relatedItemTitle&&ma.set(X,"isRelatedItem","true");1>=this._traversal.length&&K&&!K.visibleAtMapScale&&(U.style.opacity="0.3");p=d.create("div",{"class":"itemTitleArrowIcon"},
X);C?b.add(p,"itemTitleUpArrow"):b.add(p,"itemTitleDownArrow");this.own(m(X,"click",g.hitch(this,function(ca){b.contains(ca.currentTarget.parentElement,"esriCTDisableToggling")||I||this._togglePanel(z)})));this.own(m(X,"keydown",g.hitch(this,function(ca){if(ca.keyCode===l.ENTER||ca.keyCode===l.SPACE)b.contains(ca.currentTarget.parentElement,"esriCTDisableToggling")||I||this._togglePanel(z)})))},_createItemContent:function(p,z,C,I){var K=d.create("div",{"class":"esriCTItemContent esriCTRelatedItemContent"},
p);I?((C=Fa.decode(this._fetchLayerDescription(C)))&&d.create("div",{"class":"editDescription",innerHTML:this.editorXssFilter.sanitize(C),role:"presentation",tabindex:"0","aria-label":va.stripHTML(C)},K),d.place(this.attrInspector.domNode,K,"last")):this._relatedTablesInfo[this.attrInspector._currentFeature._layer.id]&&this._relatedTablesInfo[this.attrInspector._currentFeature._layer.id].domNode&&d.place(this._relatedTablesInfo[this.attrInspector._currentFeature._layer.id].domNode,K,"last");z&&this._togglePanel(p)},
_togglePanel:function(p){var z=c(".esriCTItemTitle",p)[0];var C=c(".itemTitleArrowIcon",p)[0];var I=c(".esriCTItemContent",p)[0];var K=c(".esriCTItemHighlighter",p)[0];z&&I&&!b.contains(p,"esriCTDisableToggling")&&(b.contains(I,"esriCTItemContentActive")?(a.set(K,"backgroundColor","transparent"),b.replace(C,"itemTitleDownArrow","itemTitleUpArrow"),z.innerHTML===this.nls.relatedItemTitle?this._setTabIndexToListItems(p,!0,"-1"):this._setTabIndexToListItems(p,!1,"-1")):(a.set(K,"backgroundColor",this.config.selectedThemeColor),
b.replace(C,"itemTitleUpArrow","itemTitleDownArrow"),z.innerHTML===this.nls.relatedItemTitle?this._setTabIndexToListItems(p,!0,"0"):this._setTabIndexToListItems(p,!1,"0")),b.toggle(I,"esriCTItemContentActive"));this._setWidgetFirstFocusNode("AI",!1)},_setTabIndexToListItems:function(p,z,C){z?(p=c(".relatedTableFields",p),f.forEach(p,g.hitch(this,function(I){ma.set(I,"tabindex",C)}))):(p=aa.findWidgets(this.attrInspector.domNode),f.forEach(p,g.hitch(this,function(I){I.focusNode&&ma.set(I.focusNode,
"tabindex",C)})),f.forEach(c(".esriCTCustomButtons",this.attrInspector.domNode),g.hitch(this,function(I){ma.set(I,"tabindex",C)})),(p=c(".editDescription",this.attrInspector.domNode.parentElement))&&0<p.length&&ma.set(p[0],"tabindex",C),ma.set(this._editGeomSwitch.domNode,"tabindex",C),this._setTabIndexToAttachmentSection(C))},_setTabIndexToAttachmentSection:function(p){if(this.attrInspector._attachmentEditor){var z;var C=this.attrInspector._attachmentEditor._attachmentList;(z=this.attrInspector._attachmentEditor._uploadForm)&&
"block"===a.get(z,"display")&&ma.set(z.children[0],"tabindex",p);C&&0<C.childNodes.length&&f.forEach(C.childNodes,g.hitch(this,function(I){"#text"!==I.nodeName&&(ma.set(I.children[0],"tabindex",p),ma.set(I.children[1],"tabindex",p))}))}},_fetchLayerDescription:function(p){var z=this.config.editor.layerInfos;this._traversal&&0<this._traversal.length?f.some(this._traversal,function(I,K){f.some(z,function(X){if(X.featureLayer.id===I)return z=X,!0});1<this._traversal.length&&K+1<this._traversal.length&&
(z=z.relationshipInfos)},this):f.some(z,function(I){if(I.featureLayer.id===p)return z=I,!0});if(z.editDescription)var C=z.editDescription;"\x3cbr\x3e"===C&&(C="");return C},_getRelationshipInfo:function(p){var z=p._layer.id;if(this._traversal&&0<this._traversal.length){var C=this.config.editor.configInfos;f.some(this._traversal,function(K,X){f.some(C,function(U){if(U.featureLayer.id===K)return C=U,!0});1<this._traversal.length&&X+1<this._traversal.length&&(C=C.relationshipInfos)},this);return C.relationshipInfos}var I=
null;this.config.editor.configInfos.some(function(K){return K.featureLayer.id===z?(I=K.relationshipInfos,!0):!1});return I},_getSelectedThemeColor:function(){this.config.selectedThemeColor="#000000";var p=this.appConfig.theme.name;var z=this.appConfig&&this.appConfig.theme&&this.appConfig.theme.styles?this.appConfig.theme.styles[0]:"default";this.appConfig&&this.appConfig.theme&&this.appConfig.theme.customStyles&&this.appConfig.theme.customStyles.mainBackgroundColor?this.config.selectedThemeColor=
this.appConfig.theme.customStyles.mainBackgroundColor:r({url:"./themes/"+p+"/manifest.json",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(g.hitch(this,function(C){var I;if(C&&C.styles&&0<C.styles.length)for(I=0;I<C.styles.length;I++){var K=C.styles[I];if(K.name===z){this.config.selectedThemeColor=K.styleColor;break}}}))},_getRelatedRecordsByRelatedQuery:function(p,z,C,I){var K=new O,X=new R,U=this._jimuLayerInfos.getLayerOrTableInfoById(C).layerObject.objectIdField;X.returnGeometry=
!1;X.outSpatialReference=this.map.spatialReference;X.relationshipId=z;X.objectIds=[I];X.outFields=[U];this.loading.show();p.queryRelatedFeatures(X,g.hitch(this,function(ca){var fa=[];f.forEach(ca[I]&&ca[I].features,function(ka){fa.push(ka.attributes[U])});this.loading.hide();K.resolve(fa)}),g.hitch(this,function(){this.loading.hide();K.resolve([])}));return K},_getCurrentFieldDijit:function(p){var z;f.some(this.attrInspector._currentLInfo.fieldInfos,g.hitch(this,function(C){if(C.name===p)return z=
C.dijit,!0}));return z},_updateRefreshButtonState:function(){var p;if(this._refreshButton&&this.config.editor.enableAttributeUpdates)if(this.config.editor.enableAutomaticAttributeUpdates)b.remove(this._refreshButton,"hidden"),b.contains(this._refreshButton,"esriCTAutoUpdateOnMode")&&this._refreshAttributes();else if(ma.has(this._refreshButton,"hasGeometryDependency"))(p=ma.get(this._refreshButton,"hasGeometryDependency"))&&b.remove(this._refreshButton,"hidden");else if(this.currentLayerInfo.fieldValues){p=
!1;for(var z in this.currentLayerInfo.fieldValues){for(var C=0;C<this.currentLayerInfo.fieldValues[z].length;C++){var I=this.currentLayerInfo.fieldValues[z][C];if("Intersection"===I.actionName&&I.enabled){p=!0;break}if("Address"===I.actionName&&I.enabled){p=!0;break}if("Coordinates"===I.actionName&&I.enabled){p=!0;break}}if(p)break}ma.set(this._refreshButton,"hasGeometryDependency",p);p&&b.remove(this._refreshButton,"hidden")}},_refreshAttributes:function(){this.loading.show();this._getCopyAttributes(this.currentLayerInfo,
this.currentFeature.geometry).then(g.hitch(this,function(p){var z=[];if(this.currentLayerInfo.fieldValues){for(var C in this.currentLayerInfo.fieldValues)for(var I=0;I<this.currentLayerInfo.fieldValues[C].length;I++){var K=this.currentLayerInfo.fieldValues[C][I],X=!1,U=!0,ca=null;if(p&&"Intersection"===K.actionName&&K.enabled){for(ca=0;ca<K.fields.length;ca++){var fa=K.fields[ca];if(p.Intersection.hasOwnProperty(C)&&p.Intersection[C].hasOwnProperty(fa.layerId)&&p.Intersection[C][fa.layerId].hasOwnProperty(fa.field)){ca=
p.Intersection[C][fa.layerId][fa.field];this._setValuesInDijits(C,ca);X=!0;U=!1;p.multipleValues&&p.multipleValues.hasOwnProperty(C)&&0>z.indexOf(C)&&z.push(C);break}}if(X)break}if(p&&"Address"===K.actionName&&K.enabled&&p.Address.hasOwnProperty(K.field)){ca=p.Address[K.field];this._setValuesInDijits(C,ca);U=!1;break}if(p&&"Coordinates"===K.actionName&&K.enabled){K.coordinatesSource&&"myLocation"===K.coordinatesSource?(I=p.MyLocation.Coordinates.hasOwnProperty(K.coordinatesSystem),ca="xy"===K.field?
I?p.MyLocation.Coordinates[K.coordinatesSystem].x+" "+p.MyLocation.Coordinates[K.coordinatesSystem].y:"":I?p.MyLocation.Coordinates[K.coordinatesSystem][K.field]:""):ca="xy"===K.field?p.Coordinates[K.coordinatesSystem].x+" "+p.Coordinates[K.coordinatesSystem].y:p.Coordinates[K.coordinatesSystem][K.field];this._setValuesInDijits(C,ca);U=!1;break}if("Preset"===K.actionName&&K.enabled&&this._usePresetValues){U=!1;break}U&&K.enabled&&("Intersection"===K.actionName||"Address"===K.actionName||"Coordinates"===
K.actionName)&&this._setValuesInDijits(C,null)}if(p)if(p.multipleValues&&0<z.length){var ka={};f.forEach(z,function(ha){ka[ha]=p.multipleValues[ha]});p.multipleValues=ka}else p.multipleValues=null;this._addValuePicker(p)}this.loading.hide();setTimeout(function(){La.curNode&&La.curNode.blur()},100)}))},_setValuesInDijits:function(p,z){var C=this._getCurrentFieldDijit(p);p=null;C&&C.set?(C.domNode&&b.contains(C.domNode,"atiTextAreaField")&&void 0!==z&&null!==z&&(z=z.toString()),C.domNode&&b.contains(C.domNode,
"atiRichTextField")&&void 0!==z&&(z=null===z?"":z.toString()),C.set("value",z,!0),C.focus()):C&&0<C.length&&(z&&(p=new Date(z)),C[0]&&C[0].set("value",p,!0),1<C.length&&C[1]&&C[1].set("value",p,!0))},_getOrClearSelectableLayers:function(p){var z,C;var I=[];p&&(z=Ha.getInstance());if(this.templatePicker&&(C=this.templatePicker.getSelected())){var K=C.featureLayer;K=K.geometryType}for(var X in this.map._layers)this.map._layers.hasOwnProperty(X)&&(C=this.map._layers[X],C.hasOwnProperty("type")&&"Feature Layer"===
C.type&&(p?z.clearSelection(C):K&&C.hasOwnProperty("geometryType")&&C.geometryType===K&&I.push(C)));if(!p)return I},_getSelectedFeature:function(){var p=[];var z=this._getOrClearSelectableLayers(!1);f.forEach(z,g.hitch(this,function(C){p=p.concat(C.getSelectedFeatures())}));return p},_initializeSelectToolWidget:function(){this._selectTool=new Xa({map:this.map,updateSelection:!0,fullyWithin:!1});this._selectTool.setFeatureLayers(this._getOrClearSelectableLayers(!1));this.own(m(this._selectTool,"unloading",
g.hitch(this,function(){this.loading.show();var p=this._getSelectedFeature();0===p.length?h({message:this.nls.noFeatureSelectedMessage}):(this._selectTool.deactivate(),this._copyFeaturesObj||this._createCopyFeaturesInstance(),this._copyFeaturesObj.selectFeaturesToCopy(p),this._setWidgetFirstFocusNode("copyFeatures",!0),this._getOrClearSelectableLayers(!0),this._displayCopyFeatureDiv(),this._resetCopyFeatureListHeight());this.loading.hide()})))},_resetCopyFeatureListHeight:function(){var p=c(".esriCTCopyFeaturesListTitle",
this.copyFeaturesMainNode);p&&0<p.length&&(p=p[0]);p=a.getComputedStyle(p).height;p=parseFloat(p);p+=35;var z=c(".esriCTCopyFeaturesListContent",this.copyFeaturesMainNode);z&&0<z.length&&(z=z[0]);var C=c(".esriCTCopyFeaturesBtnContainer",this.copyFeaturesMainNode);C&&0<C.length&&(C=C[0]);C=a.getComputedStyle(C).height;C=parseFloat(C);var I=a.getComputedStyle(this.copyFeaturesMainNode).height;I=parseFloat(I);a.set(z,"height",I-(p+C)+"px")},_removeCopyFeaturesInstance:function(){this._copyFeaturesObj.highlightGraphicsLayer.clear();
this._hideCopyFeatureDiv();this._destroyCopyFeatureInstance()},_createCopyFeaturesInstance:function(){this._copyFeaturesObj=new Ya({nls:this.nls,layerInfosObj:this._jimuLayerInfos,mainNode:this.copyFeaturesMainNode,appUtils:this.appUtils,map:this.map,hideMultipleFeatureButton:this._layerHasUniqueFields(),widgetId:this.widgetId},d.create("div",{},this.copyFeaturesMainNode));this.own(m(this._copyFeaturesObj,"createSingleFeature",g.hitch(this,function(p){this.loading.show();this._copyFeaturesObj.highlightGraphicsLayer.clear();
this._hideCopyFeatureDiv();this._destroyCopyFeatureInstance();p=this._createSingleGeometry(p);var z=this.templatePicker.getSelected().featureLayer;z=this._getLayerInfoByID(z.id);(p=this._updateAllSelectedGeometries([p.graphic],z,p.layerObj)[0])?this._addGraphicToLocalLayer(p,p.attributes):this.loading.hide()})));this.own(m(this._copyFeaturesObj,"createMultipleFeatures",g.hitch(this,function(p){this.loading.show();if(p&&0<p.length)if(1===p.length){this._removeCopyFeaturesInstance();var z=this.templatePicker.getSelected().featureLayer;
z=this._getLayerInfoByID(z.id);z=this._updateAllSelectedGeometries(p,z)[0];this.templatePicker.hasOwnProperty("_selectedInfo")&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(this._selectTemplateIndex=this.templatePicker._selectedInfo.selRow);z?this._addGraphicToLocalLayer(z,z.attributes):this.loading.hide()}else setTimeout(g.hitch(this,function(){this._addSelectedFeatureInTheLayer(p)}),100);else this._removeCopyFeaturesInstance()})));this.own(m(this._copyFeaturesObj,"cancelBtnClicked",
g.hitch(this,function(){this._onCopyFeatureCancelButtonClicked()})));this._copyFeaturesObj.startup()},_layerHasUniqueFields:function(){var p,z=!1;(p=this.templatePicker.getSelected().featureLayer)&&p.indexes&&0<p.indexes.length&&f.some(p.indexes,g.hitch(this,function(C){if(C.isUnique&&C.fields!==p.objectIdField&&C.fields!==p.globalIdField)return z=!0}));return z},_destroyCopyFeatureInstance:function(){this._copyFeaturesObj&&(this._copyFeaturesObj.destroy(),this._copyFeaturesObj=null);d.empty(this.copyFeaturesMainNode)},
_onCopyFeatureCancelButtonClicked:function(){this._hideCopyFeatureDiv();this._changeSelectToolState();this._destroyCopyFeatureInstance();this._setWidgetFirstFocusNode("templatePicker",!0)},_addSelectedFeatureInTheLayer:function(p){var z=this.templatePicker.getSelected();var C=[];this.copyMultipleFeatureGraphics=[];this.requiredFieldsArray=this.nullAttributeCountRecord=null;var I=this.templatePicker.getSelected().featureLayer,K=this._getLayerInfoByID(I.id);p=this._updateAllSelectedGeometries(p,K);
this.nullAttributeCountRecord=g.clone(z.template.prototype.attributes);for(var X in this.nullAttributeCountRecord)this.nullAttributeCountRecord[X]=0;this.requiredFieldsArray=this._getRequiredFields(K.fieldInfos);f.forEach(p,g.hitch(this,function(U){var ca=this._getCopyAttributes(K,U.geometry);C.push(ca);ca.then(g.hitch(this,function(fa){var ka=g.clone(U.attributes),ha=g.clone(z.template.prototype.attributes),ja;for(ja in ka)if(!ha.hasOwnProperty(ja)||null===ha[ja]||this.config.editor.overrideDefaultsByCopiedFeature)ha[ja]=
ka[ja];this._modifyAttributesWithPresetValues(ha,K,fa);for(ja in ha)fa=this._trimAttrValue(ha[ja]),-1!==this.requiredFieldsArray.indexOf(ja)&&ha.hasOwnProperty(ja)&&-1!==[null,void 0,""].indexOf(fa)&&(this.nullAttributeCountRecord[ja]+=1);this.copyMultipleFeatureGraphics.push({attributes:ha,geometry:U.geometry})}))}));E(C).then(g.hitch(this,function(){var U=[],ca;for(ca in this.nullAttributeCountRecord)0<this.nullAttributeCountRecord[ca]&&U.push(T.getFieldInfoByFieldName(K.fieldInfos,ca));if(0<U.length)this.loading.hide(),
U=new $a({requiredFieldsInfos:U,nls:this.nls,presetUtils:T,AttributesCount:this.nullAttributeCountRecord}),this.own(m(U,"providedValuesToRequiredFields",g.hitch(this,function(ka){this.loading.show();var ha=[];f.forEach(this.copyMultipleFeatureGraphics,g.hitch(this,function(ja){var pa=ja.attributes,ta;for(ta in pa){var wa=this._trimAttrValue(pa[ta]);-1!==this.requiredFieldsArray.indexOf(ta)&&pa.hasOwnProperty(ta)&&-1!==[null,void 0,""].indexOf(wa)&&(pa[ta]=ka[ta])}ja=new ba(ja.geometry,null,pa);ja.preEditAttrs=
n.parse(n.stringify(ja.attributes));ha.push(ja)}));this._applyEdits(ha);this._removeCopyFeaturesInstance()})));else{var fa=[];f.forEach(this.copyMultipleFeatureGraphics,g.hitch(this,function(ka){ka=new ba(ka.geometry,null,ka.attributes);ka.preEditAttrs=n.parse(n.stringify(ka.attributes));fa.push(ka)}));this._applyEdits(fa);this._removeCopyFeaturesInstance()}}),g.hitch(this,function(U){this.loading.hide();h({message:this.nls.addingFeatureError+" "+U.message})}))},_applyEdits:function(p){this.templatePicker.getSelected().featureLayer.applyEdits(p,
null,null,g.hitch(this,function(z){var C;var I=0;var K=[];f.forEach(z,g.hitch(this,function(X){X.success?K.push(X.objectId):I++}));0<I&&(C=Ma.substitute(this.nls.addingFeatureErrorCount,{copyFeatureErrorCount:I}));0===K.length&&0<I?(this.loading.hide(),h({message:this.nls.addingFeatureError+" "+C})):(0<K.length&&0<I&&h({message:C}),this._selectFeaturesInTheLayer(K))}),g.hitch(this,function(z){this.loading.hide();h({message:this.nls.addingFeatureError+" "+z.message})}))},_changeSelectToolState:function(p){this._getOrClearSelectableLayers(!1===
p?!1:!0);"SELECT"===this.currentDrawType&&this.templatePicker&&this.templatePicker.getSelected()&&this._selectTool?this._selectTool.activate():this._selectTool&&this._selectTool.isActive()&&this._selectTool.deactivate();this.currentDrawType&&this.map.setInfoWindowOnClick(!1)},_addMenuItem:function(p,z,C){p=g.mixin(p,{onClick:g.hitch(this,this._drawingToolClick(C,p))});p=new ua(p);z.addChild(p)},_hideCopyFeatureDiv:function(){b.add(this.copyFeaturesMainNode,"esriCTHidden");c(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display=
"block";var p=null,z=null;if(this.templatePicker&&this.templatePicker.grid){p=this.templatePicker.getSelected();var C=0;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(z=this.templatePicker._selectedInfo,C=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow);this.templatePicker.update();this.templatePicker.grid.scrollToRow(C);setTimeout(g.hitch(this,function(){this.config.editor.hasOwnProperty("keepTemplateSelected")&&
!0===this.config.editor.keepTemplateSelected&&null!==p&&this.templatePicker.grid.store.fetch({onComplete:g.hitch(this,function(I){var K=(I=this.templatePicker._locate(p,z,I))&&this.templatePicker.grid.views.views[0].getCellNode(I[0],I[1]);K&&C>this.templatePicker.grid.rowsPerPage&&this.templatePicker._rowClicked({cellNode:K,rowIndex:I[0],cellIndex:I[1]},!0)})});this.templatePicker.grid.scrollToRow(C)}),500)}},_displayCopyFeatureDiv:function(){c(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display=
"none";b.remove(this.copyFeaturesMainNode,"esriCTHidden");if("DashboardTheme"===this.appConfig.theme.name){var p=c(".esriCTCopyFeaturesMainDiv",this.domNode)[0];var z=a.get(p.parentElement).backgroundColor;a.set(p,"backgroundColor",z)}},_createSingleGeometry:function(p){var z;var C=p[0]._layer.geometryType;"esriGeometryPolyline"===C?z=this._createSinglePolyline(p):"esriGeometryPolygon"===C&&(z=this._createSinglePolygon(p));return{graphic:new ba(z,null,p[0].attributes),layerObj:p[0].getLayer()}},_createSinglePolyline:function(p){var z=
new da(new Ea(p[0].geometry.spatialReference));f.forEach(p,g.hitch(this,function(C){C.geometry&&C.geometry.paths&&f.forEach(C.geometry.paths,function(I){z.addPath(I)})}));return z},_createSinglePolygon:function(p){var z=new L(new Ea(p[0].geometry.spatialReference));f.forEach(p,g.hitch(this,function(C){C.geometry&&C.geometry.rings&&f.forEach(C.geometry.rings,function(I){z.addRing(I)})}));return z},_selectFeaturesInTheLayer:function(p){var z=this.templatePicker.getSelected().featureLayer;var C=this._getLayerInfoByID(z.id);
this.map.infoWindow.hide();f.forEach(this._attributeInspectorCollection,function(X){X.destroy()});if(z.isQueryable()){this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this._createAttributeInspector([C],!0,z);C=this.map.getLayersVisibleAtScale().filter(g.hitch(this,function(X){return X.type&&"Feature Layer"===X.type&&X.url?f.some(this.config.editor.configInfos,g.hitch(this,function(U){return U.layerId===
X.id&&this._hasAnyEditableLayerInRelation([U])?!0:!1})):!1}));C=C.filter(g.hitch(this,function(X){try{return this.map.getLayer(X.id).visible}catch(U){return console.log(U+" Check for visible failed"),!0}}));var I=[];this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;C=new M;var K=Date.now();C.objectIds=p;C.where=K+" \x3d "+K;C.outFields=["*"];z.selectFeatures(C,W.SELECTION_NEW,g.hitch(this,function(X){var U=[];f.forEach(X,function(ca){ca.allowDelete=!0;z.getEditCapabilities({feature:ca}).canDelete||
(ca.allowDelete=!1);ca.preEditAttrs=n.parse(n.stringify(ca.attributes));U.push(ca)},this);I=I.concat(U);0<I.length&&(this.updateFeatures=I,this.config.editor.removeOnSave?(this.loading.hide(),this._clearTemplateSelection()):this._showTemplate(!1))}),g.hitch(this,function(){h({message:this.nls.selectingFeatureError});this.loading.hide()}))}else this.loading.hide()},_clearTemplateSelection:function(){var p=null,z=null;if(this.templatePicker&&this.templatePicker.grid){p=this.templatePicker.getSelected();
var C=this._selectTemplateIndex;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(z=this.templatePicker._selectedInfo,this._selectTemplateIndex=C=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow);this.templatePicker.grid.scrollToRow(C);setTimeout(g.hitch(this,function(){this.templatePicker.clearSelection();this.config.editor.hasOwnProperty("keepTemplateSelected")&&!0===this.config.editor.keepTemplateSelected&&
null!==p&&this.templatePicker.grid.store.fetch({onComplete:g.hitch(this,function(I){var K=(I=this.templatePicker._locate(p,z,I))&&this.templatePicker.grid.views.views[0].getCellNode(I[0],I[1]);K&&(this.templatePicker._rowClicked({cellNode:K,rowIndex:I[0],cellIndex:I[1]},!0),this._activateTemplateToolbar(null),this.templatePicker.grid.scrollToRow(C))})});this._selectTemplateIndex=0;this.templatePicker.grid.scrollToRow(C)}),500)}},_updatedDrawingOptions:function(){for(var p in xa)f.forEach(xa[p],g.hitch(this,
function(z,C){z.hasOwnProperty("_drawType")&&"SELECT"===z._drawType&&(xa[p][C].label=this.nls.customSelectOptionLabel)}))},_deactivateAllTools:function(){this.drawToolbar&&this.drawToolbar.deactivate();this._selectTool&&this._selectTool.deactivate()},_updateAllSelectedGeometries:function(p,z,C){var I=[],K=this._getInfoDetails(z);f.forEach(p,g.hitch(this,function(X){var U=X.getLayer();if(null===U||""===U||void 0===U)U=C;var ca=this._getLayerInfoByID(U.id);ca||(this._jimuLayerInfos.getLayerOrTableInfoById(U.id)?
ca=Q.createDefaultConfigInfo(this._jimuLayerInfos.getLayerOrTableInfoById(U.id)):this._jimuLayerInfos.getLayerInfoById(U.id)&&(ca=Q.createDefaultConfigInfo(this._jimuLayerInfos.getLayerInfoById(U.id))));if(ca){U=this._getInfoDetails(ca);ca={};for(var fa in X.attributes){var ka=fa.toLowerCase();K.hasOwnProperty(ka)&&U.hasOwnProperty(ka)&&K[ka].type===U[ka].type&&(ca[K[ka].name]=g.clone(X.attributes[fa]))}I.push(new ba(X.geometry,null,ca))}}));return I},_getInfoDetails:function(p){var z={};f.forEach(p.fieldInfos,
g.hitch(this,function(C){z[C.name.toLowerCase()]={name:C.name,type:C.type}}));return z},_setWidgetFirstFocusNode:function(p,z){p=this._getFirstAndLastFocusNode(p);p.firstNode&&p.lastNode&&(va.initFirstFocusNode(this.domNode,p.firstNode),va.initLastFocusNode(this.domNode,p.lastNode),z&&va.isAutoFocusFirstNodeWidget(this)&&va.focusFirstFocusNode(this.domNode))},_getFirstAndLastFocusNode:function(p){var z={};if("templatePicker"===p)z.firstNode=this._getFirstFocusNodeForTemplatePickerScreen(),z.lastNode=
this._getLastFocusNodeForTemplatePickerScreen();else if("AI"===p){if(this.attrInspector&&this.attrInspector.attributeTable){var C,I;p=aa.findWidgets(this.attrInspector.attributeTable);this.attrInspector.domNode.parentElement&&this.attrInspector.domNode.parentElement.parentElement&&((C=c(".esriCTItemContent",this.attrInspector.domNode.parentElement.parentElement))&&0<C.length&&(I=b.contains(C[0],"esriCTItemContentActive")?"0":"-1"),this._setTabIndexToListItems(null,!1,I));f.forEach(p,g.hitch(this,
function(K){K.focusNode&&ma.get(K.focusNode,"disabled")&&(ma.set(K.focusNode,"disabled",!1),ma.set(K.focusNode,"readonly",!0));if(K.focusNode&&K.domNode.parentElement&&K.domNode.parentElement.parentElement){var X=c(".atiLabel",K.domNode.parentElement.parentElement);X&&X[0]&&(X=X[0].innerHTML,0<=X.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')?(X=X.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',""),ma.set(K.focusNode,"aria-required","true")):0<=X.indexOf('\x3cspan class\x3d"atiRequiredField"\x3e *\x3c/span\x3e')?
(X=X.replace('\x3cspan class\x3d"atiRequiredField"\x3e *\x3c/span\x3e',""),ma.set(K.focusNode,"aria-required","true")):ma.set(K.focusNode,"aria-required","false"),ma.set(K.focusNode,"aria-label",X))}}))}z.firstNode=this._getFirstFocusNodeForAttributeInspectorScreen();z.lastNode=this._getLastFocusNodeForAttributeInspectorScreen()}else"copyFeatures"===p&&(z=this._getFirstAndLastFocusNodeForCopyFeaeturesScreen());return z},_getFirstFocusNodeForTemplatePickerScreen:function(){if(this.config.editor.hasOwnProperty("displayPresetTop")&&
!0===this.config.editor.displayPresetTop&&"block"===a.get(this.presetFieldsTableDiv,"display"))var p=aa.byId("savePresetValueSwitch").domNode;else"block"===a.get(this.templateTitle,"display")?p=this.templateTitle:this.config.editor.useFilterEditor?p=this._filterEditor.selectDropDown:!0===this.config.editor.displayShapeSelector||this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting?p=this.drawingTool.focusNode:this.config.editor.autoSaveEdits?
p=aa.byId("autoSaveSwitch").domNode:"block"===a.get(this.presetFieldsTableDiv,"display")&&(p=aa.byId("savePresetValueSwitch").domNode);return p},_getLastFocusNodeForTemplatePickerScreen:function(){if(this.config.editor.hasOwnProperty("displayPresetTop")&&!1===this.config.editor.displayPresetTop&&"block"===a.get(this.presetFieldsTableDiv,"display")){var p=c("#eePresetValueBody")[0];p&&(p=c(".preset-value-editable .ee-inputField"),p.reverse(),f.some(p,g.hitch(this,function(C){if(!b.contains(C.parentElement.parentElement,
"esriCTHidden"))return z=1<C.parentElement.children.length?C.parentElement.children[1]:C,!0})));if(!z)var z=aa.byId("savePresetValueSwitch").domNode}else if(this.config.editor.autoSaveEdits&&!this._creationDisabledOnAll)z=aa.byId("autoSaveSwitch").domNode;else if((!0===this.config.editor.displayShapeSelector||this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting)&&!this._creationDisabledOnAll)z=this.drawingTool.focusNode;else if(this.config.editor.useFilterEditor&&
!this._creationDisabledOnAll)z=this._filterEditor.filterTextBox;else if("block"===a.get(this.templateTitle,"display"))z=this.templateTitle;else if("block"===a.get(this.presetFieldsTableDiv,"display")){if(p=c("#eePresetValueBody")[0])p=c(".preset-value-editable .ee-inputField"),p.reverse(),f.some(p,g.hitch(this,function(C){if(!b.contains(C.parentElement.parentElement,"esriCTHidden"))return z=1<C.parentElement.children.length?C.parentElement.children[1]:C,!0}));z||(z=aa.byId("savePresetValueSwitch").domNode)}return z},
_getFirstFocusNodeForAttributeInspectorScreen:function(){if(this.config.editor.showActionButtonsAbove)var p=this.cancelButton;else if(1===this.attrInspector._numFeatures){var z=c(".esriCTItem",this.contentWrapper);var C=c(".editDescription",this.contentWrapper);z&&0<z.length&&!b.contains(z[0],"esriCTDisableToggling")?p=z[0].children[0]:C&&0<C.length?p=C[0]:this.attrInspector&&this.attrInspector.attributeTable&&(z=aa.findWidgets(this.attrInspector.attributeTable),f.some(z,g.hitch(this,function(I){if(I.focusNode&&
!b.contains(I.domNode.parentElement.parentElement,"hideField"))return p=I.focusNode,!0})),!p&&this.attrInspector._attachmentEditor&&"block"===a.get(this.attrInspector._attachmentEditor.domNode,"display")&&((z=this.attrInspector._attachmentEditor._attachmentList.childNodes)&&0<z.length&&z[0].children?p=z[0].children[0]:p||this.attrInspector._attachmentEditor._uploadForm&&"block"===a.get(this.attrInspector._attachmentEditor._uploadForm,"display")&&(p=this.attrInspector._attachmentEditor._uploadForm.children[0])),
!p&&this.attrInspector._attachmentUploader&&this.attrInspector._attachmentUploader.attachmentUploader&&(z=c("form",this.attrInspector._attachmentUploader.attachmentUploader))&&0<z.length&&(z=z[0],p="none"!==a.get(z.children[0],"display")?z.children[0]:z.children[1]),2>this._traversal.length&&this._editGeomSwitch.domNode&&!p&&"block"===a.get(this._editGeomSwitch.domNode.parentNode,"display")&&(p=this._editGeomSwitch.domNode),p||(p=this.cancelButton))}else 1<this.attrInspector._numFeatures&&(p=aa.findWidgets(this.attrInspector.navButtons)[0].focusNode);
return p},_getLastFocusNodeForAttributeInspectorScreen:function(){if(!this.config.editor.showActionButtonsAbove){var p=c(".saveButton",this.buttonHeader)[0];if(p&&b.contains(p,"jimu-state-disabled"))if(p=c(".deleteButton",this.buttonHeader),0<p.length){p=p[0];var z="block"===a.get(p,"display")?p:this.cancelButton}else z=this.cancelButton;else z=p}p=c(".detailsContainer",this.mainContainer);p=f.filter(p,function(C){if(!b.contains(C,"hidden"))return C});p=c(".esriCTRelatedItemContent",p[0]);!z&&p&&
0<p.length&&(b.contains(p[0],"esriCTItemContentActive")?z=c(".esriCTLastRelatedItem",p[0])[0]:(p=c("[isrelateditem\x3dtrue]",this.mainContainer))&&0<p.length&&(z=p[p.length-1]));z||(p=c(".esriCTActionButtons",this.attrInspector.domNode),f.forEach(p,g.hitch(this,function(C){"block"===a.get(C,"display")&&(z=C)})));2>this._traversal.length&&this._editGeomSwitch.domNode&&!z&&"block"===a.get(this._editGeomSwitch.domNode.parentNode,"display")&&(z=this._editGeomSwitch.domNode);!z&&this.attrInspector._attachmentEditor&&
"block"===a.get(this.attrInspector._attachmentEditor.domNode,"display")&&(this.attrInspector._attachmentEditor._uploadForm&&"block"===a.get(this.attrInspector._attachmentEditor._uploadForm,"display")?z=this.attrInspector._attachmentEditor._uploadForm:(p=this.attrInspector._attachmentEditor._attachmentList.childNodes)&&0<p.length&&(p=p[p.length-1],z="block"===a.get(p.children[1],"display")?p.children[1]:p.children[0]));!z&&this.attrInspector&&this.attrInspector.attributeTable&&(p=aa.findWidgets(this.attrInspector.attributeTable),
p.reverse(),f.some(p,g.hitch(this,function(C){if(C.focusNode&&!b.contains(C.domNode.parentElement.parentElement,"hideField"))return z=C.focusNode,!0})));!z&&1<this.attrInspector._numFeatures&&(p=aa.findWidgets(this.attrInspector.navButtons),z=p[p.length-1].focusNode);!z&&this.config.editor.showActionButtonsAbove&&(p=c(".saveButton",this.buttonHeader)[0],z=b.contains(p,"jimu-state-disabled")?this.cancelButton:p);return z},_getFirstAndLastFocusNodeForCopyFeaeturesScreen:function(){return{firstNode:this._copyFeaturesObj.warningMessage,
lastNode:this._copyFeaturesObj.cancelBtn}},_canShowValuePicker:function(){var p=this.config.editor.hasOwnProperty("showValuePicker")?this.config.editor.showValuePicker:!1;this.config.editor.hasOwnProperty("autoSaveEdits")&&!0===this._autoSaveRuntime&&(p=!1);return p},_addValuePicker:function(p){var z={},C=[];this._removePreviousValuePickerButtons();p.multipleValues&&this._canShowValuePicker()?(this.currentMultipleValues=p.multipleValues,p=c("tr",this.attrInspector.attributeTable),f.forEach(p,g.hitch(this,
function(I){var K=ma.get(I.children[0],"data-fieldname");if(K&&this.currentMultipleValues.hasOwnProperty(K)){var X=ma.get(I.children[0],"innerHTML");z[K]=X;var U=this._getCurrentFieldDijit(K),ca=!1;U&&(1<U.length?(ca=b.contains(U[0].domNode,"dijitDisabled"),b.add(U[0].domNode,"multipleValueDijit"),b.add(U[1].domNode,"multipleValueDijit")):(ca=b.contains(U.domNode,"dijitDisabled"),b.add(U.domNode,"multipleValueDijit")));ca&&C.push(K);this._createValuePickerButton(K,X,I.children[1],ca,U)}})),C.length!==
Object.keys(z).length&&this._showValuePicker(null,z,C)):(this.currentMultipleValues=null,p.multipleValues=null)},_removePreviousValuePickerButtons:function(){c(".esriCTValuePickerButton",this.attrInspector.attributeTable).forEach(d.destroy);c(".multipleValueDijit",this.attrInspector.attributeTable).removeClass("multipleValueDijit")},_createValuePickerButton:function(p,z,C,I,K){var X={},U="esriCTValuePickerButton";I&&(U+=" disabled");X[p]=z;var ca=d.create("div",{"class":U,tabindex:0,role:"button",
"aria-label":this.nls.valuePicker.buttonTooltip},C);this.own(m(ca,"click",g.hitch(this,function(){b.contains(ca,"disabled")||this._showValuePicker(p,X,[],K)})));this.own(m(ca,"keydown",g.hitch(this,function(fa){fa.keyCode!==l.ENTER&&fa.keyCode!==l.SPACE||b.contains(ca,"disabled")||this._showValuePicker(p,X,[],K)})))},_showValuePicker:function(p,z,C,I){this.currentMultipleValues&&(this.valuePicker&&this.valuePicker.hideDialog(),this.valuePicker=new Za({nls:this.nls,multipleValues:this.currentMultipleValues,
layerInfo:this.currentLayerInfo,showForField:p,fieldLabels:z,disabledFields:C}),p&&this.valuePicker.setValue(this.valuePicker.showForField,I),this.own(m(this.valuePicker,"value-selected",g.hitch(this,function(K){var X=c("tr",this.attrInspector.attributeTable);f.forEach(X,g.hitch(this,function(U){(U=ma.get(U.children[0],"data-fieldname"))&&K.hasOwnProperty(U)&&this._setValuesInDijits(U,K[U])}))}))))},_getRequiredFields:function(p){var z=[];f.forEach(p,g.hitch(this,function(C){!C.nullable&&C.editable&&
z.push(C.name)}));return z},_trimAttrValue:function(p){return"string"===typeof p?p.trim():p},_refreshLayerTitle:function(){var p=c(".esriCTItemTitle",this.domNode)[0];this.attrInspector._currentFeature&&ma.set(p,"innerHTML",va.sanitizeHTML(this.attrInspector._currentFeature._layer.name))},_createHiddenLocateButton:function(){this._myLocationLocateButton=new Ka({map:this.map,highlightLocation:!1,setScale:!1,centerAt:!1,geolocationOptions:{enableHighAccuracy:!0}});this._myLocationLocateButton.startup()}})});