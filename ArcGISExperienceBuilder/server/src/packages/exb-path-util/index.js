"use strict";var __awaiter=this&&this.__awaiter||function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.readAndreplaceContent=exports.fixPath=exports.isIndexPath=void 0;var utils=require("util"),fs=require("fs"),readFile=utils.promisify(fs.readFile);function isIndexPath(e,t){var n=fixPath(e).substr(t.length);return""===n||/(^index\.html)|((^[^\/]+\/)?page\/([^\/]+\/)?index\.html)|(^[^\/]+\/index\.html)|(\/$)/.test(n)}function fixPath(e){return/\/$/.test(e)||/\.(js|jsx|ts|tsx|css|scss|json|html|jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga|map|ico)$/.test(e)?e:e+"/"}exports.isIndexPath=isIndexPath,exports.fixPath=fixPath;var contents={};function readAndreplaceContent(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return!global.isDevEdition&&contents[n]?[2,contents[n]]:[4,readFile(n,"utf-8")];case 1:return t=e.sent(),global.hostEnv&&(t=t.replace("var hostEnv = 'prod';","var hostEnv = '"+global.hostEnv+"';")),global.isDevEdition&&(t=t.replace("var isDevEdition = false;","var isDevEdition = true;")),"/"!==global.mountPath&&(t=(t=(t=(t=(t=t.replace('<base href="/builder/"/>','<base href="'+global.mountPath+'builder/"/>')).replace('<base href="/experience/"/>','<base href="'+global.mountPath+'experience/"/>')).replace('<base href="/template/"/>','<base href="'+global.mountPath+'template/"/>')).replace('<base href="/"/>','<base href="'+global.mountPath+'/"/>')).replace("var mountPath = '/';","var mountPath = '"+global.mountPath+"';")),[2,contents[n]=t]}})})}exports.readAndreplaceContent=readAndreplaceContent;