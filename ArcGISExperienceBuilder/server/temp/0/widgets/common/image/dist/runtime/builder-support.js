System.register(["jimu-core","jimu-ui","jimu-for-builder","jimu-ui/basic/imagecrop"],(function(t){var e,o,n,i;return{setters:[function(t){e=t},function(t){o=t},function(t){n=t},function(t){i=t}],execute:function(){t(function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=417)}({0:function(t,o){t.exports=e},1:function(t,e){t.exports=o},116:function(t,e){t.exports=i},417:function(t,e,o){"use strict";o.r(e);var n,i=o(0),r=o(1),a=o(116),c=o(8),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),u=function(t){function e(e){var o=t.call(this,e)||this;return o.__unmount=!1,o.preloadImage=function(t){o.imgObject=new Image,o.imgObject.src=t;var e=o;o.imgObject.onload=function(t){e.imgObject&&(e.__unmount||e.setState({imageWidth:e.imgObject.width,imageHeight:e.imgObject.height}))}},o.getCropZoomInCropTool=function(t,e,o,n,i){var r=t&&t.cropPixel,a=t&&t.cropZoom,c=null,p=null,u=null;if(r&&a){var s=r.width,g=r.height;e/o>=n/i?(u=i/n*(p=e),c=e/o>=s/g?i*a*(e/(s*a))/u:i*a*(o/(g*a))/u):(p=n/i*(u=o),c=e/o>=s/g?i*a*(e/(s*a))/u:i*a*(o/(g*a))/u)}else e/o>=n/i?u=i/n*(p=e):p=n/i*(u=o),c=1;return p*c/n},o.getCropPositonInCropTool=function(t,e){var o=t&&t.cropPosition;return o?{x:e*o.x/t.cropZoom,y:e*o.y/t.cropZoom}:{x:0,y:0}},o.onCancelCrop=function(){Object(i.getAppStore)().dispatch(i.appActions.setWidgetIsInlineEditingState(o.props.widgetId,!1))},o.onConfirmCrop=function(t,e){var n=o.props.config.functionConfig.imageParam;if(t.cropType===r.CropType.Real&&e&&(n=n.set("url",e.blobUrl).set("fileFormat",e.fileFormat)),n=n.set("cropParam",t),t.cropPixel){Object(i.getAppStore)().dispatch(i.appActions.setWidgetIsInlineEditingState(o.props.widgetId,!1));var a=Object(i.Immutable)(o.props.config.functionConfig);a=(a=a.set("isCropped",!0)).set("imageParam",n),Object(c.getAppConfigAction)().editWidgetConfig(o.props.widgetId,o.props.config.set("functionConfig",a)).exec()}},o.state={imageWidth:null,imageHeight:null},o}return p(e,t),e.prototype.componentDidMount=function(){this.__unmount=!1,this.preloadImage(this.props.config.functionConfig.imageParam.originalUrl)},e.prototype.componentWillUnmount=function(){this.__unmount=!0,this.props.onUnmount&&this.props.onUnmount()},e.prototype.render=function(){var t=i.MutableStoreManager.getInstance().getStateValue([this.props.widgetId,"clientRect"]),e=this.props.config.functionConfig.imageParam&&this.props.config.functionConfig.imageParam.cropParam,o=this.props.widgetWidth,n=this.props.widgetHeight;if(this.state.imageWidth&&this.state.imageHeight){var c=this.getCropZoomInCropTool(e,o,n,this.state.imageWidth,this.state.imageHeight),p=this.getCropPositonInCropTool(e,c),u=this.props.config.functionConfig.imageParam.originalUrl;return i.React.createElement(a.ImageCrop,{crop:p,cropZoom:c,imageFormat:this.props.config.functionConfig.imageParam.fileFormat,onCancelCrop:this.onCancelCrop,widgetArea:t,cropParam:e,originId:this.props.config.functionConfig.imageParam.originalId,widgetId:this.props.widgetId,image:u,onConfirmCrop:this.onConfirmCrop,cropType:"BY_URL"===this.props.config.functionConfig.imageParam.imgSourceType?r.CropType.Fake:null})}return i.ReactDOM.createPortal(i.React.createElement("div",null,i.React.createElement("div",{className:"jimu-widget",style:{zIndex:9999,position:"fixed",top:0,left:0,backgroundColor:"rgb(0, 0, 0, .5)"}}),i.React.createElement("div",{style:{position:"absolute",left:"50%",top:"50%",zIndex:9999},className:"jimu-secondary-loading"})),document&&document.getElementsByTagName("body")[0])},e}(i.React.PureComponent);e.default={WidgetInBuilder:u}},8:function(t,e){t.exports=n}}))}}}));