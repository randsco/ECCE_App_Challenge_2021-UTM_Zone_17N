System.register(["jimu-core"],(function(e){var t;return{setters:[function(e){t=e}],execute:function(){e(function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=233)}({1:function(e,r){e.exports=t},12:function(e,t,r){"use strict";r.r(t),r.d(t,"BREAK_POINTS",(function(){return a})),r.d(t,"DEFAULT_VIEWPORT_SIZE",(function(){return i})),r.d(t,"DEFAULT_PAGE_WIDTH",(function(){return n})),r.d(t,"SCREEN_RESOLUTIONS",(function(){return s})),r.d(t,"SHARED_THEME",(function(){return c})),r.d(t,"SELECTION_DATA_VIEW_ID",(function(){return d})),r.d(t,"DATA_VIEW_ID_FOR_NO_SELECTION",(function(){return l})),r.d(t,"REPEAT_CONTEXT_DATA_VIEW_ID",(function(){return p})),r.d(t,"PROVIDE_REPEATED_DATA_SOURCE_CONTEXT_WIDGET_URI",(function(){return h})),r.d(t,"CURRENT_PAGE",(function(){return f})),r.d(t,"DEFAULT_QUERY_PAGE_SIZE",(function(){return y})),r.d(t,"USER_LOCALE_KEY",(function(){return g}));var o=r(8),a=[576,992],i={DESKTOP:{width:1280,height:800},PAD:{width:768,height:1024},PHONE:{width:414,height:896}},n=960,u={};u[o.d.Large]=[{width:1024,height:768},{width:1280,height:800},{width:1280,height:1024},{width:1366,height:768},{width:1440,height:900},{width:1536,height:864},{width:1600,height:900},{width:1920,height:1080}],u[o.d.Medium]=[{width:601,height:962},{width:600,height:1024},{width:768,height:1024},{width:800,height:1280},{width:834,height:1112}],u[o.d.Small]=[{width:360,height:640},{width:360,height:720},{width:360,height:740},{width:375,height:667},{width:414,height:736}];var s=u,c="themes/shared-theme/",d="selection",l="no_selection",p="repeat_context",h=["widgets/common/list/"],f="current_page",y=100,g="exb_user_locale"},233:function(e,t,r){"use strict";r.r(t),r.d(t,"JimuCoreDataSourceFactory",(function(){return W})),r.d(t,"AbstractDataSource",(function(){return u})),r.d(t,"AbstractLayerFolderDataSource",(function(){return p})),r.d(t,"AbstractLoadableDataSource",(function(){return f})),r.d(t,"AbstractQueriableDataSource",(function(){return v})),r.d(t,"AbstractSetDataSource",(function(){return c})),r.d(t,"AbstractDataRecord",(function(){return m})),r.d(t,"SimpleDataRecordImpl",(function(){return I})),r.d(t,"SimpleDataRecordSetImpl",(function(){return b})),r.d(t,"DataSourceStatus",(function(){return i.b})),r.d(t,"DataSourceTypes",(function(){return i.c})),r.d(t,"SupportedLayerServiceTypes",(function(){return i.f})),r.d(t,"SupportedServiceTypes",(function(){return i.h})),r.d(t,"SupportedItemTypes",(function(){return i.e})),r.d(t,"SupportedLayerTypes",(function(){return i.g})),r.d(t,"QueryScope",(function(){return i.d})),r.d(t,"DataSourceError",(function(){return i.a})),r.d(t,"FeatureDataRecordImpl",(function(){return O})),r.d(t,"CsvDataSourceImpl",(function(){return _})),r.d(t,"FeatureLayerDataSourceImpl",(function(){return C})),r.d(t,"FeatureServiceDataSourceImpl",(function(){return F})),r.d(t,"FeatureSetDataSourceImpl",(function(){return j})),r.d(t,"GroupLayerDataSourceImpl",(function(){return Q})),r.d(t,"MapServiceDataSourceImpl",(function(){return T})),r.d(t,"SimpleLocalDataSourceImpl",(function(){return U})),r.d(t,"SceneServiceDataSourceImpl",(function(){return N})),r.d(t,"SceneLayerDataSourceImpl",(function(){return q}));var o,a=r(1),i=r(4),n=r(12),u=function(){function e(e){if(this.isDataSourceSet=!1,this.records=[],Object.assign(this,e),this.originDataSourceJson=e.dataSourceJson,e.dataSourceJson)this.isDataView=!1,this.isLocal=!1,e.dataSourceJson.url&&(this.url=e.dataSourceJson.url);else{if(!e.belongToDataSource)return void console.error("bad DataSourceConstructorOptions.");e.localId?(this.isLocal=!0,this.isDataView=!1):(this.isLocal=!1,this.isDataView=!0)}}return Object.defineProperty(e.prototype,"url",{get:function(){return a.dataSourceUtils.getWhetherUseProxy()&&a.dataSourceUtils.getDataSourceProxyUrl(this._url)||this._url},set:function(e){this._url=e},enumerable:!1,configurable:!0}),e.prototype.getLabel=function(){var e=this.getDataSourceJson().label||this.getSchema().label;if(this.isLocal)return this.belongToDataSource.getLabel();if(this.isDataView){var t=this.getMainDataSource().getDataSourceJson(),r=(null==t?void 0:t.dataViews)&&t.dataViews[this.dataViewId];return(null==r?void 0:r.label)||e}return e},e.prototype.getDataSourceJson=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getDataSourceJson():this.dataSourceJson},e.prototype.setDataSourceJson=function(e){e?this.dataSourceJson?this.dataSourceJson=this.traverseToMergeDataSourceJson(this.dataSourceJson,e):this.dataSourceJson=e:this.dataSourceJson=this.originDataSourceJson},e.prototype.traverseToMergeDataSourceJson=function(e,t){var r=this;if(!e&&!t)return console.error("Can not merge data source json since do not have base data source json or new data source json."),Object(a.Immutable)({});if(!e)return t;if(!t)return e;var o=e.merge(t.asMutable({deep:!0}));return["label","isHidden","useFields","query","dataViews","childDataSourceJsons"].forEach((function(e){t[e]||(o=o.without(e))})),o.childDataSourceJsons&&Object.keys(o.childDataSourceJsons).forEach((function(a){var i,n=r.traverseToMergeDataSourceJson(null===(i=null==e?void 0:e.childDataSourceJsons)||void 0===i?void 0:i[a],t.childDataSourceJsons[a]);o=o.setIn(["childDataSourceJsons","jimuChildId"],n)})),o},e.prototype.getSchema=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getSchema():this.schema||{}},e.prototype.getSelectedFields=function(){var e,t,r,o;if(this.isLocal)return this.belongToDataSource.getSelectedFields();if(!(o=this.isDataView?null===(t=this.getDataSourceJson().dataViews[this.dataViewId])||void 0===t?void 0:t.outFields:null===(r=this.getDataSourceJson().query)||void 0===r?void 0:r.outFields))return this.getSchema().fields;var a=Object.keys(this.getSchema().fields).filter((function(e){return o.indexOf(e)<0}));return(e=this.getSchema().fields).without.apply(e,a)},e.prototype.setSchema=function(e){this.schema=e},e.prototype.fetchSchema=function(){return Promise.resolve(Object(a.Immutable)({}))},e.prototype.getFetchedSchema=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getFetchedSchema():this.fetchedSchema},e.prototype.setFetchedSchema=function(e){this.fetchedSchema=e},e.prototype.getGeometryType=function(){return null},e.prototype.getReversedConfigSchema=function(){var e=this;if(this.isDataView||this.isLocal)return this.getMainDataSource().getReversedConfigSchema();if(this.reverseSchema)return this.reverseSchema;if(this.isDataSourceSet){var t=this.getDataSourceJson().schema,r={childSchemas:{}};if(!t)return Object(a.Immutable)({});if(!t.childSchemas)return Object(a.Immutable)({label:t.label,childId:t.childId,jimuChildId:t.jimuChildId});Object.keys(t.childSchemas).forEach((function(o){var a=t.childSchemas[o].childId;r.childSchemas[a]?r.childSchemas[a].push(e.getOneReversedConfigSchema(t.childSchemas[o])):r.childSchemas[a]=[e.getOneReversedConfigSchema(t.childSchemas[o])]})),this.reverseSchema=Object(a.Immutable)(r)}else this.reverseSchema=this.getOneReversedConfigSchema(this.getDataSourceJson().schema);return this.reverseSchema},e.prototype.setRecords=function(e){this.records=e,this.addVersion()},e.prototype.setJsonData=function(e){console.error("please implement this. setJsonData")},e.prototype.getOneReversedConfigSchema=function(e){var t={};return e?(t.fields={},Object.keys(e.fields).forEach((function(r){var o=e.fields[r].asMutable({deep:!0});t.fields[o.name]?t.fields[o.name].push(o):t.fields[o.name]=[o]})),e.childId&&(t.childId=e.childId),e.jimuChildId&&(t.jimuChildId=e.jimuChildId),Object(a.Immutable)(t)):Object(a.Immutable)(t)},e.prototype.getStatus=function(){return Object(a.getAppStore)().getState().dataSourcesInfo[this.id]&&Object(a.getAppStore)().getState().dataSourcesInfo[this.id].status},e.prototype.setStatus=function(e){Object(a.getAppStore)().dispatch(a.appActions.dataSourceStatusChanged(this.id,e))},e.prototype.getCountStatus=function(){return Object(a.getAppStore)().getState().dataSourcesInfo[this.id]&&Object(a.getAppStore)().getState().dataSourcesInfo[this.id].countStatus},e.prototype.setCountStatus=function(e){Object(a.getAppStore)().dispatch(a.appActions.dataSourceCountStatusChanged(this.id,e))},e.prototype.getVersion=function(){var e;return null===(e=Object(a.getAppStore)().getState().dataSourcesInfo[this.id])||void 0===e?void 0:e.version},e.prototype.addVersion=function(){Object(a.getAppStore)().dispatch(a.appActions.dataSourceVersionAdded(this.id))},e.prototype.getRecords=function(){return this.records},e.prototype.getSelectionDataView=function(){var e=this.isDataView||this.isLocal?this.getMainDataSource().id:this.id;return this.dataSourceManager.getDataViewDataSource(e,n.SELECTION_DATA_VIEW_ID)},e.prototype.getSelectedRecords=function(){var e=this.getSelectionDataView();return e?e.getRecords():[]},e.prototype.getSelectedRecordIndexes=function(){var e=this;if(!Object(a.getAppStore)().getState().dataSourcesInfo[this.id])return[];var t=this.isDataView||this.isLocal?this.getMainDataSource().id:this.id;return Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIndexes?Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIndexes.asMutable():Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIds?Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIds.asMutable().map((function(t){return e.getRecords().findIndex((function(e){return e.getId()==t}))})):[]},e.prototype.getSelectedRecordIds=function(){var e=this,t=this.isDataView||this.isLocal?this.getMainDataSource().id:this.id;return Object(a.getAppStore)().getState().dataSourcesInfo[t]?Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIds?Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIds.asMutable():Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIndexes?Object(a.getAppStore)().getState().dataSourcesInfo[t].selectedIndexes.asMutable().map((function(t){return e.getRecords()[t].getId()})):[]:[]},e.prototype.nextRecord=function(){if(this.getSelectedRecordIndexes().length>1)return console.warn('method "nextRecord" only works when single record is selected'),null;if(this.getSelectedRecordIndexes().indexOf(this.getRecords().length-1))throw Error("Reach the end of data.");return Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIndexesChanged(this.id,[this.getSelectedRecordIndexes()[0]++])),this.getSelectedRecords()[0]},e.prototype.prevRecord=function(){if(this.getSelectedRecordIndexes().length>1)return console.warn('method "prevRecord" only works when single record is selected'),null;if(this.getSelectedRecordIndexes().indexOf(0))throw Error("Reach the start of data.");return Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIndexesChanged(this.id,[this.getSelectedRecordIndexes()[0]--])),this.getSelectedRecords()[0]},e.prototype.getRecord=function(e){return this.getRecords()[e]},e.prototype.getRecordById=function(e){return this.getRecords().filter((function(t){return t&&t.getId()===e}))[0]},e.prototype.clearSelection=function(){var e=this;this.clearOneDsSelection(this.getMainDataSource()),this.getMainDataSource().getAllDerivedDataSources().forEach((function(t){return e.clearOneDsSelection(t)}))},e.prototype.clearOneDsSelection=function(e){Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIndexesChanged(e.id,null)),Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIdsChanged(e.id,null)),e===this.getMainDataSource()&&(a.jimuHistory.changeQueryObjectByDataRecordIds(e.id,null),a.jimuHistory.changeQueryObjectByDataRecordIndexes(e.id,null),this.copySelectionToDataView([]))},e.prototype.updateSelectionStateAndChangeUrl=function(e,t){var r=this,o=this.getMainDataSource();if("byIndex"===e)if(Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIndexesChanged(this.id,t)),o.getAllDerivedDataSources().forEach((function(e){if(e.id!==r.dataSourceManager.getDataViewDataSourceId(o.id,n.SELECTION_DATA_VIEW_ID)&&e.id!==r.dataSourceManager.getDataViewDataSourceId(o.id,n.DATA_VIEW_ID_FOR_NO_SELECTION)&&e.id!==r.id){var i=t.map((function(e){return r.getRecord(e)&&r.getRecord(e).getId()}));Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIdsChanged(e.id,i))}})),this===o)a.jimuHistory.changeQueryObjectByDataRecordIndexes(this.id,t);else{var i=t.map((function(e){return r.getRecord(e)&&r.getRecord(e).getId()}));Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIdsChanged(o.id,i)),a.jimuHistory.changeQueryObjectByDataRecordIds(o.id,i)}else"byId"===e&&(o.getAllDerivedDataSources().forEach((function(e){e.id!==r.dataSourceManager.getDataViewDataSourceId(o.id,n.SELECTION_DATA_VIEW_ID)&&e.id!==r.dataSourceManager.getDataViewDataSourceId(o.id,n.DATA_VIEW_ID_FOR_NO_SELECTION)&&Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIdsChanged(e.id,t))})),Object(a.getAppStore)().dispatch(a.appActions.dataSourceSelectedIdsChanged(o.id,t)),a.jimuHistory.changeQueryObjectByDataRecordIds(o.id,t))},e.prototype.selectRecord=function(e){this.copySelectionToDataView([this.getRecord(e)]),this.updateSelectionStateAndChangeUrl("byIndex",[e])},e.prototype.selectRecords=function(e){var t=this;this.copySelectionToDataView(e.map((function(e){return t.getRecord(e)}))),this.updateSelectionStateAndChangeUrl("byIndex",e)},e.prototype.selectRecordById=function(e,t){if(!this.getSelectedRecordIds().find((function(t){return t===e}))){var r=t||e&&this.getRecordById(e);this.copySelectionToDataView([r]),this.updateSelectionStateAndChangeUrl("byId",[e])}},e.prototype.selectRecordsByIds=function(e,t){var r=this,o=t||e.map((function(e){return r.getRecordById(e)}));this.copySelectionToDataView(o),this.updateSelectionStateAndChangeUrl("byId",e)},e.prototype.makeSureSelectedRecords=function(){var e=this;return Promise.all(this.getSelectedRecordIds().map((function(t){if(e.getSelectedRecords().find((function(e){return e.getId()===t})))return Promise.resolve();var r=e;return r.queryById?r.queryById(t).then((function(t){e.copySelectionToDataView(e.getSelectedRecords().concat([t])),e.addVersion()})):(console.error("Data source does not support query.",e.id),Promise.resolve())}))).then((function(){return Promise.resolve()}))},e.prototype.copySelectionToDataView=function(e){var t=this.getSelectionDataView();t&&t.setRecords(e.filter((function(e){return!!e})))},e.prototype.getInfo=function(){return Object(a.getAppStore)().getState().dataSourcesInfo[this.id]||Object(a.Immutable)({})},e.prototype.clearData=function(){this.selectRecords([]),this.records=[],this.addVersion()},e.prototype.getIdField=function(){return this.getSchema()&&this.getSchema().idField||"id"},e.prototype.getRootDataSource=function(){if(this.isDataView||this.isLocal)return this.getMainDataSource().getRootDataSource();for(var e=this.parentDataSource;e&&e.parentDataSource;)e=e.parentDataSource;return e},e.prototype.ready=function(){return Promise.resolve({})},e.prototype.getOriginDataSources=function(){var e=this;return this.isDataView||this.isLocal?this.getMainDataSource().getOriginDataSources():this.getDataSourceJson().originDataSources&&0!==this.getDataSourceJson().originDataSources.length?this.getDataSourceJson().originDataSources.asMutable().map((function(t){return e.dataSourceManager.getDataSource(t.dataSourceId)})):[]},e.prototype.getMainDataSource=function(){var e;return this.belongToDataSource?null!==(e=this.belongToDataSource.belongToDataSource)&&void 0!==e?e:this.belongToDataSource:this},e.prototype.getDataViews=function(){var e=this;return this.getMainDataSource()!==this?[]:this.dataSourceManager.getDataSourcesAsArray().filter((function(t){return t.belongToDataSource===e&&t.isDataView}))},e.prototype.getDataView=function(e){return this.getDataViews().find((function(t){return t.dataViewId===e}))},e.prototype.getLocalDataSources=function(){var e=this;return this.isLocal?[]:this.dataSourceManager.getDataSourcesAsArray().filter((function(t){return t.belongToDataSource===e&&t.isLocal}))},e.prototype.getLocalDataSource=function(e){return this.getLocalDataSources().find((function(t){return t.localId===e}))},e.prototype.getAllDerivedDataSources=function(){var e=[],t=this.getDataViews(),r=this.getLocalDataSources();return e=t.concat(r),t.forEach((function(t){e=e.concat(t.getLocalDataSources())})),e},e.prototype.destroy=function(){},e}(),s=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isDataSourceSet=!0,t}return s(t,e),t.prototype.ready=function(){return this._createChildDataSources()},t.prototype.destroy=function(){var e=this;this.getChildDataSources().forEach((function(t){t&&e.dataSourceManager.destroyDataSource(t.id)}))},t.prototype.getChildDataSourceId=function(e){return a.dataSourceUtils.getChildDataSourceId(this.id,e)},t.prototype.getChildDataSources=function(){var e=this;return Object.keys(this.dataSourceManager.getDataSources()).filter((function(t){return e.dataSourceManager.getDataSource(t).parentDataSource===e})).map((function(t){return e.dataSourceManager.getDataSource(t)}))},t.prototype.getChildDataSource=function(e){return this.dataSourceManager.getDataSource(this.getChildDataSourceId(e))},t.prototype.getJimuChildId=function(e){var t=this.getReversedConfigSchema();return t&&t.childSchemas&&t.childSchemas[e]?t.childSchemas[e].map((function(e){return e.jimuChildId})).asMutable():[e]},t}(u),d=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),l=function(){return(l=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},p=function(e){function t(t){var r=e.call(this,t)||this;return r._loadLayer=function(){return r.layer.type===i.g.GroupLayer?r.layer.loadAll().then((function(){return Promise.resolve()})):r.layer.load().then((function(){return Promise.resolve()}))},t.layer&&(r.layer=t.layer),r}return d(t,e),t.prototype.ready=function(){var t=this;return this.fetchServiceDefinition().then((function(){return e.prototype.ready.call(t)}))},t.prototype.getServiceDefinition=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getServiceDefinition():this.serviceDefinition},t.prototype._createChildDataSources=function(){var e,t=this;return this.layer?e=this._loadLayer().then((function(){var e=t.getSubLayers();return Promise.allSettled(e.map((function(e){return t._fetchLayerDefinitionFromSubLayer(e)}))).then((function(r){var o={},n={},u=r.filter((function(e){return"fulfilled"===e.status})).map((function(e){return e.value}));u.forEach((function(e,t){(null==e?void 0:e.layerType)===i.f.SceneLayer3DObject||(null==e?void 0:e.layerType)===i.f.SceneLayerPoint?o[t]=e:n[t]=e}));var s=Promise.allSettled(Object.keys(o).map((function(t){var r,o,i,n=t;return(null===(r=e[n])||void 0===r?void 0:r.associatedLayer)?{layerIndex:n,associatedLayerUrl:a.dataSourceUtils.getUrlByLayer(null===(o=e[n])||void 0===o?void 0:o.associatedLayer)}:a.dataSourceUtils.fetchAssociatedFeatureLayerUrl(a.dataSourceUtils.getUrlByLayer(e[n]),null===(i=e[n])||void 0===i?void 0:i.layerId,null,null).then((function(e){return{layerIndex:n,associatedLayerUrl:e}}))}))).then((function(t){var r=[];return t.filter((function(e){return"fulfilled"===e.status})).map((function(e){return e.value})).forEach((function(t){t.associatedLayerUrl&&r.push({def:u[t.layerIndex],layer:e[t.layerIndex]})})),r})),c=new Promise((function(r){r(Object.keys(n).map((function(t){return{def:n[t],layer:e[t]}})).filter((function(e){return t._getWhetherLayerIsSupported(e.layer,e.def)})))}));return Promise.allSettled([s,c]).then((function(e){var t="fulfilled"===e[0].status?e[0].value:[],r="fulfilled"===e[1].status?e[1].value:[];return t.concat(r)}))}))})):this.url?e=a.dataSourceUtils.fetchSupportedLayerDefinitions(this.url,this.getServiceDefinition()).then((function(e){return Object.keys(e).map((function(t){return{def:e[t]}}))})):this.getDataSourceJson().itemId&&(e=a.requestUtils.requestWrapper(this.getDataSourceJson().portalUrl,(function(e){return a.esri.restPortal.getItemData(t.getDataSourceJson().itemId,{portal:a.portalUrlUtils.getPortalRestUrl(t.getDataSourceJson().portalUrl),authentication:e}).then((function(e){var t;return((null===(t=null==e?void 0:e.layers)||void 0===t?void 0:t.map((function(e){return e.layerDefinition})))||[]).filter((function(e){return e.type===i.f.FeatureLayer})).map((function(e){return{def:e}}))}))}))),e&&(this._childDataSourcesPromise=e.then((function(e){return t._getDsJsonsFromSupportedLayers(e&&e.map((function(e){return l(l({},e),{url:t.getDataSourceJson().url})})),t.getDataSourceJson())})).then((function(e){var r=[];return e.forEach((function(e){var o={id:e.dsJson.id,dataSourceJson:e.dsJson.without("jimuChildId"),parentDataSource:t,jimuChildId:e.dsJson.jimuChildId};t.layer&&(o.layer=e.layer),r.push(t.dataSourceManager.createDataSource(o))})),Promise.allSettled(r).then((function(e){return e.filter((function(e){return"fulfilled"===e.status})).map((function(e){return e.value}))}))}))),this._childDataSourcesPromise},t.prototype.fetchSchema=function(){var e,t,r=this.getChildDataSources(),o=Object(a.Immutable)({childSchemas:{},label:(null===(e=this.layer)||void 0===e?void 0:e.title)||(null===(t=this.getServiceDefinition())||void 0===t?void 0:t.name)});return r.map((function(e,t){var r=e.getFetchedSchema(),i=e.getServiceDefinition?e.getServiceDefinition():e.getLayerDefinition&&e.getLayerDefinition();o=o.setIn(["childSchemas",a.dataSourceUtils.fixLayerId((null==i?void 0:i.name)||""+(null==i?void 0:i.id))],r)})),Promise.resolve(o)},t.prototype.fetchServiceDefinition=function(){var e=this;return this.getServiceDefinition()?Promise.resolve(this.getServiceDefinition()):this.url?a.ServiceManager.getInstance().fetchServiceInfo(this.url).then((function(e){return e.definition})).then((function(t){return t?(e.serviceDefinition=t,e.serviceDefinition):null})):this.layer?(this.serviceDefinition={name:this.layer.title},Promise.resolve(this.serviceDefinition)):this.getDataSourceJson().itemId?a.requestUtils.requestWrapper(this.getDataSourceJson().portalUrl,(function(t){return a.esri.restPortal.getItem(e.getDataSourceJson().itemId,{portal:a.portalUrlUtils.getPortalRestUrl(e.getDataSourceJson().portalUrl),authentication:t}).then((function(t){return e.serviceDefinition={name:t.title},e.serviceDefinition}))})):Promise.resolve(null)},t.prototype.getSubLayers=function(){if(!this.layer)return[];var e=this.layer.sublayers||this.layer.layers;return e?e.toArray():[]},t.prototype.getOriginalDataId=function(){var e,t;return(null===(e=this.layer)||void 0===e?void 0:e.id)||(null===(t=this.serviceDefinition)||void 0===t?void 0:t.id)},t.prototype._getWhetherLayerIsSupported=function(e,t){var r,o,n,u,s,c;if((null===(r=e)||void 0===r?void 0:r.type)===i.g.FeatureLayer||(null==t?void 0:t.type)===i.f.FeatureLayer)return!!(null===(o=e)||void 0===o?void 0:o.fields)||!!(null==t?void 0:t.fields);var d=a.dataSourceUtils.getUrlByLayer(e);return a.dataSourceUtils.isSupportedSingleLayerService(d)||a.dataSourceUtils.isSupportedWholeService(d)||(null===(n=e)||void 0===n?void 0:n.type)===i.g.GroupLayer||(null===(u=e)||void 0===u?void 0:u.type)===i.g.MapImageLayer||(null===(s=e)||void 0===s?void 0:s.type)===i.g.TileLayer||(null===(c=e)||void 0===c?void 0:c.type)===i.g.SceneLayer},t.prototype._fetchLayerDefinitionFromSubLayer=function(e){var t=a.dataSourceUtils.getUrlByLayer(e);return t&&a.dataSourceUtils.isSupportedService(t)?a.ServiceManager.getInstance().fetchServiceInfo(t).then((function(e){return e.definition})):Promise.resolve(null)},t.prototype._getDsJsonsFromSupportedLayers=function(e,t){var r=this;if(!e)return[];var o=[];return e.forEach((function(e){var i=a.dataSourceUtils.getDataSourceSourceUrl(a.dataSourceUtils.getUrlByLayer(e.layer))||a.dataSourceUtils.getFullServiceUrl(e.url,!0,e.def);(e.def?r._getDsJsonsFromSingleLayerDefinition(i,e.def,t):r._getDsJsonsFromSingleLayer(e.layer,t)).forEach((function(t){o=o.concat({dsJson:t,layer:e.layer})}))})),o},t.prototype._getDsJsonsFromSingleLayerDefinition=function(e,t,r){var o=this;if(!t)return[];var n,u=[];return this._getJimuChildIdByJSAPILayerOrLayerDefinition(null,t).forEach((function(s){var c=o.getDataSourceJson().schema?o.getDataSourceJson().schema.childSchemas[s]:null,d=o.getChildDataSourceId(s);a.dataSourceUtils.isSupportedSingleLayerService(e)?n=a.dataSourceUtils.getSingleDsJsonFromLayerDefinition(d,e,t,(null==r?void 0:r.childDataSourceJsons)&&r.childDataSourceJsons[s]?r.childDataSourceJsons[s]:null):a.dataSourceUtils.isSupportedWholeService(e)?n=a.dataSourceUtils.getSingleDsJsonFromWholeServiceDefinition(d,e,t,(null==r?void 0:r.childDataSourceJsons)&&r.childDataSourceJsons[s]?r.childDataSourceJsons[s]:null):e||t.type!==i.f.FeatureLayer||(n=a.dataSourceUtils.getSingleDsJsonFromLayerDefinition(d,e,t,(null==r?void 0:r.childDataSourceJsons)&&r.childDataSourceJsons[s]?r.childDataSourceJsons[s]:null)),n&&(o.getDataSourceJson().portalUrl&&(n=n.set("portalUrl",o.getDataSourceJson().portalUrl)),o.getDataSourceJson().itemId&&(n=n.set("itemId",o.getDataSourceJson().itemId)),c&&(n=n.set("schema",c)),u.push(n.set("jimuChildId",s)))})),u},t.prototype._getDsJsonsFromSingleLayer=function(e,t){var r=this;if(!e)return[];var o,n=[];return this._getJimuChildIdByJSAPILayerOrLayerDefinition(e,null).forEach((function(u){var s=r.getDataSourceJson().schema?r.getDataSourceJson().schema.childSchemas[u]:null,c=r.getChildDataSourceId(u),d=(null==t?void 0:t.childDataSourceJsons)&&t.childDataSourceJsons[u]?t.childDataSourceJsons[u]:null;e.type===i.g.GroupLayer?o=Object(a.Immutable)({id:c,type:i.c.GroupLayer}):e.type===i.g.FeatureLayer&&(o=Object(a.Immutable)({id:c,type:i.c.FeatureLayer,layerId:""+e.layerId})),o&&(r.getDataSourceJson().portalUrl&&(o=o.set("portalUrl",r.getDataSourceJson().portalUrl)),r.getDataSourceJson().itemId&&(o=o.set("itemId",r.getDataSourceJson().itemId)),s&&(o=o.set("schema",s)),o=d?o.merge(d.asMutable({deep:!0})):o,n.push(o.set("jimuChildId",u)))})),n},t.prototype._getJimuChildIdByJSAPILayerOrLayerDefinition=function(e,t){return e?this.getJimuChildId(a.dataSourceUtils.getFixedLayerIdByLayer(e)):t?this.getJimuChildId(a.dataSourceUtils.getFixedLayerIdByLayerDefinition(t)):[]},t}(c),h=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),t.prototype.load=function(){var e=this;return this.setStatus(i.b.Loading),this.doLoad().then((function(t){return e.records=t,e.setStatus(i.b.Loaded),e.records}))},t}(u),y=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),g=function(){return(g=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},S=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(r[o[a]]=e[o[a]])}return r},v=function(e){function t(t){var r=e.call(this,t)||this;return r.count=null,r.pages={},r.pagePromises={},r.url=r.getDataSourceJson().url,r.setStatus(i.b.Unloaded),r.setCountStatus(i.b.Unloaded),r}return y(t,e),t.prototype.getCurrentQueryParams=function(e){var t=this.getRuntimeQueryParams(e&&e.dataSourceId===this.id?null==e?void 0:e.widgetId:null);return this.getCurrentQueryParamsByQuery(t,e)},t.prototype.getRuntimeQueryParams=function(e){var t,r=e?null===(t=this.getInfo().widgetQueries)||void 0===t?void 0:t.without(e):this.getInfo().widgetQueries;return this.getMergedWidgetQueries(r)},t.prototype.getCurrentQueryParamsByQuery=function(e,t){var r;return this.isLocal?r=this.mergeQueryParams(this.belongToDataSource.getCurrentQueryParams(t),e):this.isDataView?(r=this.mergeQueryParams(this.getConfigQueryParams(),e),r=this.mergeQueryParams(this.getMainDataSource().getCurrentQueryParams(t),r)):(r=this.mergeQueryParams(this.getConfigQueryParams(),e),r=this.mergeQueryParams(this.getRemoteQueryParams(),r)),r},t.prototype.getMergedWidgetQueries=function(e){var t,r=this,o=e&&Object.keys(e)||[];return(o=o.sort((function(e,t){return e.localeCompare(t)}))).forEach((function(o){t=r.mergeQueryParams(t,e[o])})),t},t.prototype.getCurrentQueryId=function(){return this.lastQueryId},t.prototype.getRealQueryParams=function(e,t,r){var o,n=this;if("query"===t)r&&r.scope?r.scope===i.d.InAllData?o=e:r.scope===i.d.InRemoteConfigView?o=this.mergeQueryParams(this.getRemoteQueryParams(),e):r.scope===i.d.InConfigView?(o=this.mergeQueryWithConfigQuery(e),o=this.mergeQueryParams(this.getRemoteQueryParams(),o)):o=r.scope===i.d.InRuntimeView?this.mergeQueryParams(this.getCurrentQueryParams(r.excludeQuery),e):e:o=this.mergeQueryParams(this.getCurrentQueryParams(null==r?void 0:r.excludeQuery),e);else{if(!r||!r.widgetId)return console.error("Please pass widget id for load."),null;var u=function(){var t,o=n.getInfo().widgetQueries||Object(a.Immutable)({});return(null==r?void 0:r.excludeQuery)&&(o=o.without(r.excludeQuery.widgetId)),o=o.set(r.widgetId,e),t=n.getMergedWidgetQueries(o),t=n.getCurrentQueryParamsByQuery(t,null==r?void 0:r.excludeQuery)};r&&r.scope?r.scope===i.d.InAllData?o=e:r.scope===i.d.InRemoteConfigView?o=this.mergeQueryParams(this.getRemoteQueryParams(),e):r.scope===i.d.InConfigView?(o=this.mergeQueryWithConfigQuery(e),o=this.mergeQueryParams(this.getRemoteQueryParams(),o)):o=r.scope===i.d.InRuntimeView?u():e:o=u()}return o},t.prototype.getDataViewConfig=function(){return this.isLocal?this.belongToDataSource.getDataViewConfig():this.isDataView?this.getDataSourceJson().dataViews&&this.getDataSourceJson().dataViews[this.dataViewId]:this.getDataSourceJson().query},t.prototype.mergeQueryWithConfigQuery=function(e){var t;return this.isLocal?this.belongToDataSource.isDataView?(t=this.mergeQueryParams(this.belongToDataSource.getConfigQueryParams(),e),t=this.mergeQueryParams(this.getMainDataSource().getConfigQueryParams(),t)):t=this.mergeQueryParams(this.getConfigQueryParams(),e):this.isDataView?(t=this.mergeQueryParams(this.getConfigQueryParams(),e),t=this.mergeQueryParams(this.getMainDataSource().getConfigQueryParams(),t)):t=this.mergeQueryParams(this.getConfigQueryParams(),e),t},t.prototype.updateQueryParams=function(e,t){e=this.getQueryWithoutPage(e),a.utils.isDeepEqual(e,this.getInfo().widgetQueries&&this.getInfo().widgetQueries[t])||Object(a.getAppStore)().dispatch(a.appActions.updateWidgetQuery(this.id,t,e))},t.prototype.getQueryPageSize=function(){var e;return(null===(e=this.getDataViewConfig())||void 0===e?void 0:e.pageSize)||n.DEFAULT_QUERY_PAGE_SIZE},t.prototype.getMaxRecordCount=function(){var e;return(null===(e=this.getDataViewConfig())||void 0===e?void 0:e.maximum)||null},t.prototype.getQueryWithoutPage=function(e){if(!e)return null;e.pageSize,e.page;return S(e,["pageSize","page"])},t.prototype.checkClearLocalCache=function(e,t,r){var o=this.getQueryWithoutPage(e),i=this.getRealQueryParams(o,"load",r),n=r.refresh||this.getInfo().needRefresh;return!(a.utils.isDeepEqual(i,t)&&!n)},t.prototype.getRecordsByPage=function(e,t){var r=g({},this.pages),o=Object.keys(r).map((function(e){return parseInt(e)})).sort((function(e,t){return t-e}))[0],a=this.getQueryPageSize(),i=t*(e-1),n=i+t-1,u=this.getMaxRecordCount();null!==u&&(i=Math.min(i,u-1),n=Math.min(n,u-1));for(var s=[],c=1;c<=o;c++){var d=(c-1)*a;if(!(d+a-1<i||d>n)&&r[c])for(var l=0;l<r[c].length;l++)d+l<i||d+l>n||s.push(r[c][l])}return s},t.prototype.getPagesData=function(){return this.pages},t.prototype.setPagesData=function(e){this.pages=e},t.prototype.clearDataNotAddVersion=function(){this.getSelectedRecords().length>0&&this.copySelectionToDataView([]),this.pages={},this.pagePromises={},this.count=null,this.countPromise=null},t.prototype.clearData=function(){this.clearDataNotAddVersion(),this.addVersion()},t.prototype.getRecords=function(){for(var e=this,t=[],r=[],o=1;o<=Object.keys(this.pages).length&&this.pages[o];o++)r.push(o);return r.forEach((function(r){t=t.concat(e.pages[r])})),null!==this.getMaxRecordCount()&&this.getMaxRecordCount()<t.length?t.slice(0,this.getMaxRecordCount()):t},t.prototype.getRealQueryPages=function(e,t){var r=t*(e-1),o=r+t-1;null!==this.getMaxRecordCount()&&(o=Math.min(o,this.getMaxRecordCount()-1));for(var a=Math.floor(r/this.getQueryPageSize())+1,i=Math.floor(o/this.getQueryPageSize())+1,n=[],u=a;u<=i;u++)n.push(u);return n},t.prototype.load=function(e,t){var r=this;void 0===t&&(t={}),(e=g({},e)).page||(e.page=1),e.pageSize||(e.pageSize=this.getQueryPageSize());var o=this.getRealQueryPages(e.page,e.pageSize);this.checkClearLocalCache(e,this.lastQueryParams,t)&&(Object.keys(this.pages).forEach((function(e){o.indexOf(parseInt(e))<0&&delete r.pages[e]})),this.pagePromises={},this.count=null,this.countPromise=null),this.updateQueryParams(e,t.widgetId);var u=this.getQueryWithoutPage(e),s=this.getRealQueryParams(u,"load",t),c=o.filter((function(e){return r.pagePromises[e]})).map((function(e){return r.pagePromises[e]}));return c.length===o.length?Promise.all(c).then((function(){return r.getRecordsByPage(e.page,e.pageSize)})):(this.lastQueryParams=s,this.setStatus(i.b.Loading),Object(a.getAppStore)().dispatch(a.appActions.setDataNeedRefresh(this.id,!1)),Promise.all(o.map((function(e){return r.loadByPage(s,e)}))).then((function(t){if(!t.find((function(e){return e})))return[];if(!r.isDataView||r.dataViewId!==n.DATA_VIEW_ID_FOR_NO_SELECTION){var o=r.getRecords(),u=[];r.getSelectedRecordIds().length>0?u=r.getSelectedRecordIds().map((function(e){return o.filter((function(t){return t&&t.getId()===e}))[0]})):r.getSelectedRecordIndexes().length>0&&(u=r.getSelectedRecordIndexes().map((function(e){return o[e]}))),u.length>0&&r.copySelectionToDataView(u)}return r.lastRefreshTime=new Date,r.setStatus(i.b.Loaded),window.jimuConfig.isInBuilder&&Object(a.getAppStore)().getState().appRuntimeInfo.appMode===a.AppMode.Design||r.startAutoRefresh(),r.getRecordsByPage(e.page,e.pageSize)}),(function(e){return console.error(e),r.setStatus(i.b.LoadError),[]})))},t.prototype.loadByPage=function(e,t){var r=this;if(this.pagePromises[t])return this.pagePromises[t];var o=g(g({},e),{page:t,pageSize:this.getQueryPageSize()});return this.pagePromises[t]=this.doQuery(Object(a.Immutable)(o)).then((function(e){var t=r.getQueryWithoutPage(e.queryParams);return!!a.utils.isDeepEqual(t,r.lastQueryParams)&&(r.pages[e.queryParams.page]=e.records,!0)})),this.pagePromises[t]},t.prototype.loadCount=function(e,t){var r=this;if(void 0===t&&(t={}),!this.checkClearLocalCache(e,this.lastCountQueryParams,t)&&this.countPromise)return this.countPromise;var o=this.getRealQueryParams(this.getQueryWithoutPage(e),"load",t);return this.lastCountQueryParams=o,this.setCountStatus(i.b.Loading),this.countPromise=this.doQueryCount(Object(a.Immutable)(o)).then((function(e){return a.utils.isDeepEqual(e.queryParams,r.lastCountQueryParams)?(null===r.getMaxRecordCount()?r.count=e.count:r.count=Math.min(e.count,r.getMaxRecordCount()),r.setCountStatus(i.b.Loaded),r.count):null}),(function(e){return console.error(e),r.setCountStatus(i.b.LoadError),Promise.reject(e)})),this.countPromise},t.prototype.query=function(e,t){var r=this,o=this.getRealQueryParams(e,"query",t);return this.doQuery(Object(a.Immutable)(o)).then((function(e){var t=r.getMaxRecordCount();if(null===t)return e;var o=e.queryParams.page||1,a=e.queryParams.pageSize;return 1!==o&&a?(o-1)*a>t?e.records=[]:(o-1)*a+e.records.length>t&&(e.records=e.records.slice(0,(o-1)*a+e.records.length-t)):e.records.length>t&&(e.records=e.records.slice(0,t)),e}))},t.prototype.queryCount=function(e,t){var r=this,o=this.getRealQueryParams(e,"query",t);return this.doQueryCount(Object(a.Immutable)(o)).then((function(e){return null===r.getMaxRecordCount()||(e.count=Math.min(e.count,r.getMaxRecordCount())),e}))},t.prototype.loadById=function(e,t){var r=this;return e===this.lastQueryId&&!t&&this.byIdPromise||(this.lastQueryId=e,this.setStatus(i.b.Loading),this.byIdPromise=this.doQueryById(e).then((function(e){return r.setStatus(i.b.Loaded),e}),(function(e){return console.error(e),r.setStatus(i.b.LoadError),null}))),this.byIdPromise},t.prototype.queryById=function(e){return this.doQueryById(e)},t.prototype.getAutoRefreshInterval=function(){var e=this.getMainDataSource(),t=e.getDataViewConfig()&&e.getDataViewConfig().refreshInterval;return 0===t?0:(null==t&&(t=e.getSchema().refreshInterval),t)},t.prototype.getLastRefreshTime=function(){return this.lastRefreshTime},t.prototype.startAutoRefresh=function(){var e=this,t=this.getAutoRefreshInterval();t&&(this.autoRefreshHandle||(Object(a.getAppStore)().dispatch(a.appActions.setDataNeedRefresh(this.id,!1)),this.autoRefreshHandle=setTimeout((function(){Object(a.getAppStore)().dispatch(a.appActions.setDataNeedRefresh(e.id,!0)),e.stopAutoRefresh()}),1e3*t)))},t.prototype.stopAutoRefresh=function(){this.autoRefreshHandle&&(clearTimeout(this.autoRefreshHandle),this.autoRefreshHandle=null)},t.prototype.addRecord=function(e){var t=this;return this.setSaveStatus(i.b.Saving),this.doAdd(e).then((function(e){return t.records.push(e),t.setSaveStatus(i.b.Saved),e}))},t.prototype.updateRecord=function(e){var t=this;return this.setSaveStatus(i.b.Saving),this.doUpdateRecord(e).then((function(e){var r=t.records.findIndex((function(t){return t.getId()===e.getId()}));return t.records.splice(r,1,e),t.setSaveStatus(i.b.Saved),e}))},t.prototype.deleteRecord=function(e){var t=this;return this.setSaveStatus(i.b.Saving),this.doDeleteRecord(e).then((function(){t.records.splice(e,1),t.setSaveStatus(i.b.Saved)}))},t.prototype.getSaveStatus=function(){var e;return null===(e=Object(a.getAppStore)().getState().dataSourcesInfo[this.id])||void 0===e?void 0:e.saveStatus},t.prototype.setSaveStatus=function(e){Object(a.getAppStore)().dispatch(a.appActions.dataSourceSaveStatusChanged(this.id,e))},t.prototype.getMainDataSource=function(){return e.prototype.getMainDataSource.call(this)},t.prototype.getDataViews=function(){return e.prototype.getDataViews.call(this)},t.prototype.getDataView=function(t){return e.prototype.getDataView.call(this,t)},t}(u),D=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),m=function(){function e(){}return e.prototype.getFieldValue=function(e){return this.getData()[e]},e.prototype.getFormattedFieldValue=function(e,t){var r=this.dataSource.getSchema().fields[e];if(!r)return this.getFieldValue(e);if(r.format)switch(r.type){case a.JimuFieldType.Date:return this.formatDateField(this.getFieldValue(e),r.format.dateFormat,t);case a.JimuFieldType.Number:return this.formatNumberField(this.getFieldValue(e),r.format.places,r.format.digitSeparator,t);default:return this.getFieldValue(e)}else switch(r.type){case a.JimuFieldType.Date:return null!==this.getFieldValue(e)&&void 0!==this.getFieldValue(e)?t.formatDate(this.getFieldValue(e)):null;case a.JimuFieldType.Number:return null!==this.getFieldValue(e)&&void 0!==this.getFieldValue(e)?t.formatNumber(this.getFieldValue(e)):null;default:return this.getFieldValue(e)}},e.prototype.convertBeforeMappingDataToData=function(e){var t={},r=this.dataSource.getReversedConfigSchema();return Object.keys(e).forEach((function(o){var a=r&&r.fields&&r.fields[o];a?a.forEach((function(r){t[r.jimuName]=e[o]})):t[o]=e[o]})),t},e.prototype.convertDataToDataBeforeMapping=function(e){var t={},r=this.dataSource.getSchema();return Object.keys(e).forEach((function(o){var a=r&&r.fields&&r.fields[o]?r.fields[o].name:o;t[a]=e[o]})),t},e.prototype.getFormattedData=function(e){var t=this,r={};return Object.keys(this.getData()).forEach((function(o){r[o]=t.getFormattedFieldValue(o,e)})),r},e.prototype.formatDateField=function(e,t,r){if(!e)return null;"number"==typeof e&&(e=new Date(e));var o=a.dateUtils.ESRI_DATE_FORMAT_MAP[t];if(!o)return console.warn("Invalid data format "+t),null;var i=a.dateUtils.formatDate(e,o.datePattern,r);if("date and time"===o.selector){var n=a.dateUtils.formatTime(e,o.timePattern,r),u=r.locale||"en";i=i+(a.dateUtils.DATE_TIME_CONNECTOR[u]||a.dateUtils.DATE_TIME_CONNECTOR.common)+n}return i},e.prototype.formatNumberField=function(e,t,r,o){if(null===e||void 0===typeof e)return null;var a=new Number(e);return r?o.formatNumber(e,{maximumFractionDigits:t,minimumFractionDigits:t}):a.toFixed(t)},e}(),I=function(e){function t(t,r,o){void 0===o&&(o=!0);var a=e.call(this)||this;return a.dataSource=r,a.data=o?a.convertBeforeMappingDataToData(t):t,a}return D(t,e),t.prototype.getData=function(){return this.data},t.prototype.getDataBeforeMapping=function(){return this.convertDataToDataBeforeMapping(this.data)},t.prototype.toJson=function(){return this.data},t.prototype.getId=function(){return this.data.id},t.prototype.setId=function(){},t.prototype.getGeometry=function(){return null},t}(m),b=function(e){Object.assign(this,e)},A=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),O=function(e){function t(t,r,o){var a;void 0===o&&(o=!0);var n=e.call(this)||this,u=(null==r?void 0:r.type)===i.c.FeatureLayer&&(null===(a=r)||void 0===a?void 0:a.getAssociatedDataSource());return n.dataSource=u||r,o?(t.attributes=n.convertBeforeMappingDataToData(t.attributes),n.feature=t):n.feature=t,n.fillGeometry(),n}return A(t,e),t.prototype.fillGeometry=function(){var e;if(this.feature.geometry&&this.dataSource.type!==i.c.FeatureSet){var t=this.dataSource;this.feature.geometry.spatialReference||(this.feature.geometry.spatialReference=null===(e=t.getLayerDefinition().extent)||void 0===e?void 0:e.spatialReference)}},t.prototype.queryAttachments=function(e){var t,r=this,o=this.dataSource;if(!(t=o&&o.url))return Promise.resolve([]);var i={attachmentTypes:e,url:t,featureId:this.getId()};return this._queryAllAttachmentsPromise||(this._queryAllAttachmentsPromise=a.dataSourceUtils.queryAllAttachments(i)),this._queryAllAttachmentsPromise.then((function(e){return r.attachmentInfos=e,a.dataSourceUtils.filterAttachments(e,i)}))},t.prototype.getSymbolPreviewHTML=function(){var e=this;return this._isGraphicFeature()?(this._getSymbolPreviewHTMLPromise||(this._getSymbolPreviewHTMLPromise=Object(a.loadArcGISJSAPIModules)(["esri/symbols/support/symbolUtils"]).then((function(t){var r=null;return(r=t[0]).getDisplayedSymbol(e.feature).then((function(e){var t=document.createElement("div");return t.className="w-100 h-100 d-flex justify-content-center align-items-center",r.renderPreviewHTML(e,{node:t})}))}))),this._getSymbolPreviewHTMLPromise):Promise.resolve(null)},t.prototype.getData=function(){return this.feature.attributes},t.prototype.getFormattedFieldValue=function(t,r){var o=this.dataSource;if(!o.getLayerDefinition)return null;var i=o.getLayerDefinition(),n=a.dataSourceUtils.getDisplayValueForCodedValueOrSubtype(i,t,this.getData());return n.isCodedValueOrSubtype?n.displayValue:e.prototype.getFormattedFieldValue.call(this,t,r)},t.prototype.getDataBeforeMapping=function(){return this.convertDataToDataBeforeMapping(this.getData())},t.prototype.getOriginData=function(){var e=Object.assign({},this.feature);return e.attributes=this.convertDataToDataBeforeMapping(this.getData()),e},t.prototype.toJson=function(){return this.feature},t.prototype.getId=function(){return this.feature.attributes[this.dataSource.getIdField()]+""},t.prototype.setId=function(e){},t.prototype.getGeometry=function(){return this.feature.geometry},t.prototype._isGraphicFeature=function(){var e;return!!(null===(e=null==this?void 0:this.feature)||void 0===e?void 0:e.layer)},t}(m),P=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),_=function(e){function t(t){var r=e.call(this,t)||this;return r.type=i.c.CSV,t.dataSourceJson.data?(r.records=t.dataSourceJson.data.asMutable().map((function(e){return new I(e,r)})),r.setStatus(i.b.Loaded)):r.url=t.dataSourceJson.url,r}return P(t,e),t.prototype.doLoad=function(){var e=this;return fetch(this.url).then((function(e){return e.json()})).then((function(t){return t.map((function(t){return new I(t,e)}))}))},t}(f),L=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),R=function(){return(R=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},C=function(e){function t(t){var r=e.call(this,t)||this;r.type=i.c.FeatureLayer;var o=r.getDataSourceJson();return r.portalUrl=o.portalUrl,r.itemId=o.itemId,r.layerId=o.layerId,t.layer&&(r.layer=t.layer),t.belongToDataSource&&t.belongToDataSource.layer&&(r.layer=t.belongToDataSource.layer),t.associatedDataSource&&r.setAssociatedDataSource(t.associatedDataSource),r}return L(t,e),t.prototype.setAssociatedDataSource=function(e){this.associatedDataSource=e},t.prototype.getAssociatedDataSource=function(){return this.associatedDataSource},t.prototype.getIdField=function(){var e=this.getLayerDefinition(),t=e.objectIdField;if(!t){var r=e.fields.find((function(e){return"esriFieldTypeOID"===e.type}));r&&(t=r.name)}return t||(t="OBJECTID"),t},t.prototype.getGeometryType=function(){return this.getLayerDefinition().geometryType},t.prototype.setJsonData=function(e){var t=this;this.records=e.map((function(e){return new O(e,t,!1)}))},t.prototype.doQuery=function(e){var t=this;return this.layer?this._doQueryByLayer(e):this.url?this._doQueryByUrl(e):this.createFeatureLayer().then((function(){return t._doQueryByLayer(e)}))},t.prototype.doQueryCount=function(e){var t=this;return this.layer?this._doQueryCountByLayer(e):this.url?this._doQueryCountByUrl(e):this.createFeatureLayer().then((function(){return t._doQueryCountByLayer(e)}))},t.prototype._doQueryCountByLayer=function(e){var t=this;return this.changeJimuQueryToJSAPILayerQuery(e).then((function(r){return t.layer.queryFeatureCount(r).then((function(t){return{queryParams:e,count:t}}))}))},t.prototype._doQueryCountByUrl=function(e){var t=this.changeJimuQueryToRestJSQuery(e);return delete t.resultRecordCount,delete t.resultOffset,t.returnCountOnly||(t.returnCountOnly=!0),this._q(t).then((function(t){return{queryParams:e,count:t.count}}))},t.prototype.doQueryById=function(e){return this.doQuery(Object(a.Immutable)({objectIds:[parseInt(e)],returnGeometry:!0})).then((function(e){return e.records[0]}))},t.prototype.queryById=function(t){return e.prototype.queryById.call(this,t)},t.prototype.getConfigQueryParams=function(){var e=this.getDataViewConfig();return e?{where:a.dataSourceUtils.getArcGISSQL(e.where,this).sql,orderByFields:this._getOrderByArray(e.orderBy)}:null},t.prototype.mergeQueryParams=function(e,t){var r;return r=[e&&e.where,t&&t.where].filter((function(e){return e})).join(" and "),R(R(R({},e),t),{where:r})},t.prototype.getCurrentQueryParams=function(t){var r=e.prototype.getCurrentQueryParams.call(this,t);return this.applyGDBVersionAndFix(r)},t.prototype.getRealQueryParams=function(t,r,o){var a=e.prototype.getRealQueryParams.call(this,t,r,o);return this.applyGDBVersionAndFix(a)},t.prototype.getRemoteQueryParams=function(){return this.getSchema().filter?{where:this.getSchema().filter}:null},t.prototype.applyGDBVersionAndFix=function(e){return this.getGDBVersion()&&(e.gdbVersion=this.getGDBVersion()),e=this.fixQueryParam(Object(a.Immutable)(e)).asMutable({deep:!0})},t.prototype.fixQueryParam=function(e){var t=e;return e.outStatistics&&Object.keys(e).forEach((function(e){["groupByFieldsForStatistics","time","where","outStatistics","geometry","gdbVersion"].indexOf(e)<0&&(t=t.without(e))})),t},t.prototype.addRecord=function(e){var t=this,r=e.getData(),o={attributes:r},i={url:this.url,features:[o]};return a.ServiceManager.getInstance().fetchArcGISServerInfo(this.url).then((function(e){return a.requestUtils.requestWrapper(t.url,(function(e){return i.authentication=e,a.esri.restFeatureLayer.addFeatures(i).then((function(e){var o=e.addResults[0].objectId;return r.OBJECTID=o,new O({attributes:r},t)}))}),1,null==e?void 0:e.owningSystemUrl)}))},t.prototype.fetchSchema=function(){return this.getDataSourceJson().isStatistic?Promise.resolve(Object(a.Immutable)({})):this.layer?this.fetchSchemaWithLayer():this.fetchSchemaWithoutLayer()},t.prototype.createFeatureLayer=function(){var e=this;return this.createFeatureLayerPromise||(this.layer?this.createFeatureLayerPromise=Promise.resolve(this.layer):this.createFeatureLayerPromise=Object(a.loadArcGISJSAPIModules)(["esri/layers/Layer","esri/portal/PortalItem"]).then((function(t){var r=t[0],o=t[1];return r.fromPortalItem({portalItem:new o({id:e.itemId,portal:{url:e.portalUrl}})})})).then((function(t){return(null==t?void 0:t.type)===i.g.FeatureLayer?(e.layer=t,Promise.resolve(e.layer)):(null==t?void 0:t.type)===i.g.GroupLayer?t.loadAll().then((function(t){var r=t.layers.toArray().find((function(t){var r;return""+t.layerId===e.layerId||""+(null===(r=e.getLayerDefinition())||void 0===r?void 0:r.id)===e.layerId}));return(null==r?void 0:r.type)===i.g.FeatureLayer?(e.layer=r,Promise.resolve(e.layer)):Promise.reject("Create feaure layer data source error: failed to create feature layer with specific layer id.")})):void 0}))),this.createFeatureLayerPromise},t.prototype.fetchSchemaWithoutLayer=function(){var e=this;return(this.url?a.ServiceManager.getInstance().fetchServiceInfo(this.url):Promise.resolve(null)).then((function(t){return e.itemId?a.requestUtils.requestWrapper(e.getDataSourceJson().portalUrl,(function(r){return Promise.all([a.esri.restPortal.getItemData(e.itemId,{portal:a.portalUrlUtils.getPortalRestUrl(e.portalUrl),authentication:r}),a.esri.restPortal.getItem(e.itemId,{portal:a.portalUrlUtils.getPortalRestUrl(e.portalUrl),authentication:r})]).then((function(r){var o,a=r[0],i=r[1],n=a&&a.layers&&a.layers[e.layerId];return(null==n?void 0:n.layerDefinition)&&1===(null===(o=null==a?void 0:a.layers)||void 0===o?void 0:o.length)&&(n.layerDefinition.name=(null==i?void 0:i.title)||n.layerDefinition.name),{serviceDefinition:(null==t?void 0:t.definition)?e._getUpdatedLayerDefinition(n,t.definition):null==n?void 0:n.layerDefinition,fieldInfos:n&&n.popupInfo&&n.popupInfo.fieldInfos,filter:n&&n.layerDefinition&&n.layerDefinition.definitionExpression,refreshInterval:60*(null==n?void 0:n.refreshInterval)}}))})):{serviceDefinition:null==t?void 0:t.definition,fieldInfos:null,filter:null,refreshInterval:null}})).then((function(t){var r,o=t.serviceDefinition,i=t.fieldInfos,n=t.filter,u=t.refreshInterval,s={fields:{},idField:null==o?void 0:o.idField,filter:n,refreshInterval:u,label:(null===(r=e.layer)||void 0===r?void 0:r.title)||(null==o?void 0:o.name)};return e.layerDefinition=o,o.fields.forEach((function(e){var t=i&&i.find((function(t){return t.fieldName===e.name}));s.fields[e.name]=a.dataSourceUtils.convertFieldToJimuField(e,t)})),Object(a.Immutable)(s)}))},t.prototype.fetchSchemaWithLayer=function(){var e=this;return this.layer.load().then((function(){e.updateLayerDefinitionByLayer();var t={fields:{},idField:e.layer.objectIdField,filter:e.layer.definitionExpression,refreshInterval:60*e.layer.refreshInterval,label:e.layer.title};return e.layer.fields.forEach((function(r){var o=e.layer.popupTemplate&&e.layer.popupTemplate.fieldInfos&&e.layer.popupTemplate.fieldInfos.find((function(e){return e.fieldName===r.name}));o&&(o=o.toJSON()),t.fields[r.name]=a.dataSourceUtils.convertFieldToJimuField(r.toJSON(),o)})),Object(a.Immutable)(t)}))},t.prototype.updateLayerDefinitionByLayer=function(){var e=this.layer.sourceJSON,t=this.layer.renderer;if(t&&t.toJSON()){var r=t.toJSON();if("uniqueValue"===r.type){var o=this.layer.sourceJSON.types;r.field1!==this.layer.sourceJSON.typeIdField&&(o=[],r.uniqueValueInfos.map((function(e){o.push({id:e.value,name:e.label,domain:{}})}))),e=Object.assign({name:this.layer.title},e,{drawingInfo:{renderer:r},typeIdField:r.field1,types:o})}}this.layerDefinition=e},t.prototype.getLayerDefinition=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getLayerDefinition():this.layerDefinition},t.prototype.getFieldCodedValueList=function(e,t){var r="",o=this.getSchema().fields;return Object.keys(o).some((function(t){return t===e&&(r=o[t].name,!0)})),a.dataSourceUtils.getCodedValueListForCodedValueOrSubtypeField(this.getLayerDefinition(),r,t)},t.prototype.getGDBVersion=function(){return this.getInfo().gdbVersion},t.prototype.changeGDBVersion=function(e){Object(a.getAppStore)().dispatch(a.appActions.changeDataSourceGDBVersion(this.id,e)),this.layer&&(this.layer.gdbVersion=e)},t.prototype.getRootLayerDataSource=function(){for(var e,t=this.parentDataSource,r=null===(e=this.parentDataSource)||void 0===e?void 0:e.parentDataSource;a.dataSourceUtils.isLayerDataSource(t)&&a.dataSourceUtils.isLayerDataSource(r);)t=r,r=r.parentDataSource;return t},t.prototype.getOriginalDataId=function(){var e,t;return(null===(e=this.layer)||void 0===e?void 0:e.id)||(null===(t=this.layerDefinition)||void 0===t?void 0:t.id)},t.prototype._getUpdatedLayerDefinition=function(e,t){var r=t;if(e&&e.layerDefinition){var o=void 0,a=e.layerDefinition.drawingInfo;if(a){if(a.renderer&&"uniqueValue"===a.renderer.type){var i=t.types;a.renderer.field1!==t.typeIdField&&(i=[],a.renderer.uniqueValueInfos.map((function(e){i.push({id:e.value,name:e.label,domain:{}})}))),o={defaultVisibility:e.layerDefinition.defaultVisibility,drawingInfo:e.layerDefinition.drawingInfo,typeIdField:a.renderer.field1,types:i}}}else e.layerDefinition.defaultVisibility!==t.defaultVisibility&&(o={defaultVisibility:e.layerDefinition.defaultVisibility});r=Object.assign({},r,o)}return r},t.prototype._getOrderByArray=function(e){var t;return null!==(t=null==e?void 0:e.map((function(e){return e.jimuFieldName+" "+e.order})).asMutable())&&void 0!==t?t:[]},t.prototype.changeJimuQueryToRestJSQuery=function(e){if(!e)return null;var t=this.fixQueryParam(e).asMutable({deep:!0});return t.page&&t.pageSize&&(t.resultOffset=(t.page-1)*t.pageSize,t.resultRecordCount=t.pageSize,null!==this.getMaxRecordCount()&&(1===t.page?t.resultRecordCount=Math.min(this.getMaxRecordCount(),t.pageSize):t.page*t.pageSize>this.getMaxRecordCount()&&(t.resultRecordCount=this.getMaxRecordCount()-(t.page-1)*t.pageSize)),delete t.page,delete t.pageSize),Array.isArray(t.orderByFields)&&(t.orderByFields=t.orderByFields.join(",")),Array.isArray(t.groupByFieldsForStatistics)&&(t.groupByFieldsForStatistics=t.groupByFieldsForStatistics.join(",")),t},t.prototype.changeJimuQueryToJSAPILayerQuery=function(e){var t=this,r=this.fixQueryParam(e),o=r.asMutable({deep:!0});return Object(a.loadArcGISJSAPIModules)(["esri/geometry/support/jsonUtils"]).then((function(e){var a=e[0];return r.page&&r.pageSize&&(o.start=(r.page-1)*r.pageSize,o.num=r.pageSize,null!==t.getMaxRecordCount()&&(1===r.page?o.num=Math.min(t.getMaxRecordCount(),r.pageSize):r.page*r.pageSize>t.getMaxRecordCount()&&(o.num=t.getMaxRecordCount()-(r.page-1)*r.pageSize)),delete o.page,delete o.pageSize),o.geometry&&(o.geometry=a.fromJSON(o.geometry)),delete o.key,t.getGDBVersion()&&(o.gdbVersion=t.getGDBVersion()),o.outFields=o.outFields&&o.outFields.length>0?o.outFields:["*"],o}))},t.prototype._doQueryByUrl=function(e){var t=this,r=this.changeJimuQueryToRestJSQuery(e);if(r.returnCountOnly)return console.error("To query count, please use queryCount."),Promise.reject("To query count, please use queryCount.");if(r.outFields&&"*"!==r.outFields&&"*"!==r.outFields[0]){var o=this.getLayerDefinition().typeIdField;o&&r.outFields.indexOf(o)<0&&r.outFields.push(o)}return this._q(r).then((function(r){var o=Object.keys(t.getSchema().fields).filter((function(e){return r.fields&&r.fields.find((function(r){return r.name===t.getSchema().fields[e].name}))}));return{queryParams:e,fields:o,records:r.features.map((function(e){return new O(e,t)}))}}))},t.prototype._doQueryByLayer=function(e){var t=this;return this.changeJimuQueryToJSAPILayerQuery(e).then((function(r){var o=r;if(o.outFields&&"*"!==o.outFields[0]){var a=t.getLayerDefinition().typeIdField;a&&o.outFields.indexOf(a)<0&&o.outFields.push(a)}return t.layer.queryFeatures(o).then((function(r){var o=r.features.map((function(e){return new O(e,t)})),a=Object.keys(t.getSchema().fields).filter((function(e){return r.fields&&r.fields.find((function(r){return r.name===t.getSchema().fields[e].name}))}));return{queryParams:e,records:o,fields:a}}))}))},t.prototype._q=function(e){var t=this,r=R({url:this.url},e);return a.ServiceManager.getInstance().fetchArcGISServerInfo(this.url).then((function(e){return a.requestUtils.requestWrapper(t.url,(function(e){return r.authentication=e,a.esri.restFeatureLayer.queryFeatures(r)}),1,null==e?void 0:e.owningSystemUrl)}))},t}(v),w=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.c.FeatureService,t}return w(t,e),t}(p),E=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),j=function(e){function t(t){var r=e.call(this,t)||this;return r.type=i.c.FeatureSet,r.records=t.records||[],r}return E(t,e),t.prototype.getIdField=function(){return this.getDataSourceJson().schema&&this.getDataSourceJson().schema.idField?this.getDataSourceJson().schema.idField:this.getDataSourceJson().originDataSources&&this.getDataSourceJson().originDataSources.length>0&&this.dataSourceManager.getDataSource(this.getDataSourceJson().originDataSources[0].dataSourceId)?this.dataSourceManager.getDataSource(this.getDataSourceJson().originDataSources[0].dataSourceId).getIdField():e.prototype.getIdField.call(this)},t.prototype.setJsonData=function(e){var t=this;this.records=e.map((function(e){return new O(e,t,!1)}))},t.prototype.addRecord=function(e){},t}(u),V=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.c.GroupLayer,t}return V(t,e),t}(p),J=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.c.MapService,t}return J(t,e),t}(p),M=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.c.SimpleLocal,t}return M(t,e),t.prototype.updateAllRecoreds=function(e){this.records=e,this.addVersion()},t.prototype.addRecord=function(e){return e.getId()||e.setId(Object(a.uuidv1)()),this.records.push(e),this.addVersion(),e},t.prototype.updateRecord=function(e){var t=this.records.findIndex((function(t){return t.getId()===e.getId()}));this.records.splice(t,1,e),this.addVersion()},t.prototype.deleteRecord=function(e){this.records.splice(e,1),this.addVersion()},t}(u),x=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),B=function(){return(B=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},N=function(e){function t(t){var r=e.call(this,t)||this;return r.type=i.c.SceneService,r}return x(t,e),t.prototype.ready=function(){var t=this;return this.fetchServiceDefinition().then((function(){return e.prototype.ready.call(t)}))},t.prototype.getServiceDefinition=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getServiceDefinition():this.serviceDefinition},t.prototype._createChildDataSources=function(){var e,t=this;return this.url&&(e=a.dataSourceUtils.fetchSupportedLayerDefinitions(this.url,this.getServiceDefinition()).then((function(e){return Object.keys(e).map((function(t){return{def:e[t],url:t}}))}))),e&&(this._childDataSourcesPromise=e.then((function(e){return t._getDsJsonsFromSupportedLayerDefinitions(e&&e.map((function(e){return B(B({},e),{url:t.url})})),t.getDataSourceJson())})).then((function(e){var r=[];return e.forEach((function(e){var o={id:e.id,dataSourceJson:e.without("jimuChildId"),parentDataSource:t,jimuChildId:e.jimuChildId};r.push(t.dataSourceManager.createDataSource(o))})),Promise.all(r)}))),this._childDataSourcesPromise},t.prototype.fetchSchema=function(){var e,t=this.getChildDataSources(),r=Object(a.Immutable)({childSchemas:{},label:null===(e=this.getServiceDefinition())||void 0===e?void 0:e.name});return t.map((function(e,t){var o,i=e.getFetchedSchema(),n=null===(o=e)||void 0===o?void 0:o.getLayerDefinition();r=r.setIn(["childSchemas",a.dataSourceUtils.fixLayerId((null==n?void 0:n.name)||""+(null==n?void 0:n.id))],i)})),Promise.resolve(r)},t.prototype.fetchServiceDefinition=function(){var e=this,t=this.url;return t?this.getServiceDefinition()?Promise.resolve(this.getServiceDefinition()):a.ServiceManager.getInstance().fetchServiceInfo(t).then((function(e){return e.definition})).then((function(t){return t?(e.serviceDefinition=t,t):null})):Promise.resolve(null)},t.prototype._getDsJsonsFromSupportedLayerDefinitions=function(e,t){var r=this;if(!e)return[];var o=[];return e.forEach((function(e){var i=a.dataSourceUtils.getFullServiceUrl(e.url,!0,e.def);r._getDsJsonsFromSingleLayerDefinition(i,e.def,t).forEach((function(e){o=o.concat(e)}))})),o},t.prototype._getDsJsonsFromSingleLayerDefinition=function(e,t,r){var o=this;if(!t)return[];var i,n=[];return this.getJimuChildId(a.dataSourceUtils.fixLayerId(t.name||""+t.id)).forEach((function(u){var s=o.getDataSourceJson().schema?o.getDataSourceJson().schema.childSchemas[u]:null,c=o.getChildDataSourceId(u);a.dataSourceUtils.isSupportedSingleLayerService(e)&&(i=a.dataSourceUtils.getSingleDsJsonFromLayerDefinition(c,e,t,(null==r?void 0:r.childDataSourceJsons)&&r.childDataSourceJsons[u]?r.childDataSourceJsons[u]:null)),i&&(o.getDataSourceJson().portalUrl&&(i=i.set("portalUrl",o.getDataSourceJson().portalUrl)),o.getDataSourceJson().itemId&&(i=i.set("itemId",o.getDataSourceJson().itemId)),s&&(i=i.set("schema",s)),n=n.concat(i.set("jimuChildId",u)))})),n},t}(c),G=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),q=function(e){function t(t){var r,o,n=e.call(this,t)||this;n.type=i.c.SceneLayer;var u=n.getDataSourceJson();if(n.portalUrl=u.portalUrl,n.itemId=u.itemId,n.layerId=u.layerId,t.layer&&(n.layer=t.layer),t.belongToDataSource&&t.belongToDataSource.layer&&(n.layer=t.belongToDataSource.layer),n.isLocal)(s=null===(r=t.belongToDataSource)||void 0===r?void 0:r.getAssociatedDataSource())&&a.DataSourceManager.getInstance().createLocalDataSource(s,n.localId);else if(n.isDataView){var s;(s=null===(o=t.belongToDataSource)||void 0===o?void 0:o.getAssociatedDataSource())&&a.DataSourceManager.getInstance().createDataView(s,n.dataViewId)}return n.getAssociatedDataSource()&&(Object(a.observeStore)(n.onInfoChange.bind(n),["dataSourcesInfo",n.getAssociatedDataSource().id]),n.getAssociatedDataSource().setAssociatedDataSource(n)),n}return G(t,e),t.prototype.ready=function(){var t=this;return Promise.all([this.fetchLayerDefinition(),this.createAssociatedDataSource()]).then((function(){return e.prototype.ready.call(t)})).then((function(){t.getAssociatedDataSource()&&Object(a.observeStore)(t.onInfoChange.bind(t),["dataSourcesInfo",t.getAssociatedDataSource().id])}))},t.prototype.onInfoChange=function(){this.getAssociatedDataSource()&&!a.utils.isDeepEqual(this.getInfo().without("instanceStatus"),this.getAssociatedDataSource().getInfo().without("instanceStatus"))&&Object(a.getAppStore)().dispatch(a.appActions.updateDataSourceInfo(this.id,this.getAssociatedDataSource().getInfo().without("instanceStatus").set("instanceStatus",this.getInfo().instanceStatus)))},t.prototype.createAssociatedDataSource=function(){var e=this;return this.associatedDataSource?Promise.resolve(this.associatedDataSource):this.layer?this._createAssociatedDataSourceWithLayer().then((function(t){return t||e._createAssociatedDataSourceWithUrl()})):this._createAssociatedDataSourceWithUrl()},t.prototype._createAssociatedDataSourceWithLayer=function(){var e=this,t=this._getNewAssociatedDataSourceId();return this.layer.load().then((function(){if(!e.layer.associatedLayer)return null;var r=Object(a.Immutable)({id:t,type:i.c.FeatureLayer,url:a.dataSourceUtils.getUrlByLayer(e.layer.associatedLayer)}),o=e.getDataSourceJson().schema;o&&(r=r.set("schema",o));var n={id:t,dataSourceJson:r,layer:e.layer.associatedLayer,associatedDataSource:e};return e.dataSourceManager.createDataSource(n)})).then((function(t){return e.associatedDataSource=t,e.associatedDataSource}))},t.prototype._createAssociatedDataSourceWithUrl=function(){var e=this,t=this._getNewAssociatedDataSourceId();return a.dataSourceUtils.fetchAssociatedFeatureLayerDefinition(this.url,this.layerId,this.itemId,this.portalUrl).then((function(r){if(!r)return Promise.reject("Can not find associated feature layer");var o=a.dataSourceUtils.getSingleDsJsonFromLayerDefinition(t,r.url,r.def);return o=e._mergeAssociatedDataSourceJson(o)})).then((function(t){var r={id:t.id,dataSourceJson:t,associatedDataSource:e};return e.dataSourceManager.createDataSource(r)})).then((function(t){return e.associatedDataSource=t,e.associatedDataSource}))},t.prototype._getNewAssociatedDataSourceId=function(){return this.getDataSourceJson().id+"-associated_data_source"},t.prototype.fetchLayerDefinition=function(){var e=this,t=this.url;return t?this.getLayerDefinition()?Promise.resolve(this.getLayerDefinition()):a.ServiceManager.getInstance().fetchServiceInfo(t).then((function(e){return e.definition})).then((function(t){return t?(e.layerDefinition=t,t):null})):Promise.resolve(null)},t.prototype.getLayerDefinition=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getLayerDefinition():this.layerDefinition},t.prototype.fetchSchema=function(){var e,t;return null!==(t=null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.fetchSchema())&&void 0!==t?t:Promise.reject({})},t.prototype.getSchema=function(){var e,t,r,o=null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getSchema(),i=Object(a.Immutable)({label:(null===(t=this.layer)||void 0===t?void 0:t.title)||(null===(r=this.getLayerDefinition())||void 0===r?void 0:r.name)});return o?o.merge(i):i},t.prototype.setSchema=function(e){var t;null===(t=this.getAssociatedDataSource())||void 0===t||t.setSchema(e)},t.prototype.setDataSourceJson=function(t){e.prototype.setDataSourceJson.call(this,t);var r=this.getAssociatedDataSource();if(r){var o=this._mergeAssociatedDataSourceJson(r.getDataSourceJson());r.setDataSourceJson(o)}},t.prototype.getFetchedSchema=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getFetchedSchema()},t.prototype.setFetchedSchema=function(e){var t;null===(t=this.getAssociatedDataSource())||void 0===t||t.setFetchedSchema(e)},t.prototype.getReversedConfigSchema=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getReversedConfigSchema()},t.prototype.getSelectedFields=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getSelectedFields()},t.prototype.getIdField=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getIdField()},t.prototype.setJsonData=function(e){var t;null===(t=this.getAssociatedDataSource())||void 0===t||t.setJsonData(e)},t.prototype.queryById=function(e){var t,r;return null!==(r=null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.queryById(e))&&void 0!==r?r:Promise.reject(Error("No Associated DataSource."))},t.prototype.addRecord=function(e){var t;return null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.addRecord(e)},t.prototype.updateRecord=function(e){var t;return null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.updateRecord(e)},t.prototype.deleteRecord=function(e){var t;return null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.deleteRecord(e)},t.prototype.doQuery=function(e){var t,r;return null!==(r=null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.doQuery(e))&&void 0!==r?r:Promise.reject(Error("No Associated DataSource."))},t.prototype.doQueryById=function(e){var t,r;return null!==(r=null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.doQueryById(e))&&void 0!==r?r:Promise.reject(Error("No Associated DataSource."))},t.prototype.doQueryCount=function(e){var t,r;return null!==(r=null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.doQueryCount(e))&&void 0!==r?r:Promise.reject(Error("No Associated DataSource."))},t.prototype.getConfigQueryParams=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getConfigQueryParams()},t.prototype.getRemoteQueryParams=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getRemoteQueryParams()},t.prototype.getCurrentQueryParams=function(e){var t;return e&&this.fixExcludeQuery(e),null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.getCurrentQueryParams(e)},t.prototype.getRuntimeQueryParamsgetRuntimeQueryParams=function(e){var t;return null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.getRuntimeQueryParams(e)},t.prototype.getCurrentQueryId=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getCurrentQueryId()},t.prototype.mergeQueryParams=function(e,t){var r;return null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.mergeQueryParams(e,t)},t.prototype.getFieldCodedValueList=function(e,t){var r;return null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.getFieldCodedValueList(e,t)},t.prototype.getRealQueryParams=function(e,t,r){var o;return r&&this.fixQueryOptions(r),null===(o=this.getAssociatedDataSource())||void 0===o?void 0:o.getRealQueryParams(e,t,r)},t.prototype.updateQueryParams=function(e,t){var r;return null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.updateQueryParams(e,t)},t.prototype.getGDBVersion=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getGDBVersion()},t.prototype.getQueryPageSize=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getQueryPageSize()},t.prototype.getMaxRecordCount=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getMaxRecordCount()},t.prototype.getRecordsByPage=function(e,t){var r;return null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.getRecordsByPage(e,t)},t.prototype.getPagesData=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getPagesData()},t.prototype.setPagesData=function(e){var t;null===(t=this.getAssociatedDataSource())||void 0===t||t.setPagesData(e)},t.prototype.getRealQueryPages=function(e,t){var r;return null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.getRealQueryPages(e,t)},t.prototype.load=function(e,t){var r,o;return void 0===t&&(t={}),t&&this.fixQueryOptions(t),null!==(o=null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.load(e,t))&&void 0!==o?o:Promise.reject(Error("No Associated DataSource."))},t.prototype.loadCount=function(e,t){var r,o;return void 0===t&&(t={}),t&&this.fixQueryOptions(t),null!==(o=null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.loadCount(e,t))&&void 0!==o?o:Promise.reject(Error("No Associated DataSource."))},t.prototype.query=function(e,t){var r,o;return t&&this.fixQueryOptions(t),null!==(o=null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.query(e,t))&&void 0!==o?o:Promise.reject(Error("No Associated DataSource."))},t.prototype.queryCount=function(e,t){var r,o;return t&&this.fixQueryOptions(t),null!==(o=null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.queryCount(e,t))&&void 0!==o?o:Promise.reject(Error("No Associated DataSource."))},t.prototype.loadById=function(e,t){var r,o;return null!==(o=null===(r=this.getAssociatedDataSource())||void 0===r?void 0:r.loadById(e,t))&&void 0!==o?o:Promise.reject(Error("No Associated DataSource."))},t.prototype.changeGDBVersion=function(e){var t;null===(t=this.getAssociatedDataSource())||void 0===t||t.changeGDBVersion(e)},t.prototype.getAssociatedDataSource=function(){if(!this.isDataView&&!this.isLocal)return this.associatedDataSource;var e=this._getRealAssociatedDataSourceId();return a.DataSourceManager.getInstance().getDataSource(e)},t.prototype.getAssociatedDataSourceById=function(e){return this.dataSourceManager.getDataSource(e).getAssociatedDataSource()},t.prototype.fixQueryOptions=function(e){e&&e.excludeQuery&&this.fixExcludeQuery(e.excludeQuery)},t.prototype.fixExcludeQuery=function(e){(null==e?void 0:e.dataSourceId)&&this.getAssociatedDataSourceById(e.dataSourceId)&&(e.dataSourceId=this.getAssociatedDataSourceById(e.dataSourceId).id)},t.prototype._getRealAssociatedDataSourceId=function(){var e,t=null===(e=this.belongToDataSource)||void 0===e?void 0:e.associatedDataSource;return this.isLocal?a.DataSourceManager.getInstance().getLocalDataSourceId(null==t?void 0:t.id,this.localId):this.isDataView?a.DataSourceManager.getInstance().getDataViewDataSourceId(null==t?void 0:t.id,this.dataViewId):this.associatedDataSource.id},t.prototype.clearData=function(){var e;null===(e=this.getAssociatedDataSource())||void 0===e||e.clearData()},t.prototype.setRecords=function(e){var t;null===(t=this.getAssociatedDataSource())||void 0===t||t.setRecords(e)},t.prototype.getRecords=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getRecords()},t.prototype.getSelectedRecords=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getSelectedRecords()},t.prototype.getSelectedRecordIndexes=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getSelectedRecordIndexes()},t.prototype.getSelectedRecordIds=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.getSelectedRecordIds()},t.prototype.nextRecord=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.nextRecord()},t.prototype.prevRecord=function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.prevRecord()},t.prototype.getRecord=function(e){var t;return null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.getRecord(e)},t.prototype.getRecordById=function(e){var t;return null===(t=this.getAssociatedDataSource())||void 0===t?void 0:t.getRecordById(e)},t.prototype.clearSelection=function(){var t;e.prototype.clearSelection.call(this),null===(t=this.getAssociatedDataSource())||void 0===t||t.clearSelection()},t.prototype.addVersion=function(){var e;null===(e=this.getAssociatedDataSource())||void 0===e||e.addVersion()},t.prototype.selectRecord=function(t){var r;e.prototype.selectRecord.call(this,t),null===(r=this.getAssociatedDataSource())||void 0===r||r.selectRecord(t)},t.prototype.selectRecords=function(t){var r;e.prototype.selectRecords.call(this,t),null===(r=this.getAssociatedDataSource())||void 0===r||r.selectRecords(t)},t.prototype.selectRecordById=function(t,r){var o;e.prototype.selectRecordById.call(this,t,r),null===(o=this.getAssociatedDataSource())||void 0===o||o.selectRecordById(t,r)},t.prototype.selectRecordsByIds=function(t,r){var o;e.prototype.selectRecordsByIds.call(this,t,r),null===(o=this.getAssociatedDataSource())||void 0===o||o.selectRecordsByIds(t,r)},t.prototype.destroy=function(){var e=this.getAssociatedDataSource();e&&this.dataSourceManager.destroyDataSource(e.id)},t.prototype.getRootLayerDataSource=function(){for(var e,t=this.parentDataSource,r=null===(e=this.parentDataSource)||void 0===e?void 0:e.parentDataSource;a.dataSourceUtils.isLayerDataSource(t)&&a.dataSourceUtils.isLayerDataSource(r);)t=r,r=r.parentDataSource;return t},t.prototype.getOriginalDataId=function(){var e,t;return(null===(e=this.layer)||void 0===e?void 0:e.id)||(null===(t=this.layerDefinition)||void 0===t?void 0:t.id)},t.prototype._mergeAssociatedDataSourceJson=function(e){return null==e?void 0:e.set("query",this.getDataSourceJson().query).set("dataViews",this.getDataSourceJson().dataViews)},Object.defineProperty(t.prototype,"count",{get:function(){var e;return null===(e=this.getAssociatedDataSource())||void 0===e?void 0:e.count},set:function(e){this.getAssociatedDataSource()&&(this.getAssociatedDataSource().count=e)},enumerable:!1,configurable:!0}),t}(v),W=function(){function e(){}return e.prototype.createDataSource=function(e){var t,r,o=null!==(t=e.dataSourceJson)&&void 0!==t?t:e.belongToDataSource.getMainDataSource().getDataSourceJson();return(r=e.dataViewId&&e.dataViewId===a.CONSTANTS.SELECTION_DATA_VIEW_ID?i.c.FeatureSet:e.dataViewId&&o.dataViews&&o.dataViews[e.dataViewId]&&o.dataViews[e.dataViewId].type||o.type)===i.c.CSV?new _(e):r===i.c.FeatureLayer?new C(e):r===i.c.FeatureService?new F(e):r===i.c.FeatureSet?new j(e):r===i.c.GroupLayer?new Q(e):r===i.c.MapService?new T(e):r===i.c.SceneService?new N(e):r===i.c.SceneLayer?new q(e):r===i.c.SimpleLocal?new U(e):void console.error("Unimplemented data source type.",o.type)},e}();t.default=W},4:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"f",(function(){return n})),r.d(t,"h",(function(){return u})),r.d(t,"e",(function(){return s})),r.d(t,"g",(function(){return c})),r.d(t,"d",(function(){return d})),r.d(t,"a",(function(){return p}));var o,a,i,n,u,s,c,d,l=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});!function(e){e.NotCreated="NOT_CREATED",e.Created="CREATED",e.CreateError="CREATE_ERROR",e.Unloaded="UNLOADED",e.Loading="LOADING",e.Loaded="LOADED",e.LoadError="LOAD_ERROR",e.Saving="SAVING",e.Saved="SAVED",e.SaveError="SAVE_ERROR",e.Closed="CLOSED",e.Connecting="CONNECTING",e.Connected="CONNECTED",e.Closing="CLOSING"}(a||(a={})),function(e){e.SimpleLocal="SIMPLE_LOCAL",e.CSV="CSV",e.FeatureLayer="FEATURE_LAYER",e.SceneLayer="SCENE_LAYER",e.FeatureSet="FEATURE_SET",e.GroupLayer="GROUP_LAYER",e.FeatureService="FEATURE_SERVICE",e.MapService="MAP_SERVICE",e.SceneService="SCENE_SERVICE"}(i||(i={})),function(e){e.FeatureLayer="Feature Layer",e.Table="Table",e.GroupLayer="Group Layer",e.SceneLayerPoint="Point",e.SceneLayer3DObject="3DObject"}(n||(n={})),function(e){e.FeatureService="FeatureServer",e.MapService="MapServer",e.SceneService="SceneServer"}(u||(u={})),function(e){e.WebMap="Web Map",e.WebScene="Web Scene",e.FeatureService="Feature Service",e.MapService="Map Service",e.SceneService="Scene Service",e.FeatureCollection="Feature Collection"}(s||(s={})),function(e){e.FeatureLayer="feature",e.MapImageLayer="map-image",e.TileLayer="tile",e.GroupLayer="group",e.SceneLayer="scene"}(c||(c={})),function(e){e.InAllData="IN_ALL_DATA",e.InRemoteConfigView="IN_REMOTE_CONFIG_VIEW",e.InConfigView="IN_CONFIG_VIEW",e.InRuntimeView="IN_RUNTIME_VIEW"}(d||(d={}));var p=function(e){function t(t,r){var o=e.call(this,r)||this;return o.dataSourceId=t,o}return l(t,e),t}(Error)},8:function(e,t,r){"use strict";var o,a,i,n,u,s,c,d;r.d(t,"d",(function(){return o})),r.d(t,"g",(function(){return a})),r.d(t,"f",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return u})),r.d(t,"m",(function(){return s})),r.d(t,"h",(function(){return c})),r.d(t,"n",(function(){return d})),r.d(t,"e",(function(){return h})),r.d(t,"j",(function(){return l})),r.d(t,"l",(function(){return p})),r.d(t,"a",(function(){return g})),r.d(t,"k",(function(){return f})),r.d(t,"i",(function(){return y})),function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(o||(o={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE"}(a||(a={})),function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(i||(i={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(n||(n={})),function(e){e.Design="DESIGN",e.Run="RUN"}(u||(u={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED"}(s||(s={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS"}(c||(c={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT"}(d||(d={}));var l,p,h=["shortDate","shortDateLE","longMonthDayYear","dayShortMonthYear","longDate","shortDateShortTime","shortDateLEShortTime","shortDateShortTime24","shortDateLEShortTime24","shortDateLongTime","shortDateLELongTime","shortDateLongTime24","shortDateLELongTime24","longMonthYear","shortMonthYear","year"];!function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(l||(l={})),function(e){e.Http="http:",e.Https="https:"}(p||(p={}));var f,y,g="_appWindow";!function(e){e.Image="IMAGE",e.Config="CONFIG"}(f||(f={})),function(e){e.Primary="PRIMARY",e.Secondary="SECONDARY",e.Image="IMAGE",e.Donut="DONUT"}(y||(y={}))}}))}}}));