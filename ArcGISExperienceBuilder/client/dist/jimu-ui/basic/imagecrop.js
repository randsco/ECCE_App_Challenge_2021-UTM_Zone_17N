System.register(["jimu-core","jimu-ui","jimu-for-builder"],(function(e){var t,n,r;return{setters:[function(e){t=e},function(e){n=e},function(e){r=e}],execute:function(){e(function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=959)}({0:function(e,n){e.exports=t},1:function(e,t){e.exports=n},125:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c="undefined"!=typeof window,p=c&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),u=c&&(p&&p.getOriginalSymbol(window,"File")||File),l=c&&(p&&p.getOriginalSymbol(window,"FileReader")||FileReader),h=c&&new Promise((function(e,t){var n,r,o,i;return d("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(a){try{return w(n=a).then((function(a){try{return A(r=a[1],n.type,n.name,n.lastModified).then((function(n){try{return o=n,E(r),m(o).then((function(n){try{return g(n).then((function(n){try{return e(1===(i=n).width&&2===i.height)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}));function m(e){return new Promise((function(t,n){var r=new l;r.onload=function(){return t(r.result)},r.onerror=function(e){return n(e)},r.readAsDataURL(e)}))}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise((function(r){for(var o=e.split(","),i=o[0].match(/:(.*?);/)[1],a=window.atob(o[1]),s=a.length,c=new Uint8Array(s);s--;)c[s]=a.charCodeAt(s);var p=new Blob([c],{type:i});p.name=t,p.lastModified=n,r(p)}))}function g(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=function(e){return n(e)},r.src=e}))}function v(e){var t=a(C(e.width,e.height),2),n=t[0];return t[1].drawImage(e,0,0,n.width,n.height),n}function w(e){return new Promise((function(t,n){var r,o,i=function(){try{return o=v(r),t([r,o])}catch(e){return n(e)}},a=function(t){try{return m(e).then((function(e){try{return g(e).then((function(e){try{return r=e,i()}catch(e){return n(e)}}),n)}catch(e){return n(e)}}),n)}catch(e){return n(e)}};try{return createImageBitmap(e).then((function(e){try{return r=e,i()}catch(e){return a()}}),a)}catch(e){a()}}))}function A(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return new Promise((function(i,a){var s;return"function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e.convertToBlob({type:t,quality:o}).then(function(e){try{return(s=e).name=n,s.lastModified=r,c.call(this)}catch(e){return a(e)}}.bind(this),a):d(e.toDataURL(t,o),n,r).then(function(e){try{return s=e,c.call(this)}catch(e){return a(e)}}.bind(this),a);function c(){return i(s)}}))}function y(e){return new Promise((function(t,n){var r=new l;r.onload=function(e){var n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var r=n.byteLength,o=2;o<r;){if(n.getUint16(o+2,!1)<=8)return t(-1);var i=n.getUint16(o,!1);if(o+=2,65505==i){if(1165519206!=n.getUint32(o+=2,!1))return t(-1);var a=18761==n.getUint16(o+=6,!1);o+=n.getUint32(o+4,a);var s=n.getUint16(o,a);o+=2;for(var c=0;c<s;c++)if(274==n.getUint16(o+12*c,a))return t(n.getUint16(o+12*c+8,a))}else{if(65280!=(65280&i))break;o+=n.getUint16(o,!1)}}return t(-1)},r.onerror=function(e){return n(e)},r.readAsArrayBuffer(e)}))}function b(e,t){var n,r=e.width,o=e.height,i=t.maxWidthOrHeight,s=e;if(isFinite(i)&&(r>i||o>i)){var c=a(C(r,o),2);s=c[0],n=c[1],r>o?(s.width=i,s.height=o/r*i):(s.width=r/o*i,s.height=i),n.drawImage(e,0,0,s.width,s.height),E(e)}return s}function x(e,t){var n=e.width,r=e.height,o=a(C(n,r),2),i=o[0],s=o[1];switch(4<t&&t<9?(i.width=r,i.height=n):(i.width=n,i.height=r),t){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(e,0,0,n,r),E(e),i}function C(e,t){var n,r;try{if(null===(r=(n=new OffscreenCanvas(e,t)).getContext("2d")))throw new Error("getContext of OffscreenCanvas returns null")}catch(e){r=(n=document.createElement("canvas")).getContext("2d")}return n.width=e,n.height=t,[n,r]}function E(e){e.width=0,e.height=0}function S(e,t){return new Promise((function(n,r){var o,i,s,c,p,u,l,m,f,d,g,v,S,P,O,B;function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;o+=e,t.onProgress(Math.min(o,100))}function M(e){o=Math.min(Math.max(e,o),100),t.onProgress(o)}return o=0,i=t.maxIteration||10,s=1024*t.maxSizeMB*1024,z(),w(e).then(function(o){try{var w=a(o,2);return w[0],c=w[1],z(),p=b(c,t),z(),new Promise((function(n,r){var o;if(!(o=t.exifOrientation))return y(e).then(function(e){try{return o=e,i.call(this)}catch(e){return r(e)}}.bind(this),r);function i(){return n(o)}return i.call(this)})).then(function(o){try{return t.exifOrientation=o,z(),h.then(function(o){try{return u=o?p:x(p,t.exifOrientation),z(),l=1,A(u,t.fileType||e.type,e.name,e.lastModified,l).then(function(o){try{{if(m=o,z(),f=m.size>s,d=m.size>e.size,!f&&!d)return M(100),n(m);var h;function w(){if(i--&&(S>s||S>g)){var n,o,c=a(C(n=f?.95*B.width:B.width,o=f?.95*B.height:B.height),2);return O=c[0],c[1].drawImage(B,0,0,n,o),"image/jpeg"===e.type&&(l*=.95),A(O,t.fileType||e.type,e.name,e.lastModified,l).then((function(e){try{return P=e,E(B),B=O,S=P.size,M(Math.min(99,Math.floor((v-S)/(v-s)*100))),w}catch(e){return r(e)}}),r)}return[1]}return g=e.size,v=m.size,S=v,B=u,(h=function(e){for(;e;){if(e.then)return void e.then(h,r);try{if(e.pop){if(e.length)return e.pop()?y.call(this):e;e=w}else e=e.call(this)}catch(e){return r(e)}}}.bind(this))(w);function y(){return E(B),E(O),E(p),E(u),E(c),M(100),n(P)}}}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}))}c&&(Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e});var P,O,B=0;function z(){return function(e){return"function"==typeof e&&(e="(".concat(f,")()")),new Worker(URL.createObjectURL(new Blob([e])))}("\n    let scriptImported = false\n    self.addEventListener('message', async (e) => {\n      const { file, id, imageCompressionLibUrl, options } = e.data\n      options.onProgress = (progress) => self.postMessage({ progress, id })\n      try {\n        if (!scriptImported) {\n          // console.log('[worker] importScripts', imageCompressionLibUrl)\n          self.importScripts(imageCompressionLibUrl)\n          scriptImported = true\n        }\n        // console.log('[worker] self', self)\n        const compressedFile = await imageCompression(file, options)\n        self.postMessage({ file: compressedFile, id })\n      } catch (e) {\n        // console.error('[worker] error', e)\n        self.postMessage({ error: e.message + '\\n' + e.stack, id })\n      }\n    })\n  ")}function M(e,t){return new Promise((function(n,r){var o,a,s;if(t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,a="boolean"!=typeof t.useWebWorker||t.useWebWorker,delete t.useWebWorker,void 0===t.onProgress&&(t.onProgress=function(){}),!(e instanceof Blob||e instanceof u))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return r(new Error("The file given is not an image"));if(s="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!a||"function"!=typeof Worker||s)return S(e,t).then(function(e){try{return o=e,l.call(this)}catch(e){return r(e)}}.bind(this),r);var c=function(){try{return l.call(this)}catch(e){return r(e)}}.bind(this),p=function(n){try{return S(e,t).then((function(e){try{return o=e,c()}catch(e){return r(e)}}),r)}catch(e){return r(e)}};try{return function(e,t){return new Promise((function(n,r){return new Promise((function(o,a){var s=B++;return P||(P=function(e){return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}("\n    function imageCompression (){return (".concat(M,").apply(null, arguments)}\n\n    imageCompression.getDataUrlFromFile = ").concat(M.getDataUrlFromFile,"\n    imageCompression.getFilefromDataUrl = ").concat(M.getFilefromDataUrl,"\n    imageCompression.loadImage = ").concat(M.loadImage,"\n    imageCompression.drawImageInCanvas = ").concat(M.drawImageInCanvas,"\n    imageCompression.drawFileInCanvas = ").concat(M.drawFileInCanvas,"\n    imageCompression.canvasToFile = ").concat(M.canvasToFile,"\n    imageCompression.getExifOrientation = ").concat(M.getExifOrientation,"\n    imageCompression.handleMaxWidthOrHeight = ").concat(M.handleMaxWidthOrHeight,"\n    imageCompression.followExifOrientation = ").concat(M.followExifOrientation,"\n    imageCompression.cleanupMemory = ").concat(M.cleanupMemory,"\n\n    getDataUrlFromFile = imageCompression.getDataUrlFromFile\n    getFilefromDataUrl = imageCompression.getFilefromDataUrl\n    loadImage = imageCompression.loadImage\n    drawImageInCanvas = imageCompression.drawImageInCanvas\n    drawFileInCanvas = imageCompression.drawFileInCanvas\n    canvasToFile = imageCompression.canvasToFile\n    getExifOrientation = imageCompression.getExifOrientation\n    handleMaxWidthOrHeight = imageCompression.handleMaxWidthOrHeight\n    followExifOrientation = imageCompression.followExifOrientation\n    cleanupMemory = imageCompression.cleanupMemory\n\n    getNewCanvasAndCtx = ").concat(C,"\n    \n    CustomFileReader = FileReader\n    \n    CustomFile = File\n    \n    function _slicedToArray(arr, n) { return arr }\n    \n    function _typeof(a) { return typeof a }\n\n    function compress (){return (").concat(S,").apply(null, arguments)}\n    "))),O||(O=z()),O.addEventListener("message",(function e(o){if(o.data.id===s){if(void 0!==o.data.progress)return void t.onProgress(o.data.progress);O.removeEventListener("message",e),o.data.error&&r(new Error(o.data.error)),n(o.data.file)}})),O.addEventListener("error",r),O.postMessage({file:e,id:s,imageCompressionLibUrl:P,options:i(i({},t),{},{onProgress:void 0})}),o()}))}))}(e,t).then((function(e){try{return o=e,c()}catch(e){return p()}}),p)}catch(e){p()}function l(){try{o.name=e.name,o.lastModified=e.lastModified}catch(e){}return n(o)}}))}M.getDataUrlFromFile=m,M.getFilefromDataUrl=d,M.loadImage=g,M.drawImageInCanvas=v,M.drawFileInCanvas=w,M.canvasToFile=A,M.getExifOrientation=y,M.handleMaxWidthOrHeight=b,M.followExifOrientation=x,M.cleanupMemory=E,M.version="1.0.12",t.a=M},21:function(e,t){e.exports=r},54:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M4.586 8.657l6.01-6.01a.5.5 0 01.707.707l-6.01 6.01a1 1 0 01-1.414 0L.697 6.182a.5.5 0 01.707-.707l3.182 3.182z" fill="#000"></path><path d="M0 0h12v12H0z"></path></g></svg>'},87:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19.637 15.866L30.951 27.18a2.667 2.667 0 01-3.771 3.771L15.866 19.637 4.552 30.951A2.667 2.667 0 01.781 27.18l11.314-11.314L.781 4.552A2.667 2.667 0 014.552.781l11.314 11.314L27.18.781a2.667 2.667 0 013.771 3.771L19.637 15.866z"></path></svg>'},959:function(e,t,n){"use strict";n.r(t),n.d(t,"CropType",(function(){return i.CropType})),n.d(t,"ImageCrop",(function(){return S}));var r,o=n(0),i=n(1),a=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=n(54),c=n(87),p=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.showGrid,r=t.style,a=t.className;a||(a="");var p=r.width,u={display:"flex",alignItems:"center",justifyContent:"flex-end",minWidth:"75px",paddingBottom:"5px",left:"-1px",paddingTop:"5px",position:"absolute",top:"-40px",height:"40px",width:Math.min(this.props.screenWidth,p)+"px",boxShadow:"0 2px 8px 1px rgba(0,0,0,0.20)",backgroundColor:"#fff",borderRadius:"2px",cursor:"default"};this.props.widgetArea.top-40<0&&(u.top=this.props.widgetArea.height+"px");var l=o.React.createElement("div",{onMouseDown:function(e){e.stopPropagation()},style:u},o.React.createElement("div",{className:"tool-item mr-1",style:{float:"right",padding:"0.42rem 0.5rem"},onClick:function(){e.props.onConfirmCrop&&e.props.onConfirmCrop(e.props.svgViewBox,e.props.svgPath,e.props.cropShape)}},o.React.createElement(i.Icon,{icon:s,width:16,height:16,className:"mr-0"})),o.React.createElement("div",{className:"tool-item mr-1",style:{float:"right",padding:"0.42rem 0.5rem",marginLeft:"0.1rem"},onClick:function(){e.props.onCancelCrop&&e.props.onCancelCrop()}},o.React.createElement(i.Icon,{icon:c,width:13,height:13,className:"mr-0"})));return o.React.createElement("div",{style:r,className:Object(o.classNames)("cropperArea "+a,{gridLines:n})},o.React.createElement("svg",{width:"100%",height:"100%",viewBox:this.props.svgViewBox?this.props.svgViewBox:"0 0 28 28",preserveAspectRatio:"none"},o.React.createElement("defs",null,o.React.createElement("mask",{id:"mask-setting-"+this.props.widgetId,maskContentUnits:"userSpaceOnUse"},o.React.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",stroke:"none",fill:"rgb(255, 255, 255, 1)"}),o.React.createElement("svg",{width:"100%",height:"100%",viewBox:this.props.svgViewBox?this.props.svgViewBox:"0 0 28 28",preserveAspectRatio:"none"},o.React.createElement("g",null,o.React.createElement("path",{strokeWidth:"2",strokeDasharray:"10",strokeDashoffset:"0",fill:"#000",d:this.props.svgPath?this.props.svgPath:"m0,0l0,28l28,0l0,-28l-28,0z"}))))),o.React.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",className:"mask-image",style:{stroke:"none",fill:"rgb(0, 0, 0, 0.7)"}}),o.React.createElement("g",null,o.React.createElement("path",{stroke:"#fff",strokeWidth:".1",fill:"none",strokeDashoffset:"0",d:this.props.svgPath?this.props.svgPath:"m0,0l0,28l28,0l0,-28l-28,0z"}))),l)},t}(o.React.Component),u=n(21),l=n(125),h=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},m=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function f(e,t,n,r){return{x:d(e.x,t.width,n.width,r),y:d(e.y,t.height,n.height,r)}}function d(e,t,n,r){var o=t*r/2-n/2;return Math.min(o,Math.max(e,-o))}function g(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function v(e,t){return Math.min(e,Math.max(0,t))}function w(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}var A,y=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},x=function(e){function t(n){var r=e.call(this,n)||this;return r.image=null,r.container=null,r.containerRect={},r.imageSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.lastPinchDistance=0,r.rafDragTimeout=null,r.rafZoomTimeout=null,r.screenWidth=document?document.documentElement.clientWidth:null,r.screenHeight=document?document.documentElement.clientHeight:null,r.getStyle=function(){var e=window.location.href.replace(window.location.hash,"");return Object(o.css)(A||(A=b(['\n      .cropperArea {\n        position: relative;\n        border: 1px solid rgba(255, 255, 255, 0.5);\n        box-sizing: border-box;\n        box-shadow: 0 0 0 9999em;\n        color: rgba(0,0,0,0.5);\n\n        .tool-item {\n          background-color: #EEF0F3;\n          cursor: pointer;\n\n          &:hover {\n            background-color: #c8cbcd;\n            cursor: pointer;\n          }\n        }\n      }\n\n      .gridLines {\n        &::before {\n          content: " ";\n          box-sizing: border-box;\n          position: absolute;\n          border: 1px solid rgba(255, 255, 255, 0.5);\n          top: 0;\n          bottom: 0;\n          left: 33.33%;\n          right: 33.33%;\n          borderTop: 0;\n          borderBottom: 0;\n        }\n\n        &::after {\n          content: " ";\n          box-sizing: border-box;\n          position: absolute;\n          border: 1px solid rgba(255, 255, 255, 0.5);\n          top: 33.33%;\n          bottom: 33.33%;\n          left: 0;\n          right: 0;\n          borderLeft: 0;\n          borderRight: 0;\n        },\n      }\n\n      .roundShape {\n        border-radius: 50%\n      }\n\n      .mask-border {\n        path {\n          transition:all 1s linear;\n          animation-name:ring;\n          animation-duration:9.2s;\n          animation-timing-function: linear;\n          animation-iteration-count:infinite;\n        }\n        \n        @keyframes ring {\n            from {\n                stroke-dashoffset:0;\n            }\n            to {\n                stroke-dashoffset:6000;\n            }\n        }\n      }\n\n      .mask-image {\n        -webkit-mask-image: url(',"#mask-setting-",");\n        mask: url(","#mask-setting-",");\n        mask-image: url(","#mask-setting-",");\n      }\n    "],['\n      .cropperArea {\n        position: relative;\n        border: 1px solid rgba(255, 255, 255, 0.5);\n        box-sizing: border-box;\n        box-shadow: 0 0 0 9999em;\n        color: rgba(0,0,0,0.5);\n\n        .tool-item {\n          background-color: #EEF0F3;\n          cursor: pointer;\n\n          &:hover {\n            background-color: #c8cbcd;\n            cursor: pointer;\n          }\n        }\n      }\n\n      .gridLines {\n        &::before {\n          content: " ";\n          box-sizing: border-box;\n          position: absolute;\n          border: 1px solid rgba(255, 255, 255, 0.5);\n          top: 0;\n          bottom: 0;\n          left: 33.33%;\n          right: 33.33%;\n          borderTop: 0;\n          borderBottom: 0;\n        }\n\n        &::after {\n          content: " ";\n          box-sizing: border-box;\n          position: absolute;\n          border: 1px solid rgba(255, 255, 255, 0.5);\n          top: 33.33%;\n          bottom: 33.33%;\n          left: 0;\n          right: 0;\n          borderLeft: 0;\n          borderRight: 0;\n        },\n      }\n\n      .roundShape {\n        border-radius: 50%\n      }\n\n      .mask-border {\n        path {\n          transition:all 1s linear;\n          animation-name:ring;\n          animation-duration:9.2s;\n          animation-timing-function: linear;\n          animation-iteration-count:infinite;\n        }\n        \n        @keyframes ring {\n            from {\n                stroke-dashoffset:0;\n            }\n            to {\n                stroke-dashoffset:6000;\n            }\n        }\n      }\n\n      .mask-image {\n        -webkit-mask-image: url(',"#mask-setting-",");\n        mask: url(","#mask-setting-",");\n        mask-image: url(","#mask-setting-",");\n      }\n    "])),e,r.props.widgetId,e,r.props.widgetId,e,r.props.widgetId)},r.preventZoomSafari=function(e){return e.preventDefault()},r.cleanEvents=function(){document.removeEventListener("mousemove",r.onMouseMove),document.removeEventListener("mouseup",r.onDragStopped),document.removeEventListener("touchmove",r.onTouchMove),document.removeEventListener("touchend",r.onDragStopped)},r.onImgLoad=function(){r.computeSizes(),r.emitCropData()},r.computeSizes=function(){if(r.image){r.imageSize={width:r.image.width,height:r.image.height,naturalWidth:r.image.naturalWidth,naturalHeight:r.image.naturalHeight};var e=r.props.widgetArea.width,t=r.props.widgetArea.height,n=r.state.minZoom,o=r.state.maxZoom;o=r.image.width/r.image.height>=e/t?(n=t/r.image.height)+5:(n=e/r.image.width)+5,n>r.props.zoom&&r.props.onZoomChange&&r.props.onZoomChange(n);var i={width:e,height:t};r.setState({cropSize:i,minZoom:n,maxZoom:o},r.recomputeCropPosition)}r.container&&(r.containerRect=r.container.getBoundingClientRect())},r.onMouseDown=function(e){e.preventDefault(),document.addEventListener("mousemove",r.onMouseMove),document.addEventListener("mouseup",r.onDragStopped),r.onDragStart(t.getMousePoint(e))},r.onMouseMove=function(e){return r.onDrag(t.getMousePoint(e))},r.onTouchStart=function(e){e.preventDefault(),document.addEventListener("touchmove",r.onTouchMove,{passive:!1}),document.addEventListener("touchend",r.onDragStopped),2===e.touches.length?r.onPinchStart(e):1===e.touches.length&&r.onDragStart(t.getTouchPoint(e.touches[0]))},r.onTouchMove=function(e){2===e.touches.length?r.onPinchMove(e):1===e.touches.length&&r.onDrag(t.getTouchPoint(e.touches[0]))},r.onDragStart=function(e){var t=e.x,n=e.y;r.dragStartPosition={x:t,y:n},r.dragStartCrop={x:r.props.crop.x,y:r.props.crop.y}},r.onDrag=function(e){var t=e.x,n=e.y;r.rafDragTimeout&&window.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=window.requestAnimationFrame((function(){if(void 0!==t&&void 0!==n){var e=t-r.dragStartPosition.x,o=n-r.dragStartPosition.y,i=f({x:r.dragStartCrop.x+e,y:r.dragStartCrop.y+o},r.imageSize,r.state.cropSize,r.props.zoom);r.props.onCropChange(i)}}))},r.onDragStopped=function(){r.cleanEvents(),r.emitCropData()},r.onWheel=function(e){e.preventDefault();var n=t.getMousePoint(e),o=null;o=e.deltaY<=0?1.05*r.props.zoom:.95*r.props.zoom,r.setNewZoom(o,n)},r.getPointOnContainer=function(e,t){var n=e.x,o=e.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(n-r.containerRect.left),y:r.containerRect.height/2-(o-r.containerRect.top)}},r.getPointOnImage=function(e){var t=e.x,n=e.y,o=r.props,i=o.crop,a=o.zoom;return{x:(t+i.x)/a,y:(n+i.y)/a}},r.setNewZoom=function(e,t){var n=r.getPointOnContainer(t),o=r.getPointOnImage(n),i=Math.min(r.state.maxZoom,Math.max(e,r.state.minZoom)),a=f({x:o.x*i-n.x,y:o.y*i-n.y},r.imageSize,r.state.cropSize,i);r.props.onCropChange(a),r.props.onZoomChange&&r.props.onZoomChange(i)},r.emitCropData=function(){if(r.state.cropSize){var e=function(e,t,n,r){var o={x:v(100,((t.width-n.width/r)/2-e.x/r)/t.width*100),y:v(100,((t.height-n.height/r)/2-e.y/r)/t.height*100),width:v(100,n.width/t.width*100/r),height:v(100,n.height/t.height*100/r)};return{croppedAreaPercentages:o,croppedAreaPixels:{x:v(t.naturalWidth,o.x*t.naturalWidth/100),y:v(t.naturalHeight,o.y*t.naturalHeight/100),width:v(t.naturalWidth,o.width*t.naturalWidth/100),height:v(t.naturalHeight,o.height*t.naturalHeight/100)}}}(f(r.props.crop,r.imageSize,r.state.cropSize,r.props.zoom),r.imageSize,r.state.cropSize,r.props.zoom),t=e.croppedAreaPercentages,n=e.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(t,n)}},r.recomputeCropPosition=function(){var e=f(r.props.crop,r.imageSize,r.state.cropSize,r.props.zoom);r.props.onCropChange(e),r.emitCropData()},r.onImgError=function(){var e={width:r.props.widgetArea.width,height:r.props.widgetArea.height};r.setState({cropSize:e})},r.onResize=function(e,t){r.screenWidth=e,r.screenHeight=t},r.state={cropSize:null,minZoom:r.props.minZoom,maxZoom:r.props.maxZoom},r}return y(t,e),t.prototype.componentDidMount=function(){window.addEventListener("resize",this.computeSizes),this.container.addEventListener("gesturestart",this.preventZoomSafari),this.container.addEventListener("gesturechange",this.preventZoomSafari),this.container.addEventListener("wheel",this.onWheel)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.computeSizes),this.container.removeEventListener("gesturestart",this.preventZoomSafari),this.container.removeEventListener("gesturechange",this.preventZoomSafari),this.container.removeEventListener("wheel",this.onWheel),this.cleanEvents()},t.prototype.componentDidUpdate=function(e){e.aspect!==this.props.aspect?this.computeSizes():e.zoom!==this.props.zoom&&this.recomputeCropPosition()},t.prototype.onPinchStart=function(e){var n=t.getTouchPoint(e.touches[0]),r=t.getTouchPoint(e.touches[1]);this.lastPinchDistance=g(n,r),this.onDragStart(w(n,r))},t.prototype.onPinchMove=function(e){var n=this,r=t.getTouchPoint(e.touches[0]),o=t.getTouchPoint(e.touches[1]),i=w(r,o);this.onDrag(i),this.rafZoomTimeout&&window.cancelAnimationFrame(this.rafZoomTimeout),this.rafZoomTimeout=window.requestAnimationFrame((function(){var e=g(r,o),t=n.props.zoom*(e/n.lastPinchDistance);n.setNewZoom(t,i),n.lastPinchDistance=e}))},t.prototype.render=function(){var e=this,t=Object(o.getAppStore)().getState().appContext.isRTL,n=this.props,r=n.crop,i=r.x,a=r.y,s=n.zoom,c=n.showGrid,u=(n.style,n.classes),l=u.containerClassName,h=u.cropAreaClassName,m=u.imageClassName;return Object(o.jsx)("div",{css:this.getStyle,onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,"data-testid":"container",className:l,style:{userSelect:"none",touchAction:"none",cursor:"move",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:this.props.widgetArea.top,left:t?null:this.props.widgetArea.left,right:t?document.body.clientWidth-this.props.widgetArea.right:null,width:this.props.widgetArea.width,height:this.props.widgetArea.height},ref:function(t){e.container=t}},Object(o.jsx)(o.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.onResize}),Object(o.jsx)("img",{src:this.props.image,ref:function(t){e.image=t},onLoad:this.onImgLoad,onError:this.onImgError,alt:"",style:{position:"absolute",transform:"translate("+i+"px, "+a+"px) scale("+s+")",willChange:"transform"},className:m}),this.state.cropSize&&Object(o.jsx)(p,{onCancelCrop:this.props.onCancelCrop,onConfirmCrop:this.props.onConfirmCrop,showGrid:c,style:{width:this.state.cropSize.width,height:this.state.cropSize.height},className:h,svgViewBox:this.props.svgViewBox,svgPath:this.props.svgPath,cropShape:this.props.cropShape,widgetId:this.props.widgetId,screenWidth:this.screenWidth,screenHeight:this.screenHeight,widgetArea:this.props.widgetArea}),this.props.loading&&Object(o.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"}))},t.defaultProps={zoom:1,aspect:4/3,maxZoom:10,minZoom:1,showGrid:!0,style:{},classes:{},zoomSpeed:1},t.getMousePoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},t.getTouchPoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},t}(o.React.Component),C=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=["image/gif","image/svg+xml"],S=function(e){function t(t){var n=e.call(this,t)||this;return n.eidtInfoStyle={width:"100%",height:"100%",margin:0},n.onCropChange=function(e){n.setState({crop:e})},n.onCropAreaComplete=function(e,t){n.setState({croppedAreaPixels:t})},n.onZoomChange=function(e){n.setState({zoom:e})},n.onConfirmCrop=function(e,t,r){if(E.indexOf(n.props.imageFormat)>-1||n.props.cropType===i.CropType.Fake){var a={cropPosition:n.state.crop,cropZoom:n.state.zoom,svgViewBox:e||"0 0 28 28",svgPath:t||"m0,0l0,28l28,0l0,-28l-28,0z",cropShape:r||"rectangle",cropPixel:n.state.croppedAreaPixels,cropType:i.CropType.Fake};n.props.onConfirmCrop&&n.props.onConfirmCrop(a)}else{var s={cropPosition:n.state.crop,cropZoom:n.state.zoom,svgViewBox:e,svgPath:t,cropShape:r,cropPixel:n.state.croppedAreaPixels,cropType:i.CropType.Real};n.setState({loading:!0}),(c=n.props.image,p=s.cropPixel,f=n.props.originId,new Promise((function(e,t){HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){var r=this;setTimeout((function(){for(var o=atob(r.toDataURL(t,n).split(",")[1]),i=o.length,a=new Uint8Array(i),s=0;s<i;s++)a[s]=o.charCodeAt(s);e(new Blob([a],{type:t||"image/png"}))}))}});var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.src=c,n.addEventListener("load",(function(){var t=document.createElement("canvas");t.width=p.width,t.height=p.height,t.getContext("2d").drawImage(n,p.x,p.y,p.width,p.height,0,0,p.width,p.height),t.toBlob((function(t){var n=this,r=URL.createObjectURL(t),i={file:r,fileName:(new Date).getTime().toString()+".jpeg",type:o.ResourceType.Image,url:r,blobUrl:r,referedIds:[],fileFormat:"image/jpeg",originId:f};if(window.jimuConfig.isBuilder){var a=u.AppResourceManager.getInstance();return a.getBlobByBlobUrl(i.file).then((function(e){return h(n,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return t=e,e&&e.size&&e.size>204800?(n={maxSizeMB:.2,maxWidthOrHeight:1024,useWebWorker:!0},[4,l.a(e,n)]):[3,2];case 1:t=r.sent(),r.label=2;case 2:return i.file=t,a.upLoadFileToResource(i),i.originId&&u.AppResourceManager.getInstance().updateImageResourceItemInfo(i),[2]}}))}))})),e(i)}return o.moduleLoader.getJimuForBuilderModules().appBuilderSync.letBuilderAddResource(i),e(i)}),"image/jpeg",.8)})),n.addEventListener("error",(function(){return t()}))}))).then((function(e){n.setState({loading:!1}),n.props.onConfirmCrop&&n.props.onConfirmCrop(s,e)}),(function(){n.setState({loading:!1})}))}var c,p,f},n.state={modal:!0,crop:n.props.crop?n.props.crop:{x:0,y:0},zoom:n.props.cropZoom?n.props.cropZoom:1,aspect:1,showGrid:!1,zoomSpeed:.1,croppedAreaPixels:null,loading:!1},n}return C(t,e),t.prototype.render=function(){var e=window.jimuConfig.isBuilder;return o.ReactDOM.createPortal(Object(o.jsx)("div",null,Object(o.jsx)("div",{className:"jimu-widget",style:{zIndex:9999,position:"fixed",top:0,left:0,backgroundColor:"rgb(0, 0, 0, .5)"}}),Object(o.jsx)("div",{style:{zIndex:1e4,position:"absolute",top:0},className:Object(o.classNames)({"jimu-widget d-flex justify-content-center align-items-center":e})},Object(o.jsx)(x,{image:this.props.image,crop:this.state.crop,zoom:this.state.zoom,aspect:this.state.aspect,showGrid:this.state.showGrid,zoomSpeed:this.state.zoomSpeed,onCropChange:this.onCropChange,onCropComplete:this.onCropAreaComplete,onZoomChange:this.onZoomChange,onCancelCrop:this.props.onCancelCrop,onConfirmCrop:this.onConfirmCrop,widgetArea:this.props.widgetArea,widgetId:this.props.widgetId,svgViewBox:this.props.cropParam&&this.props.cropParam.svgViewBox,svgPath:this.props.cropParam&&this.props.cropParam.svgPath,cropShape:this.props.cropParam&&this.props.cropParam.cropShape,loading:this.state.loading}))),document&&document.getElementsByTagName("body")[0])},t}(o.React.Component)}}))}}}));