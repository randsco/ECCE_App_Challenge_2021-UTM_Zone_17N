System.register(["jimu-core","jimu-ui"],(function(t){var e,n;return{setters:[function(t){e=t},function(t){n=t}],execute:function(){t(function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=31)}({0:function(t,n){t.exports=e},1:function(t,e){t.exports=n},31:function(t,e,n){"use strict";n.r(e),n.d(e,"LoadStatus",(function(){return I}));var o,r=n(0),i=n(1),l="Sign in",a="Portal URL",s="Client ID",c="Specify the URL to your ArcGIS Online organization or Portal for ArcGIS",u="Provide the Client ID for Experience Builder registered in the portal you specify above",d="Please enter the full URL of your ArcGIS Online organization or Portal for ArcGIS, for example,",p="Unable to access",f="Your application domain is not allowed via Cross-Origin Resource Sharing (CORS) to access",h="A server with the specified hostname could not be found.",g=n(6);!function(t){t.InvalidPortalUrl="InvalidPortalUrl",t.UnableToCorsAccess="UnableToCorsAccess",t.UnableToAccess="UnableToAccess"}(o||(o={}));var m,v=function(){function t(){this.validPortalInfos=[]}return t.prototype.getDefaultProtalInfo=function(t){return{isValid:!1,invalidMessage:"",isWebTier:!1,supportsOAuth:!0,tokenInfo:{token:null,expires:null,ssl:!1,server:"",userId:""},url:this.getStandardPortalUrl(t)}},t.prototype.getValidPortalInfo=function(t){var e=null;return this.validPortalInfos.some((function(n){return!!r.portalUrlUtils.isSamePortalUrl(t,n.url)&&(e=n,!0)})),e},t.prototype.getStandardPortalUrl=function(t){if(!t)return"";var e=0===t.toLowerCase().indexOf("http://"),n=0===t.toLowerCase().indexOf("https://");return e||n||(t=r.urlUtils.setProtocol(t,r.UrlProtocol.Https)),t=r.portalUrlUtils.getStandardPortalUrl(t),t=r.urlUtils.setProtocol(t,r.UrlProtocol.Https)},t.prototype.validatePortalUrl=function(t){var e=this.getDefaultProtalInfo(t);return/www.arcgis.com/gi.test(t)?(e.isValid=!1,e.invalidMessage=o.InvalidPortalUrl):e.isValid=!0,e},t.prototype.fetcher=function(t,e){return fetch(t,e)},t.prototype.generateToken=function(t){var e=r.urlUtils.setProtocol(r.portalUrlUtils.getPortalRestUrl(t)+"generateToken?f=json",r.UrlProtocol.Https);return this.fetcher(e,{cache:"no-cache",credentials:"include"}).then((function(t){return t.json()})).then((function(t){return t}),(function(t){return null}))},t.prototype.getPortalSelfInfo=function(t){var e=r.urlUtils.setProtocol(r.portalUrlUtils.getPortalRestUrl(t)+"portals/self?f=json",r.UrlProtocol.Https);return this.fetcher(e,{cache:"no-cache",credentials:"include"}).then((function(t){return t.json()})).then((function(t){return t})).catch((function(t){return g(e,{jsonpCallback:"callback",timeout:3e3}).then((function(t){return{invalidPortalSelf:!0,invalidMessage:o.UnableToCorsAccess}})).catch((function(t){return{invalidPortalSelf:!0,invalidMessage:o.UnableToAccess}}))}))},t.prototype.getPortalInfo=function(t){var e=this,n=this.getDefaultProtalInfo(t);return this.getPortalSelfInfo(t).then((function(r){return!r||r.invalidPortalSelf||!r.isPortal&&!r.urlKey?(n.isValid=!1,void(n.invalidMessage=(null==r?void 0:r.invalidMessage)||o.UnableToAccess)):(n.isValid=!0,n.supportsOAuth=r.supportsOAuth,n.tokenInfo.userId=r.user?r.user.username:"",e.validPortalInfos.push(n),e.generateToken(t))})).then((function(e){return e&&e.token&&(n.tokenInfo.token=e.token,n.tokenInfo.expires=e.expires,n.tokenInfo.ssl=e.ssl,n.tokenInfo.server=r.portalUrlUtils.getPortalRestUrl(t),n.isWebTier=!0,n.supportsOAuth=!1),n}))},t.prototype.validatePortal=function(t){if(!t)return Promise.reject("Portal URL is empty.");var e=this.getStandardPortalUrl(t),n=this.getValidPortalInfo(e);return n?Promise.resolve(n):(n=this.validatePortalUrl(e)).isValid?this.getPortalInfo(e):Promise.resolve(n)},t}(),j=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t};var P,I,b=(P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},x=function(){return(x=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(I||(I={}));var U,w=function(t){function e(e){var n=t.call(this,e)||this;return n.onSignInBtnClick=function(){if(n.state.selectedPortalInfo.isValid){var t={portalUrl:n.state.selectedPortalInfo.url,clientId:n.clientIdInput.current.value,supportsOAuth:n.state.selectedPortalInfo.supportsOAuth,isWebTier:n.state.selectedPortalInfo.isWebTier};n.addSigninInfo(t).then((function(){n.signIn(t)}))}},n.onPortalUrlInputBlur=function(){var t=n.urlInput.current.value;n.selectPortalUrl(t)},n.onUrlListBtnClick=function(){n.setState({showUrlList:!n.state.showUrlList})},n.onUrlListItemClick=function(t){n.selectPortalUrl(t)},n.portalValidator=new v,n.state={signinInfos:[],showUrlList:!1,loadStatus:I.Pending,selectedPortalInfo:n.portalValidator.getDefaultProtalInfo()},n.urlInput=r.React.createRef(),n.clientIdInput=r.React.createRef(),n}return b(e,t),e.prototype.componentDidMount=function(){this.fetchSigninInfo()},e.prototype.getDefaultPortalUrl=function(t){var e=window.jimuConfig.hostEnv||"dev",n=r.urlUtils.getFixedRootPath()+"builder/setting.json";return window.fetch(n).then((function(t){return t.json()})).then((function(n){var o=(window.jimuConfig.isDevEdition?n.devEnv:n.env)[e];return o&&o.portalUrl||t[0]&&t[0].portalUrl||""}))},e.prototype.fetchSigninInfo=function(){var t=this,e=window.location.protocol+"//"+window.location.host+"/signininfo";return window.fetch(e,{cache:"no-cache"}).then((function(t){return t.json()})).then((function(e){return t.setState({signinInfos:e}),t.getDefaultPortalUrl(e).then((function(e){t.selectPortalUrl(e)})),e})).catch((function(t){return console.error(t),t}))},e.prototype.addSigninInfo=function(t){var e=window.location.protocol+"//"+window.location.host+"/signinInfo";return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()})).catch((function(t){console.error(t)}))},e.prototype.getSigninInfo=function(t){var e=null;return this.state.signinInfos.some((function(n){return!!r.portalUrlUtils.isSamePortalUrl(n.portalUrl,t)&&(e=n,!0)})),e},e.prototype.OAuthSignIn=function(t){var e=t.portalUrl+"/sharing/rest/",n=""+window.location.origin+r.urlUtils.getFolder(r.moduleLoader.resolveModuleFullPath("jimu-core"))+"/oauth-callback.html?clientID="+t.clientId+"&portal="+e+"&isDevEdition="+window.jimuConfig.isDevEdition+"&fromUrl=/",o={portal:e,clientId:t.clientId,redirectUri:n,popup:!1,params:{showSignupOption:!0,signupType:"esri"}};r.esri.restAuth.UserSession.beginOAuth2(o)},e.prototype.webTierSignIn=function(){var t=this.state.selectedPortalInfo.tokenInfo,e=r.esri.restAuth.UserSession.fromCredential(t);r.SessionManager.getInstance().writeAuthInfo(e),window.location.href="/"},e.prototype.signIn=function(t){t.supportsOAuth?this.OAuthSignIn(t):this.state.selectedPortalInfo.isWebTier&&this.webTierSignIn()},e.prototype.validatePortal=function(t){return this.portalValidator.validatePortal(t)},e.prototype.selectPortalUrl=function(t,e){var n=this;t?(this.setState({loadStatus:I.Pending,selectedPortalInfo:{isValid:!1,invalidMessage:"",isWebTier:!1,supportsOAuth:!0,tokenInfo:null,url:t},showUrlList:!1}),this.validatePortal(t).then((function(t){n.setState(x({selectedPortalInfo:t,loadStatus:I.Fulfilled},e))})).catch((function(){return n.setState({loadStatus:I.Rejected})}))):this.setState({selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(),loadStatus:I.Fulfilled})},e.prototype.render=function(){var t,e,n=this,g=Object(r.styled)(i.Button)(U||(U=y(["\n      display: block;\n      margin: 0 auto;\n    "],["\n      display: block;\n      margin: 0 auto;\n    "]))),v=this.state.signinInfos.map((function(t,e){return Object(r.jsx)(i.DropdownItem,{key:e,active:!!r.portalUrlUtils.isSamePortalUrl(t.portalUrl,n.state.selectedPortalInfo.url),onClick:function(){return n.onUrlListItemClick(t.portalUrl)}},t.portalUrl)})),P=this.getSigninInfo(this.state.selectedPortalInfo.url),b=P&&P.clientId||"";this.state.selectedPortalInfo.url||this.state.loadStatus===I.Pending||(t=Object(r.jsx)("div",null,Object(r.jsx)("div",null,"http://myorg.maps.arcgis.com"),Object(r.jsx)("div",null,"http://myportal.company.com/arcgis")));var x=null,w=null;if(this.state.selectedPortalInfo&&this.state.selectedPortalInfo.invalidMessage&&this.state.loadStatus!==I.Pending){if(this.state.selectedPortalInfo.invalidMessage===o.InvalidPortalUrl)e=Object(r.jsx)("div",null,Object(r.jsx)("div",null,this.props.intl.formatMessage({id:"invalidPortalUrlMessage",defaultMessage:d})),Object(r.jsx)("div",null,"http://myorg.maps.arcgis.com"),Object(r.jsx)("div",null,"http://myportal.company.com/arcgis"));else if(this.state.selectedPortalInfo.invalidMessage===o.UnableToCorsAccess){var O=this.props.intl.formatMessage({id:"unableToCorsAccessMessage",defaultMessage:f});e=Object(r.jsx)("div",null,Object(r.jsx)("div",null,O+" "+this.state.selectedPortalInfo.url))}else{var S=this.props.intl.formatMessage({id:"unableToAccessMessage",defaultMessage:p}),M=this.props.intl.formatMessage({id:"invalidHostNameMessage",defaultMessage:h});e=Object(r.jsx)("div",null,Object(r.jsx)("div",null,S+" "+this.state.selectedPortalInfo.url),Object(r.jsx)("div",null,M))}x=!0,w=!1}else this.state.loadStatus!==I.Pending&&(x=!1,w=!0);var k=this.state.selectedPortalInfo&&this.state.selectedPortalInfo.supportsOAuth?"displayed":"hidden",T="hidden",A=!1;this.state.loadStatus===I.Pending&&(A=!0,T="displayed");var C,L=!this.state.selectedPortalInfo.isValid;return Object(r.jsx)("div",{css:(C=this.props.theme,this.props.isRTL,Object(r.css)(m||(m=j(["\n    width: 700px;\n    margin: 0 auto;\n    .portal-url-input{\n      margin-right: 1px;\n    }\n    .portal-clientId.hidden{\n      display: none;\n    }\n    .loading-panel {\n      position: absolute;\n      width: 15px;\n      background-color: ",";\n\n      .jimu-secondary-loading {\n        left: 2px;\n        top: 12px;\n      }\n      \n      .jimu-secondary-loading, .jimu-secondary-loading:before, .jimu-secondary-loading:after {\n        width: 2px;\n        height: 5px;\n        left: -27px;\n      }\n      .jimu-secondary-loading:before {\n        left: -5px;\n      }\n      .jimu-secondary-loading:after {\n        left: 5px;\n      }\n    }\n\n    .loading-panel.hidden {\n      display: none;\n    }\n\n    .dropdown-menu {\n      width: 700px;\n    }\n\n    .description, .message {\n      color: ",";\n    }\n\n    .invalid-message {\n      color: ",";\n    }\n  "],["\n    width: 700px;\n    margin: 0 auto;\n    .portal-url-input{\n      margin-right: 1px;\n    }\n    .portal-clientId.hidden{\n      display: none;\n    }\n    .loading-panel {\n      position: absolute;\n      width: 15px;\n      background-color: ",";\n\n      .jimu-secondary-loading {\n        left: 2px;\n        top: 12px;\n      }\n      \n      .jimu-secondary-loading, .jimu-secondary-loading:before, .jimu-secondary-loading:after {\n        width: 2px;\n        height: 5px;\n        left: -27px;\n      }\n      .jimu-secondary-loading:before {\n        left: -5px;\n      }\n      .jimu-secondary-loading:after {\n        left: 5px;\n      }\n    }\n\n    .loading-panel.hidden {\n      display: none;\n    }\n\n    .dropdown-menu {\n      width: 700px;\n    }\n\n    .description, .message {\n      color: ",";\n    }\n\n    .invalid-message {\n      color: ",";\n    }\n  "])),C.colors.light,C.colors.palette.dark[600],C.colors.palette.danger[700])),className:"widget-set-portalurl"},Object(r.jsx)("div",{className:"mt-5 mb-2"},Object(r.jsx)(i.Label,{className:"description"}," ",this.props.intl.formatMessage({id:"portalUrlDescription",defaultMessage:c})," "),Object(r.jsx)(i.ButtonGroup,{className:"w-100"},Object(r.jsx)(i.InputGroup,null,Object(r.jsx)(i.TextInput,{className:"portal-url-input",id:"caret",disabled:A,size:"lg",placeholder:this.props.intl.formatMessage({id:"portalUrl",defaultMessage:a}),min:0,max:100,type:"text",value:this.state.selectedPortalInfo.url||"",onBlur:this.onPortalUrlInputBlur,ref:this.urlInput,valid:w,invalid:x}),Object(r.jsx)(i.InputGroupAddon,{addonType:"append"},Object(r.jsx)("div",{className:"loading-panel "+T},Object(r.jsx)("div",{className:"jimu-secondary-loading"})))),Object(r.jsx)(i.Dropdown,{activeIcon:!0,className:"dropdown",isOpen:this.state.showUrlList,toggle:this.onUrlListBtnClick},Object(r.jsx)(i.DropdownButton,{style:{width:"auto"},icon:!0}),Object(r.jsx)(i.DropdownMenu,{className:"dropdown-menu",zIndex:"55",style:{width:"700px"},alightment:"end"},v)))),Object(r.jsx)(i.FormFeedback,{className:"message mx-2",valid:!0}," ",t," "),Object(r.jsx)(i.FormFeedback,{className:"message invalid-message mx-2",valid:!0}," ",e," "),Object(r.jsx)(i.FormGroup,{className:"portal-clientId mt-5 "+k},Object(r.jsx)(i.Label,{className:"description",for:"clientIdText"}," ",this.props.intl.formatMessage({id:"clientIdDescription",defaultMessage:u})," "),Object(r.jsx)(i.TextInput,{disabled:A,size:"lg",type:"text",name:"text",id:"clientIdText",placeholder:this.props.intl.formatMessage({id:"clientId",defaultMessage:s}),value:b,ref:this.clientIdInput})),Object(r.jsx)(g,{disabled:A||L,size:"lg",onClick:function(){return n.onSignInBtnClick()}},this.props.intl.formatMessage({id:"portalUrlSignIn",defaultMessage:l})))},e.mapExtraStateProps=function(t){return{isRTL:t.appContext.isRTL}},e}(r.React.PureComponent);e.default=w},6:function(t,e,n){var o,r,i;r=[e,t],void 0===(i="function"==typeof(o=function(t,e){"use strict";var n=5e3,o="callback";function r(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function i(t){try{delete window[t]}catch(e){window[t]=void 0}}function l(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}e.exports=function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=t,s=e.timeout||n,c=e.jsonpCallback||o,u=void 0;return new Promise((function(n,o){var d=e.jsonpCallbackFunction||r(),p=c+"_"+d;window[d]=function(t){n({ok:!0,json:function(){return Promise.resolve(t)}}),u&&clearTimeout(u),l(p),i(d)},a+=-1===a.indexOf("?")?"?":"&";var f=document.createElement("script");f.setAttribute("src",""+a+c+"="+d),e.charset&&f.setAttribute("charset",e.charset),f.id=p,document.getElementsByTagName("head")[0].appendChild(f),u=setTimeout((function(){o(new Error("JSONP request to "+t+" timed out")),i(d),l(p),window[d]=function(){i(d)}}),s),f.onerror=function(){o(new Error("JSONP request to "+t+" failed")),i(d),l(p),u&&clearTimeout(u)}}))}})?o.apply(e,r):o)||(t.exports=i)}}))}}}));