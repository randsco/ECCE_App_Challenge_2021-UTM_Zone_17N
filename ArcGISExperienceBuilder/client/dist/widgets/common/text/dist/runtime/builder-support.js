System.register(["jimu-core","jimu-ui","jimu-ui/advanced/rich-text-editor"],(function(e){var t,n,r;return{setters:[function(e){t=e},function(e){n=e},function(e){r=e}],execute:function(){e(function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=384)}({0:function(e,n){e.exports=t},1:function(e,t){e.exports=n},14:function(e,t){e.exports=r},384:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"DATA_SOURCE_ID_REGEXP",(function(){return s})),n.d(r,"getDataSourceIds",(function(){return f})),n.d(r,"getUseDataSourceIds",(function(){return d})),n.d(r,"getInvalidDataSourceIds",(function(){return p})),n.d(r,"getExpressionParts",(function(){return v})),n.d(r,"BLANK_CHARATER",(function(){return b})),n.d(r,"shouldShowPlaceholder",(function(){return g})),n.d(r,"sanitizeHTML",(function(){return m})),n.d(r,"removeTextContent",(function(){return y})),n.d(r,"getDefaultValue",(function(){return O}));var o,u,i,a=n(0),c=n(1),l=n(14),s=/data-dsid=\"(((?![\=|\>|\"]).)*)[\"\>|"\s)]/gm,f=function(e){return void 0===e&&(e=Object(a.Immutable)([])),e.map((function(e){return e.dataSourceId}))},d=function(e){for(var t,n=s,r=[];null!==(t=n.exec(e));){var o=t[1];o.indexOf(",")>0?(o=o.split(","),r=r.concat(o)):r.push(o)}return r},p=function(e,t){var n=d(e);if(n&&n.length){var r=f(t),o=n.filter((function(e){return r.indexOf(e)<0}));return o.length?o:void 0}},v=function(e){var t=[];for(var n in e){var r=e[n],o=r&&r.parts;o&&(t=t.concat(o))}return t},b="\ufeff",h=document.createElement("div"),g=function(e,t,n){var r=c.richTextUtils.isBlankRichText(e)&&t;return void 0!==n?!n&&r:r},m=function(e){return e&&c.sanitizer.sanitize(e)},y=function(e){if(e){var t=function(e){return h.innerHTML=e,h.textContent}(e);return null==e?void 0:e.replace(null==t?void 0:t.trim(),b)}},O=function(e,t,n,r){var o=t,u=g(t,n);return e?u&&(o=y(n)):o=u?n:t,m(o)},x=function(){return(x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},j=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},w=a.React.useEffect,S=a.React.useRef,R=a.React.useState,E=a.React.useMemo,C={toolbar:!1,autoformat:{link:{trigger:/[\s]/,find:/https?:\/\/[\S]+|(www\.[\S]+)/gi,transform:function(e,t){return t?"http://"+e:e},format:"link"}},clipboard:{matchers:[["img",function(){return new l.Delta}]]}},P=/(?!^\n$)[\n]/gm,D=function(e,t){return t.forEach((function(e){"string"==typeof e.insert&&(e.insert=e.insert.replace(P," "))})),t},I=function(e){e.clipboard.addMatcher("*",D)},k=function(e,t){if(e){var n=function(e){var t=e.clipboard.matchers,n=-1;if(t.some((function(e,t){var r=e[0],o=e[1];if("*"===r&&o===D)return n=t,!0})),n>-1)return e.clipboard.matchers.splice(n,1),!0}(e);t=m(t);var r=e.clipboard.convert(t);e.setContents(r,"silent"),l.richTextEditorUtils.setEditorCursorEnd(e,"silent"),n&&I(e)}},M=function(e){var t=e.editorRef,n=e.value,r=e.placeholder,o=e.enabled,u=e.onChange,i=j(e,["editorRef","value","placeholder","enabled","onChange"]),s=c.hooks.useForwardRef(t),f=s[0],d=s[1],p=R(n),v=p[0],b=p[1],h=R(r),m=h[0],P=h[1],D=function(e,t,n,r){var o=S({enabled:e,value:t,placeholder:n,onChange:r});return w((function(){o.current={enabled:e,value:t,placeholder:n,onChange:r}}),[e,t,n,r]),o}(o,v,m,u),M=E((function(){return O(o,v,m,f.current)}),[]),T=c.hooks.useEventCallback((function(e,t,n){"silent"!==n&&(g(v,m,o)?P(e):b(e))}));return c.hooks.useUpdateEffect((function(){var e=D.current,t=e.value,n=e.placeholder,r=e.onChange,u=f.current;if(o){var i=f.current;if(g(t,n)){var a=y(n);k(i,a),i.focus()}}else g(t,n)&&k(u,n),null==r||r(t,n)}),[o]),w((function(){var e=f.current;e&&I(e)}),[f]),c.hooks.useUnmount((function(){var e=D.current,t=e.value,n=e.placeholder,r=e.onChange;null==r||r(t,n)})),a.React.createElement(l.RichTextEditor,x({autoFocus:!0,enabled:o,editorRef:d,onChange:T,defaultValue:M,modules:C},i))},T=function(e){var t=e.editor,n=e.formats,r=e.selection,o=e.useDataSources,u=e.widgetId,i=a.ReactRedux.useSelector((function(e){var t;return null===(t=e.widgetsState[u])||void 0===t?void 0:t.showExpression})),s=c.hooks.useTranslate(c.defaultMessages),f=a.React.useMemo((function(){return{title:s("dynamicContent"),onClose:function(){return Object(a.getAppStore)().dispatch(a.appActions.widgetStatePropChange(u,"showExpression",!1))}}}),[u,s]);return a.React.createElement(a.React.Fragment,null,a.React.createElement(l.Bubble,{editor:t,formats:n,selection:r,source:"user"}),a.React.createElement(l.Expression,{source:"user",editor:t,formats:n,selection:r,open:i,useDataSources:o,header:f,widgetId:u}))},_=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},A=function(){return(A=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},U=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},z=a.React.useMemo,B=a.React.useCallback,F=Object(a.css)(o||(o=_(["\n  opacity: 0.5;\n  background: red;\n  outline: 1px solid white;\n"],["\n  opacity: 0.5;\n  background: red;\n  outline: 1px solid white;\n"])));t.default={Editor:function(e){var t=e.value,n=e.widgetId,r=e.useDataSources,o=e.onChange,c=e.onCreate,l=e.onDestory,s=U(e,["value","widgetId","useDataSources","onChange","onCreate","onDestory"]),f=function(e,t){return B((function(n){return n?null==e?void 0:e(n):null==t?void 0:t()}),[e,t])}(c,l),d=function(e,t){return a.React.useMemo((function(){return function(n){var r=n.editor,o=n.selection,u=n.formats;return Object(a.jsx)(T,{editor:r,selection:o,formats:u,widgetId:e,useDataSources:t})}}),[t,e])}(n,r),v=function(e,t){return z((function(){var n,r=p(e,t);return r&&(n=r.map((function(e){return Object(a.css)(u||(u=_(['\n          exp[data-dsid*="','"] {\n           ',"\n          }\n        "],['\n          exp[data-dsid*="','"] {\n           ',"\n          }\n        "])),e,F)}))),Object(a.css)(i||(i=_(["",""],["",""])),n)}),[e,t])}(t,r);return Object(a.jsx)(M,A({editorRef:f,css:v,value:t,plugin:d,onChange:o},s))},builderUtils:r}}}))}}}));