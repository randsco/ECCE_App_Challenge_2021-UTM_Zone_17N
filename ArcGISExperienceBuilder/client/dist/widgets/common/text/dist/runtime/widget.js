System.register(["jimu-core","jimu-ui"],(function(e){var t,n;return{setters:[function(e){t=e},function(e){n=e}],execute:function(){e(function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=408)}({0:function(e,n){e.exports=t},1:function(e,t){e.exports=n},307:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.161 1.98l4.31 4.541a.726.726 0 001.058 0l4.31-4.54a.592.592 0 000-.813.534.534 0 00-.779 0L6 5.448l-4.06-4.28a.534.534 0 00-.779 0 .592.592 0 000 .813zm0 4l4.31 4.541a.726.726 0 001.058 0l4.31-4.54a.592.592 0 000-.813.534.534 0 00-.779 0L6 9.448l-4.06-4.28a.534.534 0 00-.779 0 .592.592 0 000 .813z"></path></svg>'},408:function(e,t,n){"use strict";n.r(t);var o,r,i=n(0),a=n(1),u=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},s=function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n},c=i.React.useState,d=i.React.useEffect,p=i.React.useRef,f=n(307);function b(e){var t,n=e.value,b=e.placeholder,g=e.repeatedDataSource,v=e.useDataSources,h=e.widgetId,x=e.wrap,m=e.tooltip,w=l(e,["value","placeholder","repeatedDataSource","useDataSources","widgetId","wrap","tooltip"]),S=i.ReactRedux.useSelector((function(e){return e.theme})),y=p(),j=i.expressionUtils.isSingleStringExpression(m),O=c(""),R=O[0],M=O[1],D=i.React.useState("24px"),E=D[0],I=D[1],k=i.React.useState(!1),P=k[0],U=k[1],A=i.React.useState(!1),C=A[0],N=A[1],T=i.React.useState(0),W=T[0],_=T[1],Y=i.React.useState(!1),L=Y[0],F=Y[1],z=function(e,t,n){var a,s,l,c,d,p=null===(a=null==n?void 0:n.colors)||void 0===a?void 0:a.white,f=null!==(d=null===(c=null===(l=null===(s=null==n?void 0:n.colors)||void 0===s?void 0:s.palette)||void 0===l?void 0:l.light)||void 0===c?void 0:c[500])&&void 0!==d?d:"#444";return i.React.useMemo((function(){var n=Object(i.css)(o||(o=u(["\n      .rich-displayer {\n        white-space: nowrap !important;\n      }\n   "],["\n      .rich-displayer {\n        white-space: nowrap !important;\n      }\n   "])));return Object(i.css)(r||(r=u(["\n      width: 100%;\n      height: 100%;\n      position: relative;\n      overflow-y: hidden;\n      .rich-displayer {\n        width: 100%;\n        height: fit-content;\n      }\n\n      ",";\n      .text-fade {\n        position: absolute;\n        left: 0;\n        height: ",";\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        pointer-events: none;\n        > .arrow {\n          position: absolute;\n          width: 16px;\n          height: 16px;\n          background: ",";\n          overflow: hidden;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          &.arrow-bottom {\n            bottom: 4px;\n          }\n        }\n        &.text-fade-bottom {\n          bottom: 0;\n          background: linear-gradient(180deg, rgba(182, 182, 182, 0) 0%, "," 100%);\n        }\n      }\n\n      .bounce {\n        animation-name: bounce;\n        animation-duration:0.6s;\n        animation-iteration-count:infinite;\n        animation-timing-function:linear;\n      }\n\n      @keyframes bounce {\n        0% { \n          transform: translateY(0px) \n        }\n        50% {\n          transform: translateY(2px)\n        }\n        100%{\n          transform: translateY(4px)\n        }\n      }\n    "],["\n      width: 100%;\n      height: 100%;\n      position: relative;\n      overflow-y: hidden;\n      .rich-displayer {\n        width: 100%;\n        height: fit-content;\n      }\n\n      ",";\n      .text-fade {\n        position: absolute;\n        left: 0;\n        height: ",";\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        pointer-events: none;\n        > .arrow {\n          position: absolute;\n          width: 16px;\n          height: 16px;\n          background: ",";\n          overflow: hidden;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          &.arrow-bottom {\n            bottom: 4px;\n          }\n        }\n        &.text-fade-bottom {\n          bottom: 0;\n          background: linear-gradient(180deg, rgba(182, 182, 182, 0) 0%, "," 100%);\n        }\n      }\n\n      .bounce {\n        animation-name: bounce;\n        animation-duration:0.6s;\n        animation-iteration-count:infinite;\n        animation-timing-function:linear;\n      }\n\n      @keyframes bounce {\n        0% { \n          transform: translateY(0px) \n        }\n        50% {\n          transform: translateY(2px)\n        }\n        100%{\n          transform: translateY(4px)\n        }\n      }\n    "])),!e&&n,t,p,i.polished.rgba(f,.5))}),[p,f,t,e])}(x,E,S),B=i.React.useCallback((function(e){if(e){var t=e.scrollable,n=e.bottoming;U(n),N(t)}}),[]);d((function(){if(m&&j){var e=i.expressionUtils.getSingleStringExpressionText(m);M(e)}}),[m,j]);var V=p();return Object(i.jsx)("div",s({css:z,title:R,onMouseEnter:function(){var e,t;V.current&&(clearTimeout(V.current),V.current=null);var n,o=(n=null!==(t=null===(e=y.current)||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0)<=80?"0px":n<=140?"24px":"15%";F("0px"!==o),_((function(e){return e+1})),I(o)},onMouseLeave:function(){V.current=setTimeout((function(){F(!1),V.current=null}),500)},ref:y},w),Object(i.jsx)(a.Scrollable,{ref:B,version:W},Object(i.jsx)(a.RichTextDisplayer,{widgetId:h,repeatedDataSource:g,useDataSources:v,value:n,placeholder:b})),L&&C&&!P&&Object(i.jsx)("div",{className:"text-fade text-fade-bottom"},Object(i.jsx)("span",{className:"arrow arrow-bottom rounded-circle mr-1"},Object(i.jsx)(a.Icon,{className:"bounce",icon:f,size:13,color:null===(t=null==S?void 0:S.colors)||void 0===t?void 0:t.black}))),!j&&m&&Object(i.jsx)(i.ExpressionResolverComponent,{useDataSources:v,expression:m,widgetId:h,onChange:function(e){(null==e?void 0:e.isSuccessful)&&M(e.value)}}))}var g,v={_widgetLabel:"Text",placeholder:"Double click to edit text"},h=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},x=i.ReactRedux.useSelector,m=i.ReactRedux.useDispatch,w=i.React.useState,S=i.React.useMemo,y=i.React.useEffect,j=i.React.useRef;!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(g||(g={}));var O,R=function(e,t){return e===v.placeholder&&(e=function(e,t){return t?t.formatMessage({id:e,defaultMessage:v[e]}):""}("placeholder",t)),e},M=Object(i.css)(O||(O=h(["\n  /* Ensure that the cursor can be displayed when automatic width of layout */\n  min-width: 12px;\n"],["\n  /* Ensure that the cursor can be displayed when automatic width of layout */\n  min-width: 12px;\n"])));t.default=function(e){var t,n=e.builderSupportModules,o=e.id,r=e.intl,u=e.useDataSources,s=e.repeatedDataSource,l=e.useDataSourcesEnabled,c=e.isInlineEditing,d=e.config,p=m(),f=j(Object(i.getAppStore)().getState().appContext.isInBuilder).current,v=a.hooks.useWidgetSelected(o),h=a.hooks.useRefValue(v),O=x((function(e){return v?e.appRuntimeInfo.appMode:null})),D=null==n?void 0:n.jimuForBuilderLib.getAppConfigAction,E=null==n?void 0:n.widgetModules.Editor,I=null==n?void 0:n.widgetModules.builderUtils,k=null===(t=null==d?void 0:d.style)||void 0===t?void 0:t.wrap,P=null==d?void 0:d.text,U=null==d?void 0:d.tooltip,A=R(null==d?void 0:d.placeholder,r),C=l?u:void 0,N=w(g.Sub),T=N[0],W=N[1],_=w(null),Y=_[0],L=_[1];y((function(){var e;e=s?0===s.recordIndex?g.Main:g.Sub:g.None,W(e)}),[s]),y((function(){h.current&&O===i.AppMode.Run&&p(i.appActions.setWidgetIsInlineEditingState(o,!1))}),[h,O,p,o]),y((function(){h.current&&p(i.appActions.setWidgetIsInlineEditingState(o,!0))}),[h,p,o]),a.hooks.useUpdateEffect((function(){f&&(c||p(i.appActions.widgetStatePropChange(o,"showExpression",!1)))}),[c,p,o]);var F=S((function(){return O===i.AppMode.Design&&v&&T!==g.Sub}),[O,T,v]),z=j(!1);y((function(){return function(){z.current=!0}}),[]),a.hooks.useUpdateEffect((function(){var e=a.richTextUtils.getAllExpressions(P);e=(e=e||Object(i.Immutable)({})).merge(U?{tooltip:U}:{}),L(e)}),[P,U]);var B=a.hooks.useEventCallback((function(){if(!z.current&&f&&C){var e=i.expressionUtils.whetherHasFieldsInUseDataSources(C),t=I.getExpressionParts(Y);if(e||(null==t?void 0:t.length)){var n=i.expressionUtils.getUseDataSourceFromExpParts(t,C),r=i.expressionUtils.getUseDataSourcesWithoutFields(C);n=i.expressionUtils.mergeUseDataSources(r,n),D().editWidget({id:o,useDataSources:n}).exec()}}}));return a.hooks.useUpdateEffect((function(){B()}),[Y,B]),Object(i.jsx)("div",{"data-testid":"text-widget",css:M,className:Object(i.classNames)("widget-text jimu-widget p-1")},F&&Object(i.jsx)(E,{widgetId:o,nowrap:!k,useDataSources:C,enabled:!!c,onCreate:function(e){i.MutableStoreManager.getInstance().updateStateValue(o,"editor",e)},onDestory:function(){i.MutableStoreManager.getInstance().updateStateValue(o,"editor",null)},onChange:function(e,t){z.current||f&&D().editWidget({id:o,config:d.set("text",e).set("placeholder",t)}).exec()},placeholder:A,preserveWhitespace:!0,value:P}),!F&&Object(i.jsx)(b,{value:P,tooltip:U,wrap:k,placeholder:A,useDataSources:C,widgetId:o,repeatedDataSource:s}))}}}))}}}));