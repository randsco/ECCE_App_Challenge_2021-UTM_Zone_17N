System.register(["jimu-core","jimu-ui","jimu-ui/basic/sql-expression-runtime"],(function(e){var n,t,i;return{setters:[function(e){n=e},function(e){t=e},function(e){i=e}],execute:function(){e(function(e){var n={};function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(n){return e[n]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=378)}({0:function(e,t){e.exports=n},1:function(e,n){e.exports=t},220:function(e,n){e.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.342 0h14.817c.74 0 1.341.611 1.341 1.365 0 .278-.083.549-.239.777l-5.4 6.1a1.38 1.38 0 00-.234.665l-.74 9.236a1.36 1.36 0 01-.928 1.188l-1.846.603a1.337 1.337 0 01-1.687-.882 1.387 1.387 0 01-.063-.347l-.5-9.775a1.381 1.381 0 00-.236-.707l-5.388-6.08a1.38 1.38 0 01.339-1.9C1.802.085 2.068 0 2.342 0zM7.73 7.446c.283.417.447.906.473 1.413l.5 9.776 1.846-.603.741-9.236c.039-.478.2-.938.468-1.332l5.4-6.099H2.343L7.73 7.446z" fill="#FFF" fill-rule="nonzero"></path></svg>'},26:function(e,n,t){"use strict";var i,r;t.d(n,"a",(function(){return i})),t.d(n,"b",(function(){return r})),function(e){e.Block="BLOCK",e.Inline="INLINE",e.Popper="POPPER"}(i||(i={})),function(e){e.Toggle="TOGGLE",e.Button="BUTTON"}(r||(r={}))},37:function(e,n){e.exports=i},378:function(e,n,t){"use strict";t.r(n);var i,r=t(0),s=t(26),o=t(1),l=t(37),p=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e};function a(e){var n=Object(r.getAppStore)().getState().appContext.isRTL;return Object(r.css)(i||(i=p(["\n    overflow: auto;\n\n    .filter-item {\n      padding-bottom: 0.5rem;\n\n      &.filter-item-popper{\n        margin: 0.5rem;\n        min-width: ",";\n        max-width: ",";\n      }\n\n      .filter-item-inline {\n        padding-bottom: 0.5rem;\n        padding-top: 0.5rem;\n\n        .filter-item-arrow{\n          transform: rotate(","deg);\n        }\n        .filter-item-icon{\n          margin-right: 0.5rem;\n\n          &.no-arrow{\n            margin-left: 0.5rem;\n          }\n        }\n        .filter-item-name{\n          font-size: ",";\n          color: ",";\n          word-break: break-all;\n          &.no-icons{\n            margin-left: 0.5rem;\n          }\n          &.toggle-name{\n            white-space: nowrap;\n            margin-right: 0.5rem;\n          }\n        }\n\n        /* sql-expression-styles - start */\n        .sql-expression-inline{\n          align-items: center;\n\n          &.sql-expression-wrap{\n            display: block !important;\n\n            .sql-expression-builder{\n              overflow-x: hidden;\n              .sql-expression-container{\n                flex-wrap: wrap;\n                align-content: flex-start;\n\n                .sql-expression-set{\n                  flex-wrap: wrap;\n                }\n              }\n            }\n\n          }\n\n          .sql-expression-builder{\n            overflow-x: auto;\n            .sql-expression-container{\n              display: flex;\n              .sql-expression-single{\n                margin-right: 0.5rem;\n                &:last-of-type{\n                  margin-right: 0;\n                }\n                /* .clause-inline{\n                  min-width: ",";\n                }\n                .clause-block{\n                  .sql-expression-input{\n                    min-width: ",";\n                  }\n                }\n                .sql-expression-displaylabel{\n                  min-width: ",";\n                } */\n              }\n              .sql-expression-set{\n                display: flex;\n              }\n            }\n          }\n\n        }\n        /* sql-expression-styles - end */\n\n      }\n    }\n\n    .filter-item:last-child{\n      padding-bottom: 0 !important;\n    }\n\n    &.filter-items-inline{\n      display: flex;\n      .sql-expression-builder .sql-expression-container .sql-expression-single .sql-expression-input .pill-btn-container{\n        flex-wrap: nowrap;\n        .pill-btn{\n          overflow: visible;\n        }\n      }\n\n      &.filter-items-wrap{\n        flex-wrap: wrap;\n        align-content: flex-start;\n\n        .sql-expression-builder .sql-expression-container .sql-expression-single .sql-expression-input .pill-btn-container{\n          flex-wrap: wrap;\n        }\n      }\n      .filter-item{\n        /* padding: 0; */\n        &.filter-item-popper{\n          min-width: 300px;\n          padding-bottom: 0.5rem;\n          .filter-item-inline {\n            padding-bottom: 0.5rem;\n            padding-top: 0.5rem;\n          }\n        }\n        .filter-item-inline{\n          padding: 0;\n          /* height: 100%; */\n          overflow-y: auto;\n          background-color: unset !important;\n          border: none !important;\n\n          .filter-expanded-container{\n            width: ",";\n            padding-top: 0.5rem;\n          }\n\n          /* .filter-item-clause-pill{\n            margin: 10px 5px;\n            white-space: nowrap;\n          } */\n\n          /* .filter-popper-container{ */\n            .filter-item-pill{\n              margin: 10px 4px;\n              white-space: nowrap;\n\n              .sql-expression-single{\n                margin: 0;\n              }\n\n              &.filter-item-toggle-pill{\n                /* &:hover{\n                  background-color: ",";\n                } */\n                display: flex;\n                flex-direction: row;\n                height: 32px;\n                align-items: center;\n                padding: 0 0.5rem;\n              }\n            /* } */\n            /* .pill-display-label{\n              white-space: nowrap;\n              text-overflow: ellipsis;\n              overflow: hidden;\n            } */\n          }\n\n          /*input editor width*/\n          .sql-expression-builder{\n            .sql-expression-container{\n              .sql-expression-single{\n                .clause-inline{\n                  .sql-expression-label{\n                    margin-right: 0.5rem;\n                    width: auto;\n                    overflow: visible;\n                  }\n                  .sql-expression-input{\n                    width: auto;\n                  }\n\n                }\n                /* .clause-block{ */\n                  .sql-expression-input{\n                    min-width: ",";\n                    .double-number-picker{\n                      min-width: ",";\n                    }\n                    .double-datetime-picker{\n                      min-width: ",";\n                    }\n                  }\n                /* } */\n                .sql-expression-displaylabel{\n                  white-space: nowrap;\n                  padding-right: 0.5rem;\n                  font-size: 13px;\n                }\n              }\n            }\n          }\n\n        }\n      }\n    }\n\n    &.filter-items-popup{\n      min-width: ",";\n      max-width: ",";\n    }\n\n    .apply-cancel-group{\n      white-space: nowrap;\n      overflow: visible;\n    }\n  "],["\n    overflow: auto;\n\n    .filter-item {\n      padding-bottom: 0.5rem;\n\n      &.filter-item-popper{\n        margin: 0.5rem;\n        min-width: ",";\n        max-width: ",";\n      }\n\n      .filter-item-inline {\n        padding-bottom: 0.5rem;\n        padding-top: 0.5rem;\n\n        .filter-item-arrow{\n          transform: rotate(","deg);\n        }\n        .filter-item-icon{\n          margin-right: 0.5rem;\n\n          &.no-arrow{\n            margin-left: 0.5rem;\n          }\n        }\n        .filter-item-name{\n          font-size: ",";\n          color: ",";\n          word-break: break-all;\n          &.no-icons{\n            margin-left: 0.5rem;\n          }\n          &.toggle-name{\n            white-space: nowrap;\n            margin-right: 0.5rem;\n          }\n        }\n\n        /* sql-expression-styles - start */\n        .sql-expression-inline{\n          align-items: center;\n\n          &.sql-expression-wrap{\n            display: block !important;\n\n            .sql-expression-builder{\n              overflow-x: hidden;\n              .sql-expression-container{\n                flex-wrap: wrap;\n                align-content: flex-start;\n\n                .sql-expression-set{\n                  flex-wrap: wrap;\n                }\n              }\n            }\n\n          }\n\n          .sql-expression-builder{\n            overflow-x: auto;\n            .sql-expression-container{\n              display: flex;\n              .sql-expression-single{\n                margin-right: 0.5rem;\n                &:last-of-type{\n                  margin-right: 0;\n                }\n                /* .clause-inline{\n                  min-width: ",";\n                }\n                .clause-block{\n                  .sql-expression-input{\n                    min-width: ",";\n                  }\n                }\n                .sql-expression-displaylabel{\n                  min-width: ",";\n                } */\n              }\n              .sql-expression-set{\n                display: flex;\n              }\n            }\n          }\n\n        }\n        /* sql-expression-styles - end */\n\n      }\n    }\n\n    .filter-item:last-child{\n      padding-bottom: 0 !important;\n    }\n\n    &.filter-items-inline{\n      display: flex;\n      .sql-expression-builder .sql-expression-container .sql-expression-single .sql-expression-input .pill-btn-container{\n        flex-wrap: nowrap;\n        .pill-btn{\n          overflow: visible;\n        }\n      }\n\n      &.filter-items-wrap{\n        flex-wrap: wrap;\n        align-content: flex-start;\n\n        .sql-expression-builder .sql-expression-container .sql-expression-single .sql-expression-input .pill-btn-container{\n          flex-wrap: wrap;\n        }\n      }\n      .filter-item{\n        /* padding: 0; */\n        &.filter-item-popper{\n          min-width: 300px;\n          padding-bottom: 0.5rem;\n          .filter-item-inline {\n            padding-bottom: 0.5rem;\n            padding-top: 0.5rem;\n          }\n        }\n        .filter-item-inline{\n          padding: 0;\n          /* height: 100%; */\n          overflow-y: auto;\n          background-color: unset !important;\n          border: none !important;\n\n          .filter-expanded-container{\n            width: ",";\n            padding-top: 0.5rem;\n          }\n\n          /* .filter-item-clause-pill{\n            margin: 10px 5px;\n            white-space: nowrap;\n          } */\n\n          /* .filter-popper-container{ */\n            .filter-item-pill{\n              margin: 10px 4px;\n              white-space: nowrap;\n\n              .sql-expression-single{\n                margin: 0;\n              }\n\n              &.filter-item-toggle-pill{\n                /* &:hover{\n                  background-color: ",";\n                } */\n                display: flex;\n                flex-direction: row;\n                height: 32px;\n                align-items: center;\n                padding: 0 0.5rem;\n              }\n            /* } */\n            /* .pill-display-label{\n              white-space: nowrap;\n              text-overflow: ellipsis;\n              overflow: hidden;\n            } */\n          }\n\n          /*input editor width*/\n          .sql-expression-builder{\n            .sql-expression-container{\n              .sql-expression-single{\n                .clause-inline{\n                  .sql-expression-label{\n                    margin-right: 0.5rem;\n                    width: auto;\n                    overflow: visible;\n                  }\n                  .sql-expression-input{\n                    width: auto;\n                  }\n\n                }\n                /* .clause-block{ */\n                  .sql-expression-input{\n                    min-width: ",";\n                    .double-number-picker{\n                      min-width: ",";\n                    }\n                    .double-datetime-picker{\n                      min-width: ",";\n                    }\n                  }\n                /* } */\n                .sql-expression-displaylabel{\n                  white-space: nowrap;\n                  padding-right: 0.5rem;\n                  font-size: 13px;\n                }\n              }\n            }\n          }\n\n        }\n      }\n    }\n\n    &.filter-items-popup{\n      min-width: ",";\n      max-width: ",";\n    }\n\n    .apply-cancel-group{\n      white-space: nowrap;\n      overflow: visible;\n    }\n  "])),"300px","350px",n?90:270,r.polished.rem(13),e.colors.black,"200px","200px","200px","300px",e.colors.palette.light[100],"200px","300px","350px","300px","350px")}function c(e){var n=0;return e&&e.parts.some((function(e){e.type===r.ClauseType.Single&&e.displayType!==r.ClauseDisplayType.None?n++:e.type===r.ClauseType.Set&&e.parts.some((function(e){e.displayType!==r.ClauseDisplayType.None&&n++}))})),n}function u(e){var n=0;return e&&e.parts.some((function(e){e.type===r.ClauseType.Single?n++:e.type===r.ClauseType.Set&&e.parts.some((function(e){n++}))})),n}var d,g=(d=function(e,n){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)},function(e,n){function t(){this.constructor=e}d(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),f=t(81),m=[{name:"preventOverflow",options:{altAxis:!0}}],x=function(e){function n(n){var t=e.call(this,n)||this;return t.getAppliedState=function(){var e=t.props.config.autoApplyWhenWidgetOpen;return t.props.omitInternalStyle&&1===t.endUserClausesNum&&1===t.clausesNumConfigured&&(e=!0),e},t.oncollapsedChange=function(){t.setState({collapsed:!t.state.collapsed})},t.onApplyChange=function(e){t.setState({sqlChanged:!1}),t.props.onChange(t.props.id,t.props.selectedDs,t.state.sqlExprObj,e)},t.onToggleChange=function(e){t.setState({applied:e}),t.onApplyChange(e)},t.onPillClick=function(e,n){if(e)t.onTogglePopper();else{var i=n.className.indexOf("active")<0;t.onToggleChange(!!i)}},t.onSqlExpressionChange=function(e){var n;t.setState({sqlExprObj:e,sqlChanged:t.props.triggerType===s.b.Button&&!t.props.omitInternalStyle&&(null===(n=t.props.config.sqlExprObj)||void 0===n?void 0:n.sql)!==(null==e?void 0:e.sql)}),(t.props.triggerType===s.b.Toggle||t.props.omitInternalStyle)&&t.props.onChange(t.props.id,t.props.selectedDs,e,t.state.applied)},t.onTogglePopper=function(){t.setState({isOpen:!t.state.isOpen})},t.getFilterItem=function(e,n){void 0===n&&(n=!1);var i=t.props.config,l=i.icon,p=i.name;return Object(r.jsx)("div",{className:"h-100"},Object(r.jsx)("div",{className:Object(r.classNames)("d-flex justify-content-between w-100 pr-2 align-items-center",n?"flex-row-reverse":"")},!n&&e&&Object(r.jsx)(o.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t.oncollapsedChange},Object(r.jsx)(o.Icon,{className:t.state.collapsed?"filter-item-arrow":"",icon:f,size:8})),!n&&l&&Object(r.jsx)("div",{className:Object(r.classNames)("filter-item-icon",e?"":"no-arrow")},Object(r.jsx)(o.Icon,{icon:l.svg,size:l.properties.size})),!n&&Object(r.jsx)("div",{className:Object(r.classNames)("filter-item-name flex-grow-1",e||l?"":"no-icons")},p),t.props.triggerType===s.b.Toggle&&Object(r.jsx)("div",{className:"ml-1"},t.getToggle())),t.state.sqlExprObj&&Object(r.jsx)("div",{style:{display:t.state.collapsed?"none":"block"},className:Object(r.classNames)("w-100 pl-5 pr-5",t.props.arrangeType===s.a.Inline&&1===t.props.filterNum&&t.props.omitInternalStyle?"sql-expression-inline":"",t.props.arrangeType===s.a.Inline&&1===t.props.filterNum&&t.props.wrap?"sql-expression-wrap":"")},t.getSqlExpression()),t.props.triggerType===s.b.Button&&Object(r.jsx)("div",{className:"d-flex justify-content-end pl-4 pr-4 pb-2"},t.getApplyButtons()))},t.getToggle=function(){return Object(r.jsx)(o.Switch,{checked:t.state.applied,onChange:function(e){return t.onToggleChange(e.target.checked)}})},t.getApplyButtons=function(){return Object(r.jsx)("div",{className:"w-100 d-flex justify-content-end apply-cancel-group"},Object(r.jsx)(o.Button,{type:"primary",className:"filter-apply-button wrap",disabled:!(!t.state.applied||t.state.sqlChanged),onClick:function(){return t.onApplyChange(!0)}},t.props.intl.formatMessage({id:"apply",defaultMessage:r.defaultMessages.apply})),Object(r.jsx)(o.Button,{type:"default",className:"filter-cancel-button ml-2",disabled:!t.state.applied,onClick:function(){return t.onApplyChange(!1)}},t.props.intl.formatMessage({id:"clear",defaultMessage:o.defaultMessages.clear})))},t.getTriggerNodeForClauses=function(e){void 0===e&&(e=t.props.triggerType);var n=null;switch(e){case s.b.Toggle:n=t.getToggle();break;case s.b.Button:n=t.getApplyButtons()}return n},t.getSqlExpression=function(){return Object(r.jsx)(l.SqlExpressionRuntime,{widgetId:t.props.widgetId,dataSource:t.props.selectedDs,expression:t.state.sqlExprObj,onChange:t.onSqlExpressionChange})},t.getTirggerNodeForWrapClauses=function(e){return e===t.props.triggerType&&t.isSingleFilterAndMultipleClauses()&&t.props.wrap&&Object(r.jsx)("div",{className:"d-flex flex-row-reverse"},t.getTriggerNodeForClauses(e))},t.getTriggerNodeForNoWrapClause=function(){return t.isSingleFilterAndMultipleClauses()&&!t.props.wrap&&Object(r.jsx)("div",{className:"ml-3 mr-3"},t.getTriggerNodeForClauses())},t.endUserClausesNum=c(t.props.config.sqlExprObj),t.clausesNumConfigured=u(t.props.config.sqlExprObj),t.state={isOpen:!1,applied:t.getAppliedState(),collapsed:t.props.config.collapseFilterExprs,sqlExprObj:t.props.config.sqlExprObj,sqlChanged:!1},t}return g(n,e),n.prototype.componentDidUpdate=function(e){this.endUserClausesNum=c(this.props.config.sqlExprObj),this.clausesNumConfigured=u(this.props.config.sqlExprObj),e.config!==this.props.config?this.setState({applied:this.getAppliedState(),collapsed:this.props.config.collapseFilterExprs,sqlExprObj:this.props.config.sqlExprObj}):e.logicalOperator===this.props.logicalOperator&&e.omitInternalStyle===this.props.omitInternalStyle||this.setState({applied:this.getAppliedState()})},n.prototype.componentWillUnmount=function(){this.state.applied&&this.props.onChange(this.props.id,this.props.selectedDs,null,!0)},n.prototype.isSingleFilterAndMultipleClauses=function(){return 1===this.props.filterNum&&this.clausesNumConfigured>1&&this.endUserClausesNum>=1},n.prototype.isSingleFilterAndSingleShownClause=function(){return 1===this.props.filterNum&&1===this.clausesNumConfigured&&1===this.endUserClausesNum},n.prototype.isMultipleFiltersAndSingleShownClause=function(){return this.props.filterNum>1&&1===this.clausesNumConfigured&&1===this.endUserClausesNum},n.prototype.render=function(){var e=this,n=this.props.config,t=n.name,i=n.icon;return Object(r.jsx)("div",{className:"filter-item"},Object(r.jsx)(o.Card,{className:"filter-item-inline"},this.props.arrangeType===s.a.Block?Object(r.jsx)("div",{className:"w-100"},this.props.omitInternalStyle&&(this.isSingleFilterAndSingleShownClause()||this.isMultipleFiltersAndSingleShownClause())?Object(r.jsx)("div",{className:"w-100 pl-5 pr-5"},this.getSqlExpression()):Object(r.jsx)("div",{className:"filter-expanded-container"},this.getFilterItem(this.endUserClausesNum>=1))):Object(r.jsx)(r.React.Fragment,null,this.isSingleFilterAndSingleShownClause()?Object(r.jsx)("div",{className:"sql-expression-inline d-flex"},this.getSqlExpression(),!this.props.omitInternalStyle&&Object(r.jsx)("div",{className:"ml-3 mr-3"},this.getTriggerNodeForClauses())):Object(r.jsx)(r.React.Fragment,null,this.isSingleFilterAndMultipleClauses()||this.isMultipleFiltersAndSingleShownClause()&&this.props.omitInternalStyle?Object(r.jsx)("div",{className:Object(r.classNames)("sql-expression-inline d-flex",{"sql-expression-wrap":this.props.wrap,"filter-item-pill":this.isMultipleFiltersAndSingleShownClause()})},this.getTirggerNodeForWrapClauses(s.b.Toggle),this.getSqlExpression(),this.getTirggerNodeForWrapClauses(s.b.Button),this.getTriggerNodeForNoWrapClause()):Object(r.jsx)("div",{className:"filter-popper-container"},this.props.triggerType===s.b.Toggle&&0===this.endUserClausesNum?Object(r.jsx)(o.Card,{className:"filter-item-pill filter-item-toggle-pill"},i&&Object(r.jsx)(o.Icon,{icon:i.svg,size:i.properties.size,className:"mr-1"}),Object(r.jsx)("div",{className:"filter-item-name toggle-name"},t),this.getToggle()):Object(r.jsx)(o.Button,{className:Object(r.classNames)("filter-item-pill h-100 nowrap",{"frame-active":this.state.applied}),title:t,ref:function(n){return e.pillButton=n},type:"default",onClick:function(n){return e.onPillClick(e.endUserClausesNum>=1,e.pillButton)}},i&&Object(r.jsx)(o.Icon,{icon:i.svg,size:i.properties.size}),t),this.endUserClausesNum>=1&&Object(r.jsx)(o.Popper,{open:this.state.isOpen,toggle:this.onTogglePopper,modifiers:m,showArrow:!0,reference:this.pillButton},Object(r.jsx)("div",{css:a(this.props.theme)},Object(r.jsx)("div",{className:"filter-item filter-item-popper overflow-auto",style:{maxHeight:"calc(100vh - 20px)"}},Object(r.jsx)(o.Card,{className:"filter-item-inline"},this.getFilterItem(this.endUserClausesNum>=1,this.props.arrangeType!==s.a.Popper))))))))))},n}(r.React.PureComponent),h=function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function i(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),b=function(e){var n=[],t=r.DataSourceManager.getInstance();return e&&e.map((function(e){e.sqlExprObj&&n.push(t.createDataSourceByUseDataSource(Object.assign({},e.dataSource,{mainDataSourceId:e.dataSource.dataSourceId})))})),Promise.all(n)},w=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.versions=[{version:"1.1.0",description:"",upgrader:function(e){return b(e.filterItems).then((function(n){var t=e;t=(t=(t=(t=t.set("arrangeType",s.a.Block)).set("triggerType",s.b.Toggle)).set("wrap",!1)).set("omitInternalStyle",!1);var i=n.map((function(e,n){var i=t.filterItems[n];return Object.assign({},i,{sqlExprObj:i.sqlExprObj?Object(l.updateSQLExpressionByVersion)(i.sqlExprObj,"1.1.0",e):null,icon:i.icon.setIn(["properties","color"],null),useDataSource:Object.assign({},i.dataSource,{mainDataSourceId:i.dataSource.dataSourceId})})}));return t=t.set("filterItems",i)}))}}],n}return h(n,e),n}(r.BaseVersionManager)),y="Filter",j=function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function i(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),O=t(220),v=[Object(o.getCustomFlipModifier)({fallbackPlacements:["top","left","right"],useClosestVerticalPlacement:!0}),o.maxSizeModifier,o.applyMaxSizeModifier],S=function(e){function n(n){var t=e.call(this,n)||this;return t.dataSources={},t.setSqlToAllDs=function(){Object.keys(t.dataSources).map((function(e){var n=t.getQuerySqlFromDs(t.dataSources[e]);t.setSqlToDs(t.dataSources[e],n)}))},t.onFilterItemChange=function(e,n,i,s){if(!t.__unmount)if(t.state.filterItems[e]||!s){var o=t.state.filterItems.asMutable({deep:!0}),l=!1!==s||!1!==o[e].autoApplyWhenWidgetOpen,p=Object.assign({},o[e],{sqlExprObj:i,autoApplyWhenWidgetOpen:s});o.splice(e,1,p);var a=Object(r.Immutable)(o);if(t.setState({filterItems:a}),l){var c=t.getQuerySqlFromDs(n,a);t.setSqlToDs(n,c)}}else t.setSqlToDs(n,"")},t.setSqlToDs=function(e,n){var i,r;null===(r=(i=e).updateQueryParams)||void 0===r||r.call(i,{where:n},t.props.id)},t.getQuerySqlFromDs=function(e,n){void 0===n&&(n=t.props.config.filterItems);var i=[];n.map((function(n){if(n.useDataSource.dataSourceId===e.id&&(n.autoApplyWhenWidgetOpen||t.props.config.omitInternalStyle&&1===c(n.sqlExprObj))){var s=r.dataSourceUtils.getArcGISSQL(n.sqlExprObj,e).sql;s&&i.push(s)}}));var s="";return i.length&&(s=1===i.length?i[0]:"("+i.join(") "+t.props.config.logicalOperator+" (")+")"),s},t.getDataSourceById=function(e){var n=t.props.useDataSources.asMutable({deep:!0}).filter((function(n){return n.dataSourceId===e}));return Object(r.Immutable)(n[0])},t.getFilterItems=function(e,n,i,o){return void 0===n&&(n=s.a.Block),void 0===i&&(i=!1),void 0===o&&(o=!1),Object(r.jsx)("div",{className:Object(r.classNames)("w-100 h-100",n&&e.arrangeType===s.a.Inline?"filter-items-inline":"",i?"filter-items-wrap":"",o?"filter-items-popup":""),css:a(t.props.theme)},t.state.filterItems.map((function(s,o){var l=t.dataSources[s.useDataSource.dataSourceId];return l&&Object(r.jsx)(x,{key:o,id:o,widgetId:t.props.id,intl:t.props.intl,selectedDs:l,logicalOperator:e.logicalOperator,config:s,arrangeType:n,triggerType:e.triggerType,wrap:i,omitInternalStyle:e.omitInternalStyle,filterNum:t.state.filterItems.length,onChange:t.onFilterItemChange,itemBgColor:t.props.theme.colors.palette.light[300],theme:t.props.theme})})))},t.onShowPopper=function(){t.setState({isOpen:!t.state.isOpen,popperVersion:t.state.isOpen?t.state.popperVersion:t.state.popperVersion+1})},t.onTogglePopper=function(){t.setState({isOpen:!1})},t.checkIfAnyFiltersApplied=function(){var e,n=t.props.config.omitInternalStyle;return((null===(e=t.state)||void 0===e?void 0:e.filterItems)||t.props.config.filterItems).some((function(e){return n&&1===u(e.sqlExprObj)&&1===c(e.sqlExprObj)?""!==(t.dataSources[e.useDataSource.dataSourceId]?r.dataSourceUtils.getArcGISSQL(e.sqlExprObj,t.dataSources[e.useDataSource.dataSourceId]).sql:e.sqlExprObj.sql):e.autoApplyWhenWidgetOpen}))},t.__unmount=!1,t.index=0,t._autoApplyInit=!0,t.state={popperVersion:1,isOpen:!1,filterItems:t.props.config.filterItems},t}return j(n,e),n.prototype.componentWillUnmount=function(){var e=this;this.__unmount=!0,Object.keys(this.dataSources).map((function(n){e.dataSources[n].updateQueryParams(null,e.props.id)}))},n.prototype.componentDidUpdate=function(e,n){this.__unmount||(this._autoApplyInit=!1,e.config!==this.props.config&&(this.setState({filterItems:this.props.config.filterItems}),this.setSqlToAllDs()))},n.prototype.render=function(){var e=this,n=this.props,t=n.config,i=n.icon;return 0===this.state.filterItems.length?Object(r.jsx)(o.WidgetPlaceholder,{icon:O,widgetId:this.props.id,message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:y})}):(this.dataSources={},Object(r.jsx)("div",{className:"jimu-widget widget-filter overflow-auto"},Object(r.jsx)(r.MultipleDataSourceComponent,{useDataSources:this.props.useDataSources,widgetId:this.props.id,localId:"local"},(function(n){return n&&Object.keys(n).map((function(t){var i=n[t];i&&(e.dataSources[i.id]=i,e._autoApplyInit&&Object.keys(e.dataSources).map((function(){return!0})).length===e.props.useDataSources.length&&(e._autoApplyInit=!1,e.setSqlToAllDs()))})),Object(r.jsx)(r.React.Fragment,null,t.arrangeType===s.a.Popper?Object(r.jsx)("div",{className:"filter-widget-popper"},Object(r.jsx)(o.Badge,{dot:!0,className:"m-1",title:name,hideBadge:!e.checkIfAnyFiltersApplied(),color:"primary"},Object(r.jsx)(o.Button,{icon:!0,size:"sm",className:"filter-widget-pill h-100",ref:function(n){return e.widgetIconRef=n},type:"tertiary",onClick:e.onShowPopper},Object(r.jsx)(o.Icon,{icon:"string"==typeof i?i:i.svg,size:16,color:"string"==typeof i?"":i.properties.color}))),e.state.popperVersion>1&&Object(r.jsx)(o.Popper,{open:e.state.isOpen,version:e.state.popperVersion,keepMount:!0,toggle:e.onTogglePopper,showArrow:!0,modifiers:v,reference:e.widgetIconRef},Object(r.jsx)("div",{className:"p-2"},e.getFilterItems(t,s.a.Block,!1,!0)))):Object(r.jsx)("div",{className:"w-100 h-100"},e.getFilterItems(t,t.arrangeType,t.wrap)))}))))},n.versionManager=w,n}(r.React.PureComponent);n.default=S},81:function(e,n){e.exports='<svg viewBox="0 0 9 5" xmlns="http://www.w3.org/2000/svg"><path d="M4.128 4.587L.751.834A.5.5 0 011.123 0h6.754a.5.5 0 01.372.834L4.872 4.587a.5.5 0 01-.744 0z" fill="#000" fill-rule="evenodd"></path></svg>'}}))}}}));