System.register(["jimu-core","jimu-ui","jimu-arcgis"],(function(t){var e,n,r;return{setters:[function(t){e=t},function(t){n=t},function(t){r=t}],execute:function(){t(function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=377)}({0:function(t,n){t.exports=e},1:function(t,e){t.exports=n},164:function(t,e){t.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M18 0a2 2 0 012 2v16a2 2 0 01-2 2H2a2 2 0 01-2-2V2a2 2 0 012-2h16zm0 1H2a1 1 0 00-1 1v16a1 1 0 001 1h16a1 1 0 001-1V2a1 1 0 00-1-1zM6 14v3l-2-1.5L6 14zm8 0l2 1.5-2 1.5v-3zm2.5-4a.5.5 0 110 1h-8a.5.5 0 110-1h8zm-11 0a.5.5 0 110 1h-2a.5.5 0 110-1h2zm8-3a.5.5 0 110 1h-5a.5.5 0 110-1h5zm-8 0a.5.5 0 110 1h-1a.5.5 0 110-1h1zm11-3a.5.5 0 110 1h-8a.5.5 0 110-1h8zm-11 0a.5.5 0 110 1h-2a.5.5 0 110-1h2z" fill="#000" fill-rule="nonzero"></path></svg>'},377:function(t,e,n){"use strict";n.r(e),n.d(e,"LoadStatus",(function(){return g}));var r,a=n(0),o=n(1),i=n(40),u=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t};var s,c,d="Feature Info",l="No data found.",p="{index} of {count}",f=n(4),h=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(c||(c={}));var g,y=function(t){function e(e){var n=t.call(this,e)||this;return n.state={loadStatus:c.Pending},n}return h(e,t),e.prototype.componentDidMount=function(){this.createFeature()},e.prototype.componentDidUpdate=function(){if(this.feature){this.feature.graphic=this.props.graphic||{popupTemplate:{content:""}},this.feature.visibleElements=this.props.visibleElements}},e.prototype.destoryFeature=function(){this.feature&&!this.feature.destroyed&&this.feature.destroy()},e.prototype.createFeature=function(){var t=this;return(this.Feature?Promise.resolve():Object(f.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then((function(e){t.Feature=e[0]}))).then((function(){var e,n,r=document&&document.createElement("div");r.className="jimu-widget",t.refs.featureContainer.appendChild(r);var a=t.props.dataSource.getRootDataSource();t.destoryFeature(),t.feature=new t.Feature({container:r,defaultPopupTemplateEnabled:!0,spatialReference:(null===(n=null===(e=t.props.dataSource)||void 0===e?void 0:e.layer)||void 0===n?void 0:n.spatialReference)||null,map:(null==a?void 0:a.map)||null})})).then((function(){t.setState({loadStatus:c.Fulfilled})}))},e.prototype.render=function(){return a.React.createElement("div",{className:"feature-info-component"},a.React.createElement("div",{ref:"featureContainer"}))},e}(a.React.PureComponent),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),v=function(t){function e(e){var n=t.call(this,e)||this;return n.onDataSourceCreated=function(t){n.dataSource=t,n.previousIndex=n.props.index,n.isFirstLoad=!0,n.setState({dataSourceId:n.dataSource.id})},n.onCreateDataSourceFailed=function(t){},n.onDataSourceInfoChange=function(t){if(t&&!n.isFirstLoad){n.setState({dataSourceWidgetQueries:t.widgetQueries});var e=t.selectedIds&&t.selectedIds[0];e&&n.getDataIndexByObjectId(e).then((function(t){t>-1&&t<n.dataBuffer.count&&n.props.onSelectedRecordIdChanged(t,n.dataSource.id)}))}},n.state={dataSourceId:null,dataSourceStatus:a.DataSourceStatus.Loaded,dataSourceVersion:void 0,dataSourceWidgetQueries:void 0},n.previousIndex=null,n.previousData={id:null,count:null,index:null,graphic:null,record:null,dataSourceId:null},n.dataBuffer={count:null,dataMap:{},pagingNum:30},n.isFirstLoad=!1,n}return m(e,t),e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){var t=this;if(this.props.useDataSource&&this.state.dataSourceId===this.props.useDataSource.dataSourceId&&(this.state.dataSourceStatus===a.DataSourceStatus.Loaded||this.state.dataSourceStatus===a.DataSourceStatus.Unloaded)){var e;this.props.index===this.previousIndex?(this.clearData(),e=this.props.index):(this.previousIndex=this.props.index,e=this.props.index);var n=this.getData(e);if(!n)return this.dataSource.queryCount({}).then((function(r){var a=r.count;e>=a&&(e=0),t.queryGraphics(t.dataSource,null,e,t.dataBuffer.pagingNum,a).then((function(e){0===e.graphics.length?n=null:(t.addData(e,t.dataSource.id),n=t.getData(e.index)),t.onDataChanged(t.dataSource,n)}))}));this.onDataChanged(this.dataSource,n)}},e.prototype.onDataChanged=function(t,e){var n,r,a,o;e?(null===(n=this.previousData)||void 0===n?void 0:n.dataSourceId)!==(null==e?void 0:e.dataSourceId)||(null===(r=this.previousData)||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)||(null===(a=this.previousData)||void 0===a?void 0:a.count)!==(null==e?void 0:e.count)||(null===(o=this.previousData)||void 0===o?void 0:o.index)!==(null==e?void 0:e.index)?this.props.onDataChanged(this.dataSource,e):this.props.onDataFulfilled():this.props.onDataChanged(this.dataSource,e),this.previousData=e},e.prototype.addData=function(t,e){var n=this;t.records.forEach((function(r,a){var o=t.start+a;n.dataBuffer.dataMap[o]={id:r.getId(),count:n.dataBuffer.count,index:o,graphic:t.graphics[a],record:r,dataSourceId:e}}))},e.prototype.initData=function(t){this.dataBuffer.count=t},e.prototype.getData=function(t){return this.dataBuffer.dataMap[t]},e.prototype.getDataIndexByObjectId=function(t){var e=-1;if(Object.entries(this.dataBuffer.dataMap).some((function(n){var r;return t===(null===(r=n[1])||void 0===r?void 0:r.id)&&(e=Number(n[0]),!0)})),e<0&&this.dataSource){var n=this.dataSource.getIdField();return this.dataSource.queryCount({where:n+"<="+t}).then((function(t){return e=t.count-1}))}return Promise.resolve(e)},e.prototype.clearData=function(){this.dataBuffer.count=null,this.dataBuffer.dataMap={}},e.prototype.isEmptyData=function(){return null===this.dataBuffer.count},e.prototype.getFeatureLayer=function(t,e){var n;return(n=t.layer?t.layer:t.itemId?new e({portalItem:{id:t.itemId,portal:{url:t.portalUrl}}}):new e({url:t.url})).load().then((function(){return Promise.resolve(n)}))},e.prototype.queryGraphics=function(t,e,n,r,a){var o,i=this,u=n;return this.props.onDataLoading(),Object(f.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((function(e){var n,s=e[0];return i.getFeatureLayer(t,s).then((function(e){if(n=e,i.isEmptyData()&&i.initData(a),i.isFirstLoad){var r=t.getSelectedRecordIds()[0];if(void 0!==r)return i.getDataIndexByObjectId(r).then((function(t){u=-1===t?0:t}))}})).then((function(){o=Math.floor(u/i.dataBuffer.pagingNum)*i.dataBuffer.pagingNum;var e={outFields:["*"],returnGeometry:!0,page:Math.floor(o/r)+1,pageSize:r};return t.query(e)})).then((function(e){var a,s=e.records;return a=t.layer?s.map((function(t){return t.feature})):s.map((function(t){return t.feature.sourceLayer=n,t.feature})),i.isFirstLoad=!1,{index:u,start:o,num:r,graphics:a,records:s}}))})).catch((function(t){return console.warn(t),{graphics:[],records:[]}}))},e.prototype.getOrderBy=function(t,e){var n,r=[];return e&&e.orderBy&&e.orderBy.length>0&&(e.orderBy.forEach((function(t){t.jimuFieldName&&r.push(t.jimuFieldName+" "+t.order)})),n=t.type===a.DataSourceTypes.FeatureLayer?r.join(","):r),n},e.prototype.getQueryParamsFromDataSource=function(t){return t.getRealQueryParams({},"query")},e.prototype.loadGraphics=function(t,e){var n=this;return this.props.onDataLoading(),Object(f.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/tasks/support/Query"]).then((function(r){var a,o=r[0],i=new(0,r[1]),u=t.layer,s=e&&e.where.sql;return i.where=s||"1=1",i.returnGeometry=!1,i.outFields=["*"],a=0===n.props.maxGraphics?null:n.props.maxGraphics,i.num=n.props.limitGraphics?a:null,!u&&t.url&&(u=new o({url:t.url})),u?u.queryFeatures(i).then((function(t){return t.features})):[]})).catch((function(t){return console.warn(t),[]}))},e.prototype.render=function(){return a.React.createElement(a.DataSourceComponent,{useDataSource:this.props.useDataSource,query:{},widgetId:this.props.widgetId,onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,onCreateDataSourceFailed:this.onCreateDataSourceFailed})},e}(a.React.PureComponent),S=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),D=new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.versions=[{version:"1.1.0",description:"added [styleType] and [fontSizeType]",upgrader:function(t){var e=t;return e=(e=e.set("styleType","usePopupDefined")).getIn(["style","fontSize","distance"])||e.getIn(["style","textColor"])?e.setIn(["style","fontSizeType"],"custom"):(e=e.setIn(["style","fontSizeType"],"auto")).setIn(["style","fontSize","distance"],14)}}],e}return S(e,t),e}(a.BaseVersionManager)),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=n(164);!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(g||(g={}));var x=function(t){function e(e){var n=t.call(this,e)||this;return n.onPreGraphicBtnClick=function(){var t=n.state.currentDataIndex;t>0&&n.setState({currentDataIndex:--t})},n.onNextGraphictBtnClick=function(){var t=n.state.currentDataIndex;t<n.currentData.count-1&&n.setState({currentDataIndex:++t})},n.onSelectedRecordIdChanged=function(t,e){t>-1&&n.dataSource.id===e&&n.setState({currentDataIndex:t})},n.onDataLoading=function(){n.setState({loadDataStatus:g.Pending})},n.onDataFulfilled=function(){n.setState({loadDataStatus:g.Fulfilled})},n.onDataChanged=function(t,e){n.dataSource=t,n.currentData=e,n.setState({currentDataId:n.currentData?n.currentData.id:null,currentDataIndex:n.currentData?n.currentData.index:null,loadDataStatus:g.Fulfilled}),n.selectGraphic()},n.currentData=null,n.state={currentDataId:null,currentDataIndex:0,loadDataStatus:g.Pending},n}return b(e,t),e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){this.props.useDataSources&&this.props.useDataSources[0]||(this.setState({currentDataId:null,currentDataIndex:0}),this.currentData=null)},e.prototype.handleAction=function(t){},e.prototype.selectGraphic=function(){var t,e=this,n=null===(t=this.currentData)||void 0===t?void 0:t.record;if(n&&this.dataSource){a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(this.props.id,[n]));var r=this.dataSource.getSelectedRecordIds(),o=n.getId();r.indexOf(o)<0&&this.dataSource.queryById(o).then((function(t){e.dataSource.selectRecordsByIds([o],[t])}))}},e.prototype.getStyleConfig=function(){return this.props.config.style?this.props.config.style:{textColor:"",fontSizeType:i.a.auto,fontSize:null,backgroundColor:""}},e.prototype.render=function(){var t,e=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0],n=this.props.useDataSources&&this.props.useDataSources[0];t=Object(a.jsx)(v,{useDataSource:n,widgetId:this.props.id,index:this.state.currentDataIndex,limitGraphics:this.props.config.limitGraphics,maxGraphics:this.props.config.maxGraphics,onSelectedRecordIdChanged:this.onSelectedRecordIdChanged,onDataLoading:this.onDataLoading,onDataFulfilled:this.onDataFulfilled,onDataChanged:this.onDataChanged});var s,c,f,h,m,S,D,b,x,I,j,w,z,O,C=null;if(this.props.config.useMapWidget?e:n){var M=null;this.state.loadDataStatus===g.Pending&&(M=Object(a.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"}));var P=null;if(this.currentData&&this.currentData.count>1){var F=this.props.intl.formatMessage({id:"featureNumbers",defaultMessage:p},{index:this.currentData.index+1,count:this.currentData.count});P=Object(a.jsx)("div",{className:"nav-section d-flex justify-content-center align-items-center"},Object(a.jsx)(o.Button,{className:"nav-btn",type:"tertiary",size:"sm",onClick:this.onPreGraphicBtnClick}," ","<"," "),Object(a.jsx)("span",null," ",F," "),Object(a.jsx)(o.Button,{className:"nav-btn",type:"tertiary",size:"sm",onClick:this.onNextGraphictBtnClick}," ",">"," "))}var B={title:this.props.config.title,content:{fields:this.props.config.fields,text:this.props.config.fields,media:this.props.config.media,attachments:this.props.config.attachments},lastEditedInfo:this.props.config.lastEditInfo},k=void 0;k=this.currentData&&this.dataSource?Object(a.jsx)(y,{graphic:this.currentData.graphic,visibleElements:B,dataSource:this.dataSource}):Object(a.jsx)("div",{className:"no-data-message p-4 font-weight-bold",dangerouslySetInnerHTML:{__html:this.props.config.noDataMessage||this.props.intl.formatMessage({id:"noDeataMessageDefaultText",defaultMessage:l})}}),C=Object(a.jsx)("div",{className:"widget-featureInfo"},M,P,k,Object(a.jsx)("div",{style:{position:"absolute",opacity:0},ref:"mapContainer"},"mapContainer"),Object(a.jsx)("div",{style:{position:"absolute",display:"none"}},t))}else C=Object(a.jsx)("div",{className:"widget-featureInfo"},Object(a.jsx)(o.WidgetPlaceholder,{icon:_,message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:d}),widgetId:this.props.id})),this.currentData=null;return Object(a.jsx)("div",{css:(s=this.props.theme,c=this.props.config.styleType,f=this.getStyleConfig(),b=f.backgroundColor?f.backgroundColor:s.surfaces[1].bg,x="",I="",j="",w="",z="",O="","custom"===c?(h=f.textColor?f.textColor:s.colors.black,(m=f.fontSize)&&0!==m.distance&&f.fontSizeType!==i.a.auto&&(S=m.unit,x=(D=m.distance)+S,I=Math.round(1.428*D)+S,j=Math.round(1.142*D)+S,w=D,z=Math.round(.857*D)+S,O=Math.round(.857*D)+S)):"syncWithTheme"===c?(D="",h=s.colors.black):(D="",h=""),Object(a.css)(r||(r=u(["\n    overflow: auto;\n    .widget-featureInfo{\n      width: 100%;\n      height: 100%;\n      background-color: ",";\n      color: ",";\n      font-size: ",";\n      .nav-section{\n        height: 40px;\n        border-bottom: 1px solid #a8a8a8;\n        background-color: ",";\n        .nav-btn{\n          color: ",";\n        }\n        .nav-btn: hover{\n          color: ",";\n        }\n        .nav-btn:focus{\n          box-shadow: none;\n        }\n      }\n      .feature-info-component{\n        background-color: ",";\n        padding: 0;\n        .esri-feature__size-container{\n          background-color: ",";\n          color: ",";\n        }\n        .esri-widget * {\n          font-size: ",";\n          color: ",";\n        }\n        .esri-widget {\n          background-color: transparent !important;\n        }\n        .esri-feature__title{\n          padding: 10px 15px 0 15px;\n          margin: auto;\n        }\n        .esri-feature__content-element{\n        }\n        .esri-widget__table tr td, .esri-widget__table tr th {\n          font-size: ",";\n        }\n        .esri-feature__main-container{\n        }\n        .esri-feature__media-previous:focus{\n          outline: none;\n        }\n        .esri-feature__media-next:focus{\n          outline: none;\n        }\n        .esri-feature__title {\n          font-size: ",";\n        }\n        .esri-feature h1 {\n          font-size: ",";\n        }\n        .esri-feature h2 {\n          font-size: ",";\n        }\n        .esri-feature h3,\n        .esri-feature h4,\n        .esri-feature h5,\n        .esri-feature h6 {\n          font-size: ",";\n        }\n        .esri-feature p {\n          font-size: ",";\n        }\n\n        .esri-feature figcaption {\n          font-size: ",";\n        }\n\n        .esri-feature__media-item-title {\n          font-size: ",";\n        }\n        .esri-feature__media-item-caption {\n          font-size: ",";\n        }\n        .esri-feature__last-edited-info {\n          font-size: ",";\n        }\n\n      }\n    }\n  "],["\n    overflow: auto;\n    .widget-featureInfo{\n      width: 100%;\n      height: 100%;\n      background-color: ",";\n      color: ",";\n      font-size: ",";\n      .nav-section{\n        height: 40px;\n        border-bottom: 1px solid #a8a8a8;\n        background-color: ",";\n        .nav-btn{\n          color: ",";\n        }\n        .nav-btn: hover{\n          color: ",";\n        }\n        .nav-btn:focus{\n          box-shadow: none;\n        }\n      }\n      .feature-info-component{\n        background-color: ",";\n        padding: 0;\n        .esri-feature__size-container{\n          background-color: ",";\n          color: ",";\n        }\n        .esri-widget * {\n          font-size: ",";\n          color: ",";\n        }\n        .esri-widget {\n          background-color: transparent !important;\n        }\n        .esri-feature__title{\n          padding: 10px 15px 0 15px;\n          margin: auto;\n        }\n        .esri-feature__content-element{\n        }\n        .esri-widget__table tr td, .esri-widget__table tr th {\n          font-size: ",";\n        }\n        .esri-feature__main-container{\n        }\n        .esri-feature__media-previous:focus{\n          outline: none;\n        }\n        .esri-feature__media-next:focus{\n          outline: none;\n        }\n        .esri-feature__title {\n          font-size: ",";\n        }\n        .esri-feature h1 {\n          font-size: ",";\n        }\n        .esri-feature h2 {\n          font-size: ",";\n        }\n        .esri-feature h3,\n        .esri-feature h4,\n        .esri-feature h5,\n        .esri-feature h6 {\n          font-size: ",";\n        }\n        .esri-feature p {\n          font-size: ",";\n        }\n\n        .esri-feature figcaption {\n          font-size: ",";\n        }\n\n        .esri-feature__media-item-title {\n          font-size: ",";\n        }\n        .esri-feature__media-item-caption {\n          font-size: ",";\n        }\n        .esri-feature__last-edited-info {\n          font-size: ",";\n        }\n\n      }\n    }\n  "])),b,h,x,b,s.colors.palette.primary[500],s.colors.palette.primary[600],"transparent",b,h,x,h,O,x,I,j,w,x,O,j,z,O)),className:"jimu-widget"},C)},e.versionManager=D,e}(a.React.PureComponent);e.default=x},4:function(t,e){t.exports=r},40:function(t,e,n){"use strict";var r,a;n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a})),function(t){t.syncWithTheme="syncWithTheme",t.usePopupDefined="usePopupDefined",t.custom="custom"}(r||(r={})),function(t){t.auto="auto",t.custom="custom"}(a||(a={}))}}))}}}));