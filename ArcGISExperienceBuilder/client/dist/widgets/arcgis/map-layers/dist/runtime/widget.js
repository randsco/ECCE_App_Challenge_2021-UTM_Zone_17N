System.register(["jimu-core","jimu-ui","jimu-arcgis"],(function(e){var t,i,n;return{setters:[function(e){t=e},function(e){i=e},function(e){n=e}],execute:function(){e(function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=373)}({0:function(e,i){e.exports=t},1:function(e,t){e.exports=i},176:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M16 10.05v1.104L8 15l-8-3.846V10.05l8 3.833 8-3.833zm0-3.017v1.105l-8 3.846-8-3.846V7.033l8 3.833 8-3.833zM8 1l8 3.799-8 3.799-8-3.8L8 1zm0 1.118l-5.646 2.68L8 7.48l5.646-2.681L8 2.118z" fill="#000" fill-rule="nonzero"></path></svg>'},373:function(e,t,i){"use strict";i.r(t),i.d(t,"LoadStatus",(function(){return l}));var n,r=i(0),o=i(4),s=i(1),a=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};function c(e,t){var i,o;t.setVisibility&&t.useMapWidget?(i="block",o=""):(i="none",o="unset");var s=e.surfaces[1].bg,c=e.surfaces[1].bg;return Object(r.css)(n||(n=a(["\n    overflow: auto;\n    .widget-layerlist {\n      width: 100%;\n      height: 100%;\n      /*background-color: ",";*/\n      background-color: ",";\n\n      .esri-layer-list__item-label:focus {\n        outline: ",";\n      }\n\n      .esri-layer-list__item-toggle {\n        display: ",";\n      }\n\n      .esri-layer-list {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item {\n        background-color: ",";\n      }\n\n      /* .esri-layer-list {\n        background-color: ",";\n        color: ","\n      }\n\n      .esri-layer-list__item {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item--invisible-at-scale .esri-layer-list__item-title {\n        color: ","\n      }\n\n      .esri-layer-list__child-toggle{\n        color: ","\n      }\n\n\n      .esri-layer-list__item-actions-menu-item:hover {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item-actions-menu-item--active, .esri-layer-list__item-actions-menu-item--active:hover {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item-actions {\n        background-color: ",";\n        color: ","\n      }\n\n      .esri-layer-list__item-action:hover {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item-actions-list {\n        border-color: ",";\n      } */\n    }\n  "],["\n    overflow: auto;\n    .widget-layerlist {\n      width: 100%;\n      height: 100%;\n      /*background-color: ",";*/\n      background-color: ",";\n\n      .esri-layer-list__item-label:focus {\n        outline: ",";\n      }\n\n      .esri-layer-list__item-toggle {\n        display: ",";\n      }\n\n      .esri-layer-list {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item {\n        background-color: ",";\n      }\n\n      /* .esri-layer-list {\n        background-color: ",";\n        color: ","\n      }\n\n      .esri-layer-list__item {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item--invisible-at-scale .esri-layer-list__item-title {\n        color: ","\n      }\n\n      .esri-layer-list__child-toggle{\n        color: ","\n      }\n\n\n      .esri-layer-list__item-actions-menu-item:hover {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item-actions-menu-item--active, .esri-layer-list__item-actions-menu-item--active:hover {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item-actions {\n        background-color: ",";\n        color: ","\n      }\n\n      .esri-layer-list__item-action:hover {\n        background-color: ",";\n      }\n\n      .esri-layer-list__item-actions-list {\n        border-color: ",";\n      } */\n    }\n  "])),e.arcgis.widgets.layerlist.root.bg,s,o,i,s,c,e.colors.palette.light[100],e.colors.black,e.colors.palette.light[100],e.colors.palette.light[800],e.colors.black,e.colors.palette.light[300],e.colors.palette.light[300],e.colors.palette.light[200],e.colors.black,e.colors.palette.light[300],e.colors.palette.light[500])}var u,l,p=function(){function e(){this.id="id",this.title="title",this.className="esri-icon",this.group=0,this.widget=null,this.isValid=function(e){return!1},this.execute=function(e){}}return e.prototype.hasActionWithMessage=function(e){return!1},e.prototype.useMapWidget=function(){return this.widget.props.config.useMapWidget},e}(),d=(u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),f=function(e){function t(t,i){var n=e.call(this)||this;return n.isValid=function(e){return!e.parent&&!(!n.useMapWidget()||!n.widget.props.config.goto)},n.execute=function(e){n.widget.viewFromMapWidget&&o.zoomToUtils.zoomTo(n.widget.viewFromMapWidget,e.layer,{})},n.id="goto",n.title=i,n.className="esri-icon-zoom-out-fixed",n.group=0,n.widget=t,n}return d(t,e),t}(p),y=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),h=function(e){function t(t,i,n){var r=e.call(this)||this;return r.isValid=function(e){return!e.parent&&!(!r.useMapWidget()||!r.widget.props.config.opacity)},r.execute=function(e){r.isIncreaseOpacity?e.layer.opacity<1&&(e.layer.opacity+=.25):e.layer.opacity>0&&(e.layer.opacity-=.25)},r.id=n?"increaseOpacity":"decreaseOpacity",r.title=i,r.className=n?"esri-icon-up":"esri-icon-down",r.group=1,r.widget=t,r.isIncreaseOpacity=n,r}return y(t,e),t}(p),g=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),m=function(e){function t(t,i){var n=e.call(this)||this;return n.isValid=function(e){return!(!e.layer.url||!n.widget.props.config.information)},n.execute=function(e){window.open(e.layer.url)},n.id="information",n.title=i,n.className="esri-icon-description",n.group=3,n.widget=t,n}return g(t,e),t}(p),w="Map Layers",v="Zoom to",_="Details",b="Increase opacity",S="Decrease opacity",M=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),L=i(176);!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(l||(l={}));var V=function(e){function t(t){var i=e.call(this,t)||this;return i.defineLayerListActions=function(e){var t=e.item,n={};t.actionsSections=[],i.layerListActions.forEach((function(e){if(e.isValid(t)){var i=n[e.group];i||(i=[],n[e.group]=i),i.push({id:e.id,title:e.title,className:e.className})}})),Object.entries(n).sort((function(e,t){return Number(e[0])-Number(t[0])})).forEach((function(e){e[0];var i=e[1];t.actionsSections.push(i)}))},i.onLayerListActionsTriggered=function(e){var t=e.action,n=e.item;i.layerListActions.find((function(e){return e.id===t.id})).execute(n)},i.onActiveViewChange=function(e){var t=i.props.useMapWidgetIds&&i.props.useMapWidgetIds[0];e&&e.view||!t?(i.viewFromMapWidget=e&&e.view,i.setState({mapViewWidgetId:t,viewFromMapWidgetId:e.id})):i.destoryLayerList()},i.onDataSourceCreated=function(e){i.dataSource=e,i.setState({mapDataSourceId:e.id})},i.onCreateDataSourceFailed=function(e){},i.state={mapViewWidgetId:null,mapDataSourceId:null,viewFromMapWidgetId:null,loadStatus:l.Pending},i.renderPromise=Promise.resolve(),i.registerLayerListActions(),i}return M(t,e),t.prototype.componentDidMount=function(){},t.prototype.componentDidUpdate=function(){this.props.config.useMapWidget?this.state.mapViewWidgetId===this.currentUseMapWidgetId&&this.syncRenderer(this.renderPromise):this.state.mapDataSourceId===this.currentUseDataSourceId&&this.syncRenderer(this.renderPromise)},t.prototype.createView=function(){return this.props.config.useMapWidget?Promise.resolve(this.viewFromMapWidget):this.createViewByDatatSource()},t.prototype.createViewByDatatSource=function(){var e=this;return this.loadViewModules(this.dataSource).then((function(){return e.dataSource.type===o.DataSourceTypes.WebMap?new Promise((function(t,i){return e.createWebMapView(e.MapView,t,i)})):e.dataSource.type===o.DataSourceTypes.WebScene?new Promise((function(t,i){return e.createSceneView(e.SceneView,t,i)})):Promise.reject()}))},t.prototype.createWebMapView=function(e,t,i){var n=this;if(this.mapView)this.mapView.map=this.dataSource.map;else{var r={map:this.dataSource.map,container:this.refs.mapContainer};this.mapView=new e(r)}this.mapView.when((function(){t(n.mapView)}),(function(e){return i(e)}))},t.prototype.createSceneView=function(e,t,i){var n=this;if(this.sceneView)this.sceneView.map=this.dataSource.map;else{var r={map:this.dataSource.map,container:this.refs.mapContainer};this.sceneView=new this.SceneView(r)}this.sceneView.when((function(){t(n.sceneView)}),(function(e){return i(e)}))},t.prototype.destoryView=function(){this.mapView&&!this.mapView.destroyed&&this.mapView.destroy(),this.sceneView&&!this.sceneView.destroyed&&this.sceneView.destroy()},t.prototype.loadViewModules=function(e){var t=this;return e.type===o.DataSourceTypes.WebMap?this.MapView?Promise.resolve(this.MapView):Object(o.loadArcGISJSAPIModules)(["esri/views/MapView"]).then((function(e){return t.MapView=e[0],t.MapView})):e.type===o.DataSourceTypes.WebScene?this.SceneView?Promise.resolve(this.SceneView):Object(o.loadArcGISJSAPIModules)(["esri/views/SceneView"]).then((function(e){return t.SceneView=e[0],t.SceneView})):Promise.reject()},t.prototype.destoryLayerList=function(){this.layerList&&!this.layerList.destroyed&&this.layerList.destroy()},t.prototype.createLayerList=function(e){var t=this;return(this.LayerList?Promise.resolve():Object(o.loadArcGISJSAPIModules)(["esri/widgets/LayerList"]).then((function(e){t.LayerList=e[0]}))).then((function(){var i=document&&document.createElement("div");i.className="jimu-widget",t.refs.layerListContainer.appendChild(i),t.destoryLayerList(),t.layerList=new t.LayerList({view:e,listItemCreatedFunction:t.defineLayerListActions,container:i}),t.configLayerList(),t.layerList.on("trigger-action",(function(e){t.onLayerListActionsTriggered(e)}))}))},t.prototype.registerLayerListActions=function(){this.layerListActions=[new f(this,this.props.intl.formatMessage({id:"goto",defaultMessage:v})),new h(this,this.props.intl.formatMessage({id:"increaseOpacity",defaultMessage:b}),!0),new h(this,this.props.intl.formatMessage({id:"decreaseOpacity",defaultMessage:S}),!1),new m(this,this.props.intl.formatMessage({id:"information",defaultMessage:_}))]},t.prototype.configLayerList=function(){this.props.config.setVisibility&&this.props.config.useMapWidget||(this.layerList._toggleVisibility=function(){})},t.prototype.renderLayerList=function(){var e=this;return this.createView().then((function(t){return e.createLayerList(t)})).then((function(){e.setState({loadStatus:l.Fulfilled})})).catch((function(e){return console.error(e)}))},t.prototype.syncRenderer=function(e){var t=this;this.renderPromise=new Promise((function(i,n){e.then((function(){t.renderLayerList().then((function(){i()})).catch((function(){return n()}))}))}))},t.prototype.render=function(){var e=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0],t=this.props.useDataSources&&this.props.useDataSources[0];this.currentUseMapWidgetId=e,this.currentUseDataSourceId=t&&t.dataSourceId;var i=null;this.props.config.useMapWidget?i=Object(r.jsx)(o.JimuMapViewComponent,{useMapWidgetIds:this.props.useMapWidgetIds,onActiveViewChange:this.onActiveViewChange}):t&&(i=Object(r.jsx)(r.DataSourceComponent,{useDataSource:t,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed}));var n=null;if(this.props.config.useMapWidget?e:t){var a=null;this.state.loadStatus===l.Pending&&(a=Object(r.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})),n=Object(r.jsx)("div",{className:"widget-layerlist"},a,Object(r.jsx)("div",{ref:"layerListContainer"}),Object(r.jsx)("div",{style:{position:"absolute",opacity:0},ref:"mapContainer"},"mapContainer"),Object(r.jsx)("div",{style:{position:"absolute",display:"none"}},i))}else this.destoryLayerList(),n=Object(r.jsx)("div",{className:"widget-layerlist"},Object(r.jsx)(s.WidgetPlaceholder,{icon:L,message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:w}),widgetId:this.props.id}));return Object(r.jsx)("div",{css:c(this.props.theme,this.props.config),className:"jimu-widget"},n)},t}(r.React.PureComponent);t.default=V},4:function(e,t){e.exports=n}}))}}}));