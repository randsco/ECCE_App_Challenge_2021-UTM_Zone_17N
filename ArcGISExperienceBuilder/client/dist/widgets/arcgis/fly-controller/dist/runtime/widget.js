System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/views/3d/externalRenderers","esri/geometry/support/webMercatorUtils"],(function(e){var t,n,i,r,a;return{setters:[function(e){t=e},function(e){n=e},function(e){i=e},function(e){r=e},function(e){a=e}],execute:function(){e(function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=368)}({0:function(e,n){e.exports=t},1:function(e,t){e.exports=n},105:function(e,t){e.exports=r},106:function(e,t){e.exports=a},165:function(e,t){e.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g fill="#FFF" fill-rule="nonzero"><path d="M19.38 1.552l-3.572 13.942-6.932-2.175 2.626-3.482-4.424 2.952-6.482-1.996 18.783-9.241zM17.87 3.408l-14.574 7.17 3.621 1.115 8.93-5.958-5.32 7.054 4.573 1.435 2.77-10.816zM8.656 18.25l2.282-3.169-2.282-.666v3.836z"></path></g></svg>'},166:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 1c-2.209 0-4 .852-4 3.067v7.922L8 16l4-4.01V4.066C12 1.852 10.209 1 8 1zm3.1 10.686L8 14.794l-3.1-3.108v-7.76C4.9 2.51 5.943 1.79 8 1.79c2.057 0 3.1.719 3.1 2.137v7.759zM10 6.022a2 2 0 11-4 0 2 2 0 014 0zm-1 0a1 1 0 10-2 0 1 1 0 002 0z" fill="#000" fill-rule="nonzero"></path></svg>'},167:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.067 7c.239 0 .433.183.433.41 0 .225-.194.408-.433.408l-.765.005c-.965.013-1.74.056-2.597.164-1.423.178-2.49.504-3.052.978-.58.491-.61 1.154.084 2.156l.208.29c1.955 2.774.227 4.327-4.662 4.559l-.26.01-.538.015-.552.005a.422.422 0 01-.433-.41c0-.225.194-.408.433-.408l.548-.004c4.895-.072 6.274-1.141 4.736-3.324l-.201-.28c-.915-1.324-.872-2.43.059-3.218.726-.614 1.933-.982 3.516-1.18C11.71 7.035 12.683 7 14.067 7zM2 8.076c1.05 0 1.91.64 1.993 1.47L4 9.68v3.193l-2 1.617-2-1.617V9.679c0-.893.896-1.603 2-1.603zM14 0c1.05 0 1.91.64 1.993 1.47l.007.133v3.193l-2 1.616-2-1.616V1.603C12 .71 12.896 0 14 0z" fill="#000" fill-rule="nonzero"></path></svg>'},168:function(e,t){e.exports='<svg viewBox="0 0 15 16" xmlns="http://www.w3.org/2000/svg"><path d="M5.3 3.383l9 6.285h-3.874l2.316 4.421-2.687 1.294-2.373-4.498L5.3 14.009V3.383zM6.299 5.3v5.748l1.537-2.014 2.653 5.029.886-.426-2.601-4.97h2.347L6.299 5.3zm-2.82 1.426l.529.721-2.579 1.191-.389-.784 2.44-1.128zM.648 3.697l2.624.894-.117.883-2.806-.957.299-.82zm10.946-.723l.389.784-2.579 1.193-.25-.85 2.44-1.127zM8.489.072l.848.29-.989 2.71-.784-.465.925-2.535zM4.392.521l.974 1.966-.812.375L3.58.896 4.392.52z" fill="#000" fill-rule="nonzero"></path></svg>'},169:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.793 1.3a.983.983 0 011.32-.086l.094.086 5.5 5.624c.36.368.388.948.083 1.35l-.083.096-6.5 6.646a.992.992 0 01-.576.29l-.131.01h-4a.986.986 0 01-.608-.211l-.099-.089-3.5-3.579a1.04 1.04 0 01-.083-1.35l.083-.096 8.5-8.691zm.707.706L1.008 10.69c-.007.008-.01.022-.007.033l.007.015 3.497 3.577h3.989l6.498-6.645c.007-.007.01-.02.007-.032l-.007-.015L9.5 2.006zM4.844 8.5l-1.838 1.85c-.005.005-.007.015-.005.024l.005.01L5.504 13h2.849l.413-.358c.005-.006.007-.016.005-.024l-.005-.011L4.844 8.5z" fill="#000" fill-rule="nonzero"></path></svg>'},170:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M9.636 0a.51.51 0 01.503.4c.174.825.294 1.53.362 2.117.427.183.828.414 1.197.684l1.975-.772a.52.52 0 01.636.214L15.93 5.38a.49.49 0 01-.104.625 25.124 25.124 0 01-1.703 1.364 5.906 5.906 0 01-.008 1.352L15.789 10c.201.153.256.427.128.642l-1.622 2.737a.52.52 0 01-.607.225 25.675 25.675 0 01-2.065-.754 6.076 6.076 0 01-1.206.67l-.3 2.05a.51.51 0 01-.509.429H6.364a.51.51 0 01-.503-.4 24.02 24.02 0 01-.362-2.117 6.105 6.105 0 01-1.197-.684l-1.975.772a.52.52 0 01-.636-.214L.07 10.62a.49.49 0 01.104-.625 25.127 25.127 0 011.702-1.364 5.906 5.906 0 01.009-1.352L.211 6a.491.491 0 01-.128-.642L1.705 2.62a.52.52 0 01.607-.225c.822.267 1.51.519 2.065.754.37-.265.776-.49 1.207-.67l.3-2.05A.51.51 0 016.392 0h3.244zm-.421 1H6.837l-.319 2.178-.531.22a5.078 5.078 0 00-.766.398l-.235.159-.477.341-.542-.23c-.375-.16-.819-.328-1.332-.505l-.252-.086L1.194 5.48l1.778 1.36-.069.558a4.932 4.932 0 00-.024.952l.017.169.066.574-.477.343c-.329.236-.7.526-1.114.87l-.202.169 1.187 2.006 2.1-.82.463.339c.232.17.478.32.734.448l.26.12.54.232.066.571c.046.395.118.854.217 1.374l.05.255h2.376l.32-2.178.532-.221c.268-.112.524-.244.765-.397l.236-.159.476-.341.543.23c.374.16.818.328 1.33.505l.252.085 1.189-2.005-1.777-1.359.069-.558a4.932 4.932 0 00.023-.952l-.016-.167-.067-.575.478-.343c.328-.237.7-.527 1.114-.87l.201-.171-1.187-2.006-2.1.82L11.081 4a5.094 5.094 0 00-.734-.448l-.26-.12-.54-.232-.066-.571c-.037-.316-.09-.673-.16-1.07L9.214 1zM8 5c1.701 0 3.08 1.343 3.08 3S9.701 11 8 11 4.92 9.657 4.92 8 6.299 5 8 5zm0 1c-1.134 0-2.053.895-2.053 2S6.866 10 8 10s2.053-.895 2.053-2S9.134 6 8 6z" fill="#000" fill-rule="nonzero"></path></svg>'},171:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M15 8L1 0v16l14-8zM2 1.723l10.983 6.276L2 14.276V1.723z" fill="#000" fill-rule="nonzero"></path></svg>'},172:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 1v14H4V1h1zm7 0v14h-1V1h1z" fill="#000" fill-rule="nonzero"></path></svg>'},18:function(e,t,n){"use strict";var i,r,a,o,s;n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s})),function(e){e.Rotate="ROTATE",e.Path="PATH"}(i||(i={})),function(e){e.CW="CW",e.CCW="CCW"}(r||(r={})),function(e){e.Smoothed="CURVED",e.RealPath="LINE"}(a||(a={})),function(e){e.Forward="FORWARD",e.Backward="BACKWARD"}(o||(o={})),function(e){e.Horizontal="HORIZONTAL",e.Vertical="VERTICAL",e.Palette="PALETTE"}(s||(s={}))},368:function(e,t,n){"use strict";n.r(t),n.d(t,"operActionState",(function(){return Me})),n.d(t,"DrawingType",(function(){return Se}));var i,r=n(0),a=n(1),o="Please select a map with 3D data.",s="Please select at least one fly style.",l="Rotate fly",c="Fly along path",p="Sketch a point",u="Sketch points to draw a path",h="Select a feature from the map",g="Remove sketch or selection",d="Speed",f="Tilt",m="Altitude",v="Ground",y="Space",w="Relative to ground",x=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};function b(e){var t="hide";return e&&(t=""),t}var P,M,S,C=(P=function(e,t){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t.prototype.renderSeparator=function(){return Object(r.jsx)("div",{className:"separator-line"})},t.prototype.render=function(){return Object(r.jsx)("div",{css:(n=this.props.theme,o=n.surfaces[1],Object(r.css)(i||(i=x(["\n    /*.fly-wapper {*/\n    position: relative;\n    /*padding: 1px;*/\n    border: "," solid ",";\n    /*}*/\n\n    .bar {\n      display:flex;\n\n      .btns, dropdowns{\n        width: 32px;\n        height: 32px;\n        border: none;\n      }\n      .btns {\n        margin: 5px;\n      }\n\n      .speed-controller{\n        margin: 0 8px;\n      }\n\n      .progress-bar-wapper {\n        /*display: flex;*/\n        position: absolute;\n        width: 100%;\n        bottom: 0px;\n      }\n      .items {\n        display: flex;\n        position: relative;\n      }\n      .items .item {\n        display: flex;\n        background: ",";\n      }\n      .items .btn .jimu-icon{\n        margin: 0;\n      }\n      .separator-line{\n        width: 2px;\n        margin: 4px 1px;\n        border-right: "," solid ",";\n      }\n      .speed-wapper{\n        width: 214px;\n      }\n    }\n    .bar .hide,\n    .bar .items.hide {\n      display: none;\n    }\n    "],["\n    /*.fly-wapper {*/\n    position: relative;\n    /*padding: 1px;*/\n    border: "," solid ",";\n    /*}*/\n\n    .bar {\n      display:flex;\n\n      .btns, dropdowns{\n        width: 32px;\n        height: 32px;\n        border: none;\n      }\n      .btns {\n        margin: 5px;\n      }\n\n      .speed-controller{\n        margin: 0 8px;\n      }\n\n      .progress-bar-wapper {\n        /*display: flex;*/\n        position: absolute;\n        width: 100%;\n        bottom: 0px;\n      }\n      .items {\n        display: flex;\n        position: relative;\n      }\n      .items .item {\n        display: flex;\n        background: ",";\n      }\n      .items .btn .jimu-icon{\n        margin: 0;\n      }\n      .separator-line{\n        width: 2px;\n        margin: 4px 1px;\n        border-right: "," solid ",";\n      }\n      .speed-wapper{\n        width: 214px;\n      }\n    }\n    .bar .hide,\n    .bar .items.hide {\n      display: none;\n    }\n    "])),o.border.width,o.border.color,o.bg,o.border.width,o.border.color)),className:"fly-wapper d-flex"},Object(r.jsx)(a.Nav,{navbar:!0,className:"bar"},Object(r.jsx)("div",{className:"items d-flex flex-row justify-content-around"},Object(r.jsx)("div",{className:"d-flex"},Object(r.jsx)("div",{className:"setting-btns-wapper items "+(e=this.props.isPlaying,t="",e&&(t="hide"),t)},Object(r.jsx)("div",{className:"item"},this.props.flyStyleContent),Object(r.jsx)("div",{className:"item"},Object(r.jsx)("div",{className:"d-flex"},this.renderSeparator(),this.props.drawBtn,this.props.pickBtn,this.props.clearBtn)),Object(r.jsx)("div",{className:"item"},this.props.liveviewSettingContent)),Object(r.jsx)("div",{className:b(this.props.isPlaying)},Object(r.jsx)("div",{className:"speed-wapper h-100"},this.props.speedController))),Object(r.jsx)("div",{className:"d-flex"},Object(r.jsx)("div",{className:"item"},this.renderSeparator(),this.props.playStateContent)),Object(r.jsx)("div",{className:"progress-bar-wapper "+b(this.props.isPlaying)},this.props.progressBar))));var e,t,n,o},t}(r.React.PureComponent),j=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};function A(e){var t="hide";return e&&(t=""),t}var V,L,O=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.render=function(){return Object(r.jsx)("div",{css:(n=this.props.theme,i=n.surfaces[1],Object(r.css)(M||(M=j(["\n    /*height: 100%;*/\n\n    .palette-wapper {\n      position: relative;\n      width: ","px;\n      height: ","px;\n      /*background-color: #AAA;*/\n\n      .hide{\n        display: none;\n      }\n\n      .btns,\n      .dropdowns{\n        position: absolute;\n        width: ","px;\n        height: ","px;\n        border-radius: 50%;\n      }\n      .btns:not(.active){\n        background-color: ",";\n        border: "," solid ",";\n      }\n\n      .play-btn{\n        width: ","px;\n        height: ","px;\n        bottom: 0;\n        ",": ","px;\n      }\n      .draw-btn{\n        ",": 16px;\n        top: 16px;\n      }\n      .pick-btn{\n        top: 0;\n        ",": ","px;\n      }\n      .clear-btn{\n        ",": 16px;\n        top: 16px;\n      }\n\n      .flystyle-btn{\n        ",": 0;\n        bottom: ","px;\n      }\n      .liveview-btn{\n        ",": 0;\n        bottom: ","px;\n      }\n\n      .progress-bar-wapper{\n        position: absolute;\n        width: ","px;\n        height: ","px;\n        ",": ","px;\n        bottom: 20px;\n      }\n\n      .speedcontroller-btn{\n        position: absolute;\n        width: ","px;\n        height: ","px;\n        bottom: 0;\n        ",": 78px;\n        border: "," solid ",";\n        border-radius: 10px;\n        background-color: ",";\n      }\n\n      .speedcontroller-text{\n        font-size: 10px;\n        padding: 0;\n\n        .icon-btn-sizer{\n          min-height: 0;\n        }\n      }\n    }"],["\n    /*height: 100%;*/\n\n    .palette-wapper {\n      position: relative;\n      width: ","px;\n      height: ","px;\n      /*background-color: #AAA;*/\n\n      .hide{\n        display: none;\n      }\n\n      .btns,\n      .dropdowns{\n        position: absolute;\n        width: ","px;\n        height: ","px;\n        border-radius: 50%;\n      }\n      .btns:not(.active){\n        background-color: ",";\n        border: "," solid ",";\n      }\n\n      .play-btn{\n        width: ","px;\n        height: ","px;\n        bottom: 0;\n        ",": ","px;\n      }\n      .draw-btn{\n        ",": 16px;\n        top: 16px;\n      }\n      .pick-btn{\n        top: 0;\n        ",": ","px;\n      }\n      .clear-btn{\n        ",": 16px;\n        top: 16px;\n      }\n\n      .flystyle-btn{\n        ",": 0;\n        bottom: ","px;\n      }\n      .liveview-btn{\n        ",": 0;\n        bottom: ","px;\n      }\n\n      .progress-bar-wapper{\n        position: absolute;\n        width: ","px;\n        height: ","px;\n        ",": ","px;\n        bottom: 20px;\n      }\n\n      .speedcontroller-btn{\n        position: absolute;\n        width: ","px;\n        height: ","px;\n        bottom: 0;\n        ",": 78px;\n        border: "," solid ",";\n        border-radius: 10px;\n        background-color: ",";\n      }\n\n      .speedcontroller-text{\n        font-size: 10px;\n        padding: 0;\n\n        .icon-btn-sizer{\n          min-height: 0;\n        }\n      }\n    }"])),144,92,32,32,i.bg,i.border.width,i.border.color,48,48,"left",48,"left","left",56,"right","left",8,"right",8,54,54,"left",45,40,16,"left",i.border.width,i.border.color,i.bg)),className:"fly-wapper d-flex"},Object(r.jsx)("div",{className:"palette-wapper"},Object(r.jsx)("div",{className:"progress-bar-wapper "+A(this.props.isPlaying)},this.props.progressBar),Object(r.jsx)("div",{className:(e=this.props.isPlaying,t="",e&&(t="hide"),t)},this.props.flyStyleContent,this.props.drawBtn,this.props.pickBtn,this.props.clearBtn,this.props.liveviewSettingContent),this.props.playStateContent,Object(r.jsx)("div",{className:A(this.props.isPlaying)},this.props.speedController)));var e,t,n,i},t}(r.React.PureComponent),k=n(4),T=n(18),D=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var H=n(105),E=function(){function e(){}return e.SPEED={MIN:0,MAX:1,MULTIPLIER:8,DECIMAL:3,DEFAULT_SPEED:50},e.RECORD={INIT_IDX:-1},e}();function z(e,t,n){var i=t||1,r=[];return H.toRenderCoordinates(n,e,0,null,r,0,i),r}function F(e,t,n){var i=t||1,r=n||this.sceneView,a=[];return H.fromRenderCoordinates(r,e,0,a,0,null,i),a}function N(e){return e*Math.PI/180}function G(e){return 180*e/Math.PI}function R(e,t,n,i,r,a,o){var s=t||null,l=n||null;if(!s||!l)return 0;var c=e,p=s,u=l,h=r.create();i.subtract(h,p,c);var g=r.create();i.subtract(g,u,p);var d=r.create();return a.renderCoordsHelper.worldUpAtPosition(p,d),G(o.angle(h,g,d))}function B(e,t,n,i){var r;return r=void 0!==n?n:t.activedItemIdx,e.config.itemsList[r]}function U(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n];r&&r.isInUse&&t++}return t}function W(e,t){var n,i=E.SPEED.MIN,r=E.SPEED.MAX,a=E.SPEED.MULTIPLIER,o=(r-i)/2;return e<o?n=1/((o-e)/o*a):0===(n=(e-o)/(r-o)*a)&&(n=1),parseFloat(n.toFixed(t||E.SPEED.DECIMAL))}function q(e){return e<=0?.1:e>=90?89.9:e}function X(e,t){return Math.floor(e).toString()+" "+t}var Z,J=n(106),Y=function(){function e(e){var t=this;this.getState=function(){return t.widget.state.isDrawing},this.setState=function(e){e||(t.cancel(),t.destroySketchVM(),t.cleanHanlder()),t.widget.setState({isDrawing:e})},this.drawPoint=function(){return new Promise((function(e,n){t.createSketchVM(),t.sketchVM.create("point",{mode:"click"}),t.drawCompleteHanlder=t.sketchVM.on("create",(function(i){var r=null;if("complete"===i.state){r=t.sceneView.camera.clone();var a=i.graphic;return t._cache.graphic=a,t.clear(),t.graphicslayer.add(a),t.cleanHanlder(),a.geometry=t.queryGeometryElevInfo(a.geometry),e({graphic:a,cameraInfo:r})}if("cancel"===i.state)return n("cancel")}))}))},this.drawLine=function(e){return new Promise((function(n,i){if(e){var r=t.doDrawLine(e);return n({graphic:r,cameraInfo:a})}t.createSketchVM(),t.sketchVM.create("polyline",{mode:"click",hasZ:!1});var a=null;t.drawCompleteHanlder=t.sketchVM.on("create",(function(e){if("start"===e.state)t.clear(!0),a=t.sceneView.camera.clone();else{if("complete"===e.state){var r=e.graphic,o=t.doDrawLine(r);return n({graphic:o,cameraInfo:a})}if("cancel"===e.state)return i("cancel")}}))}))},this.doDrawLine=function(e){return t.clear(),t._cache.graphic=e,t.graphicslayer.add(e),t.cleanHanlder(),e.geometry=t.queryGeometryElevInfo(e.geometry),t.drawStartEndPoint(e),e},this.drawStartEndPoint=function(e){var n=e.geometry.paths[0],i=n[0],r=n[n.length-1];t._cache.startPt=t.cacheAndAddPoint(i,t.materials.startPtMarker),t._cache.endPt=t.cacheAndAddPoint(r,t.materials.endPtMarker)},this.isCachedGeo=function(){return t._cache.graphic},this.updateLineByAltitude=function(e){if(t.isCachedGeo()){t.graphicslayer.removeAll();var n=t._cache.startPt.clone();if(t.setGeoZ(n,e),t.graphicslayer.add(n),n=t._cache.endPt.clone(),t.setGeoZ(n,e),t.graphicslayer.add(n),(n=t._cache.graphic.clone()).geometry&&n.geometry.paths){for(var i=n.geometry.paths[0],r=0,a=i.length;r<a;r++){var o=i[r];o[2]=o[2]+parseFloat(e)}t.graphicslayer.add(n),t.sceneView.whenLayerView(t.graphicslayer).then((function(e){e.highlight(n)}))}}},this.setGeoZ=function(e,t){(void 0===e.geometry.z||isNaN(e.geometry.z))&&(e.geometry.z=0),e.geometry.z=e.geometry.z+parseFloat(t)},this.queryGeometryElevInfo=function(e){return t.sceneView.groundView.elevationSampler.queryElevation(e)},this.cancel=function(){t.sketchVM&&t.sketchVM.cancel&&t.sketchVM.cancel()},this.cleanHanlder=function(){t.sketchVM&&t.sketchVM.cancel&&t.sketchVM.cancel(),t.drawCompleteHanlder&&t.drawCompleteHanlder.remove&&t.drawCompleteHanlder.remove()},this.clear=function(e){var n;t._cache={graphic:null,startPt:null,endPt:null},null===(n=t.graphicslayer)||void 0===n||n.removeAll(),!0!==e&&t.cleanHanlder()},this.getPointMaterials=function(e){return{type:"point-3d",symbolLayers:[{type:"icon",material:{color:e.color},outline:{width:4,color:"#FFF"}}],verticalOffset:{screenLength:e.vOffset,maxWorldLength:2*e.vOffset,minWorldLength:e.vOffset},callout:{type:"line",color:"white",size:2,border:{color:[50,50,50]}}}},this.lngLatToXY=function(e,t,n){var i=J.lngLatToXY(e,t),r=n||200;return[i[0],i[1],r]},this.xyToLngLat=function(e,t){return J.xyToLngLat(e,t)},Object(k.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Point","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel"]).then((function(e){t.Graphic=e[0],t.Point=e[1],t.GraphicsLayer=e[2],t.SketchViewModel=e[3],t.graphicslayer=new t.GraphicsLayer({}),t.sceneView.map.addMany([t.graphicslayer]),t.materials={markerColor:"0D89FF",markerSize:10,outlineColor:"[128, 128, 128, 0.8]",startPtMarker:t.getPointMaterials({color:"#36D516",vOffset:10}),endPtMarker:t.getPointMaterials({color:"#FF4159",vOffset:10}),lineColor:[13,137,255,.5]},t.sketchVM=null,t.ready=!0,t.manager.onLoad()})),this.widget=e.widget,this.manager=e.manager,this.sceneView=e.sceneView,this._cache={graphic:null,startPt:null,endPt:null}}return e.prototype.destructor=function(){this.sketchVM=null,this.cancel(),this.destroySketchVM(),this.cleanHanlder()},e.prototype.createSketchVM=function(){var e={type:"line-3d",symbolLayers:[{type:"path",profile:"quad",height:1,width:1,material:{color:this.materials.lineColor},cap:"round",join:"round",castShadows:!1}]};this.sketchVM=new this.SketchViewModel({layer:this.graphicslayer,view:this.sceneView,pointSymbol:this.getPointMaterials({color:"#36D516",vOffset:5}),polylineSymbol:e})},e.prototype.destroySketchVM=function(){var e;null===(e=this.sketchVM)||void 0===e||e.destroy(),this.sketchVM=null},e.prototype.cacheAndAddPoint=function(e,t){var n=e;return"local"===this.sceneView.viewingMode?n=new this.Point({x:n[0],y:n[1],z:n[2],spatialReference:this.sceneView.spatialReference}):(n=this.xyToLngLat(n[0],n[1]),n=new this.Point({x:n[0],y:n[1]}),n=this.queryGeometryElevInfo(n)),n=new this.Graphic({geometry:n,symbol:t,spatialReference:this.sceneView.spatialReference}),this.graphicslayer.add(n),n},e}(),K=function(){function e(e){var t=this;this.clearCacheMapState=function(){t.cache.mapState={popup:null,hightLight:null}},this.clearCacheHighlightGeo=function(){t.cache.currentHighlightGeo={hightlightGeo:null,hightlightHanlder:null}},this.enablePopupAndHighlight=function(){var e=t.jimuMapView;e&&(e.startEdit(),e.enablePopup(),e.enableHighlight(),e.exitEdit())},this.disablePopupAndHighlight=function(){var e=t.jimuMapView;e&&(e.startEdit(),e.disablePopup(),e.disableHighlight(),e.exitEdit())},this.cacheMapPopupHightlightState=function(){var e,n;t.cache.mapState.popup=null===(e=t.jimuMapView)||void 0===e?void 0:e.getIsEnablePopup(),t.cache.mapState.hightLight=null===(n=t.jimuMapView)||void 0===n?void 0:n.getIsEnableHighlight()},this.restoreMapPopupHightlightState=function(){var e=t.jimuMapView;if(e){var n=!1;e.startEdit();var i=t.cache.mapState.popup;!0===i?(e.enablePopup(),n=!0):!1===i&&(e.disablePopup(),n=!0);var r=t.cache.mapState.hightLight;!0===r?(e.enableHighlight(),n=!0):!1===r&&(e.disableHighlight(),n=!0),n&&t.clearCacheMapState(),e.exitEdit()}},this.getHighlightGraphic=function(){return t.cache.currentHighlightGeo.hightlightGeo},this.cacheHighlightGraphic=function(e,n){t.clear(),t.cache.currentHighlightGeo.hightlightGeo=n,t.cache.currentHighlightGeo.hightlightHanlder=e},this.clear=function(){t.cache.currentHighlightGeo.hightlightHanlder&&t.cache.currentHighlightGeo.hightlightHanlder.remove(),t.cache.currentHighlightGeo.hightlightGeo=null,t.cache.currentHighlightGeo.hightlightHanlder=null},this.jimuMapView=e.jimuMapView,this.sceneView=e.sceneView,this.cache={mapState:{popup:null,hightLight:null},currentHighlightGeo:{hightlightGeo:null,hightlightHanlder:null}},this.clearCacheMapState(),this.clearCacheHighlightGeo()}return e.prototype.destructor=function(){this.clear(),this.restoreMapPopupHightlightState()},e}(),Q=function(){function e(e){var t=this;this.getState=function(){return t.widget.state.isPicking},this.setState=function(e){!0!==e&&t.cacheHoverHighlight(null,null),t.widget.setState({isPicking:e})},this.isPicking=function(){return!0===t.getState()},this.clear=function(){t.setState(null),t.cacheHoverHighlight(null,null)},this.pointerMoveHandler=function(e){!0===t.isPicking()&&t.sceneView.hitTest(e).then(t.highlightGraphicsByHover)},this.highlightGraphicsByHover=function(e){var n,i=B(t.widget.props,t.widget.state),r=null==i?void 0:i.name,a=e.results;if(a&&a.length>0){var o=a[0].graphic,s=null===(n=null==o?void 0:o.geometry)||void 0===n?void 0:n.type;("polyline"===s&&r===T.b.Path||"point"===s&&r===T.b.Rotate)&&t.sceneView.whenLayerView(o.layer).then((function(e){t.cacheHoverHighlight(e.highlight(o),o)}))}},this.pointerClickHandler=function(e){!0===t.isPicking()&&t.sceneView.hitTest(e).then((function(n){return t.clickGraphicsByPick(n,e)}))},this.clickGraphicsByPick=function(e,n){var i=e.results;if(i&&i.length>0){var a=i[0].graphic,o=a.geometry.type;"polyline"===o?(r.utils.isTouchDevice||function(e,t){if("polyline"!==e.type||"polyline"!==t.type)return!1;if(!e.extent.equals(t.extent))return!1;if(e.paths.length!==t.paths.length)return!1;if(e.paths[0].length!==t.paths[0].length)return!1;for(var n=e.paths[0],i=t.paths[0],r=0,a=n.length;r<a;r++){var o=n[r],s=i[r];if(o[0]!==s[0]||o[1]!==s[1])return!1}return!0}(a.geometry,t.geoCache.hoverHightlightGeo.geometry))&&t.pickAndClickLine(a):"point"===o&&(r.utils.isTouchDevice||a.geometry.equals(t.geoCache.hoverHightlightGeo.geometry))&&t.pickAndClickPoint(a)}},this.pickAndClickPoint=function(e){event.stopPropagation(),t.manager.onPicked({graphic:e,cameraInfo:null})},this.pickAndClickLine=function(e){event.stopPropagation(),t.manager.onPicked({graphic:e,cameraInfo:null})},this.cacheHoverHighlight=function(e,n){t.geoCache.hoverHightlightHanlder&&t.geoCache.hoverHightlightHanlder.remove(),t.geoCache.hoverHightlightGeo=null,t.geoCache.hoverHightlightHanlder=null,t.geoCache.hoverHightlightGeo=n,t.geoCache.hoverHightlightHanlder=e},this.widget=e.widget,this.manager=e.manager,this.sceneView=e.sceneView,this.jimuMapView=e.jimuMapView,this.pointerMoveEvent&&(this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),this.pointerDownEvent&&(this.pointerDownEvent.remove(),this.pointerDownEvent=null),this.pointerMoveEvent=this.sceneView.on("pointer-move",this.pointerMoveHandler),this.pointerDownEvent=this.sceneView.on("pointer-down",this.pointerClickHandler),this.geoCache={}}return e.prototype.destructor=function(){this.clear(),this.pointerMoveEvent&&(this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),this.pointerDownEvent&&(this.pointerDownEvent.remove(),this.pointerDownEvent=null)},e}(),$=function(){function e(e){var t=this;this.onLoad=function(){t.widget.onGraphicInteractionManagerLoad()},this.isReady=function(){return t.drawHelper.ready},this.setStates=function(e){var n,i,r=!0===e.isDrawing,a=!0===e.isPicking;null===(n=t.drawHelper)||void 0===n||n.setState(r),null===(i=t.pickHelper)||void 0===i||i.setState(a)},this.getStates=function(){var e,n;return{isDrawing:null===(e=t.drawHelper)||void 0===e?void 0:e.getState(),isPicking:null===(n=t.pickHelper)||void 0===n?void 0:n.getState()}},this.clear=function(){var e,n,i;t.cachePickedLine=null,null===(e=t.pickHelper)||void 0===e||e.clear(),null===(n=t.drawHelper)||void 0===n||n.clear(),null===(i=t.highlightHelper)||void 0===i||i.clear(),t.setGeo(null,null)},this.setGeo=function(e,n){var i;e&&n?t.widget.setState({isCachedGeo:!0}):t.widget.setState({isCachedGeo:!1}),null===(i=t.highlightHelper)||void 0===i||i.cacheHighlightGraphic(e,n)},this.toggleDrawState=function(){var e,n,i,r=null===(e=t.drawHelper)||void 0===e?void 0:e.getState();!0==!r&&(null===(n=t.pickHelper)||void 0===n||n.setState(null)),null===(i=t.drawHelper)||void 0===i||i.setState(!r)},this.drawPoint=function(){return new Promise((function(e,n){t.beforInteract(),t.drawHelper.drawPoint().then((function(n){return e(t.setAndHighlightGraphic(n))})).catch((function(e){console.log(e)})).finally((function(){return t.afterInteract(),e(null)}))}))},this.drawLine=function(){return new Promise((function(e,n){t.beforInteract(),t.drawHelper.drawLine().then((function(n){return e(t.setAndHighlightGraphic(n))})).catch((function(e){console.log(e)})).finally((function(){return t.afterInteract(),e(null)}))}))},this.updateLineByAltitude=function(e){null!==e&&(t.cachePickedLine?e>0?(t.highlightHelper.clear(),t.drawHelper.isCachedGeo()||t.drawHelper.drawLine(t.cachePickedLine),t.drawHelper.updateLineByAltitude(e)):t.onPicked({graphic:t.cachePickedLine,cameraInfo:null},!0):t.drawHelper.updateLineByAltitude(e))},this.validPicking=function(e){var n=!1,i=e.graphic.geometry,r=B(t.widget.props,t.widget.state).name;return(r===T.b.Rotate&&"point"===i.type||r===T.b.Path&&"polyline"===i.type)&&(n=!0),n},this.onPicked=function(e,n){var i;t.validPicking(e)&&(t.clear(),"polyline"===e.graphic.geometry.type?(t.setAndHighlightGraphic(e,"pickline"),null===(i=t.drawHelper)||void 0===i||i.drawLine(e.graphic)):t.setAndHighlightGraphic(e),!0!==n&&t.widget.onDrawHanlder(e))},this.setPickingState=function(e){var n,i,r=e;!0===r?(t.beforInteract(),null===(n=t.drawHelper)||void 0===n||n.setState(!1)):t.afterInteract(),null===(i=t.pickHelper)||void 0===i||i.setState(r)},this.setAndHighlightGraphic=function(e,n){var i=e.graphic,r=e.cameraInfo;return t.setGeo(null,null),t.cachePickedLine="pickline"===n?i:null,i.layer?t.sceneView.whenLayerView(i.layer).then((function(e){t.setGeo(e.highlight(i),i)})):t.drawHelper&&t.sceneView.whenLayerView(t.drawHelper.graphicslayer).then((function(e){t.setGeo(e.highlight(i),i)})),{graphic:i,cameraInfo:r}},this.beforInteract=function(){var e,n;null===(e=t.highlightHelper)||void 0===e||e.cacheMapPopupHightlightState(),null===(n=t.highlightHelper)||void 0===n||n.disablePopupAndHighlight()},this.afterInteract=function(){t.restoreMapPopupHightlightState()},this.restoreMapPopupHightlightState=function(){var e;null===(e=t.highlightHelper)||void 0===e||e.restoreMapPopupHightlightState()},this.widget=e.widget,this.sceneView=e.sceneView,this.jimuMapView=e.jimuMapView,this.pickHelper=new Q({widget:this.widget,manager:this,sceneView:this.sceneView,jimuMapView:this.jimuMapView}),this.drawHelper=new Y({widget:this.widget,manager:this,sceneView:this.sceneView,jimuMapView:this.jimuMapView}),this.highlightHelper=new K({sceneView:this.sceneView,jimuMapView:this.jimuMapView}),this.cachePickedLine=null}return e.prototype.destructor=function(){this.clear(),this.pickHelper.destructor(),this.drawHelper.destructor(),this.highlightHelper.destructor()},e}(),ee=function(e){var t=this;this.clearAll=function(){t._aux_graphicsLayer&&t._aux_graphicsLayer.removeAll(),t._aux_movingObjLayer&&t._aux_movingObjLayer.removeAll()},this.deposeMoving=function(){t._aux_movingObjLayer.removeAll()},this.drawPoint=function(e,n){var i=n||"darkgreen",r=new t.Graphic({geometry:e,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:i},outline:{color:"limegreen"}}]}});return t._aux_movingObjLayer.add(r),r},this.drawPoint_gl=function(e,n){var i=F(e,1,t.sceneView),r=new t.Point({x:i[0],y:i[1],z:i[2],type:"point",spatialReference:t.sceneView.spatialReference});r.z<100&&(r.z=100);var a=n||"darkgreen",o=new t.Graphic({geometry:r,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:a},outline:{color:"limegreen"}}]}});return t._aux_movingObjLayer.add(o),o},this.drawLine=function(e,n){var i=n||"lightblue",r=new t.Graphic({geometry:{type:"polyline",paths:e,spatialReference:t.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:i},size:3}]}});return t._aux_graphicsLayer.add(r),r},this.drawLineXY=function(e,n){for(var i=[],r=0,a=e.length;r<a;r++){var o=e[r],s=o[0],l=o[1],c=o[2];0===c?i.push([s,l]):i.push([s,l,c])}var p=n||"lightblue",u=new t.Graphic({geometry:{type:"polyline",paths:i,spatialReference:t.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:p},size:3}]}});return t._aux_graphicsLayer.add(u),u},this.drawLine_gl=function(e,n,i){for(var r=i||"lightblue",a=[],o=0,s=e.length;o<s;o++){var l=F(e[o],1,n);a.push(l)}var c=new t.Graphic({geometry:{type:"polyline",paths:a,spatialReference:t.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:r},size:3}]}});return t._aux_graphicsLayer.add(c),c},Object(k.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/Graphic","esri/views/3d/support/projectionUtils","esri/geometry/support/webMercatorUtils"]).then((function(e){t.GraphicsLayer=e[0],t.Point=e[1],t.Graphic=e[2],t.projectionUtils=e[3],t.webMercatorUtils=e[4],t._aux_graphicsLayer=new t.GraphicsLayer,t.sceneView.map.add(t._aux_graphicsLayer),t._aux_movingObjLayer=new t.GraphicsLayer,t.sceneView.map.add(t._aux_movingObjLayer)})),this.sceneView=e.sceneView};!function(e){e[e.NONE=0]="NONE",e[e.In=1]="In",e[e.Out=2]="Out",e[e.InOut=3]="InOut",e[e.Linear=4]="Linear"}(Z||(Z={}));var te,ne=function(){function e(){}return e.linear=function(e,t,n,i){return n*e/i+t},e.easeIn=function(e,t,n,i){return n*(e/=i)*e+t},e.easeOut=function(e,t,n,i){return-n*(e/=i)*(e-2)+t},e.easeInOut=function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},e}(),ie=function(){function e(){var e=this;this.easing=function(t,n){switch(e.mode){case Z.In:return e.easingIn(t,n);case Z.InOut:return e.easingInOut(t,n);case Z.Linear:return e.linear(t,n);case Z.NONE:return e.uniformSpeed(t,n)}},this.uniformSpeed=function(t,n){e.updateCurrentDuration(t*n);var i=e.getMovementByFrame(t)*n;return e.progress=0,{interp:0,step:i,progress:e.progress}},this.linear=function(t,n){var i=e.updateCurrentDuration(t*n),r=0,a=0;return i<e.interp.time.duration?(a=(r=ne.linear(i,e.interp.value.start,e.interp.value.end,e.interp.time.duration))-e.interp.cache.lastVal,e.interp.cache.lastVal=r,e.progress=r/e.interp.value.end):e.progress=1,{interp:r,step:a,progress:e.progress}},this.easingIn=function(t,n){var i=e.updateCurrentDuration(t*n),r=0,a=0;return i<e.interp.time.duration?(a=(r=ne.easeIn(i,e.interp.value.start,e.interp.value.end,e.interp.time.duration))-e.interp.cache.lastVal,e.interp.cache.lastVal=r,e.interp.cache.lastStep=a):a=e.interp.cache.lastStep*n,e.progress=-1,{interp:r,step:a,progress:e.progress}},this.easingInOut=function(t,n){var i=e.updateCurrentDuration(t*n),r=0,a=0;return i<e.interp.time.duration?(a=(r=ne.easeInOut(i,e.interp.value.start,e.interp.value.end,e.interp.time.duration))-e.interp.cache.lastVal,e.interp.cache.lastVal=r,e.progress=r/e.interp.value.end):e.progress=1,{interp:r,step:a,progress:e.progress}},this.getMovementByFrame=function(t){return e.getSpeed()/(1e3/t)},Object(k.loadArcGISJSAPIModules)(["esri/core/scheduling"]).then((function(t){e.scheduling=t[0]})),this.speed=E.SPEED.DEFAULT_SPEED,this.mode=Z.NONE,this.progress=0,this.amount=-1,this.interp={time:{begin:0,currentDuration:0,duration:1e4},value:{start:0,end:0},cache:{lastVal:0,lastStep:0}}}return e.prototype.init=function(e,t,n,i){this.mode=e,this.interp.value.start=t,this.interp.value.end=n,this.interp.time.duration=i},e.prototype.reset=function(){this.interp.time.begin=0,this.interp.time.currentDuration=0,this.progress=0},e.prototype.computeDuration=function(){return this.amount/this.speed*1e3},e.prototype.setAmount=function(e){return this.amount=e,this},e.prototype.getAmount=function(){return this.amount},e.prototype.getProgress=function(){return this.progress},e.prototype.progressForward=function(){return this.progress+=1e-4,this.progress},e.prototype.progressBackward=function(){return this.progress-1e-4},e.prototype.getInterDuration=function(){return this.interp.time.currentDuration},e.prototype.updateCurrentDuration=function(e){return this.interp.time.currentDuration=this.interp.time.currentDuration+e,isNaN===this.interp.time.currentDuration&&(this.interp.time.currentDuration=0),this.interp.time.currentDuration},e.prototype.getSpeed=function(){return this.speed},e.prototype.setSpeed=function(e){this.speed=e},e.prototype.setSpeedByLimittime=function(e){var t;t=e?this.amount/e:E.SPEED.DEFAULT_SPEED,this.setSpeed(t)},e.prototype.update=function(e){this.animatHandler||(this.animatHandler=this.scheduling.addFrameTask({update:function(t){e(t)}}))},e.prototype.stop=function(){this.animatHandler&&(this.animatHandler.pause(),this.animatHandler.remove(),this.animatHandler=null)},e.prototype.insertAnExtraFrame=function(e){var t;null===(t=this.scheduling)||void 0===t||t.schedule((function(t){e(t)}))},e}(),re=function(){function e(){this.initCamOffset={height:0,distance:0},this.speedFactor=1,this.fixHeading=0,this.fixTilt=0,this.fixAltitude=0,this.initCamOffset.height=60,this.initCamOffset.distance=90}return e.prototype.getCamOffsetHeight=function(){return this.initCamOffset.height},e.prototype.getCamOffsetDistance=function(){return this.initCamOffset.distance},e.prototype.setSpeedFactor=function(e){var t;t=void 0===e?1:e,this.speedFactor=parseFloat(t)},e.prototype.getSpeedFactor=function(){return void 0===this.speedFactor?1:W(this.speedFactor)},e.prototype.setHeadingFactor=function(e){var t=0;void 0!==e&&(t=parseFloat(e)),this.fixHeading=t},e.prototype.getHeadingFactor=function(){return this.fixHeading||0},e.prototype.setTiltFactor=function(e){var t=0;void 0!==e&&(t=parseFloat(e)),this.fixTilt=t},e.prototype.getTiltFactor=function(){return this.fixTilt||0},e.prototype.setAltitudeFactor=function(e){var t=0;void 0!==e&&(t=parseFloat(e)),this.fixAltitude=t},e.prototype.getAltitudeFactor=function(){return this.fixAltitude||0},e.prototype.getRuntimeSettingInfo=function(){},e}();!function(e){e[e.INITED=-1]="INITED",e[e.PREPARING=0]="PREPARING",e[e.PREPARED=1]="PREPARED",e[e.RUNNING=2]="RUNNING",e[e.STOPPED=3]="STOPPED"}(te||(te={}));var ae,oe=function(){function e(e){var t=this;this._resume=function(e){return new Promise((function(n,i){t.preparing().then((function(){e.then((function(){t.prepared().then((function(){return t.state._debugTime&&t._debugTimeStart(),t._doFly()}))}))})).catch((function(e){return i()}))}))},this.rotateBySceneMode=function(e,n,i,r){var a=t.glMatrix_vec3d.fromValues(e[0],e[1],e[2]);if(t.sceneView.state.isLocal&&r){var o=t.glMatrix_vec3d.create();t.glMatrix_vec3.negate(o,r),t.glMatrix_vec3.add(a,a,o)}var s=t.glMatrix_mat4d.create();return t.glMatrix_mat4.rotate(s,s,N(i),n),t.glMatrix_vec3.transformMat4(a,a,s),t.sceneView.state.isLocal&&r&&t.glMatrix_vec3.subtract(a,a,o),a},this.getDilutionPath=function(e,t){var n=t||3e3;if(e.length&&e.length>n){for(var i=[],r=Math.floor(e.length/n),a=0,o=e.length;a<o;a+=r)i.push(e[a]);return i}return e},this.getDisLen=function(e,n){var i=t.glMatrix_vec3d.create();t.glMatrix_vec3.subtract(i,n,e);var r=t.glMatrix_vec3.length(i);return t.state.DEBUG&&console.log("LinerLen =>"+r),r},this.queryGeometryElevInfo=function(e){return t.sceneView.groundView.elevationSampler?t.sceneView.groundView.elevationSampler.queryElevation(e):e.hasZ?e:void 0},this._coordsToGeoArray=function(e){for(var n,i=[],r=0,a=e.length;r<a;r++)n=t.glMatrix_vec3d.fromValues(e[r].x,e[r].y,e[r].z),i.push(n);return i},this._coordToGeo=function(e){return e?t.glMatrix_vec3d.fromValues(e.x,e.y,e.z):null},Object(k.loadArcGISJSAPIModules)(["esri/core/libs/gl-matrix-2/vec3f64","esri/core/libs/gl-matrix-2/mat4f64","esri/core/libs/gl-matrix-2/vec3","esri/core/libs/gl-matrix-2/mat4","esri/views/3d/support/cameraUtils","esri/views/3d/webgl-engine/lib/Camera","esri/geometry/Point","esri/core/watchUtils","esri/views/3d/support/mathUtils"]).then((function(e){t.vec3f64=e[0],t.mat4f64=e[1],t.vec3=e[2],t.mat4=e[3],t.cameraUtils=e[4],t.GLCamera=e[5],t.Point=e[6],t.watchUtils=e[7],t.esriMathUtils=e[8],t.glMatrix_vec3=t.vec3.vec3,t.glMatrix_vec3d=t.vec3f64.vec3f64,t.glMatrix_mat4=t.mat4.mat4,t.glMatrix_mat4d=t.mat4f64.mat4f64})),this.clear(),this.sceneView=e.sceneView,this.callbacks=e.callbacks,this.state.DEBUG=e.debug,this.state.DEBUG&&(this.auxHelper=new ee({sceneView:this.sceneView})),this.sceneView.on("drag",(function(e){te.RUNNING===t.state.flyState&&"start"===e.action&&t.pause()})),this.sceneView.on("mouse-wheel",(function(e){te.RUNNING===t.state.flyState&&t.pause()}))}return e.prototype.destructor=function(){this.clear()},e.prototype.isPrepared=function(){var e=this.state.flyState;return null!==e&&e!==te.INITED},e.prototype.isEnableToFly=function(){var e=this.state.flyState;return e===te.PREPARED||e===te.STOPPED||e===te.PREPARING},e.prototype.isEnableToPause=function(){return this.state.flyState===te.RUNNING},e.prototype.init=function(e){this.state.init={geo:e.geo,options:e.options},this.state.flyState=te.INITED,this.animat.reset()},e.prototype.prepare=function(e){},e.prototype.preparing=function(){var e=this;return new Promise((function(t,n){e.state.flyState=te.PREPARING,t()}))},e.prototype.prepared=function(){var e=this;return new Promise((function(t,n){e.state.flyState=te.PREPARED,setTimeout((function(){t()}),50)}))},e.prototype._doFly=function(){this.onStart()},e.prototype.pause=function(){return!1===this.isEnableToPause()||(this.stopAnimat(),this.onPause()),Promise.resolve()},e.prototype.resume=function(e){},e.prototype.stop=function(){var e;(null===(e=this.state)||void 0===e?void 0:e._debugTime)&&(this._debugTimeEnd(),this._debugDeltaTime()),this.stopAnimat(),this.onStop()},e.prototype.clear=function(){var e,t;null===(e=this.animat)||void 0===e||e.stop(),this.state={DEBUG:!1,flyState:null,settingMode:!1,init:{geo:null,options:null},shownProgress:0,_debugTime:!1,_debug:{startTime:null,endTime:null}},this.cachedGeo=null,this._cache={camera_gl:{pos:null,upDir:null},lookAtTarget_gl:{pos:null,upAxis:null,baseAlt:null}},this.animat=null,this.animat=new ie,this.realtimeSetting=null,this.realtimeSetting=new re,this.state.DEBUG&&(null===(t=this.auxHelper)||void 0===t||t.clearAll())},e.prototype.updateAnimat=function(e){return this.animat.update((function(t){e(t)}))},e.prototype.stopAnimat=function(){this.animat.stop(),this.updateProgressBar(),this.onPause()},e.prototype.settingPreview=function(e){var t=this;return new Promise((function(n,i){if(t.state.settingMode=e,!0!==e)return t.pause();t.fly({animate:!1}),n()}))},e.prototype.setRuntimeSetting=function(e,t){if(e&&e){var n=!1,i=e.altitude;void 0!==i&&(n=!0,this.realtimeSetting.setAltitudeFactor(i));var r=e.heading;void 0!==r&&(n=!0,this.realtimeSetting.setHeadingFactor(r));var a=e.tilt;void 0!==a&&(n=!0,this.realtimeSetting.setTiltFactor(a)),n&&this.animat&&this.animat.insertAnExtraFrame((function(e){t(e)}))}},e.prototype.onStart=function(){var e;this.state.flyState=te.RUNNING,(null===(e=this.callbacks)||void 0===e?void 0:e.onFly)&&this.callbacks.onFly()},e.prototype.onPause=function(){var e;this.state.flyState=te.STOPPED,(null===(e=this.callbacks)||void 0===e?void 0:e.onPause)&&this.callbacks.onPause()},e.prototype.onStop=function(){var e;this.state.flyState=te.STOPPED,(null===(e=this.callbacks)||void 0===e?void 0:e.onStop)&&this.callbacks.onStop()},e.prototype.updateProgressBar=function(){var e;if(null===(e=this.callbacks)||void 0===e?void 0:e.onUpdateProgress){var t=Math.ceil(100*this.getProgress()),n=!1;(t<=1||t>=99||Math.abs(t-this.state.shownProgress)>=1)&&(n=!0),!0===n&&(this.state.shownProgress=t),n&&this.callbacks.onUpdateProgress(this.state.shownProgress)}},e.prototype._debugTimeStart=function(){this.state._debug.startTime=(new Date).getTime()},e.prototype._debugTimeEnd=function(){this.state._debug.endTime=(new Date).getTime()},e.prototype._debugDeltaTime=function(){if(this.state._debug.endTime>0&&this.state._debug.startTime>0){var e=this.state._debug.endTime-this.state._debug.startTime;return console.log("debug_DeltaTime__"+e/1e3+"_s"),alert("debug_DeltaTime__"+e/1e3+"_s"),e}return-1},e}(),se=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.settingPreview=function(n){return new Promise((function(i,r){e.prototype.settingPreview.call(t,n).then((function(){t.setRuntimeSetting(t.getRuntimeSettingInfo()),i()}))}))},t.setRuntimeSetting=function(n){e.prototype.setRuntimeSetting.call(t,n,(function(){if(n&&n.tilt&&t._cache.lookAtTarget_gl.pos){var e=t.setFlyTilt(n.tilt),i=t.sceneView.camera.clone();i.position.z=e+t._cache.lookAtTarget_gl.baseAlt,i.position.z<0&&(i.position.z=0);var r=t.cameraUtils.externalToInternal(t.sceneView,i);t._cache.camera_gl.pos=r.eye,t._cache.camera_gl.upDir=r.up,t.sceneView.goTo(t.getApiCamera(),{animate:!1})}}))},t.getFlyTilt=function(){if(t._cache.lookAtTarget_gl.pos){var e=t.glMatrix_vec3d.create();t.glMatrix_vec3.subtract(e,t._cache.camera_gl.pos,t._cache.lookAtTarget_gl.pos);var n=t.glMatrix_vec3.angle(t._cache.lookAtTarget_gl.upAxis,e);return n=90-G(n)}},t.setFlyTilt=function(e){var n=t.sceneView.camera.clone();e=q(e);var i=t.getFlyTilt();return i=N(i),(n.position.z-t._cache.lookAtTarget_gl.baseAlt)/Math.tan(i)*Math.tan(N(e))},t.prepare=function(n){return new Promise((function(i,r){var a,o=(null==n?void 0:n.geo)?null==n?void 0:n.geo:t.state.init.geo,s=(null==n?void 0:n.options)?null==n?void 0:n.options:t.state.init.options;e.prototype.preparing.call(t),t.state.DEBUG&&t.auxHelper.drawPoint(o.mapPoint),t._cache.lookAtTarget_gl.pos=z([o.mapPoint.x,o.mapPoint.y,o.mapPoint.z],null,t.sceneView),t._cache.lookAtTarget_gl.upAxis=t.glMatrix_vec3d.create(),t._cache.lookAtTarget_gl.baseAlt=o.mapPoint.z,t.sceneView.renderCoordsHelper.worldUpAtPosition(t._cache.lookAtTarget_gl.pos,t._cache.lookAtTarget_gl.upAxis),s&&s.direction&&(t.direction=s.direction),(a=s&&s.cameraInfo?s.cameraInfo:t.sceneView.camera.clone()).position.z+=0;var l=t.cameraUtils.externalToInternal(t.sceneView,a);t._cache.camera_gl.pos=l.eye,t._cache.camera_gl.upDir=l.up,t.sceneView.goTo(t.getApiCamera()).then((function(){e.prototype.prepared.call(t).then((function(){i()}))}))}))},t.fly=function(e){return e&&(e.speedFactor&&t.realtimeSetting.setSpeedFactor(e.speedFactor),e.angleLimit?t.angleLimit=e.angleLimit:t.angleLimit=null,e.duration&&(t.duration=e.duration)),t.animat.init(Z.NONE,0,0,t.duration),!1===t.isPrepared()?t.prepare().then((function(){t.resume()})):t.isEnableToFly()?t.resume(null==e?void 0:e.animate):Promise.reject()},t._doFly=function(){return e.prototype._doFly.call(t),t.updateAnimat((function(e){var n=t.animat.easing(e.deltaTime,t.realtimeSetting.getSpeedFactor()).step;if(t.direction&&t.direction===T.d.CW&&(n=-n),!0===t.state.settingMode);else if(null===t.angleLimit||isNaN(t.angleLimit))t._cache.camera_gl.pos=t.rotateBySceneMode(t._cache.camera_gl.pos,t._cache.lookAtTarget_gl.upAxis,n,t._cache.lookAtTarget_gl.pos);else if(t.angleLimit>0){var i=Math.min(Math.abs(n),t.angleLimit);t.angleLimit-=i,t._cache.camera_gl.pos=t.rotateBySceneMode(t._cache.camera_gl.pos,t._cache.lookAtTarget_gl.upAxis,i,t._cache.lookAtTarget_gl.pos)}else t.angleLimit<=0&&t.stop();t.state.DEBUG&&t.auxHelper.drawPoint_gl(t._cache.camera_gl.pos,"red");var r=t.getApiCamera();t.sceneView.goTo(r,{animate:!1})}))},t.getApiCamera=function(){var e=new t.GLCamera(t._cache.camera_gl.pos,t._cache.lookAtTarget_gl.pos,t._cache.camera_gl.upDir);return t.cameraUtils.internalToExternal(t.sceneView,e)},t.resumeCamera=function(e){return new Promise((function(n,i){var r=!0;!1===e&&(r=!1),t.sceneView.goTo(t.getApiCamera(),{animate:r}).then((function(){n()}))}))},t.resume=function(n){return e.prototype.resume.call(t),t._resume(t.resumeCamera(n))},t.clear=function(){t._cache.lookAtTarget_gl.pos=null,e.prototype.clear.call(t)},t.getProgress=function(){return 0},t}return se(t,e),t.prototype.getRuntimeSettingInfo=function(){return{tilt:this.getFlyTilt(),altitude:null}},t}(oe),ce=function(){function e(e,t){this.points=e||[],this.points=this.normalPoints4Bspline(this.points),this.iter=t||3}return e.prototype.getSpline=function(){var e=this.bspline(this.points,this.iter);return this.mergePoints(e)},e.prototype.clear=function(){this.points=null,this.iter=null},e.prototype.normalPoints4Bspline=function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=r[0],o=r[1],s=r[2]||0;t.push(a,o,s)}return t},e.prototype.mergePoints=function(e){for(var t=[],n=0,i=e.length/3;n<i;n++){var r=e[3*n],a=e[3*n+1],o=e[3*n+2],s=[];s.push(r,a,o),t.push(s)}return t},e.prototype.bspline=function(e,t){if(!t||0==t)return e;for(var n=e.length/3,i=[e[0],e[1],e[2]],r=0;r<n-1;r++){var a=3*r;i[3+2*a+0]=.8*e[a+0]+.2*e[a+3],i[3+2*a+1]=.8*e[a+1]+.2*e[a+4],i[3+2*a+2]=.8*e[a+2]+.2*e[a+5],i[3+2*a+3]=.2*e[a+0]+.8*e[a+3],i[3+2*a+4]=.2*e[a+1]+.8*e[a+4],i[3+2*a+5]=.2*e[a+2]+.8*e[a+5]}return i.push(e[e.length-3],e[e.length-2],e[e.length-1]),this.bspline(i,t-1)},e}(),pe=function(){var e=this;this.c0=0,this.c1=0,this.c2=0,this.c3=0,this.init=function(t,n,i,r){e.c0=t,e.c1=i,e.c2=-3*t+3*n-2*i-r,e.c3=2*t-2*n+i+r},this.initCatmullRom=function(t,n,i,r,a){e.init(n,i,a*(i-t),a*(r-n))},this.initNonuniformCatmullRom=function(t,n,i,r,a,o,s){var l=(n-t)/a-(i-t)/(a+o)+(i-n)/o,c=(i-n)/o-(r-n)/(o+s)+(r-i)/s;l*=o,c*=o,e.init(n,i,l,c)},this.calc=function(t){var n=t*t,i=n*t;return e.c0+e.c1*t+e.c2*n+e.c3*i}},ue=function(e,t,n){var i=this;this.set=function(e,t,n){return i.x=e,i.y=t,i.z=n,i},this.add=function(e){return i.x+=e.x,i.y+=e.y,i.z+=e.z,i},this.subVectors=function(e,t){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i},this.distanceToSquared=function(e){var t=i.x-e.x,n=i.y-e.y,r=i.z-e.z;return t*t+n*n+r*r},this.distanceTo=function(e){return Math.sqrt(i.distanceToSquared(e))},this.x=e||0,this.y=t||0,this.z=n||0},he=new ue,ge=new pe,de=new pe,fe=new pe,me=function(e,t,n,i){var r=this;this._geoArrayToCoords=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(new ue(e[n][0],e[n][1],e[n][2]));return t},this.getPoint=function(e,t){var n,i,a,o,s=t||new ue,l=r.points,c=l.length,p=(c-(r.closed?0:1))*e,u=Math.floor(p),h=p-u;if(r.closed?u+=u>0?0:(Math.floor(Math.abs(u)/c)+1)*c:0===h&&u===c-1&&(u=c-2,h=1),r.closed||u>0?n=l[(u-1)%c]:(he.subVectors(l[0],l[1]).add(l[0]),n=he),i=l[u%c],a=l[(u+1)%c],r.closed||u+2<c?o=l[(u+2)%c]:(he.subVectors(l[c-1],l[c-2]).add(l[c-1]),o=he),"centripetal"===r.curveType||"chordal"===r.curveType){var g="chordal"===r.curveType?.5:.25,d=Math.pow(n.distanceToSquared(i),g),f=Math.pow(i.distanceToSquared(a),g),m=Math.pow(a.distanceToSquared(o),g);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),ge.initNonuniformCatmullRom(n.x,i.x,a.x,o.x,d,f,m),de.initNonuniformCatmullRom(n.y,i.y,a.y,o.y,d,f,m),fe.initNonuniformCatmullRom(n.z,i.z,a.z,o.z,d,f,m)}else"catmullrom"===r.curveType&&(ge.initCatmullRom(n.x,i.x,a.x,o.x,r.tension),de.initCatmullRom(n.y,i.y,a.y,o.y,r.tension),fe.initCatmullRom(n.z,i.z,a.z,o.z,r.tension));return s.set(ge.calc(h),de.calc(h),fe.calc(h)),s},this.getSpacedPoints=function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(r.getPointAt(n/e));return t},this.getPointAt=function(e,t){var n=r.getUtoTmapping(e);return r.getPoint(n,t)},this.getUtoTmapping=function(e,t){var n,i=r.getLengths(),a=0,o=i.length;n=t||e*i[o-1];for(var s,l=0,c=o-1;l<=c;)if((s=i[a=Math.floor(l+(c-l)/2)]-n)<0)l=a+1;else{if(!(s>0)){c=a;break}c=a-1}if(i[a=c]===n)return a/(o-1);var p=i[a];return(a+(n-p)/(i[a+1]-p))/(o-1)},this.getLength=function(){var e=r.getLengths();return e[e.length-1]},this.getLengths=function(e){if(void 0===e&&(e=r.arcLengthDivisions),r.cacheArcLengths&&r.cacheArcLengths.length===e+1&&!r.needsUpdate)return r.cacheArcLengths;r.needsUpdate=!1;var t,n,i=[],a=r.getPoint(0),o=0;for(i.push(0),n=1;n<=e;n++)o+=(t=r.getPoint(n/e)).distanceTo(a),i.push(o),a=t;return r.cacheArcLengths=i,i},this.points=e||[],this.points=this._geoArrayToCoords(this.points),this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.3,this.arcLengthDivisions=2e4},ve=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setRuntimeSetting=function(n){e.prototype.setRuntimeSetting.call(t,n,(function(){var e=t.getApiCamera(t.getCameraByProgress());t.sceneView.goTo(e,{animate:!1})}))},t.prepare=function(n){return new Promise((function(i,r){var a=(null==n?void 0:n.geo)?null==n?void 0:n.geo:t.state.init.geo;a&&"polyline"===a.type||alert("Wrong geo type!"),e.prototype.preparing.call(t),a=t.queryGeometryElevInfo(a),t.cachedGeo=t.getDilutionPath(a.paths[0]),t.cachedGeo=t.preProcessing(t.cachedGeo);var o=new ce(t.cachedGeo),s=new me(o.getSpline());o.clear();var l=s.getLength();t.animat.setAmount(l),t.paths=s,t.state.DEBUG&&t.auxHelper.drawLineXY(t.paths,"lightgreen");var c=t.getApiCamera(t.getCameraByProgress());t.sceneView.goTo(c).then((function(){e.prototype.prepared.call(t).then((function(){i()}))})).catch((function(e){console.log(e)}))}))},t.fly=function(n){if(n&&(n.speedFactor&&t.realtimeSetting.setSpeedFactor(n.speedFactor),n.duration&&(t.duration=n.duration)),!t.state.settingMode){var i=t.animat.computeDuration();t.animat.init(Z.Linear,0,t.animat.getAmount(),t.duration||i)}return e.prototype.isEnableToFly.call(t)?t.resume():Promise.reject()},t._doFly=function(){e.prototype._doFly.call(t),t.updateAnimat((function(e){if(!0===t.state.settingMode||t.animat.easing(e.deltaTime,t.realtimeSetting.getSpeedFactor()),t.updateProgressBar(),t.getProgress()>=1)t.animat.reset(),t.stop();else{var n=t.getCameraByProgress(),i=t.getApiCamera(n);i&&t.sceneView.goTo(i,{animate:!1})}}))},t.getProgress=function(){return t.animat.getProgress()},t.getCameraByProgress=function(){var e,n;0===t.animat.getProgress()?(e=0*t.animat.getAmount(),t.animat.progressForward(),n=t.animat.getAmount()*t.animat.getProgress()):((e=t.animat.getAmount()*t.animat.progressBackward())<0&&(e=0,t.animat.progressForward()),n=t.animat.getAmount()*t.animat.getProgress());var i=t.paths.getUtoTmapping(0,e);i=t.paths.getPoint(i),i=t._coordToGeo(i);var r=t.paths.getUtoTmapping(0,n);r=t.paths.getPoint(r),r=t._coordToGeo(r);var a=z([i[0],i[1],i[2]+0],null,t.sceneView),o=t.getCameraPosition(i,r);o||(o=t._cache.camera_gl.pos);var s=t.glMatrix_vec3d.create();t.sceneView.renderCoordsHelper.worldUpAtPosition(o,s);var l=[0,0,0];l[0]=o[0],l[1]=o[1],l[2]=o[2];var c=[0,0,0];return c[0]=a[0],c[1]=a[1],c[2]=a[2],t._cache.camera_gl.pos=l,t._cache.camera_gl.upDir=s,t._cache.lookAtTarget_gl.pos=c,t._cache.lookAtTarget_gl.upAxis=null,t._cache.lookAtTarget_gl.baseAlt=null,{lookAt:c,camPos:l,up:s}},t.getApiCamera=function(e){var n=e.camPos,i=e.lookAt,r=e.up;if(!n||!i||!r)return null;var a,o=F(i,1,t.sceneView),s=new t.Point({x:o[0],y:o[1],z:o[2],type:"point",spatialReference:t.sceneView.spatialReference});a=s.z,s.z=s.z+t.realtimeSetting.getAltitudeFactor(),s.z<0&&(s.z=0),i=z([s.x,s.y,s.z],null,t.sceneView),o=F(n,1,t.sceneView),(s=new t.Point({x:o[0],y:o[1],z:o[2],type:"point",spatialReference:t.sceneView.spatialReference})).z=a+t.realtimeSetting.getAltitudeFactor()+t.realtimeSetting.getCamOffsetHeight(),n=z([s.x,s.y,s.z],null,t.sceneView);var l=new t.GLCamera(n,i,r);return t.cameraUtils.internalToExternal(t.sceneView,l)},t.getCameraRoutes=function(e){for(var n=[],i=0,r=e.length-1;i<r;i++){var a,o=e[i];a=i===r-1?o:e[i+1];var s=t.getCameraPosition(o,a);s&&n.push(s)}return t.state.DEBUG&&t.auxHelper.drawLine_gl(n,t.sceneView,"yellow"),n},t.getCameraPosition=function(e,n){if(e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2])return null;var i=t.realtimeSetting.getCamOffsetHeight()||100,r=t.realtimeSetting.getCamOffsetDistance()||100,a=z([e[0],e[1],e[2]],null,t.sceneView),o=z([n[0],n[1],n[2]],null,t.sceneView),s=t.glMatrix_vec3d.create();t.glMatrix_vec3.subtract(s,a,o);var l=t.glMatrix_vec3.length(s),c=t.glMatrix_vec3d.create();t.glMatrix_vec3.normalize(c,s);var p=l+r,u=t.glMatrix_vec3d.create();t.glMatrix_vec3.scale(u,c,p);var h=t.glMatrix_vec3d.create();t.glMatrix_vec3.add(h,o,u);var g=F(h,1,t.sceneView),d=new t.Point({x:g[0],y:g[1],z:g[2],type:"point",spatialReference:t.sceneView.spatialReference});return d.z<i&&(d.z=i),d.z<0&&(d.z=0),t.state.DEBUG&&t.auxHelper.drawPoint(d),z([d.x,d.y,d.z],null,t.sceneView)},t.resume=function(){return e.prototype.resume.call(t),t._resume(t.sceneView.goTo(t.getApiCamera(t.getCameraByProgress())))},t.clear=function(){e.prototype.clear.call(t)},t}return ve(t,e),t.prototype.getRuntimeSettingInfo=function(){return{tilt:null,altitude:this.realtimeSetting.getAltitudeFactor()}},t.prototype.preProcessing=function(e){for(var t=[],n=0,i=e.length;n<i;n++){d=z([(d=e[n])[0],d[1],d[2]],null,this.sceneView),t.push(d)}for(var r=this.glMatrix_vec3d.create(),a=0;a<t.length-1;a++){var o=t[a],s=t[a+1],l=t[a+2];if(this.glMatrix_vec3.subtract(r,o,s),this.glMatrix_vec3.length(r)>100){var c=R(o,s,l,this.glMatrix_vec3,this.glMatrix_vec3d,this.sceneView,this.esriMathUtils);if(c>=90||c<=-90){var p=this.glMatrix_vec3d.create();this.glMatrix_vec3.normalize(p,r);var u=this.glMatrix_vec3d.create();this.glMatrix_vec3.scale(u,p,100);var h=this.glMatrix_vec3d.create();this.glMatrix_vec3.add(h,s,u),t.splice(a+1,0,h),a++}}}n=0;for(var g=t.length;n<g;n++){var d;d=F(d=t[n],null,this.sceneView),t.splice(n,1,d)}return t},t}(oe),we=function(){function e(e,t,n,i,r){var a=this;this.geoArrayToCoords=function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];r=z([r[0],r[1],r[2]],null,a.sceneView),t.push(r)}return t},this.getLength=function(){a.points.length<2&&alert("line.length < 2");for(var e=0,t=0,n=a.points.length;t<n-1;t++)e+=a.getLineLen(a.points[t+0],a.points[t+1]),e+=Math.abs(R(a.points[t+0],a.points[t+1],a.points[t+2],a.vec3,a.vec3d,a.sceneView,a.esriMathUtils));return a.length=e,e},this.sceneView=t,this.points=this.geoArrayToCoords(e)||[],this.vec3=n,this.vec3d=i,this.esriMathUtils=r,this.arcLengthDivisions=2e4}return e.prototype.getLineLen=function(e,t){var n,i,r,a,o,s;return n=e,r=(i=t)[0]-n[0],a=i[1]-n[1],o=i[2]-n[2],s=r*r+a*a+o*o,Math.sqrt(s)},e.prototype.getPoint=function(e,t){for(var n,i,r,a,o,s=0,l=0,c=this.points.length;l<c-1;l++){var p=this.points[l+0],u=this.points[l+1],h=this.points[l+2],g=this.getLineLen(p,u);if(t<s+g){var d=t-s;return{type:"line",len:d,point:(i=p,a=d/g,o=void 0,(o=[])[0]=((r=u)[0]-i[0])*a+i[0],o[1]=(r[1]-i[1])*a+i[1],o[2]=(r[2]-i[2])*a+i[2],o)}}s+=g;var f=R(p,u,h,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils),m=Math.abs(f);if(t<s+m)return{type:"rotate",angle:(t-s)*((n=f)<0?-1:n>0?1:0),point:u,points:{pre:p,base:u,next:h},lastLineLen:s};s+=m}},e}(),xe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),be=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setRuntimeSetting=function(n){e.prototype.setRuntimeSetting.call(t,n,(function(){var e=t.getApiCamera(t.getCameraByProgress());t.sceneView.goTo(e,{animate:!1})}))},t.prepare=function(n){return new Promise((function(i,r){var a=(null==n?void 0:n.geo)?null==n?void 0:n.geo:t.state.init.geo;a&&"polyline"===a.type||alert("Wrong geo type!"),e.prototype.preparing.call(t),a=t.queryGeometryElevInfo(a),t.cachedGeo=t.getDilutionPath(a.paths[0]),t.paths=new we(t.cachedGeo,t.sceneView,t.glMatrix_vec3,t.glMatrix_vec3d,t.esriMathUtils);var o=t.paths.getLength();t.animat.setAmount(o);var s=t.getApiCamera(t.getCameraByProgress());t.sceneView.goTo(s).then((function(){e.prototype.prepared.call(t).then((function(){i()}))})).catch((function(e){console.log(e)}))}))},t.fly=function(n){if(n&&(n.speedFactor&&t.realtimeSetting.setSpeedFactor(n.speedFactor),n.duration&&(t.duration=n.duration)),!t.state.settingMode){var i=t.animat.computeDuration();t.animat.init(Z.Linear,0,t.animat.getAmount(),t.duration||i)}return e.prototype.isEnableToFly.call(t)?t.resume():Promise.reject()},t._doFly=function(){return e.prototype._doFly.call(t),t.updateAnimat((function(e){if(!0===t.state.settingMode||t.animat.easing(e.deltaTime,t.realtimeSetting.getSpeedFactor()),t.updateProgressBar(),t.animat.getProgress()>=1)t.animat.reset(),t.stop();else{var n=t.getCameraByProgress(),i=t.getApiCamera(n);i&&t.sceneView.goTo(i,{animate:!1})}}))},t.getProgress=function(){return t.animat.getProgress()},t.getCameraByProgress=function(e){var n,i;0===t.animat.getProgress()?(n=0*t.animat.getAmount(),t.animat.progressForward(),i=t.animat.getAmount()*t.animat.getProgress()):(n=t.animat.getAmount()*t.animat.progressBackward(),i=t.animat.getAmount()*t.animat.getProgress());var r=t.paths.getPoint(0,n),a=t.paths.getPoint(0,i),o=[0,0,0],s=[0,0,0],l=t.glMatrix_vec3d.create();if("line"===r.type){var c=r.point,p=a.point,u=c;(y=t.getCameraPosition(c,p))||(y=t._cache.camera_gl.pos),t.sceneView.renderCoordsHelper.worldUpAtPosition(y,l),o[0]=y[0],o[1]=y[1],o[2]=y[2],s[0]=u[0],s[1]=u[1],s[2]=u[2]}else if("rotate"===r.type){var h=r.points.pre,g=r.points.base,d=r.points.next,f=t.glMatrix_vec3d.create();t.glMatrix_vec3.subtract(f,g,h);var m=t.glMatrix_vec3d.create();t.glMatrix_vec3.subtract(m,d,g);var v=r.lastLineLen,y=(c=t.paths.getPoint(0,v-.02),p=t.paths.getPoint(0,v-.01),t.getCameraPosition(c.point,p.point));t.sceneView.renderCoordsHelper.worldUpAtPosition(g,l);var w=r.angle;y=t.rotateBySceneMode(y,l,w,g),o[0]=y[0],o[1]=y[1],o[2]=y[2],s[0]=g[0],s[1]=g[1],s[2]=g[2]}return t._cache.camera_gl.pos=o,t._cache.camera_gl.upDir=l,t._cache.lookAtTarget_gl.pos=s,t._cache.lookAtTarget_gl.upAxis=null,t._cache.lookAtTarget_gl.baseAlt=null,{lookAt:s,camPos:o,up:l,type:r.type}},t.getApiCamera=function(e){var n=e.camPos,i=e.lookAt,r=e.up;if(!n||!i||!r)return null;var a,o=F(i,1,t.sceneView),s=new t.Point({x:o[0],y:o[1],z:o[2],type:"point",spatialReference:t.sceneView.spatialReference});a=s.z,s.z=s.z+t.realtimeSetting.getAltitudeFactor(),s.z<0&&(s.z=0),i=z([s.x,s.y,s.z],null,t.sceneView),o=F(n,1,t.sceneView),(s=new t.Point({x:o[0],y:o[1],z:o[2],type:"point",spatialReference:t.sceneView.spatialReference})).z=a+t.realtimeSetting.getAltitudeFactor()+t.realtimeSetting.getCamOffsetHeight(),n=z([s.x,s.y,s.z],null,t.sceneView),t.state.DEBUG&&t.auxHelper.drawLine_gl([n,i],t.sceneView,"yellow");var l=new t.GLCamera(n,i,r);return t.cameraUtils.internalToExternal(t.sceneView,l)},t.resume=function(){return e.prototype.resume.call(t),t._resume(t.sceneView.goTo(t.getApiCamera(t.getCameraByProgress())))},t.clear=function(){e.prototype.clear.call(t)},t}return xe(t,e),t.prototype.getRuntimeSettingInfo=function(){return{tilt:null,altitude:this.realtimeSetting.getAltitudeFactor()}},t.prototype.getCameraPosition=function(e,t){if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;var n=this.realtimeSetting.getCamOffsetHeight()||100,i=this.realtimeSetting.getCamOffsetDistance()||100,r=e,a=t,o=this.glMatrix_vec3d.create();this.glMatrix_vec3.subtract(o,r,a);var s=this.glMatrix_vec3.length(o),l=this.glMatrix_vec3d.create();this.glMatrix_vec3.normalize(l,o);var c=s+i,p=this.glMatrix_vec3d.create();this.glMatrix_vec3.scale(p,l,c);var u=this.glMatrix_vec3d.create();this.glMatrix_vec3.add(u,a,p);var h=F(u,1,this.sceneView),g=new this.Point({x:h[0],y:h[1],z:h[2],type:"point",spatialReference:this.sceneView.spatialReference});return g.z<n&&(g.z=n),g.z<0&&(g.z=0),this.state.DEBUG&&this.auxHelper.drawPoint(g,"red"),z([g.x,g.y,g.z],null,this.sceneView)},t}(oe),Pe=function(){function e(e){var t=this;this.init=function(e){var n=t.getController();null==n||n.init(e)},this.prepare=function(e){var n=t.getController();null==n||n.prepare(e)},this.clear=function(){var e=t.getController();e&&e.clear()},this.settingPreview=function(e){return new Promise((function(n,i){var r=t.getController();null==r||r.settingPreview(e).then((function(){n()}))}))},this.setSpeedFactor=function(e){var n=t.getController();n&&n.realtimeSetting.setSpeedFactor(e)},this.onHeadingChange=function(e){var n=t.getController();n&&n.realtimeSetting.setHeadingFactor(e)},this.onTiltChange=function(e){var n=t.getController();n&&n.setRuntimeSetting({tilt:e})},this.onAltitudeChange=function(e){var n=t.getController();n&&n.setRuntimeSetting({altitude:e})},this.sceneView=e.sceneView,this.state={activedController:null,activedFlyStyle:null,debug:e.debug,callbacks:e.callbacks},this.rotationFlyController=new le({sceneView:this.sceneView,debug:this.state.debug,callbacks:this.state.callbacks}),this.curveFlyController=new ye({sceneView:this.sceneView,debug:this.state.debug,callbacks:this.state.callbacks}),this.lineFlyController=new be({sceneView:this.sceneView,debug:this.state.debug,callbacks:this.state.callbacks})}return e.prototype.destructor=function(){this.stop(),this.clearAll()},e.prototype.getController=function(){return this.state.activedController},e.prototype.useController=function(e){e?(this.state.activedController=this.getControllerByItem(e),this.state.activedFlyStyle=e.name):(this.state.activedController=null,this.state.activedFlyStyle=null),this.rotationFlyController!==this.state.activedController&&this.rotationFlyController.clear(),this.curveFlyController!==this.state.activedController&&this.curveFlyController.clear(),this.lineFlyController!==this.state.activedController&&this.lineFlyController.clear()},e.prototype.getControllerStyle=function(){return this.state.activedFlyStyle},e.prototype.getControllerByItem=function(e){var t=e.name;if(T.b.Rotate===t){if(this.rotationFlyController)return this.rotationFlyController}else if(T.b.Path===t){var n=this._getMode(e);if(T.c.Smoothed===n){if(this.curveFlyController)return this.curveFlyController}else if(T.c.RealPath===n&&this.lineFlyController)return this.lineFlyController}return null},e.prototype._getMode=function(e){var t=T.c.Smoothed;return e&&e.name===T.b.Path&&e.style&&(t=e.style),t},e.prototype.fly=function(e){this.settingPreview(!1);var t=this.getController();t.isEnableToFly()&&(t.realtimeSetting.setSpeedFactor(e),t.fly())},e.prototype.stop=function(){var e=this.getController();e&&(e.stop(),e.clear())},e.prototype.pause=function(){var e=this.getController();e.isEnableToPause()&&e.pause()},e.prototype.getProgress=function(){return this.getController().getProgress()},e.prototype.clearAll=function(){this.rotationFlyController.state.flyState!==te.RUNNING&&this.rotationFlyController.clear(),this.curveFlyController.state.flyState!==te.RUNNING&&this.curveFlyController.clear(),this.lineFlyController.state.flyState!==te.RUNNING&&this.lineFlyController.clear()},e.prototype.getLiveviewSettingInfo=function(){var e=this.getController();return e?e.getRuntimeSettingInfo():null},e}();!function(e){e[e.Choose3DMap=0]="Choose3DMap",e[e.ConfigError=1]="ConfigError"}(ae||(ae={}));var Me,Se,Ce=function(e){var t=this;this.getDefaultError=function(){return t.chooseMapTip},this.isError=function(){return t.isNoMapId()||t.isErrorTipShown()||t.isNoScene()||t.isNoModeInSetting()},this.setError=function(e){e!==t.widget.state.errorTip&&t.widget.setState({errorTip:e})},this.setErrorByType=function(e){e===ae.Choose3DMap&&t.setError(t.chooseMapTip)},this.isNoScene=function(){return!t.widget.jimuMapView},this.isNoModeInSetting=function(){return U(t.widget.props.config.itemsList)<1},this.isNoMapId=function(){return!(t.widget.props.useMapWidgetIds&&t.widget.props.useMapWidgetIds[0])},this.isErrorTipShown=function(){return t.widget.state.errorTip},this.checkErrorInConfig=function(){t.isNoScene()||t.isNoMapId()?t.setError(t.chooseMapTip):t.isNoModeInSetting()?t.setError(t.configErrorTip):t.widget.jimuMapView&&t.setError("")},this.widget=e.widget,this.chooseMapTip=this.widget.props.intl.formatMessage({id:"chooseMapTip",defaultMessage:o}),this.configErrorTip=this.widget.props.intl.formatMessage({id:"configErrorTip",defaultMessage:s})},_e=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),je=n(165),Ae=n(85),Ve=n(86);!function(e){e[e.None=0]="None",e[e.Drawing=1]="Drawing",e[e.Picking=2]="Picking",e[e.Playing=3]="Playing"}(Me||(Me={})),function(e){e[e.Point=0]="Point",e[e.Line=1]="Line"}(Se||(Se={}));var Le=function(e){function t(t){var i=e.call(this,t)||this;i.onActiveViewChange=function(e){var t,n,r;return null==e||"2d"===e.view.type?(i.errorTipsManager.setErrorByType(ae.Choose3DMap),void(i.jimuMapView=null)):(i.errorTipsManager.setError(""),(null===(t=i.jimuMapView)||void 0===t?void 0:t.id)!==e.id&&i.onClearBtnClick(),i.sceneView=e.view,i.jimuMapView=e,null===(n=i.controllerManager)||void 0===n||n.destructor(),null===(r=i.graphicInteractionManager)||void 0===r||r.destructor(),i.graphicInteractionManager=new $({widget:i,sceneView:i.sceneView,jimuMapView:i.jimuMapView}),void(i.controllerManager=new Pe({sceneView:i.sceneView,debug:!1,callbacks:{onFly:i.onFlyPlay,onPause:i.onFlyPause,onUpdateProgress:i.onUpdateProgress}})))},i.isGraphicInteractionManagerReady=function(){return i.graphicInteractionManager&&i.graphicInteractionManager.isReady()},i.clearUIStateAndEvents=function(e){var t,n,r;i.setState({isFlyStylePopupOpen:!1,isLiveview:!1}),null===(t=i.graphicInteractionManager)||void 0===t||t.setStates({isDrawing:!1,isPicking:!1}),null===(n=i.graphicInteractionManager)||void 0===n||n.restoreMapPopupHightlightState(),null===(r=i.controllerManager)||void 0===r||r.settingPreview(!1)},i.onFlyStyleChange=function(e,t){var n,r=0;null===e?r=function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i&&i.isInUse)return{idx:t,item:i}}return{idx:null,item:null}}(i.props.config.itemsList.asMutable()).idx:r=e;!0!==(null==t?void 0:t.isRecord)&&(null===(n=i.controllerManager)||void 0===n||n.useController(B(i.props,i.state,r,null==t||t.isRecord))),i.setState({activedItemIdx:r}),i.clearUIStateAndEvents(),i.onClearBtnClick()},i.onIsDrawingChange=function(e){var t;i.isGraphicInteractionManagerReady()&&!0!==i.state.isPlaying&&(i.clearUIStateAndEvents(),null===(t=i.graphicInteractionManager)||void 0===t||t.toggleDrawState(),Se.Point===e?i.onDrawPoint():i.onDrawLine())},i.onPickBtnClick=function(e){var t,n;if(i.isGraphicInteractionManagerReady()){var r=null===(t=i.graphicInteractionManager)||void 0===t?void 0:t.getStates().isPicking;i.clearUIStateAndEvents(),null===(n=i.graphicInteractionManager)||void 0===n||n.setPickingState(!r)}},i.onPlayStateBtnClick=function(){!1===i.state.isPlaying?i.onPlay():i.onPause()},i.setPlayStatePlaying=function(e){i.setState({isPlaying:!!e,isLiveview:!1}),i.graphicInteractionManager.setStates({isDrawing:!1,isPicking:!1})},i.onFlyPlay=function(){i.state.isLiveview||i.state.isPlaying||i.setPlayStatePlaying(!0)},i.onFlyPause=function(){i.setPlayStatePlaying(!1)},i.isLiveviewMode=function(){return i.state.isLiveview},i.onUpdateProgress=function(e){i.setState({progress:e})},i.onGraphicInteractionManagerLoad=function(){i.setState({subCompsLoaded:!0})},i.getFlyStyleContent=function(){var e=B(i.props,i.state),t=e&&e.name,n=null;return t===T.b.Rotate?n=Object(r.jsx)(a.Icon,{icon:Ae}):t===T.b.Path&&(n=Object(r.jsx)(a.Icon,{icon:Ve})),n},i.toggleFlyStylePopup=function(){U(i.props.config.itemsList)<=1?i.setState({isFlyStylePopupOpen:!1}):i.state.isPlaying||i.setState({isFlyStylePopupOpen:!i.state.isFlyStylePopupOpen})},i.isDisableButton=function(e){var t=e.isPlaying,n=e.isLiveview,r=e.isCachedGeo,a=!i.state.subCompsLoaded;return t&&(a=a&&!i.state.isPlaying),n&&(a=a&&!i.state.isLiveview),r&&(a=a||!i.state.isCachedGeo),a},i.getDrawBtnContent=function(){var e,t=n(166),o=n(167),s=null,l=null===(e=i.graphicInteractionManager)||void 0===e?void 0:e.getStates().isDrawing,c=i.isDisableButton({isPlaying:!0}),h=i.props.intl.formatMessage({id:"triggerSelectPoint",defaultMessage:p}),g=i.props.intl.formatMessage({id:"triggerDrwaPath",defaultMessage:u}),d=B(i.props,i.state),f=d&&d.name;return f===T.b.Rotate?s=Object(r.jsx)(a.Button,{icon:!0,active:l,onClick:function(){return i.onIsDrawingChange(Se.Point)},disabled:c,title:h,className:"btns draw-btn",type:"tertiary"},Object(r.jsx)(a.Icon,{icon:t})):f===T.b.Path&&(s=Object(r.jsx)(a.Button,{icon:!0,active:l,onClick:function(){return i.onIsDrawingChange(Se.Line)},disabled:c,title:g,className:"btns draw-btn",type:"tertiary"},Object(r.jsx)(a.Icon,{icon:o}))),s},i.getPickBtnContent=function(){var e,t=n(168),o=i.isDisableButton({isPlaying:!0}),s=i.props.intl.formatMessage({id:"triggerSelectFeature",defaultMessage:h}),l=null===(e=i.graphicInteractionManager)||void 0===e?void 0:e.getStates().isPicking;return Object(r.jsx)(a.Button,{icon:!0,onClick:function(e){return i.onPickBtnClick()},active:l,disabled:o,title:s,className:"btns pick-btn",type:"tertiary"},Object(r.jsx)(a.Icon,{icon:t}))},i.getClearBtnContent=function(){var e=n(169),t=i.props.intl.formatMessage({id:"triggerClear",defaultMessage:g}),o=i.isDisableButton({isPlaying:!0,isCachedGeo:!0});return Object(r.jsx)(a.Button,{icon:!0,onClick:i.onClearBtnClick,disabled:o,title:t,className:"btns clear-btn",type:"tertiary"},Object(r.jsx)(a.Icon,{icon:e}))},i.onDrawPoint=function(){var e;!0!==i.state.isPlaying&&!0!==(null===(e=i.graphicInteractionManager)||void 0===e?void 0:e.getStates().isDrawing)&&i.graphicInteractionManager.drawPoint().then((function(e){null!==e&&i.onDrawHanlder(e),i.clearUIStateAndEvents()}))},i.onDrawLine=function(){var e;!0!==i.state.isPlaying&&!0!==(null===(e=i.graphicInteractionManager)||void 0===e?void 0:e.getStates().isDrawing)&&i.graphicInteractionManager.drawLine().then((function(e){null!==e&&i.onDrawHanlder(e),i.clearUIStateAndEvents()}))},i.onDrawHanlder=function(e){var t=e.graphic,n=e.cameraInfo,r=B(i.props,i.state),a={};r&&r.direction&&(a=Object.assign(a,{direction:r.direction})),n&&(a=Object.assign(a,{cameraInfo:n}));var o=r.name;if(o===T.b.Rotate){var s=t.geometry,l=i.sceneView.toScreen(s);i.sceneView.hitTest(l,{exclude:[i.sceneView.graphics]}).then((function(e){var t=function(e){var t=null;return e.results.length>0&&(t=e.results[e.results.length-1]),e.ground.mapPoint&&(t?e.ground.distance>t.distance&&(t=e.ground):t=e.ground),t}(e);i.controllerManager.init({geo:t,options:a}),i.controllerManager.prepare()}))}else if(o===T.b.Path){i.onAltitudeChange(0,!0,!1);var c=t.geometry;i.controllerManager.init({geo:c,options:a}),i.controllerManager.prepare()}},i.onClearBtnClick=function(){var e;i.clearUIStateAndEvents(),null===(e=i.graphicInteractionManager)||void 0===e||e.clear(),i.controllerManager&&i.onStop(),i.resetLiveviewSetting()},i.toggleLiveviewSettingPopup=function(){if(i.state.isCachedGeo){var e=!i.state.isLiveview;i.controllerManager.settingPreview(e);var t=i.controllerManager.getLiveviewSettingInfo();t&&(i.onTiltChange(t.tilt),i.onAltitudeChange(t.altitude),i.setState({isLiveview:e}))}},i.onSpeedChange=function(e){var t;i.setState({settingSpeed:e}),null===(t=i.controllerManager)||void 0===t||t.setSpeedFactor(e)},i.onTiltChange=function(e,t){i.setState({settingTilt:e}),i.controllerManager&&t&&i.controllerManager.onTiltChange(e)},i.onAltitudeChange=function(e,t,n){if(i.setState({settingAltitude:e}),i.controllerManager&&t&&i.controllerManager.onAltitudeChange(e),!1!==n&&i.graphicInteractionManager){var r=i.controllerManager.getLiveviewSettingInfo();i.graphicInteractionManager.updateLineByAltitude(r.altitude)}},i.resetLiveviewSetting=function(){i.setState({isLiveview:!1});var e={speed:.5,tilt:0,altitude:0};i.controllerManager&&i.controllerManager.getLiveviewSettingInfo()&&(i.onSpeedChange(e.speed),i.onTiltChange(e.tilt,!0),i.onAltitudeChange(e.altitude,!0,!1))},i.onPlay=function(){i.state.isCachedGeo&&i.controllerManager.fly(i.state.settingSpeed)},i.onStop=function(){i.controllerManager.stop()},i.onPause=function(){i.controllerManager.pause()},i.onClear=function(){i.controllerManager.clear()},i.toggleSpeedPopup=function(){i.setState({isSpeedPopupOpen:!i.state.isSpeedPopupOpen})},i.errorTipsManager=new Ce({widget:i});var o={speed:.5,tilt:0,altitude:0};return i.state={errorTip:i.errorTipsManager.getDefaultError(),subCompsLoaded:!1,isCachedGeo:!1,isFlyStylePopupOpen:!1,activedItemIdx:null,isPlaying:!1,isDrawing:!1,isPicking:!1,isLiveview:!1,settingSpeed:o.speed,settingTilt:o.tilt,settingAltitude:o.altitude,progress:0,isSpeedPopupOpen:!1},i}return _e(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.layoutId,n=e.layoutItemId,i=e.id;this.props.dispatch(r.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:t,layoutItemId:n}))},t.prototype.componentWillUnmount=function(){var e,t;this.clearUIStateAndEvents(),null===(e=this.controllerManager)||void 0===e||e.destructor(),null===(t=this.graphicInteractionManager)||void 0===t||t.destructor()},t.prototype.componentDidUpdate=function(e,t){this.errorTipsManager.isError()&&this.errorTipsManager.checkErrorInConfig(),this.controllerManager&&null===this.controllerManager.getController()&&this.onFlyStyleChange(null),this.props.config!==e.config&&(this.onFlyStyleChange(null),this.onClearBtnClick())},t.prototype.renderFlyStyleSelectorContent=function(e){var t,n,i=this,o=this.props.config.itemsList.asMutable(),s=B(this.props,this.state),p=s&&(t=s.name,n=this.props,t===T.b.Rotate?n.intl.formatMessage({id:"flyStyleRotate",defaultMessage:l}):t===T.b.Path?n.intl.formatMessage({id:"flyStylePath",defaultMessage:c}):null),u=this.props.intl.formatMessage({id:"flyStyleRotate",defaultMessage:l}),h=this.props.intl.formatMessage({id:"flyStylePath",defaultMessage:c}),g=e!==T.a.Palette,d=this.getFlyStyleContent();return Object(r.jsx)(a.Dropdown,{isOpen:this.state.isFlyStylePopupOpen,toggle:this.toggleFlyStylePopup,className:"dropdowns flystyle-btn",activeIcon:!0},Object(r.jsx)(a.DropdownButton,{icon:!0,className:"btns d-flex",title:p,type:"tertiary",arrow:g},d),Object(r.jsx)(a.DropdownMenu,{showArrow:!1},o.map((function(e,t){var n=e.name,o=!(t!==i.state.activedItemIdx);return e.isInUse?T.b.Rotate===n?Object(r.jsx)("div",{key:t},Object(r.jsx)(a.DropdownItem,{onClick:function(){return i.onFlyStyleChange(t)},active:o,className:"dropdown-items"},Object(r.jsx)(a.Icon,{icon:Ae}),Object(r.jsx)("span",{className:"mx-2"},u))):T.b.Path===n?Object(r.jsx)("div",{key:t},Object(r.jsx)(a.DropdownItem,{onClick:function(){return i.onFlyStyleChange(t)},active:o,className:"dropdown-items"},Object(r.jsx)(a.Icon,{icon:Ve}),Object(r.jsx)("span",{className:"mx-2"},h))):void 0:null}))))},t.prototype.renderLiveviewSettingContent=function(){var e,t,i=this,o=n(170),s=this.isDisableButton({isPlaying:!0,isCachedGeo:!0}),l=this.props.intl.formatMessage({id:"settings",defaultMessage:a.defaultMessages.settings}),c=this.props.intl.formatMessage({id:"tilt",defaultMessage:f}),p=this.props.intl.formatMessage({id:"altitude",defaultMessage:m}),u=this.props.intl.formatMessage({id:"degree",defaultMessage:a.defaultMessages.degree}),h=this.props.intl.formatMessage({id:"meter",defaultMessage:a.defaultMessages.meter}),g=this.props.intl.formatMessage({id:"meterAbbr",defaultMessage:a.defaultMessages.meterAbbr}),d=this.props.intl.formatMessage({id:"ground",defaultMessage:v}),x=this.props.intl.formatMessage({id:"outerSpace",defaultMessage:y}),b=this.props.intl.formatMessage({id:"relative2Ground",defaultMessage:w}),P=null===(e=this.controllerManager)||void 0===e?void 0:e.getControllerStyle();return Object(r.jsx)(a.Dropdown,{isOpen:this.state.isLiveview,toggle:this.toggleLiveviewSettingPopup,className:"dropdowns liveview-btn"},Object(r.jsx)(a.DropdownButton,{icon:!0,className:"btns d-flex",disabled:s,title:l,type:"tertiary",arrow:!1},Object(r.jsx)(a.Icon,{icon:o})),Object(r.jsx)(a.DropdownMenu,{showArrow:!1,css:(t=this.props.theme,Object(r.css)(L||(L=D(["\n  padding: 5px 10px;\n  border: 1px solid ",";\n\n  .dropdown-items{\n    padding: 10px;\n  }\n  .dropdown-item{\n    padding: 5px 0;\n  }\n  .dropdown-item-title{\n    font-size: 13px;\n    padding-bottom:5px;\n  }\n\n  .dropdown-item-comment{\n    font-style:italic;\n    font-size: 12px;\n    color: ",";\n    letter-spacing: 0;\n  }\n\n  .setting-altitude-separator{\n    margin: 0 8px 0 4px;\n  }\n\n  .alt-wapper {\n    align-items: center;\n    font-size: 13px;\n  }\n  .alt-input {\n    width: 60px\n  }\n  "],["\n  padding: 5px 10px;\n  border: 1px solid ",";\n\n  .dropdown-items{\n    padding: 10px;\n  }\n  .dropdown-item{\n    padding: 5px 0;\n  }\n  .dropdown-item-title{\n    font-size: 13px;\n    padding-bottom:5px;\n  }\n\n  .dropdown-item-comment{\n    font-style:italic;\n    font-size: 12px;\n    color: ",";\n    letter-spacing: 0;\n  }\n\n  .setting-altitude-separator{\n    margin: 0 8px 0 4px;\n  }\n\n  .alt-wapper {\n    align-items: center;\n    font-size: 13px;\n  }\n  .alt-input {\n    width: 60px\n  }\n  "])),t.colors.palette.light[400],t.colors.palette.light[600]))},P!==T.b.Path?Object(r.jsx)("div",{className:"d-flex dropdown-items flex-column"},Object(r.jsx)("span",{className:"d-flex dropdown-item-title"},c),Object(r.jsx)(a.Slider,{id:"setting-tilt",className:"d-flex",value:this.state.settingTilt,min:0,max:90,step:1,size:"sm",onChange:function(e){return i.onTiltChange(e.target.value,!0)},title:X(this.state.settingTilt,u)})):null,P!==T.b.Rotate?Object(r.jsx)(r.React.Fragment,null,Object(r.jsx)("div",{className:"d-flex dropdown-items flex-column"},Object(r.jsx)("span",{className:"d-flex dropdown-item dropdown-item-title"},p),Object(r.jsx)(a.Slider,{id:"setting-altitude",className:"d-flex dropdown-item",value:this.state.settingAltitude,min:0,max:800,step:10,size:"sm",onChange:function(e){return i.onAltitudeChange(e.target.value,!0)},title:X(this.state.settingAltitude,h)}),Object(r.jsx)("div",{className:"d-flex justify-content-between dropdown-item-comment dropdown-item"},Object(r.jsx)("span",null,d),Object(r.jsx)("span",null,x))),Object(r.jsx)("div",{className:"d-flex dropdown-items flex-column"},Object(r.jsx)("div",{className:"d-flex alt-wapper"},Object(r.jsx)("div",{className:"alt-input"},Object(r.jsx)(a.NumericInput,{defaultValue:"0",size:"sm",value:this.state.settingAltitude,onChange:function(e){return i.onAltitudeChange(e,!0)}})),Object(r.jsx)("span",{className:"setting-altitude-separator"},g),b))):null))},t.prototype.renderPlayStateContent=function(){var e=n(171),t=n(172),i=null,o=this.isDisableButton({isPlaying:!0,isLiveview:!0,isCachedGeo:!0}),s=null;return this.state.isPlaying?(s=Object(r.jsx)(a.Icon,{icon:t}),i=this.props.intl.formatMessage({id:"pause",defaultMessage:a.defaultMessages.pause})):(s=Object(r.jsx)(a.Icon,{icon:e}),i=this.props.intl.formatMessage({id:"play",defaultMessage:a.defaultMessages.play})),Object(r.jsx)(a.Button,{icon:!0,onClick:this.onPlayStateBtnClick,title:i,disabled:o,className:"btns play-btn",type:"tertiary"},s)},t.prototype.renderProgressBarContent=function(e){var t,n=e===T.a.Palette?"circular":"linear";return(null===(t=this.controllerManager)||void 0===t?void 0:t.getControllerStyle())===T.b.Path?Object(r.jsx)(a.Progress,{type:n,value:this.state.progress,className:"w-100"}):null},t.prototype.renderSpeedControllerContent=function(){var e=this,t=this.props.intl.formatMessage({id:"speed",defaultMessage:d})+": "+this.props.intl.formatNumber(W(this.state.settingSpeed))+"x",n=[0,.25,.375,.5,.59375,.625,.75,1],i=n.length;return Object(r.jsx)("div",{className:"d-flex item align-items-center h-100"},Object(r.jsx)(a.Slider,{id:"setting-speed",className:"d-flex speed-controller",value:n.indexOf(this.state.settingSpeed),min:0,max:i-1,step:1,size:"sm",onChange:function(t){return e.onSpeedChange(n[t.target.value])},title:t}))},t.prototype.renderSpeedControllerContentPalette=function(){var e=this,t=this.props.intl.formatMessage({id:"speed",defaultMessage:d}),n=W(this.state.settingSpeed),i=this.props.intl.formatNumber(n),o=t+": "+i+"x";return Object(r.jsx)(a.Dropdown,{isOpen:this.state.isSpeedPopupOpen,toggle:this.toggleSpeedPopup,className:"speedcontroller-btn",direction:"up"},Object(r.jsx)(a.DropdownButton,{icon:!0,className:"d-flex speedcontroller-text",title:o,type:"tertiary",arrow:!1},i+"x"),Object(r.jsx)(a.DropdownMenu,{showArrow:!1,css:(this.props.theme,Object(r.css)(S||(S=j(["\n    min-width: 60px;\n    padding: 0;\n\n    .speed-popup-wapper{\n      font-size: 12px;\n\n      .dropdown-item{\n        padding-left: 0;\n        padding-right: 0;\n      }\n    }"],["\n    min-width: 60px;\n    padding: 0;\n\n    .speed-popup-wapper{\n      font-size: 12px;\n\n      .dropdown-item{\n        padding-left: 0;\n        padding-right: 0;\n      }\n    }"]))))},Object(r.jsx)("div",{className:"speed-popup-wapper"},[0,.25,.375,.5,.59375,.625,.75,1].map((function(t,n){var i=t===e.state.settingSpeed,o=e.props.intl.formatNumber(W(t));return Object(r.jsx)("div",{key:n},Object(r.jsx)(a.DropdownItem,{onClick:function(){return e.onSpeedChange(t)},active:i},Object(r.jsx)("span",{className:"mx-2"},o+"x")))})))))},t.prototype.renderWidgetPlaceholder=function(){return Object(r.jsx)(a.WidgetPlaceholder,{icon:je,widgetId:this.props.id,message:this.state.errorTip})},t.prototype.render=function(){var e=Object(r.jsx)(k.JimuMapViewComponent,{useMapWidgetIds:this.props.useMapWidgetIds,onActiveViewChange:this.onActiveViewChange}),t=this.props.config.layout,n=this.renderFlyStyleSelectorContent(t),i=this.getDrawBtnContent(),a=this.getPickBtnContent(),o=this.getClearBtnContent(),s=this.renderLiveviewSettingContent(),l=this.renderPlayStateContent(),c=this.renderProgressBarContent(t),p=this.renderSpeedControllerContent(),u=this.renderSpeedControllerContentPalette(),h=null;return this.errorTipsManager.isError()?h=this.renderWidgetPlaceholder():t===T.a.Horizontal?h=Object(r.jsx)(_,{flyStyleContent:n,drawBtn:i,pickBtn:a,clearBtn:o,liveviewSettingContent:s,playStateContent:l,progressBar:c,speedController:p,isPlaying:this.state.isPlaying,theme:this.props.theme}):t===T.a.Palette&&(h=Object(r.jsx)(I,{flyStyleContent:n,drawBtn:i,pickBtn:a,clearBtn:o,liveviewSettingContent:s,playStateContent:l,progressBar:c,speedController:u,isPlaying:this.state.isPlaying,theme:this.props.theme})),Object(r.jsx)("div",{css:(this.props.theme,Object(r.css)(V||(V=D(["\n    height: 100%;\n\n    .fly-error-tips {\n      display: flex;\n      height: 100%;\n      justify-content: center;\n      align-items: center;\n    }\n\n    .fly-controller{\n      height: 32px;\n    }\n    "],["\n    height: 100%;\n\n    .fly-error-tips {\n      display: flex;\n      height: 100%;\n      justify-content: center;\n      align-items: center;\n    }\n\n    .fly-controller{\n      height: 32px;\n    }\n    "])))),className:"d-flex align-items-center justify-content-center"},h,Object(r.jsx)("div",{className:"fly-map"},Object(r.jsx)("div",null,e)))},t}(r.BaseWidget);t.default=Le},4:function(e,t){e.exports=i},85:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.957.057A8.001 8.001 0 018 16 8 8 0 011.763 2.99l.249.24.093.993A7 7 0 108 1l.213.004.744-.947zM8 7a1 1 0 110 2 1 1 0 010-2zM1 0l6.734.46L2.86 5.377v-2.99L1 0z" fill="#000" fill-rule="nonzero"></path></svg>'},86:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M1 14a1 1 0 110 2 1 1 0 010-2zm3-1a1 1 0 110 2 1 1 0 010-2zm7-9l-.812 9-2.75-3.335L3 9.328 11 4zm-5 7a1 1 0 110 2 1 1 0 010-2zm6-10a1 1 0 110 2 1 1 0 010-2zm3-1a1 1 0 110 2 1 1 0 010-2z" fill="#000" fill-rule="evenodd"></path></svg>'}}))}}}));