System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/advanced/data-source-selector"],(function(e){var t,o,a,n,i;return{setters:[function(e){t=e},function(e){o=e},function(e){a=e},function(e){n=e},function(e){i=e}],execute:function(){e(function(e){var t={};function o(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=136)}({0:function(e,o){e.exports=t},1:function(e,t){e.exports=o},11:function(e,t){e.exports=i},136:function(e,t,o){"use strict";o.r(t);var a,n,i=o(0),r=o(1),s=o(2),c=o(4),u=o(11),l=o(17),p=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),d=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},g=Object(i.Immutable)([u.AllDataSourceTypes.FeatureLayer,u.AllDataSourceTypes.SceneLayer]),m=function(e){function t(t){var o=e.call(this,t)||this;return o.NoLockTriggerLayerWidgets=["Map"],o.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},o.getInitConfig=function(){var e=o.props.messageWidgetId,t=Object(i.getAppStore)().getState().appStateInBuilder.appConfig,a=t.widgets[e],n=null;if(o.props.config.useDataSource)n=o.checkAndGetInitUseDataSource(o.props.messageWidgetId,o.props.config.useDataSource);else if(a&&a.useDataSources&&a.useDataSources[0]&&1===a.useDataSources.length){var r=t.dataSources[a.useDataSources[0].dataSourceId];n=!r||r.type!==c.ArcGISDataSourceTypes.WebMap&&r.type!==c.ArcGISDataSourceTypes.WebScene?Object(i.Immutable)({dataSourceId:a.useDataSources[0].dataSourceId,mainDataSourceId:a.useDataSources[0].mainDataSourceId,rootDataSourceId:a.useDataSources[0].rootDataSourceId}):null}return{useDataSource:n}},o.checkAndGetInitUseDataSource=function(e,t){var o=Object(i.getAppStore)().getState().appStateInBuilder.appConfig,a=o.widgets[e],n=null,r=!1,s=a.useDataSources&&a.useDataSources[0]&&a.useDataSources[0].dataSourceId;if(!s)return null;var u=o.dataSources[s];if(!u||u.type!==c.ArcGISDataSourceTypes.WebMap&&u.type!==c.ArcGISDataSourceTypes.WebScene||(r=!0),r){var l=!1;if(a&&a.useDataSources)for(var p=0;p<a.useDataSources.length;p++)if(a.useDataSources[p].dataSourceId===t.rootDataSourceId){l=!0;break}n=l?t:null}else{l=!1;if(a&&a.useDataSources)for(p=0;p<a.useDataSources.length;p++)if(a.useDataSources[p].dataSourceId===t.dataSourceId){l=!0;break}n=l?t:a&&a.useDataSources&&1===a.useDataSources.length?Object(i.Immutable)({dataSourceId:a.useDataSources[0].dataSourceId,rootDataSourceId:a.useDataSources[0].rootDataSourceId}):null}return n},o.handleTriggerLayerChange=function(e){e&&e.length>0?o.handleTriggerLayerSelected(e[0]):o.handleRemoveLayerForTriggerLayer()},o.handleTriggerLayerSelected=function(e){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("useDataSource",e)})},o.handleRemoveLayerForTriggerLayer=function(){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("useDataSource",null)})},o.handleIsUseCustomZoomToOption=function(e){!e||o.props.config.zoomToOption&&o.props.config.zoomToOption.scale?o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("isUseCustomZoomToOption",e)}):o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("isUseCustomZoomToOption",e).setIn(["zoomToOption","scale"],5e3)})},o.handleSetCustomZoomScale=function(e){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.setIn(["zoomToOption","scale"],e)})},o.getTriggerLayerContent=function(){var e=o.getDsSelectorSourceData(o.props.messageWidgetId,o.props.config.useDataSource);return Object(i.jsx)(u.DataSourceSelector,{types:g,useDataSources:e.useDataSources,fromRootDsIds:e.fromRootDsIds,fromDsIds:e.fromDsIds,closeDataSourceListOnChange:!0,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:function(){return e.isReadOnly},disableDataSourceList:e.isReadOnly,onChange:o.handleTriggerLayerChange,widgetId:o.props.messageWidgetId,disableDataView:!0,hideDataView:o.checkIsDisableDataView(o.props.messageWidgetId)})},o.getDsRootIdsByWidgetId=function(e){var t,o,a,n,r=null===(o=null===(t=Object(i.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,s=null===(a=null==r?void 0:r.widgets)||void 0===a?void 0:a[e],u=[],l=i.DataSourceManager.getInstance();return null===(n=null==s?void 0:s.useDataSources)||void 0===n||n.forEach((function(e){var t=l.getDataSource(e.dataSourceId);(null==t?void 0:t.type)!==c.ArcGISDataSourceTypes.WebMap&&(null==t?void 0:t.type)!==c.ArcGISDataSourceTypes.WebScene||u.push(e.dataSourceId)})),u.length>0?Object(i.Immutable)(u):void 0},o.getDsIdsByWidgetId=function(e){var t,o,a,n,r,s=null===(o=null===(t=Object(i.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,c=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e];return Object(i.Immutable)(null!==(r=null===(n=null==c?void 0:c.useDataSources)||void 0===n?void 0:n.map((function(e){return e.dataSourceId})))&&void 0!==r?r:[])},o.getDsSelectorSourceData=function(e,t){var a,n,r,s=null===(n=null===(a=Object(i.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===n?void 0:n.appConfig,c=null===(r=null==s?void 0:s.widgets)||void 0===r?void 0:r[e],u=!1,l=o.getDsRootIdsByWidgetId(e);return l&&0===l.length&&c&&c.useDataSources&&1===c.useDataSources.length&&(u=!0),!l&&c&&c.useDataSources&&1===c.useDataSources.length&&(u=!0),{isReadOnly:u,useDataSources:t&&t.dataSourceId?Object(i.Immutable)([t]):Object(i.Immutable)([]),fromRootDsIds:l,fromDsIds:l?void 0:o.getDsIdsByWidgetId(e)}},o.checkIsDisableDataView=function(e){var t,a,n,r;if(o.props.messageType===i.MessageType.DataRecordsSelectionChange)return!0;var s=null===(a=null===(t=Object(i.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig,c=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[e];return!!c&&"Map"===(null===(r=null==c?void 0:c.manifest)||void 0===r?void 0:r.label)},o.modalStyle.borderRight="1px solid black",o.modalStyle.borderBottom="1px solid black",o.state={isShowLayerList:!1},o}return p(t,e),t.prototype.componentDidMount=function(){var e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("useDataSource",e.useDataSource)})},t.prototype.getStyle=function(e){return Object(i.css)(n||(n=d(["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n    "],["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n    "])),i.polished.rem(10),i.polished.rem(16),i.polished.rem(0),i.polished.rem(16))},t.prototype.render=function(){var e=this;return Object(i.jsx)("div",{css:this.getStyle(this.props.theme)},Object(i.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:l.a.mapAction_TriggerLayer})},this.getTriggerLayerContent()),Object(i.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapZoomToAction_ZoomScale",defaultMessage:l.a.mapZoomToAction_ZoomScale})},Object(i.jsx)(s.SettingRow,null,Object(i.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},Object(i.jsx)("div",{className:"align-items-center d-flex"},Object(i.jsx)(r.Radio,{style:{cursor:"pointer"},checked:!this.props.config.isUseCustomZoomToOption,onChange:function(){return e.handleIsUseCustomZoomToOption(!1)}}),Object(i.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Automatic",defaultMessage:l.a.mapZoomToAction_Automatic}))))),Object(i.jsx)(s.SettingRow,null,Object(i.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},Object(i.jsx)("div",{className:"align-items-center d-flex"},Object(i.jsx)(r.Radio,{style:{cursor:"pointer"},checked:this.props.config.isUseCustomZoomToOption,onChange:function(){return e.handleIsUseCustomZoomToOption(!0)}}),Object(i.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Custom",defaultMessage:l.a.mapZoomToAction_Custom}))))),this.props.config.isUseCustomZoomToOption&&Object(i.jsx)(s.SettingRow,null,Object(i.jsx)(r.TextInput,{className:"w-100",type:"number",placeholder:this.props.intl.formatMessage({id:"mapZoomToAction_TypeScale",defaultMessage:l.a.mapZoomToAction_TypeScale}),value:this.props.config.zoomToOption&&this.props.config.zoomToOption.scale,onChange:function(t){e.handleSetCustomZoomScale(t.target.value)}}))))},t.defaultProps={config:Object(i.Immutable)({useDataSource:null})},t}(i.React.PureComponent);t.default=i.themeUtils.withTheme(m)},17:function(e,t,o){"use strict";t.a={sourceLabel:"Source",sourceDescript:"A web map or web scene, or any combination of the two.",initialMap:"Initial map",initialMapView:"Initial view",selectMap:"Select map",setMapView:"Modify initial view",defaultView:"Default",defaultViewTip:"Initial position of the map inherited from the web map or web scene",customView:"Custom",customViewTip:"Create a new position of the map",customViewSet:"Modify",toolLabel:"Tools",options:"Options",selectionHighlightColor:"Selection highlight",disableScrollZoom:"Disable scroll zooming",disablePopUp:"Disable pop-up",chooseALayer:"Select a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message field",mapLayout:"Tools layout",mapLayout_LargeAndMedium:"Large and medium size",mapLayout_Small:"Small size",mapAction_TriggerLayer:"Trigger data",mapAction_SetData:"Select data",mapAction_ActionLayer:"Action data",mapAction_Conditions:"Conditions",mapAction_RelateMessage:"Trigger / action connection",mapAction_TriggerLayerField:"Select a trigger field",mapAction_None:"none",mapAction_Equals:"equals",mapAction_ActionLayerField:"Select an action field",mapAction_MoreConditions:"More conditions",mapAction_SetExpression:"Please set your expression first.",mapAction_ChooseLayer:"Select data",mapAction_AutoBind:"Auto bound.",mapAction_NoLayer:"No data.",mapZoomToAction_ZoomScale:"Zoom scale",mapZoomToAction_Automatic:"Automatic",mapZoomToAction_Custom:"Custom",mapZoomToAction_TypeScale:"Type a scale"}},2:function(e,t){e.exports=a},4:function(e,t){e.exports=n}}))}}}));