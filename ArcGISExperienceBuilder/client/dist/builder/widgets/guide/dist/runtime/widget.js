System.register(["jimu-core","jimu-for-builder","jimu-layouts/layout-runtime","jimu-for-builder/service","jimu-ui/basic/guide"],(function(e){var t,i,n,u,o;return{setters:[function(e){t=e},function(e){i=e},function(e){n=e},function(e){u=e},function(e){o=e}],execute:function(){e(function(e){var t={};function i(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,i),u.l=!0,u.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)i.d(n,u,function(t){return e[t]}.bind(null,u));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=78)}({0:function(e,i){e.exports=t},12:function(e,t){e.exports=o},2:function(e,t){e.exports=i},4:function(e,t){e.exports=n},78:function(e,t,i){"use strict";i.r(t);var n,u=i(0),o=i(12),r=i(8),d=i(4),s=i(2),a=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),l=function(e){function t(t){var i=e.call(this,t)||this;return i.handleChange=function(e){var t,n=e.status,u=e.index,d=e.isInjected,a=e.step;if(n===o.STATUS.FINISHED||n===o.STATUS.SKIPPED||n===o.STATUS.ERROR){if(n===o.STATUS.FINISHED&&d)return i.setState({guideModule:i._masterGuide.guideModule,stepIndex:i._masterGuide.stepIndex+1,run:!0}),void i.reset();n!==o.STATUS.SKIPPED&&n!==o.STATUS.FINISHED||o.COMMON_GUIDE_MODULES.indexOf(i.state.activeGuide)<0&&r.userServices.updateUserResource({showGuides:(t={},t[i.state.activeGuide]=!1,t)}),i.reset(!0),i.props.dispatch(s.builderActions.stopGuide())}else n===o.STATUS.INJECTED&&(i._masterGuide.guideModule||(i._masterGuide=i._masterGuide.set("guideModule",i.state.guideModule)),i._masterGuide=i._masterGuide.set("stepIndex",u),i.props.dispatch(s.builderActions.startGuide(a.injectedGuide)),i.setState({widgetName:a.widgetName}))},i.state={stepIndex:0,run:!1,guideModule:null,widgetName:null,activeGuide:null},i.guideManager=s.GuideManager.getInstance(),i.reset(),i}return a(t,e),t.prototype.componentDidUpdate=function(e){var t,i,n,u,o=this;(null==e?void 0:e.activeGuide)!==(null===(t=this.props)||void 0===t?void 0:t.activeGuide)&&(null===(i=this.props)||void 0===i?void 0:i.activeGuide)?this.guideManager.getGuideModule(this.props.activeGuide).then((function(e){o.setState({guideModule:e,run:!0,stepIndex:0,activeGuide:o.props.activeGuide})})):e.totalWidgetCount<this.props.totalWidgetCount&&(null===(n=e.selectedWidget)||void 0===n?void 0:n.uri)!==(null===(u=this.props.selectedWidget)||void 0===u?void 0:u.uri)&&this.props.selectedWidget&&(this._addedWidget=this.props.selectedWidget)},t.prototype.componentDidMount=function(){var e=this;r.userServices.initUserResource().then((function(t){(null==t?void 0:t.success)&&r.userServices.getUserResource().then((function(t){var i;void 0===(null===(i=null==t?void 0:t.showGuides)||void 0===i?void 0:i["opening-tour"])&&e.props.dispatch(s.builderActions.startGuide("opening-tour"))}))}))},t.prototype.reset=function(e){void 0===e&&(e=!1),e&&(this.setState({run:!1,stepIndex:0,guideModule:null,widgetName:null,activeGuide:null}),this._addedWidget=null),this._masterGuide=Object(u.Immutable)({guideModule:null,stepIndex:0})},t.prototype.render=function(){var e=this.props.isAppBusy,t=this.state,i=t.stepIndex,n=t.run,o=this.state.guideModule;return!e&&n?Object(u.jsx)("div",{className:"widget-guide"},o&&Object(u.jsx)(o,{run:n,stepIndex:i,widgetName:this.state.widgetName,widgetJson:this._addedWidget,onStepChange:this.handleChange})):""},t.defaultProps={totalWidgetCount:0},t.mapExtraStateProps=function(e,t){var i,n,o,r,s,a=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig,l=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appRuntimeInfo.selection;if(l){var c=d.searchUtils.findLayoutItem(a,l);c&&c.type===u.LayoutItemType.Widget&&c.widgetId&&(s=a.widgets[c.widgetId])}return{activeGuide:null===(o=null==e?void 0:e.builder)||void 0===o?void 0:o.currentGuideId,isAppBusy:!(null===(r=null==e?void 0:e.appStateInBuilder)||void 0===r?void 0:r.appRuntimeInfo.currentPageId),selectedWidget:s,totalWidgetCount:(null==a?void 0:a.widgets)?Object.keys(a.widgets).length:0}},t}(u.React.PureComponent);t.default=l},8:function(e,t){e.exports=u}}))}}}));